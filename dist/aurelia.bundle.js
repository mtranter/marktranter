webpackJsonp([1],[
/* 0 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Container = exports.InvocationHandler = exports._emptyParameters = exports.SingletonRegistration = exports.TransientRegistration = exports.FactoryInvoker = exports.NewInstance = exports.Factory = exports.StrategyResolver = exports.Parent = exports.Optional = exports.All = exports.Lazy = exports.resolver = undefined;

var _dec, _class, _dec2, _class3, _dec3, _class5, _dec4, _class7, _dec5, _class9, _dec6, _class11, _dec7, _class13, _classInvokers;

exports.invoker = invoker;
exports.factory = factory;
exports.registration = registration;
exports.transient = transient;
exports.singleton = singleton;
exports.autoinject = autoinject;
exports.inject = inject;

var _aureliaMetadata = __webpack_require__(6);

var _aureliaPal = __webpack_require__(2);



var resolver = exports.resolver = _aureliaMetadata.protocol.create('aurelia:resolver', function (target) {
  if (!(typeof target.get === 'function')) {
    return 'Resolvers must implement: get(container: Container, key: any): any';
  }

  return true;
});

var Lazy = exports.Lazy = (_dec = resolver(), _dec(_class = function () {
  function Lazy(key) {
    

    this._key = key;
  }

  Lazy.prototype.get = function get(container) {
    var _this = this;

    return function () {
      return container.get(_this._key);
    };
  };

  Lazy.of = function of(key) {
    return new Lazy(key);
  };

  return Lazy;
}()) || _class);
var All = exports.All = (_dec2 = resolver(), _dec2(_class3 = function () {
  function All(key) {
    

    this._key = key;
  }

  All.prototype.get = function get(container) {
    return container.getAll(this._key);
  };

  All.of = function of(key) {
    return new All(key);
  };

  return All;
}()) || _class3);
var Optional = exports.Optional = (_dec3 = resolver(), _dec3(_class5 = function () {
  function Optional(key) {
    var checkParent = arguments.length <= 1 || arguments[1] === undefined ? true : arguments[1];

    

    this._key = key;
    this._checkParent = checkParent;
  }

  Optional.prototype.get = function get(container) {
    if (container.hasResolver(this._key, this._checkParent)) {
      return container.get(this._key);
    }

    return null;
  };

  Optional.of = function of(key) {
    var checkParent = arguments.length <= 1 || arguments[1] === undefined ? true : arguments[1];

    return new Optional(key, checkParent);
  };

  return Optional;
}()) || _class5);
var Parent = exports.Parent = (_dec4 = resolver(), _dec4(_class7 = function () {
  function Parent(key) {
    

    this._key = key;
  }

  Parent.prototype.get = function get(container) {
    return container.parent ? container.parent.get(this._key) : null;
  };

  Parent.of = function of(key) {
    return new Parent(key);
  };

  return Parent;
}()) || _class7);
var StrategyResolver = exports.StrategyResolver = (_dec5 = resolver(), _dec5(_class9 = function () {
  function StrategyResolver(strategy, state) {
    

    this.strategy = strategy;
    this.state = state;
  }

  StrategyResolver.prototype.get = function get(container, key) {
    switch (this.strategy) {
      case 0:
        return this.state;
      case 1:
        var singleton = container.invoke(this.state);
        this.state = singleton;
        this.strategy = 0;
        return singleton;
      case 2:
        return container.invoke(this.state);
      case 3:
        return this.state(container, key, this);
      case 4:
        return this.state[0].get(container, key);
      case 5:
        return container.get(this.state);
      default:
        throw new Error('Invalid strategy: ' + this.strategy);
    }
  };

  return StrategyResolver;
}()) || _class9);
var Factory = exports.Factory = (_dec6 = resolver(), _dec6(_class11 = function () {
  function Factory(key) {
    

    this._key = key;
  }

  Factory.prototype.get = function get(container) {
    var _this2 = this;

    return function () {
      for (var _len = arguments.length, rest = Array(_len), _key = 0; _key < _len; _key++) {
        rest[_key] = arguments[_key];
      }

      return container.invoke(_this2._key, rest);
    };
  };

  Factory.of = function of(key) {
    return new Factory(key);
  };

  return Factory;
}()) || _class11);
var NewInstance = exports.NewInstance = (_dec7 = resolver(), _dec7(_class13 = function () {
  function NewInstance(key) {
    

    this.key = key;
    this.asKey = key;
  }

  NewInstance.prototype.get = function get(container) {
    var instance = container.invoke(this.key);
    container.registerInstance(this.asKey, instance);
    return instance;
  };

  NewInstance.prototype.as = function as(key) {
    this.asKey = key;
    return this;
  };

  NewInstance.of = function of(key) {
    return new NewInstance(key);
  };

  return NewInstance;
}()) || _class13);
function invoker(value) {
  return function (target) {
    _aureliaMetadata.metadata.define(_aureliaMetadata.metadata.invoker, value, target);
  };
}

function factory(potentialTarget) {
  var deco = function deco(target) {
    _aureliaMetadata.metadata.define(_aureliaMetadata.metadata.invoker, FactoryInvoker.instance, target);
  };

  return potentialTarget ? deco(potentialTarget) : deco;
}

var FactoryInvoker = exports.FactoryInvoker = function () {
  function FactoryInvoker() {
    
  }

  FactoryInvoker.prototype.invoke = function invoke(container, fn, dependencies) {
    var i = dependencies.length;
    var args = new Array(i);

    while (i--) {
      args[i] = container.get(dependencies[i]);
    }

    return fn.apply(undefined, args);
  };

  FactoryInvoker.prototype.invokeWithDynamicDependencies = function invokeWithDynamicDependencies(container, fn, staticDependencies, dynamicDependencies) {
    var i = staticDependencies.length;
    var args = new Array(i);

    while (i--) {
      args[i] = container.get(staticDependencies[i]);
    }

    if (dynamicDependencies !== undefined) {
      args = args.concat(dynamicDependencies);
    }

    return fn.apply(undefined, args);
  };

  return FactoryInvoker;
}();

FactoryInvoker.instance = new FactoryInvoker();

function registration(value) {
  return function (target) {
    _aureliaMetadata.metadata.define(_aureliaMetadata.metadata.registration, value, target);
  };
}

function transient(key) {
  return registration(new TransientRegistration(key));
}

function singleton(keyOrRegisterInChild) {
  var registerInChild = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];

  return registration(new SingletonRegistration(keyOrRegisterInChild, registerInChild));
}

var TransientRegistration = exports.TransientRegistration = function () {
  function TransientRegistration(key) {
    

    this._key = key;
  }

  TransientRegistration.prototype.registerResolver = function registerResolver(container, key, fn) {
    return container.registerTransient(this._key || key, fn);
  };

  return TransientRegistration;
}();

var SingletonRegistration = exports.SingletonRegistration = function () {
  function SingletonRegistration(keyOrRegisterInChild) {
    var registerInChild = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];

    

    if (typeof keyOrRegisterInChild === 'boolean') {
      this._registerInChild = keyOrRegisterInChild;
    } else {
      this._key = keyOrRegisterInChild;
      this._registerInChild = registerInChild;
    }
  }

  SingletonRegistration.prototype.registerResolver = function registerResolver(container, key, fn) {
    return this._registerInChild ? container.registerSingleton(this._key || key, fn) : container.root.registerSingleton(this._key || key, fn);
  };

  return SingletonRegistration;
}();

var badKeyError = 'key/value cannot be null or undefined. Are you trying to inject/register something that doesn\'t exist with DI?';
var _emptyParameters = exports._emptyParameters = Object.freeze([]);

_aureliaMetadata.metadata.registration = 'aurelia:registration';
_aureliaMetadata.metadata.invoker = 'aurelia:invoker';

var resolverDecorates = resolver.decorates;

var InvocationHandler = exports.InvocationHandler = function () {
  function InvocationHandler(fn, invoker, dependencies) {
    

    this.fn = fn;
    this.invoker = invoker;
    this.dependencies = dependencies;
  }

  InvocationHandler.prototype.invoke = function invoke(container, dynamicDependencies) {
    return dynamicDependencies !== undefined ? this.invoker.invokeWithDynamicDependencies(container, this.fn, this.dependencies, dynamicDependencies) : this.invoker.invoke(container, this.fn, this.dependencies);
  };

  return InvocationHandler;
}();

function invokeWithDynamicDependencies(container, fn, staticDependencies, dynamicDependencies) {
  var i = staticDependencies.length;
  var args = new Array(i);

  while (i--) {
    args[i] = container.get(staticDependencies[i]);
  }

  if (dynamicDependencies !== undefined) {
    args = args.concat(dynamicDependencies);
  }

  return Reflect.construct(fn, args);
}

var classInvokers = (_classInvokers = {}, _classInvokers[0] = {
  invoke: function invoke(container, Type) {
    return new Type();
  },

  invokeWithDynamicDependencies: invokeWithDynamicDependencies
}, _classInvokers[1] = {
  invoke: function invoke(container, Type, deps) {
    return new Type(container.get(deps[0]));
  },

  invokeWithDynamicDependencies: invokeWithDynamicDependencies
}, _classInvokers[2] = {
  invoke: function invoke(container, Type, deps) {
    return new Type(container.get(deps[0]), container.get(deps[1]));
  },

  invokeWithDynamicDependencies: invokeWithDynamicDependencies
}, _classInvokers[3] = {
  invoke: function invoke(container, Type, deps) {
    return new Type(container.get(deps[0]), container.get(deps[1]), container.get(deps[2]));
  },

  invokeWithDynamicDependencies: invokeWithDynamicDependencies
}, _classInvokers[4] = {
  invoke: function invoke(container, Type, deps) {
    return new Type(container.get(deps[0]), container.get(deps[1]), container.get(deps[2]), container.get(deps[3]));
  },

  invokeWithDynamicDependencies: invokeWithDynamicDependencies
}, _classInvokers[5] = {
  invoke: function invoke(container, Type, deps) {
    return new Type(container.get(deps[0]), container.get(deps[1]), container.get(deps[2]), container.get(deps[3]), container.get(deps[4]));
  },

  invokeWithDynamicDependencies: invokeWithDynamicDependencies
}, _classInvokers.fallback = {
  invoke: invokeWithDynamicDependencies,
  invokeWithDynamicDependencies: invokeWithDynamicDependencies
}, _classInvokers);

function getDependencies(f) {
  if (!f.hasOwnProperty('inject')) {
    return [];
  }

  if (typeof f.inject === 'function') {
    return f.inject();
  }

  return f.inject;
}

var Container = exports.Container = function () {
  function Container(configuration) {
    

    if (configuration === undefined) {
      configuration = {};
    }

    this._configuration = configuration;
    this._onHandlerCreated = configuration.onHandlerCreated;
    this._handlers = configuration.handlers || (configuration.handlers = new Map());
    this._resolvers = new Map();
    this.root = this;
    this.parent = null;
  }

  Container.prototype.makeGlobal = function makeGlobal() {
    Container.instance = this;
    return this;
  };

  Container.prototype.setHandlerCreatedCallback = function setHandlerCreatedCallback(onHandlerCreated) {
    this._onHandlerCreated = onHandlerCreated;
    this._configuration.onHandlerCreated = onHandlerCreated;
  };

  Container.prototype.registerInstance = function registerInstance(key, instance) {
    return this.registerResolver(key, new StrategyResolver(0, instance === undefined ? key : instance));
  };

  Container.prototype.registerSingleton = function registerSingleton(key, fn) {
    return this.registerResolver(key, new StrategyResolver(1, fn === undefined ? key : fn));
  };

  Container.prototype.registerTransient = function registerTransient(key, fn) {
    return this.registerResolver(key, new StrategyResolver(2, fn === undefined ? key : fn));
  };

  Container.prototype.registerHandler = function registerHandler(key, handler) {
    return this.registerResolver(key, new StrategyResolver(3, handler));
  };

  Container.prototype.registerAlias = function registerAlias(originalKey, aliasKey) {
    return this.registerResolver(aliasKey, new StrategyResolver(5, originalKey));
  };

  Container.prototype.registerResolver = function registerResolver(key, resolver) {
    if (key === null || key === undefined) {
      throw new Error(badKeyError);
    }

    var allResolvers = this._resolvers;
    var result = allResolvers.get(key);

    if (result === undefined) {
      allResolvers.set(key, resolver);
    } else if (result.strategy === 4) {
      result.state.push(resolver);
    } else {
      allResolvers.set(key, new StrategyResolver(4, [result, resolver]));
    }

    return resolver;
  };

  Container.prototype.autoRegister = function autoRegister(key, fn) {
    fn = fn === undefined ? key : fn;

    if (typeof fn === 'function') {
      var _registration = _aureliaMetadata.metadata.get(_aureliaMetadata.metadata.registration, fn);

      if (_registration === undefined) {
        return this.registerResolver(key, new StrategyResolver(1, fn));
      }

      return _registration.registerResolver(this, key, fn);
    }

    return this.registerResolver(key, new StrategyResolver(0, fn));
  };

  Container.prototype.autoRegisterAll = function autoRegisterAll(fns) {
    var i = fns.length;
    while (i--) {
      this.autoRegister(fns[i]);
    }
  };

  Container.prototype.unregister = function unregister(key) {
    this._resolvers.delete(key);
  };

  Container.prototype.hasResolver = function hasResolver(key) {
    var checkParent = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];

    if (key === null || key === undefined) {
      throw new Error(badKeyError);
    }

    return this._resolvers.has(key) || checkParent && this.parent !== null && this.parent.hasResolver(key, checkParent);
  };

  Container.prototype.get = function get(key) {
    if (key === null || key === undefined) {
      throw new Error(badKeyError);
    }

    if (key === Container) {
      return this;
    }

    if (resolverDecorates(key)) {
      return key.get(this, key);
    }

    var resolver = this._resolvers.get(key);

    if (resolver === undefined) {
      if (this.parent === null) {
        return this.autoRegister(key).get(this, key);
      }

      return this.parent._get(key);
    }

    return resolver.get(this, key);
  };

  Container.prototype._get = function _get(key) {
    var resolver = this._resolvers.get(key);

    if (resolver === undefined) {
      if (this.parent === null) {
        return this.autoRegister(key).get(this, key);
      }

      return this.parent._get(key);
    }

    return resolver.get(this, key);
  };

  Container.prototype.getAll = function getAll(key) {
    if (key === null || key === undefined) {
      throw new Error(badKeyError);
    }

    var resolver = this._resolvers.get(key);

    if (resolver === undefined) {
      if (this.parent === null) {
        return _emptyParameters;
      }

      return this.parent.getAll(key);
    }

    if (resolver.strategy === 4) {
      var state = resolver.state;
      var i = state.length;
      var results = new Array(i);

      while (i--) {
        results[i] = state[i].get(this, key);
      }

      return results;
    }

    return [resolver.get(this, key)];
  };

  Container.prototype.createChild = function createChild() {
    var child = new Container(this._configuration);
    child.root = this.root;
    child.parent = this;
    return child;
  };

  Container.prototype.invoke = function invoke(fn, dynamicDependencies) {
    try {
      var _handler = this._handlers.get(fn);

      if (_handler === undefined) {
        _handler = this._createInvocationHandler(fn);
        this._handlers.set(fn, _handler);
      }

      return _handler.invoke(this, dynamicDependencies);
    } catch (e) {
      throw new _aureliaPal.AggregateError('Error invoking ' + fn.name + '. Check the inner error for details.', e, true);
    }
  };

  Container.prototype._createInvocationHandler = function _createInvocationHandler(fn) {
    var dependencies = void 0;

    if (fn.inject === undefined) {
      dependencies = _aureliaMetadata.metadata.getOwn(_aureliaMetadata.metadata.paramTypes, fn) || _emptyParameters;
    } else {
      dependencies = [];
      var ctor = fn;
      while (typeof ctor === 'function') {
        var _dependencies;

        (_dependencies = dependencies).push.apply(_dependencies, getDependencies(ctor));
        ctor = Object.getPrototypeOf(ctor);
      }
    }

    var invoker = _aureliaMetadata.metadata.getOwn(_aureliaMetadata.metadata.invoker, fn) || classInvokers[dependencies.length] || classInvokers.fallback;

    var handler = new InvocationHandler(fn, invoker, dependencies);
    return this._onHandlerCreated !== undefined ? this._onHandlerCreated(handler) : handler;
  };

  return Container;
}();

function autoinject(potentialTarget) {
  var deco = function deco(target) {
    target.inject = _aureliaMetadata.metadata.getOwn(_aureliaMetadata.metadata.paramTypes, target) || _emptyParameters;
  };

  return potentialTarget ? deco(potentialTarget) : deco;
}

function inject() {
  for (var _len2 = arguments.length, rest = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
    rest[_key2] = arguments[_key2];
  }

  return function (target, key, descriptor) {
    if (descriptor) {
      var _fn = descriptor.value;
      _fn.inject = rest;
    } else {
      target.inject = rest;
    }
  };
}

/***/ },
/* 1 */,
/* 2 */,
/* 3 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.TemplatingEngine = exports.ElementConfigResource = exports.CompositionEngine = exports.HtmlBehaviorResource = exports.BindableProperty = exports.BehaviorPropertyObserver = exports.Controller = exports.ViewEngine = exports.ModuleAnalyzer = exports.ResourceDescription = exports.ResourceModule = exports.ViewCompiler = exports.ViewFactory = exports.BoundViewFactory = exports.ViewSlot = exports.View = exports.ViewResources = exports.ShadowDOM = exports.ShadowSlot = exports.PassThroughSlot = exports.SlotCustomAttribute = exports.BindingLanguage = exports.ViewLocator = exports.InlineViewStrategy = exports.TemplateRegistryViewStrategy = exports.NoViewStrategy = exports.ConventionalViewStrategy = exports.RelativeViewStrategy = exports.viewStrategy = exports.TargetInstruction = exports.BehaviorInstruction = exports.ViewCompileInstruction = exports.ResourceLoadContext = exports.ElementEvents = exports.ViewEngineHooksResource = exports.CompositionTransaction = exports.CompositionTransactionOwnershipToken = exports.CompositionTransactionNotifier = exports.Animator = exports.animationEvent = undefined;

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _class4, _temp, _dec, _class5, _dec2, _class6, _dec3, _class7, _dec4, _class8, _dec5, _class9, _class10, _temp2, _dec6, _class11, _class12, _temp3, _class15, _dec7, _class17, _dec8, _class18, _dec9, _class20, _dec10, _class21, _dec11, _class22;

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj; };

exports._hyphenate = _hyphenate;
exports._isAllWhitespace = _isAllWhitespace;
exports.viewEngineHooks = viewEngineHooks;
exports.children = children;
exports.child = child;
exports.resource = resource;
exports.behavior = behavior;
exports.customElement = customElement;
exports.customAttribute = customAttribute;
exports.templateController = templateController;
exports.bindable = bindable;
exports.dynamicOptions = dynamicOptions;
exports.useShadowDOM = useShadowDOM;
exports.processAttributes = processAttributes;
exports.processContent = processContent;
exports.containerless = containerless;
exports.useViewStrategy = useViewStrategy;
exports.useView = useView;
exports.inlineView = inlineView;
exports.noView = noView;
exports.elementConfig = elementConfig;

var _aureliaLogging = __webpack_require__(7);

var LogManager = _interopRequireWildcard(_aureliaLogging);

var _aureliaMetadata = __webpack_require__(6);

var _aureliaPal = __webpack_require__(2);

var _aureliaPath = __webpack_require__(8);

var _aureliaLoader = __webpack_require__(14);

var _aureliaDependencyInjection = __webpack_require__(0);

var _aureliaBinding = __webpack_require__(4);

var _aureliaTaskQueue = __webpack_require__(11);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }



var animationEvent = exports.animationEvent = {
  enterBegin: 'animation:enter:begin',
  enterActive: 'animation:enter:active',
  enterDone: 'animation:enter:done',
  enterTimeout: 'animation:enter:timeout',

  leaveBegin: 'animation:leave:begin',
  leaveActive: 'animation:leave:active',
  leaveDone: 'animation:leave:done',
  leaveTimeout: 'animation:leave:timeout',

  staggerNext: 'animation:stagger:next',

  removeClassBegin: 'animation:remove-class:begin',
  removeClassActive: 'animation:remove-class:active',
  removeClassDone: 'animation:remove-class:done',
  removeClassTimeout: 'animation:remove-class:timeout',

  addClassBegin: 'animation:add-class:begin',
  addClassActive: 'animation:add-class:active',
  addClassDone: 'animation:add-class:done',
  addClassTimeout: 'animation:add-class:timeout',

  animateBegin: 'animation:animate:begin',
  animateActive: 'animation:animate:active',
  animateDone: 'animation:animate:done',
  animateTimeout: 'animation:animate:timeout',

  sequenceBegin: 'animation:sequence:begin',
  sequenceDone: 'animation:sequence:done'
};

var Animator = exports.Animator = function () {
  function Animator() {
    
  }

  Animator.prototype.enter = function enter(element) {
    return Promise.resolve(false);
  };

  Animator.prototype.leave = function leave(element) {
    return Promise.resolve(false);
  };

  Animator.prototype.removeClass = function removeClass(element, className) {
    element.classList.remove(className);
    return Promise.resolve(false);
  };

  Animator.prototype.addClass = function addClass(element, className) {
    element.classList.add(className);
    return Promise.resolve(false);
  };

  Animator.prototype.animate = function animate(element, className) {
    return Promise.resolve(false);
  };

  Animator.prototype.runSequence = function runSequence(animations) {};

  Animator.prototype.registerEffect = function registerEffect(effectName, properties) {};

  Animator.prototype.unregisterEffect = function unregisterEffect(effectName) {};

  return Animator;
}();

var CompositionTransactionNotifier = exports.CompositionTransactionNotifier = function () {
  function CompositionTransactionNotifier(owner) {
    

    this.owner = owner;
    this.owner._compositionCount++;
  }

  CompositionTransactionNotifier.prototype.done = function done() {
    this.owner._compositionCount--;
    this.owner._tryCompleteTransaction();
  };

  return CompositionTransactionNotifier;
}();

var CompositionTransactionOwnershipToken = exports.CompositionTransactionOwnershipToken = function () {
  function CompositionTransactionOwnershipToken(owner) {
    

    this.owner = owner;
    this.owner._ownershipToken = this;
    this.thenable = this._createThenable();
  }

  CompositionTransactionOwnershipToken.prototype.waitForCompositionComplete = function waitForCompositionComplete() {
    this.owner._tryCompleteTransaction();
    return this.thenable;
  };

  CompositionTransactionOwnershipToken.prototype.resolve = function resolve() {
    this._resolveCallback();
  };

  CompositionTransactionOwnershipToken.prototype._createThenable = function _createThenable() {
    var _this = this;

    return new Promise(function (resolve, reject) {
      _this._resolveCallback = resolve;
    });
  };

  return CompositionTransactionOwnershipToken;
}();

var CompositionTransaction = exports.CompositionTransaction = function () {
  function CompositionTransaction() {
    

    this._ownershipToken = null;
    this._compositionCount = 0;
  }

  CompositionTransaction.prototype.tryCapture = function tryCapture() {
    return this._ownershipToken === null ? new CompositionTransactionOwnershipToken(this) : null;
  };

  CompositionTransaction.prototype.enlist = function enlist() {
    return new CompositionTransactionNotifier(this);
  };

  CompositionTransaction.prototype._tryCompleteTransaction = function _tryCompleteTransaction() {
    if (this._compositionCount <= 0) {
      this._compositionCount = 0;

      if (this._ownershipToken !== null) {
        var token = this._ownershipToken;
        this._ownershipToken = null;
        token.resolve();
      }
    }
  };

  return CompositionTransaction;
}();

var capitalMatcher = /([A-Z])/g;

function addHyphenAndLower(char) {
  return '-' + char.toLowerCase();
}

function _hyphenate(name) {
  return (name.charAt(0).toLowerCase() + name.slice(1)).replace(capitalMatcher, addHyphenAndLower);
}

function _isAllWhitespace(node) {
  return !(node.auInterpolationTarget || /[^\t\n\r ]/.test(node.textContent));
}

var ViewEngineHooksResource = exports.ViewEngineHooksResource = function () {
  function ViewEngineHooksResource() {
    
  }

  ViewEngineHooksResource.prototype.initialize = function initialize(container, target) {
    this.instance = container.get(target);
  };

  ViewEngineHooksResource.prototype.register = function register(registry, name) {
    registry.registerViewEngineHooks(this.instance);
  };

  ViewEngineHooksResource.prototype.load = function load(container, target) {};

  ViewEngineHooksResource.convention = function convention(name) {
    if (name.endsWith('ViewEngineHooks')) {
      return new ViewEngineHooksResource();
    }
  };

  return ViewEngineHooksResource;
}();

function viewEngineHooks(target) {
  var deco = function deco(t) {
    _aureliaMetadata.metadata.define(_aureliaMetadata.metadata.resource, new ViewEngineHooksResource(), t);
  };

  return target ? deco(target) : deco;
}

var ElementEvents = exports.ElementEvents = function () {
  function ElementEvents(element) {
    

    this.element = element;
    this.subscriptions = {};
  }

  ElementEvents.prototype._enqueueHandler = function _enqueueHandler(handler) {
    this.subscriptions[handler.eventName] = this.subscriptions[handler.eventName] || [];
    this.subscriptions[handler.eventName].push(handler);
  };

  ElementEvents.prototype._dequeueHandler = function _dequeueHandler(handler) {
    var index = void 0;
    var subscriptions = this.subscriptions[handler.eventName];
    if (subscriptions) {
      index = subscriptions.indexOf(handler);
      if (index > -1) {
        subscriptions.splice(index, 1);
      }
    }
    return handler;
  };

  ElementEvents.prototype.publish = function publish(eventName) {
    var detail = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];
    var bubbles = arguments.length <= 2 || arguments[2] === undefined ? true : arguments[2];
    var cancelable = arguments.length <= 3 || arguments[3] === undefined ? true : arguments[3];

    var event = _aureliaPal.DOM.createCustomEvent(eventName, { cancelable: cancelable, bubbles: bubbles, detail: detail });
    this.element.dispatchEvent(event);
  };

  ElementEvents.prototype.subscribe = function subscribe(eventName, handler) {
    var _this2 = this;

    var bubbles = arguments.length <= 2 || arguments[2] === undefined ? true : arguments[2];

    if (handler && typeof handler === 'function') {
      handler.eventName = eventName;
      handler.handler = handler;
      handler.bubbles = bubbles;
      handler.dispose = function () {
        _this2.element.removeEventListener(eventName, handler, bubbles);
        _this2._dequeueHandler(handler);
      };
      this.element.addEventListener(eventName, handler, bubbles);
      this._enqueueHandler(handler);
      return handler;
    }

    return undefined;
  };

  ElementEvents.prototype.subscribeOnce = function subscribeOnce(eventName, handler) {
    var _this3 = this;

    var bubbles = arguments.length <= 2 || arguments[2] === undefined ? true : arguments[2];

    if (handler && typeof handler === 'function') {
      var _ret = function () {
        var _handler = function _handler(event) {
          handler(event);
          _handler.dispose();
        };
        return {
          v: _this3.subscribe(eventName, _handler, bubbles)
        };
      }();

      if ((typeof _ret === 'undefined' ? 'undefined' : _typeof(_ret)) === "object") return _ret.v;
    }

    return undefined;
  };

  ElementEvents.prototype.dispose = function dispose(eventName) {
    if (eventName && typeof eventName === 'string') {
      var subscriptions = this.subscriptions[eventName];
      if (subscriptions) {
        while (subscriptions.length) {
          var subscription = subscriptions.pop();
          if (subscription) {
            subscription.dispose();
          }
        }
      }
    } else {
      this.disposeAll();
    }
  };

  ElementEvents.prototype.disposeAll = function disposeAll() {
    for (var key in this.subscriptions) {
      this.dispose(key);
    }
  };

  return ElementEvents;
}();

var ResourceLoadContext = exports.ResourceLoadContext = function () {
  function ResourceLoadContext() {
    

    this.dependencies = {};
  }

  ResourceLoadContext.prototype.addDependency = function addDependency(url) {
    this.dependencies[url] = true;
  };

  ResourceLoadContext.prototype.hasDependency = function hasDependency(url) {
    return url in this.dependencies;
  };

  return ResourceLoadContext;
}();

var ViewCompileInstruction = exports.ViewCompileInstruction = function ViewCompileInstruction() {
  var targetShadowDOM = arguments.length <= 0 || arguments[0] === undefined ? false : arguments[0];
  var compileSurrogate = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];

  

  this.targetShadowDOM = targetShadowDOM;
  this.compileSurrogate = compileSurrogate;
  this.associatedModuleId = null;
};

ViewCompileInstruction.normal = new ViewCompileInstruction();

var BehaviorInstruction = exports.BehaviorInstruction = function () {
  BehaviorInstruction.enhance = function enhance() {
    var instruction = new BehaviorInstruction();
    instruction.enhance = true;
    return instruction;
  };

  BehaviorInstruction.unitTest = function unitTest(type, attributes) {
    var instruction = new BehaviorInstruction();
    instruction.type = type;
    instruction.attributes = attributes || {};
    return instruction;
  };

  BehaviorInstruction.element = function element(node, type) {
    var instruction = new BehaviorInstruction();
    instruction.type = type;
    instruction.attributes = {};
    instruction.anchorIsContainer = !(node.hasAttribute('containerless') || type.containerless);
    instruction.initiatedByBehavior = true;
    return instruction;
  };

  BehaviorInstruction.attribute = function attribute(attrName, type) {
    var instruction = new BehaviorInstruction();
    instruction.attrName = attrName;
    instruction.type = type || null;
    instruction.attributes = {};
    return instruction;
  };

  BehaviorInstruction.dynamic = function dynamic(host, viewModel, viewFactory) {
    var instruction = new BehaviorInstruction();
    instruction.host = host;
    instruction.viewModel = viewModel;
    instruction.viewFactory = viewFactory;
    instruction.inheritBindingContext = true;
    return instruction;
  };

  function BehaviorInstruction() {
    

    this.initiatedByBehavior = false;
    this.enhance = false;
    this.partReplacements = null;
    this.viewFactory = null;
    this.originalAttrName = null;
    this.skipContentProcessing = false;
    this.contentFactory = null;
    this.viewModel = null;
    this.anchorIsContainer = false;
    this.host = null;
    this.attributes = null;
    this.type = null;
    this.attrName = null;
    this.inheritBindingContext = false;
  }

  return BehaviorInstruction;
}();

BehaviorInstruction.normal = new BehaviorInstruction();

var TargetInstruction = exports.TargetInstruction = (_temp = _class4 = function () {
  TargetInstruction.shadowSlot = function shadowSlot(parentInjectorId) {
    var instruction = new TargetInstruction();
    instruction.parentInjectorId = parentInjectorId;
    instruction.shadowSlot = true;
    return instruction;
  };

  TargetInstruction.contentExpression = function contentExpression(expression) {
    var instruction = new TargetInstruction();
    instruction.contentExpression = expression;
    return instruction;
  };

  TargetInstruction.lifting = function lifting(parentInjectorId, liftingInstruction) {
    var instruction = new TargetInstruction();
    instruction.parentInjectorId = parentInjectorId;
    instruction.expressions = TargetInstruction.noExpressions;
    instruction.behaviorInstructions = [liftingInstruction];
    instruction.viewFactory = liftingInstruction.viewFactory;
    instruction.providers = [liftingInstruction.type.target];
    instruction.lifting = true;
    return instruction;
  };

  TargetInstruction.normal = function normal(injectorId, parentInjectorId, providers, behaviorInstructions, expressions, elementInstruction) {
    var instruction = new TargetInstruction();
    instruction.injectorId = injectorId;
    instruction.parentInjectorId = parentInjectorId;
    instruction.providers = providers;
    instruction.behaviorInstructions = behaviorInstructions;
    instruction.expressions = expressions;
    instruction.anchorIsContainer = elementInstruction ? elementInstruction.anchorIsContainer : true;
    instruction.elementInstruction = elementInstruction;
    return instruction;
  };

  TargetInstruction.surrogate = function surrogate(providers, behaviorInstructions, expressions, values) {
    var instruction = new TargetInstruction();
    instruction.expressions = expressions;
    instruction.behaviorInstructions = behaviorInstructions;
    instruction.providers = providers;
    instruction.values = values;
    return instruction;
  };

  function TargetInstruction() {
    

    this.injectorId = null;
    this.parentInjectorId = null;

    this.shadowSlot = false;
    this.slotName = null;
    this.slotFallbackFactory = null;

    this.contentExpression = null;

    this.expressions = null;
    this.behaviorInstructions = null;
    this.providers = null;

    this.viewFactory = null;

    this.anchorIsContainer = false;
    this.elementInstruction = null;
    this.lifting = false;

    this.values = null;
  }

  return TargetInstruction;
}(), _class4.noExpressions = Object.freeze([]), _temp);
var viewStrategy = exports.viewStrategy = _aureliaMetadata.protocol.create('aurelia:view-strategy', {
  validate: function validate(target) {
    if (!(typeof target.loadViewFactory === 'function')) {
      return 'View strategies must implement: loadViewFactory(viewEngine: ViewEngine, compileInstruction: ViewCompileInstruction, loadContext?: ResourceLoadContext): Promise<ViewFactory>';
    }

    return true;
  },
  compose: function compose(target) {
    if (!(typeof target.makeRelativeTo === 'function')) {
      target.makeRelativeTo = _aureliaPal.PLATFORM.noop;
    }
  }
});

var RelativeViewStrategy = exports.RelativeViewStrategy = (_dec = viewStrategy(), _dec(_class5 = function () {
  function RelativeViewStrategy(path) {
    

    this.path = path;
    this.absolutePath = null;
  }

  RelativeViewStrategy.prototype.loadViewFactory = function loadViewFactory(viewEngine, compileInstruction, loadContext) {
    if (this.absolutePath === null && this.moduleId) {
      this.absolutePath = (0, _aureliaPath.relativeToFile)(this.path, this.moduleId);
    }

    compileInstruction.associatedModuleId = this.moduleId;
    return viewEngine.loadViewFactory(this.absolutePath || this.path, compileInstruction, loadContext);
  };

  RelativeViewStrategy.prototype.makeRelativeTo = function makeRelativeTo(file) {
    if (this.absolutePath === null) {
      this.absolutePath = (0, _aureliaPath.relativeToFile)(this.path, file);
    }
  };

  return RelativeViewStrategy;
}()) || _class5);
var ConventionalViewStrategy = exports.ConventionalViewStrategy = (_dec2 = viewStrategy(), _dec2(_class6 = function () {
  function ConventionalViewStrategy(viewLocator, origin) {
    

    this.moduleId = origin.moduleId;
    this.viewUrl = viewLocator.convertOriginToViewUrl(origin);
  }

  ConventionalViewStrategy.prototype.loadViewFactory = function loadViewFactory(viewEngine, compileInstruction, loadContext) {
    compileInstruction.associatedModuleId = this.moduleId;
    return viewEngine.loadViewFactory(this.viewUrl, compileInstruction, loadContext);
  };

  return ConventionalViewStrategy;
}()) || _class6);
var NoViewStrategy = exports.NoViewStrategy = (_dec3 = viewStrategy(), _dec3(_class7 = function () {
  function NoViewStrategy() {
    
  }

  NoViewStrategy.prototype.loadViewFactory = function loadViewFactory(viewEngine, compileInstruction, loadContext) {
    return Promise.resolve(null);
  };

  return NoViewStrategy;
}()) || _class7);
var TemplateRegistryViewStrategy = exports.TemplateRegistryViewStrategy = (_dec4 = viewStrategy(), _dec4(_class8 = function () {
  function TemplateRegistryViewStrategy(moduleId, entry) {
    

    this.moduleId = moduleId;
    this.entry = entry;
  }

  TemplateRegistryViewStrategy.prototype.loadViewFactory = function loadViewFactory(viewEngine, compileInstruction, loadContext) {
    var entry = this.entry;

    if (entry.factoryIsReady) {
      return Promise.resolve(entry.factory);
    }

    compileInstruction.associatedModuleId = this.moduleId;
    return viewEngine.loadViewFactory(entry, compileInstruction, loadContext);
  };

  return TemplateRegistryViewStrategy;
}()) || _class8);
var InlineViewStrategy = exports.InlineViewStrategy = (_dec5 = viewStrategy(), _dec5(_class9 = function () {
  function InlineViewStrategy(markup, dependencies, dependencyBaseUrl) {
    

    this.markup = markup;
    this.dependencies = dependencies || null;
    this.dependencyBaseUrl = dependencyBaseUrl || '';
  }

  InlineViewStrategy.prototype.loadViewFactory = function loadViewFactory(viewEngine, compileInstruction, loadContext) {
    var entry = this.entry;
    var dependencies = this.dependencies;

    if (entry && entry.factoryIsReady) {
      return Promise.resolve(entry.factory);
    }

    this.entry = entry = new _aureliaLoader.TemplateRegistryEntry(this.moduleId || this.dependencyBaseUrl);
    entry.template = _aureliaPal.DOM.createTemplateFromMarkup(this.markup);

    if (dependencies !== null) {
      for (var i = 0, ii = dependencies.length; i < ii; ++i) {
        var current = dependencies[i];

        if (typeof current === 'string' || typeof current === 'function') {
          entry.addDependency(current);
        } else {
          entry.addDependency(current.from, current.as);
        }
      }
    }

    compileInstruction.associatedModuleId = this.moduleId;
    return viewEngine.loadViewFactory(entry, compileInstruction, loadContext);
  };

  return InlineViewStrategy;
}()) || _class9);
var ViewLocator = exports.ViewLocator = (_temp2 = _class10 = function () {
  function ViewLocator() {
    
  }

  ViewLocator.prototype.getViewStrategy = function getViewStrategy(value) {
    if (!value) {
      return null;
    }

    if ((typeof value === 'undefined' ? 'undefined' : _typeof(value)) === 'object' && 'getViewStrategy' in value) {
      var _origin = _aureliaMetadata.Origin.get(value.constructor);

      value = value.getViewStrategy();

      if (typeof value === 'string') {
        value = new RelativeViewStrategy(value);
      }

      viewStrategy.assert(value);

      if (_origin) {
        value.makeRelativeTo(_origin.moduleId);
      }

      return value;
    }

    if (typeof value === 'string') {
      value = new RelativeViewStrategy(value);
    }

    if (viewStrategy.validate(value)) {
      return value;
    }

    if (typeof value !== 'function') {
      value = value.constructor;
    }

    var origin = _aureliaMetadata.Origin.get(value);
    var strategy = _aureliaMetadata.metadata.get(ViewLocator.viewStrategyMetadataKey, value);

    if (!strategy) {
      if (!origin) {
        throw new Error('Cannot determine default view strategy for object.', value);
      }

      strategy = this.createFallbackViewStrategy(origin);
    } else if (origin) {
      strategy.moduleId = origin.moduleId;
    }

    return strategy;
  };

  ViewLocator.prototype.createFallbackViewStrategy = function createFallbackViewStrategy(origin) {
    return new ConventionalViewStrategy(this, origin);
  };

  ViewLocator.prototype.convertOriginToViewUrl = function convertOriginToViewUrl(origin) {
    var moduleId = origin.moduleId;
    var id = moduleId.endsWith('.js') || moduleId.endsWith('.ts') ? moduleId.substring(0, moduleId.length - 3) : moduleId;
    return id + '.html';
  };

  return ViewLocator;
}(), _class10.viewStrategyMetadataKey = 'aurelia:view-strategy', _temp2);


function mi(name) {
  throw new Error('BindingLanguage must implement ' + name + '().');
}

var BindingLanguage = exports.BindingLanguage = function () {
  function BindingLanguage() {
    
  }

  BindingLanguage.prototype.inspectAttribute = function inspectAttribute(resources, elementName, attrName, attrValue) {
    mi('inspectAttribute');
  };

  BindingLanguage.prototype.createAttributeInstruction = function createAttributeInstruction(resources, element, info, existingInstruction) {
    mi('createAttributeInstruction');
  };

  BindingLanguage.prototype.inspectTextContent = function inspectTextContent(resources, value) {
    mi('inspectTextContent');
  };

  return BindingLanguage;
}();

var noNodes = Object.freeze([]);

var SlotCustomAttribute = exports.SlotCustomAttribute = (_dec6 = (0, _aureliaDependencyInjection.inject)(_aureliaPal.DOM.Element), _dec6(_class11 = function () {
  function SlotCustomAttribute(element) {
    

    this.element = element;
    this.element.auSlotAttribute = this;
  }

  SlotCustomAttribute.prototype.valueChanged = function valueChanged(newValue, oldValue) {};

  return SlotCustomAttribute;
}()) || _class11);

var PassThroughSlot = exports.PassThroughSlot = function () {
  function PassThroughSlot(anchor, name, destinationName, fallbackFactory) {
    

    this.anchor = anchor;
    this.anchor.viewSlot = this;
    this.name = name;
    this.destinationName = destinationName;
    this.fallbackFactory = fallbackFactory;
    this.destinationSlot = null;
    this.projections = 0;
    this.contentView = null;

    var attr = new SlotCustomAttribute(this.anchor);
    attr.value = this.destinationName;
  }

  PassThroughSlot.prototype.renderFallbackContent = function renderFallbackContent(view, nodes, projectionSource, index) {
    if (this.contentView === null) {
      this.contentView = this.fallbackFactory.create(this.ownerView.container);
      this.contentView.bind(this.ownerView.bindingContext, this.ownerView.overrideContext);

      var slots = Object.create(null);
      slots[this.destinationSlot.name] = this.destinationSlot;

      ShadowDOM.distributeView(this.contentView, slots, projectionSource, index, this.destinationSlot.name);
    }
  };

  PassThroughSlot.prototype.passThroughTo = function passThroughTo(destinationSlot) {
    this.destinationSlot = destinationSlot;
  };

  PassThroughSlot.prototype.addNode = function addNode(view, node, projectionSource, index) {
    if (this.contentView !== null) {
      this.contentView.removeNodes();
      this.contentView.detached();
      this.contentView.unbind();
      this.contentView = null;
    }

    if (node.viewSlot instanceof PassThroughSlot) {
      node.viewSlot.passThroughTo(this);
      return;
    }

    this.projections++;
    this.destinationSlot.addNode(view, node, projectionSource, index);
  };

  PassThroughSlot.prototype.removeView = function removeView(view, projectionSource) {
    this.projections--;
    this.destinationSlot.removeView(view, projectionSource);

    if (this.needsFallbackRendering) {
      this.renderFallbackContent(null, noNodes, projectionSource);
    }
  };

  PassThroughSlot.prototype.removeAll = function removeAll(projectionSource) {
    this.projections = 0;
    this.destinationSlot.removeAll(projectionSource);

    if (this.needsFallbackRendering) {
      this.renderFallbackContent(null, noNodes, projectionSource);
    }
  };

  PassThroughSlot.prototype.projectFrom = function projectFrom(view, projectionSource) {
    this.destinationSlot.projectFrom(view, projectionSource);
  };

  PassThroughSlot.prototype.created = function created(ownerView) {
    this.ownerView = ownerView;
  };

  PassThroughSlot.prototype.bind = function bind(view) {
    if (this.contentView) {
      this.contentView.bind(view.bindingContext, view.overrideContext);
    }
  };

  PassThroughSlot.prototype.attached = function attached() {
    if (this.contentView) {
      this.contentView.attached();
    }
  };

  PassThroughSlot.prototype.detached = function detached() {
    if (this.contentView) {
      this.contentView.detached();
    }
  };

  PassThroughSlot.prototype.unbind = function unbind() {
    if (this.contentView) {
      this.contentView.unbind();
    }
  };

  _createClass(PassThroughSlot, [{
    key: 'needsFallbackRendering',
    get: function get() {
      return this.fallbackFactory && this.projections === 0;
    }
  }]);

  return PassThroughSlot;
}();

var ShadowSlot = exports.ShadowSlot = function () {
  function ShadowSlot(anchor, name, fallbackFactory) {
    

    this.anchor = anchor;
    this.anchor.isContentProjectionSource = true;
    this.anchor.viewSlot = this;
    this.name = name;
    this.fallbackFactory = fallbackFactory;
    this.contentView = null;
    this.projections = 0;
    this.children = [];
    this.projectFromAnchors = null;
    this.destinationSlots = null;
  }

  ShadowSlot.prototype.addNode = function addNode(view, node, projectionSource, index, destination) {
    if (this.contentView !== null) {
      this.contentView.removeNodes();
      this.contentView.detached();
      this.contentView.unbind();
      this.contentView = null;
    }

    if (node.viewSlot instanceof PassThroughSlot) {
      node.viewSlot.passThroughTo(this);
      return;
    }

    if (this.destinationSlots !== null) {
      ShadowDOM.distributeNodes(view, [node], this.destinationSlots, this, index);
    } else {
      node.auOwnerView = view;
      node.auProjectionSource = projectionSource;
      node.auAssignedSlot = this;

      var anchor = this._findAnchor(view, node, projectionSource, index);
      var parent = anchor.parentNode;

      parent.insertBefore(node, anchor);
      this.children.push(node);
      this.projections++;
    }
  };

  ShadowSlot.prototype.removeView = function removeView(view, projectionSource) {
    if (this.destinationSlots !== null) {
      ShadowDOM.undistributeView(view, this.destinationSlots, this);
    } else if (this.contentView && this.contentView.hasSlots) {
      ShadowDOM.undistributeView(view, this.contentView.slots, projectionSource);
    } else {
      var found = this.children.find(function (x) {
        return x.auSlotProjectFrom === projectionSource;
      });
      if (found) {
        var _children = found.auProjectionChildren;

        for (var i = 0, ii = _children.length; i < ii; ++i) {
          var _child = _children[i];

          if (_child.auOwnerView === view) {
            _children.splice(i, 1);
            view.fragment.appendChild(_child);
            i--;ii--;
            this.projections--;
          }
        }

        if (this.needsFallbackRendering) {
          this.renderFallbackContent(view, noNodes, projectionSource);
        }
      }
    }
  };

  ShadowSlot.prototype.removeAll = function removeAll(projectionSource) {
    if (this.destinationSlots !== null) {
      ShadowDOM.undistributeAll(this.destinationSlots, this);
    } else if (this.contentView && this.contentView.hasSlots) {
      ShadowDOM.undistributeAll(this.contentView.slots, projectionSource);
    } else {
      var found = this.children.find(function (x) {
        return x.auSlotProjectFrom === projectionSource;
      });

      if (found) {
        var _children2 = found.auProjectionChildren;
        for (var i = 0, ii = _children2.length; i < ii; ++i) {
          var _child2 = _children2[i];
          _child2.auOwnerView.fragment.appendChild(_child2);
          this.projections--;
        }

        found.auProjectionChildren = [];

        if (this.needsFallbackRendering) {
          this.renderFallbackContent(null, noNodes, projectionSource);
        }
      }
    }
  };

  ShadowSlot.prototype._findAnchor = function _findAnchor(view, node, projectionSource, index) {
    if (projectionSource) {
      var found = this.children.find(function (x) {
        return x.auSlotProjectFrom === projectionSource;
      });
      if (found) {
        if (index !== undefined) {
          var _children3 = found.auProjectionChildren;
          var viewIndex = -1;
          var lastView = void 0;

          for (var i = 0, ii = _children3.length; i < ii; ++i) {
            var current = _children3[i];

            if (current.auOwnerView !== lastView) {
              viewIndex++;
              lastView = current.auOwnerView;

              if (viewIndex >= index && lastView !== view) {
                _children3.splice(i, 0, node);
                return current;
              }
            }
          }
        }

        found.auProjectionChildren.push(node);
        return found;
      }
    }

    return this.anchor;
  };

  ShadowSlot.prototype.projectTo = function projectTo(slots) {
    this.destinationSlots = slots;
  };

  ShadowSlot.prototype.projectFrom = function projectFrom(view, projectionSource) {
    var anchor = _aureliaPal.DOM.createComment('anchor');
    var parent = this.anchor.parentNode;
    anchor.auSlotProjectFrom = projectionSource;
    anchor.auOwnerView = view;
    anchor.auProjectionChildren = [];
    parent.insertBefore(anchor, this.anchor);
    this.children.push(anchor);

    if (this.projectFromAnchors === null) {
      this.projectFromAnchors = [];
    }

    this.projectFromAnchors.push(anchor);
  };

  ShadowSlot.prototype.renderFallbackContent = function renderFallbackContent(view, nodes, projectionSource, index) {
    if (this.contentView === null) {
      this.contentView = this.fallbackFactory.create(this.ownerView.container);
      this.contentView.bind(this.ownerView.bindingContext, this.ownerView.overrideContext);
      this.contentView.insertNodesBefore(this.anchor);
    }

    if (this.contentView.hasSlots) {
      var slots = this.contentView.slots;
      var projectFromAnchors = this.projectFromAnchors;

      if (projectFromAnchors !== null) {
        for (var slotName in slots) {
          var slot = slots[slotName];

          for (var i = 0, ii = projectFromAnchors.length; i < ii; ++i) {
            var anchor = projectFromAnchors[i];
            slot.projectFrom(anchor.auOwnerView, anchor.auSlotProjectFrom);
          }
        }
      }

      this.fallbackSlots = slots;
      ShadowDOM.distributeNodes(view, nodes, slots, projectionSource, index);
    }
  };

  ShadowSlot.prototype.created = function created(ownerView) {
    this.ownerView = ownerView;
  };

  ShadowSlot.prototype.bind = function bind(view) {
    if (this.contentView) {
      this.contentView.bind(view.bindingContext, view.overrideContext);
    }
  };

  ShadowSlot.prototype.attached = function attached() {
    if (this.contentView) {
      this.contentView.attached();
    }
  };

  ShadowSlot.prototype.detached = function detached() {
    if (this.contentView) {
      this.contentView.detached();
    }
  };

  ShadowSlot.prototype.unbind = function unbind() {
    if (this.contentView) {
      this.contentView.unbind();
    }
  };

  _createClass(ShadowSlot, [{
    key: 'needsFallbackRendering',
    get: function get() {
      return this.fallbackFactory && this.projections === 0;
    }
  }]);

  return ShadowSlot;
}();

var ShadowDOM = exports.ShadowDOM = (_temp3 = _class12 = function () {
  function ShadowDOM() {
    
  }

  ShadowDOM.getSlotName = function getSlotName(node) {
    if (node.auSlotAttribute === undefined) {
      return ShadowDOM.defaultSlotKey;
    }

    return node.auSlotAttribute.value;
  };

  ShadowDOM.distributeView = function distributeView(view, slots, projectionSource, index, destinationOverride) {
    var nodes = void 0;

    if (view === null) {
      nodes = noNodes;
    } else {
      var childNodes = view.fragment.childNodes;
      var ii = childNodes.length;
      nodes = new Array(ii);

      for (var i = 0; i < ii; ++i) {
        nodes[i] = childNodes[i];
      }
    }

    ShadowDOM.distributeNodes(view, nodes, slots, projectionSource, index, destinationOverride);
  };

  ShadowDOM.undistributeView = function undistributeView(view, slots, projectionSource) {
    for (var slotName in slots) {
      slots[slotName].removeView(view, projectionSource);
    }
  };

  ShadowDOM.undistributeAll = function undistributeAll(slots, projectionSource) {
    for (var slotName in slots) {
      slots[slotName].removeAll(projectionSource);
    }
  };

  ShadowDOM.distributeNodes = function distributeNodes(view, nodes, slots, projectionSource, index, destinationOverride) {
    for (var i = 0, ii = nodes.length; i < ii; ++i) {
      var currentNode = nodes[i];
      var nodeType = currentNode.nodeType;

      if (currentNode.isContentProjectionSource) {
        currentNode.viewSlot.projectTo(slots);

        for (var slotName in slots) {
          slots[slotName].projectFrom(view, currentNode.viewSlot);
        }

        nodes.splice(i, 1);
        ii--;i--;
      } else if (nodeType === 1 || nodeType === 3 || currentNode.viewSlot instanceof PassThroughSlot) {
        if (nodeType === 3 && _isAllWhitespace(currentNode)) {
          nodes.splice(i, 1);
          ii--;i--;
        } else {
          var found = slots[destinationOverride || ShadowDOM.getSlotName(currentNode)];

          if (found) {
            found.addNode(view, currentNode, projectionSource, index);
            nodes.splice(i, 1);
            ii--;i--;
          }
        }
      } else {
        nodes.splice(i, 1);
        ii--;i--;
      }
    }

    for (var _slotName in slots) {
      var slot = slots[_slotName];

      if (slot.needsFallbackRendering) {
        slot.renderFallbackContent(view, nodes, projectionSource, index);
      }
    }
  };

  return ShadowDOM;
}(), _class12.defaultSlotKey = '__au-default-slot-key__', _temp3);


function register(lookup, name, resource, type) {
  if (!name) {
    return;
  }

  var existing = lookup[name];
  if (existing) {
    if (existing !== resource) {
      throw new Error('Attempted to register ' + type + ' when one with the same name already exists. Name: ' + name + '.');
    }

    return;
  }

  lookup[name] = resource;
}

var ViewResources = exports.ViewResources = function () {
  function ViewResources(parent, viewUrl) {
    

    this.bindingLanguage = null;

    this.parent = parent || null;
    this.hasParent = this.parent !== null;
    this.viewUrl = viewUrl || '';
    this.lookupFunctions = {
      valueConverters: this.getValueConverter.bind(this),
      bindingBehaviors: this.getBindingBehavior.bind(this)
    };
    this.attributes = Object.create(null);
    this.elements = Object.create(null);
    this.valueConverters = Object.create(null);
    this.bindingBehaviors = Object.create(null);
    this.attributeMap = Object.create(null);
    this.values = Object.create(null);
    this.beforeCompile = this.afterCompile = this.beforeCreate = this.afterCreate = this.beforeBind = this.beforeUnbind = false;
  }

  ViewResources.prototype._tryAddHook = function _tryAddHook(obj, name) {
    if (typeof obj[name] === 'function') {
      var func = obj[name].bind(obj);
      var counter = 1;
      var callbackName = void 0;

      while (this[callbackName = name + counter.toString()] !== undefined) {
        counter++;
      }

      this[name] = true;
      this[callbackName] = func;
    }
  };

  ViewResources.prototype._invokeHook = function _invokeHook(name, one, two, three, four) {
    if (this.hasParent) {
      this.parent._invokeHook(name, one, two, three, four);
    }

    if (this[name]) {
      this[name + '1'](one, two, three, four);

      var callbackName = name + '2';
      if (this[callbackName]) {
        this[callbackName](one, two, three, four);

        callbackName = name + '3';
        if (this[callbackName]) {
          this[callbackName](one, two, three, four);

          var counter = 4;

          while (this[callbackName = name + counter.toString()] !== undefined) {
            this[callbackName](one, two, three, four);
            counter++;
          }
        }
      }
    }
  };

  ViewResources.prototype.registerViewEngineHooks = function registerViewEngineHooks(hooks) {
    this._tryAddHook(hooks, 'beforeCompile');
    this._tryAddHook(hooks, 'afterCompile');
    this._tryAddHook(hooks, 'beforeCreate');
    this._tryAddHook(hooks, 'afterCreate');
    this._tryAddHook(hooks, 'beforeBind');
    this._tryAddHook(hooks, 'beforeUnbind');
  };

  ViewResources.prototype.getBindingLanguage = function getBindingLanguage(bindingLanguageFallback) {
    return this.bindingLanguage || (this.bindingLanguage = bindingLanguageFallback);
  };

  ViewResources.prototype.patchInParent = function patchInParent(newParent) {
    var originalParent = this.parent;

    this.parent = newParent || null;
    this.hasParent = this.parent !== null;

    if (newParent.parent === null) {
      newParent.parent = originalParent;
      newParent.hasParent = originalParent !== null;
    }
  };

  ViewResources.prototype.relativeToView = function relativeToView(path) {
    return (0, _aureliaPath.relativeToFile)(path, this.viewUrl);
  };

  ViewResources.prototype.registerElement = function registerElement(tagName, behavior) {
    register(this.elements, tagName, behavior, 'an Element');
  };

  ViewResources.prototype.getElement = function getElement(tagName) {
    return this.elements[tagName] || (this.hasParent ? this.parent.getElement(tagName) : null);
  };

  ViewResources.prototype.mapAttribute = function mapAttribute(attribute) {
    return this.attributeMap[attribute] || (this.hasParent ? this.parent.mapAttribute(attribute) : null);
  };

  ViewResources.prototype.registerAttribute = function registerAttribute(attribute, behavior, knownAttribute) {
    this.attributeMap[attribute] = knownAttribute;
    register(this.attributes, attribute, behavior, 'an Attribute');
  };

  ViewResources.prototype.getAttribute = function getAttribute(attribute) {
    return this.attributes[attribute] || (this.hasParent ? this.parent.getAttribute(attribute) : null);
  };

  ViewResources.prototype.registerValueConverter = function registerValueConverter(name, valueConverter) {
    register(this.valueConverters, name, valueConverter, 'a ValueConverter');
  };

  ViewResources.prototype.getValueConverter = function getValueConverter(name) {
    return this.valueConverters[name] || (this.hasParent ? this.parent.getValueConverter(name) : null);
  };

  ViewResources.prototype.registerBindingBehavior = function registerBindingBehavior(name, bindingBehavior) {
    register(this.bindingBehaviors, name, bindingBehavior, 'a BindingBehavior');
  };

  ViewResources.prototype.getBindingBehavior = function getBindingBehavior(name) {
    return this.bindingBehaviors[name] || (this.hasParent ? this.parent.getBindingBehavior(name) : null);
  };

  ViewResources.prototype.registerValue = function registerValue(name, value) {
    register(this.values, name, value, 'a value');
  };

  ViewResources.prototype.getValue = function getValue(name) {
    return this.values[name] || (this.hasParent ? this.parent.getValue(name) : null);
  };

  return ViewResources;
}();

var View = exports.View = function () {
  function View(container, viewFactory, fragment, controllers, bindings, children, slots) {
    

    this.container = container;
    this.viewFactory = viewFactory;
    this.resources = viewFactory.resources;
    this.fragment = fragment;
    this.firstChild = fragment.firstChild;
    this.lastChild = fragment.lastChild;
    this.controllers = controllers;
    this.bindings = bindings;
    this.children = children;
    this.slots = slots;
    this.hasSlots = false;
    this.fromCache = false;
    this.isBound = false;
    this.isAttached = false;
    this.bindingContext = null;
    this.overrideContext = null;
    this.controller = null;
    this.viewModelScope = null;
    this.animatableElement = undefined;
    this._isUserControlled = false;
    this.contentView = null;

    for (var key in slots) {
      this.hasSlots = true;
      break;
    }
  }

  View.prototype.returnToCache = function returnToCache() {
    this.viewFactory.returnViewToCache(this);
  };

  View.prototype.created = function created() {
    var i = void 0;
    var ii = void 0;
    var controllers = this.controllers;

    for (i = 0, ii = controllers.length; i < ii; ++i) {
      controllers[i].created(this);
    }
  };

  View.prototype.bind = function bind(bindingContext, overrideContext, _systemUpdate) {
    var controllers = void 0;
    var bindings = void 0;
    var children = void 0;
    var i = void 0;
    var ii = void 0;

    if (_systemUpdate && this._isUserControlled) {
      return;
    }

    if (this.isBound) {
      if (this.bindingContext === bindingContext) {
        return;
      }

      this.unbind();
    }

    this.isBound = true;
    this.bindingContext = bindingContext;
    this.overrideContext = overrideContext || (0, _aureliaBinding.createOverrideContext)(bindingContext);

    this.resources._invokeHook('beforeBind', this);

    bindings = this.bindings;
    for (i = 0, ii = bindings.length; i < ii; ++i) {
      bindings[i].bind(this);
    }

    if (this.viewModelScope !== null) {
      bindingContext.bind(this.viewModelScope.bindingContext, this.viewModelScope.overrideContext);
      this.viewModelScope = null;
    }

    controllers = this.controllers;
    for (i = 0, ii = controllers.length; i < ii; ++i) {
      controllers[i].bind(this);
    }

    children = this.children;
    for (i = 0, ii = children.length; i < ii; ++i) {
      children[i].bind(bindingContext, overrideContext, true);
    }

    if (this.hasSlots) {
      ShadowDOM.distributeView(this.contentView, this.slots);
    }
  };

  View.prototype.addBinding = function addBinding(binding) {
    this.bindings.push(binding);

    if (this.isBound) {
      binding.bind(this);
    }
  };

  View.prototype.unbind = function unbind() {
    var controllers = void 0;
    var bindings = void 0;
    var children = void 0;
    var i = void 0;
    var ii = void 0;

    if (this.isBound) {
      this.isBound = false;
      this.resources._invokeHook('beforeUnbind', this);

      if (this.controller !== null) {
        this.controller.unbind();
      }

      bindings = this.bindings;
      for (i = 0, ii = bindings.length; i < ii; ++i) {
        bindings[i].unbind();
      }

      controllers = this.controllers;
      for (i = 0, ii = controllers.length; i < ii; ++i) {
        controllers[i].unbind();
      }

      children = this.children;
      for (i = 0, ii = children.length; i < ii; ++i) {
        children[i].unbind();
      }

      this.bindingContext = null;
      this.overrideContext = null;
    }
  };

  View.prototype.insertNodesBefore = function insertNodesBefore(refNode) {
    refNode.parentNode.insertBefore(this.fragment, refNode);
  };

  View.prototype.appendNodesTo = function appendNodesTo(parent) {
    parent.appendChild(this.fragment);
  };

  View.prototype.removeNodes = function removeNodes() {
    var fragment = this.fragment;
    var current = this.firstChild;
    var end = this.lastChild;
    var next = void 0;

    while (current) {
      next = current.nextSibling;
      fragment.appendChild(current);

      if (current === end) {
        break;
      }

      current = next;
    }
  };

  View.prototype.attached = function attached() {
    var controllers = void 0;
    var children = void 0;
    var i = void 0;
    var ii = void 0;

    if (this.isAttached) {
      return;
    }

    this.isAttached = true;

    if (this.controller !== null) {
      this.controller.attached();
    }

    controllers = this.controllers;
    for (i = 0, ii = controllers.length; i < ii; ++i) {
      controllers[i].attached();
    }

    children = this.children;
    for (i = 0, ii = children.length; i < ii; ++i) {
      children[i].attached();
    }
  };

  View.prototype.detached = function detached() {
    var controllers = void 0;
    var children = void 0;
    var i = void 0;
    var ii = void 0;

    if (this.isAttached) {
      this.isAttached = false;

      if (this.controller !== null) {
        this.controller.detached();
      }

      controllers = this.controllers;
      for (i = 0, ii = controllers.length; i < ii; ++i) {
        controllers[i].detached();
      }

      children = this.children;
      for (i = 0, ii = children.length; i < ii; ++i) {
        children[i].detached();
      }
    }
  };

  return View;
}();

function getAnimatableElement(view) {
  if (view.animatableElement !== undefined) {
    return view.animatableElement;
  }

  var current = view.firstChild;

  while (current && current.nodeType !== 1) {
    current = current.nextSibling;
  }

  if (current && current.nodeType === 1) {
    return view.animatableElement = current.classList.contains('au-animate') ? current : null;
  }

  return view.animatableElement = null;
}

var ViewSlot = exports.ViewSlot = function () {
  function ViewSlot(anchor, anchorIsContainer) {
    var animator = arguments.length <= 2 || arguments[2] === undefined ? Animator.instance : arguments[2];

    

    this.anchor = anchor;
    this.anchorIsContainer = anchorIsContainer;
    this.bindingContext = null;
    this.overrideContext = null;
    this.animator = animator;
    this.children = [];
    this.isBound = false;
    this.isAttached = false;
    this.contentSelectors = null;
    anchor.viewSlot = this;
    anchor.isContentProjectionSource = false;
  }

  ViewSlot.prototype.animateView = function animateView(view) {
    var direction = arguments.length <= 1 || arguments[1] === undefined ? 'enter' : arguments[1];

    var animatableElement = getAnimatableElement(view);

    if (animatableElement !== null) {
      switch (direction) {
        case 'enter':
          return this.animator.enter(animatableElement);
        case 'leave':
          return this.animator.leave(animatableElement);
        default:
          throw new Error('Invalid animation direction: ' + direction);
      }
    }
  };

  ViewSlot.prototype.transformChildNodesIntoView = function transformChildNodesIntoView() {
    var parent = this.anchor;

    this.children.push({
      fragment: parent,
      firstChild: parent.firstChild,
      lastChild: parent.lastChild,
      returnToCache: function returnToCache() {},
      removeNodes: function removeNodes() {
        var last = void 0;

        while (last = parent.lastChild) {
          parent.removeChild(last);
        }
      },
      created: function created() {},
      bind: function bind() {},
      unbind: function unbind() {},
      attached: function attached() {},
      detached: function detached() {}
    });
  };

  ViewSlot.prototype.bind = function bind(bindingContext, overrideContext) {
    var i = void 0;
    var ii = void 0;
    var children = void 0;

    if (this.isBound) {
      if (this.bindingContext === bindingContext) {
        return;
      }

      this.unbind();
    }

    this.isBound = true;
    this.bindingContext = bindingContext = bindingContext || this.bindingContext;
    this.overrideContext = overrideContext = overrideContext || this.overrideContext;

    children = this.children;
    for (i = 0, ii = children.length; i < ii; ++i) {
      children[i].bind(bindingContext, overrideContext, true);
    }
  };

  ViewSlot.prototype.unbind = function unbind() {
    if (this.isBound) {
      var i = void 0;
      var ii = void 0;
      var _children4 = this.children;

      this.isBound = false;
      this.bindingContext = null;
      this.overrideContext = null;

      for (i = 0, ii = _children4.length; i < ii; ++i) {
        _children4[i].unbind();
      }
    }
  };

  ViewSlot.prototype.add = function add(view) {
    if (this.anchorIsContainer) {
      view.appendNodesTo(this.anchor);
    } else {
      view.insertNodesBefore(this.anchor);
    }

    this.children.push(view);

    if (this.isAttached) {
      view.attached();
      return this.animateView(view, 'enter');
    }
  };

  ViewSlot.prototype.insert = function insert(index, view) {
    var children = this.children;
    var length = children.length;

    if (index === 0 && length === 0 || index >= length) {
      return this.add(view);
    }

    view.insertNodesBefore(children[index].firstChild);
    children.splice(index, 0, view);

    if (this.isAttached) {
      view.attached();
      return this.animateView(view, 'enter');
    }
  };

  ViewSlot.prototype.move = function move(sourceIndex, targetIndex) {
    if (sourceIndex === targetIndex) {
      return;
    }

    var children = this.children;
    var view = children[sourceIndex];

    view.removeNodes();
    view.insertNodesBefore(children[targetIndex].firstChild);
    children.splice(sourceIndex, 1);
    children.splice(targetIndex, 0, view);
  };

  ViewSlot.prototype.remove = function remove(view, returnToCache, skipAnimation) {
    return this.removeAt(this.children.indexOf(view), returnToCache, skipAnimation);
  };

  ViewSlot.prototype.removeMany = function removeMany(viewsToRemove, returnToCache, skipAnimation) {
    var _this4 = this;

    var children = this.children;
    var ii = viewsToRemove.length;
    var i = void 0;
    var rmPromises = [];

    viewsToRemove.forEach(function (child) {
      if (skipAnimation) {
        child.removeNodes();
        return;
      }

      var animation = _this4.animateView(child, 'leave');
      if (animation) {
        rmPromises.push(animation.then(function () {
          return child.removeNodes();
        }));
      } else {
        child.removeNodes();
      }
    });

    var removeAction = function removeAction() {
      if (_this4.isAttached) {
        for (i = 0; i < ii; ++i) {
          viewsToRemove[i].detached();
        }
      }

      if (returnToCache) {
        for (i = 0; i < ii; ++i) {
          viewsToRemove[i].returnToCache();
        }
      }

      for (i = 0; i < ii; ++i) {
        var index = children.indexOf(viewsToRemove[i]);
        if (index >= 0) {
          children.splice(index, 1);
        }
      }
    };

    if (rmPromises.length > 0) {
      return Promise.all(rmPromises).then(function () {
        return removeAction();
      });
    }

    return removeAction();
  };

  ViewSlot.prototype.removeAt = function removeAt(index, returnToCache, skipAnimation) {
    var _this5 = this;

    var view = this.children[index];

    var removeAction = function removeAction() {
      index = _this5.children.indexOf(view);
      view.removeNodes();
      _this5.children.splice(index, 1);

      if (_this5.isAttached) {
        view.detached();
      }

      if (returnToCache) {
        view.returnToCache();
      }

      return view;
    };

    if (!skipAnimation) {
      var animation = this.animateView(view, 'leave');
      if (animation) {
        return animation.then(function () {
          return removeAction();
        });
      }
    }

    return removeAction();
  };

  ViewSlot.prototype.removeAll = function removeAll(returnToCache, skipAnimation) {
    var _this6 = this;

    var children = this.children;
    var ii = children.length;
    var i = void 0;
    var rmPromises = [];

    children.forEach(function (child) {
      if (skipAnimation) {
        child.removeNodes();
        return;
      }

      var animation = _this6.animateView(child, 'leave');
      if (animation) {
        rmPromises.push(animation.then(function () {
          return child.removeNodes();
        }));
      } else {
        child.removeNodes();
      }
    });

    var removeAction = function removeAction() {
      if (_this6.isAttached) {
        for (i = 0; i < ii; ++i) {
          children[i].detached();
        }
      }

      if (returnToCache) {
        for (i = 0; i < ii; ++i) {
          children[i].returnToCache();
        }
      }

      _this6.children = [];
    };

    if (rmPromises.length > 0) {
      return Promise.all(rmPromises).then(function () {
        return removeAction();
      });
    }

    return removeAction();
  };

  ViewSlot.prototype.attached = function attached() {
    var i = void 0;
    var ii = void 0;
    var children = void 0;
    var child = void 0;

    if (this.isAttached) {
      return;
    }

    this.isAttached = true;

    children = this.children;
    for (i = 0, ii = children.length; i < ii; ++i) {
      child = children[i];
      child.attached();
      this.animateView(child, 'enter');
    }
  };

  ViewSlot.prototype.detached = function detached() {
    var i = void 0;
    var ii = void 0;
    var children = void 0;

    if (this.isAttached) {
      this.isAttached = false;
      children = this.children;
      for (i = 0, ii = children.length; i < ii; ++i) {
        children[i].detached();
      }
    }
  };

  ViewSlot.prototype.projectTo = function projectTo(slots) {
    var _this7 = this;

    this.projectToSlots = slots;
    this.add = this._projectionAdd;
    this.insert = this._projectionInsert;
    this.move = this._projectionMove;
    this.remove = this._projectionRemove;
    this.removeAt = this._projectionRemoveAt;
    this.removeMany = this._projectionRemoveMany;
    this.removeAll = this._projectionRemoveAll;
    this.children.forEach(function (view) {
      return ShadowDOM.distributeView(view, slots, _this7);
    });
  };

  ViewSlot.prototype._projectionAdd = function _projectionAdd(view) {
    ShadowDOM.distributeView(view, this.projectToSlots, this);

    this.children.push(view);

    if (this.isAttached) {
      view.attached();
    }
  };

  ViewSlot.prototype._projectionInsert = function _projectionInsert(index, view) {
    if (index === 0 && !this.children.length || index >= this.children.length) {
      this.add(view);
    } else {
      ShadowDOM.distributeView(view, this.projectToSlots, this, index);

      this.children.splice(index, 0, view);

      if (this.isAttached) {
        view.attached();
      }
    }
  };

  ViewSlot.prototype._projectionMove = function _projectionMove(sourceIndex, targetIndex) {
    if (sourceIndex === targetIndex) {
      return;
    }

    var children = this.children;
    var view = children[sourceIndex];

    ShadowDOM.undistributeView(view, this.projectToSlots, this);
    ShadowDOM.distributeView(view, this.projectToSlots, this, targetIndex);

    children.splice(sourceIndex, 1);
    children.splice(targetIndex, 0, view);
  };

  ViewSlot.prototype._projectionRemove = function _projectionRemove(view, returnToCache) {
    ShadowDOM.undistributeView(view, this.projectToSlots, this);
    this.children.splice(this.children.indexOf(view), 1);

    if (this.isAttached) {
      view.detached();
    }
  };

  ViewSlot.prototype._projectionRemoveAt = function _projectionRemoveAt(index, returnToCache) {
    var view = this.children[index];

    ShadowDOM.undistributeView(view, this.projectToSlots, this);
    this.children.splice(index, 1);

    if (this.isAttached) {
      view.detached();
    }
  };

  ViewSlot.prototype._projectionRemoveMany = function _projectionRemoveMany(viewsToRemove, returnToCache) {
    var _this8 = this;

    viewsToRemove.forEach(function (view) {
      return _this8.remove(view, returnToCache);
    });
  };

  ViewSlot.prototype._projectionRemoveAll = function _projectionRemoveAll(returnToCache) {
    ShadowDOM.undistributeAll(this.projectToSlots, this);

    var children = this.children;

    if (this.isAttached) {
      for (var i = 0, ii = children.length; i < ii; ++i) {
        children[i].detached();
      }
    }

    this.children = [];
  };

  return ViewSlot;
}();

var ProviderResolver = (0, _aureliaDependencyInjection.resolver)(_class15 = function () {
  function ProviderResolver() {
    
  }

  ProviderResolver.prototype.get = function get(container, key) {
    var id = key.__providerId__;
    return id in container ? container[id] : container[id] = container.invoke(key);
  };

  return ProviderResolver;
}()) || _class15;

var providerResolverInstance = new ProviderResolver();

function elementContainerGet(key) {
  if (key === _aureliaPal.DOM.Element) {
    return this.element;
  }

  if (key === BoundViewFactory) {
    if (this.boundViewFactory) {
      return this.boundViewFactory;
    }

    var factory = this.instruction.viewFactory;
    var _partReplacements = this.partReplacements;

    if (_partReplacements) {
      factory = _partReplacements[factory.part] || factory;
    }

    this.boundViewFactory = new BoundViewFactory(this, factory, _partReplacements);
    return this.boundViewFactory;
  }

  if (key === ViewSlot) {
    if (this.viewSlot === undefined) {
      this.viewSlot = new ViewSlot(this.element, this.instruction.anchorIsContainer);
      this.element.isContentProjectionSource = this.instruction.lifting;
      this.children.push(this.viewSlot);
    }

    return this.viewSlot;
  }

  if (key === ElementEvents) {
    return this.elementEvents || (this.elementEvents = new ElementEvents(this.element));
  }

  if (key === CompositionTransaction) {
    return this.compositionTransaction || (this.compositionTransaction = this.parent.get(key));
  }

  if (key === ViewResources) {
    return this.viewResources;
  }

  if (key === TargetInstruction) {
    return this.instruction;
  }

  return this.superGet(key);
}

function createElementContainer(parent, element, instruction, children, partReplacements, resources) {
  var container = parent.createChild();
  var providers = void 0;
  var i = void 0;

  container.element = element;
  container.instruction = instruction;
  container.children = children;
  container.viewResources = resources;
  container.partReplacements = partReplacements;

  providers = instruction.providers;
  i = providers.length;

  while (i--) {
    container._resolvers.set(providers[i], providerResolverInstance);
  }

  container.superGet = container.get;
  container.get = elementContainerGet;

  return container;
}

function makeElementIntoAnchor(element, elementInstruction) {
  var anchor = _aureliaPal.DOM.createComment('anchor');

  if (elementInstruction) {
    var firstChild = element.firstChild;

    if (firstChild && firstChild.tagName === 'AU-CONTENT') {
      anchor.contentElement = firstChild;
    }

    anchor.hasAttribute = function (name) {
      return element.hasAttribute(name);
    };
    anchor.getAttribute = function (name) {
      return element.getAttribute(name);
    };
    anchor.setAttribute = function (name, value) {
      element.setAttribute(name, value);
    };
  }

  _aureliaPal.DOM.replaceNode(anchor, element);

  return anchor;
}

function applyInstructions(containers, element, instruction, controllers, bindings, children, shadowSlots, partReplacements, resources) {
  var behaviorInstructions = instruction.behaviorInstructions;
  var expressions = instruction.expressions;
  var elementContainer = void 0;
  var i = void 0;
  var ii = void 0;
  var current = void 0;
  var instance = void 0;

  if (instruction.contentExpression) {
    bindings.push(instruction.contentExpression.createBinding(element.nextSibling));
    element.nextSibling.auInterpolationTarget = true;
    element.parentNode.removeChild(element);
    return;
  }

  if (instruction.shadowSlot) {
    var commentAnchor = _aureliaPal.DOM.createComment('slot');
    var slot = void 0;

    if (instruction.slotDestination) {
      slot = new PassThroughSlot(commentAnchor, instruction.slotName, instruction.slotDestination, instruction.slotFallbackFactory);
    } else {
      slot = new ShadowSlot(commentAnchor, instruction.slotName, instruction.slotFallbackFactory);
    }

    _aureliaPal.DOM.replaceNode(commentAnchor, element);
    shadowSlots[instruction.slotName] = slot;
    controllers.push(slot);
    return;
  }

  if (behaviorInstructions.length) {
    if (!instruction.anchorIsContainer) {
      element = makeElementIntoAnchor(element, instruction.elementInstruction);
    }

    containers[instruction.injectorId] = elementContainer = createElementContainer(containers[instruction.parentInjectorId], element, instruction, children, partReplacements, resources);

    for (i = 0, ii = behaviorInstructions.length; i < ii; ++i) {
      current = behaviorInstructions[i];
      instance = current.type.create(elementContainer, current, element, bindings);
      controllers.push(instance);
    }
  }

  for (i = 0, ii = expressions.length; i < ii; ++i) {
    bindings.push(expressions[i].createBinding(element));
  }
}

function styleStringToObject(style, target) {
  var attributes = style.split(';');
  var firstIndexOfColon = void 0;
  var i = void 0;
  var current = void 0;
  var key = void 0;
  var value = void 0;

  target = target || {};

  for (i = 0; i < attributes.length; i++) {
    current = attributes[i];
    firstIndexOfColon = current.indexOf(':');
    key = current.substring(0, firstIndexOfColon).trim();
    value = current.substring(firstIndexOfColon + 1).trim();
    target[key] = value;
  }

  return target;
}

function styleObjectToString(obj) {
  var result = '';

  for (var key in obj) {
    result += key + ':' + obj[key] + ';';
  }

  return result;
}

function applySurrogateInstruction(container, element, instruction, controllers, bindings, children) {
  var behaviorInstructions = instruction.behaviorInstructions;
  var expressions = instruction.expressions;
  var providers = instruction.providers;
  var values = instruction.values;
  var i = void 0;
  var ii = void 0;
  var current = void 0;
  var instance = void 0;
  var currentAttributeValue = void 0;

  i = providers.length;
  while (i--) {
    container._resolvers.set(providers[i], providerResolverInstance);
  }

  for (var key in values) {
    currentAttributeValue = element.getAttribute(key);

    if (currentAttributeValue) {
      if (key === 'class') {
        element.setAttribute('class', currentAttributeValue + ' ' + values[key]);
      } else if (key === 'style') {
        var styleObject = styleStringToObject(values[key]);
        styleStringToObject(currentAttributeValue, styleObject);
        element.setAttribute('style', styleObjectToString(styleObject));
      }
    } else {
        element.setAttribute(key, values[key]);
      }
  }

  if (behaviorInstructions.length) {
    for (i = 0, ii = behaviorInstructions.length; i < ii; ++i) {
      current = behaviorInstructions[i];
      instance = current.type.create(container, current, element, bindings);

      if (instance.contentView) {
        children.push(instance.contentView);
      }

      controllers.push(instance);
    }
  }

  for (i = 0, ii = expressions.length; i < ii; ++i) {
    bindings.push(expressions[i].createBinding(element));
  }
}

var BoundViewFactory = exports.BoundViewFactory = function () {
  function BoundViewFactory(parentContainer, viewFactory, partReplacements) {
    

    this.parentContainer = parentContainer;
    this.viewFactory = viewFactory;
    this.factoryCreateInstruction = { partReplacements: partReplacements };
  }

  BoundViewFactory.prototype.create = function create() {
    var view = this.viewFactory.create(this.parentContainer.createChild(), this.factoryCreateInstruction);
    view._isUserControlled = true;
    return view;
  };

  BoundViewFactory.prototype.setCacheSize = function setCacheSize(size, doNotOverrideIfAlreadySet) {
    this.viewFactory.setCacheSize(size, doNotOverrideIfAlreadySet);
  };

  BoundViewFactory.prototype.getCachedView = function getCachedView() {
    return this.viewFactory.getCachedView();
  };

  BoundViewFactory.prototype.returnViewToCache = function returnViewToCache(view) {
    this.viewFactory.returnViewToCache(view);
  };

  _createClass(BoundViewFactory, [{
    key: 'isCaching',
    get: function get() {
      return this.viewFactory.isCaching;
    }
  }]);

  return BoundViewFactory;
}();

var ViewFactory = exports.ViewFactory = function () {
  function ViewFactory(template, instructions, resources) {
    

    this.isCaching = false;

    this.template = template;
    this.instructions = instructions;
    this.resources = resources;
    this.cacheSize = -1;
    this.cache = null;
  }

  ViewFactory.prototype.setCacheSize = function setCacheSize(size, doNotOverrideIfAlreadySet) {
    if (size) {
      if (size === '*') {
        size = Number.MAX_VALUE;
      } else if (typeof size === 'string') {
        size = parseInt(size, 10);
      }
    }

    if (this.cacheSize === -1 || !doNotOverrideIfAlreadySet) {
      this.cacheSize = size;
    }

    if (this.cacheSize > 0) {
      this.cache = [];
    } else {
      this.cache = null;
    }

    this.isCaching = this.cacheSize > 0;
  };

  ViewFactory.prototype.getCachedView = function getCachedView() {
    return this.cache !== null ? this.cache.pop() || null : null;
  };

  ViewFactory.prototype.returnViewToCache = function returnViewToCache(view) {
    if (view.isAttached) {
      view.detached();
    }

    if (view.isBound) {
      view.unbind();
    }

    if (this.cache !== null && this.cache.length < this.cacheSize) {
      view.fromCache = true;
      this.cache.push(view);
    }
  };

  ViewFactory.prototype.create = function create(container, createInstruction, element) {
    createInstruction = createInstruction || BehaviorInstruction.normal;

    var cachedView = this.getCachedView();
    if (cachedView !== null) {
      return cachedView;
    }

    var fragment = createInstruction.enhance ? this.template : this.template.cloneNode(true);
    var instructables = fragment.querySelectorAll('.au-target');
    var instructions = this.instructions;
    var resources = this.resources;
    var controllers = [];
    var bindings = [];
    var children = [];
    var shadowSlots = Object.create(null);
    var containers = { root: container };
    var partReplacements = createInstruction.partReplacements;
    var i = void 0;
    var ii = void 0;
    var view = void 0;
    var instructable = void 0;
    var instruction = void 0;

    this.resources._invokeHook('beforeCreate', this, container, fragment, createInstruction);

    if (element && this.surrogateInstruction !== null) {
      applySurrogateInstruction(container, element, this.surrogateInstruction, controllers, bindings, children);
    }

    if (createInstruction.enhance && fragment.hasAttribute('au-target-id')) {
      instructable = fragment;
      instruction = instructions[instructable.getAttribute('au-target-id')];
      applyInstructions(containers, instructable, instruction, controllers, bindings, children, shadowSlots, partReplacements, resources);
    }

    for (i = 0, ii = instructables.length; i < ii; ++i) {
      instructable = instructables[i];
      instruction = instructions[instructable.getAttribute('au-target-id')];
      applyInstructions(containers, instructable, instruction, controllers, bindings, children, shadowSlots, partReplacements, resources);
    }

    view = new View(container, this, fragment, controllers, bindings, children, shadowSlots);

    if (!createInstruction.initiatedByBehavior) {
      view.created();
    }

    this.resources._invokeHook('afterCreate', view);

    return view;
  };

  return ViewFactory;
}();

var nextInjectorId = 0;
function getNextInjectorId() {
  return ++nextInjectorId;
}

function configureProperties(instruction, resources) {
  var type = instruction.type;
  var attrName = instruction.attrName;
  var attributes = instruction.attributes;
  var property = void 0;
  var key = void 0;
  var value = void 0;

  var knownAttribute = resources.mapAttribute(attrName);
  if (knownAttribute && attrName in attributes && knownAttribute !== attrName) {
    attributes[knownAttribute] = attributes[attrName];
    delete attributes[attrName];
  }

  for (key in attributes) {
    value = attributes[key];

    if (value !== null && (typeof value === 'undefined' ? 'undefined' : _typeof(value)) === 'object') {
      property = type.attributes[key];

      if (property !== undefined) {
        value.targetProperty = property.name;
      } else {
        value.targetProperty = key;
      }
    }
  }
}

var lastAUTargetID = 0;
function getNextAUTargetID() {
  return (++lastAUTargetID).toString();
}

function makeIntoInstructionTarget(element) {
  var value = element.getAttribute('class');
  var auTargetID = getNextAUTargetID();

  element.setAttribute('class', value ? value += ' au-target' : 'au-target');
  element.setAttribute('au-target-id', auTargetID);

  return auTargetID;
}

function makeShadowSlot(compiler, resources, node, instructions, parentInjectorId) {
  var auShadowSlot = _aureliaPal.DOM.createElement('au-shadow-slot');
  _aureliaPal.DOM.replaceNode(auShadowSlot, node);

  var auTargetID = makeIntoInstructionTarget(auShadowSlot);
  var instruction = TargetInstruction.shadowSlot(parentInjectorId);

  instruction.slotName = node.getAttribute('name') || ShadowDOM.defaultSlotKey;
  instruction.slotDestination = node.getAttribute('slot');

  if (node.innerHTML.trim()) {
    var fragment = _aureliaPal.DOM.createDocumentFragment();
    var _child3 = void 0;

    while (_child3 = node.firstChild) {
      fragment.appendChild(_child3);
    }

    instruction.slotFallbackFactory = compiler.compile(fragment, resources);
  }

  instructions[auTargetID] = instruction;

  return auShadowSlot;
}

var ViewCompiler = exports.ViewCompiler = (_dec7 = (0, _aureliaDependencyInjection.inject)(BindingLanguage, ViewResources), _dec7(_class17 = function () {
  function ViewCompiler(bindingLanguage, resources) {
    

    this.bindingLanguage = bindingLanguage;
    this.resources = resources;
  }

  ViewCompiler.prototype.compile = function compile(source, resources, compileInstruction) {
    resources = resources || this.resources;
    compileInstruction = compileInstruction || ViewCompileInstruction.normal;
    source = typeof source === 'string' ? _aureliaPal.DOM.createTemplateFromMarkup(source) : source;

    var content = void 0;
    var part = void 0;
    var cacheSize = void 0;

    if (source.content) {
      part = source.getAttribute('part');
      cacheSize = source.getAttribute('view-cache');
      content = _aureliaPal.DOM.adoptNode(source.content);
    } else {
      content = source;
    }

    compileInstruction.targetShadowDOM = compileInstruction.targetShadowDOM && _aureliaPal.FEATURE.shadowDOM;
    resources._invokeHook('beforeCompile', content, resources, compileInstruction);

    var instructions = {};
    this._compileNode(content, resources, instructions, source, 'root', !compileInstruction.targetShadowDOM);

    var firstChild = content.firstChild;
    if (firstChild && firstChild.nodeType === 1) {
      var targetId = firstChild.getAttribute('au-target-id');
      if (targetId) {
        var ins = instructions[targetId];

        if (ins.shadowSlot || ins.lifting) {
          content.insertBefore(_aureliaPal.DOM.createComment('view'), firstChild);
        }
      }
    }

    var factory = new ViewFactory(content, instructions, resources);

    factory.surrogateInstruction = compileInstruction.compileSurrogate ? this._compileSurrogate(source, resources) : null;
    factory.part = part;

    if (cacheSize) {
      factory.setCacheSize(cacheSize);
    }

    resources._invokeHook('afterCompile', factory);

    return factory;
  };

  ViewCompiler.prototype._compileNode = function _compileNode(node, resources, instructions, parentNode, parentInjectorId, targetLightDOM) {
    switch (node.nodeType) {
      case 1:
        return this._compileElement(node, resources, instructions, parentNode, parentInjectorId, targetLightDOM);
      case 3:
        var expression = resources.getBindingLanguage(this.bindingLanguage).inspectTextContent(resources, node.wholeText);
        if (expression) {
          var marker = _aureliaPal.DOM.createElement('au-marker');
          var auTargetID = makeIntoInstructionTarget(marker);
          (node.parentNode || parentNode).insertBefore(marker, node);
          node.textContent = ' ';
          instructions[auTargetID] = TargetInstruction.contentExpression(expression);

          while (node.nextSibling && node.nextSibling.nodeType === 3) {
            (node.parentNode || parentNode).removeChild(node.nextSibling);
          }
        } else {
          while (node.nextSibling && node.nextSibling.nodeType === 3) {
            node = node.nextSibling;
          }
        }
        return node.nextSibling;
      case 11:
        var currentChild = node.firstChild;
        while (currentChild) {
          currentChild = this._compileNode(currentChild, resources, instructions, node, parentInjectorId, targetLightDOM);
        }
        break;
      default:
        break;
    }

    return node.nextSibling;
  };

  ViewCompiler.prototype._compileSurrogate = function _compileSurrogate(node, resources) {
    var tagName = node.tagName.toLowerCase();
    var attributes = node.attributes;
    var bindingLanguage = resources.getBindingLanguage(this.bindingLanguage);
    var knownAttribute = void 0;
    var property = void 0;
    var instruction = void 0;
    var i = void 0;
    var ii = void 0;
    var attr = void 0;
    var attrName = void 0;
    var attrValue = void 0;
    var info = void 0;
    var type = void 0;
    var expressions = [];
    var expression = void 0;
    var behaviorInstructions = [];
    var values = {};
    var hasValues = false;
    var providers = [];

    for (i = 0, ii = attributes.length; i < ii; ++i) {
      attr = attributes[i];
      attrName = attr.name;
      attrValue = attr.value;

      info = bindingLanguage.inspectAttribute(resources, tagName, attrName, attrValue);
      type = resources.getAttribute(info.attrName);

      if (type) {
        knownAttribute = resources.mapAttribute(info.attrName);
        if (knownAttribute) {
          property = type.attributes[knownAttribute];

          if (property) {
            info.defaultBindingMode = property.defaultBindingMode;

            if (!info.command && !info.expression) {
              info.command = property.hasOptions ? 'options' : null;
            }
          }
        }
      }

      instruction = bindingLanguage.createAttributeInstruction(resources, node, info, undefined, type);

      if (instruction) {
        if (instruction.alteredAttr) {
          type = resources.getAttribute(instruction.attrName);
        }

        if (instruction.discrete) {
          expressions.push(instruction);
        } else {
          if (type) {
            instruction.type = type;
            configureProperties(instruction, resources);

            if (type.liftsContent) {
              throw new Error('You cannot place a template controller on a surrogate element.');
            } else {
              behaviorInstructions.push(instruction);
            }
          } else {
            expressions.push(instruction.attributes[instruction.attrName]);
          }
        }
      } else {
        if (type) {
          instruction = BehaviorInstruction.attribute(attrName, type);
          instruction.attributes[resources.mapAttribute(attrName)] = attrValue;

          if (type.liftsContent) {
            throw new Error('You cannot place a template controller on a surrogate element.');
          } else {
            behaviorInstructions.push(instruction);
          }
        } else if (attrName !== 'id' && attrName !== 'part' && attrName !== 'replace-part') {
          hasValues = true;
          values[attrName] = attrValue;
        }
      }
    }

    if (expressions.length || behaviorInstructions.length || hasValues) {
      for (i = 0, ii = behaviorInstructions.length; i < ii; ++i) {
        instruction = behaviorInstructions[i];
        instruction.type.compile(this, resources, node, instruction);
        providers.push(instruction.type.target);
      }

      for (i = 0, ii = expressions.length; i < ii; ++i) {
        expression = expressions[i];
        if (expression.attrToRemove !== undefined) {
          node.removeAttribute(expression.attrToRemove);
        }
      }

      return TargetInstruction.surrogate(providers, behaviorInstructions, expressions, values);
    }

    return null;
  };

  ViewCompiler.prototype._compileElement = function _compileElement(node, resources, instructions, parentNode, parentInjectorId, targetLightDOM) {
    var tagName = node.tagName.toLowerCase();
    var attributes = node.attributes;
    var expressions = [];
    var expression = void 0;
    var behaviorInstructions = [];
    var providers = [];
    var bindingLanguage = resources.getBindingLanguage(this.bindingLanguage);
    var liftingInstruction = void 0;
    var viewFactory = void 0;
    var type = void 0;
    var elementInstruction = void 0;
    var elementProperty = void 0;
    var i = void 0;
    var ii = void 0;
    var attr = void 0;
    var attrName = void 0;
    var attrValue = void 0;
    var instruction = void 0;
    var info = void 0;
    var property = void 0;
    var knownAttribute = void 0;
    var auTargetID = void 0;
    var injectorId = void 0;

    if (tagName === 'slot') {
      if (targetLightDOM) {
        node = makeShadowSlot(this, resources, node, instructions, parentInjectorId);
      }
      return node.nextSibling;
    } else if (tagName === 'template') {
      viewFactory = this.compile(node, resources);
      viewFactory.part = node.getAttribute('part');
    } else {
      type = resources.getElement(node.getAttribute('as-element') || tagName);
      if (type) {
        elementInstruction = BehaviorInstruction.element(node, type);
        type.processAttributes(this, resources, node, attributes, elementInstruction);
        behaviorInstructions.push(elementInstruction);
      }
    }

    for (i = 0, ii = attributes.length; i < ii; ++i) {
      attr = attributes[i];
      attrName = attr.name;
      attrValue = attr.value;
      info = bindingLanguage.inspectAttribute(resources, tagName, attrName, attrValue);

      if (targetLightDOM && info.attrName === 'slot') {
        info.attrName = attrName = 'au-slot';
      }

      type = resources.getAttribute(info.attrName);
      elementProperty = null;

      if (type) {
        knownAttribute = resources.mapAttribute(info.attrName);
        if (knownAttribute) {
          property = type.attributes[knownAttribute];

          if (property) {
            info.defaultBindingMode = property.defaultBindingMode;

            if (!info.command && !info.expression) {
              info.command = property.hasOptions ? 'options' : null;
            }
          }
        }
      } else if (elementInstruction) {
          elementProperty = elementInstruction.type.attributes[info.attrName];
          if (elementProperty) {
            info.defaultBindingMode = elementProperty.defaultBindingMode;
          }
        }

      if (elementProperty) {
        instruction = bindingLanguage.createAttributeInstruction(resources, node, info, elementInstruction);
      } else {
        instruction = bindingLanguage.createAttributeInstruction(resources, node, info, undefined, type);
      }

      if (instruction) {
        if (instruction.alteredAttr) {
          type = resources.getAttribute(instruction.attrName);
        }

        if (instruction.discrete) {
          expressions.push(instruction);
        } else {
          if (type) {
            instruction.type = type;
            configureProperties(instruction, resources);

            if (type.liftsContent) {
              instruction.originalAttrName = attrName;
              liftingInstruction = instruction;
              break;
            } else {
              behaviorInstructions.push(instruction);
            }
          } else if (elementProperty) {
            elementInstruction.attributes[info.attrName].targetProperty = elementProperty.name;
          } else {
            expressions.push(instruction.attributes[instruction.attrName]);
          }
        }
      } else {
        if (type) {
          instruction = BehaviorInstruction.attribute(attrName, type);
          instruction.attributes[resources.mapAttribute(attrName)] = attrValue;

          if (type.liftsContent) {
            instruction.originalAttrName = attrName;
            liftingInstruction = instruction;
            break;
          } else {
            behaviorInstructions.push(instruction);
          }
        } else if (elementProperty) {
          elementInstruction.attributes[attrName] = attrValue;
        }
      }
    }

    if (liftingInstruction) {
      liftingInstruction.viewFactory = viewFactory;
      node = liftingInstruction.type.compile(this, resources, node, liftingInstruction, parentNode);
      auTargetID = makeIntoInstructionTarget(node);
      instructions[auTargetID] = TargetInstruction.lifting(parentInjectorId, liftingInstruction);
    } else {
      if (expressions.length || behaviorInstructions.length) {
        injectorId = behaviorInstructions.length ? getNextInjectorId() : false;

        for (i = 0, ii = behaviorInstructions.length; i < ii; ++i) {
          instruction = behaviorInstructions[i];
          instruction.type.compile(this, resources, node, instruction, parentNode);
          providers.push(instruction.type.target);
        }

        for (i = 0, ii = expressions.length; i < ii; ++i) {
          expression = expressions[i];
          if (expression.attrToRemove !== undefined) {
            node.removeAttribute(expression.attrToRemove);
          }
        }

        auTargetID = makeIntoInstructionTarget(node);
        instructions[auTargetID] = TargetInstruction.normal(injectorId, parentInjectorId, providers, behaviorInstructions, expressions, elementInstruction);
      }

      if (elementInstruction && elementInstruction.skipContentProcessing) {
        return node.nextSibling;
      }

      var currentChild = node.firstChild;
      while (currentChild) {
        currentChild = this._compileNode(currentChild, resources, instructions, node, injectorId || parentInjectorId, targetLightDOM);
      }
    }

    return node.nextSibling;
  };

  return ViewCompiler;
}()) || _class17);

var ResourceModule = exports.ResourceModule = function () {
  function ResourceModule(moduleId) {
    

    this.id = moduleId;
    this.moduleInstance = null;
    this.mainResource = null;
    this.resources = null;
    this.viewStrategy = null;
    this.isInitialized = false;
    this.onLoaded = null;
    this.loadContext = null;
  }

  ResourceModule.prototype.initialize = function initialize(container) {
    var current = this.mainResource;
    var resources = this.resources;
    var vs = this.viewStrategy;

    if (this.isInitialized) {
      return;
    }

    this.isInitialized = true;

    if (current !== undefined) {
      current.metadata.viewStrategy = vs;
      current.initialize(container);
    }

    for (var i = 0, ii = resources.length; i < ii; ++i) {
      current = resources[i];
      current.metadata.viewStrategy = vs;
      current.initialize(container);
    }
  };

  ResourceModule.prototype.register = function register(registry, name) {
    var main = this.mainResource;
    var resources = this.resources;

    if (main !== undefined) {
      main.register(registry, name);
      name = null;
    }

    for (var i = 0, ii = resources.length; i < ii; ++i) {
      resources[i].register(registry, name);
      name = null;
    }
  };

  ResourceModule.prototype.load = function load(container, loadContext) {
    if (this.onLoaded !== null) {
      return this.loadContext === loadContext ? Promise.resolve() : this.onLoaded;
    }

    var main = this.mainResource;
    var resources = this.resources;
    var loads = void 0;

    if (main !== undefined) {
      loads = new Array(resources.length + 1);
      loads[0] = main.load(container, loadContext);
      for (var i = 0, ii = resources.length; i < ii; ++i) {
        loads[i + 1] = resources[i].load(container, loadContext);
      }
    } else {
      loads = new Array(resources.length);
      for (var _i = 0, _ii = resources.length; _i < _ii; ++_i) {
        loads[_i] = resources[_i].load(container, loadContext);
      }
    }

    this.loadContext = loadContext;
    this.onLoaded = Promise.all(loads);
    return this.onLoaded;
  };

  return ResourceModule;
}();

var ResourceDescription = exports.ResourceDescription = function () {
  function ResourceDescription(key, exportedValue, resourceTypeMeta) {
    

    if (!resourceTypeMeta) {
      resourceTypeMeta = _aureliaMetadata.metadata.get(_aureliaMetadata.metadata.resource, exportedValue);

      if (!resourceTypeMeta) {
        resourceTypeMeta = new HtmlBehaviorResource();
        resourceTypeMeta.elementName = _hyphenate(key);
        _aureliaMetadata.metadata.define(_aureliaMetadata.metadata.resource, resourceTypeMeta, exportedValue);
      }
    }

    if (resourceTypeMeta instanceof HtmlBehaviorResource) {
      if (resourceTypeMeta.elementName === undefined) {
        resourceTypeMeta.elementName = _hyphenate(key);
      } else if (resourceTypeMeta.attributeName === undefined) {
        resourceTypeMeta.attributeName = _hyphenate(key);
      } else if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {
        HtmlBehaviorResource.convention(key, resourceTypeMeta);
      }
    } else if (!resourceTypeMeta.name) {
      resourceTypeMeta.name = _hyphenate(key);
    }

    this.metadata = resourceTypeMeta;
    this.value = exportedValue;
  }

  ResourceDescription.prototype.initialize = function initialize(container) {
    this.metadata.initialize(container, this.value);
  };

  ResourceDescription.prototype.register = function register(registry, name) {
    this.metadata.register(registry, name);
  };

  ResourceDescription.prototype.load = function load(container, loadContext) {
    return this.metadata.load(container, this.value, loadContext);
  };

  return ResourceDescription;
}();

var ModuleAnalyzer = exports.ModuleAnalyzer = function () {
  function ModuleAnalyzer() {
    

    this.cache = Object.create(null);
  }

  ModuleAnalyzer.prototype.getAnalysis = function getAnalysis(moduleId) {
    return this.cache[moduleId];
  };

  ModuleAnalyzer.prototype.analyze = function analyze(moduleId, moduleInstance, mainResourceKey) {
    var mainResource = void 0;
    var fallbackValue = void 0;
    var fallbackKey = void 0;
    var resourceTypeMeta = void 0;
    var key = void 0;
    var exportedValue = void 0;
    var resources = [];
    var conventional = void 0;
    var vs = void 0;
    var resourceModule = void 0;

    resourceModule = this.cache[moduleId];
    if (resourceModule) {
      return resourceModule;
    }

    resourceModule = new ResourceModule(moduleId);
    this.cache[moduleId] = resourceModule;

    if (typeof moduleInstance === 'function') {
      moduleInstance = { 'default': moduleInstance };
    }

    if (mainResourceKey) {
      mainResource = new ResourceDescription(mainResourceKey, moduleInstance[mainResourceKey]);
    }

    for (key in moduleInstance) {
      exportedValue = moduleInstance[key];

      if (key === mainResourceKey || typeof exportedValue !== 'function') {
        continue;
      }

      resourceTypeMeta = _aureliaMetadata.metadata.get(_aureliaMetadata.metadata.resource, exportedValue);

      if (resourceTypeMeta) {
        if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {
          HtmlBehaviorResource.convention(key, resourceTypeMeta);
        }

        if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {
          resourceTypeMeta.elementName = _hyphenate(key);
        }

        if (!mainResource && resourceTypeMeta instanceof HtmlBehaviorResource && resourceTypeMeta.elementName !== null) {
          mainResource = new ResourceDescription(key, exportedValue, resourceTypeMeta);
        } else {
          resources.push(new ResourceDescription(key, exportedValue, resourceTypeMeta));
        }
      } else if (viewStrategy.decorates(exportedValue)) {
        vs = exportedValue;
      } else if (exportedValue instanceof _aureliaLoader.TemplateRegistryEntry) {
        vs = new TemplateRegistryViewStrategy(moduleId, exportedValue);
      } else {
        if (conventional = HtmlBehaviorResource.convention(key)) {
          if (conventional.elementName !== null && !mainResource) {
            mainResource = new ResourceDescription(key, exportedValue, conventional);
          } else {
            resources.push(new ResourceDescription(key, exportedValue, conventional));
          }

          _aureliaMetadata.metadata.define(_aureliaMetadata.metadata.resource, conventional, exportedValue);
        } else if (conventional = _aureliaBinding.ValueConverterResource.convention(key) || _aureliaBinding.BindingBehaviorResource.convention(key) || ViewEngineHooksResource.convention(key)) {
          resources.push(new ResourceDescription(key, exportedValue, conventional));
          _aureliaMetadata.metadata.define(_aureliaMetadata.metadata.resource, conventional, exportedValue);
        } else if (!fallbackValue) {
          fallbackValue = exportedValue;
          fallbackKey = key;
        }
      }
    }

    if (!mainResource && fallbackValue) {
      mainResource = new ResourceDescription(fallbackKey, fallbackValue);
    }

    resourceModule.moduleInstance = moduleInstance;
    resourceModule.mainResource = mainResource;
    resourceModule.resources = resources;
    resourceModule.viewStrategy = vs;

    return resourceModule;
  };

  return ModuleAnalyzer;
}();

var logger = LogManager.getLogger('templating');

function ensureRegistryEntry(loader, urlOrRegistryEntry) {
  if (urlOrRegistryEntry instanceof _aureliaLoader.TemplateRegistryEntry) {
    return Promise.resolve(urlOrRegistryEntry);
  }

  return loader.loadTemplate(urlOrRegistryEntry);
}

var ProxyViewFactory = function () {
  function ProxyViewFactory(promise) {
    var _this9 = this;

    

    promise.then(function (x) {
      return _this9.viewFactory = x;
    });
  }

  ProxyViewFactory.prototype.create = function create(container, bindingContext, createInstruction, element) {
    return this.viewFactory.create(container, bindingContext, createInstruction, element);
  };

  ProxyViewFactory.prototype.setCacheSize = function setCacheSize(size, doNotOverrideIfAlreadySet) {
    this.viewFactory.setCacheSize(size, doNotOverrideIfAlreadySet);
  };

  ProxyViewFactory.prototype.getCachedView = function getCachedView() {
    return this.viewFactory.getCachedView();
  };

  ProxyViewFactory.prototype.returnViewToCache = function returnViewToCache(view) {
    this.viewFactory.returnViewToCache(view);
  };

  _createClass(ProxyViewFactory, [{
    key: 'isCaching',
    get: function get() {
      return this.viewFactory.isCaching;
    }
  }]);

  return ProxyViewFactory;
}();

var ViewEngine = exports.ViewEngine = (_dec8 = (0, _aureliaDependencyInjection.inject)(_aureliaLoader.Loader, _aureliaDependencyInjection.Container, ViewCompiler, ModuleAnalyzer, ViewResources), _dec8(_class18 = function () {
  function ViewEngine(loader, container, viewCompiler, moduleAnalyzer, appResources) {
    

    this.loader = loader;
    this.container = container;
    this.viewCompiler = viewCompiler;
    this.moduleAnalyzer = moduleAnalyzer;
    this.appResources = appResources;
    this._pluginMap = {};

    var auSlotBehavior = new HtmlBehaviorResource();
    auSlotBehavior.attributeName = 'au-slot';
    auSlotBehavior.initialize(container, SlotCustomAttribute);
    auSlotBehavior.register(appResources);
  }

  ViewEngine.prototype.addResourcePlugin = function addResourcePlugin(extension, implementation) {
    var name = extension.replace('.', '') + '-resource-plugin';
    this._pluginMap[extension] = name;
    this.loader.addPlugin(name, implementation);
  };

  ViewEngine.prototype.loadViewFactory = function loadViewFactory(urlOrRegistryEntry, compileInstruction, loadContext) {
    var _this10 = this;

    loadContext = loadContext || new ResourceLoadContext();

    return ensureRegistryEntry(this.loader, urlOrRegistryEntry).then(function (registryEntry) {
      if (registryEntry.onReady) {
        if (!loadContext.hasDependency(urlOrRegistryEntry)) {
          loadContext.addDependency(urlOrRegistryEntry);
          return registryEntry.onReady;
        }

        return Promise.resolve(new ProxyViewFactory(registryEntry.onReady));
      }

      loadContext.addDependency(urlOrRegistryEntry);

      registryEntry.onReady = _this10.loadTemplateResources(registryEntry, compileInstruction, loadContext).then(function (resources) {
        registryEntry.resources = resources;
        var viewFactory = _this10.viewCompiler.compile(registryEntry.template, resources, compileInstruction);
        registryEntry.factory = viewFactory;
        return viewFactory;
      });

      return registryEntry.onReady;
    });
  };

  ViewEngine.prototype.loadTemplateResources = function loadTemplateResources(registryEntry, compileInstruction, loadContext) {
    var resources = new ViewResources(this.appResources, registryEntry.address);
    var dependencies = registryEntry.dependencies;
    var importIds = void 0;
    var names = void 0;

    compileInstruction = compileInstruction || ViewCompileInstruction.normal;

    if (dependencies.length === 0 && !compileInstruction.associatedModuleId) {
      return Promise.resolve(resources);
    }

    importIds = dependencies.map(function (x) {
      return x.src;
    });
    names = dependencies.map(function (x) {
      return x.name;
    });
    logger.debug('importing resources for ' + registryEntry.address, importIds);

    return this.importViewResources(importIds, names, resources, compileInstruction, loadContext);
  };

  ViewEngine.prototype.importViewModelResource = function importViewModelResource(moduleImport, moduleMember) {
    var _this11 = this;

    return this.loader.loadModule(moduleImport).then(function (viewModelModule) {
      var normalizedId = _aureliaMetadata.Origin.get(viewModelModule).moduleId;
      var resourceModule = _this11.moduleAnalyzer.analyze(normalizedId, viewModelModule, moduleMember);

      if (!resourceModule.mainResource) {
        throw new Error('No view model found in module "' + moduleImport + '".');
      }

      resourceModule.initialize(_this11.container);

      return resourceModule.mainResource;
    });
  };

  ViewEngine.prototype.importViewResources = function importViewResources(moduleIds, names, resources, compileInstruction, loadContext) {
    var _this12 = this;

    loadContext = loadContext || new ResourceLoadContext();
    compileInstruction = compileInstruction || ViewCompileInstruction.normal;

    moduleIds = moduleIds.map(function (x) {
      return _this12._applyLoaderPlugin(x);
    });

    return this.loader.loadAllModules(moduleIds).then(function (imports) {
      var i = void 0;
      var ii = void 0;
      var analysis = void 0;
      var normalizedId = void 0;
      var current = void 0;
      var associatedModule = void 0;
      var container = _this12.container;
      var moduleAnalyzer = _this12.moduleAnalyzer;
      var allAnalysis = new Array(imports.length);

      for (i = 0, ii = imports.length; i < ii; ++i) {
        current = imports[i];
        normalizedId = _aureliaMetadata.Origin.get(current).moduleId;

        analysis = moduleAnalyzer.analyze(normalizedId, current);
        analysis.initialize(container);
        analysis.register(resources, names[i]);

        allAnalysis[i] = analysis;
      }

      if (compileInstruction.associatedModuleId) {
        associatedModule = moduleAnalyzer.getAnalysis(compileInstruction.associatedModuleId);

        if (associatedModule) {
          associatedModule.register(resources);
        }
      }

      for (i = 0, ii = allAnalysis.length; i < ii; ++i) {
        allAnalysis[i] = allAnalysis[i].load(container, loadContext);
      }

      return Promise.all(allAnalysis).then(function () {
        return resources;
      });
    });
  };

  ViewEngine.prototype._applyLoaderPlugin = function _applyLoaderPlugin(id) {
    var index = id.lastIndexOf('.');
    if (index !== -1) {
      var ext = id.substring(index);
      var pluginName = this._pluginMap[ext];

      if (pluginName === undefined) {
        return id;
      }

      return this.loader.applyPluginToUrl(id, pluginName);
    }

    return id;
  };

  return ViewEngine;
}()) || _class18);

var Controller = exports.Controller = function () {
  function Controller(behavior, instruction, viewModel, elementEvents) {
    

    this.behavior = behavior;
    this.instruction = instruction;
    this.viewModel = viewModel;
    this.isAttached = false;
    this.view = null;
    this.isBound = false;
    this.scope = null;
    this.elementEvents = elementEvents || null;

    var observerLookup = behavior.observerLocator.getOrCreateObserversLookup(viewModel);
    var handlesBind = behavior.handlesBind;
    var attributes = instruction.attributes;
    var boundProperties = this.boundProperties = [];
    var properties = behavior.properties;
    var i = void 0;
    var ii = void 0;

    behavior._ensurePropertiesDefined(viewModel, observerLookup);

    for (i = 0, ii = properties.length; i < ii; ++i) {
      properties[i]._initialize(viewModel, observerLookup, attributes, handlesBind, boundProperties);
    }
  }

  Controller.prototype.created = function created(owningView) {
    if (this.behavior.handlesCreated) {
      this.viewModel.created(owningView, this.view);
    }
  };

  Controller.prototype.automate = function automate(overrideContext, owningView) {
    this.view.bindingContext = this.viewModel;
    this.view.overrideContext = overrideContext || (0, _aureliaBinding.createOverrideContext)(this.viewModel);
    this.view._isUserControlled = true;

    if (this.behavior.handlesCreated) {
      this.viewModel.created(owningView || null, this.view);
    }

    this.bind(this.view);
  };

  Controller.prototype.bind = function bind(scope) {
    var skipSelfSubscriber = this.behavior.handlesBind;
    var boundProperties = this.boundProperties;
    var i = void 0;
    var ii = void 0;
    var x = void 0;
    var observer = void 0;
    var selfSubscriber = void 0;

    if (this.isBound) {
      if (this.scope === scope) {
        return;
      }

      this.unbind();
    }

    this.isBound = true;
    this.scope = scope;

    for (i = 0, ii = boundProperties.length; i < ii; ++i) {
      x = boundProperties[i];
      observer = x.observer;
      selfSubscriber = observer.selfSubscriber;
      observer.publishing = false;

      if (skipSelfSubscriber) {
        observer.selfSubscriber = null;
      }

      x.binding.bind(scope);
      observer.call();

      observer.publishing = true;
      observer.selfSubscriber = selfSubscriber;
    }

    var overrideContext = void 0;
    if (this.view !== null) {
      if (skipSelfSubscriber) {
        this.view.viewModelScope = scope;
      }

      if (this.viewModel === scope.overrideContext.bindingContext) {
        overrideContext = scope.overrideContext;
      } else if (this.instruction.inheritBindingContext) {
          overrideContext = (0, _aureliaBinding.createOverrideContext)(this.viewModel, scope.overrideContext);
        } else {
            overrideContext = (0, _aureliaBinding.createOverrideContext)(this.viewModel);
            overrideContext.__parentOverrideContext = scope.overrideContext;
          }

      this.view.bind(this.viewModel, overrideContext);
    } else if (skipSelfSubscriber) {
      overrideContext = scope.overrideContext;

      if (scope.overrideContext.__parentOverrideContext !== undefined && this.viewModel.viewFactory && this.viewModel.viewFactory.factoryCreateInstruction.partReplacements) {
        overrideContext = Object.assign({}, scope.overrideContext);
        overrideContext.parentOverrideContext = scope.overrideContext.__parentOverrideContext;
      }
      this.viewModel.bind(scope.bindingContext, overrideContext);
    }
  };

  Controller.prototype.unbind = function unbind() {
    if (this.isBound) {
      var boundProperties = this.boundProperties;
      var i = void 0;
      var ii = void 0;

      this.isBound = false;
      this.scope = null;

      if (this.view !== null) {
        this.view.unbind();
      }

      if (this.behavior.handlesUnbind) {
        this.viewModel.unbind();
      }

      if (this.elementEvents !== null) {
        this.elementEvents.disposeAll();
      }

      for (i = 0, ii = boundProperties.length; i < ii; ++i) {
        boundProperties[i].binding.unbind();
      }
    }
  };

  Controller.prototype.attached = function attached() {
    if (this.isAttached) {
      return;
    }

    this.isAttached = true;

    if (this.behavior.handlesAttached) {
      this.viewModel.attached();
    }

    if (this.view !== null) {
      this.view.attached();
    }
  };

  Controller.prototype.detached = function detached() {
    if (this.isAttached) {
      this.isAttached = false;

      if (this.view !== null) {
        this.view.detached();
      }

      if (this.behavior.handlesDetached) {
        this.viewModel.detached();
      }
    }
  };

  return Controller;
}();

var BehaviorPropertyObserver = exports.BehaviorPropertyObserver = (_dec9 = (0, _aureliaBinding.subscriberCollection)(), _dec9(_class20 = function () {
  function BehaviorPropertyObserver(taskQueue, obj, propertyName, selfSubscriber, initialValue) {
    

    this.taskQueue = taskQueue;
    this.obj = obj;
    this.propertyName = propertyName;
    this.notqueued = true;
    this.publishing = false;
    this.selfSubscriber = selfSubscriber;
    this.currentValue = this.oldValue = initialValue;
  }

  BehaviorPropertyObserver.prototype.getValue = function getValue() {
    return this.currentValue;
  };

  BehaviorPropertyObserver.prototype.setValue = function setValue(newValue) {
    var oldValue = this.currentValue;

    if (oldValue !== newValue) {
      if (this.publishing && this.notqueued) {
        this.notqueued = false;
        this.taskQueue.queueMicroTask(this);
      }

      this.oldValue = oldValue;
      this.currentValue = newValue;
    }
  };

  BehaviorPropertyObserver.prototype.call = function call() {
    var oldValue = this.oldValue;
    var newValue = this.currentValue;

    this.notqueued = true;

    if (newValue === oldValue) {
      return;
    }

    if (this.selfSubscriber) {
      this.selfSubscriber(newValue, oldValue);
    }

    this.callSubscribers(newValue, oldValue);
    this.oldValue = newValue;
  };

  BehaviorPropertyObserver.prototype.subscribe = function subscribe(context, callable) {
    this.addSubscriber(context, callable);
  };

  BehaviorPropertyObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    this.removeSubscriber(context, callable);
  };

  return BehaviorPropertyObserver;
}()) || _class20);


function getObserver(behavior, instance, name) {
  var lookup = instance.__observers__;

  if (lookup === undefined) {
    if (!behavior.isInitialized) {
      behavior.initialize(_aureliaDependencyInjection.Container.instance || new _aureliaDependencyInjection.Container(), instance.constructor);
    }

    lookup = behavior.observerLocator.getOrCreateObserversLookup(instance);
    behavior._ensurePropertiesDefined(instance, lookup);
  }

  return lookup[name];
}

var BindableProperty = exports.BindableProperty = function () {
  function BindableProperty(nameOrConfig) {
    

    if (typeof nameOrConfig === 'string') {
      this.name = nameOrConfig;
    } else {
      Object.assign(this, nameOrConfig);
    }

    this.attribute = this.attribute || _hyphenate(this.name);
    if (this.defaultBindingMode === null || this.defaultBindingMode === undefined) {
      this.defaultBindingMode = _aureliaBinding.bindingMode.oneWay;
    }
    this.changeHandler = this.changeHandler || null;
    this.owner = null;
    this.descriptor = null;
  }

  BindableProperty.prototype.registerWith = function registerWith(target, behavior, descriptor) {
    behavior.properties.push(this);
    behavior.attributes[this.attribute] = this;
    this.owner = behavior;

    if (descriptor) {
      this.descriptor = descriptor;
      return this._configureDescriptor(behavior, descriptor);
    }

    return undefined;
  };

  BindableProperty.prototype._configureDescriptor = function _configureDescriptor(behavior, descriptor) {
    var name = this.name;

    descriptor.configurable = true;
    descriptor.enumerable = true;

    if ('initializer' in descriptor) {
      this.defaultValue = descriptor.initializer;
      delete descriptor.initializer;
      delete descriptor.writable;
    }

    if ('value' in descriptor) {
      this.defaultValue = descriptor.value;
      delete descriptor.value;
      delete descriptor.writable;
    }

    descriptor.get = function () {
      return getObserver(behavior, this, name).getValue();
    };

    descriptor.set = function (value) {
      getObserver(behavior, this, name).setValue(value);
    };

    descriptor.get.getObserver = function (obj) {
      return getObserver(behavior, obj, name);
    };

    return descriptor;
  };

  BindableProperty.prototype.defineOn = function defineOn(target, behavior) {
    var name = this.name;
    var handlerName = void 0;

    if (this.changeHandler === null) {
      handlerName = name + 'Changed';
      if (handlerName in target.prototype) {
        this.changeHandler = handlerName;
      }
    }

    if (this.descriptor === null) {
      Object.defineProperty(target.prototype, name, this._configureDescriptor(behavior, {}));
    }
  };

  BindableProperty.prototype.createObserver = function createObserver(viewModel) {
    var selfSubscriber = null;
    var defaultValue = this.defaultValue;
    var changeHandlerName = this.changeHandler;
    var name = this.name;
    var initialValue = void 0;

    if (this.hasOptions) {
      return undefined;
    }

    if (changeHandlerName in viewModel) {
      if ('propertyChanged' in viewModel) {
        selfSubscriber = function selfSubscriber(newValue, oldValue) {
          viewModel[changeHandlerName](newValue, oldValue);
          viewModel.propertyChanged(name, newValue, oldValue);
        };
      } else {
        selfSubscriber = function selfSubscriber(newValue, oldValue) {
          return viewModel[changeHandlerName](newValue, oldValue);
        };
      }
    } else if ('propertyChanged' in viewModel) {
      selfSubscriber = function selfSubscriber(newValue, oldValue) {
        return viewModel.propertyChanged(name, newValue, oldValue);
      };
    } else if (changeHandlerName !== null) {
      throw new Error('Change handler ' + changeHandlerName + ' was specified but not declared on the class.');
    }

    if (defaultValue !== undefined) {
      initialValue = typeof defaultValue === 'function' ? defaultValue.call(viewModel) : defaultValue;
    }

    return new BehaviorPropertyObserver(this.owner.taskQueue, viewModel, this.name, selfSubscriber, initialValue);
  };

  BindableProperty.prototype._initialize = function _initialize(viewModel, observerLookup, attributes, behaviorHandlesBind, boundProperties) {
    var selfSubscriber = void 0;
    var observer = void 0;
    var attribute = void 0;
    var defaultValue = this.defaultValue;

    if (this.isDynamic) {
      for (var key in attributes) {
        this._createDynamicProperty(viewModel, observerLookup, behaviorHandlesBind, key, attributes[key], boundProperties);
      }
    } else if (!this.hasOptions) {
      observer = observerLookup[this.name];

      if (attributes !== null) {
        selfSubscriber = observer.selfSubscriber;
        attribute = attributes[this.attribute];

        if (behaviorHandlesBind) {
          observer.selfSubscriber = null;
        }

        if (typeof attribute === 'string') {
          viewModel[this.name] = attribute;
          observer.call();
        } else if (attribute) {
          boundProperties.push({ observer: observer, binding: attribute.createBinding(viewModel) });
        } else if (defaultValue !== undefined) {
          observer.call();
        }

        observer.selfSubscriber = selfSubscriber;
      }

      observer.publishing = true;
    }
  };

  BindableProperty.prototype._createDynamicProperty = function _createDynamicProperty(viewModel, observerLookup, behaviorHandlesBind, name, attribute, boundProperties) {
    var changeHandlerName = name + 'Changed';
    var selfSubscriber = null;
    var observer = void 0;
    var info = void 0;

    if (changeHandlerName in viewModel) {
      if ('propertyChanged' in viewModel) {
        selfSubscriber = function selfSubscriber(newValue, oldValue) {
          viewModel[changeHandlerName](newValue, oldValue);
          viewModel.propertyChanged(name, newValue, oldValue);
        };
      } else {
        selfSubscriber = function selfSubscriber(newValue, oldValue) {
          return viewModel[changeHandlerName](newValue, oldValue);
        };
      }
    } else if ('propertyChanged' in viewModel) {
      selfSubscriber = function selfSubscriber(newValue, oldValue) {
        return viewModel.propertyChanged(name, newValue, oldValue);
      };
    }

    observer = observerLookup[name] = new BehaviorPropertyObserver(this.owner.taskQueue, viewModel, name, selfSubscriber);

    Object.defineProperty(viewModel, name, {
      configurable: true,
      enumerable: true,
      get: observer.getValue.bind(observer),
      set: observer.setValue.bind(observer)
    });

    if (behaviorHandlesBind) {
      observer.selfSubscriber = null;
    }

    if (typeof attribute === 'string') {
      viewModel[name] = attribute;
      observer.call();
    } else if (attribute) {
      info = { observer: observer, binding: attribute.createBinding(viewModel) };
      boundProperties.push(info);
    }

    observer.publishing = true;
    observer.selfSubscriber = selfSubscriber;
  };

  return BindableProperty;
}();

var lastProviderId = 0;

function nextProviderId() {
  return ++lastProviderId;
}

function doProcessContent() {
  return true;
}
function doProcessAttributes() {}

var HtmlBehaviorResource = exports.HtmlBehaviorResource = function () {
  function HtmlBehaviorResource() {
    

    this.elementName = null;
    this.attributeName = null;
    this.attributeDefaultBindingMode = undefined;
    this.liftsContent = false;
    this.targetShadowDOM = false;
    this.shadowDOMOptions = null;
    this.processAttributes = doProcessAttributes;
    this.processContent = doProcessContent;
    this.usesShadowDOM = false;
    this.childBindings = null;
    this.hasDynamicOptions = false;
    this.containerless = false;
    this.properties = [];
    this.attributes = {};
    this.isInitialized = false;
  }

  HtmlBehaviorResource.convention = function convention(name, existing) {
    var behavior = void 0;

    if (name.endsWith('CustomAttribute')) {
      behavior = existing || new HtmlBehaviorResource();
      behavior.attributeName = _hyphenate(name.substring(0, name.length - 15));
    }

    if (name.endsWith('CustomElement')) {
      behavior = existing || new HtmlBehaviorResource();
      behavior.elementName = _hyphenate(name.substring(0, name.length - 13));
    }

    return behavior;
  };

  HtmlBehaviorResource.prototype.addChildBinding = function addChildBinding(behavior) {
    if (this.childBindings === null) {
      this.childBindings = [];
    }

    this.childBindings.push(behavior);
  };

  HtmlBehaviorResource.prototype.initialize = function initialize(container, target) {
    var proto = target.prototype;
    var properties = this.properties;
    var attributeName = this.attributeName;
    var attributeDefaultBindingMode = this.attributeDefaultBindingMode;
    var i = void 0;
    var ii = void 0;
    var current = void 0;

    if (this.isInitialized) {
      return;
    }

    this.isInitialized = true;
    target.__providerId__ = nextProviderId();

    this.observerLocator = container.get(_aureliaBinding.ObserverLocator);
    this.taskQueue = container.get(_aureliaTaskQueue.TaskQueue);

    this.target = target;
    this.usesShadowDOM = this.targetShadowDOM && _aureliaPal.FEATURE.shadowDOM;
    this.handlesCreated = 'created' in proto;
    this.handlesBind = 'bind' in proto;
    this.handlesUnbind = 'unbind' in proto;
    this.handlesAttached = 'attached' in proto;
    this.handlesDetached = 'detached' in proto;
    this.htmlName = this.elementName || this.attributeName;

    if (attributeName !== null) {
      if (properties.length === 0) {
        new BindableProperty({
          name: 'value',
          changeHandler: 'valueChanged' in proto ? 'valueChanged' : null,
          attribute: attributeName,
          defaultBindingMode: attributeDefaultBindingMode
        }).registerWith(target, this);
      }

      current = properties[0];

      if (properties.length === 1 && current.name === 'value') {
        current.isDynamic = current.hasOptions = this.hasDynamicOptions;
        current.defineOn(target, this);
      } else {
        for (i = 0, ii = properties.length; i < ii; ++i) {
          properties[i].defineOn(target, this);
        }

        current = new BindableProperty({
          name: 'value',
          changeHandler: 'valueChanged' in proto ? 'valueChanged' : null,
          attribute: attributeName,
          defaultBindingMode: attributeDefaultBindingMode
        });

        current.hasOptions = true;
        current.registerWith(target, this);
      }
    } else {
      for (i = 0, ii = properties.length; i < ii; ++i) {
        properties[i].defineOn(target, this);
      }
    }
  };

  HtmlBehaviorResource.prototype.register = function register(registry, name) {
    if (this.attributeName !== null) {
      registry.registerAttribute(name || this.attributeName, this, this.attributeName);
    }

    if (this.elementName !== null) {
      registry.registerElement(name || this.elementName, this);
    }
  };

  HtmlBehaviorResource.prototype.load = function load(container, target, loadContext, viewStrategy, transientView) {
    var _this13 = this;

    var options = void 0;

    if (this.elementName !== null) {
      viewStrategy = container.get(ViewLocator).getViewStrategy(viewStrategy || this.viewStrategy || target);
      options = new ViewCompileInstruction(this.targetShadowDOM, true);

      if (!viewStrategy.moduleId) {
        viewStrategy.moduleId = _aureliaMetadata.Origin.get(target).moduleId;
      }

      return viewStrategy.loadViewFactory(container.get(ViewEngine), options, loadContext).then(function (viewFactory) {
        if (!transientView || !_this13.viewFactory) {
          _this13.viewFactory = viewFactory;
        }

        return viewFactory;
      });
    }

    return Promise.resolve(this);
  };

  HtmlBehaviorResource.prototype.compile = function compile(compiler, resources, node, instruction, parentNode) {
    if (this.liftsContent) {
      if (!instruction.viewFactory) {
        var template = _aureliaPal.DOM.createElement('template');
        var fragment = _aureliaPal.DOM.createDocumentFragment();
        var cacheSize = node.getAttribute('view-cache');
        var part = node.getAttribute('part');

        node.removeAttribute(instruction.originalAttrName);
        _aureliaPal.DOM.replaceNode(template, node, parentNode);
        fragment.appendChild(node);
        instruction.viewFactory = compiler.compile(fragment, resources);

        if (part) {
          instruction.viewFactory.part = part;
          node.removeAttribute('part');
        }

        if (cacheSize) {
          instruction.viewFactory.setCacheSize(cacheSize);
          node.removeAttribute('view-cache');
        }

        node = template;
      }
    } else if (this.elementName !== null) {
      var _partReplacements2 = {};

      if (this.processContent(compiler, resources, node, instruction) && node.hasChildNodes()) {
        var currentChild = node.firstChild;
        var contentElement = this.usesShadowDOM ? null : _aureliaPal.DOM.createElement('au-content');
        var nextSibling = void 0;
        var toReplace = void 0;

        while (currentChild) {
          nextSibling = currentChild.nextSibling;

          if (currentChild.tagName === 'TEMPLATE' && (toReplace = currentChild.getAttribute('replace-part'))) {
            _partReplacements2[toReplace] = compiler.compile(currentChild, resources);
            _aureliaPal.DOM.removeNode(currentChild, parentNode);
            instruction.partReplacements = _partReplacements2;
          } else if (contentElement !== null) {
            if (currentChild.nodeType === 3 && _isAllWhitespace(currentChild)) {
              _aureliaPal.DOM.removeNode(currentChild, parentNode);
            } else {
              contentElement.appendChild(currentChild);
            }
          }

          currentChild = nextSibling;
        }

        if (contentElement !== null && contentElement.hasChildNodes()) {
          node.appendChild(contentElement);
        }

        instruction.skipContentProcessing = false;
      } else {
        instruction.skipContentProcessing = true;
      }
    }

    return node;
  };

  HtmlBehaviorResource.prototype.create = function create(container, instruction, element, bindings) {
    var viewHost = void 0;
    var au = null;

    instruction = instruction || BehaviorInstruction.normal;
    element = element || null;
    bindings = bindings || null;

    if (this.elementName !== null && element) {
      if (this.usesShadowDOM) {
        viewHost = element.attachShadow(this.shadowDOMOptions);
        container.registerInstance(_aureliaPal.DOM.boundary, viewHost);
      } else {
        viewHost = element;
        if (this.targetShadowDOM) {
          container.registerInstance(_aureliaPal.DOM.boundary, viewHost);
        }
      }
    }

    if (element !== null) {
      element.au = au = element.au || {};
    }

    var viewModel = instruction.viewModel || container.get(this.target);
    var controller = new Controller(this, instruction, viewModel, container.elementEvents);
    var childBindings = this.childBindings;
    var viewFactory = void 0;

    if (this.liftsContent) {
      au.controller = controller;
    } else if (this.elementName !== null) {
      viewFactory = instruction.viewFactory || this.viewFactory;
      container.viewModel = viewModel;

      if (viewFactory) {
        controller.view = viewFactory.create(container, instruction, element);
      }

      if (element !== null) {
        au.controller = controller;

        if (controller.view) {
          if (!this.usesShadowDOM && (element.childNodes.length === 1 || element.contentElement)) {
            var contentElement = element.childNodes[0] || element.contentElement;
            controller.view.contentView = { fragment: contentElement };
            contentElement.parentNode && _aureliaPal.DOM.removeNode(contentElement);
          }

          if (instruction.anchorIsContainer) {
            if (childBindings !== null) {
              for (var i = 0, ii = childBindings.length; i < ii; ++i) {
                controller.view.addBinding(childBindings[i].create(element, viewModel, controller));
              }
            }

            controller.view.appendNodesTo(viewHost);
          } else {
            controller.view.insertNodesBefore(viewHost);
          }
        } else if (childBindings !== null) {
          for (var _i2 = 0, _ii2 = childBindings.length; _i2 < _ii2; ++_i2) {
            bindings.push(childBindings[_i2].create(element, viewModel, controller));
          }
        }
      } else if (controller.view) {
        controller.view.controller = controller;

        if (childBindings !== null) {
          for (var _i3 = 0, _ii3 = childBindings.length; _i3 < _ii3; ++_i3) {
            controller.view.addBinding(childBindings[_i3].create(instruction.host, viewModel, controller));
          }
        }
      } else if (childBindings !== null) {
        for (var _i4 = 0, _ii4 = childBindings.length; _i4 < _ii4; ++_i4) {
          bindings.push(childBindings[_i4].create(instruction.host, viewModel, controller));
        }
      }
    } else if (childBindings !== null) {
      for (var _i5 = 0, _ii5 = childBindings.length; _i5 < _ii5; ++_i5) {
        bindings.push(childBindings[_i5].create(element, viewModel, controller));
      }
    }

    if (au !== null) {
      au[this.htmlName] = controller;
    }

    if (instruction.initiatedByBehavior && viewFactory) {
      controller.view.created();
    }

    return controller;
  };

  HtmlBehaviorResource.prototype._ensurePropertiesDefined = function _ensurePropertiesDefined(instance, lookup) {
    var properties = void 0;
    var i = void 0;
    var ii = void 0;
    var observer = void 0;

    if ('__propertiesDefined__' in lookup) {
      return;
    }

    lookup.__propertiesDefined__ = true;
    properties = this.properties;

    for (i = 0, ii = properties.length; i < ii; ++i) {
      observer = properties[i].createObserver(instance);

      if (observer !== undefined) {
        lookup[observer.propertyName] = observer;
      }
    }
  };

  return HtmlBehaviorResource;
}();

function createChildObserverDecorator(selectorOrConfig, all) {
  return function (target, key, descriptor) {
    var actualTarget = typeof key === 'string' ? target.constructor : target;
    var r = _aureliaMetadata.metadata.getOrCreateOwn(_aureliaMetadata.metadata.resource, HtmlBehaviorResource, actualTarget);

    if (typeof selectorOrConfig === 'string') {
      selectorOrConfig = {
        selector: selectorOrConfig,
        name: key
      };
    }

    if (descriptor) {
      descriptor.writable = true;
    }

    selectorOrConfig.all = all;
    r.addChildBinding(new ChildObserver(selectorOrConfig));
  };
}

function children(selectorOrConfig) {
  return createChildObserverDecorator(selectorOrConfig, true);
}

function child(selectorOrConfig) {
  return createChildObserverDecorator(selectorOrConfig, false);
}

var ChildObserver = function () {
  function ChildObserver(config) {
    

    this.name = config.name;
    this.changeHandler = config.changeHandler || this.name + 'Changed';
    this.selector = config.selector;
    this.all = config.all;
  }

  ChildObserver.prototype.create = function create(viewHost, viewModel, controller) {
    return new ChildObserverBinder(this.selector, viewHost, this.name, viewModel, controller, this.changeHandler, this.all);
  };

  return ChildObserver;
}();

var noMutations = [];

function trackMutation(groupedMutations, binder, record) {
  var mutations = groupedMutations.get(binder);

  if (!mutations) {
    mutations = [];
    groupedMutations.set(binder, mutations);
  }

  mutations.push(record);
}

function onChildChange(mutations, observer) {
  var binders = observer.binders;
  var bindersLength = binders.length;
  var groupedMutations = new Map();

  for (var i = 0, ii = mutations.length; i < ii; ++i) {
    var record = mutations[i];
    var added = record.addedNodes;
    var removed = record.removedNodes;

    for (var j = 0, jj = removed.length; j < jj; ++j) {
      var node = removed[j];
      if (node.nodeType === 1) {
        for (var k = 0; k < bindersLength; ++k) {
          var binder = binders[k];
          if (binder.onRemove(node)) {
            trackMutation(groupedMutations, binder, record);
          }
        }
      }
    }

    for (var _j = 0, _jj = added.length; _j < _jj; ++_j) {
      var _node = added[_j];
      if (_node.nodeType === 1) {
        for (var _k = 0; _k < bindersLength; ++_k) {
          var _binder = binders[_k];
          if (_binder.onAdd(_node)) {
            trackMutation(groupedMutations, _binder, record);
          }
        }
      }
    }
  }

  groupedMutations.forEach(function (value, key) {
    if (key.changeHandler !== null) {
      key.viewModel[key.changeHandler](value);
    }
  });
}

var ChildObserverBinder = function () {
  function ChildObserverBinder(selector, viewHost, property, viewModel, controller, changeHandler, all) {
    

    this.selector = selector;
    this.viewHost = viewHost;
    this.property = property;
    this.viewModel = viewModel;
    this.controller = controller;
    this.changeHandler = changeHandler in viewModel ? changeHandler : null;
    this.usesShadowDOM = controller.behavior.usesShadowDOM;
    this.all = all;

    if (!this.usesShadowDOM && controller.view && controller.view.contentView) {
      this.contentView = controller.view.contentView;
    } else {
      this.contentView = null;
    }
  }

  ChildObserverBinder.prototype.matches = function matches(element) {
    if (element.matches(this.selector)) {
      if (this.contentView === null) {
        return true;
      }

      var contentView = this.contentView;
      var assignedSlot = element.auAssignedSlot;

      if (assignedSlot && assignedSlot.projectFromAnchors) {
        var anchors = assignedSlot.projectFromAnchors;

        for (var i = 0, ii = anchors.length; i < ii; ++i) {
          if (anchors[i].auOwnerView === contentView) {
            return true;
          }
        }

        return false;
      }

      return element.auOwnerView === contentView;
    }

    return false;
  };

  ChildObserverBinder.prototype.bind = function bind(source) {
    var viewHost = this.viewHost;
    var viewModel = this.viewModel;
    var observer = viewHost.__childObserver__;

    if (!observer) {
      observer = viewHost.__childObserver__ = _aureliaPal.DOM.createMutationObserver(onChildChange);

      var options = {
        childList: true,
        subtree: !this.usesShadowDOM
      };

      observer.observe(viewHost, options);
      observer.binders = [];
    }

    observer.binders.push(this);

    if (this.usesShadowDOM) {
      var current = viewHost.firstElementChild;

      if (this.all) {
        var items = viewModel[this.property];
        if (!items) {
          items = viewModel[this.property] = [];
        } else {
          items.length = 0;
        }

        while (current) {
          if (this.matches(current)) {
            items.push(current.au && current.au.controller ? current.au.controller.viewModel : current);
          }

          current = current.nextElementSibling;
        }

        if (this.changeHandler !== null) {
          this.viewModel[this.changeHandler](noMutations);
        }
      } else {
        while (current) {
          if (this.matches(current)) {
            var value = current.au && current.au.controller ? current.au.controller.viewModel : current;
            this.viewModel[this.property] = value;

            if (this.changeHandler !== null) {
              this.viewModel[this.changeHandler](value);
            }

            break;
          }

          current = current.nextElementSibling;
        }
      }
    }
  };

  ChildObserverBinder.prototype.onRemove = function onRemove(element) {
    if (this.matches(element)) {
      var value = element.au && element.au.controller ? element.au.controller.viewModel : element;

      if (this.all) {
        var items = this.viewModel[this.property] || (this.viewModel[this.property] = []);
        var index = items.indexOf(value);

        if (index !== -1) {
          items.splice(index, 1);
        }

        return true;
      }

      return false;
    }

    return false;
  };

  ChildObserverBinder.prototype.onAdd = function onAdd(element) {
    if (this.matches(element)) {
      var value = element.au && element.au.controller ? element.au.controller.viewModel : element;

      if (this.all) {
        var items = this.viewModel[this.property] || (this.viewModel[this.property] = []);
        var index = 0;
        var prev = element.previousElementSibling;

        while (prev) {
          if (this.matches(prev)) {
            index++;
          }

          prev = prev.previousElementSibling;
        }

        items.splice(index, 0, value);
        return true;
      }

      this.viewModel[this.property] = value;

      if (this.changeHandler !== null) {
        this.viewModel[this.changeHandler](value);
      }
    }

    return false;
  };

  ChildObserverBinder.prototype.unbind = function unbind() {
    if (this.viewHost.__childObserver__) {
      this.viewHost.__childObserver__.disconnect();
      this.viewHost.__childObserver__ = null;
    }
  };

  return ChildObserverBinder;
}();

function tryActivateViewModel(context) {
  if (context.skipActivation || typeof context.viewModel.activate !== 'function') {
    return Promise.resolve();
  }

  return context.viewModel.activate(context.model) || Promise.resolve();
}

var CompositionEngine = exports.CompositionEngine = (_dec10 = (0, _aureliaDependencyInjection.inject)(ViewEngine, ViewLocator), _dec10(_class21 = function () {
  function CompositionEngine(viewEngine, viewLocator) {
    

    this.viewEngine = viewEngine;
    this.viewLocator = viewLocator;
  }

  CompositionEngine.prototype._createControllerAndSwap = function _createControllerAndSwap(context) {
    function swap(controller) {
      return Promise.resolve(context.viewSlot.removeAll(true)).then(function () {
        if (context.currentController) {
          context.currentController.unbind();
        }

        context.viewSlot.add(controller.view);

        if (context.compositionTransactionNotifier) {
          context.compositionTransactionNotifier.done();
        }

        return controller;
      });
    }

    return this.createController(context).then(function (controller) {
      controller.automate(context.overrideContext, context.owningView);

      if (context.compositionTransactionOwnershipToken) {
        return context.compositionTransactionOwnershipToken.waitForCompositionComplete().then(function () {
          return swap(controller);
        });
      }

      return swap(controller);
    });
  };

  CompositionEngine.prototype.createController = function createController(context) {
    var _this14 = this;

    var childContainer = void 0;
    var viewModel = void 0;
    var viewModelResource = void 0;
    var m = void 0;

    return this.ensureViewModel(context).then(tryActivateViewModel).then(function () {
      childContainer = context.childContainer;
      viewModel = context.viewModel;
      viewModelResource = context.viewModelResource;
      m = viewModelResource.metadata;

      var viewStrategy = _this14.viewLocator.getViewStrategy(context.view || viewModel);

      if (context.viewResources) {
        viewStrategy.makeRelativeTo(context.viewResources.viewUrl);
      }

      return m.load(childContainer, viewModelResource.value, null, viewStrategy, true);
    }).then(function (viewFactory) {
      return m.create(childContainer, BehaviorInstruction.dynamic(context.host, viewModel, viewFactory));
    });
  };

  CompositionEngine.prototype.ensureViewModel = function ensureViewModel(context) {
    var childContainer = context.childContainer = context.childContainer || context.container.createChild();

    if (typeof context.viewModel === 'string') {
      context.viewModel = context.viewResources ? context.viewResources.relativeToView(context.viewModel) : context.viewModel;

      return this.viewEngine.importViewModelResource(context.viewModel).then(function (viewModelResource) {
        childContainer.autoRegister(viewModelResource.value);

        if (context.host) {
          childContainer.registerInstance(_aureliaPal.DOM.Element, context.host);
        }

        context.viewModel = childContainer.viewModel = childContainer.get(viewModelResource.value);
        context.viewModelResource = viewModelResource;
        return context;
      });
    }

    var m = _aureliaMetadata.metadata.getOrCreateOwn(_aureliaMetadata.metadata.resource, HtmlBehaviorResource, context.viewModel.constructor);
    m.elementName = m.elementName || 'dynamic-element';
    m.initialize(context.container || childContainer, context.viewModel.constructor);
    context.viewModelResource = { metadata: m, value: context.viewModel.constructor };
    childContainer.viewModel = context.viewModel;
    return Promise.resolve(context);
  };

  CompositionEngine.prototype.compose = function compose(context) {
    context.childContainer = context.childContainer || context.container.createChild();
    context.view = this.viewLocator.getViewStrategy(context.view);

    var transaction = context.childContainer.get(CompositionTransaction);
    var compositionTransactionOwnershipToken = transaction.tryCapture();

    if (compositionTransactionOwnershipToken) {
      context.compositionTransactionOwnershipToken = compositionTransactionOwnershipToken;
    } else {
      context.compositionTransactionNotifier = transaction.enlist();
    }

    if (context.viewModel) {
      return this._createControllerAndSwap(context);
    } else if (context.view) {
      if (context.viewResources) {
        context.view.makeRelativeTo(context.viewResources.viewUrl);
      }

      return context.view.loadViewFactory(this.viewEngine, new ViewCompileInstruction()).then(function (viewFactory) {
        var result = viewFactory.create(context.childContainer);
        result.bind(context.bindingContext, context.overrideContext);

        var work = function work() {
          return Promise.resolve(context.viewSlot.removeAll(true)).then(function () {
            context.viewSlot.add(result);

            if (context.compositionTransactionNotifier) {
              context.compositionTransactionNotifier.done();
            }

            return result;
          });
        };

        if (context.compositionTransactionOwnershipToken) {
          return context.compositionTransactionOwnershipToken.waitForCompositionComplete().then(work);
        }

        return work();
      });
    } else if (context.viewSlot) {
      context.viewSlot.removeAll();

      if (context.compositionTransactionNotifier) {
        context.compositionTransactionNotifier.done();
      }

      return Promise.resolve(null);
    }

    return Promise.resolve(null);
  };

  return CompositionEngine;
}()) || _class21);

var ElementConfigResource = exports.ElementConfigResource = function () {
  function ElementConfigResource() {
    
  }

  ElementConfigResource.prototype.initialize = function initialize(container, target) {};

  ElementConfigResource.prototype.register = function register(registry, name) {};

  ElementConfigResource.prototype.load = function load(container, target) {
    var config = new target();
    var eventManager = container.get(_aureliaBinding.EventManager);
    eventManager.registerElementConfig(config);
  };

  return ElementConfigResource;
}();

function validateBehaviorName(name, type) {
  if (/[A-Z]/.test(name)) {
    var newName = _hyphenate(name);
    LogManager.getLogger('templating').warn('\'' + name + '\' is not a valid ' + type + ' name and has been converted to \'' + newName + '\'. Upper-case letters are not allowed because the DOM is not case-sensitive.');
    return newName;
  }
  return name;
}

function resource(instance) {
  return function (target) {
    _aureliaMetadata.metadata.define(_aureliaMetadata.metadata.resource, instance, target);
  };
}

function behavior(override) {
  return function (target) {
    if (override instanceof HtmlBehaviorResource) {
      _aureliaMetadata.metadata.define(_aureliaMetadata.metadata.resource, override, target);
    } else {
      var r = _aureliaMetadata.metadata.getOrCreateOwn(_aureliaMetadata.metadata.resource, HtmlBehaviorResource, target);
      Object.assign(r, override);
    }
  };
}

function customElement(name) {
  return function (target) {
    var r = _aureliaMetadata.metadata.getOrCreateOwn(_aureliaMetadata.metadata.resource, HtmlBehaviorResource, target);
    r.elementName = validateBehaviorName(name, 'custom element');
  };
}

function customAttribute(name, defaultBindingMode) {
  return function (target) {
    var r = _aureliaMetadata.metadata.getOrCreateOwn(_aureliaMetadata.metadata.resource, HtmlBehaviorResource, target);
    r.attributeName = validateBehaviorName(name, 'custom attribute');
    r.attributeDefaultBindingMode = defaultBindingMode;
  };
}

function templateController(target) {
  var deco = function deco(t) {
    var r = _aureliaMetadata.metadata.getOrCreateOwn(_aureliaMetadata.metadata.resource, HtmlBehaviorResource, t);
    r.liftsContent = true;
  };

  return target ? deco(target) : deco;
}

function bindable(nameOrConfigOrTarget, key, descriptor) {
  var deco = function deco(target, key2, descriptor2) {
    var actualTarget = key2 ? target.constructor : target;
    var r = _aureliaMetadata.metadata.getOrCreateOwn(_aureliaMetadata.metadata.resource, HtmlBehaviorResource, actualTarget);
    var prop = void 0;

    if (key2) {
      nameOrConfigOrTarget = nameOrConfigOrTarget || {};
      nameOrConfigOrTarget.name = key2;
    }

    prop = new BindableProperty(nameOrConfigOrTarget);
    return prop.registerWith(actualTarget, r, descriptor2);
  };

  if (!nameOrConfigOrTarget) {
    return deco;
  }

  if (key) {
    var target = nameOrConfigOrTarget;
    nameOrConfigOrTarget = null;
    return deco(target, key, descriptor);
  }

  return deco;
}

function dynamicOptions(target) {
  var deco = function deco(t) {
    var r = _aureliaMetadata.metadata.getOrCreateOwn(_aureliaMetadata.metadata.resource, HtmlBehaviorResource, t);
    r.hasDynamicOptions = true;
  };

  return target ? deco(target) : deco;
}

var defaultShadowDOMOptions = { mode: 'open' };
function useShadowDOM(targetOrOptions) {
  var options = typeof targetOrOptions === 'function' || !targetOrOptions ? defaultShadowDOMOptions : targetOrOptions;

  var deco = function deco(t) {
    var r = _aureliaMetadata.metadata.getOrCreateOwn(_aureliaMetadata.metadata.resource, HtmlBehaviorResource, t);
    r.targetShadowDOM = true;
    r.shadowDOMOptions = options;
  };

  return typeof targetOrOptions === 'function' ? deco(targetOrOptions) : deco;
}

function processAttributes(processor) {
  return function (t) {
    var r = _aureliaMetadata.metadata.getOrCreateOwn(_aureliaMetadata.metadata.resource, HtmlBehaviorResource, t);
    r.processAttributes = function (compiler, resources, node, attributes, elementInstruction) {
      try {
        processor(compiler, resources, node, attributes, elementInstruction);
      } catch (error) {
        LogManager.getLogger('templating').error(error);
      }
    };
  };
}

function doNotProcessContent() {
  return false;
}

function processContent(processor) {
  return function (t) {
    var r = _aureliaMetadata.metadata.getOrCreateOwn(_aureliaMetadata.metadata.resource, HtmlBehaviorResource, t);
    r.processContent = processor ? function (compiler, resources, node, instruction) {
      try {
        return processor(compiler, resources, node, instruction);
      } catch (error) {
        LogManager.getLogger('templating').error(error);
        return false;
      }
    } : doNotProcessContent;
  };
}

function containerless(target) {
  var deco = function deco(t) {
    var r = _aureliaMetadata.metadata.getOrCreateOwn(_aureliaMetadata.metadata.resource, HtmlBehaviorResource, t);
    r.containerless = true;
  };

  return target ? deco(target) : deco;
}

function useViewStrategy(strategy) {
  return function (target) {
    _aureliaMetadata.metadata.define(ViewLocator.viewStrategyMetadataKey, strategy, target);
  };
}

function useView(path) {
  return useViewStrategy(new RelativeViewStrategy(path));
}

function inlineView(markup, dependencies, dependencyBaseUrl) {
  return useViewStrategy(new InlineViewStrategy(markup, dependencies, dependencyBaseUrl));
}

function noView(target) {
  var deco = function deco(t) {
    _aureliaMetadata.metadata.define(ViewLocator.viewStrategyMetadataKey, new NoViewStrategy(), t);
  };

  return target ? deco(target) : deco;
}

function elementConfig(target) {
  var deco = function deco(t) {
    _aureliaMetadata.metadata.define(_aureliaMetadata.metadata.resource, new ElementConfigResource(), t);
  };

  return target ? deco(target) : deco;
}

var TemplatingEngine = exports.TemplatingEngine = (_dec11 = (0, _aureliaDependencyInjection.inject)(_aureliaDependencyInjection.Container, ModuleAnalyzer, ViewCompiler, CompositionEngine), _dec11(_class22 = function () {
  function TemplatingEngine(container, moduleAnalyzer, viewCompiler, compositionEngine) {
    

    this._container = container;
    this._moduleAnalyzer = moduleAnalyzer;
    this._viewCompiler = viewCompiler;
    this._compositionEngine = compositionEngine;
    container.registerInstance(Animator, Animator.instance = new Animator());
  }

  TemplatingEngine.prototype.configureAnimator = function configureAnimator(animator) {
    this._container.unregister(Animator);
    this._container.registerInstance(Animator, Animator.instance = animator);
  };

  TemplatingEngine.prototype.compose = function compose(context) {
    return this._compositionEngine.compose(context);
  };

  TemplatingEngine.prototype.enhance = function enhance(instruction) {
    if (instruction instanceof _aureliaPal.DOM.Element) {
      instruction = { element: instruction };
    }

    var compilerInstructions = {};
    var resources = instruction.resources || this._container.get(ViewResources);

    this._viewCompiler._compileNode(instruction.element, resources, compilerInstructions, instruction.element.parentNode, 'root', true);

    var factory = new ViewFactory(instruction.element, compilerInstructions, resources);
    var container = instruction.container || this._container.createChild();
    var view = factory.create(container, BehaviorInstruction.enhance());

    view.bind(instruction.bindingContext || {}, instruction.overrideContext);

    return view;
  };

  return TemplatingEngine;
}()) || _class22);
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))

/***/ },
/* 4 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getSetObserver = exports.BindingEngine = exports.NameExpression = exports.Listener = exports.ListenerExpression = exports.BindingBehaviorResource = exports.ValueConverterResource = exports.Call = exports.CallExpression = exports.Binding = exports.BindingExpression = exports.ObjectObservationAdapter = exports.ObserverLocator = exports.SVGAnalyzer = exports.presentationAttributes = exports.presentationElements = exports.elements = exports.ComputedExpression = exports.ClassObserver = exports.SelectValueObserver = exports.CheckedObserver = exports.ValueAttributeObserver = exports.StyleObserver = exports.DataAttributeObserver = exports.dataAttributeAccessor = exports.XLinkAttributeObserver = exports.SetterObserver = exports.PrimitiveObserver = exports.propertyAccessor = exports.DirtyCheckProperty = exports.DirtyChecker = exports.EventManager = exports.getMapObserver = exports.ParserImplementation = exports.Parser = exports.Scanner = exports.Lexer = exports.Token = exports.bindingMode = exports.ExpressionCloner = exports.Unparser = exports.LiteralObject = exports.LiteralArray = exports.LiteralString = exports.LiteralPrimitive = exports.PrefixNot = exports.Binary = exports.CallFunction = exports.CallMember = exports.CallScope = exports.AccessKeyed = exports.AccessMember = exports.AccessScope = exports.AccessThis = exports.Conditional = exports.Assign = exports.ValueConverter = exports.BindingBehavior = exports.Chain = exports.Expression = exports.getArrayObserver = exports.CollectionLengthObserver = exports.ModifyCollectionObserver = exports.ExpressionObserver = exports.sourceContext = undefined;

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _dec, _dec2, _class, _dec3, _class2, _dec4, _class3, _dec5, _class5, _dec6, _class7, _dec7, _class8, _dec8, _class9, _dec9, _class10, _class11, _temp, _dec10, _class12, _class13, _temp2;

exports.camelCase = camelCase;
exports.createOverrideContext = createOverrideContext;
exports.getContextFor = getContextFor;
exports.createScopeForTest = createScopeForTest;
exports.connectable = connectable;
exports.enqueueBindingConnect = enqueueBindingConnect;
exports.subscriberCollection = subscriberCollection;
exports.calcSplices = calcSplices;
exports.mergeSplice = mergeSplice;
exports.projectArraySplices = projectArraySplices;
exports.getChangeRecords = getChangeRecords;
exports.cloneExpression = cloneExpression;
exports.hasDeclaredDependencies = hasDeclaredDependencies;
exports.declarePropertyDependencies = declarePropertyDependencies;
exports.computedFrom = computedFrom;
exports.createComputedObserver = createComputedObserver;
exports.valueConverter = valueConverter;
exports.bindingBehavior = bindingBehavior;
exports.observable = observable;

var _aureliaLogging = __webpack_require__(7);

var LogManager = _interopRequireWildcard(_aureliaLogging);

var _aureliaPal = __webpack_require__(2);

var _aureliaTaskQueue = __webpack_require__(11);

var _aureliaMetadata = __webpack_require__(6);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }



var map = Object.create(null);

function camelCase(name) {
  if (name in map) {
    return map[name];
  }
  var result = name.charAt(0).toLowerCase() + name.slice(1).replace(/[_.-](\w|$)/g, function (_, x) {
    return x.toUpperCase();
  });
  map[name] = result;
  return result;
}

function createOverrideContext(bindingContext, parentOverrideContext) {
  return {
    bindingContext: bindingContext,
    parentOverrideContext: parentOverrideContext || null
  };
}

function getContextFor(name, scope, ancestor) {
  var oc = scope.overrideContext;

  if (ancestor) {
    while (ancestor && oc) {
      ancestor--;
      oc = oc.parentOverrideContext;
    }
    if (ancestor || !oc) {
      return undefined;
    }
    return name in oc ? oc : oc.bindingContext;
  }

  while (oc && !(name in oc) && !(oc.bindingContext && name in oc.bindingContext)) {
    oc = oc.parentOverrideContext;
  }
  if (oc) {
    return name in oc ? oc : oc.bindingContext;
  }

  return scope.bindingContext || scope.overrideContext;
}

function createScopeForTest(bindingContext, parentBindingContext) {
  if (parentBindingContext) {
    return {
      bindingContext: bindingContext,
      overrideContext: createOverrideContext(bindingContext, createOverrideContext(parentBindingContext))
    };
  }
  return {
    bindingContext: bindingContext,
    overrideContext: createOverrideContext(bindingContext)
  };
}

var sourceContext = exports.sourceContext = 'Binding:source';
var slotNames = [];
var versionSlotNames = [];

for (var i = 0; i < 100; i++) {
  slotNames.push('_observer' + i);
  versionSlotNames.push('_observerVersion' + i);
}

function addObserver(observer) {
  var observerSlots = this._observerSlots === undefined ? 0 : this._observerSlots;
  var i = observerSlots;
  while (i-- && this[slotNames[i]] !== observer) {}

  if (i === -1) {
    i = 0;
    while (this[slotNames[i]]) {
      i++;
    }
    this[slotNames[i]] = observer;
    observer.subscribe(sourceContext, this);

    if (i === observerSlots) {
      this._observerSlots = i + 1;
    }
  }

  if (this._version === undefined) {
    this._version = 0;
  }
  this[versionSlotNames[i]] = this._version;
}

function observeProperty(obj, propertyName) {
  var observer = this.observerLocator.getObserver(obj, propertyName);
  addObserver.call(this, observer);
}

function observeArray(array) {
  var observer = this.observerLocator.getArrayObserver(array);
  addObserver.call(this, observer);
}

function unobserve(all) {
  var i = this._observerSlots;
  while (i--) {
    if (all || this[versionSlotNames[i]] !== this._version) {
      var observer = this[slotNames[i]];
      this[slotNames[i]] = null;
      if (observer) {
        observer.unsubscribe(sourceContext, this);
      }
    }
  }
}

function connectable() {
  return function (target) {
    target.prototype.observeProperty = observeProperty;
    target.prototype.observeArray = observeArray;
    target.prototype.unobserve = unobserve;
    target.prototype.addObserver = addObserver;
  };
}

var bindings = new Map();
var minimumImmediate = 100;
var frameBudget = 15;

var isFlushRequested = false;
var immediate = 0;

function flush(animationFrameStart) {
  var i = 0;
  var keys = bindings.keys();
  var item = void 0;

  while (item = keys.next()) {
    if (item.done) {
      break;
    }

    var binding = item.value;
    bindings.delete(binding);
    binding.connect(true);
    i++;

    if (i % 100 === 0 && _aureliaPal.PLATFORM.performance.now() - animationFrameStart > frameBudget) {
      break;
    }
  }

  if (bindings.size) {
    _aureliaPal.PLATFORM.requestAnimationFrame(flush);
  } else {
    isFlushRequested = false;
    immediate = 0;
  }
}

function enqueueBindingConnect(binding) {
  if (immediate < minimumImmediate) {
    immediate++;
    binding.connect(false);
  } else {
    bindings.set(binding);
  }
  if (!isFlushRequested) {
    isFlushRequested = true;
    _aureliaPal.PLATFORM.requestAnimationFrame(flush);
  }
}

function addSubscriber(context, callable) {
  if (this.hasSubscriber(context, callable)) {
    return false;
  }
  if (!this._context0) {
    this._context0 = context;
    this._callable0 = callable;
    return true;
  }
  if (!this._context1) {
    this._context1 = context;
    this._callable1 = callable;
    return true;
  }
  if (!this._context2) {
    this._context2 = context;
    this._callable2 = callable;
    return true;
  }
  if (!this._contextsRest) {
    this._contextsRest = [context];
    this._callablesRest = [callable];
    return true;
  }
  this._contextsRest.push(context);
  this._callablesRest.push(callable);
  return true;
}

function removeSubscriber(context, callable) {
  if (this._context0 === context && this._callable0 === callable) {
    this._context0 = null;
    this._callable0 = null;
    return true;
  }
  if (this._context1 === context && this._callable1 === callable) {
    this._context1 = null;
    this._callable1 = null;
    return true;
  }
  if (this._context2 === context && this._callable2 === callable) {
    this._context2 = null;
    this._callable2 = null;
    return true;
  }
  var rest = this._contextsRest;
  var index = void 0;
  if (!rest || !rest.length || (index = rest.indexOf(context)) === -1 || this._callablesRest[index] !== callable) {
    return false;
  }
  rest.splice(index, 1);
  this._callablesRest.splice(index, 1);
  return true;
}

var arrayPool1 = [];
var arrayPool2 = [];
var poolUtilization = [];

function callSubscribers(newValue, oldValue) {
  var context0 = this._context0;
  var callable0 = this._callable0;
  var context1 = this._context1;
  var callable1 = this._callable1;
  var context2 = this._context2;
  var callable2 = this._callable2;
  var length = this._contextsRest ? this._contextsRest.length : 0;
  var contextsRest = void 0;
  var callablesRest = void 0;
  var poolIndex = void 0;
  var i = void 0;
  if (length) {
    poolIndex = poolUtilization.length;
    while (poolIndex-- && poolUtilization[poolIndex]) {}
    if (poolIndex < 0) {
      poolIndex = poolUtilization.length;
      contextsRest = [];
      callablesRest = [];
      poolUtilization.push(true);
      arrayPool1.push(contextsRest);
      arrayPool2.push(callablesRest);
    } else {
      poolUtilization[poolIndex] = true;
      contextsRest = arrayPool1[poolIndex];
      callablesRest = arrayPool2[poolIndex];
    }

    i = length;
    while (i--) {
      contextsRest[i] = this._contextsRest[i];
      callablesRest[i] = this._callablesRest[i];
    }
  }

  if (context0) {
    if (callable0) {
      callable0.call(context0, newValue, oldValue);
    } else {
      context0(newValue, oldValue);
    }
  }
  if (context1) {
    if (callable1) {
      callable1.call(context1, newValue, oldValue);
    } else {
      context1(newValue, oldValue);
    }
  }
  if (context2) {
    if (callable2) {
      callable2.call(context2, newValue, oldValue);
    } else {
      context2(newValue, oldValue);
    }
  }
  if (length) {
    for (i = 0; i < length; i++) {
      var callable = callablesRest[i];
      var context = contextsRest[i];
      if (callable) {
        callable.call(context, newValue, oldValue);
      } else {
        context(newValue, oldValue);
      }
      contextsRest[i] = null;
      callablesRest[i] = null;
    }
    poolUtilization[poolIndex] = false;
  }
}

function hasSubscribers() {
  return !!(this._context0 || this._context1 || this._context2 || this._contextsRest && this._contextsRest.length);
}

function hasSubscriber(context, callable) {
  var has = this._context0 === context && this._callable0 === callable || this._context1 === context && this._callable1 === callable || this._context2 === context && this._callable2 === callable;
  if (has) {
    return true;
  }
  var index = void 0;
  var contexts = this._contextsRest;
  if (!contexts || (index = contexts.length) === 0) {
    return false;
  }
  var callables = this._callablesRest;
  while (index--) {
    if (contexts[index] === context && callables[index] === callable) {
      return true;
    }
  }
  return false;
}

function subscriberCollection() {
  return function (target) {
    target.prototype.addSubscriber = addSubscriber;
    target.prototype.removeSubscriber = removeSubscriber;
    target.prototype.callSubscribers = callSubscribers;
    target.prototype.hasSubscribers = hasSubscribers;
    target.prototype.hasSubscriber = hasSubscriber;
  };
}

var ExpressionObserver = exports.ExpressionObserver = (_dec = connectable(), _dec2 = subscriberCollection(), _dec(_class = _dec2(_class = function () {
  function ExpressionObserver(scope, expression, observerLocator, lookupFunctions) {
    

    this.scope = scope;
    this.expression = expression;
    this.observerLocator = observerLocator;
    this.lookupFunctions = lookupFunctions;
  }

  ExpressionObserver.prototype.getValue = function getValue() {
    return this.expression.evaluate(this.scope, this.lookupFunctions);
  };

  ExpressionObserver.prototype.setValue = function setValue(newValue) {
    this.expression.assign(this.scope, newValue);
  };

  ExpressionObserver.prototype.subscribe = function subscribe(context, callable) {
    var _this = this;

    if (!this.hasSubscribers()) {
      this.oldValue = this.expression.evaluate(this.scope, this.lookupFunctions);
      this.expression.connect(this, this.scope);
    }
    this.addSubscriber(context, callable);
    if (arguments.length === 1 && context instanceof Function) {
      return {
        dispose: function dispose() {
          _this.unsubscribe(context, callable);
        }
      };
    }
  };

  ExpressionObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    if (this.removeSubscriber(context, callable) && !this.hasSubscribers()) {
      this.unobserve(true);
      this.oldValue = undefined;
    }
  };

  ExpressionObserver.prototype.call = function call() {
    var newValue = this.expression.evaluate(this.scope, this.lookupFunctions);
    var oldValue = this.oldValue;
    if (newValue !== oldValue) {
      this.oldValue = newValue;
      this.callSubscribers(newValue, oldValue);
    }
    this._version++;
    this.expression.connect(this, this.scope);
    this.unobserve(false);
  };

  return ExpressionObserver;
}()) || _class) || _class);


function isIndex(s) {
  return +s === s >>> 0;
}

function toNumber(s) {
  return +s;
}

function newSplice(index, removed, addedCount) {
  return {
    index: index,
    removed: removed,
    addedCount: addedCount
  };
}

var EDIT_LEAVE = 0;
var EDIT_UPDATE = 1;
var EDIT_ADD = 2;
var EDIT_DELETE = 3;

function ArraySplice() {}

ArraySplice.prototype = {
  calcEditDistances: function calcEditDistances(current, currentStart, currentEnd, old, oldStart, oldEnd) {
    var rowCount = oldEnd - oldStart + 1;
    var columnCount = currentEnd - currentStart + 1;
    var distances = new Array(rowCount);
    var north = void 0;
    var west = void 0;

    for (var _i = 0; _i < rowCount; ++_i) {
      distances[_i] = new Array(columnCount);
      distances[_i][0] = _i;
    }

    for (var j = 0; j < columnCount; ++j) {
      distances[0][j] = j;
    }

    for (var _i2 = 1; _i2 < rowCount; ++_i2) {
      for (var _j = 1; _j < columnCount; ++_j) {
        if (this.equals(current[currentStart + _j - 1], old[oldStart + _i2 - 1])) {
          distances[_i2][_j] = distances[_i2 - 1][_j - 1];
        } else {
          north = distances[_i2 - 1][_j] + 1;
          west = distances[_i2][_j - 1] + 1;
          distances[_i2][_j] = north < west ? north : west;
        }
      }
    }

    return distances;
  },

  spliceOperationsFromEditDistances: function spliceOperationsFromEditDistances(distances) {
    var i = distances.length - 1;
    var j = distances[0].length - 1;
    var current = distances[i][j];
    var edits = [];
    while (i > 0 || j > 0) {
      if (i === 0) {
        edits.push(EDIT_ADD);
        j--;
        continue;
      }
      if (j === 0) {
        edits.push(EDIT_DELETE);
        i--;
        continue;
      }
      var northWest = distances[i - 1][j - 1];
      var west = distances[i - 1][j];
      var north = distances[i][j - 1];

      var min = void 0;
      if (west < north) {
        min = west < northWest ? west : northWest;
      } else {
        min = north < northWest ? north : northWest;
      }

      if (min === northWest) {
        if (northWest === current) {
          edits.push(EDIT_LEAVE);
        } else {
          edits.push(EDIT_UPDATE);
          current = northWest;
        }
        i--;
        j--;
      } else if (min === west) {
        edits.push(EDIT_DELETE);
        i--;
        current = west;
      } else {
        edits.push(EDIT_ADD);
        j--;
        current = north;
      }
    }

    edits.reverse();
    return edits;
  },

  calcSplices: function calcSplices(current, currentStart, currentEnd, old, oldStart, oldEnd) {
    var prefixCount = 0;
    var suffixCount = 0;

    var minLength = Math.min(currentEnd - currentStart, oldEnd - oldStart);
    if (currentStart === 0 && oldStart === 0) {
      prefixCount = this.sharedPrefix(current, old, minLength);
    }

    if (currentEnd === current.length && oldEnd === old.length) {
      suffixCount = this.sharedSuffix(current, old, minLength - prefixCount);
    }

    currentStart += prefixCount;
    oldStart += prefixCount;
    currentEnd -= suffixCount;
    oldEnd -= suffixCount;

    if (currentEnd - currentStart === 0 && oldEnd - oldStart === 0) {
      return [];
    }

    if (currentStart === currentEnd) {
      var _splice = newSplice(currentStart, [], 0);
      while (oldStart < oldEnd) {
        _splice.removed.push(old[oldStart++]);
      }

      return [_splice];
    } else if (oldStart === oldEnd) {
      return [newSplice(currentStart, [], currentEnd - currentStart)];
    }

    var ops = this.spliceOperationsFromEditDistances(this.calcEditDistances(current, currentStart, currentEnd, old, oldStart, oldEnd));

    var splice = undefined;
    var splices = [];
    var index = currentStart;
    var oldIndex = oldStart;
    for (var _i3 = 0; _i3 < ops.length; ++_i3) {
      switch (ops[_i3]) {
        case EDIT_LEAVE:
          if (splice) {
            splices.push(splice);
            splice = undefined;
          }

          index++;
          oldIndex++;
          break;
        case EDIT_UPDATE:
          if (!splice) {
            splice = newSplice(index, [], 0);
          }

          splice.addedCount++;
          index++;

          splice.removed.push(old[oldIndex]);
          oldIndex++;
          break;
        case EDIT_ADD:
          if (!splice) {
            splice = newSplice(index, [], 0);
          }

          splice.addedCount++;
          index++;
          break;
        case EDIT_DELETE:
          if (!splice) {
            splice = newSplice(index, [], 0);
          }

          splice.removed.push(old[oldIndex]);
          oldIndex++;
          break;
      }
    }

    if (splice) {
      splices.push(splice);
    }
    return splices;
  },

  sharedPrefix: function sharedPrefix(current, old, searchLength) {
    for (var _i4 = 0; _i4 < searchLength; ++_i4) {
      if (!this.equals(current[_i4], old[_i4])) {
        return _i4;
      }
    }

    return searchLength;
  },

  sharedSuffix: function sharedSuffix(current, old, searchLength) {
    var index1 = current.length;
    var index2 = old.length;
    var count = 0;
    while (count < searchLength && this.equals(current[--index1], old[--index2])) {
      count++;
    }

    return count;
  },

  calculateSplices: function calculateSplices(current, previous) {
    return this.calcSplices(current, 0, current.length, previous, 0, previous.length);
  },

  equals: function equals(currentValue, previousValue) {
    return currentValue === previousValue;
  }
};

var arraySplice = new ArraySplice();

function calcSplices(current, currentStart, currentEnd, old, oldStart, oldEnd) {
  return arraySplice.calcSplices(current, currentStart, currentEnd, old, oldStart, oldEnd);
}

function intersect(start1, end1, start2, end2) {
  if (end1 < start2 || end2 < start1) {
    return -1;
  }

  if (end1 === start2 || end2 === start1) {
    return 0;
  }

  if (start1 < start2) {
    if (end1 < end2) {
      return end1 - start2;
    }

    return end2 - start2;
  }

  if (end2 < end1) {
    return end2 - start1;
  }

  return end1 - start1;
}

function mergeSplice(splices, index, removed, addedCount) {
  var splice = newSplice(index, removed, addedCount);

  var inserted = false;
  var insertionOffset = 0;

  for (var _i5 = 0; _i5 < splices.length; _i5++) {
    var current = splices[_i5];
    current.index += insertionOffset;

    if (inserted) {
      continue;
    }

    var intersectCount = intersect(splice.index, splice.index + splice.removed.length, current.index, current.index + current.addedCount);

    if (intersectCount >= 0) {

      splices.splice(_i5, 1);
      _i5--;

      insertionOffset -= current.addedCount - current.removed.length;

      splice.addedCount += current.addedCount - intersectCount;
      var deleteCount = splice.removed.length + current.removed.length - intersectCount;

      if (!splice.addedCount && !deleteCount) {
        inserted = true;
      } else {
        var currentRemoved = current.removed;

        if (splice.index < current.index) {
          var prepend = splice.removed.slice(0, current.index - splice.index);
          Array.prototype.push.apply(prepend, currentRemoved);
          currentRemoved = prepend;
        }

        if (splice.index + splice.removed.length > current.index + current.addedCount) {
          var append = splice.removed.slice(current.index + current.addedCount - splice.index);
          Array.prototype.push.apply(currentRemoved, append);
        }

        splice.removed = currentRemoved;
        if (current.index < splice.index) {
          splice.index = current.index;
        }
      }
    } else if (splice.index < current.index) {

      inserted = true;

      splices.splice(_i5, 0, splice);
      _i5++;

      var offset = splice.addedCount - splice.removed.length;
      current.index += offset;
      insertionOffset += offset;
    }
  }

  if (!inserted) {
    splices.push(splice);
  }
}

function createInitialSplices(array, changeRecords) {
  var splices = [];

  for (var _i6 = 0; _i6 < changeRecords.length; _i6++) {
    var record = changeRecords[_i6];
    switch (record.type) {
      case 'splice':
        mergeSplice(splices, record.index, record.removed.slice(), record.addedCount);
        break;
      case 'add':
      case 'update':
      case 'delete':
        if (!isIndex(record.name)) {
          continue;
        }

        var index = toNumber(record.name);
        if (index < 0) {
          continue;
        }

        mergeSplice(splices, index, [record.oldValue], record.type === 'delete' ? 0 : 1);
        break;
      default:
        console.error('Unexpected record type: ' + JSON.stringify(record));
        break;
    }
  }

  return splices;
}

function projectArraySplices(array, changeRecords) {
  var splices = [];

  createInitialSplices(array, changeRecords).forEach(function (splice) {
    if (splice.addedCount === 1 && splice.removed.length === 1) {
      if (splice.removed[0] !== array[splice.index]) {
        splices.push(splice);
      }

      return;
    }

    splices = splices.concat(calcSplices(array, splice.index, splice.index + splice.addedCount, splice.removed, 0, splice.removed.length));
  });

  return splices;
}

function newRecord(type, object, key, oldValue) {
  return {
    type: type,
    object: object,
    key: key,
    oldValue: oldValue
  };
}

function getChangeRecords(map) {
  var entries = new Array(map.size);
  var keys = map.keys();
  var i = 0;
  var item = void 0;

  while (item = keys.next()) {
    if (item.done) {
      break;
    }

    entries[i] = newRecord('added', map, item.value);
    i++;
  }

  return entries;
}

var ModifyCollectionObserver = exports.ModifyCollectionObserver = (_dec3 = subscriberCollection(), _dec3(_class2 = function () {
  function ModifyCollectionObserver(taskQueue, collection) {
    

    this.taskQueue = taskQueue;
    this.queued = false;
    this.changeRecords = null;
    this.oldCollection = null;
    this.collection = collection;
    this.lengthPropertyName = collection instanceof Map || collection instanceof Set ? 'size' : 'length';
  }

  ModifyCollectionObserver.prototype.subscribe = function subscribe(context, callable) {
    this.addSubscriber(context, callable);
  };

  ModifyCollectionObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    this.removeSubscriber(context, callable);
  };

  ModifyCollectionObserver.prototype.addChangeRecord = function addChangeRecord(changeRecord) {
    if (!this.hasSubscribers() && !this.lengthObserver) {
      return;
    }

    if (changeRecord.type === 'splice') {
      var index = changeRecord.index;
      var arrayLength = changeRecord.object.length;
      if (index > arrayLength) {
        index = arrayLength - changeRecord.addedCount;
      } else if (index < 0) {
        index = arrayLength + changeRecord.removed.length + index - changeRecord.addedCount;
      }
      if (index < 0) {
        index = 0;
      }
      changeRecord.index = index;
    }

    if (this.changeRecords === null) {
      this.changeRecords = [changeRecord];
    } else {
      this.changeRecords.push(changeRecord);
    }

    if (!this.queued) {
      this.queued = true;
      this.taskQueue.queueMicroTask(this);
    }
  };

  ModifyCollectionObserver.prototype.flushChangeRecords = function flushChangeRecords() {
    if (this.changeRecords && this.changeRecords.length || this.oldCollection) {
      this.call();
    }
  };

  ModifyCollectionObserver.prototype.reset = function reset(oldCollection) {
    this.oldCollection = oldCollection;

    if (this.hasSubscribers() && !this.queued) {
      this.queued = true;
      this.taskQueue.queueMicroTask(this);
    }
  };

  ModifyCollectionObserver.prototype.getLengthObserver = function getLengthObserver() {
    return this.lengthObserver || (this.lengthObserver = new CollectionLengthObserver(this.collection));
  };

  ModifyCollectionObserver.prototype.call = function call() {
    var changeRecords = this.changeRecords;
    var oldCollection = this.oldCollection;
    var records = void 0;

    this.queued = false;
    this.changeRecords = [];
    this.oldCollection = null;

    if (this.hasSubscribers()) {
      if (oldCollection) {
        if (this.collection instanceof Map || this.collection instanceof Set) {
          records = getChangeRecords(oldCollection);
        } else {
          records = calcSplices(this.collection, 0, this.collection.length, oldCollection, 0, oldCollection.length);
        }
      } else {
        if (this.collection instanceof Map || this.collection instanceof Set) {
          records = changeRecords;
        } else {
          records = projectArraySplices(this.collection, changeRecords);
        }
      }

      this.callSubscribers(records);
    }

    if (this.lengthObserver) {
      this.lengthObserver.call(this.collection[this.lengthPropertyName]);
    }
  };

  return ModifyCollectionObserver;
}()) || _class2);
var CollectionLengthObserver = exports.CollectionLengthObserver = (_dec4 = subscriberCollection(), _dec4(_class3 = function () {
  function CollectionLengthObserver(collection) {
    

    this.collection = collection;
    this.lengthPropertyName = collection instanceof Map || collection instanceof Set ? 'size' : 'length';
    this.currentValue = collection[this.lengthPropertyName];
  }

  CollectionLengthObserver.prototype.getValue = function getValue() {
    return this.collection[this.lengthPropertyName];
  };

  CollectionLengthObserver.prototype.setValue = function setValue(newValue) {
    this.collection[this.lengthPropertyName] = newValue;
  };

  CollectionLengthObserver.prototype.subscribe = function subscribe(context, callable) {
    this.addSubscriber(context, callable);
  };

  CollectionLengthObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    this.removeSubscriber(context, callable);
  };

  CollectionLengthObserver.prototype.call = function call(newValue) {
    var oldValue = this.currentValue;
    this.callSubscribers(newValue, oldValue);
    this.currentValue = newValue;
  };

  return CollectionLengthObserver;
}()) || _class3);

var pop = Array.prototype.pop;
var push = Array.prototype.push;
var reverse = Array.prototype.reverse;
var shift = Array.prototype.shift;
var sort = Array.prototype.sort;
var splice = Array.prototype.splice;
var unshift = Array.prototype.unshift;

Array.prototype.pop = function () {
  var notEmpty = this.length > 0;
  var methodCallResult = pop.apply(this, arguments);
  if (notEmpty && this.__array_observer__ !== undefined) {
    this.__array_observer__.addChangeRecord({
      type: 'delete',
      object: this,
      name: this.length,
      oldValue: methodCallResult
    });
  }
  return methodCallResult;
};

Array.prototype.push = function () {
  var methodCallResult = push.apply(this, arguments);
  if (this.__array_observer__ !== undefined) {
    this.__array_observer__.addChangeRecord({
      type: 'splice',
      object: this,
      index: this.length - arguments.length,
      removed: [],
      addedCount: arguments.length
    });
  }
  return methodCallResult;
};

Array.prototype.reverse = function () {
  var oldArray = void 0;
  if (this.__array_observer__ !== undefined) {
    this.__array_observer__.flushChangeRecords();
    oldArray = this.slice();
  }
  var methodCallResult = reverse.apply(this, arguments);
  if (this.__array_observer__ !== undefined) {
    this.__array_observer__.reset(oldArray);
  }
  return methodCallResult;
};

Array.prototype.shift = function () {
  var notEmpty = this.length > 0;
  var methodCallResult = shift.apply(this, arguments);
  if (notEmpty && this.__array_observer__ !== undefined) {
    this.__array_observer__.addChangeRecord({
      type: 'delete',
      object: this,
      name: 0,
      oldValue: methodCallResult
    });
  }
  return methodCallResult;
};

Array.prototype.sort = function () {
  var oldArray = void 0;
  if (this.__array_observer__ !== undefined) {
    this.__array_observer__.flushChangeRecords();
    oldArray = this.slice();
  }
  var methodCallResult = sort.apply(this, arguments);
  if (this.__array_observer__ !== undefined) {
    this.__array_observer__.reset(oldArray);
  }
  return methodCallResult;
};

Array.prototype.splice = function () {
  var methodCallResult = splice.apply(this, arguments);
  if (this.__array_observer__ !== undefined) {
    this.__array_observer__.addChangeRecord({
      type: 'splice',
      object: this,
      index: arguments[0],
      removed: methodCallResult,
      addedCount: arguments.length > 2 ? arguments.length - 2 : 0
    });
  }
  return methodCallResult;
};

Array.prototype.unshift = function () {
  var methodCallResult = unshift.apply(this, arguments);
  if (this.__array_observer__ !== undefined) {
    this.__array_observer__.addChangeRecord({
      type: 'splice',
      object: this,
      index: 0,
      removed: [],
      addedCount: arguments.length
    });
  }
  return methodCallResult;
};

function _getArrayObserver(taskQueue, array) {
  return ModifyArrayObserver.for(taskQueue, array);
}

exports.getArrayObserver = _getArrayObserver;

var ModifyArrayObserver = function (_ModifyCollectionObse) {
  _inherits(ModifyArrayObserver, _ModifyCollectionObse);

  function ModifyArrayObserver(taskQueue, array) {
    

    return _possibleConstructorReturn(this, _ModifyCollectionObse.call(this, taskQueue, array));
  }

  ModifyArrayObserver.for = function _for(taskQueue, array) {
    if (!('__array_observer__' in array)) {
      var observer = ModifyArrayObserver.create(taskQueue, array);
      Reflect.defineProperty(array, '__array_observer__', { value: observer, enumerable: false, configurable: false });
    }
    return array.__array_observer__;
  };

  ModifyArrayObserver.create = function create(taskQueue, array) {
    var observer = new ModifyArrayObserver(taskQueue, array);
    return observer;
  };

  return ModifyArrayObserver;
}(ModifyCollectionObserver);

var Expression = exports.Expression = function () {
  function Expression() {
    

    this.isChain = false;
    this.isAssignable = false;
  }

  Expression.prototype.evaluate = function evaluate(scope, lookupFunctions, args) {
    throw new Error('Binding expression "' + this + '" cannot be evaluated.');
  };

  Expression.prototype.assign = function assign(scope, value, lookupFunctions) {
    throw new Error('Binding expression "' + this + '" cannot be assigned to.');
  };

  Expression.prototype.toString = function toString() {
    return Unparser.unparse(this);
  };

  return Expression;
}();

var Chain = exports.Chain = function (_Expression) {
  _inherits(Chain, _Expression);

  function Chain(expressions) {
    

    var _this3 = _possibleConstructorReturn(this, _Expression.call(this));

    _this3.expressions = expressions;
    _this3.isChain = true;
    return _this3;
  }

  Chain.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var result = void 0;
    var expressions = this.expressions;
    var last = void 0;

    for (var _i7 = 0, length = expressions.length; _i7 < length; ++_i7) {
      last = expressions[_i7].evaluate(scope, lookupFunctions);

      if (last !== null) {
        result = last;
      }
    }

    return result;
  };

  Chain.prototype.accept = function accept(visitor) {
    return visitor.visitChain(this);
  };

  return Chain;
}(Expression);

var BindingBehavior = exports.BindingBehavior = function (_Expression2) {
  _inherits(BindingBehavior, _Expression2);

  function BindingBehavior(expression, name, args) {
    

    var _this4 = _possibleConstructorReturn(this, _Expression2.call(this));

    _this4.expression = expression;
    _this4.name = name;
    _this4.args = args;
    return _this4;
  }

  BindingBehavior.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    return this.expression.evaluate(scope, lookupFunctions);
  };

  BindingBehavior.prototype.assign = function assign(scope, value, lookupFunctions) {
    return this.expression.assign(scope, value, lookupFunctions);
  };

  BindingBehavior.prototype.accept = function accept(visitor) {
    return visitor.visitBindingBehavior(this);
  };

  BindingBehavior.prototype.connect = function connect(binding, scope) {
    this.expression.connect(binding, scope);
  };

  BindingBehavior.prototype.bind = function bind(binding, scope, lookupFunctions) {
    if (this.expression.expression && this.expression.bind) {
      this.expression.bind(binding, scope, lookupFunctions);
    }
    var behavior = lookupFunctions.bindingBehaviors(this.name);
    if (!behavior) {
      throw new Error('No BindingBehavior named "' + this.name + '" was found!');
    }
    var behaviorKey = 'behavior-' + this.name;
    if (binding[behaviorKey]) {
      throw new Error('A binding behavior named "' + this.name + '" has already been applied to "' + this.expression + '"');
    }
    binding[behaviorKey] = behavior;
    behavior.bind.apply(behavior, [binding, scope].concat(evalList(scope, this.args, binding.lookupFunctions)));
  };

  BindingBehavior.prototype.unbind = function unbind(binding, scope) {
    var behaviorKey = 'behavior-' + this.name;
    binding[behaviorKey].unbind(binding, scope);
    binding[behaviorKey] = null;
    if (this.expression.expression && this.expression.unbind) {
      this.expression.unbind(binding, scope);
    }
  };

  return BindingBehavior;
}(Expression);

var ValueConverter = exports.ValueConverter = function (_Expression3) {
  _inherits(ValueConverter, _Expression3);

  function ValueConverter(expression, name, args, allArgs) {
    

    var _this5 = _possibleConstructorReturn(this, _Expression3.call(this));

    _this5.expression = expression;
    _this5.name = name;
    _this5.args = args;
    _this5.allArgs = allArgs;
    return _this5;
  }

  ValueConverter.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var converter = lookupFunctions.valueConverters(this.name);
    if (!converter) {
      throw new Error('No ValueConverter named "' + this.name + '" was found!');
    }

    if ('toView' in converter) {
      return converter.toView.apply(converter, evalList(scope, this.allArgs, lookupFunctions));
    }

    return this.allArgs[0].evaluate(scope, lookupFunctions);
  };

  ValueConverter.prototype.assign = function assign(scope, value, lookupFunctions) {
    var converter = lookupFunctions.valueConverters(this.name);
    if (!converter) {
      throw new Error('No ValueConverter named "' + this.name + '" was found!');
    }

    if ('fromView' in converter) {
      value = converter.fromView.apply(converter, [value].concat(evalList(scope, this.args, lookupFunctions)));
    }

    return this.allArgs[0].assign(scope, value, lookupFunctions);
  };

  ValueConverter.prototype.accept = function accept(visitor) {
    return visitor.visitValueConverter(this);
  };

  ValueConverter.prototype.connect = function connect(binding, scope) {
    var expressions = this.allArgs;
    var i = expressions.length;
    while (i--) {
      expressions[i].connect(binding, scope);
    }
  };

  return ValueConverter;
}(Expression);

var Assign = exports.Assign = function (_Expression4) {
  _inherits(Assign, _Expression4);

  function Assign(target, value) {
    

    var _this6 = _possibleConstructorReturn(this, _Expression4.call(this));

    _this6.target = target;
    _this6.value = value;
    return _this6;
  }

  Assign.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    return this.target.assign(scope, this.value.evaluate(scope, lookupFunctions));
  };

  Assign.prototype.accept = function accept(vistor) {
    vistor.visitAssign(this);
  };

  Assign.prototype.connect = function connect(binding, scope) {};

  return Assign;
}(Expression);

var Conditional = exports.Conditional = function (_Expression5) {
  _inherits(Conditional, _Expression5);

  function Conditional(condition, yes, no) {
    

    var _this7 = _possibleConstructorReturn(this, _Expression5.call(this));

    _this7.condition = condition;
    _this7.yes = yes;
    _this7.no = no;
    return _this7;
  }

  Conditional.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    return !!this.condition.evaluate(scope) ? this.yes.evaluate(scope) : this.no.evaluate(scope);
  };

  Conditional.prototype.accept = function accept(visitor) {
    return visitor.visitConditional(this);
  };

  Conditional.prototype.connect = function connect(binding, scope) {
    this.condition.connect(binding, scope);
    if (this.condition.evaluate(scope)) {
      this.yes.connect(binding, scope);
    } else {
      this.no.connect(binding, scope);
    }
  };

  return Conditional;
}(Expression);

var AccessThis = exports.AccessThis = function (_Expression6) {
  _inherits(AccessThis, _Expression6);

  function AccessThis(ancestor) {
    

    var _this8 = _possibleConstructorReturn(this, _Expression6.call(this));

    _this8.ancestor = ancestor;
    return _this8;
  }

  AccessThis.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var oc = scope.overrideContext;
    var i = this.ancestor;
    while (i-- && oc) {
      oc = oc.parentOverrideContext;
    }
    return i < 1 && oc ? oc.bindingContext : undefined;
  };

  AccessThis.prototype.accept = function accept(visitor) {
    return visitor.visitAccessThis(this);
  };

  AccessThis.prototype.connect = function connect(binding, scope) {};

  return AccessThis;
}(Expression);

var AccessScope = exports.AccessScope = function (_Expression7) {
  _inherits(AccessScope, _Expression7);

  function AccessScope(name, ancestor) {
    

    var _this9 = _possibleConstructorReturn(this, _Expression7.call(this));

    _this9.name = name;
    _this9.ancestor = ancestor;
    _this9.isAssignable = true;
    return _this9;
  }

  AccessScope.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var context = getContextFor(this.name, scope, this.ancestor);
    return context[this.name];
  };

  AccessScope.prototype.assign = function assign(scope, value) {
    var context = getContextFor(this.name, scope, this.ancestor);
    return context ? context[this.name] = value : undefined;
  };

  AccessScope.prototype.accept = function accept(visitor) {
    return visitor.visitAccessScope(this);
  };

  AccessScope.prototype.connect = function connect(binding, scope) {
    var context = getContextFor(this.name, scope, this.ancestor);
    binding.observeProperty(context, this.name);
  };

  return AccessScope;
}(Expression);

var AccessMember = exports.AccessMember = function (_Expression8) {
  _inherits(AccessMember, _Expression8);

  function AccessMember(object, name) {
    

    var _this10 = _possibleConstructorReturn(this, _Expression8.call(this));

    _this10.object = object;
    _this10.name = name;
    _this10.isAssignable = true;
    return _this10;
  }

  AccessMember.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var instance = this.object.evaluate(scope, lookupFunctions);
    return instance === null || instance === undefined ? instance : instance[this.name];
  };

  AccessMember.prototype.assign = function assign(scope, value) {
    var instance = this.object.evaluate(scope);

    if (instance === null || instance === undefined) {
      instance = {};
      this.object.assign(scope, instance);
    }

    instance[this.name] = value;
    return value;
  };

  AccessMember.prototype.accept = function accept(visitor) {
    return visitor.visitAccessMember(this);
  };

  AccessMember.prototype.connect = function connect(binding, scope) {
    this.object.connect(binding, scope);
    var obj = this.object.evaluate(scope);
    if (obj) {
      binding.observeProperty(obj, this.name);
    }
  };

  return AccessMember;
}(Expression);

var AccessKeyed = exports.AccessKeyed = function (_Expression9) {
  _inherits(AccessKeyed, _Expression9);

  function AccessKeyed(object, key) {
    

    var _this11 = _possibleConstructorReturn(this, _Expression9.call(this));

    _this11.object = object;
    _this11.key = key;
    _this11.isAssignable = true;
    return _this11;
  }

  AccessKeyed.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var instance = this.object.evaluate(scope, lookupFunctions);
    var lookup = this.key.evaluate(scope, lookupFunctions);
    return getKeyed(instance, lookup);
  };

  AccessKeyed.prototype.assign = function assign(scope, value) {
    var instance = this.object.evaluate(scope);
    var lookup = this.key.evaluate(scope);
    return setKeyed(instance, lookup, value);
  };

  AccessKeyed.prototype.accept = function accept(visitor) {
    return visitor.visitAccessKeyed(this);
  };

  AccessKeyed.prototype.connect = function connect(binding, scope) {
    this.object.connect(binding, scope);
    var obj = this.object.evaluate(scope);
    if (obj instanceof Object) {
      this.key.connect(binding, scope);
      var key = this.key.evaluate(scope);

      if (key !== null && key !== undefined && !(Array.isArray(obj) && typeof key === 'number')) {
        binding.observeProperty(obj, key);
      }
    }
  };

  return AccessKeyed;
}(Expression);

var CallScope = exports.CallScope = function (_Expression10) {
  _inherits(CallScope, _Expression10);

  function CallScope(name, args, ancestor) {
    

    var _this12 = _possibleConstructorReturn(this, _Expression10.call(this));

    _this12.name = name;
    _this12.args = args;
    _this12.ancestor = ancestor;
    return _this12;
  }

  CallScope.prototype.evaluate = function evaluate(scope, lookupFunctions, mustEvaluate) {
    var args = evalList(scope, this.args, lookupFunctions);
    var context = getContextFor(this.name, scope, this.ancestor);
    var func = getFunction(context, this.name, mustEvaluate);
    if (func) {
      return func.apply(context, args);
    }
    return undefined;
  };

  CallScope.prototype.accept = function accept(visitor) {
    return visitor.visitCallScope(this);
  };

  CallScope.prototype.connect = function connect(binding, scope) {
    var args = this.args;
    var i = args.length;
    while (i--) {
      args[i].connect(binding, scope);
    }
  };

  return CallScope;
}(Expression);

var CallMember = exports.CallMember = function (_Expression11) {
  _inherits(CallMember, _Expression11);

  function CallMember(object, name, args) {
    

    var _this13 = _possibleConstructorReturn(this, _Expression11.call(this));

    _this13.object = object;
    _this13.name = name;
    _this13.args = args;
    return _this13;
  }

  CallMember.prototype.evaluate = function evaluate(scope, lookupFunctions, mustEvaluate) {
    var instance = this.object.evaluate(scope, lookupFunctions);
    var args = evalList(scope, this.args, lookupFunctions);
    var func = getFunction(instance, this.name, mustEvaluate);
    if (func) {
      return func.apply(instance, args);
    }
    return undefined;
  };

  CallMember.prototype.accept = function accept(visitor) {
    return visitor.visitCallMember(this);
  };

  CallMember.prototype.connect = function connect(binding, scope) {
    this.object.connect(binding, scope);
    var obj = this.object.evaluate(scope);
    if (getFunction(obj, this.name, false)) {
      var args = this.args;
      var _i8 = args.length;
      while (_i8--) {
        args[_i8].connect(binding, scope);
      }
    }
  };

  return CallMember;
}(Expression);

var CallFunction = exports.CallFunction = function (_Expression12) {
  _inherits(CallFunction, _Expression12);

  function CallFunction(func, args) {
    

    var _this14 = _possibleConstructorReturn(this, _Expression12.call(this));

    _this14.func = func;
    _this14.args = args;
    return _this14;
  }

  CallFunction.prototype.evaluate = function evaluate(scope, lookupFunctions, mustEvaluate) {
    var func = this.func.evaluate(scope, lookupFunctions);
    if (typeof func === 'function') {
      return func.apply(null, evalList(scope, this.args, lookupFunctions));
    }
    if (!mustEvaluate && (func === null || func === undefined)) {
      return undefined;
    }
    throw new Error(this.func + ' is not a function');
  };

  CallFunction.prototype.accept = function accept(visitor) {
    return visitor.visitCallFunction(this);
  };

  CallFunction.prototype.connect = function connect(binding, scope) {
    this.func.connect(binding, scope);
    var func = this.func.evaluate(scope);
    if (typeof func === 'function') {
      var args = this.args;
      var _i9 = args.length;
      while (_i9--) {
        args[_i9].connect(binding, scope);
      }
    }
  };

  return CallFunction;
}(Expression);

var Binary = exports.Binary = function (_Expression13) {
  _inherits(Binary, _Expression13);

  function Binary(operation, left, right) {
    

    var _this15 = _possibleConstructorReturn(this, _Expression13.call(this));

    _this15.operation = operation;
    _this15.left = left;
    _this15.right = right;
    return _this15;
  }

  Binary.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var left = this.left.evaluate(scope);

    switch (this.operation) {
      case '&&':
        return left && this.right.evaluate(scope);
      case '||':
        return left || this.right.evaluate(scope);
    }

    var right = this.right.evaluate(scope);

    switch (this.operation) {
      case '==':
        return left == right;
      case '===':
        return left === right;
      case '!=':
        return left != right;
      case '!==':
        return left !== right;
    }

    if (left === null || right === null || left === undefined || right === undefined) {
      switch (this.operation) {
        case '+':
          if (left !== null && left !== undefined) return left;
          if (right !== null && right !== undefined) return right;
          return 0;
        case '-':
          if (left !== null && left !== undefined) return left;
          if (right !== null && right !== undefined) return 0 - right;
          return 0;
      }

      return null;
    }

    switch (this.operation) {
      case '+':
        return autoConvertAdd(left, right);
      case '-':
        return left - right;
      case '*':
        return left * right;
      case '/':
        return left / right;
      case '%':
        return left % right;
      case '<':
        return left < right;
      case '>':
        return left > right;
      case '<=':
        return left <= right;
      case '>=':
        return left >= right;
      case '^':
        return left ^ right;
    }

    throw new Error('Internal error [' + this.operation + '] not handled');
  };

  Binary.prototype.accept = function accept(visitor) {
    return visitor.visitBinary(this);
  };

  Binary.prototype.connect = function connect(binding, scope) {
    this.left.connect(binding, scope);
    var left = this.left.evaluate(scope);
    if (this.operation === '&&' && !left || this.operation === '||' && left) {
      return;
    }
    this.right.connect(binding, scope);
  };

  return Binary;
}(Expression);

var PrefixNot = exports.PrefixNot = function (_Expression14) {
  _inherits(PrefixNot, _Expression14);

  function PrefixNot(operation, expression) {
    

    var _this16 = _possibleConstructorReturn(this, _Expression14.call(this));

    _this16.operation = operation;
    _this16.expression = expression;
    return _this16;
  }

  PrefixNot.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    return !this.expression.evaluate(scope);
  };

  PrefixNot.prototype.accept = function accept(visitor) {
    return visitor.visitPrefix(this);
  };

  PrefixNot.prototype.connect = function connect(binding, scope) {
    this.expression.connect(binding, scope);
  };

  return PrefixNot;
}(Expression);

var LiteralPrimitive = exports.LiteralPrimitive = function (_Expression15) {
  _inherits(LiteralPrimitive, _Expression15);

  function LiteralPrimitive(value) {
    

    var _this17 = _possibleConstructorReturn(this, _Expression15.call(this));

    _this17.value = value;
    return _this17;
  }

  LiteralPrimitive.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    return this.value;
  };

  LiteralPrimitive.prototype.accept = function accept(visitor) {
    return visitor.visitLiteralPrimitive(this);
  };

  LiteralPrimitive.prototype.connect = function connect(binding, scope) {};

  return LiteralPrimitive;
}(Expression);

var LiteralString = exports.LiteralString = function (_Expression16) {
  _inherits(LiteralString, _Expression16);

  function LiteralString(value) {
    

    var _this18 = _possibleConstructorReturn(this, _Expression16.call(this));

    _this18.value = value;
    return _this18;
  }

  LiteralString.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    return this.value;
  };

  LiteralString.prototype.accept = function accept(visitor) {
    return visitor.visitLiteralString(this);
  };

  LiteralString.prototype.connect = function connect(binding, scope) {};

  return LiteralString;
}(Expression);

var LiteralArray = exports.LiteralArray = function (_Expression17) {
  _inherits(LiteralArray, _Expression17);

  function LiteralArray(elements) {
    

    var _this19 = _possibleConstructorReturn(this, _Expression17.call(this));

    _this19.elements = elements;
    return _this19;
  }

  LiteralArray.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var elements = this.elements;
    var result = [];

    for (var _i10 = 0, length = elements.length; _i10 < length; ++_i10) {
      result[_i10] = elements[_i10].evaluate(scope, lookupFunctions);
    }

    return result;
  };

  LiteralArray.prototype.accept = function accept(visitor) {
    return visitor.visitLiteralArray(this);
  };

  LiteralArray.prototype.connect = function connect(binding, scope) {
    var length = this.elements.length;
    for (var _i11 = 0; _i11 < length; _i11++) {
      this.elements[_i11].connect(binding, scope);
    }
  };

  return LiteralArray;
}(Expression);

var LiteralObject = exports.LiteralObject = function (_Expression18) {
  _inherits(LiteralObject, _Expression18);

  function LiteralObject(keys, values) {
    

    var _this20 = _possibleConstructorReturn(this, _Expression18.call(this));

    _this20.keys = keys;
    _this20.values = values;
    return _this20;
  }

  LiteralObject.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var instance = {};
    var keys = this.keys;
    var values = this.values;

    for (var _i12 = 0, length = keys.length; _i12 < length; ++_i12) {
      instance[keys[_i12]] = values[_i12].evaluate(scope, lookupFunctions);
    }

    return instance;
  };

  LiteralObject.prototype.accept = function accept(visitor) {
    return visitor.visitLiteralObject(this);
  };

  LiteralObject.prototype.connect = function connect(binding, scope) {
    var length = this.keys.length;
    for (var _i13 = 0; _i13 < length; _i13++) {
      this.values[_i13].connect(binding, scope);
    }
  };

  return LiteralObject;
}(Expression);

var evalListCache = [[], [0], [0, 0], [0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0, 0]];

function evalList(scope, list, lookupFunctions) {
  var length = list.length;

  for (var cacheLength = evalListCache.length; cacheLength <= length; ++cacheLength) {
    evalListCache.push([]);
  }

  var result = evalListCache[length];

  for (var _i14 = 0; _i14 < length; ++_i14) {
    result[_i14] = list[_i14].evaluate(scope, lookupFunctions);
  }

  return result;
}

function autoConvertAdd(a, b) {
  if (a !== null && b !== null) {
    if (typeof a === 'string' && typeof b !== 'string') {
      return a + b.toString();
    }

    if (typeof a !== 'string' && typeof b === 'string') {
      return a.toString() + b;
    }

    return a + b;
  }

  if (a !== null) {
    return a;
  }

  if (b !== null) {
    return b;
  }

  return 0;
}

function getFunction(obj, name, mustExist) {
  var func = obj === null || obj === undefined ? null : obj[name];
  if (typeof func === 'function') {
    return func;
  }
  if (!mustExist && (func === null || func === undefined)) {
    return null;
  }
  throw new Error(name + ' is not a function');
}

function getKeyed(obj, key) {
  if (Array.isArray(obj)) {
    return obj[parseInt(key, 10)];
  } else if (obj) {
    return obj[key];
  } else if (obj === null || obj === undefined) {
    return undefined;
  }

  return obj[key];
}

function setKeyed(obj, key, value) {
  if (Array.isArray(obj)) {
    var index = parseInt(key, 10);

    if (obj.length <= index) {
      obj.length = index + 1;
    }

    obj[index] = value;
  } else {
    obj[key] = value;
  }

  return value;
}

var Unparser = exports.Unparser = function () {
  function Unparser(buffer) {
    

    this.buffer = buffer;
  }

  Unparser.unparse = function unparse(expression) {
    var buffer = [];
    var visitor = new Unparser(buffer);

    expression.accept(visitor);

    return buffer.join('');
  };

  Unparser.prototype.write = function write(text) {
    this.buffer.push(text);
  };

  Unparser.prototype.writeArgs = function writeArgs(args) {
    this.write('(');

    for (var _i15 = 0, length = args.length; _i15 < length; ++_i15) {
      if (_i15 !== 0) {
        this.write(',');
      }

      args[_i15].accept(this);
    }

    this.write(')');
  };

  Unparser.prototype.visitChain = function visitChain(chain) {
    var expressions = chain.expressions;

    for (var _i16 = 0, length = expression.length; _i16 < length; ++_i16) {
      if (_i16 !== 0) {
        this.write(';');
      }

      expressions[_i16].accept(this);
    }
  };

  Unparser.prototype.visitBindingBehavior = function visitBindingBehavior(behavior) {
    var args = behavior.args;

    behavior.expression.accept(this);
    this.write('&' + behavior.name);

    for (var _i17 = 0, length = args.length; _i17 < length; ++_i17) {
      this.write(':');
      args[_i17].accept(this);
    }
  };

  Unparser.prototype.visitValueConverter = function visitValueConverter(converter) {
    var args = converter.args;

    converter.expression.accept(this);
    this.write('|' + converter.name);

    for (var _i18 = 0, length = args.length; _i18 < length; ++_i18) {
      this.write(':');
      args[_i18].accept(this);
    }
  };

  Unparser.prototype.visitAssign = function visitAssign(assign) {
    assign.target.accept(this);
    this.write('=');
    assign.value.accept(this);
  };

  Unparser.prototype.visitConditional = function visitConditional(conditional) {
    conditional.condition.accept(this);
    this.write('?');
    conditional.yes.accept(this);
    this.write(':');
    conditional.no.accept(this);
  };

  Unparser.prototype.visitAccessThis = function visitAccessThis(access) {
    if (access.ancestor === 0) {
      this.write('$this');
      return;
    }
    this.write('$parent');
    var i = access.ancestor - 1;
    while (i--) {
      this.write('.$parent');
    }
  };

  Unparser.prototype.visitAccessScope = function visitAccessScope(access) {
    var i = access.ancestor;
    while (i--) {
      this.write('$parent.');
    }
    this.write(access.name);
  };

  Unparser.prototype.visitAccessMember = function visitAccessMember(access) {
    access.object.accept(this);
    this.write('.' + access.name);
  };

  Unparser.prototype.visitAccessKeyed = function visitAccessKeyed(access) {
    access.object.accept(this);
    this.write('[');
    access.key.accept(this);
    this.write(']');
  };

  Unparser.prototype.visitCallScope = function visitCallScope(call) {
    var i = call.ancestor;
    while (i--) {
      this.write('$parent.');
    }
    this.write(call.name);
    this.writeArgs(call.args);
  };

  Unparser.prototype.visitCallFunction = function visitCallFunction(call) {
    call.func.accept(this);
    this.writeArgs(call.args);
  };

  Unparser.prototype.visitCallMember = function visitCallMember(call) {
    call.object.accept(this);
    this.write('.' + call.name);
    this.writeArgs(call.args);
  };

  Unparser.prototype.visitPrefix = function visitPrefix(prefix) {
    this.write('(' + prefix.operation);
    prefix.expression.accept(this);
    this.write(')');
  };

  Unparser.prototype.visitBinary = function visitBinary(binary) {
    binary.left.accept(this);
    this.write(binary.operation);
    binary.right.accept(this);
  };

  Unparser.prototype.visitLiteralPrimitive = function visitLiteralPrimitive(literal) {
    this.write('' + literal.value);
  };

  Unparser.prototype.visitLiteralArray = function visitLiteralArray(literal) {
    var elements = literal.elements;

    this.write('[');

    for (var _i19 = 0, length = elements.length; _i19 < length; ++_i19) {
      if (_i19 !== 0) {
        this.write(',');
      }

      elements[_i19].accept(this);
    }

    this.write(']');
  };

  Unparser.prototype.visitLiteralObject = function visitLiteralObject(literal) {
    var keys = literal.keys;
    var values = literal.values;

    this.write('{');

    for (var _i20 = 0, length = keys.length; _i20 < length; ++_i20) {
      if (_i20 !== 0) {
        this.write(',');
      }

      this.write('\'' + keys[_i20] + '\':');
      values[_i20].accept(this);
    }

    this.write('}');
  };

  Unparser.prototype.visitLiteralString = function visitLiteralString(literal) {
    var escaped = literal.value.replace(/'/g, "\'");
    this.write('\'' + escaped + '\'');
  };

  return Unparser;
}();

var ExpressionCloner = exports.ExpressionCloner = function () {
  function ExpressionCloner() {
    
  }

  ExpressionCloner.prototype.cloneExpressionArray = function cloneExpressionArray(array) {
    var clonedArray = [];
    var i = array.length;
    while (i--) {
      clonedArray[i] = array[i].accept(this);
    }
    return clonedArray;
  };

  ExpressionCloner.prototype.visitChain = function visitChain(chain) {
    return new Chain(this.cloneExpressionArray(chain.expressions));
  };

  ExpressionCloner.prototype.visitBindingBehavior = function visitBindingBehavior(behavior) {
    return new BindingBehavior(behavior.expression.accept(this), behavior.name, this.cloneExpressionArray(behavior.args));
  };

  ExpressionCloner.prototype.visitValueConverter = function visitValueConverter(converter) {
    return new ValueConverter(converter.expression.accept(this), converter.name, this.cloneExpressionArray(converter.args));
  };

  ExpressionCloner.prototype.visitAssign = function visitAssign(assign) {
    return new Assign(assign.target.accept(this), assign.value.accept(this));
  };

  ExpressionCloner.prototype.visitConditional = function visitConditional(conditional) {
    return new Conditional(conditional.condition.accept(this), conditional.yes.accept(this), conditional.no.accept(this));
  };

  ExpressionCloner.prototype.visitAccessThis = function visitAccessThis(access) {
    return new AccessThis(access.ancestor);
  };

  ExpressionCloner.prototype.visitAccessScope = function visitAccessScope(access) {
    return new AccessScope(access.name, access.ancestor);
  };

  ExpressionCloner.prototype.visitAccessMember = function visitAccessMember(access) {
    return new AccessMember(access.object.accept(this), access.name);
  };

  ExpressionCloner.prototype.visitAccessKeyed = function visitAccessKeyed(access) {
    return new AccessKeyed(access.object.accept(this), access.key.accept(this));
  };

  ExpressionCloner.prototype.visitCallScope = function visitCallScope(call) {
    return new CallScope(call.name, this.cloneExpressionArray(call.args), call.ancestor);
  };

  ExpressionCloner.prototype.visitCallFunction = function visitCallFunction(call) {
    return new CallFunction(call.func.accept(this), this.cloneExpressionArray(call.args));
  };

  ExpressionCloner.prototype.visitCallMember = function visitCallMember(call) {
    return new CallMember(call.object.accept(this), call.name, this.cloneExpressionArray(call.args));
  };

  ExpressionCloner.prototype.visitPrefix = function visitPrefix(prefix) {
    return new PrefixNot(prefix.operation, prefix.expression.accept(this));
  };

  ExpressionCloner.prototype.visitBinary = function visitBinary(binary) {
    return new Binary(binary.operation, binary.left.accept(this), binary.right.accept(this));
  };

  ExpressionCloner.prototype.visitLiteralPrimitive = function visitLiteralPrimitive(literal) {
    return new LiteralPrimitive(literal);
  };

  ExpressionCloner.prototype.visitLiteralArray = function visitLiteralArray(literal) {
    return new LiteralArray(this.cloneExpressionArray(literal.elements));
  };

  ExpressionCloner.prototype.visitLiteralObject = function visitLiteralObject(literal) {
    return new LiteralObject(literal.keys, this.cloneExpressionArray(literal.values));
  };

  ExpressionCloner.prototype.visitLiteralString = function visitLiteralString(literal) {
    return new LiteralString(literal.value);
  };

  return ExpressionCloner;
}();

function cloneExpression(expression) {
  var visitor = new ExpressionCloner();
  return expression.accept(visitor);
}

var bindingMode = exports.bindingMode = {
  oneTime: 0,
  oneWay: 1,
  twoWay: 2
};

var Token = exports.Token = function () {
  function Token(index, text) {
    

    this.index = index;
    this.text = text;
  }

  Token.prototype.withOp = function withOp(op) {
    this.opKey = op;
    return this;
  };

  Token.prototype.withGetterSetter = function withGetterSetter(key) {
    this.key = key;
    return this;
  };

  Token.prototype.withValue = function withValue(value) {
    this.value = value;
    return this;
  };

  Token.prototype.toString = function toString() {
    return 'Token(' + this.text + ')';
  };

  return Token;
}();

var Lexer = exports.Lexer = function () {
  function Lexer() {
    
  }

  Lexer.prototype.lex = function lex(text) {
    var scanner = new Scanner(text);
    var tokens = [];
    var token = scanner.scanToken();

    while (token) {
      tokens.push(token);
      token = scanner.scanToken();
    }

    return tokens;
  };

  return Lexer;
}();

var Scanner = exports.Scanner = function () {
  function Scanner(input) {
    

    this.input = input;
    this.length = input.length;
    this.peek = 0;
    this.index = -1;

    this.advance();
  }

  Scanner.prototype.scanToken = function scanToken() {
    while (this.peek <= $SPACE) {
      if (++this.index >= this.length) {
        this.peek = $EOF;
        return null;
      }

      this.peek = this.input.charCodeAt(this.index);
    }

    if (isIdentifierStart(this.peek)) {
      return this.scanIdentifier();
    }

    if (isDigit(this.peek)) {
      return this.scanNumber(this.index);
    }

    var start = this.index;

    switch (this.peek) {
      case $PERIOD:
        this.advance();
        return isDigit(this.peek) ? this.scanNumber(start) : new Token(start, '.');
      case $LPAREN:
      case $RPAREN:
      case $LBRACE:
      case $RBRACE:
      case $LBRACKET:
      case $RBRACKET:
      case $COMMA:
      case $COLON:
      case $SEMICOLON:
        return this.scanCharacter(start, String.fromCharCode(this.peek));
      case $SQ:
      case $DQ:
        return this.scanString();
      case $PLUS:
      case $MINUS:
      case $STAR:
      case $SLASH:
      case $PERCENT:
      case $CARET:
      case $QUESTION:
        return this.scanOperator(start, String.fromCharCode(this.peek));
      case $LT:
      case $GT:
      case $BANG:
      case $EQ:
        return this.scanComplexOperator(start, $EQ, String.fromCharCode(this.peek), '=');
      case $AMPERSAND:
        return this.scanComplexOperator(start, $AMPERSAND, '&', '&');
      case $BAR:
        return this.scanComplexOperator(start, $BAR, '|', '|');
      case $NBSP:
        while (isWhitespace(this.peek)) {
          this.advance();
        }

        return this.scanToken();
    }

    var character = String.fromCharCode(this.peek);
    this.error('Unexpected character [' + character + ']');
    return null;
  };

  Scanner.prototype.scanCharacter = function scanCharacter(start, text) {
    assert(this.peek === text.charCodeAt(0));
    this.advance();
    return new Token(start, text);
  };

  Scanner.prototype.scanOperator = function scanOperator(start, text) {
    assert(this.peek === text.charCodeAt(0));
    assert(OPERATORS.indexOf(text) !== -1);
    this.advance();
    return new Token(start, text).withOp(text);
  };

  Scanner.prototype.scanComplexOperator = function scanComplexOperator(start, code, one, two) {
    assert(this.peek === one.charCodeAt(0));
    this.advance();

    var text = one;

    if (this.peek === code) {
      this.advance();
      text += two;
    }

    if (this.peek === code) {
      this.advance();
      text += two;
    }

    assert(OPERATORS.indexOf(text) !== -1);

    return new Token(start, text).withOp(text);
  };

  Scanner.prototype.scanIdentifier = function scanIdentifier() {
    assert(isIdentifierStart(this.peek));
    var start = this.index;

    this.advance();

    while (isIdentifierPart(this.peek)) {
      this.advance();
    }

    var text = this.input.substring(start, this.index);
    var result = new Token(start, text);

    if (OPERATORS.indexOf(text) !== -1) {
      result.withOp(text);
    } else {
      result.withGetterSetter(text);
    }

    return result;
  };

  Scanner.prototype.scanNumber = function scanNumber(start) {
    assert(isDigit(this.peek));
    var simple = this.index === start;
    this.advance();

    while (true) {
      if (!isDigit(this.peek)) {
        if (this.peek === $PERIOD) {
          simple = false;
        } else if (isExponentStart(this.peek)) {
          this.advance();

          if (isExponentSign(this.peek)) {
            this.advance();
          }

          if (!isDigit(this.peek)) {
            this.error('Invalid exponent', -1);
          }

          simple = false;
        } else {
          break;
        }
      }

      this.advance();
    }

    var text = this.input.substring(start, this.index);
    var value = simple ? parseInt(text, 10) : parseFloat(text);
    return new Token(start, text).withValue(value);
  };

  Scanner.prototype.scanString = function scanString() {
    assert(this.peek === $SQ || this.peek === $DQ);

    var start = this.index;
    var quote = this.peek;

    this.advance();

    var buffer = void 0;
    var marker = this.index;

    while (this.peek !== quote) {
      if (this.peek === $BACKSLASH) {
        if (!buffer) {
          buffer = [];
        }

        buffer.push(this.input.substring(marker, this.index));
        this.advance();

        var _unescaped = void 0;

        if (this.peek === $u) {
          var hex = this.input.substring(this.index + 1, this.index + 5);

          if (!/[A-Z0-9]{4}/.test(hex)) {
            this.error('Invalid unicode escape [\\u' + hex + ']');
          }

          _unescaped = parseInt(hex, 16);

          for (var _i21 = 0; _i21 < 5; ++_i21) {
            this.advance();
          }
        } else {
          _unescaped = unescape(this.peek);
          this.advance();
        }

        buffer.push(String.fromCharCode(_unescaped));
        marker = this.index;
      } else if (this.peek === $EOF) {
        this.error('Unterminated quote');
      } else {
        this.advance();
      }
    }

    var last = this.input.substring(marker, this.index);
    this.advance();
    var text = this.input.substring(start, this.index);

    var unescaped = last;

    if (buffer !== null && buffer !== undefined) {
      buffer.push(last);
      unescaped = buffer.join('');
    }

    return new Token(start, text).withValue(unescaped);
  };

  Scanner.prototype.advance = function advance() {
    if (++this.index >= this.length) {
      this.peek = $EOF;
    } else {
      this.peek = this.input.charCodeAt(this.index);
    }
  };

  Scanner.prototype.error = function error(message) {
    var offset = arguments.length <= 1 || arguments[1] === undefined ? 0 : arguments[1];

    var position = this.index + offset;
    throw new Error('Lexer Error: ' + message + ' at column ' + position + ' in expression [' + this.input + ']');
  };

  return Scanner;
}();

var OPERATORS = ['undefined', 'null', 'true', 'false', '+', '-', '*', '/', '%', '^', '=', '==', '===', '!=', '!==', '<', '>', '<=', '>=', '&&', '||', '&', '|', '!', '?'];

var $EOF = 0;
var $TAB = 9;
var $LF = 10;
var $VTAB = 11;
var $FF = 12;
var $CR = 13;
var $SPACE = 32;
var $BANG = 33;
var $DQ = 34;
var $$ = 36;
var $PERCENT = 37;
var $AMPERSAND = 38;
var $SQ = 39;
var $LPAREN = 40;
var $RPAREN = 41;
var $STAR = 42;
var $PLUS = 43;
var $COMMA = 44;
var $MINUS = 45;
var $PERIOD = 46;
var $SLASH = 47;
var $COLON = 58;
var $SEMICOLON = 59;
var $LT = 60;
var $EQ = 61;
var $GT = 62;
var $QUESTION = 63;

var $0 = 48;
var $9 = 57;

var $A = 65;
var $E = 69;
var $Z = 90;

var $LBRACKET = 91;
var $BACKSLASH = 92;
var $RBRACKET = 93;
var $CARET = 94;
var $_ = 95;

var $a = 97;
var $e = 101;
var $f = 102;
var $n = 110;
var $r = 114;
var $t = 116;
var $u = 117;
var $v = 118;
var $z = 122;

var $LBRACE = 123;
var $BAR = 124;
var $RBRACE = 125;
var $NBSP = 160;

function isWhitespace(code) {
  return code >= $TAB && code <= $SPACE || code === $NBSP;
}

function isIdentifierStart(code) {
  return $a <= code && code <= $z || $A <= code && code <= $Z || code === $_ || code === $$;
}

function isIdentifierPart(code) {
  return $a <= code && code <= $z || $A <= code && code <= $Z || $0 <= code && code <= $9 || code === $_ || code === $$;
}

function isDigit(code) {
  return $0 <= code && code <= $9;
}

function isExponentStart(code) {
  return code === $e || code === $E;
}

function isExponentSign(code) {
  return code === $MINUS || code === $PLUS;
}

function unescape(code) {
  switch (code) {
    case $n:
      return $LF;
    case $f:
      return $FF;
    case $r:
      return $CR;
    case $t:
      return $TAB;
    case $v:
      return $VTAB;
    default:
      return code;
  }
}

function assert(condition, message) {
  if (!condition) {
    throw message || 'Assertion failed';
  }
}

var EOF = new Token(-1, null);

var Parser = exports.Parser = function () {
  function Parser() {
    

    this.cache = {};
    this.lexer = new Lexer();
  }

  Parser.prototype.parse = function parse(input) {
    input = input || '';

    return this.cache[input] || (this.cache[input] = new ParserImplementation(this.lexer, input).parseChain());
  };

  return Parser;
}();

var ParserImplementation = exports.ParserImplementation = function () {
  function ParserImplementation(lexer, input) {
    

    this.index = 0;
    this.input = input;
    this.tokens = lexer.lex(input);
  }

  ParserImplementation.prototype.parseChain = function parseChain() {
    var isChain = false;
    var expressions = [];

    while (this.optional(';')) {
      isChain = true;
    }

    while (this.index < this.tokens.length) {
      if (this.peek.text === ')' || this.peek.text === '}' || this.peek.text === ']') {
        this.error('Unconsumed token ' + this.peek.text);
      }

      var expr = this.parseBindingBehavior();
      expressions.push(expr);

      while (this.optional(';')) {
        isChain = true;
      }

      if (isChain) {
        this.error('Multiple expressions are not allowed.');
      }
    }

    return expressions.length === 1 ? expressions[0] : new Chain(expressions);
  };

  ParserImplementation.prototype.parseBindingBehavior = function parseBindingBehavior() {
    var result = this.parseValueConverter();

    while (this.optional('&')) {
      var name = this.peek.text;
      var args = [];

      this.advance();

      while (this.optional(':')) {
        args.push(this.parseExpression());
      }

      result = new BindingBehavior(result, name, args);
    }

    return result;
  };

  ParserImplementation.prototype.parseValueConverter = function parseValueConverter() {
    var result = this.parseExpression();

    while (this.optional('|')) {
      var name = this.peek.text;
      var args = [];

      this.advance();

      while (this.optional(':')) {
        args.push(this.parseExpression());
      }

      result = new ValueConverter(result, name, args, [result].concat(args));
    }

    return result;
  };

  ParserImplementation.prototype.parseExpression = function parseExpression() {
    var start = this.peek.index;
    var result = this.parseConditional();

    while (this.peek.text === '=') {
      if (!result.isAssignable) {
        var end = this.index < this.tokens.length ? this.peek.index : this.input.length;
        var _expression = this.input.substring(start, end);

        this.error('Expression ' + _expression + ' is not assignable');
      }

      this.expect('=');
      result = new Assign(result, this.parseConditional());
    }

    return result;
  };

  ParserImplementation.prototype.parseConditional = function parseConditional() {
    var start = this.peek.index;
    var result = this.parseLogicalOr();

    if (this.optional('?')) {
      var yes = this.parseExpression();

      if (!this.optional(':')) {
        var end = this.index < this.tokens.length ? this.peek.index : this.input.length;
        var _expression2 = this.input.substring(start, end);

        this.error('Conditional expression ' + _expression2 + ' requires all 3 expressions');
      }

      var no = this.parseExpression();
      result = new Conditional(result, yes, no);
    }

    return result;
  };

  ParserImplementation.prototype.parseLogicalOr = function parseLogicalOr() {
    var result = this.parseLogicalAnd();

    while (this.optional('||')) {
      result = new Binary('||', result, this.parseLogicalAnd());
    }

    return result;
  };

  ParserImplementation.prototype.parseLogicalAnd = function parseLogicalAnd() {
    var result = this.parseEquality();

    while (this.optional('&&')) {
      result = new Binary('&&', result, this.parseEquality());
    }

    return result;
  };

  ParserImplementation.prototype.parseEquality = function parseEquality() {
    var result = this.parseRelational();

    while (true) {
      if (this.optional('==')) {
        result = new Binary('==', result, this.parseRelational());
      } else if (this.optional('!=')) {
        result = new Binary('!=', result, this.parseRelational());
      } else if (this.optional('===')) {
        result = new Binary('===', result, this.parseRelational());
      } else if (this.optional('!==')) {
        result = new Binary('!==', result, this.parseRelational());
      } else {
        return result;
      }
    }
  };

  ParserImplementation.prototype.parseRelational = function parseRelational() {
    var result = this.parseAdditive();

    while (true) {
      if (this.optional('<')) {
        result = new Binary('<', result, this.parseAdditive());
      } else if (this.optional('>')) {
        result = new Binary('>', result, this.parseAdditive());
      } else if (this.optional('<=')) {
        result = new Binary('<=', result, this.parseAdditive());
      } else if (this.optional('>=')) {
        result = new Binary('>=', result, this.parseAdditive());
      } else {
        return result;
      }
    }
  };

  ParserImplementation.prototype.parseAdditive = function parseAdditive() {
    var result = this.parseMultiplicative();

    while (true) {
      if (this.optional('+')) {
        result = new Binary('+', result, this.parseMultiplicative());
      } else if (this.optional('-')) {
        result = new Binary('-', result, this.parseMultiplicative());
      } else {
        return result;
      }
    }
  };

  ParserImplementation.prototype.parseMultiplicative = function parseMultiplicative() {
    var result = this.parsePrefix();

    while (true) {
      if (this.optional('*')) {
        result = new Binary('*', result, this.parsePrefix());
      } else if (this.optional('%')) {
        result = new Binary('%', result, this.parsePrefix());
      } else if (this.optional('/')) {
        result = new Binary('/', result, this.parsePrefix());
      } else {
        return result;
      }
    }
  };

  ParserImplementation.prototype.parsePrefix = function parsePrefix() {
    if (this.optional('+')) {
      return this.parsePrefix();
    } else if (this.optional('-')) {
        return new Binary('-', new LiteralPrimitive(0), this.parsePrefix());
      } else if (this.optional('!')) {
        return new PrefixNot('!', this.parsePrefix());
      }

    return this.parseAccessOrCallMember();
  };

  ParserImplementation.prototype.parseAccessOrCallMember = function parseAccessOrCallMember() {
    var result = this.parsePrimary();

    while (true) {
      if (this.optional('.')) {
        var name = this.peek.text;

        this.advance();

        if (this.optional('(')) {
          var args = this.parseExpressionList(')');
          this.expect(')');
          if (result instanceof AccessThis) {
            result = new CallScope(name, args, result.ancestor);
          } else {
            result = new CallMember(result, name, args);
          }
        } else {
          if (result instanceof AccessThis) {
            result = new AccessScope(name, result.ancestor);
          } else {
            result = new AccessMember(result, name);
          }
        }
      } else if (this.optional('[')) {
        var key = this.parseExpression();
        this.expect(']');
        result = new AccessKeyed(result, key);
      } else if (this.optional('(')) {
        var _args = this.parseExpressionList(')');
        this.expect(')');
        result = new CallFunction(result, _args);
      } else {
        return result;
      }
    }
  };

  ParserImplementation.prototype.parsePrimary = function parsePrimary() {
    if (this.optional('(')) {
      var result = this.parseExpression();
      this.expect(')');
      return result;
    } else if (this.optional('null')) {
      return new LiteralPrimitive(null);
    } else if (this.optional('undefined')) {
      return new LiteralPrimitive(undefined);
    } else if (this.optional('true')) {
      return new LiteralPrimitive(true);
    } else if (this.optional('false')) {
      return new LiteralPrimitive(false);
    } else if (this.optional('[')) {
      var elements = this.parseExpressionList(']');
      this.expect(']');
      return new LiteralArray(elements);
    } else if (this.peek.text === '{') {
      return this.parseObject();
    } else if (this.peek.key !== null && this.peek.key !== undefined) {
      return this.parseAccessOrCallScope();
    } else if (this.peek.value !== null && this.peek.value !== undefined) {
      var value = this.peek.value;
      this.advance();
      return value instanceof String || typeof value === 'string' ? new LiteralString(value) : new LiteralPrimitive(value);
    } else if (this.index >= this.tokens.length) {
      throw new Error('Unexpected end of expression: ' + this.input);
    } else {
      this.error('Unexpected token ' + this.peek.text);
    }
  };

  ParserImplementation.prototype.parseAccessOrCallScope = function parseAccessOrCallScope() {
    var name = this.peek.key;

    this.advance();

    if (name === '$this') {
      return new AccessThis(0);
    }

    var ancestor = 0;
    while (name === '$parent') {
      ancestor++;
      if (this.optional('.')) {
        name = this.peek.key;
        this.advance();
      } else if (this.peek === EOF || this.peek.text === '(' || this.peek.text === '[' || this.peek.text === '}') {
        return new AccessThis(ancestor);
      } else {
        this.error('Unexpected token ' + this.peek.text);
      }
    }

    if (this.optional('(')) {
      var args = this.parseExpressionList(')');
      this.expect(')');
      return new CallScope(name, args, ancestor);
    }

    return new AccessScope(name, ancestor);
  };

  ParserImplementation.prototype.parseObject = function parseObject() {
    var keys = [];
    var values = [];

    this.expect('{');

    if (this.peek.text !== '}') {
      do {
        var peek = this.peek;
        var value = peek.value;
        keys.push(typeof value === 'string' ? value : peek.text);

        this.advance();
        if (peek.key && (this.peek.text === ',' || this.peek.text === '}')) {
          --this.index;
          values.push(this.parseAccessOrCallScope());
        } else {
          this.expect(':');
          values.push(this.parseExpression());
        }
      } while (this.optional(','));
    }

    this.expect('}');

    return new LiteralObject(keys, values);
  };

  ParserImplementation.prototype.parseExpressionList = function parseExpressionList(terminator) {
    var result = [];

    if (this.peek.text !== terminator) {
      do {
        result.push(this.parseExpression());
      } while (this.optional(','));
    }

    return result;
  };

  ParserImplementation.prototype.optional = function optional(text) {
    if (this.peek.text === text) {
      this.advance();
      return true;
    }

    return false;
  };

  ParserImplementation.prototype.expect = function expect(text) {
    if (this.peek.text === text) {
      this.advance();
    } else {
      this.error('Missing expected ' + text);
    }
  };

  ParserImplementation.prototype.advance = function advance() {
    this.index++;
  };

  ParserImplementation.prototype.error = function error(message) {
    var location = this.index < this.tokens.length ? 'at column ' + (this.tokens[this.index].index + 1) + ' in' : 'at the end of the expression';

    throw new Error('Parser Error: ' + message + ' ' + location + ' [' + this.input + ']');
  };

  _createClass(ParserImplementation, [{
    key: 'peek',
    get: function get() {
      return this.index < this.tokens.length ? this.tokens[this.index] : EOF;
    }
  }]);

  return ParserImplementation;
}();

var mapProto = Map.prototype;

function _getMapObserver(taskQueue, map) {
  return ModifyMapObserver.for(taskQueue, map);
}

exports.getMapObserver = _getMapObserver;

var ModifyMapObserver = function (_ModifyCollectionObse2) {
  _inherits(ModifyMapObserver, _ModifyCollectionObse2);

  function ModifyMapObserver(taskQueue, map) {
    

    return _possibleConstructorReturn(this, _ModifyCollectionObse2.call(this, taskQueue, map));
  }

  ModifyMapObserver.for = function _for(taskQueue, map) {
    if (!('__map_observer__' in map)) {
      var observer = ModifyMapObserver.create(taskQueue, map);
      Reflect.defineProperty(map, '__map_observer__', { value: observer, enumerable: false, configurable: false });
    }
    return map.__map_observer__;
  };

  ModifyMapObserver.create = function create(taskQueue, map) {
    var observer = new ModifyMapObserver(taskQueue, map);

    var proto = mapProto;
    if (proto.add !== map.add || proto.delete !== map.delete || proto.clear !== map.clear) {
      proto = {
        add: map.add,
        delete: map.delete,
        clear: map.clear
      };
    }

    map.set = function () {
      var hasValue = map.has(arguments[0]);
      var type = hasValue ? 'update' : 'add';
      var oldValue = map.get(arguments[0]);
      var methodCallResult = proto.set.apply(map, arguments);
      if (!hasValue || oldValue !== map.get(arguments[0])) {
        observer.addChangeRecord({
          type: type,
          object: map,
          key: arguments[0],
          oldValue: oldValue
        });
      }
      return methodCallResult;
    };

    map.delete = function () {
      var hasValue = map.has(arguments[0]);
      var oldValue = map.get(arguments[0]);
      var methodCallResult = proto.delete.apply(map, arguments);
      if (hasValue) {
        observer.addChangeRecord({
          type: 'delete',
          object: map,
          key: arguments[0],
          oldValue: oldValue
        });
      }
      return methodCallResult;
    };

    map.clear = function () {
      var methodCallResult = proto.clear.apply(map, arguments);
      observer.addChangeRecord({
        type: 'clear',
        object: map
      });
      return methodCallResult;
    };

    return observer;
  };

  return ModifyMapObserver;
}(ModifyCollectionObserver);

function findOriginalEventTarget(event) {
  return event.path && event.path[0] || event.deepPath && event.deepPath[0] || event.target;
}

function handleDelegatedEvent(event) {
  var target = findOriginalEventTarget(event);
  var callback = void 0;

  while (target && !callback) {
    if (target.delegatedCallbacks) {
      callback = target.delegatedCallbacks[event.type];
    }

    if (!callback) {
      target = target.parentNode;
    }
  }

  if (callback) {
    callback(event);
  }
}

var DelegateHandlerEntry = function () {
  function DelegateHandlerEntry(eventName) {
    

    this.eventName = eventName;
    this.count = 0;
  }

  DelegateHandlerEntry.prototype.increment = function increment() {
    this.count++;

    if (this.count === 1) {
      _aureliaPal.DOM.addEventListener(this.eventName, handleDelegatedEvent, false);
    }
  };

  DelegateHandlerEntry.prototype.decrement = function decrement() {
    this.count--;

    if (this.count === 0) {
      _aureliaPal.DOM.removeEventListener(this.eventName, handleDelegatedEvent);
    }
  };

  return DelegateHandlerEntry;
}();

var DefaultEventStrategy = function () {
  function DefaultEventStrategy() {
    

    this.delegatedHandlers = [];
  }

  DefaultEventStrategy.prototype.subscribe = function subscribe(target, targetEvent, callback, delegate) {
    var _this22 = this;

    if (delegate) {
      var _ret = function () {
        var delegatedHandlers = _this22.delegatedHandlers;
        var handlerEntry = delegatedHandlers[targetEvent] || (delegatedHandlers[targetEvent] = new DelegateHandlerEntry(targetEvent));
        var delegatedCallbacks = target.delegatedCallbacks || (target.delegatedCallbacks = {});

        handlerEntry.increment();
        delegatedCallbacks[targetEvent] = callback;

        return {
          v: function v() {
            handlerEntry.decrement();
            delegatedCallbacks[targetEvent] = null;
          }
        };
      }();

      if ((typeof _ret === 'undefined' ? 'undefined' : _typeof(_ret)) === "object") return _ret.v;
    }

    target.addEventListener(targetEvent, callback, false);

    return function () {
      target.removeEventListener(targetEvent, callback);
    };
  };

  return DefaultEventStrategy;
}();

var EventManager = exports.EventManager = function () {
  function EventManager() {
    

    this.elementHandlerLookup = {};
    this.eventStrategyLookup = {};

    this.registerElementConfig({
      tagName: 'input',
      properties: {
        value: ['change', 'input'],
        checked: ['change', 'input'],
        files: ['change', 'input']
      }
    });

    this.registerElementConfig({
      tagName: 'textarea',
      properties: {
        value: ['change', 'input']
      }
    });

    this.registerElementConfig({
      tagName: 'select',
      properties: {
        value: ['change']
      }
    });

    this.registerElementConfig({
      tagName: 'content editable',
      properties: {
        value: ['change', 'input', 'blur', 'keyup', 'paste']
      }
    });

    this.registerElementConfig({
      tagName: 'scrollable element',
      properties: {
        scrollTop: ['scroll'],
        scrollLeft: ['scroll']
      }
    });

    this.defaultEventStrategy = new DefaultEventStrategy();
  }

  EventManager.prototype.registerElementConfig = function registerElementConfig(config) {
    var tagName = config.tagName.toLowerCase();
    var properties = config.properties;
    var propertyName = void 0;

    this.elementHandlerLookup[tagName] = {};

    for (propertyName in properties) {
      if (properties.hasOwnProperty(propertyName)) {
        this.registerElementPropertyConfig(tagName, propertyName, properties[propertyName]);
      }
    }
  };

  EventManager.prototype.registerElementPropertyConfig = function registerElementPropertyConfig(tagName, propertyName, events) {
    this.elementHandlerLookup[tagName][propertyName] = this.createElementHandler(events);
  };

  EventManager.prototype.createElementHandler = function createElementHandler(events) {
    return {
      subscribe: function subscribe(target, callback) {
        events.forEach(function (changeEvent) {
          target.addEventListener(changeEvent, callback, false);
        });

        return function () {
          events.forEach(function (changeEvent) {
            target.removeEventListener(changeEvent, callback);
          });
        };
      }
    };
  };

  EventManager.prototype.registerElementHandler = function registerElementHandler(tagName, handler) {
    this.elementHandlerLookup[tagName.toLowerCase()] = handler;
  };

  EventManager.prototype.registerEventStrategy = function registerEventStrategy(eventName, strategy) {
    this.eventStrategyLookup[eventName] = strategy;
  };

  EventManager.prototype.getElementHandler = function getElementHandler(target, propertyName) {
    var tagName = void 0;
    var lookup = this.elementHandlerLookup;

    if (target.tagName) {
      tagName = target.tagName.toLowerCase();

      if (lookup[tagName] && lookup[tagName][propertyName]) {
        return lookup[tagName][propertyName];
      }

      if (propertyName === 'textContent' || propertyName === 'innerHTML') {
        return lookup['content editable'].value;
      }

      if (propertyName === 'scrollTop' || propertyName === 'scrollLeft') {
        return lookup['scrollable element'][propertyName];
      }
    }

    return null;
  };

  EventManager.prototype.addEventListener = function addEventListener(target, targetEvent, callback, delegate) {
    return (this.eventStrategyLookup[targetEvent] || this.defaultEventStrategy).subscribe(target, targetEvent, callback, delegate);
  };

  return EventManager;
}();

var DirtyChecker = exports.DirtyChecker = function () {
  function DirtyChecker() {
    

    this.tracked = [];
    this.checkDelay = 120;
  }

  DirtyChecker.prototype.addProperty = function addProperty(property) {
    var tracked = this.tracked;

    tracked.push(property);

    if (tracked.length === 1) {
      this.scheduleDirtyCheck();
    }
  };

  DirtyChecker.prototype.removeProperty = function removeProperty(property) {
    var tracked = this.tracked;
    tracked.splice(tracked.indexOf(property), 1);
  };

  DirtyChecker.prototype.scheduleDirtyCheck = function scheduleDirtyCheck() {
    var _this23 = this;

    setTimeout(function () {
      return _this23.check();
    }, this.checkDelay);
  };

  DirtyChecker.prototype.check = function check() {
    var tracked = this.tracked;
    var i = tracked.length;

    while (i--) {
      var current = tracked[i];

      if (current.isDirty()) {
        current.call();
      }
    }

    if (tracked.length) {
      this.scheduleDirtyCheck();
    }
  };

  return DirtyChecker;
}();

var DirtyCheckProperty = exports.DirtyCheckProperty = (_dec5 = subscriberCollection(), _dec5(_class5 = function () {
  function DirtyCheckProperty(dirtyChecker, obj, propertyName) {
    

    this.dirtyChecker = dirtyChecker;
    this.obj = obj;
    this.propertyName = propertyName;
  }

  DirtyCheckProperty.prototype.getValue = function getValue() {
    return this.obj[this.propertyName];
  };

  DirtyCheckProperty.prototype.setValue = function setValue(newValue) {
    this.obj[this.propertyName] = newValue;
  };

  DirtyCheckProperty.prototype.call = function call() {
    var oldValue = this.oldValue;
    var newValue = this.getValue();

    this.callSubscribers(newValue, oldValue);

    this.oldValue = newValue;
  };

  DirtyCheckProperty.prototype.isDirty = function isDirty() {
    return this.oldValue !== this.obj[this.propertyName];
  };

  DirtyCheckProperty.prototype.subscribe = function subscribe(context, callable) {
    if (!this.hasSubscribers()) {
      this.oldValue = this.getValue();
      this.dirtyChecker.addProperty(this);
    }
    this.addSubscriber(context, callable);
  };

  DirtyCheckProperty.prototype.unsubscribe = function unsubscribe(context, callable) {
    if (this.removeSubscriber(context, callable) && !this.hasSubscribers()) {
      this.dirtyChecker.removeProperty(this);
    }
  };

  return DirtyCheckProperty;
}()) || _class5);


var logger = LogManager.getLogger('property-observation');

var propertyAccessor = exports.propertyAccessor = {
  getValue: function getValue(obj, propertyName) {
    return obj[propertyName];
  },
  setValue: function setValue(value, obj, propertyName) {
    obj[propertyName] = value;
  }
};

var PrimitiveObserver = exports.PrimitiveObserver = function () {
  function PrimitiveObserver(primitive, propertyName) {
    

    this.doNotCache = true;

    this.primitive = primitive;
    this.propertyName = propertyName;
  }

  PrimitiveObserver.prototype.getValue = function getValue() {
    return this.primitive[this.propertyName];
  };

  PrimitiveObserver.prototype.setValue = function setValue() {
    var type = _typeof(this.primitive);
    throw new Error('The ' + this.propertyName + ' property of a ' + type + ' (' + this.primitive + ') cannot be assigned.');
  };

  PrimitiveObserver.prototype.subscribe = function subscribe() {};

  PrimitiveObserver.prototype.unsubscribe = function unsubscribe() {};

  return PrimitiveObserver;
}();

var SetterObserver = exports.SetterObserver = (_dec6 = subscriberCollection(), _dec6(_class7 = function () {
  function SetterObserver(taskQueue, obj, propertyName) {
    

    this.taskQueue = taskQueue;
    this.obj = obj;
    this.propertyName = propertyName;
    this.queued = false;
    this.observing = false;
  }

  SetterObserver.prototype.getValue = function getValue() {
    return this.obj[this.propertyName];
  };

  SetterObserver.prototype.setValue = function setValue(newValue) {
    this.obj[this.propertyName] = newValue;
  };

  SetterObserver.prototype.getterValue = function getterValue() {
    return this.currentValue;
  };

  SetterObserver.prototype.setterValue = function setterValue(newValue) {
    var oldValue = this.currentValue;

    if (oldValue !== newValue) {
      if (!this.queued) {
        this.oldValue = oldValue;
        this.queued = true;
        this.taskQueue.queueMicroTask(this);
      }

      this.currentValue = newValue;
    }
  };

  SetterObserver.prototype.call = function call() {
    var oldValue = this.oldValue;
    var newValue = this.currentValue;

    this.queued = false;

    this.callSubscribers(newValue, oldValue);
  };

  SetterObserver.prototype.subscribe = function subscribe(context, callable) {
    if (!this.observing) {
      this.convertProperty();
    }
    this.addSubscriber(context, callable);
  };

  SetterObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    this.removeSubscriber(context, callable);
  };

  SetterObserver.prototype.convertProperty = function convertProperty() {
    this.observing = true;
    this.currentValue = this.obj[this.propertyName];
    this.setValue = this.setterValue;
    this.getValue = this.getterValue;

    if (!Reflect.defineProperty(this.obj, this.propertyName, {
      configurable: true,
      enumerable: this.propertyName in this.obj ? this.obj.propertyIsEnumerable(this.propertyName) : true,
      get: this.getValue.bind(this),
      set: this.setValue.bind(this)
    })) {
      logger.warn('Cannot observe property \'' + this.propertyName + '\' of object', this.obj);
    }
  };

  return SetterObserver;
}()) || _class7);

var XLinkAttributeObserver = exports.XLinkAttributeObserver = function () {
  function XLinkAttributeObserver(element, propertyName, attributeName) {
    

    this.element = element;
    this.propertyName = propertyName;
    this.attributeName = attributeName;
  }

  XLinkAttributeObserver.prototype.getValue = function getValue() {
    return this.element.getAttributeNS('http://www.w3.org/1999/xlink', this.attributeName);
  };

  XLinkAttributeObserver.prototype.setValue = function setValue(newValue) {
    return this.element.setAttributeNS('http://www.w3.org/1999/xlink', this.attributeName, newValue);
  };

  XLinkAttributeObserver.prototype.subscribe = function subscribe() {
    throw new Error('Observation of a "' + this.element.nodeName + '" element\'s "' + this.propertyName + '" property is not supported.');
  };

  return XLinkAttributeObserver;
}();

var dataAttributeAccessor = exports.dataAttributeAccessor = {
  getValue: function getValue(obj, propertyName) {
    return obj.getAttribute(propertyName);
  },
  setValue: function setValue(value, obj, propertyName) {
    return obj.setAttribute(propertyName, value);
  }
};

var DataAttributeObserver = exports.DataAttributeObserver = function () {
  function DataAttributeObserver(element, propertyName) {
    

    this.element = element;
    this.propertyName = propertyName;
  }

  DataAttributeObserver.prototype.getValue = function getValue() {
    return this.element.getAttribute(this.propertyName);
  };

  DataAttributeObserver.prototype.setValue = function setValue(newValue) {
    return this.element.setAttribute(this.propertyName, newValue);
  };

  DataAttributeObserver.prototype.subscribe = function subscribe() {
    throw new Error('Observation of a "' + this.element.nodeName + '" element\'s "' + this.propertyName + '" property is not supported.');
  };

  return DataAttributeObserver;
}();

var StyleObserver = exports.StyleObserver = function () {
  function StyleObserver(element, propertyName) {
    

    this.element = element;
    this.propertyName = propertyName;

    this.styles = null;
    this.version = 0;
  }

  StyleObserver.prototype.getValue = function getValue() {
    return this.element.style.cssText;
  };

  StyleObserver.prototype.setValue = function setValue(newValue) {
    var styles = this.styles || {};
    var style = void 0;
    var version = this.version;

    if (newValue !== null && newValue !== undefined) {
      if (newValue instanceof Object) {
        for (style in newValue) {
          if (newValue.hasOwnProperty(style)) {
            styles[style] = version;
            this.element.style[style] = newValue[style];
          }
        }
      } else if (newValue.length) {
        var pairs = newValue.split(/(?:;|:(?!\/))\s*/);
        for (var _i22 = 0, length = pairs.length; _i22 < length; _i22++) {
          style = pairs[_i22].trim();
          if (!style) {
            continue;
          }

          styles[style] = version;

          this.element.style[style] = pairs[++_i22];
        }
      }
    }

    this.styles = styles;
    this.version += 1;

    if (version === 0) {
      return;
    }

    version -= 1;
    for (style in styles) {
      if (!styles.hasOwnProperty(style) || styles[style] !== version) {
        continue;
      }

      this.element.style[style] = '';
    }
  };

  StyleObserver.prototype.subscribe = function subscribe() {
    throw new Error('Observation of a "' + this.element.nodeName + '" element\'s "' + this.propertyName + '" property is not supported.');
  };

  return StyleObserver;
}();

var ValueAttributeObserver = exports.ValueAttributeObserver = (_dec7 = subscriberCollection(), _dec7(_class8 = function () {
  function ValueAttributeObserver(element, propertyName, handler) {
    

    this.element = element;
    this.propertyName = propertyName;
    this.handler = handler;
    if (propertyName === 'files') {
      this.setValue = function () {};
    }
  }

  ValueAttributeObserver.prototype.getValue = function getValue() {
    return this.element[this.propertyName];
  };

  ValueAttributeObserver.prototype.setValue = function setValue(newValue) {
    newValue = newValue === undefined || newValue === null ? '' : newValue;
    if (this.element[this.propertyName] !== newValue) {
      this.element[this.propertyName] = newValue;
      this.notify();
    }
  };

  ValueAttributeObserver.prototype.notify = function notify() {
    var oldValue = this.oldValue;
    var newValue = this.getValue();

    this.callSubscribers(newValue, oldValue);

    this.oldValue = newValue;
  };

  ValueAttributeObserver.prototype.subscribe = function subscribe(context, callable) {
    if (!this.hasSubscribers()) {
      this.oldValue = this.getValue();
      this.disposeHandler = this.handler.subscribe(this.element, this.notify.bind(this));
    }

    this.addSubscriber(context, callable);
  };

  ValueAttributeObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    if (this.removeSubscriber(context, callable) && !this.hasSubscribers()) {
      this.disposeHandler();
      this.disposeHandler = null;
    }
  };

  return ValueAttributeObserver;
}()) || _class8);


var checkedArrayContext = 'CheckedObserver:array';
var checkedValueContext = 'CheckedObserver:value';

var CheckedObserver = exports.CheckedObserver = (_dec8 = subscriberCollection(), _dec8(_class9 = function () {
  function CheckedObserver(element, handler, observerLocator) {
    

    this.element = element;
    this.handler = handler;
    this.observerLocator = observerLocator;
  }

  CheckedObserver.prototype.getValue = function getValue() {
    return this.value;
  };

  CheckedObserver.prototype.setValue = function setValue(newValue) {
    if (this.value === newValue) {
      return;
    }

    if (this.arrayObserver) {
      this.arrayObserver.unsubscribe(checkedArrayContext, this);
      this.arrayObserver = null;
    }

    if (this.element.type === 'checkbox' && Array.isArray(newValue)) {
      this.arrayObserver = this.observerLocator.getArrayObserver(newValue);
      this.arrayObserver.subscribe(checkedArrayContext, this);
    }

    this.oldValue = this.value;
    this.value = newValue;
    this.synchronizeElement();
    this.notify();

    if (!this.initialSync) {
      this.initialSync = true;
      this.observerLocator.taskQueue.queueMicroTask(this);
    }
  };

  CheckedObserver.prototype.call = function call(context, splices) {
    this.synchronizeElement();

    if (!this.valueObserver) {
      this.valueObserver = this.element.__observers__.model || this.element.__observers__.value;
      if (this.valueObserver) {
        this.valueObserver.subscribe(checkedValueContext, this);
      }
    }
  };

  CheckedObserver.prototype.synchronizeElement = function synchronizeElement() {
    var value = this.value;
    var element = this.element;
    var elementValue = element.hasOwnProperty('model') ? element.model : element.value;
    var isRadio = element.type === 'radio';
    var matcher = element.matcher || function (a, b) {
      return a === b;
    };

    element.checked = isRadio && !!matcher(value, elementValue) || !isRadio && value === true || !isRadio && Array.isArray(value) && value.findIndex(function (item) {
      return !!matcher(item, elementValue);
    }) !== -1;
  };

  CheckedObserver.prototype.synchronizeValue = function synchronizeValue() {
    var value = this.value;
    var element = this.element;
    var elementValue = element.hasOwnProperty('model') ? element.model : element.value;
    var index = void 0;
    var matcher = element.matcher || function (a, b) {
      return a === b;
    };

    if (element.type === 'checkbox') {
      if (Array.isArray(value)) {
        index = value.findIndex(function (item) {
          return !!matcher(item, elementValue);
        });
        if (element.checked && index === -1) {
          value.push(elementValue);
        } else if (!element.checked && index !== -1) {
          value.splice(index, 1);
        }

        return;
      }

      value = element.checked;
    } else if (element.checked) {
      value = elementValue;
    } else {
      return;
    }

    this.oldValue = this.value;
    this.value = value;
    this.notify();
  };

  CheckedObserver.prototype.notify = function notify() {
    var oldValue = this.oldValue;
    var newValue = this.value;

    this.callSubscribers(newValue, oldValue);
  };

  CheckedObserver.prototype.subscribe = function subscribe(context, callable) {
    if (!this.hasSubscribers()) {
      this.disposeHandler = this.handler.subscribe(this.element, this.synchronizeValue.bind(this, false));
    }
    this.addSubscriber(context, callable);
  };

  CheckedObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    if (this.removeSubscriber(context, callable) && !this.hasSubscribers()) {
      this.disposeHandler();
      this.disposeHandler = null;
    }
  };

  CheckedObserver.prototype.unbind = function unbind() {
    if (this.arrayObserver) {
      this.arrayObserver.unsubscribe(checkedArrayContext, this);
      this.arrayObserver = null;
    }
    if (this.valueObserver) {
      this.valueObserver.unsubscribe(checkedValueContext, this);
    }
  };

  return CheckedObserver;
}()) || _class9);


var selectArrayContext = 'SelectValueObserver:array';

var SelectValueObserver = exports.SelectValueObserver = (_dec9 = subscriberCollection(), _dec9(_class10 = function () {
  function SelectValueObserver(element, handler, observerLocator) {
    

    this.element = element;
    this.handler = handler;
    this.observerLocator = observerLocator;
  }

  SelectValueObserver.prototype.getValue = function getValue() {
    return this.value;
  };

  SelectValueObserver.prototype.setValue = function setValue(newValue) {
    if (newValue !== null && newValue !== undefined && this.element.multiple && !Array.isArray(newValue)) {
      throw new Error('Only null or Array instances can be bound to a multi-select.');
    }
    if (this.value === newValue) {
      return;
    }

    if (this.arrayObserver) {
      this.arrayObserver.unsubscribe(selectArrayContext, this);
      this.arrayObserver = null;
    }

    if (Array.isArray(newValue)) {
      this.arrayObserver = this.observerLocator.getArrayObserver(newValue);
      this.arrayObserver.subscribe(selectArrayContext, this);
    }

    this.oldValue = this.value;
    this.value = newValue;
    this.synchronizeOptions();
    this.notify();

    if (!this.initialSync) {
      this.initialSync = true;
      this.observerLocator.taskQueue.queueMicroTask(this);
    }
  };

  SelectValueObserver.prototype.call = function call(context, splices) {
    this.synchronizeOptions();
  };

  SelectValueObserver.prototype.synchronizeOptions = function synchronizeOptions() {
    var value = this.value;
    var clear = void 0;
    var isArray = void 0;

    if (value === null || value === undefined) {
      clear = true;
    } else if (Array.isArray(value)) {
      isArray = true;
    }

    var options = this.element.options;
    var i = options.length;
    var matcher = this.element.matcher || function (a, b) {
      return a === b;
    };

    var _loop = function _loop() {
      var option = options.item(i);
      if (clear) {
        option.selected = false;
        return 'continue';
      }
      var optionValue = option.hasOwnProperty('model') ? option.model : option.value;
      if (isArray) {
        option.selected = value.findIndex(function (item) {
          return !!matcher(optionValue, item);
        }) !== -1;
        return 'continue';
      }
      option.selected = !!matcher(optionValue, value);
    };

    while (i--) {
      var _ret2 = _loop();

      if (_ret2 === 'continue') continue;
    }
  };

  SelectValueObserver.prototype.synchronizeValue = function synchronizeValue() {
    var _this24 = this;

    var options = this.element.options;
    var count = 0;
    var value = [];

    for (var _i23 = 0, ii = options.length; _i23 < ii; _i23++) {
      var _option = options.item(_i23);
      if (!_option.selected) {
        continue;
      }
      value.push(_option.hasOwnProperty('model') ? _option.model : _option.value);
      count++;
    }

    if (this.element.multiple) {
      if (Array.isArray(this.value)) {
        var _ret3 = function () {
          var matcher = _this24.element.matcher || function (a, b) {
            return a === b;
          };

          var i = 0;

          var _loop2 = function _loop2() {
            var a = _this24.value[i];
            if (value.findIndex(function (b) {
              return matcher(a, b);
            }) === -1) {
              _this24.value.splice(i, 1);
            } else {
              i++;
            }
          };

          while (i < _this24.value.length) {
            _loop2();
          }

          i = 0;

          var _loop3 = function _loop3() {
            var a = value[i];
            if (_this24.value.findIndex(function (b) {
              return matcher(a, b);
            }) === -1) {
              _this24.value.push(a);
            }
            i++;
          };

          while (i < value.length) {
            _loop3();
          }
          return {
            v: void 0
          };
        }();

        if ((typeof _ret3 === 'undefined' ? 'undefined' : _typeof(_ret3)) === "object") return _ret3.v;
      }
    } else {
        if (count === 0) {
          value = null;
        } else {
          value = value[0];
        }
      }

    if (value !== this.value) {
      this.oldValue = this.value;
      this.value = value;
      this.notify();
    }
  };

  SelectValueObserver.prototype.notify = function notify() {
    var oldValue = this.oldValue;
    var newValue = this.value;

    this.callSubscribers(newValue, oldValue);
  };

  SelectValueObserver.prototype.subscribe = function subscribe(context, callable) {
    if (!this.hasSubscribers()) {
      this.disposeHandler = this.handler.subscribe(this.element, this.synchronizeValue.bind(this, false));
    }
    this.addSubscriber(context, callable);
  };

  SelectValueObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    if (this.removeSubscriber(context, callable) && !this.hasSubscribers()) {
      this.disposeHandler();
      this.disposeHandler = null;
    }
  };

  SelectValueObserver.prototype.bind = function bind() {
    var _this25 = this;

    this.domObserver = _aureliaPal.DOM.createMutationObserver(function () {
      _this25.synchronizeOptions();
      _this25.synchronizeValue();
    });
    this.domObserver.observe(this.element, { childList: true, subtree: true });
  };

  SelectValueObserver.prototype.unbind = function unbind() {
    this.domObserver.disconnect();
    this.domObserver = null;

    if (this.arrayObserver) {
      this.arrayObserver.unsubscribe(selectArrayContext, this);
      this.arrayObserver = null;
    }
  };

  return SelectValueObserver;
}()) || _class10);

var ClassObserver = exports.ClassObserver = function () {
  function ClassObserver(element) {
    

    this.element = element;
    this.doNotCache = true;
    this.value = '';
    this.version = 0;
  }

  ClassObserver.prototype.getValue = function getValue() {
    return this.value;
  };

  ClassObserver.prototype.setValue = function setValue(newValue) {
    var nameIndex = this.nameIndex || {};
    var version = this.version;
    var names = void 0;
    var name = void 0;

    if (newValue !== null && newValue !== undefined && newValue.length) {
      names = newValue.split(/\s+/);
      for (var _i24 = 0, length = names.length; _i24 < length; _i24++) {
        name = names[_i24];
        if (name === '') {
          continue;
        }
        nameIndex[name] = version;
        this.element.classList.add(name);
      }
    }

    this.value = newValue;
    this.nameIndex = nameIndex;
    this.version += 1;

    if (version === 0) {
      return;
    }

    version -= 1;
    for (name in nameIndex) {
      if (!nameIndex.hasOwnProperty(name) || nameIndex[name] !== version) {
        continue;
      }
      this.element.classList.remove(name);
    }
  };

  ClassObserver.prototype.subscribe = function subscribe() {
    throw new Error('Observation of a "' + this.element.nodeName + '" element\'s "class" property is not supported.');
  };

  return ClassObserver;
}();

function hasDeclaredDependencies(descriptor) {
  return !!(descriptor && descriptor.get && descriptor.get.dependencies);
}

function declarePropertyDependencies(ctor, propertyName, dependencies) {
  var descriptor = Object.getOwnPropertyDescriptor(ctor.prototype, propertyName);
  descriptor.get.dependencies = dependencies;
}

function computedFrom() {
  for (var _len = arguments.length, rest = Array(_len), _key = 0; _key < _len; _key++) {
    rest[_key] = arguments[_key];
  }

  return function (target, key, descriptor) {
    descriptor.get.dependencies = rest;
    return descriptor;
  };
}

var ComputedExpression = exports.ComputedExpression = function (_Expression19) {
  _inherits(ComputedExpression, _Expression19);

  function ComputedExpression(name, dependencies) {
    

    var _this26 = _possibleConstructorReturn(this, _Expression19.call(this));

    _this26.name = name;
    _this26.dependencies = dependencies;
    _this26.isAssignable = true;
    return _this26;
  }

  ComputedExpression.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    return scope.bindingContext[this.name];
  };

  ComputedExpression.prototype.assign = function assign(scope, value) {
    scope.bindingContext[this.name] = value;
  };

  ComputedExpression.prototype.accept = function accept(visitor) {
    throw new Error('not implemented');
  };

  ComputedExpression.prototype.connect = function connect(binding, scope) {
    var dependencies = this.dependencies;
    var i = dependencies.length;
    while (i--) {
      dependencies[i].connect(binding, scope);
    }
  };

  return ComputedExpression;
}(Expression);

function createComputedObserver(obj, propertyName, descriptor, observerLocator) {
  var dependencies = descriptor.get.dependencies;
  if (!(dependencies instanceof ComputedExpression)) {
    var _i25 = dependencies.length;
    while (_i25--) {
      dependencies[_i25] = observerLocator.parser.parse(dependencies[_i25]);
    }
    dependencies = descriptor.get.dependencies = new ComputedExpression(propertyName, dependencies);
  }

  var scope = { bindingContext: obj, overrideContext: createOverrideContext(obj) };
  return new ExpressionObserver(scope, dependencies, observerLocator);
}

var elements = exports.elements = {
  a: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'target', 'transform', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
  altGlyph: ['class', 'dx', 'dy', 'externalResourcesRequired', 'format', 'glyphRef', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rotate', 'style', 'systemLanguage', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  altGlyphDef: ['id', 'xml:base', 'xml:lang', 'xml:space'],
  altGlyphItem: ['id', 'xml:base', 'xml:lang', 'xml:space'],
  animate: ['accumulate', 'additive', 'attributeName', 'attributeType', 'begin', 'by', 'calcMode', 'dur', 'end', 'externalResourcesRequired', 'fill', 'from', 'id', 'keySplines', 'keyTimes', 'max', 'min', 'onbegin', 'onend', 'onload', 'onrepeat', 'repeatCount', 'repeatDur', 'requiredExtensions', 'requiredFeatures', 'restart', 'systemLanguage', 'to', 'values', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
  animateColor: ['accumulate', 'additive', 'attributeName', 'attributeType', 'begin', 'by', 'calcMode', 'dur', 'end', 'externalResourcesRequired', 'fill', 'from', 'id', 'keySplines', 'keyTimes', 'max', 'min', 'onbegin', 'onend', 'onload', 'onrepeat', 'repeatCount', 'repeatDur', 'requiredExtensions', 'requiredFeatures', 'restart', 'systemLanguage', 'to', 'values', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
  animateMotion: ['accumulate', 'additive', 'begin', 'by', 'calcMode', 'dur', 'end', 'externalResourcesRequired', 'fill', 'from', 'id', 'keyPoints', 'keySplines', 'keyTimes', 'max', 'min', 'onbegin', 'onend', 'onload', 'onrepeat', 'origin', 'path', 'repeatCount', 'repeatDur', 'requiredExtensions', 'requiredFeatures', 'restart', 'rotate', 'systemLanguage', 'to', 'values', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
  animateTransform: ['accumulate', 'additive', 'attributeName', 'attributeType', 'begin', 'by', 'calcMode', 'dur', 'end', 'externalResourcesRequired', 'fill', 'from', 'id', 'keySplines', 'keyTimes', 'max', 'min', 'onbegin', 'onend', 'onload', 'onrepeat', 'repeatCount', 'repeatDur', 'requiredExtensions', 'requiredFeatures', 'restart', 'systemLanguage', 'to', 'type', 'values', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
  circle: ['class', 'cx', 'cy', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'r', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
  clipPath: ['class', 'clipPathUnits', 'externalResourcesRequired', 'id', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
  'color-profile': ['id', 'local', 'name', 'rendering-intent', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
  cursor: ['externalResourcesRequired', 'id', 'requiredExtensions', 'requiredFeatures', 'systemLanguage', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  defs: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
  desc: ['class', 'id', 'style', 'xml:base', 'xml:lang', 'xml:space'],
  ellipse: ['class', 'cx', 'cy', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rx', 'ry', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
  feBlend: ['class', 'height', 'id', 'in', 'in2', 'mode', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  feColorMatrix: ['class', 'height', 'id', 'in', 'result', 'style', 'type', 'values', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  feComponentTransfer: ['class', 'height', 'id', 'in', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  feComposite: ['class', 'height', 'id', 'in', 'in2', 'k1', 'k2', 'k3', 'k4', 'operator', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  feConvolveMatrix: ['bias', 'class', 'divisor', 'edgeMode', 'height', 'id', 'in', 'kernelMatrix', 'kernelUnitLength', 'order', 'preserveAlpha', 'result', 'style', 'targetX', 'targetY', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  feDiffuseLighting: ['class', 'diffuseConstant', 'height', 'id', 'in', 'kernelUnitLength', 'result', 'style', 'surfaceScale', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  feDisplacementMap: ['class', 'height', 'id', 'in', 'in2', 'result', 'scale', 'style', 'width', 'x', 'xChannelSelector', 'xml:base', 'xml:lang', 'xml:space', 'y', 'yChannelSelector'],
  feDistantLight: ['azimuth', 'elevation', 'id', 'xml:base', 'xml:lang', 'xml:space'],
  feFlood: ['class', 'height', 'id', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  feFuncA: ['amplitude', 'exponent', 'id', 'intercept', 'offset', 'slope', 'tableValues', 'type', 'xml:base', 'xml:lang', 'xml:space'],
  feFuncB: ['amplitude', 'exponent', 'id', 'intercept', 'offset', 'slope', 'tableValues', 'type', 'xml:base', 'xml:lang', 'xml:space'],
  feFuncG: ['amplitude', 'exponent', 'id', 'intercept', 'offset', 'slope', 'tableValues', 'type', 'xml:base', 'xml:lang', 'xml:space'],
  feFuncR: ['amplitude', 'exponent', 'id', 'intercept', 'offset', 'slope', 'tableValues', 'type', 'xml:base', 'xml:lang', 'xml:space'],
  feGaussianBlur: ['class', 'height', 'id', 'in', 'result', 'stdDeviation', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  feImage: ['class', 'externalResourcesRequired', 'height', 'id', 'preserveAspectRatio', 'result', 'style', 'width', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  feMerge: ['class', 'height', 'id', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  feMergeNode: ['id', 'xml:base', 'xml:lang', 'xml:space'],
  feMorphology: ['class', 'height', 'id', 'in', 'operator', 'radius', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  feOffset: ['class', 'dx', 'dy', 'height', 'id', 'in', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  fePointLight: ['id', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y', 'z'],
  feSpecularLighting: ['class', 'height', 'id', 'in', 'kernelUnitLength', 'result', 'specularConstant', 'specularExponent', 'style', 'surfaceScale', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  feSpotLight: ['id', 'limitingConeAngle', 'pointsAtX', 'pointsAtY', 'pointsAtZ', 'specularExponent', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y', 'z'],
  feTile: ['class', 'height', 'id', 'in', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  feTurbulence: ['baseFrequency', 'class', 'height', 'id', 'numOctaves', 'result', 'seed', 'stitchTiles', 'style', 'type', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  filter: ['class', 'externalResourcesRequired', 'filterRes', 'filterUnits', 'height', 'id', 'primitiveUnits', 'style', 'width', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  font: ['class', 'externalResourcesRequired', 'horiz-adv-x', 'horiz-origin-x', 'horiz-origin-y', 'id', 'style', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'xml:base', 'xml:lang', 'xml:space'],
  'font-face': ['accent-height', 'alphabetic', 'ascent', 'bbox', 'cap-height', 'descent', 'font-family', 'font-size', 'font-stretch', 'font-style', 'font-variant', 'font-weight', 'hanging', 'id', 'ideographic', 'mathematical', 'overline-position', 'overline-thickness', 'panose-1', 'slope', 'stemh', 'stemv', 'strikethrough-position', 'strikethrough-thickness', 'underline-position', 'underline-thickness', 'unicode-range', 'units-per-em', 'v-alphabetic', 'v-hanging', 'v-ideographic', 'v-mathematical', 'widths', 'x-height', 'xml:base', 'xml:lang', 'xml:space'],
  'font-face-format': ['id', 'string', 'xml:base', 'xml:lang', 'xml:space'],
  'font-face-name': ['id', 'name', 'xml:base', 'xml:lang', 'xml:space'],
  'font-face-src': ['id', 'xml:base', 'xml:lang', 'xml:space'],
  'font-face-uri': ['id', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
  foreignObject: ['class', 'externalResourcesRequired', 'height', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  g: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
  glyph: ['arabic-form', 'class', 'd', 'glyph-name', 'horiz-adv-x', 'id', 'lang', 'orientation', 'style', 'unicode', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'xml:base', 'xml:lang', 'xml:space'],
  glyphRef: ['class', 'dx', 'dy', 'format', 'glyphRef', 'id', 'style', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  hkern: ['g1', 'g2', 'id', 'k', 'u1', 'u2', 'xml:base', 'xml:lang', 'xml:space'],
  image: ['class', 'externalResourcesRequired', 'height', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'preserveAspectRatio', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'width', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  line: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'x1', 'x2', 'xml:base', 'xml:lang', 'xml:space', 'y1', 'y2'],
  linearGradient: ['class', 'externalResourcesRequired', 'gradientTransform', 'gradientUnits', 'id', 'spreadMethod', 'style', 'x1', 'x2', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y1', 'y2'],
  marker: ['class', 'externalResourcesRequired', 'id', 'markerHeight', 'markerUnits', 'markerWidth', 'orient', 'preserveAspectRatio', 'refX', 'refY', 'style', 'viewBox', 'xml:base', 'xml:lang', 'xml:space'],
  mask: ['class', 'externalResourcesRequired', 'height', 'id', 'maskContentUnits', 'maskUnits', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  metadata: ['id', 'xml:base', 'xml:lang', 'xml:space'],
  'missing-glyph': ['class', 'd', 'horiz-adv-x', 'id', 'style', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'xml:base', 'xml:lang', 'xml:space'],
  mpath: ['externalResourcesRequired', 'id', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
  path: ['class', 'd', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'pathLength', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
  pattern: ['class', 'externalResourcesRequired', 'height', 'id', 'patternContentUnits', 'patternTransform', 'patternUnits', 'preserveAspectRatio', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'viewBox', 'width', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  polygon: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'points', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
  polyline: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'points', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
  radialGradient: ['class', 'cx', 'cy', 'externalResourcesRequired', 'fx', 'fy', 'gradientTransform', 'gradientUnits', 'id', 'r', 'spreadMethod', 'style', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
  rect: ['class', 'externalResourcesRequired', 'height', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rx', 'ry', 'style', 'systemLanguage', 'transform', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  script: ['externalResourcesRequired', 'id', 'type', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
  set: ['attributeName', 'attributeType', 'begin', 'dur', 'end', 'externalResourcesRequired', 'fill', 'id', 'max', 'min', 'onbegin', 'onend', 'onload', 'onrepeat', 'repeatCount', 'repeatDur', 'requiredExtensions', 'requiredFeatures', 'restart', 'systemLanguage', 'to', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
  stop: ['class', 'id', 'offset', 'style', 'xml:base', 'xml:lang', 'xml:space'],
  style: ['id', 'media', 'title', 'type', 'xml:base', 'xml:lang', 'xml:space'],
  svg: ['baseProfile', 'class', 'contentScriptType', 'contentStyleType', 'externalResourcesRequired', 'height', 'id', 'onabort', 'onactivate', 'onclick', 'onerror', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'onresize', 'onscroll', 'onunload', 'onzoom', 'preserveAspectRatio', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'version', 'viewBox', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y', 'zoomAndPan'],
  switch: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
  symbol: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'preserveAspectRatio', 'style', 'viewBox', 'xml:base', 'xml:lang', 'xml:space'],
  text: ['class', 'dx', 'dy', 'externalResourcesRequired', 'id', 'lengthAdjust', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rotate', 'style', 'systemLanguage', 'textLength', 'transform', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  textPath: ['class', 'externalResourcesRequired', 'id', 'lengthAdjust', 'method', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'spacing', 'startOffset', 'style', 'systemLanguage', 'textLength', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
  title: ['class', 'id', 'style', 'xml:base', 'xml:lang', 'xml:space'],
  tref: ['class', 'dx', 'dy', 'externalResourcesRequired', 'id', 'lengthAdjust', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rotate', 'style', 'systemLanguage', 'textLength', 'x', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  tspan: ['class', 'dx', 'dy', 'externalResourcesRequired', 'id', 'lengthAdjust', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rotate', 'style', 'systemLanguage', 'textLength', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  use: ['class', 'externalResourcesRequired', 'height', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'width', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
  view: ['externalResourcesRequired', 'id', 'preserveAspectRatio', 'viewBox', 'viewTarget', 'xml:base', 'xml:lang', 'xml:space', 'zoomAndPan'],
  vkern: ['g1', 'g2', 'id', 'k', 'u1', 'u2', 'xml:base', 'xml:lang', 'xml:space']
};
var presentationElements = exports.presentationElements = {
  'a': true,
  'altGlyph': true,
  'animate': true,
  'animateColor': true,
  'circle': true,
  'clipPath': true,
  'defs': true,
  'ellipse': true,
  'feBlend': true,
  'feColorMatrix': true,
  'feComponentTransfer': true,
  'feComposite': true,
  'feConvolveMatrix': true,
  'feDiffuseLighting': true,
  'feDisplacementMap': true,
  'feFlood': true,
  'feGaussianBlur': true,
  'feImage': true,
  'feMerge': true,
  'feMorphology': true,
  'feOffset': true,
  'feSpecularLighting': true,
  'feTile': true,
  'feTurbulence': true,
  'filter': true,
  'font': true,
  'foreignObject': true,
  'g': true,
  'glyph': true,
  'glyphRef': true,
  'image': true,
  'line': true,
  'linearGradient': true,
  'marker': true,
  'mask': true,
  'missing-glyph': true,
  'path': true,
  'pattern': true,
  'polygon': true,
  'polyline': true,
  'radialGradient': true,
  'rect': true,
  'stop': true,
  'svg': true,
  'switch': true,
  'symbol': true,
  'text': true,
  'textPath': true,
  'tref': true,
  'tspan': true,
  'use': true
};

var presentationAttributes = exports.presentationAttributes = {
  'alignment-baseline': true,
  'baseline-shift': true,
  'clip-path': true,
  'clip-rule': true,
  'clip': true,
  'color-interpolation-filters': true,
  'color-interpolation': true,
  'color-profile': true,
  'color-rendering': true,
  'color': true,
  'cursor': true,
  'direction': true,
  'display': true,
  'dominant-baseline': true,
  'enable-background': true,
  'fill-opacity': true,
  'fill-rule': true,
  'fill': true,
  'filter': true,
  'flood-color': true,
  'flood-opacity': true,
  'font-family': true,
  'font-size-adjust': true,
  'font-size': true,
  'font-stretch': true,
  'font-style': true,
  'font-variant': true,
  'font-weight': true,
  'glyph-orientation-horizontal': true,
  'glyph-orientation-vertical': true,
  'image-rendering': true,
  'kerning': true,
  'letter-spacing': true,
  'lighting-color': true,
  'marker-end': true,
  'marker-mid': true,
  'marker-start': true,
  'mask': true,
  'opacity': true,
  'overflow': true,
  'pointer-events': true,
  'shape-rendering': true,
  'stop-color': true,
  'stop-opacity': true,
  'stroke-dasharray': true,
  'stroke-dashoffset': true,
  'stroke-linecap': true,
  'stroke-linejoin': true,
  'stroke-miterlimit': true,
  'stroke-opacity': true,
  'stroke-width': true,
  'stroke': true,
  'text-anchor': true,
  'text-decoration': true,
  'text-rendering': true,
  'unicode-bidi': true,
  'visibility': true,
  'word-spacing': true,
  'writing-mode': true
};

function createElement(html) {
  var div = _aureliaPal.DOM.createElement('div');
  div.innerHTML = html;
  return div.firstChild;
}

var SVGAnalyzer = exports.SVGAnalyzer = function () {
  function SVGAnalyzer() {
    

    if (createElement('<svg><altGlyph /></svg>').firstElementChild.nodeName === 'altglyph' && elements.altGlyph) {
      elements.altglyph = elements.altGlyph;
      delete elements.altGlyph;
      elements.altglyphdef = elements.altGlyphDef;
      delete elements.altGlyphDef;
      elements.altglyphitem = elements.altGlyphItem;
      delete elements.altGlyphItem;
      elements.glyphref = elements.glyphRef;
      delete elements.glyphRef;
    }
  }

  SVGAnalyzer.prototype.isStandardSvgAttribute = function isStandardSvgAttribute(nodeName, attributeName) {
    return presentationElements[nodeName] && presentationAttributes[attributeName] || elements[nodeName] && elements[nodeName].indexOf(attributeName) !== -1;
  };

  return SVGAnalyzer;
}();

var ObserverLocator = exports.ObserverLocator = (_temp = _class11 = function () {
  function ObserverLocator(taskQueue, eventManager, dirtyChecker, svgAnalyzer, parser) {
    

    this.taskQueue = taskQueue;
    this.eventManager = eventManager;
    this.dirtyChecker = dirtyChecker;
    this.svgAnalyzer = svgAnalyzer;
    this.parser = parser;
    this.adapters = [];
    this.logger = LogManager.getLogger('observer-locator');
  }

  ObserverLocator.prototype.getObserver = function getObserver(obj, propertyName) {
    var observersLookup = obj.__observers__;
    var observer = void 0;

    if (observersLookup && propertyName in observersLookup) {
      return observersLookup[propertyName];
    }

    observer = this.createPropertyObserver(obj, propertyName);

    if (!observer.doNotCache) {
      if (observersLookup === undefined) {
        observersLookup = this.getOrCreateObserversLookup(obj);
      }

      observersLookup[propertyName] = observer;
    }

    return observer;
  };

  ObserverLocator.prototype.getOrCreateObserversLookup = function getOrCreateObserversLookup(obj) {
    return obj.__observers__ || this.createObserversLookup(obj);
  };

  ObserverLocator.prototype.createObserversLookup = function createObserversLookup(obj) {
    var value = {};

    if (!Reflect.defineProperty(obj, '__observers__', {
      enumerable: false,
      configurable: false,
      writable: false,
      value: value
    })) {
      this.logger.warn('Cannot add observers to object', obj);
    }

    return value;
  };

  ObserverLocator.prototype.addAdapter = function addAdapter(adapter) {
    this.adapters.push(adapter);
  };

  ObserverLocator.prototype.getAdapterObserver = function getAdapterObserver(obj, propertyName, descriptor) {
    for (var _i26 = 0, ii = this.adapters.length; _i26 < ii; _i26++) {
      var adapter = this.adapters[_i26];
      var observer = adapter.getObserver(obj, propertyName, descriptor);
      if (observer) {
        return observer;
      }
    }
    return null;
  };

  ObserverLocator.prototype.createPropertyObserver = function createPropertyObserver(obj, propertyName) {
    var descriptor = void 0;
    var handler = void 0;
    var xlinkResult = void 0;

    if (!(obj instanceof Object)) {
      return new PrimitiveObserver(obj, propertyName);
    }

    if (obj instanceof _aureliaPal.DOM.Element) {
      if (propertyName === 'class') {
        return new ClassObserver(obj);
      }
      if (propertyName === 'style' || propertyName === 'css') {
        return new StyleObserver(obj, propertyName);
      }
      handler = this.eventManager.getElementHandler(obj, propertyName);
      if (propertyName === 'value' && obj.tagName.toLowerCase() === 'select') {
        return new SelectValueObserver(obj, handler, this);
      }
      if (propertyName === 'checked' && obj.tagName.toLowerCase() === 'input') {
        return new CheckedObserver(obj, handler, this);
      }
      if (handler) {
        return new ValueAttributeObserver(obj, propertyName, handler);
      }
      xlinkResult = /^xlink:(.+)$/.exec(propertyName);
      if (xlinkResult) {
        return new XLinkAttributeObserver(obj, propertyName, xlinkResult[1]);
      }
      if (/^\w+:|^data-|^aria-/.test(propertyName) || obj instanceof _aureliaPal.DOM.SVGElement && this.svgAnalyzer.isStandardSvgAttribute(obj.nodeName, propertyName)) {
        return new DataAttributeObserver(obj, propertyName);
      }
    }

    descriptor = Object.getPropertyDescriptor(obj, propertyName);

    if (hasDeclaredDependencies(descriptor)) {
      return createComputedObserver(obj, propertyName, descriptor, this);
    }

    if (descriptor) {
      var existingGetterOrSetter = descriptor.get || descriptor.set;
      if (existingGetterOrSetter) {
        if (existingGetterOrSetter.getObserver) {
          return existingGetterOrSetter.getObserver(obj);
        }

        var adapterObserver = this.getAdapterObserver(obj, propertyName, descriptor);
        if (adapterObserver) {
          return adapterObserver;
        }
        return new DirtyCheckProperty(this.dirtyChecker, obj, propertyName);
      }
    }

    if (obj instanceof Array) {
      if (propertyName === 'length') {
        return this.getArrayObserver(obj).getLengthObserver();
      }

      return new DirtyCheckProperty(this.dirtyChecker, obj, propertyName);
    } else if (obj instanceof Map) {
      if (propertyName === 'size') {
        return this.getMapObserver(obj).getLengthObserver();
      }

      return new DirtyCheckProperty(this.dirtyChecker, obj, propertyName);
    } else if (obj instanceof Set) {
      if (propertyName === 'size') {
        return this.getSetObserver(obj).getLengthObserver();
      }

      return new DirtyCheckProperty(this.dirtyChecker, obj, propertyName);
    }

    return new SetterObserver(this.taskQueue, obj, propertyName);
  };

  ObserverLocator.prototype.getAccessor = function getAccessor(obj, propertyName) {
    if (obj instanceof _aureliaPal.DOM.Element) {
      if (propertyName === 'class' || propertyName === 'style' || propertyName === 'css' || propertyName === 'value' && (obj.tagName.toLowerCase() === 'input' || obj.tagName.toLowerCase() === 'select') || propertyName === 'checked' && obj.tagName.toLowerCase() === 'input' || propertyName === 'model' && obj.tagName.toLowerCase() === 'input' || /^xlink:.+$/.exec(propertyName)) {
        return this.getObserver(obj, propertyName);
      }
      if (/^\w+:|^data-|^aria-/.test(propertyName) || obj instanceof _aureliaPal.DOM.SVGElement && this.svgAnalyzer.isStandardSvgAttribute(obj.nodeName, propertyName)) {
        return dataAttributeAccessor;
      }
    }
    return propertyAccessor;
  };

  ObserverLocator.prototype.getArrayObserver = function getArrayObserver(array) {
    return _getArrayObserver(this.taskQueue, array);
  };

  ObserverLocator.prototype.getMapObserver = function getMapObserver(map) {
    return _getMapObserver(this.taskQueue, map);
  };

  ObserverLocator.prototype.getSetObserver = function getSetObserver(set) {
    return _getSetObserver(this.taskQueue, set);
  };

  return ObserverLocator;
}(), _class11.inject = [_aureliaTaskQueue.TaskQueue, EventManager, DirtyChecker, SVGAnalyzer, Parser], _temp);

var ObjectObservationAdapter = exports.ObjectObservationAdapter = function () {
  function ObjectObservationAdapter() {
    
  }

  ObjectObservationAdapter.prototype.getObserver = function getObserver(object, propertyName, descriptor) {
    throw new Error('BindingAdapters must implement getObserver(object, propertyName).');
  };

  return ObjectObservationAdapter;
}();

var BindingExpression = exports.BindingExpression = function () {
  function BindingExpression(observerLocator, targetProperty, sourceExpression, mode, lookupFunctions, attribute) {
    

    this.observerLocator = observerLocator;
    this.targetProperty = targetProperty;
    this.sourceExpression = sourceExpression;
    this.mode = mode;
    this.lookupFunctions = lookupFunctions;
    this.attribute = attribute;
    this.discrete = false;
  }

  BindingExpression.prototype.createBinding = function createBinding(target) {
    return new Binding(this.observerLocator, this.sourceExpression, target, this.targetProperty, this.mode, this.lookupFunctions);
  };

  return BindingExpression;
}();

var targetContext = 'Binding:target';

var Binding = exports.Binding = (_dec10 = connectable(), _dec10(_class12 = function () {
  function Binding(observerLocator, sourceExpression, target, targetProperty, mode, lookupFunctions) {
    

    this.observerLocator = observerLocator;
    this.sourceExpression = sourceExpression;
    this.target = target;
    this.targetProperty = targetProperty;
    this.mode = mode;
    this.lookupFunctions = lookupFunctions;
  }

  Binding.prototype.updateTarget = function updateTarget(value) {
    this.targetObserver.setValue(value, this.target, this.targetProperty);
  };

  Binding.prototype.updateSource = function updateSource(value) {
    this.sourceExpression.assign(this.source, value, this.lookupFunctions);
  };

  Binding.prototype.call = function call(context, newValue, oldValue) {
    if (!this.isBound) {
      return;
    }
    if (context === sourceContext) {
      oldValue = this.targetObserver.getValue(this.target, this.targetProperty);
      newValue = this.sourceExpression.evaluate(this.source, this.lookupFunctions);
      if (newValue !== oldValue) {
        this.updateTarget(newValue);
      }
      if (this.mode !== bindingMode.oneTime) {
        this._version++;
        this.sourceExpression.connect(this, this.source);
        this.unobserve(false);
      }
      return;
    }
    if (context === targetContext) {
      if (newValue !== this.sourceExpression.evaluate(this.source, this.lookupFunctions)) {
        this.updateSource(newValue);
      }
      return;
    }
    throw new Error('Unexpected call context ' + context);
  };

  Binding.prototype.bind = function bind(source) {
    if (this.isBound) {
      if (this.source === source) {
        return;
      }
      this.unbind();
    }
    this.isBound = true;
    this.source = source;

    if (this.sourceExpression.bind) {
      this.sourceExpression.bind(this, source, this.lookupFunctions);
    }

    var mode = this.mode;
    if (!this.targetObserver) {
      var method = mode === bindingMode.twoWay ? 'getObserver' : 'getAccessor';
      this.targetObserver = this.observerLocator[method](this.target, this.targetProperty);
    }

    if ('bind' in this.targetObserver) {
      this.targetObserver.bind();
    }
    var value = this.sourceExpression.evaluate(source, this.lookupFunctions);
    this.updateTarget(value);

    if (mode === bindingMode.oneWay) {
      enqueueBindingConnect(this);
    } else if (mode === bindingMode.twoWay) {
      this.sourceExpression.connect(this, source);
      this.targetObserver.subscribe(targetContext, this);
    }
  };

  Binding.prototype.unbind = function unbind() {
    if (!this.isBound) {
      return;
    }
    this.isBound = false;
    if (this.sourceExpression.unbind) {
      this.sourceExpression.unbind(this, this.source);
    }
    this.source = null;
    if ('unbind' in this.targetObserver) {
      this.targetObserver.unbind();
    }
    if (this.targetObserver.unsubscribe) {
      this.targetObserver.unsubscribe(targetContext, this);
    }
    this.unobserve(true);
  };

  Binding.prototype.connect = function connect(evaluate) {
    if (!this.isBound) {
      return;
    }
    if (evaluate) {
      var value = this.sourceExpression.evaluate(this.source, this.lookupFunctions);
      this.updateTarget(value);
    }
    this.sourceExpression.connect(this, this.source);
  };

  return Binding;
}()) || _class12);

var CallExpression = exports.CallExpression = function () {
  function CallExpression(observerLocator, targetProperty, sourceExpression, lookupFunctions) {
    

    this.observerLocator = observerLocator;
    this.targetProperty = targetProperty;
    this.sourceExpression = sourceExpression;
    this.lookupFunctions = lookupFunctions;
  }

  CallExpression.prototype.createBinding = function createBinding(target) {
    return new Call(this.observerLocator, this.sourceExpression, target, this.targetProperty, this.lookupFunctions);
  };

  return CallExpression;
}();

var Call = exports.Call = function () {
  function Call(observerLocator, sourceExpression, target, targetProperty, lookupFunctions) {
    

    this.sourceExpression = sourceExpression;
    this.target = target;
    this.targetProperty = observerLocator.getObserver(target, targetProperty);
    this.lookupFunctions = lookupFunctions;
  }

  Call.prototype.callSource = function callSource($event) {
    var overrideContext = this.source.overrideContext;
    Object.assign(overrideContext, $event);
    overrideContext.$event = $event;
    var mustEvaluate = true;
    var result = this.sourceExpression.evaluate(this.source, this.lookupFunctions, mustEvaluate);
    delete overrideContext.$event;
    for (var prop in $event) {
      delete overrideContext[prop];
    }
    return result;
  };

  Call.prototype.bind = function bind(source) {
    var _this27 = this;

    if (this.isBound) {
      if (this.source === source) {
        return;
      }
      this.unbind();
    }
    this.isBound = true;
    this.source = source;

    if (this.sourceExpression.bind) {
      this.sourceExpression.bind(this, source, this.lookupFunctions);
    }
    this.targetProperty.setValue(function ($event) {
      return _this27.callSource($event);
    });
  };

  Call.prototype.unbind = function unbind() {
    if (!this.isBound) {
      return;
    }
    this.isBound = false;
    if (this.sourceExpression.unbind) {
      this.sourceExpression.unbind(this, this.source);
    }
    this.source = null;
    this.targetProperty.setValue(null);
  };

  return Call;
}();

var ValueConverterResource = exports.ValueConverterResource = function () {
  function ValueConverterResource(name) {
    

    this.name = name;
  }

  ValueConverterResource.convention = function convention(name) {
    if (name.endsWith('ValueConverter')) {
      return new ValueConverterResource(camelCase(name.substring(0, name.length - 14)));
    }
  };

  ValueConverterResource.prototype.initialize = function initialize(container, target) {
    this.instance = container.get(target);
  };

  ValueConverterResource.prototype.register = function register(registry, name) {
    registry.registerValueConverter(name || this.name, this.instance);
  };

  ValueConverterResource.prototype.load = function load(container, target) {};

  return ValueConverterResource;
}();

function valueConverter(nameOrTarget) {
  if (nameOrTarget === undefined || typeof nameOrTarget === 'string') {
    return function (target) {
      _aureliaMetadata.metadata.define(_aureliaMetadata.metadata.resource, new ValueConverterResource(nameOrTarget), target);
    };
  }

  _aureliaMetadata.metadata.define(_aureliaMetadata.metadata.resource, new ValueConverterResource(), nameOrTarget);
}

var BindingBehaviorResource = exports.BindingBehaviorResource = function () {
  function BindingBehaviorResource(name) {
    

    this.name = name;
  }

  BindingBehaviorResource.convention = function convention(name) {
    if (name.endsWith('BindingBehavior')) {
      return new BindingBehaviorResource(camelCase(name.substring(0, name.length - 15)));
    }
  };

  BindingBehaviorResource.prototype.initialize = function initialize(container, target) {
    this.instance = container.get(target);
  };

  BindingBehaviorResource.prototype.register = function register(registry, name) {
    registry.registerBindingBehavior(name || this.name, this.instance);
  };

  BindingBehaviorResource.prototype.load = function load(container, target) {};

  return BindingBehaviorResource;
}();

function bindingBehavior(nameOrTarget) {
  if (nameOrTarget === undefined || typeof nameOrTarget === 'string') {
    return function (target) {
      _aureliaMetadata.metadata.define(_aureliaMetadata.metadata.resource, new BindingBehaviorResource(nameOrTarget), target);
    };
  }

  _aureliaMetadata.metadata.define(_aureliaMetadata.metadata.resource, new BindingBehaviorResource(), nameOrTarget);
}

var ListenerExpression = exports.ListenerExpression = function () {
  function ListenerExpression(eventManager, targetEvent, sourceExpression, delegate, preventDefault, lookupFunctions) {
    

    this.eventManager = eventManager;
    this.targetEvent = targetEvent;
    this.sourceExpression = sourceExpression;
    this.delegate = delegate;
    this.discrete = true;
    this.preventDefault = preventDefault;
    this.lookupFunctions = lookupFunctions;
  }

  ListenerExpression.prototype.createBinding = function createBinding(target) {
    return new Listener(this.eventManager, this.targetEvent, this.delegate, this.sourceExpression, target, this.preventDefault, this.lookupFunctions);
  };

  return ListenerExpression;
}();

var Listener = exports.Listener = function () {
  function Listener(eventManager, targetEvent, delegate, sourceExpression, target, preventDefault, lookupFunctions) {
    

    this.eventManager = eventManager;
    this.targetEvent = targetEvent;
    this.delegate = delegate;
    this.sourceExpression = sourceExpression;
    this.target = target;
    this.preventDefault = preventDefault;
    this.lookupFunctions = lookupFunctions;
  }

  Listener.prototype.callSource = function callSource(event) {
    var overrideContext = this.source.overrideContext;
    overrideContext.$event = event;
    var mustEvaluate = true;
    var result = this.sourceExpression.evaluate(this.source, this.lookupFunctions, mustEvaluate);
    delete overrideContext.$event;
    if (result !== true && this.preventDefault) {
      event.preventDefault();
    }
    return result;
  };

  Listener.prototype.bind = function bind(source) {
    var _this28 = this;

    if (this.isBound) {
      if (this.source === source) {
        return;
      }
      this.unbind();
    }
    this.isBound = true;
    this.source = source;

    if (this.sourceExpression.bind) {
      this.sourceExpression.bind(this, source, this.lookupFunctions);
    }
    this._disposeListener = this.eventManager.addEventListener(this.target, this.targetEvent, function (event) {
      return _this28.callSource(event);
    }, this.delegate);
  };

  Listener.prototype.unbind = function unbind() {
    if (!this.isBound) {
      return;
    }
    this.isBound = false;
    if (this.sourceExpression.unbind) {
      this.sourceExpression.unbind(this, this.source);
    }
    this.source = null;
    this._disposeListener();
    this._disposeListener = null;
  };

  return Listener;
}();

function getAU(element) {
  var au = element.au;

  if (au === undefined) {
    throw new Error('No Aurelia APIs are defined for the element: "' + element.tagName + '".');
  }

  return au;
}

var NameExpression = exports.NameExpression = function () {
  function NameExpression(sourceExpression, apiName, lookupFunctions) {
    

    this.sourceExpression = sourceExpression;
    this.apiName = apiName;
    this.lookupFunctions = lookupFunctions;
    this.discrete = true;
  }

  NameExpression.prototype.createBinding = function createBinding(target) {
    return new NameBinder(this.sourceExpression, NameExpression.locateAPI(target, this.apiName), this.lookupFunctions);
  };

  NameExpression.locateAPI = function locateAPI(element, apiName) {
    switch (apiName) {
      case 'element':
        return element;
      case 'controller':
        return getAU(element).controller;
      case 'view-model':
        return getAU(element).controller.viewModel;
      case 'view':
        return getAU(element).controller.view;
      default:
        var target = getAU(element)[apiName];

        if (target === undefined) {
          throw new Error('Attempted to reference "' + apiName + '", but it was not found amongst the target\'s API.');
        }

        return target.viewModel;
    }
  };

  return NameExpression;
}();

var NameBinder = function () {
  function NameBinder(sourceExpression, target, lookupFunctions) {
    

    this.sourceExpression = sourceExpression;
    this.target = target;
    this.lookupFunctions = lookupFunctions;
  }

  NameBinder.prototype.bind = function bind(source) {
    if (this.isBound) {
      if (this.source === source) {
        return;
      }
      this.unbind();
    }
    this.isBound = true;
    this.source = source;
    if (this.sourceExpression.bind) {
      this.sourceExpression.bind(this, source, this.lookupFunctions);
    }
    this.sourceExpression.assign(this.source, this.target, this.lookupFunctions);
  };

  NameBinder.prototype.unbind = function unbind() {
    if (!this.isBound) {
      return;
    }
    this.isBound = false;
    this.sourceExpression.assign(this.source, null, this.lookupFunctions);
    if (this.sourceExpression.unbind) {
      this.sourceExpression.unbind(this, this.source);
    }
    this.source = null;
  };

  return NameBinder;
}();

var LookupFunctions = {
  bindingBehaviors: function bindingBehaviors(name) {
    return null;
  },
  valueConverters: function valueConverters(name) {
    return null;
  }
};

var BindingEngine = exports.BindingEngine = (_temp2 = _class13 = function () {
  function BindingEngine(observerLocator, parser) {
    

    this.observerLocator = observerLocator;
    this.parser = parser;
  }

  BindingEngine.prototype.createBindingExpression = function createBindingExpression(targetProperty, sourceExpression) {
    var mode = arguments.length <= 2 || arguments[2] === undefined ? bindingMode.oneWay : arguments[2];
    var lookupFunctions = arguments.length <= 3 || arguments[3] === undefined ? LookupFunctions : arguments[3];

    return new BindingExpression(this.observerLocator, targetProperty, this.parser.parse(sourceExpression), mode, lookupFunctions);
  };

  BindingEngine.prototype.propertyObserver = function propertyObserver(obj, propertyName) {
    var _this29 = this;

    return {
      subscribe: function subscribe(callback) {
        var observer = _this29.observerLocator.getObserver(obj, propertyName);
        observer.subscribe(callback);
        return {
          dispose: function dispose() {
            return observer.unsubscribe(callback);
          }
        };
      }
    };
  };

  BindingEngine.prototype.collectionObserver = function collectionObserver(collection) {
    var _this30 = this;

    return {
      subscribe: function subscribe(callback) {
        var observer = void 0;
        if (collection instanceof Array) {
          observer = _this30.observerLocator.getArrayObserver(collection);
        } else if (collection instanceof Map) {
          observer = _this30.observerLocator.getMapObserver(collection);
        } else if (collection instanceof Set) {
          observer = _this30.observerLocator.getSetObserver(collection);
        } else {
          throw new Error('collection must be an instance of Array, Map or Set.');
        }
        observer.subscribe(callback);
        return {
          dispose: function dispose() {
            return observer.unsubscribe(callback);
          }
        };
      }
    };
  };

  BindingEngine.prototype.expressionObserver = function expressionObserver(bindingContext, expression) {
    var scope = { bindingContext: bindingContext, overrideContext: createOverrideContext(bindingContext) };
    return new ExpressionObserver(scope, this.parser.parse(expression), this.observerLocator, LookupFunctions);
  };

  BindingEngine.prototype.parseExpression = function parseExpression(expression) {
    return this.parser.parse(expression);
  };

  BindingEngine.prototype.registerAdapter = function registerAdapter(adapter) {
    this.observerLocator.addAdapter(adapter);
  };

  return BindingEngine;
}(), _class13.inject = [ObserverLocator, Parser], _temp2);


var setProto = Set.prototype;

function _getSetObserver(taskQueue, set) {
  return ModifySetObserver.for(taskQueue, set);
}

exports.getSetObserver = _getSetObserver;

var ModifySetObserver = function (_ModifyCollectionObse3) {
  _inherits(ModifySetObserver, _ModifyCollectionObse3);

  function ModifySetObserver(taskQueue, set) {
    

    return _possibleConstructorReturn(this, _ModifyCollectionObse3.call(this, taskQueue, set));
  }

  ModifySetObserver.for = function _for(taskQueue, set) {
    if (!('__set_observer__' in set)) {
      var observer = ModifySetObserver.create(taskQueue, set);
      Reflect.defineProperty(set, '__set_observer__', { value: observer, enumerable: false, configurable: false });
    }
    return set.__set_observer__;
  };

  ModifySetObserver.create = function create(taskQueue, set) {
    var observer = new ModifySetObserver(taskQueue, set);

    var proto = setProto;
    if (proto.add !== set.add || proto.delete !== set.delete || proto.clear !== set.clear) {
      proto = {
        add: set.add,
        delete: set.delete,
        clear: set.clear
      };
    }

    set.add = function () {
      var type = 'add';
      var oldSize = set.size;
      var methodCallResult = proto.add.apply(set, arguments);
      var hasValue = set.size === oldSize;
      if (!hasValue) {
        observer.addChangeRecord({
          type: type,
          object: set,
          value: Array.from(set).pop()
        });
      }
      return methodCallResult;
    };

    set.delete = function () {
      var hasValue = set.has(arguments[0]);
      var methodCallResult = proto.delete.apply(set, arguments);
      if (hasValue) {
        observer.addChangeRecord({
          type: 'delete',
          object: set,
          value: arguments[0]
        });
      }
      return methodCallResult;
    };

    set.clear = function () {
      var methodCallResult = proto.clear.apply(set, arguments);
      observer.addChangeRecord({
        type: 'clear',
        object: set
      });
      return methodCallResult;
    };

    return observer;
  };

  return ModifySetObserver;
}(ModifyCollectionObserver);

function observable(targetOrConfig, key, descriptor) {
  function deco(target, key, descriptor, config) {
    if (key === undefined) {
      target = target.prototype;
      key = typeof config === 'string' ? config : config.name;
    }

    var innerPropertyName = '_' + key;

    var callbackName = config && config.changeHandler || key + 'Changed';

    if (descriptor) {
      if (typeof descriptor.initializer === 'function') {
        target[innerPropertyName] = descriptor.initializer();
      }
    } else {
      descriptor = {};
    }

    delete descriptor.writable;
    delete descriptor.initializer;

    descriptor.get = function () {
      return this[innerPropertyName];
    };
    descriptor.set = function (newValue) {
      var oldValue = this[innerPropertyName];
      this[innerPropertyName] = newValue;
      if (this[callbackName]) {
        this[callbackName](newValue, oldValue);
      }
    };

    descriptor.get.dependencies = [innerPropertyName];

    Reflect.defineProperty(target, key, descriptor);
  }

  if (key === undefined) {
    return function (t, k, d) {
      return deco(t, k, d, targetOrConfig);
    };
  }
  return deco(targetOrConfig, key, descriptor);
}

/***/ },
/* 5 */,
/* 6 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Origin = exports.metadata = undefined;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

exports.decorators = decorators;
exports.deprecated = deprecated;
exports.mixin = mixin;
exports.protocol = protocol;

var _aureliaPal = __webpack_require__(2);



var metadata = exports.metadata = {
  resource: 'aurelia:resource',
  paramTypes: 'design:paramtypes',
  propertyType: 'design:type',
  properties: 'design:properties',
  get: function get(metadataKey, target, targetKey) {
    if (!target) {
      return undefined;
    }
    var result = metadata.getOwn(metadataKey, target, targetKey);
    return result === undefined ? metadata.get(metadataKey, Object.getPrototypeOf(target), targetKey) : result;
  },
  getOwn: function getOwn(metadataKey, target, targetKey) {
    if (!target) {
      return undefined;
    }
    return Reflect.getOwnMetadata(metadataKey, target, targetKey);
  },
  define: function define(metadataKey, metadataValue, target, targetKey) {
    Reflect.defineMetadata(metadataKey, metadataValue, target, targetKey);
  },
  getOrCreateOwn: function getOrCreateOwn(metadataKey, Type, target, targetKey) {
    var result = metadata.getOwn(metadataKey, target, targetKey);

    if (result === undefined) {
      result = new Type();
      Reflect.defineMetadata(metadataKey, result, target, targetKey);
    }

    return result;
  }
};

var originStorage = new Map();
var unknownOrigin = Object.freeze({ moduleId: undefined, moduleMember: undefined });

var Origin = exports.Origin = function () {
  function Origin(moduleId, moduleMember) {
    

    this.moduleId = moduleId;
    this.moduleMember = moduleMember;
  }

  Origin.get = function get(fn) {
    var origin = originStorage.get(fn);

    if (origin === undefined) {
      _aureliaPal.PLATFORM.eachModule(function (key, value) {
        for (var name in value) {
          var exp = value[name];
          if (exp === fn) {
            originStorage.set(fn, origin = new Origin(key, name));
            return true;
          }
        }

        if (value === fn) {
          originStorage.set(fn, origin = new Origin(key, 'default'));
          return true;
        }

        return false;
      });
    }

    return origin || unknownOrigin;
  };

  Origin.set = function set(fn, origin) {
    originStorage.set(fn, origin);
  };

  return Origin;
}();

function decorators() {
  for (var _len = arguments.length, rest = Array(_len), _key = 0; _key < _len; _key++) {
    rest[_key] = arguments[_key];
  }

  var applicator = function applicator(target, key, descriptor) {
    var i = rest.length;

    if (key) {
      descriptor = descriptor || {
        value: target[key],
        writable: true,
        configurable: true,
        enumerable: true
      };

      while (i--) {
        descriptor = rest[i](target, key, descriptor) || descriptor;
      }

      Object.defineProperty(target, key, descriptor);
    } else {
      while (i--) {
        target = rest[i](target) || target;
      }
    }

    return target;
  };

  applicator.on = applicator;
  return applicator;
}

function deprecated(optionsOrTarget, maybeKey, maybeDescriptor) {
  function decorator(target, key, descriptor) {
    var methodSignature = target.constructor.name + '#' + key;
    var options = maybeKey ? {} : optionsOrTarget || {};
    var message = 'DEPRECATION - ' + methodSignature;

    if (typeof descriptor.value !== 'function') {
      throw new SyntaxError('Only methods can be marked as deprecated.');
    }

    if (options.message) {
      message += ' - ' + options.message;
    }

    return _extends({}, descriptor, {
      value: function deprecationWrapper() {
        if (options.error) {
          throw new Error(message);
        } else {
          console.warn(message);
        }

        return descriptor.value.apply(this, arguments);
      }
    });
  }

  return maybeKey ? decorator(optionsOrTarget, maybeKey, maybeDescriptor) : decorator;
}

function mixin(behavior) {
  var instanceKeys = Object.keys(behavior);

  function _mixin(possible) {
    var decorator = function decorator(target) {
      var resolvedTarget = typeof target === 'function' ? target.prototype : target;

      var i = instanceKeys.length;
      while (i--) {
        var property = instanceKeys[i];
        Object.defineProperty(resolvedTarget, property, {
          value: behavior[property],
          writable: true
        });
      }
    };

    return possible ? decorator(possible) : decorator;
  }

  return _mixin;
}

function alwaysValid() {
  return true;
}
function noCompose() {}

function ensureProtocolOptions(options) {
  if (options === undefined) {
    options = {};
  } else if (typeof options === 'function') {
    options = {
      validate: options
    };
  }

  if (!options.validate) {
    options.validate = alwaysValid;
  }

  if (!options.compose) {
    options.compose = noCompose;
  }

  return options;
}

function createProtocolValidator(validate) {
  return function (target) {
    var result = validate(target);
    return result === true;
  };
}

function createProtocolAsserter(name, validate) {
  return function (target) {
    var result = validate(target);
    if (result !== true) {
      throw new Error(result || name + ' was not correctly implemented.');
    }
  };
}

function protocol(name, options) {
  options = ensureProtocolOptions(options);

  var result = function result(target) {
    var resolvedTarget = typeof target === 'function' ? target.prototype : target;

    options.compose(resolvedTarget);
    result.assert(resolvedTarget);

    Object.defineProperty(resolvedTarget, 'protocol:' + name, {
      enumerable: false,
      configurable: false,
      writable: false,
      value: true
    });
  };

  result.validate = createProtocolValidator(options.validate);
  result.assert = createProtocolAsserter(name, options.validate);

  return result;
}

protocol.create = function (name, options) {
  options = ensureProtocolOptions(options);
  var hidden = 'protocol:' + name;
  var result = function result(target) {
    var decorator = protocol(name, options);
    return target ? decorator(target) : decorator;
  };

  result.decorates = function (obj) {
    return obj[hidden] === true;
  };
  result.validate = createProtocolValidator(options.validate);
  result.assert = createProtocolAsserter(name, options.validate);

  return result;
};

/***/ },
/* 7 */
/***/ function(module, exports) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getLogger = getLogger;
exports.addAppender = addAppender;
exports.setLevel = setLevel;



var logLevel = exports.logLevel = {
  none: 0,
  error: 1,
  warn: 2,
  info: 3,
  debug: 4
};

var loggers = {};
var currentLevel = logLevel.none;
var appenders = [];
var slice = Array.prototype.slice;
var loggerConstructionKey = {};

function log(logger, level, args) {
  var i = appenders.length;
  var current = void 0;

  args = slice.call(args);
  args.unshift(logger);

  while (i--) {
    current = appenders[i];
    current[level].apply(current, args);
  }
}

function debug() {
  if (currentLevel < 4) {
    return;
  }

  log(this, 'debug', arguments);
}

function info() {
  if (currentLevel < 3) {
    return;
  }

  log(this, 'info', arguments);
}

function warn() {
  if (currentLevel < 2) {
    return;
  }

  log(this, 'warn', arguments);
}

function error() {
  if (currentLevel < 1) {
    return;
  }

  log(this, 'error', arguments);
}

function connectLogger(logger) {
  logger.debug = debug;
  logger.info = info;
  logger.warn = warn;
  logger.error = error;
}

function createLogger(id) {
  var logger = new Logger(id, loggerConstructionKey);

  if (appenders.length) {
    connectLogger(logger);
  }

  return logger;
}

function getLogger(id) {
  return loggers[id] || (loggers[id] = createLogger(id));
}

function addAppender(appender) {
  appenders.push(appender);

  if (appenders.length === 1) {
    for (var key in loggers) {
      connectLogger(loggers[key]);
    }
  }
}

function setLevel(level) {
  currentLevel = level;
}

var Logger = exports.Logger = function () {
  function Logger(id, key) {
    

    if (key !== loggerConstructionKey) {
      throw new Error('Cannot instantiate "Logger". Use "getLogger" instead.');
    }

    this.id = id;
  }

  Logger.prototype.debug = function debug(message) {};

  Logger.prototype.info = function info(message) {};

  Logger.prototype.warn = function warn(message) {};

  Logger.prototype.error = function error(message) {};

  return Logger;
}();

/***/ },
/* 8 */
/***/ function(module, exports) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj; };

exports.relativeToFile = relativeToFile;
exports.join = join;
exports.buildQueryString = buildQueryString;
exports.parseQueryString = parseQueryString;

function trimDots(ary) {
  for (var i = 0; i < ary.length; ++i) {
    var part = ary[i];
    if (part === '.') {
      ary.splice(i, 1);
      i -= 1;
    } else if (part === '..') {
      if (i === 0 || i === 1 && ary[2] === '..' || ary[i - 1] === '..') {
        continue;
      } else if (i > 0) {
        ary.splice(i - 1, 2);
        i -= 2;
      }
    }
  }
}

function relativeToFile(name, file) {
  var fileParts = file && file.split('/');
  var nameParts = name.trim().split('/');

  if (nameParts[0].charAt(0) === '.' && fileParts) {
    var normalizedBaseParts = fileParts.slice(0, fileParts.length - 1);
    nameParts.unshift.apply(nameParts, normalizedBaseParts);
  }

  trimDots(nameParts);

  return nameParts.join('/');
}

function join(path1, path2) {
  if (!path1) {
    return path2;
  }

  if (!path2) {
    return path1;
  }

  var schemeMatch = path1.match(/^([^/]*?:)\//);
  var scheme = schemeMatch && schemeMatch.length > 0 ? schemeMatch[1] : '';
  path1 = path1.substr(scheme.length);

  var urlPrefix = void 0;
  if (path1.indexOf('///') === 0 && scheme === 'file:') {
    urlPrefix = '///';
  } else if (path1.indexOf('//') === 0) {
    urlPrefix = '//';
  } else if (path1.indexOf('/') === 0) {
    urlPrefix = '/';
  } else {
    urlPrefix = '';
  }

  var trailingSlash = path2.slice(-1) === '/' ? '/' : '';

  var url1 = path1.split('/');
  var url2 = path2.split('/');
  var url3 = [];

  for (var i = 0, ii = url1.length; i < ii; ++i) {
    if (url1[i] === '..') {
      url3.pop();
    } else if (url1[i] === '.' || url1[i] === '') {
      continue;
    } else {
      url3.push(url1[i]);
    }
  }

  for (var _i = 0, _ii = url2.length; _i < _ii; ++_i) {
    if (url2[_i] === '..') {
      url3.pop();
    } else if (url2[_i] === '.' || url2[_i] === '') {
      continue;
    } else {
      url3.push(url2[_i]);
    }
  }

  return scheme + urlPrefix + url3.join('/') + trailingSlash;
}

var encode = encodeURIComponent;
var encodeKey = function encodeKey(k) {
  return encode(k).replace('%24', '$');
};

function buildParam(key, value) {
  var result = [];
  if (value === null || value === undefined) {
    return result;
  }
  if (Array.isArray(value)) {
    for (var i = 0, l = value.length; i < l; i++) {
      var arrayKey = key + '[' + (_typeof(value[i]) === 'object' && value[i] !== null ? i : '') + ']';
      result = result.concat(buildParam(arrayKey, value[i]));
    }
  } else if ((typeof value === 'undefined' ? 'undefined' : _typeof(value)) === 'object') {
    for (var propertyName in value) {
      result = result.concat(buildParam(key + '[' + propertyName + ']', value[propertyName]));
    }
  } else {
    result.push(encodeKey(key) + '=' + encode(value));
  }
  return result;
}

function buildQueryString(params) {
  var pairs = [];
  var keys = Object.keys(params || {}).sort();
  for (var i = 0, len = keys.length; i < len; i++) {
    var key = keys[i];
    pairs = pairs.concat(buildParam(key, params[key]));
  }

  if (pairs.length === 0) {
    return '';
  }

  return pairs.join('&');
}

function processScalarParam(existedParam, value, isPrimitive) {
  if (Array.isArray(existedParam)) {
    existedParam.push(value);
    return existedParam;
  }
  if (existedParam !== undefined) {
    return isPrimitive ? value : [existedParam, value];
  }

  return value;
}

function parseComplexParam(queryParams, keys, value) {
  var currentParams = queryParams;
  var keysLastIndex = keys.length - 1;
  for (var j = 0; j <= keysLastIndex; j++) {
    var key = keys[j] === '' ? currentParams.length : keys[j];
    if (j < keysLastIndex) {
      currentParams = currentParams[key] = currentParams[key] || (isNaN(keys[j + 1]) ? {} : []);
    } else {
      currentParams = currentParams[key] = value;
    }
  }
}

function parseQueryString(queryString) {
  var queryParams = {};
  if (!queryString || typeof queryString !== 'string') {
    return queryParams;
  }

  var query = queryString;
  if (query.charAt(0) === '?') {
    query = query.substr(1);
  }

  var pairs = query.replace(/\+/g, ' ').split('&');
  for (var i = 0; i < pairs.length; i++) {
    var pair = pairs[i].split('=');
    var key = decodeURIComponent(pair[0]);
    var isPrimitive = false;
    if (!key) {
      continue;
    }

    var keys = key.split('][');
    var keysLastIndex = keys.length - 1;

    if (/\[/.test(keys[0]) && /\]$/.test(keys[keysLastIndex])) {
      keys[keysLastIndex] = keys[keysLastIndex].replace(/\]$/, '');
      keys = keys.shift().split('[').concat(keys);
      keysLastIndex = keys.length - 1;
    } else {
      isPrimitive = true;
      keysLastIndex = 0;
    }

    if (pair.length >= 2) {
      var value = pair[1] ? decodeURIComponent(pair[1]) : '';
      if (keysLastIndex) {
        parseComplexParam(queryParams, keys, value);
      } else {
        queryParams[key] = processScalarParam(queryParams[key], value, isPrimitive);
      }
    } else {
      queryParams[key] = true;
    }
  }
  return queryParams;
}

/***/ },
/* 9 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.AppRouter = exports.PipelineProvider = exports.LoadRouteStep = exports.RouteLoader = exports.ActivateNextStep = exports.DeactivatePreviousStep = exports.CanActivateNextStep = exports.CanDeactivatePreviousStep = exports.Router = exports.BuildNavigationPlanStep = exports.activationStrategy = exports.RouterConfiguration = exports.RedirectToRoute = exports.Redirect = exports.NavModel = exports.NavigationInstruction = exports.CommitChangesStep = exports.Pipeline = exports.pipelineStatus = undefined;

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

exports._normalizeAbsolutePath = _normalizeAbsolutePath;
exports._createRootedPath = _createRootedPath;
exports._resolveUrl = _resolveUrl;
exports.isNavigationCommand = isNavigationCommand;
exports._buildNavigationPlan = _buildNavigationPlan;

var _aureliaLogging = __webpack_require__(7);

var LogManager = _interopRequireWildcard(_aureliaLogging);

var _aureliaRouteRecognizer = __webpack_require__(27);

var _aureliaDependencyInjection = __webpack_require__(0);

var _aureliaHistory = __webpack_require__(25);

var _aureliaEventAggregator = __webpack_require__(17);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }



function _normalizeAbsolutePath(path, hasPushState) {
  var absolute = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];

  if (!hasPushState && path[0] !== '#') {
    path = '#' + path;
  }

  if (hasPushState && absolute) {
    path = path.substring(1, path.length);
  }

  return path;
}

function _createRootedPath(fragment, baseUrl, hasPushState, absolute) {
  if (isAbsoluteUrl.test(fragment)) {
    return fragment;
  }

  var path = '';

  if (baseUrl.length && baseUrl[0] !== '/') {
    path += '/';
  }

  path += baseUrl;

  if ((!path.length || path[path.length - 1] !== '/') && fragment[0] !== '/') {
    path += '/';
  }

  if (path.length && path[path.length - 1] === '/' && fragment[0] === '/') {
    path = path.substring(0, path.length - 1);
  }

  return _normalizeAbsolutePath(path + fragment, hasPushState, absolute);
}

function _resolveUrl(fragment, baseUrl, hasPushState) {
  if (isRootedPath.test(fragment)) {
    return _normalizeAbsolutePath(fragment, hasPushState);
  }

  return _createRootedPath(fragment, baseUrl, hasPushState);
}

var isRootedPath = /^#?\//;
var isAbsoluteUrl = /^([a-z][a-z0-9+\-.]*:)?\/\//i;

var pipelineStatus = exports.pipelineStatus = {
  completed: 'completed',
  canceled: 'canceled',
  rejected: 'rejected',
  running: 'running'
};

var Pipeline = exports.Pipeline = function () {
  function Pipeline() {
    

    this.steps = [];
  }

  Pipeline.prototype.addStep = function addStep(step) {
    var run = void 0;

    if (typeof step === 'function') {
      run = step;
    } else if (typeof step.getSteps === 'function') {
      var steps = step.getSteps();
      for (var i = 0, l = steps.length; i < l; i++) {
        this.addStep(steps[i]);
      }

      return this;
    } else {
      run = step.run.bind(step);
    }

    this.steps.push(run);

    return this;
  };

  Pipeline.prototype.run = function run(instruction) {
    var index = -1;
    var steps = this.steps;

    function next() {
      index++;

      if (index < steps.length) {
        var currentStep = steps[index];

        try {
          return currentStep(instruction, next);
        } catch (e) {
          return next.reject(e);
        }
      } else {
        return next.complete();
      }
    }

    next.complete = createCompletionHandler(next, pipelineStatus.completed);
    next.cancel = createCompletionHandler(next, pipelineStatus.canceled);
    next.reject = createCompletionHandler(next, pipelineStatus.rejected);

    return next();
  };

  return Pipeline;
}();

function createCompletionHandler(next, status) {
  return function (output) {
    return Promise.resolve({ status: status, output: output, completed: status === pipelineStatus.completed });
  };
}

var CommitChangesStep = exports.CommitChangesStep = function () {
  function CommitChangesStep() {
    
  }

  CommitChangesStep.prototype.run = function run(navigationInstruction, next) {
    return navigationInstruction._commitChanges(true).then(function () {
      navigationInstruction._updateTitle();
      return next();
    });
  };

  return CommitChangesStep;
}();

var NavigationInstruction = exports.NavigationInstruction = function () {
  function NavigationInstruction(init) {
    

    this.plan = null;
    this.options = {};

    Object.assign(this, init);

    this.params = this.params || {};
    this.viewPortInstructions = {};

    var ancestorParams = [];
    var current = this;
    do {
      var currentParams = Object.assign({}, current.params);
      if (current.config && current.config.hasChildRouter) {
        delete currentParams[current.getWildCardName()];
      }

      ancestorParams.unshift(currentParams);
      current = current.parentInstruction;
    } while (current);

    var allParams = Object.assign.apply(Object, [{}, this.queryParams].concat(ancestorParams));
    this.lifecycleArgs = [allParams, this.config, this];
  }

  NavigationInstruction.prototype.getAllInstructions = function getAllInstructions() {
    var instructions = [this];
    for (var key in this.viewPortInstructions) {
      var childInstruction = this.viewPortInstructions[key].childNavigationInstruction;
      if (childInstruction) {
        instructions.push.apply(instructions, childInstruction.getAllInstructions());
      }
    }

    return instructions;
  };

  NavigationInstruction.prototype.getAllPreviousInstructions = function getAllPreviousInstructions() {
    return this.getAllInstructions().map(function (c) {
      return c.previousInstruction;
    }).filter(function (c) {
      return c;
    });
  };

  NavigationInstruction.prototype.addViewPortInstruction = function addViewPortInstruction(viewPortName, strategy, moduleId, component) {
    var viewportInstruction = this.viewPortInstructions[viewPortName] = {
      name: viewPortName,
      strategy: strategy,
      moduleId: moduleId,
      component: component,
      childRouter: component.childRouter,
      lifecycleArgs: this.lifecycleArgs.slice()
    };

    return viewportInstruction;
  };

  NavigationInstruction.prototype.getWildCardName = function getWildCardName() {
    var wildcardIndex = this.config.route.lastIndexOf('*');
    return this.config.route.substr(wildcardIndex + 1);
  };

  NavigationInstruction.prototype.getWildcardPath = function getWildcardPath() {
    var wildcardName = this.getWildCardName();
    var path = this.params[wildcardName] || '';

    if (this.queryString) {
      path += '?' + this.queryString;
    }

    return path;
  };

  NavigationInstruction.prototype.getBaseUrl = function getBaseUrl() {
    if (!this.params) {
      return this.fragment;
    }

    var wildcardName = this.getWildCardName();
    var path = this.params[wildcardName] || '';

    if (!path) {
      return this.fragment;
    }

    path = encodeURI(path);
    return this.fragment.substr(0, this.fragment.lastIndexOf(path));
  };

  NavigationInstruction.prototype._commitChanges = function _commitChanges(waitToSwap) {
    var _this = this;

    var router = this.router;
    router.currentInstruction = this;

    if (this.previousInstruction) {
      this.previousInstruction.config.navModel.isActive = false;
    }

    this.config.navModel.isActive = true;

    router._refreshBaseUrl();
    router.refreshNavigation();

    var loads = [];
    var delaySwaps = [];

    var _loop = function _loop(viewPortName) {
      var viewPortInstruction = _this.viewPortInstructions[viewPortName];
      var viewPort = router.viewPorts[viewPortName];

      if (!viewPort) {
        throw new Error('There was no router-view found in the view for ' + viewPortInstruction.moduleId + '.');
      }

      if (viewPortInstruction.strategy === activationStrategy.replace) {
        if (waitToSwap) {
          delaySwaps.push({ viewPort: viewPort, viewPortInstruction: viewPortInstruction });
        }

        loads.push(viewPort.process(viewPortInstruction, waitToSwap).then(function (x) {
          if (viewPortInstruction.childNavigationInstruction) {
            return viewPortInstruction.childNavigationInstruction._commitChanges();
          }

          return undefined;
        }));
      } else {
        if (viewPortInstruction.childNavigationInstruction) {
          loads.push(viewPortInstruction.childNavigationInstruction._commitChanges(waitToSwap));
        }
      }
    };

    for (var viewPortName in this.viewPortInstructions) {
      _loop(viewPortName);
    }

    return Promise.all(loads).then(function () {
      delaySwaps.forEach(function (x) {
        return x.viewPort.swap(x.viewPortInstruction);
      });
      return null;
    }).then(function () {
      return prune(_this);
    });
  };

  NavigationInstruction.prototype._updateTitle = function _updateTitle() {
    var title = this._buildTitle();
    if (title) {
      this.router.history.setTitle(title);
    }
  };

  NavigationInstruction.prototype._buildTitle = function _buildTitle() {
    var separator = arguments.length <= 0 || arguments[0] === undefined ? ' | ' : arguments[0];

    var title = this.config.navModel.title || '';
    var childTitles = [];

    for (var viewPortName in this.viewPortInstructions) {
      var _viewPortInstruction = this.viewPortInstructions[viewPortName];

      if (_viewPortInstruction.childNavigationInstruction) {
        var childTitle = _viewPortInstruction.childNavigationInstruction._buildTitle(separator);
        if (childTitle) {
          childTitles.push(childTitle);
        }
      }
    }

    if (childTitles.length) {
      title = childTitles.join(separator) + (title ? separator : '') + title;
    }

    if (this.router.title) {
      title += (title ? separator : '') + this.router.title;
    }

    return title;
  };

  return NavigationInstruction;
}();

function prune(instruction) {
  instruction.previousInstruction = null;
  instruction.plan = null;
}

var NavModel = exports.NavModel = function () {
  function NavModel(router, relativeHref) {
    

    this.isActive = false;
    this.title = null;
    this.href = null;
    this.relativeHref = null;
    this.settings = {};
    this.config = null;

    this.router = router;
    this.relativeHref = relativeHref;
  }

  NavModel.prototype.setTitle = function setTitle(title) {
    this.title = title;

    if (this.isActive) {
      this.router.updateTitle();
    }
  };

  return NavModel;
}();

function isNavigationCommand(obj) {
  return obj && typeof obj.navigate === 'function';
}

var Redirect = exports.Redirect = function () {
  function Redirect(url) {
    var options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];

    

    this.url = url;
    this.options = Object.assign({ trigger: true, replace: true }, options);
    this.shouldContinueProcessing = false;
  }

  Redirect.prototype.setRouter = function setRouter(router) {
    this.router = router;
  };

  Redirect.prototype.navigate = function navigate(appRouter) {
    var navigatingRouter = this.options.useAppRouter ? appRouter : this.router || appRouter;
    navigatingRouter.navigate(this.url, this.options);
  };

  return Redirect;
}();

var RedirectToRoute = exports.RedirectToRoute = function () {
  function RedirectToRoute(route) {
    var params = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];
    var options = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];

    

    this.route = route;
    this.params = params;
    this.options = Object.assign({ trigger: true, replace: true }, options);
    this.shouldContinueProcessing = false;
  }

  RedirectToRoute.prototype.setRouter = function setRouter(router) {
    this.router = router;
  };

  RedirectToRoute.prototype.navigate = function navigate(appRouter) {
    var navigatingRouter = this.options.useAppRouter ? appRouter : this.router || appRouter;
    navigatingRouter.navigateToRoute(this.route, this.params, this.options);
  };

  return RedirectToRoute;
}();

var RouterConfiguration = exports.RouterConfiguration = function () {
  function RouterConfiguration() {
    

    this.instructions = [];
    this.options = {};
    this.pipelineSteps = [];
  }

  RouterConfiguration.prototype.addPipelineStep = function addPipelineStep(name, step) {
    this.pipelineSteps.push({ name: name, step: step });
    return this;
  };

  RouterConfiguration.prototype.addAuthorizeStep = function addAuthorizeStep(step) {
    return this.addPipelineStep('authorize', step);
  };

  RouterConfiguration.prototype.addPreActivateStep = function addPreActivateStep(step) {
    return this.addPipelineStep('preActivate', step);
  };

  RouterConfiguration.prototype.addPreRenderStep = function addPreRenderStep(step) {
    return this.addPipelineStep('preRender', step);
  };

  RouterConfiguration.prototype.addPostRenderStep = function addPostRenderStep(step) {
    return this.addPipelineStep('postRender', step);
  };

  RouterConfiguration.prototype.map = function map(route) {
    if (Array.isArray(route)) {
      route.forEach(this.map.bind(this));
      return this;
    }

    return this.mapRoute(route);
  };

  RouterConfiguration.prototype.mapRoute = function mapRoute(config) {
    this.instructions.push(function (router) {
      var routeConfigs = [];

      if (Array.isArray(config.route)) {
        for (var i = 0, ii = config.route.length; i < ii; ++i) {
          var current = Object.assign({}, config);
          current.route = config.route[i];
          routeConfigs.push(current);
        }
      } else {
        routeConfigs.push(Object.assign({}, config));
      }

      var navModel = void 0;
      for (var _i = 0, _ii = routeConfigs.length; _i < _ii; ++_i) {
        var routeConfig = routeConfigs[_i];
        routeConfig.settings = routeConfig.settings || {};
        if (!navModel) {
          navModel = router.createNavModel(routeConfig);
        }

        router.addRoute(routeConfig, navModel);
      }
    });

    return this;
  };

  RouterConfiguration.prototype.mapUnknownRoutes = function mapUnknownRoutes(config) {
    this.unknownRouteConfig = config;
    return this;
  };

  RouterConfiguration.prototype.exportToRouter = function exportToRouter(router) {
    var instructions = this.instructions;
    for (var i = 0, ii = instructions.length; i < ii; ++i) {
      instructions[i](router);
    }

    if (this.title) {
      router.title = this.title;
    }

    if (this.unknownRouteConfig) {
      router.handleUnknownRoutes(this.unknownRouteConfig);
    }

    router.options = this.options;

    var pipelineSteps = this.pipelineSteps;
    if (pipelineSteps.length) {
      if (!router.isRoot) {
        throw new Error('Pipeline steps can only be added to the root router');
      }

      var pipelineProvider = router.pipelineProvider;
      for (var _i2 = 0, _ii2 = pipelineSteps.length; _i2 < _ii2; ++_i2) {
        var _pipelineSteps$_i = pipelineSteps[_i2];
        var _name = _pipelineSteps$_i.name;
        var step = _pipelineSteps$_i.step;

        pipelineProvider.addStep(_name, step);
      }
    }
  };

  return RouterConfiguration;
}();

var activationStrategy = exports.activationStrategy = {
  noChange: 'no-change',
  invokeLifecycle: 'invoke-lifecycle',
  replace: 'replace'
};

var BuildNavigationPlanStep = exports.BuildNavigationPlanStep = function () {
  function BuildNavigationPlanStep() {
    
  }

  BuildNavigationPlanStep.prototype.run = function run(navigationInstruction, next) {
    return _buildNavigationPlan(navigationInstruction).then(function (plan) {
      navigationInstruction.plan = plan;
      return next();
    }).catch(next.cancel);
  };

  return BuildNavigationPlanStep;
}();

function _buildNavigationPlan(instruction, forceLifecycleMinimum) {
  var prev = instruction.previousInstruction;
  var config = instruction.config;
  var plan = {};

  if ('redirect' in config) {
    var redirectLocation = _resolveUrl(config.redirect, getInstructionBaseUrl(instruction));
    if (instruction.queryString) {
      redirectLocation += '?' + instruction.queryString;
    }

    return Promise.reject(new Redirect(redirectLocation));
  }

  if (prev) {
    var newParams = hasDifferentParameterValues(prev, instruction);
    var pending = [];

    var _loop2 = function _loop2(viewPortName) {
      var prevViewPortInstruction = prev.viewPortInstructions[viewPortName];
      var nextViewPortConfig = config.viewPorts[viewPortName];

      if (!nextViewPortConfig) throw new Error('Invalid Route Config: Configuration for viewPort "' + viewPortName + '" was not found for route: "' + instruction.config.route + '."');

      var viewPortPlan = plan[viewPortName] = {
        name: viewPortName,
        config: nextViewPortConfig,
        prevComponent: prevViewPortInstruction.component,
        prevModuleId: prevViewPortInstruction.moduleId
      };

      if (prevViewPortInstruction.moduleId !== nextViewPortConfig.moduleId) {
        viewPortPlan.strategy = activationStrategy.replace;
      } else if ('determineActivationStrategy' in prevViewPortInstruction.component.viewModel) {
        var _prevViewPortInstruct;

        viewPortPlan.strategy = (_prevViewPortInstruct = prevViewPortInstruction.component.viewModel).determineActivationStrategy.apply(_prevViewPortInstruct, instruction.lifecycleArgs);
      } else if (config.activationStrategy) {
        viewPortPlan.strategy = config.activationStrategy;
      } else if (newParams || forceLifecycleMinimum) {
        viewPortPlan.strategy = activationStrategy.invokeLifecycle;
      } else {
        viewPortPlan.strategy = activationStrategy.noChange;
      }

      if (viewPortPlan.strategy !== activationStrategy.replace && prevViewPortInstruction.childRouter) {
        var path = instruction.getWildcardPath();
        var task = prevViewPortInstruction.childRouter._createNavigationInstruction(path, instruction).then(function (childInstruction) {
          viewPortPlan.childNavigationInstruction = childInstruction;

          return _buildNavigationPlan(childInstruction, viewPortPlan.strategy === activationStrategy.invokeLifecycle).then(function (childPlan) {
            childInstruction.plan = childPlan;
          });
        });

        pending.push(task);
      }
    };

    for (var viewPortName in prev.viewPortInstructions) {
      _loop2(viewPortName);
    }

    return Promise.all(pending).then(function () {
      return plan;
    });
  }

  for (var _viewPortName in config.viewPorts) {
    plan[_viewPortName] = {
      name: _viewPortName,
      strategy: activationStrategy.replace,
      config: instruction.config.viewPorts[_viewPortName]
    };
  }

  return Promise.resolve(plan);
}

function hasDifferentParameterValues(prev, next) {
  var prevParams = prev.params;
  var nextParams = next.params;
  var nextWildCardName = next.config.hasChildRouter ? next.getWildCardName() : null;

  for (var key in nextParams) {
    if (key === nextWildCardName) {
      continue;
    }

    if (prevParams[key] !== nextParams[key]) {
      return true;
    }
  }

  for (var _key in prevParams) {
    if (_key === nextWildCardName) {
      continue;
    }

    if (prevParams[_key] !== nextParams[_key]) {
      return true;
    }
  }

  if (!next.options.compareQueryParams) {
    return false;
  }

  var prevQueryParams = prev.queryParams;
  var nextQueryParams = next.queryParams;
  for (var _key2 in nextQueryParams) {
    if (prevQueryParams[_key2] !== nextQueryParams[_key2]) {
      return true;
    }
  }

  for (var _key3 in prevQueryParams) {
    if (prevQueryParams[_key3] !== nextQueryParams[_key3]) {
      return true;
    }
  }

  return false;
}

function getInstructionBaseUrl(instruction) {
  var instructionBaseUrlParts = [];
  instruction = instruction.parentInstruction;

  while (instruction) {
    instructionBaseUrlParts.unshift(instruction.getBaseUrl());
    instruction = instruction.parentInstruction;
  }

  instructionBaseUrlParts.unshift('/');
  return instructionBaseUrlParts.join('');
}

var Router = exports.Router = function () {
  function Router(container, history) {
    

    this.parent = null;
    this.options = {};

    this.container = container;
    this.history = history;
    this.reset();
  }

  Router.prototype.reset = function reset() {
    var _this2 = this;

    this.viewPorts = {};
    this.routes = [];
    this.baseUrl = '';
    this.isConfigured = false;
    this.isNavigating = false;
    this.navigation = [];
    this.currentInstruction = null;
    this._fallbackOrder = 100;
    this._recognizer = new _aureliaRouteRecognizer.RouteRecognizer();
    this._childRecognizer = new _aureliaRouteRecognizer.RouteRecognizer();
    this._configuredPromise = new Promise(function (resolve) {
      _this2._resolveConfiguredPromise = resolve;
    });
  };

  Router.prototype.registerViewPort = function registerViewPort(viewPort, name) {
    name = name || 'default';
    this.viewPorts[name] = viewPort;
  };

  Router.prototype.ensureConfigured = function ensureConfigured() {
    return this._configuredPromise;
  };

  Router.prototype.configure = function configure(callbackOrConfig) {
    var _this3 = this;

    this.isConfigured = true;

    var result = callbackOrConfig;
    var config = void 0;
    if (typeof callbackOrConfig === 'function') {
      config = new RouterConfiguration();
      result = callbackOrConfig(config);
    }

    return Promise.resolve(result).then(function (c) {
      if (c && c.exportToRouter) {
        config = c;
      }

      config.exportToRouter(_this3);
      _this3.isConfigured = true;
      _this3._resolveConfiguredPromise();
    });
  };

  Router.prototype.navigate = function navigate(fragment, options) {
    if (!this.isConfigured && this.parent) {
      return this.parent.navigate(fragment, options);
    }

    return this.history.navigate(_resolveUrl(fragment, this.baseUrl, this.history._hasPushState), options);
  };

  Router.prototype.navigateToRoute = function navigateToRoute(route, params, options) {
    var path = this.generate(route, params);
    return this.navigate(path, options);
  };

  Router.prototype.navigateBack = function navigateBack() {
    this.history.navigateBack();
  };

  Router.prototype.createChild = function createChild(container) {
    var childRouter = new Router(container || this.container.createChild(), this.history);
    childRouter.parent = this;
    return childRouter;
  };

  Router.prototype.generate = function generate(name, params) {
    var options = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];

    var hasRoute = this._recognizer.hasRoute(name);
    if ((!this.isConfigured || !hasRoute) && this.parent) {
      return this.parent.generate(name, params);
    }

    if (!hasRoute) {
      throw new Error('A route with name \'' + name + '\' could not be found. Check that `name: \'' + name + '\'` was specified in the route\'s config.');
    }

    var path = this._recognizer.generate(name, params);
    var rootedPath = _createRootedPath(path, this.baseUrl, this.history._hasPushState, options.absolute);
    return options.absolute ? '' + this.history.getAbsoluteRoot() + rootedPath : rootedPath;
  };

  Router.prototype.createNavModel = function createNavModel(config) {
    var navModel = new NavModel(this, 'href' in config ? config.href : config.route);
    navModel.title = config.title;
    navModel.order = config.nav;
    navModel.href = config.href;
    navModel.settings = config.settings;
    navModel.config = config;

    return navModel;
  };

  Router.prototype.addRoute = function addRoute(config, navModel) {
    validateRouteConfig(config);

    if (!('viewPorts' in config) && !config.navigationStrategy) {
      config.viewPorts = {
        'default': {
          moduleId: config.moduleId,
          view: config.view
        }
      };
    }

    if (!navModel) {
      navModel = this.createNavModel(config);
    }

    this.routes.push(config);

    var path = config.route;
    if (path.charAt(0) === '/') {
      path = path.substr(1);
    }
    var caseSensitive = config.caseSensitive === true;
    var state = this._recognizer.add({ path: path, handler: config, caseSensitive: caseSensitive });

    if (path) {
      var _settings = config.settings;
      delete config.settings;
      var withChild = JSON.parse(JSON.stringify(config));
      config.settings = _settings;
      withChild.route = path + '/*childRoute';
      withChild.hasChildRouter = true;
      this._childRecognizer.add({
        path: withChild.route,
        handler: withChild,
        caseSensitive: caseSensitive
      });

      withChild.navModel = navModel;
      withChild.settings = config.settings;
    }

    config.navModel = navModel;

    if ((navModel.order || navModel.order === 0) && this.navigation.indexOf(navModel) === -1) {
      if (!navModel.href && navModel.href !== '' && (state.types.dynamics || state.types.stars)) {
        throw new Error('Invalid route config: dynamic routes must specify an href to be included in the navigation model.');
      }

      if (typeof navModel.order !== 'number') {
        navModel.order = ++this._fallbackOrder;
      }

      this.navigation.push(navModel);
      this.navigation = this.navigation.sort(function (a, b) {
        return a.order - b.order;
      });
    }
  };

  Router.prototype.hasRoute = function hasRoute(name) {
    return !!(this._recognizer.hasRoute(name) || this.parent && this.parent.hasRoute(name));
  };

  Router.prototype.hasOwnRoute = function hasOwnRoute(name) {
    return this._recognizer.hasRoute(name);
  };

  Router.prototype.handleUnknownRoutes = function handleUnknownRoutes(config) {
    var _this4 = this;

    if (!config) {
      throw new Error('Invalid unknown route handler');
    }

    this.catchAllHandler = function (instruction) {
      return _this4._createRouteConfig(config, instruction).then(function (c) {
        instruction.config = c;
        return instruction;
      });
    };
  };

  Router.prototype.updateTitle = function updateTitle() {
    if (this.parent) {
      return this.parent.updateTitle();
    }

    this.currentInstruction._updateTitle();
    return undefined;
  };

  Router.prototype.refreshNavigation = function refreshNavigation() {
    var nav = this.navigation;

    for (var i = 0, length = nav.length; i < length; i++) {
      var current = nav[i];
      if (!current.config.href) {
        current.href = _createRootedPath(current.relativeHref, this.baseUrl, this.history._hasPushState);
      } else {
        current.href = _normalizeAbsolutePath(current.config.href, this.history._hasPushState);
      }
    }
  };

  Router.prototype._refreshBaseUrl = function _refreshBaseUrl() {
    if (this.parent) {
      var baseUrl = this.parent.currentInstruction.getBaseUrl();
      this.baseUrl = this.parent.baseUrl + baseUrl;
    }
  };

  Router.prototype._createNavigationInstruction = function _createNavigationInstruction() {
    var url = arguments.length <= 0 || arguments[0] === undefined ? '' : arguments[0];
    var parentInstruction = arguments.length <= 1 || arguments[1] === undefined ? null : arguments[1];

    var fragment = url;
    var queryString = '';

    var queryIndex = url.indexOf('?');
    if (queryIndex !== -1) {
      fragment = url.substr(0, queryIndex);
      queryString = url.substr(queryIndex + 1);
    }

    var results = this._recognizer.recognize(url);
    if (!results || !results.length) {
      results = this._childRecognizer.recognize(url);
    }

    var instructionInit = {
      fragment: fragment,
      queryString: queryString,
      config: null,
      parentInstruction: parentInstruction,
      previousInstruction: this.currentInstruction,
      router: this,
      options: {
        compareQueryParams: this.options.compareQueryParams
      }
    };

    if (results && results.length) {
      var first = results[0];
      var _instruction = new NavigationInstruction(Object.assign({}, instructionInit, {
        params: first.params,
        queryParams: first.queryParams || results.queryParams,
        config: first.config || first.handler
      }));

      if (typeof first.handler === 'function') {
        return evaluateNavigationStrategy(_instruction, first.handler, first);
      } else if (first.handler && 'navigationStrategy' in first.handler) {
        return evaluateNavigationStrategy(_instruction, first.handler.navigationStrategy, first.handler);
      }

      return Promise.resolve(_instruction);
    } else if (this.catchAllHandler) {
      var _instruction2 = new NavigationInstruction(Object.assign({}, instructionInit, {
        params: { path: fragment },
        queryParams: results && results.queryParams,
        config: null }));

      return evaluateNavigationStrategy(_instruction2, this.catchAllHandler);
    }

    return Promise.reject(new Error('Route not found: ' + url));
  };

  Router.prototype._createRouteConfig = function _createRouteConfig(config, instruction) {
    var _this5 = this;

    return Promise.resolve(config).then(function (c) {
      if (typeof c === 'string') {
        return { moduleId: c };
      } else if (typeof c === 'function') {
        return c(instruction);
      }

      return c;
    }).then(function (c) {
      return typeof c === 'string' ? { moduleId: c } : c;
    }).then(function (c) {
      c.route = instruction.params.path;
      validateRouteConfig(c);

      if (!c.navModel) {
        c.navModel = _this5.createNavModel(c);
      }

      return c;
    });
  };

  _createClass(Router, [{
    key: 'isRoot',
    get: function get() {
      return !this.parent;
    }
  }]);

  return Router;
}();

function validateRouteConfig(config) {
  if ((typeof config === 'undefined' ? 'undefined' : _typeof(config)) !== 'object') {
    throw new Error('Invalid Route Config');
  }

  if (typeof config.route !== 'string') {
    throw new Error('Invalid Route Config: You must specify a route pattern.');
  }

  if (!('redirect' in config || config.moduleId || config.navigationStrategy || config.viewPorts)) {
    throw new Error('Invalid Route Config: You must specify a moduleId, redirect, navigationStrategy, or viewPorts.');
  }
}

function evaluateNavigationStrategy(instruction, evaluator, context) {
  return Promise.resolve(evaluator.call(context, instruction)).then(function () {
    if (!('viewPorts' in instruction.config)) {
      instruction.config.viewPorts = {
        'default': {
          moduleId: instruction.config.moduleId
        }
      };
    }

    return instruction;
  });
}

var CanDeactivatePreviousStep = exports.CanDeactivatePreviousStep = function () {
  function CanDeactivatePreviousStep() {
    
  }

  CanDeactivatePreviousStep.prototype.run = function run(navigationInstruction, next) {
    return processDeactivatable(navigationInstruction.plan, 'canDeactivate', next);
  };

  return CanDeactivatePreviousStep;
}();

var CanActivateNextStep = exports.CanActivateNextStep = function () {
  function CanActivateNextStep() {
    
  }

  CanActivateNextStep.prototype.run = function run(navigationInstruction, next) {
    return processActivatable(navigationInstruction, 'canActivate', next);
  };

  return CanActivateNextStep;
}();

var DeactivatePreviousStep = exports.DeactivatePreviousStep = function () {
  function DeactivatePreviousStep() {
    
  }

  DeactivatePreviousStep.prototype.run = function run(navigationInstruction, next) {
    return processDeactivatable(navigationInstruction.plan, 'deactivate', next, true);
  };

  return DeactivatePreviousStep;
}();

var ActivateNextStep = exports.ActivateNextStep = function () {
  function ActivateNextStep() {
    
  }

  ActivateNextStep.prototype.run = function run(navigationInstruction, next) {
    return processActivatable(navigationInstruction, 'activate', next, true);
  };

  return ActivateNextStep;
}();

function processDeactivatable(plan, callbackName, next, ignoreResult) {
  var infos = findDeactivatable(plan, callbackName);
  var i = infos.length;

  function inspect(val) {
    if (ignoreResult || shouldContinue(val)) {
      return iterate();
    }

    return next.cancel(val);
  }

  function iterate() {
    if (i--) {
      try {
        var viewModel = infos[i];
        var _result = viewModel[callbackName]();
        return processPotential(_result, inspect, next.cancel);
      } catch (error) {
        return next.cancel(error);
      }
    }

    return next();
  }

  return iterate();
}

function findDeactivatable(plan, callbackName) {
  var list = arguments.length <= 2 || arguments[2] === undefined ? [] : arguments[2];

  for (var viewPortName in plan) {
    var _viewPortPlan = plan[viewPortName];
    var prevComponent = _viewPortPlan.prevComponent;

    if ((_viewPortPlan.strategy === activationStrategy.invokeLifecycle || _viewPortPlan.strategy === activationStrategy.replace) && prevComponent) {
      var viewModel = prevComponent.viewModel;

      if (callbackName in viewModel) {
        list.push(viewModel);
      }
    }

    if (_viewPortPlan.childNavigationInstruction) {
      findDeactivatable(_viewPortPlan.childNavigationInstruction.plan, callbackName, list);
    } else if (prevComponent) {
      addPreviousDeactivatable(prevComponent, callbackName, list);
    }
  }

  return list;
}

function addPreviousDeactivatable(component, callbackName, list) {
  var childRouter = component.childRouter;

  if (childRouter && childRouter.currentInstruction) {
    var viewPortInstructions = childRouter.currentInstruction.viewPortInstructions;

    for (var viewPortName in viewPortInstructions) {
      var _viewPortInstruction2 = viewPortInstructions[viewPortName];
      var prevComponent = _viewPortInstruction2.component;
      var prevViewModel = prevComponent.viewModel;

      if (callbackName in prevViewModel) {
        list.push(prevViewModel);
      }

      addPreviousDeactivatable(prevComponent, callbackName, list);
    }
  }
}

function processActivatable(navigationInstruction, callbackName, next, ignoreResult) {
  var infos = findActivatable(navigationInstruction, callbackName);
  var length = infos.length;
  var i = -1;

  function inspect(val, router) {
    if (ignoreResult || shouldContinue(val, router)) {
      return iterate();
    }

    return next.cancel(val);
  }

  function iterate() {
    i++;

    if (i < length) {
      try {
        var _ret3 = function () {
          var _current$viewModel;

          var current = infos[i];
          var result = (_current$viewModel = current.viewModel)[callbackName].apply(_current$viewModel, current.lifecycleArgs);
          return {
            v: processPotential(result, function (val) {
              return inspect(val, current.router);
            }, next.cancel)
          };
        }();

        if ((typeof _ret3 === 'undefined' ? 'undefined' : _typeof(_ret3)) === "object") return _ret3.v;
      } catch (error) {
        return next.cancel(error);
      }
    }

    return next();
  }

  return iterate();
}

function findActivatable(navigationInstruction, callbackName) {
  var list = arguments.length <= 2 || arguments[2] === undefined ? [] : arguments[2];
  var router = arguments[3];

  var plan = navigationInstruction.plan;

  Object.keys(plan).filter(function (viewPortName) {
    var viewPortPlan = plan[viewPortName];
    var viewPortInstruction = navigationInstruction.viewPortInstructions[viewPortName];
    var viewModel = viewPortInstruction.component.viewModel;

    if ((viewPortPlan.strategy === activationStrategy.invokeLifecycle || viewPortPlan.strategy === activationStrategy.replace) && callbackName in viewModel) {
      list.push({
        viewModel: viewModel,
        lifecycleArgs: viewPortInstruction.lifecycleArgs,
        router: router
      });
    }

    if (viewPortPlan.childNavigationInstruction) {
      findActivatable(viewPortPlan.childNavigationInstruction, callbackName, list, viewPortInstruction.component.childRouter || router);
    }
  });

  return list;
}

function shouldContinue(output, router) {
  if (output instanceof Error) {
    return false;
  }

  if (isNavigationCommand(output)) {
    if (typeof output.setRouter === 'function') {
      output.setRouter(router);
    }

    return !!output.shouldContinueProcessing;
  }

  if (output === undefined) {
    return true;
  }

  return output;
}

var SafeSubscription = function () {
  function SafeSubscription(subscriptionFunc) {
    

    this._subscribed = true;
    this._subscription = subscriptionFunc(this);

    if (!this._subscribed) this.unsubscribe();
  }

  SafeSubscription.prototype.unsubscribe = function unsubscribe() {
    if (this._subscribed && this._subscription) this._subscription.unsubscribe();

    this._subscribed = false;
  };

  _createClass(SafeSubscription, [{
    key: 'subscribed',
    get: function get() {
      return this._subscribed;
    }
  }]);

  return SafeSubscription;
}();

function processPotential(obj, resolve, reject) {
  if (obj && typeof obj.then === 'function') {
    return Promise.resolve(obj).then(resolve).catch(reject);
  }

  if (obj && typeof obj.subscribe === 'function') {
    var _ret4 = function () {
      var obs = obj;
      return {
        v: new SafeSubscription(function (sub) {
          return obs.subscribe({
            next: function next() {
              if (sub.subscribed) {
                sub.unsubscribe();
                resolve(obj);
              }
            },
            error: function error(_error) {
              if (sub.subscribed) {
                sub.unsubscribe();
                reject(_error);
              }
            },
            complete: function complete() {
              if (sub.subscribed) {
                sub.unsubscribe();
                resolve(obj);
              }
            }
          });
        })
      };
    }();

    if ((typeof _ret4 === 'undefined' ? 'undefined' : _typeof(_ret4)) === "object") return _ret4.v;
  }

  try {
    return resolve(obj);
  } catch (error) {
    return reject(error);
  }
}

var RouteLoader = exports.RouteLoader = function () {
  function RouteLoader() {
    
  }

  RouteLoader.prototype.loadRoute = function loadRoute(router, config, navigationInstruction) {
    throw Error('Route loaders must implement "loadRoute(router, config, navigationInstruction)".');
  };

  return RouteLoader;
}();

var LoadRouteStep = exports.LoadRouteStep = function () {
  LoadRouteStep.inject = function inject() {
    return [RouteLoader];
  };

  function LoadRouteStep(routeLoader) {
    

    this.routeLoader = routeLoader;
  }

  LoadRouteStep.prototype.run = function run(navigationInstruction, next) {
    return loadNewRoute(this.routeLoader, navigationInstruction).then(next).catch(next.cancel);
  };

  return LoadRouteStep;
}();

function loadNewRoute(routeLoader, navigationInstruction) {
  var toLoad = determineWhatToLoad(navigationInstruction);
  var loadPromises = toLoad.map(function (current) {
    return loadRoute(routeLoader, current.navigationInstruction, current.viewPortPlan);
  });

  return Promise.all(loadPromises);
}

function determineWhatToLoad(navigationInstruction) {
  var toLoad = arguments.length <= 1 || arguments[1] === undefined ? [] : arguments[1];

  var plan = navigationInstruction.plan;

  for (var viewPortName in plan) {
    var _viewPortPlan2 = plan[viewPortName];

    if (_viewPortPlan2.strategy === activationStrategy.replace) {
      toLoad.push({ viewPortPlan: _viewPortPlan2, navigationInstruction: navigationInstruction });

      if (_viewPortPlan2.childNavigationInstruction) {
        determineWhatToLoad(_viewPortPlan2.childNavigationInstruction, toLoad);
      }
    } else {
      var _viewPortInstruction3 = navigationInstruction.addViewPortInstruction(viewPortName, _viewPortPlan2.strategy, _viewPortPlan2.prevModuleId, _viewPortPlan2.prevComponent);

      if (_viewPortPlan2.childNavigationInstruction) {
        _viewPortInstruction3.childNavigationInstruction = _viewPortPlan2.childNavigationInstruction;
        determineWhatToLoad(_viewPortPlan2.childNavigationInstruction, toLoad);
      }
    }
  }

  return toLoad;
}

function loadRoute(routeLoader, navigationInstruction, viewPortPlan) {
  var moduleId = viewPortPlan.config.moduleId;

  return loadComponent(routeLoader, navigationInstruction, viewPortPlan.config).then(function (component) {
    var viewPortInstruction = navigationInstruction.addViewPortInstruction(viewPortPlan.name, viewPortPlan.strategy, moduleId, component);

    var childRouter = component.childRouter;
    if (childRouter) {
      var path = navigationInstruction.getWildcardPath();

      return childRouter._createNavigationInstruction(path, navigationInstruction).then(function (childInstruction) {
        viewPortPlan.childNavigationInstruction = childInstruction;

        return _buildNavigationPlan(childInstruction).then(function (childPlan) {
          childInstruction.plan = childPlan;
          viewPortInstruction.childNavigationInstruction = childInstruction;

          return loadNewRoute(routeLoader, childInstruction);
        });
      });
    }

    return undefined;
  });
}

function loadComponent(routeLoader, navigationInstruction, config) {
  var router = navigationInstruction.router;
  var lifecycleArgs = navigationInstruction.lifecycleArgs;

  return routeLoader.loadRoute(router, config, navigationInstruction).then(function (component) {
    var viewModel = component.viewModel;
    var childContainer = component.childContainer;

    component.router = router;
    component.config = config;

    if ('configureRouter' in viewModel) {
      var _ret5 = function () {
        var childRouter = childContainer.getChildRouter();
        component.childRouter = childRouter;

        return {
          v: childRouter.configure(function (c) {
            return viewModel.configureRouter.apply(viewModel, [c, childRouter].concat(lifecycleArgs));
          }).then(function () {
            return component;
          })
        };
      }();

      if ((typeof _ret5 === 'undefined' ? 'undefined' : _typeof(_ret5)) === "object") return _ret5.v;
    }

    return component;
  });
}

var PipelineSlot = function () {
  function PipelineSlot(container, name, alias) {
    

    this.steps = [];

    this.container = container;
    this.slotName = name;
    this.slotAlias = alias;
  }

  PipelineSlot.prototype.getSteps = function getSteps() {
    var _this6 = this;

    return this.steps.map(function (x) {
      return _this6.container.get(x);
    });
  };

  return PipelineSlot;
}();

var PipelineProvider = exports.PipelineProvider = function () {
  PipelineProvider.inject = function inject() {
    return [_aureliaDependencyInjection.Container];
  };

  function PipelineProvider(container) {
    

    this.container = container;
    this.steps = [BuildNavigationPlanStep, CanDeactivatePreviousStep, LoadRouteStep, this._createPipelineSlot('authorize'), CanActivateNextStep, this._createPipelineSlot('preActivate', 'modelbind'), DeactivatePreviousStep, ActivateNextStep, this._createPipelineSlot('preRender', 'precommit'), CommitChangesStep, this._createPipelineSlot('postRender', 'postcomplete')];
  }

  PipelineProvider.prototype.createPipeline = function createPipeline() {
    var _this7 = this;

    var pipeline = new Pipeline();
    this.steps.forEach(function (step) {
      return pipeline.addStep(_this7.container.get(step));
    });
    return pipeline;
  };

  PipelineProvider.prototype._findStep = function _findStep(name) {
    return this.steps.find(function (x) {
      return x.slotName === name || x.slotAlias === name;
    });
  };

  PipelineProvider.prototype.addStep = function addStep(name, step) {
    var found = this._findStep(name);
    if (found) {
      if (!found.steps.includes(step)) {
        found.steps.push(step);
      }
    } else {
      throw new Error('Invalid pipeline slot name: ' + name + '.');
    }
  };

  PipelineProvider.prototype.removeStep = function removeStep(name, step) {
    var slot = this._findStep(name);
    if (slot) {
      slot.steps.splice(slot.steps.indexOf(step), 1);
    }
  };

  PipelineProvider.prototype._clearSteps = function _clearSteps() {
    var name = arguments.length <= 0 || arguments[0] === undefined ? '' : arguments[0];

    var slot = this._findStep(name);
    if (slot) {
      slot.steps = [];
    }
  };

  PipelineProvider.prototype.reset = function reset() {
    this._clearSteps('authorize');
    this._clearSteps('preActivate');
    this._clearSteps('preRender');
    this._clearSteps('postRender');
  };

  PipelineProvider.prototype._createPipelineSlot = function _createPipelineSlot(name, alias) {
    return new PipelineSlot(this.container, name, alias);
  };

  return PipelineProvider;
}();

var logger = LogManager.getLogger('app-router');

var AppRouter = exports.AppRouter = function (_Router) {
  _inherits(AppRouter, _Router);

  AppRouter.inject = function inject() {
    return [_aureliaDependencyInjection.Container, _aureliaHistory.History, PipelineProvider, _aureliaEventAggregator.EventAggregator];
  };

  function AppRouter(container, history, pipelineProvider, events) {
    

    var _this8 = _possibleConstructorReturn(this, _Router.call(this, container, history));

    _this8.pipelineProvider = pipelineProvider;
    _this8.events = events;
    return _this8;
  }

  AppRouter.prototype.reset = function reset() {
    _Router.prototype.reset.call(this);
    this.maxInstructionCount = 10;
    if (!this._queue) {
      this._queue = [];
    } else {
      this._queue.length = 0;
    }
  };

  AppRouter.prototype.loadUrl = function loadUrl(url) {
    var _this9 = this;

    return this._createNavigationInstruction(url).then(function (instruction) {
      return _this9._queueInstruction(instruction);
    }).catch(function (error) {
      logger.error(error);
      restorePreviousLocation(_this9);
    });
  };

  AppRouter.prototype.registerViewPort = function registerViewPort(viewPort, name) {
    var _this10 = this;

    _Router.prototype.registerViewPort.call(this, viewPort, name);

    if (!this.isActive) {
      var _ret6 = function () {
        var viewModel = _this10._findViewModel(viewPort);
        if ('configureRouter' in viewModel) {
          if (!_this10.isConfigured) {
            var _ret7 = function () {
              var resolveConfiguredPromise = _this10._resolveConfiguredPromise;
              _this10._resolveConfiguredPromise = function () {};
              return {
                v: {
                  v: _this10.configure(function (config) {
                    return viewModel.configureRouter(config, _this10);
                  }).then(function () {
                    _this10.activate();
                    resolveConfiguredPromise();
                  })
                }
              };
            }();

            if ((typeof _ret7 === 'undefined' ? 'undefined' : _typeof(_ret7)) === "object") return _ret7.v;
          }
        } else {
          _this10.activate();
        }
      }();

      if ((typeof _ret6 === 'undefined' ? 'undefined' : _typeof(_ret6)) === "object") return _ret6.v;
    } else {
      this._dequeueInstruction();
    }

    return Promise.resolve();
  };

  AppRouter.prototype.activate = function activate(options) {
    if (this.isActive) {
      return;
    }

    this.isActive = true;
    this.options = Object.assign({ routeHandler: this.loadUrl.bind(this) }, this.options, options);
    this.history.activate(this.options);
    this._dequeueInstruction();
  };

  AppRouter.prototype.deactivate = function deactivate() {
    this.isActive = false;
    this.history.deactivate();
  };

  AppRouter.prototype._queueInstruction = function _queueInstruction(instruction) {
    var _this11 = this;

    return new Promise(function (resolve) {
      instruction.resolve = resolve;
      _this11._queue.unshift(instruction);
      _this11._dequeueInstruction();
    });
  };

  AppRouter.prototype._dequeueInstruction = function _dequeueInstruction() {
    var _this12 = this;

    var instructionCount = arguments.length <= 0 || arguments[0] === undefined ? 0 : arguments[0];

    return Promise.resolve().then(function () {
      if (_this12.isNavigating && !instructionCount) {
        return undefined;
      }

      var instruction = _this12._queue.shift();
      _this12._queue.length = 0;

      if (!instruction) {
        return undefined;
      }

      _this12.isNavigating = true;
      instruction.previousInstruction = _this12.currentInstruction;

      if (!instructionCount) {
        _this12.events.publish('router:navigation:processing', { instruction: instruction });
      } else if (instructionCount === _this12.maxInstructionCount - 1) {
        logger.error(instructionCount + 1 + ' navigation instructions have been attempted without success. Restoring last known good location.');
        restorePreviousLocation(_this12);
        return _this12._dequeueInstruction(instructionCount + 1);
      } else if (instructionCount > _this12.maxInstructionCount) {
        throw new Error('Maximum navigation attempts exceeded. Giving up.');
      }

      var pipeline = _this12.pipelineProvider.createPipeline();

      return pipeline.run(instruction).then(function (result) {
        return processResult(instruction, result, instructionCount, _this12);
      }).catch(function (error) {
        return { output: error instanceof Error ? error : new Error(error) };
      }).then(function (result) {
        return resolveInstruction(instruction, result, !!instructionCount, _this12);
      });
    });
  };

  AppRouter.prototype._findViewModel = function _findViewModel(viewPort) {
    if (this.container.viewModel) {
      return this.container.viewModel;
    }

    if (viewPort.container) {
      var container = viewPort.container;

      while (container) {
        if (container.viewModel) {
          this.container.viewModel = container.viewModel;
          return container.viewModel;
        }

        container = container.parent;
      }
    }

    return undefined;
  };

  return AppRouter;
}(Router);

function processResult(instruction, result, instructionCount, router) {
  if (!(result && 'completed' in result && 'output' in result)) {
    result = result || {};
    result.output = new Error('Expected router pipeline to return a navigation result, but got [' + JSON.stringify(result) + '] instead.');
  }

  var finalResult = null;
  if (isNavigationCommand(result.output)) {
    result.output.navigate(router);
  } else {
    finalResult = result;

    if (!result.completed) {
      if (result.output instanceof Error) {
        logger.error(result.output);
      }

      restorePreviousLocation(router);
    }
  }

  return router._dequeueInstruction(instructionCount + 1).then(function (innerResult) {
    return finalResult || innerResult || result;
  });
}

function resolveInstruction(instruction, result, isInnerInstruction, router) {
  instruction.resolve(result);

  if (!isInnerInstruction) {
    router.isNavigating = false;
    var eventArgs = { instruction: instruction, result: result };
    var eventName = void 0;

    if (result.output instanceof Error) {
      eventName = 'error';
    } else if (!result.completed) {
      eventName = 'canceled';
    } else {
      var _queryString = instruction.queryString ? '?' + instruction.queryString : '';
      router.history.previousLocation = instruction.fragment + _queryString;
      eventName = 'success';
    }

    router.events.publish('router:navigation:' + eventName, eventArgs);
    router.events.publish('router:navigation:complete', eventArgs);
  }

  return result;
}

function restorePreviousLocation(router) {
  var previousLocation = router.history.previousLocation;
  if (previousLocation) {
    router.navigate(router.history.previousLocation, { trigger: false, replace: true });
  } else {
    logger.error('Router navigation failed, and no previous location could be restored.');
  }
}
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))

/***/ },
/* 10 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.BaseConfig = undefined;

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _authUtilities = __webpack_require__(12);

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var BaseConfig = exports.BaseConfig = function () {
  BaseConfig.prototype.configure = function configure(incomingConfig) {
    (0, _authUtilities.merge)(this._current, incomingConfig);
  };

  _createClass(BaseConfig, [{
    key: 'current',
    get: function get() {
      return this._current;
    }
  }]);

  function BaseConfig() {
    _classCallCheck(this, BaseConfig);

    this._current = {
      httpInterceptor: true,
      loginOnSignup: true,
      baseUrl: '/',
      loginRedirect: '#/',
      logoutRedirect: '#/',
      signupRedirect: '#/login',
      loginUrl: '/auth/login',
      signupUrl: '/auth/signup',
      profileUrl: '/auth/me',
      loginRoute: '/login',
      signupRoute: '/signup',
      tokenRoot: false,
      tokenName: 'token',
      idTokenName: 'id_token',
      tokenPrefix: 'aurelia',
      responseTokenProp: 'access_token',
      responseIdTokenProp: 'id_token',
      unlinkUrl: '/auth/unlink/',
      unlinkMethod: 'get',
      authHeader: 'Authorization',
      authToken: 'Bearer',
      withCredentials: true,
      platform: 'browser',
      storage: 'localStorage',
      providers: {
        identSrv: {
          name: 'identSrv',
          url: '/auth/identSrv',

          redirectUri: window.location.origin || window.location.protocol + '//' + window.location.host,
          scope: ['profile', 'openid'],
          responseType: 'code',
          scopePrefix: '',
          scopeDelimiter: ' ',
          requiredUrlParams: ['scope', 'nonce'],
          optionalUrlParams: ['display', 'state'],
          state: function state() {
            var rand = Math.random().toString(36).substr(2);
            return encodeURIComponent(rand);
          },
          display: 'popup',
          type: '2.0',
          clientId: 'jsClient',
          nonce: function nonce() {
            var val = ((Date.now() + Math.random()) * Math.random()).toString().replace('.', '');
            return encodeURIComponent(val);
          },
          popupOptions: { width: 452, height: 633 }
        },
        google: {
          name: 'google',
          url: '/auth/google',
          authorizationEndpoint: 'https://accounts.google.com/o/oauth2/auth',
          redirectUri: window.location.origin || window.location.protocol + '//' + window.location.host,
          scope: ['profile', 'email'],
          scopePrefix: 'openid',
          scopeDelimiter: ' ',
          requiredUrlParams: ['scope'],
          optionalUrlParams: ['display', 'state'],
          display: 'popup',
          type: '2.0',
          state: function state() {
            var rand = Math.random().toString(36).substr(2);
            return encodeURIComponent(rand);
          },
          popupOptions: {
            width: 452,
            height: 633
          }
        },
        facebook: {
          name: 'facebook',
          url: '/auth/facebook',
          authorizationEndpoint: 'https://www.facebook.com/v2.3/dialog/oauth',
          redirectUri: window.location.origin + '/' || window.location.protocol + '//' + window.location.host + '/',
          scope: ['email'],
          scopeDelimiter: ',',
          nonce: function nonce() {
            return Math.random();
          },
          requiredUrlParams: ['nonce', 'display', 'scope'],
          display: 'popup',
          type: '2.0',
          popupOptions: {
            width: 580,
            height: 400
          }
        },
        linkedin: {
          name: 'linkedin',
          url: '/auth/linkedin',
          authorizationEndpoint: 'https://www.linkedin.com/uas/oauth2/authorization',
          redirectUri: window.location.origin || window.location.protocol + '//' + window.location.host,
          requiredUrlParams: ['state'],
          scope: ['r_emailaddress'],
          scopeDelimiter: ' ',
          state: 'STATE',
          type: '2.0',
          popupOptions: {
            width: 527,
            height: 582
          }
        },
        github: {
          name: 'github',
          url: '/auth/github',
          authorizationEndpoint: 'https://github.com/login/oauth/authorize',
          redirectUri: window.location.origin || window.location.protocol + '//' + window.location.host,
          optionalUrlParams: ['scope'],
          scope: ['user:email'],
          scopeDelimiter: ' ',
          type: '2.0',
          popupOptions: {
            width: 1020,
            height: 618
          }
        },
        yahoo: {
          name: 'yahoo',
          url: '/auth/yahoo',
          authorizationEndpoint: 'https://api.login.yahoo.com/oauth2/request_auth',
          redirectUri: window.location.origin || window.location.protocol + '//' + window.location.host,
          scope: [],
          scopeDelimiter: ',',
          type: '2.0',
          popupOptions: {
            width: 559,
            height: 519
          }
        },
        twitter: {
          name: 'twitter',
          url: '/auth/twitter',
          authorizationEndpoint: 'https://api.twitter.com/oauth/authenticate',
          type: '1.0',
          popupOptions: {
            width: 495,
            height: 645
          }
        },
        live: {
          name: 'live',
          url: '/auth/live',
          authorizationEndpoint: 'https://login.live.com/oauth20_authorize.srf',
          redirectUri: window.location.origin || window.location.protocol + '//' + window.location.host,
          scope: ['wl.emails'],
          scopeDelimiter: ' ',
          requiredUrlParams: ['display', 'scope'],
          display: 'popup',
          type: '2.0',
          popupOptions: {
            width: 500,
            height: 560
          }
        },
        instagram: {
          name: 'instagram',
          url: '/auth/instagram',
          authorizationEndpoint: 'https://api.instagram.com/oauth/authorize',
          redirectUri: window.location.origin || window.location.protocol + '//' + window.location.host,
          requiredUrlParams: ['scope'],
          scope: ['basic'],
          scopeDelimiter: '+',
          display: 'popup',
          type: '2.0',
          popupOptions: {
            width: 550,
            height: 369
          }
        }
      }
    };
  }

  return BaseConfig;
}();

/***/ },
/* 11 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(setImmediate) {'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.TaskQueue = undefined;

var _aureliaPal = __webpack_require__(2);



var hasSetImmediate = typeof setImmediate === 'function';

function makeRequestFlushFromMutationObserver(flush) {
  var toggle = 1;
  var observer = _aureliaPal.DOM.createMutationObserver(flush);
  var node = _aureliaPal.DOM.createTextNode('');
  observer.observe(node, { characterData: true });
  return function requestFlush() {
    toggle = -toggle;
    node.data = toggle;
  };
}

function makeRequestFlushFromTimer(flush) {
  return function requestFlush() {
    var timeoutHandle = setTimeout(handleFlushTimer, 0);

    var intervalHandle = setInterval(handleFlushTimer, 50);
    function handleFlushTimer() {
      clearTimeout(timeoutHandle);
      clearInterval(intervalHandle);
      flush();
    }
  };
}

function onError(error, task) {
  if ('onError' in task) {
    task.onError(error);
  } else if (hasSetImmediate) {
    setImmediate(function () {
      throw error;
    });
  } else {
    setTimeout(function () {
      throw error;
    }, 0);
  }
}

var TaskQueue = exports.TaskQueue = function () {
  function TaskQueue() {
    var _this = this;

    

    this.microTaskQueue = [];
    this.microTaskQueueCapacity = 1024;
    this.taskQueue = [];

    if (_aureliaPal.FEATURE.mutationObserver) {
      this.requestFlushMicroTaskQueue = makeRequestFlushFromMutationObserver(function () {
        return _this.flushMicroTaskQueue();
      });
    } else {
      this.requestFlushMicroTaskQueue = makeRequestFlushFromTimer(function () {
        return _this.flushMicroTaskQueue();
      });
    }

    this.requestFlushTaskQueue = makeRequestFlushFromTimer(function () {
      return _this.flushTaskQueue();
    });
  }

  TaskQueue.prototype.queueMicroTask = function queueMicroTask(task) {
    if (this.microTaskQueue.length < 1) {
      this.requestFlushMicroTaskQueue();
    }

    this.microTaskQueue.push(task);
  };

  TaskQueue.prototype.queueTask = function queueTask(task) {
    if (this.taskQueue.length < 1) {
      this.requestFlushTaskQueue();
    }

    this.taskQueue.push(task);
  };

  TaskQueue.prototype.flushTaskQueue = function flushTaskQueue() {
    var queue = this.taskQueue;
    var index = 0;
    var task = void 0;

    this.taskQueue = [];

    try {
      while (index < queue.length) {
        task = queue[index];
        task.call();
        index++;
      }
    } catch (error) {
      onError(error, task);
    }
  };

  TaskQueue.prototype.flushMicroTaskQueue = function flushMicroTaskQueue() {
    var queue = this.microTaskQueue;
    var capacity = this.microTaskQueueCapacity;
    var index = 0;
    var task = void 0;

    try {
      while (index < queue.length) {
        task = queue[index];
        task.call();
        index++;

        if (index > capacity) {
          for (var scan = 0, newLength = queue.length - index; scan < newLength; scan++) {
            queue[scan] = queue[scan + index];
          }

          queue.length -= index;
          index = 0;
        }
      }
    } catch (error) {
      onError(error, task);
    }

    queue.length = 0;
  };

  return TaskQueue;
}();
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(21).setImmediate))

/***/ },
/* 12 */
/***/ function(module, exports) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj; };

exports.status = status;
exports.isDefined = isDefined;
exports.camelCase = camelCase;
exports.parseQueryString = parseQueryString;
exports.isString = isString;
exports.isObject = isObject;
exports.isFunction = isFunction;
exports.joinUrl = joinUrl;
exports.isBlankObject = isBlankObject;
exports.isArrayLike = isArrayLike;
exports.isWindow = isWindow;
exports.extend = extend;
exports.merge = merge;
exports.forEach = forEach;
var slice = [].slice;

function setHashKey(obj, h) {
  if (h) {
    obj.$$hashKey = h;
  } else {
    delete obj.$$hashKey;
  }
}

function baseExtend(dst, objs, deep) {
  var h = dst.$$hashKey;

  for (var i = 0, ii = objs.length; i < ii; ++i) {
    var obj = objs[i];
    if (!isObject(obj) && !isFunction(obj)) continue;
    var keys = Object.keys(obj);
    for (var j = 0, jj = keys.length; j < jj; j++) {
      var key = keys[j];
      var src = obj[key];

      if (deep && isObject(src)) {
        if (!isObject(dst[key])) dst[key] = Array.isArray(src) ? [] : {};
        baseExtend(dst[key], [src], true);
      } else {
        dst[key] = src;
      }
    }
  }

  setHashKey(dst, h);
  return dst;
}

function status(response) {
  if (response.status >= 200 && response.status < 400) {
    return response.json().catch(function (error) {
      return null;
    });
  }

  throw response;
}

function isDefined(value) {
  return typeof value !== 'undefined';
}

function camelCase(name) {
  return name.replace(/([\:\-\_]+(.))/g, function (_, separator, letter, offset) {
    return offset ? letter.toUpperCase() : letter;
  });
}

function parseQueryString(keyValue) {
  var key = void 0;
  var value = void 0;
  var obj = {};

  forEach((keyValue || '').split('&'), function (kv) {
    if (kv) {
      value = kv.split('=');
      key = decodeURIComponent(value[0]);
      obj[key] = isDefined(value[1]) ? decodeURIComponent(value[1]) : true;
    }
  });

  return obj;
}

function isString(value) {
  return typeof value === 'string';
}

function isObject(value) {
  return value !== null && (typeof value === 'undefined' ? 'undefined' : _typeof(value)) === 'object';
}

function isFunction(value) {
  return typeof value === 'function';
}

function joinUrl(baseUrl, url) {
  if (/^(?:[a-z]+:)?\/\//i.test(url)) {
    return url;
  }

  var joined = [baseUrl, url].join('/');
  var normalize = function normalize(str) {
    return str.replace(/[\/]+/g, '/').replace(/\/\?/g, '?').replace(/\/\#/g, '#').replace(/\:\//g, '://');
  };

  return normalize(joined);
}

function isBlankObject(value) {
  return value !== null && (typeof value === 'undefined' ? 'undefined' : _typeof(value)) === 'object' && !Object.getPrototypeOf(value);
}

function isArrayLike(obj) {
  if (obj === null || isWindow(obj)) {
    return false;
  }
}

function isWindow(obj) {
  return obj && obj.window === obj;
}

function extend(dst) {
  return baseExtend(dst, slice.call(arguments, 1), false);
}

function merge(dst) {
  return baseExtend(dst, slice.call(arguments, 1), true);
}

function forEach(obj, iterator, context) {
  var key = void 0;
  var length = void 0;
  if (obj) {
    if (isFunction(obj)) {
      for (key in obj) {
        if (key !== 'prototype' && key !== 'length' && key !== 'name' && (!obj.hasOwnProperty || obj.hasOwnProperty(key))) {
          iterator.call(context, obj[key], key, obj);
        }
      }
    } else if (Array.isArray(obj) || isArrayLike(obj)) {
      var isPrimitive = (typeof obj === 'undefined' ? 'undefined' : _typeof(obj)) !== 'object';
      for (key = 0, length = obj.length; key < length; key++) {
        if (isPrimitive || key in obj) {
          iterator.call(context, obj[key], key, obj);
        }
      }
    } else if (obj.forEach && obj.forEach !== forEach) {
      obj.forEach(iterator, context, obj);
    } else if (isBlankObject(obj)) {
      for (key in obj) {
        iterator.call(context, obj[key], key, obj);
      }
    } else if (typeof obj.hasOwnProperty === 'function') {
      for (key in obj) {
        if (obj.hasOwnProperty(key)) {
          iterator.call(context, obj[key], key, obj);
        }
      }
    } else {
      for (key in obj) {
        if (hasOwnProperty.call(obj, key)) {
          iterator.call(context, obj[key], key, obj);
        }
      }
    }
  }
  return obj;
}

/***/ },
/* 13 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.updateOverrideContexts = updateOverrideContexts;
exports.createFullOverrideContext = createFullOverrideContext;
exports.updateOverrideContext = updateOverrideContext;
exports.getItemsSourceExpression = getItemsSourceExpression;
exports.unwrapExpression = unwrapExpression;
exports.isOneTime = isOneTime;
exports.updateOneTimeBinding = updateOneTimeBinding;
exports.indexOf = indexOf;

var _aureliaBinding = __webpack_require__(4);

var oneTime = _aureliaBinding.bindingMode.oneTime;

function updateOverrideContexts(views, startIndex) {
  var length = views.length;

  if (startIndex > 0) {
    startIndex = startIndex - 1;
  }

  for (; startIndex < length; ++startIndex) {
    updateOverrideContext(views[startIndex].overrideContext, startIndex, length);
  }
}

function createFullOverrideContext(repeat, data, index, length, key) {
  var bindingContext = {};
  var overrideContext = (0, _aureliaBinding.createOverrideContext)(bindingContext, repeat.scope.overrideContext);

  if (typeof key !== 'undefined') {
    bindingContext[repeat.key] = key;
    bindingContext[repeat.value] = data;
  } else {
    bindingContext[repeat.local] = data;
  }
  updateOverrideContext(overrideContext, index, length);
  return overrideContext;
}

function updateOverrideContext(overrideContext, index, length) {
  var first = index === 0;
  var last = index === length - 1;
  var even = index % 2 === 0;

  overrideContext.$index = index;
  overrideContext.$first = first;
  overrideContext.$last = last;
  overrideContext.$middle = !(first || last);
  overrideContext.$odd = !even;
  overrideContext.$even = even;
}

function getItemsSourceExpression(instruction, attrName) {
  return instruction.behaviorInstructions.filter(function (bi) {
    return bi.originalAttrName === attrName;
  })[0].attributes.items.sourceExpression;
}

function unwrapExpression(expression) {
  var unwrapped = false;
  while (expression instanceof _aureliaBinding.BindingBehavior) {
    expression = expression.expression;
  }
  while (expression instanceof _aureliaBinding.ValueConverter) {
    expression = expression.expression;
    unwrapped = true;
  }
  return unwrapped ? expression : null;
}

function isOneTime(expression) {
  while (expression instanceof _aureliaBinding.BindingBehavior) {
    if (expression.name === 'oneTime') {
      return true;
    }
    expression = expression.expression;
  }
  return false;
}

function updateOneTimeBinding(binding) {
  if (binding.call && binding.mode === oneTime) {
    binding.call(_aureliaBinding.sourceContext);
  } else if (binding.updateOneTimeBindings) {
    binding.updateOneTimeBindings();
  }
}

function indexOf(array, item, matcher, startIndex) {
  if (!matcher) {
    return array.indexOf(item);
  }
  var length = array.length;
  for (var index = startIndex || 0; index < length; index++) {
    if (matcher(array[index], item)) {
      return index;
    }
  }
  return -1;
}

/***/ },
/* 14 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Loader = exports.TemplateRegistryEntry = exports.TemplateDependency = undefined;

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _aureliaPath = __webpack_require__(8);

var _aureliaMetadata = __webpack_require__(6);



var TemplateDependency = exports.TemplateDependency = function TemplateDependency(src, name) {
  

  this.src = src;
  this.name = name;
};

var TemplateRegistryEntry = exports.TemplateRegistryEntry = function () {
  function TemplateRegistryEntry(address) {
    

    this.templateIsLoaded = false;
    this.factoryIsReady = false;
    this.resources = null;
    this.dependencies = null;

    this.address = address;
    this.onReady = null;
    this._template = null;
    this._factory = null;
  }

  TemplateRegistryEntry.prototype.addDependency = function addDependency(src, name) {
    var finalSrc = typeof src === 'string' ? (0, _aureliaPath.relativeToFile)(src, this.address) : _aureliaMetadata.Origin.get(src).moduleId;

    this.dependencies.push(new TemplateDependency(finalSrc, name));
  };

  _createClass(TemplateRegistryEntry, [{
    key: 'template',
    get: function get() {
      return this._template;
    },
    set: function set(value) {
      var address = this.address;
      var requires = void 0;
      var current = void 0;
      var src = void 0;
      var dependencies = void 0;

      this._template = value;
      this.templateIsLoaded = true;

      requires = value.content.querySelectorAll('require');
      dependencies = this.dependencies = new Array(requires.length);

      for (var i = 0, ii = requires.length; i < ii; ++i) {
        current = requires[i];
        src = current.getAttribute('from');

        if (!src) {
          throw new Error('<require> element in ' + address + ' has no "from" attribute.');
        }

        dependencies[i] = new TemplateDependency((0, _aureliaPath.relativeToFile)(src, address), current.getAttribute('as'));

        if (current.parentNode) {
          current.parentNode.removeChild(current);
        }
      }
    }
  }, {
    key: 'factory',
    get: function get() {
      return this._factory;
    },
    set: function set(value) {
      this._factory = value;
      this.factoryIsReady = true;
    }
  }]);

  return TemplateRegistryEntry;
}();

var Loader = exports.Loader = function () {
  function Loader() {
    

    this.templateRegistry = {};
  }

  Loader.prototype.map = function map(id, source) {
    throw new Error('Loaders must implement map(id, source).');
  };

  Loader.prototype.normalizeSync = function normalizeSync(moduleId, relativeTo) {
    throw new Error('Loaders must implement normalizeSync(moduleId, relativeTo).');
  };

  Loader.prototype.normalize = function normalize(moduleId, relativeTo) {
    throw new Error('Loaders must implement normalize(moduleId: string, relativeTo: string): Promise<string>.');
  };

  Loader.prototype.loadModule = function loadModule(id) {
    throw new Error('Loaders must implement loadModule(id).');
  };

  Loader.prototype.loadAllModules = function loadAllModules(ids) {
    throw new Error('Loader must implement loadAllModules(ids).');
  };

  Loader.prototype.loadTemplate = function loadTemplate(url) {
    throw new Error('Loader must implement loadTemplate(url).');
  };

  Loader.prototype.loadText = function loadText(url) {
    throw new Error('Loader must implement loadText(url).');
  };

  Loader.prototype.applyPluginToUrl = function applyPluginToUrl(url, pluginName) {
    throw new Error('Loader must implement applyPluginToUrl(url, pluginName).');
  };

  Loader.prototype.addPlugin = function addPlugin(pluginName, implementation) {
    throw new Error('Loader must implement addPlugin(pluginName, implementation).');
  };

  Loader.prototype.getOrCreateTemplateRegistryEntry = function getOrCreateTemplateRegistryEntry(address) {
    return this.templateRegistry[address] || (this.templateRegistry[address] = new TemplateRegistryEntry(address));
  };

  return Loader;
}();

/***/ },
/* 15 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj; };

exports.json = json;



function json(body) {
  return new Blob([JSON.stringify(body)], { type: 'application/json' });
}

var HttpClientConfiguration = exports.HttpClientConfiguration = function () {
  function HttpClientConfiguration() {
    

    this.baseUrl = '';
    this.defaults = {};
    this.interceptors = [];
  }

  HttpClientConfiguration.prototype.withBaseUrl = function withBaseUrl(baseUrl) {
    this.baseUrl = baseUrl;
    return this;
  };

  HttpClientConfiguration.prototype.withDefaults = function withDefaults(defaults) {
    this.defaults = defaults;
    return this;
  };

  HttpClientConfiguration.prototype.withInterceptor = function withInterceptor(interceptor) {
    this.interceptors.push(interceptor);
    return this;
  };

  HttpClientConfiguration.prototype.useStandardConfiguration = function useStandardConfiguration() {
    var standardConfig = { credentials: 'same-origin' };
    Object.assign(this.defaults, standardConfig, this.defaults);
    return this.rejectErrorResponses();
  };

  HttpClientConfiguration.prototype.rejectErrorResponses = function rejectErrorResponses() {
    return this.withInterceptor({ response: rejectOnError });
  };

  return HttpClientConfiguration;
}();

function rejectOnError(response) {
  if (!response.ok) {
    throw response;
  }

  return response;
}

var HttpClient = exports.HttpClient = function () {
  function HttpClient() {
    

    this.activeRequestCount = 0;
    this.isRequesting = false;
    this.isConfigured = false;
    this.baseUrl = '';
    this.defaults = null;
    this.interceptors = [];

    if (typeof fetch === 'undefined') {
      throw new Error('HttpClient requires a Fetch API implementation, but the current environment doesn\'t support it. You may need to load a polyfill such as https://github.com/github/fetch.');
    }
  }

  HttpClient.prototype.configure = function configure(config) {
    var _interceptors;

    var normalizedConfig = void 0;

    if ((typeof config === 'undefined' ? 'undefined' : _typeof(config)) === 'object') {
      normalizedConfig = { defaults: config };
    } else if (typeof config === 'function') {
      normalizedConfig = new HttpClientConfiguration();
      var c = config(normalizedConfig);
      if (HttpClientConfiguration.prototype.isPrototypeOf(c)) {
        normalizedConfig = c;
      }
    } else {
      throw new Error('invalid config');
    }

    var defaults = normalizedConfig.defaults;
    if (defaults && Headers.prototype.isPrototypeOf(defaults.headers)) {
      throw new Error('Default headers must be a plain object.');
    }

    this.baseUrl = normalizedConfig.baseUrl;
    this.defaults = defaults;
    (_interceptors = this.interceptors).push.apply(_interceptors, normalizedConfig.interceptors || []);
    this.isConfigured = true;

    return this;
  };

  HttpClient.prototype.fetch = function (_fetch) {
    function fetch(_x, _x2) {
      return _fetch.apply(this, arguments);
    }

    fetch.toString = function () {
      return _fetch.toString();
    };

    return fetch;
  }(function (input, init) {
    var _this = this;

    trackRequestStart.call(this);

    var request = Promise.resolve().then(function () {
      return buildRequest.call(_this, input, init, _this.defaults);
    });
    var promise = processRequest(request, this.interceptors).then(function (result) {
      var response = null;

      if (Response.prototype.isPrototypeOf(result)) {
        response = result;
      } else if (Request.prototype.isPrototypeOf(result)) {
        request = Promise.resolve(result);
        response = fetch(result);
      } else {
        throw new Error('An invalid result was returned by the interceptor chain. Expected a Request or Response instance, but got [' + result + ']');
      }

      return request.then(function (_request) {
        return processResponse(response, _this.interceptors, _request);
      });
    });

    return trackRequestEndWith.call(this, promise);
  });

  return HttpClient;
}();

var absoluteUrlRegexp = /^([a-z][a-z0-9+\-.]*:)?\/\//i;

function trackRequestStart() {
  this.isRequesting = !! ++this.activeRequestCount;
}

function trackRequestEnd() {
  this.isRequesting = !! --this.activeRequestCount;
}

function trackRequestEndWith(promise) {
  var handle = trackRequestEnd.bind(this);
  promise.then(handle, handle);
  return promise;
}

function parseHeaderValues(headers) {
  var parsedHeaders = {};
  for (var name in headers || {}) {
    if (headers.hasOwnProperty(name)) {
      parsedHeaders[name] = typeof headers[name] === 'function' ? headers[name]() : headers[name];
    }
  }
  return parsedHeaders;
}

function buildRequest(input, init) {
  var defaults = this.defaults || {};
  var request = void 0;
  var body = void 0;
  var requestContentType = void 0;

  var parsedDefaultHeaders = parseHeaderValues(defaults.headers);
  if (Request.prototype.isPrototypeOf(input)) {
    request = input;
    requestContentType = new Headers(request.headers).get('Content-Type');
  } else {
    init || (init = {});
    body = init.body;
    var bodyObj = body ? { body: body } : null;
    var requestInit = Object.assign({}, defaults, { headers: {} }, init, bodyObj);
    requestContentType = new Headers(requestInit.headers).get('Content-Type');
    request = new Request(getRequestUrl(this.baseUrl, input), requestInit);
  }
  if (!requestContentType && new Headers(parsedDefaultHeaders).has('content-type')) {
    request.headers.set('Content-Type', new Headers(parsedDefaultHeaders).get('content-type'));
  }
  setDefaultHeaders(request.headers, parsedDefaultHeaders);
  if (body && Blob.prototype.isPrototypeOf(body) && body.type) {
    request.headers.set('Content-Type', body.type);
  }
  return request;
}

function getRequestUrl(baseUrl, url) {
  if (absoluteUrlRegexp.test(url)) {
    return url;
  }

  return (baseUrl || '') + url;
}

function setDefaultHeaders(headers, defaultHeaders) {
  for (var name in defaultHeaders || {}) {
    if (defaultHeaders.hasOwnProperty(name) && !headers.has(name)) {
      headers.set(name, defaultHeaders[name]);
    }
  }
}

function processRequest(request, interceptors) {
  return applyInterceptors(request, interceptors, 'request', 'requestError');
}

function processResponse(response, interceptors, request) {
  return applyInterceptors(response, interceptors, 'response', 'responseError', request);
}

function applyInterceptors(input, interceptors, successName, errorName) {
  for (var _len = arguments.length, interceptorArgs = Array(_len > 4 ? _len - 4 : 0), _key = 4; _key < _len; _key++) {
    interceptorArgs[_key - 4] = arguments[_key];
  }

  return (interceptors || []).reduce(function (chain, interceptor) {
    var successHandler = interceptor[successName];
    var errorHandler = interceptor[errorName];

    return chain.then(successHandler && function (value) {
      return successHandler.call.apply(successHandler, [interceptor, value].concat(interceptorArgs));
    } || identity, errorHandler && function (reason) {
      return errorHandler.call.apply(errorHandler, [interceptor, reason].concat(interceptorArgs));
    } || thrower);
  }, Promise.resolve(input));
}

function identity(x) {
  return x;
}

function thrower(x) {
  throw x;
}
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))

/***/ },
/* 16 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.FetchConfig = exports.BaseConfig = exports.AuthorizeStep = exports.AuthService = exports.AuthFilterValueConverter = undefined;
exports.configure = configure;

var _authService = __webpack_require__(71);

var _authorizeStep = __webpack_require__(72);

var _authFetchConfig = __webpack_require__(70);

var _baseConfig = __webpack_require__(10);

var _authFilter = __webpack_require__(28);

function configure(aurelia, configCallback) {
  aurelia.globalResources('./auth-filter');

  var baseConfig = aurelia.container.get(_baseConfig.BaseConfig);
  if (configCallback !== undefined && typeof configCallback === 'function') {
    configCallback(baseConfig);
  }
}

exports.AuthFilterValueConverter = _authFilter.AuthFilterValueConverter;
exports.AuthService = _authService.AuthService;
exports.AuthorizeStep = _authorizeStep.AuthorizeStep;
exports.BaseConfig = _baseConfig.BaseConfig;
exports.FetchConfig = _authFetchConfig.FetchConfig;

/***/ },
/* 17 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.EventAggregator = undefined;
exports.includeEventsIn = includeEventsIn;
exports.configure = configure;

var _aureliaLogging = __webpack_require__(7);

var LogManager = _interopRequireWildcard(_aureliaLogging);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }



var logger = LogManager.getLogger('event-aggregator');

var Handler = function () {
  function Handler(messageType, callback) {
    

    this.messageType = messageType;
    this.callback = callback;
  }

  Handler.prototype.handle = function handle(message) {
    if (message instanceof this.messageType) {
      this.callback.call(null, message);
    }
  };

  return Handler;
}();

var EventAggregator = exports.EventAggregator = function () {
  function EventAggregator() {
    

    this.eventLookup = {};
    this.messageHandlers = [];
  }

  EventAggregator.prototype.publish = function publish(event, data) {
    var subscribers = void 0;
    var i = void 0;

    if (!event) {
      throw new Error('Event was invalid.');
    }

    if (typeof event === 'string') {
      subscribers = this.eventLookup[event];
      if (subscribers) {
        subscribers = subscribers.slice();
        i = subscribers.length;

        try {
          while (i--) {
            subscribers[i](data, event);
          }
        } catch (e) {
          logger.error(e);
        }
      }
    } else {
      subscribers = this.messageHandlers.slice();
      i = subscribers.length;

      try {
        while (i--) {
          subscribers[i].handle(event);
        }
      } catch (e) {
        logger.error(e);
      }
    }
  };

  EventAggregator.prototype.subscribe = function subscribe(event, callback) {
    var handler = void 0;
    var subscribers = void 0;

    if (!event) {
      throw new Error('Event channel/type was invalid.');
    }

    if (typeof event === 'string') {
      handler = callback;
      subscribers = this.eventLookup[event] || (this.eventLookup[event] = []);
    } else {
      handler = new Handler(event, callback);
      subscribers = this.messageHandlers;
    }

    subscribers.push(handler);

    return {
      dispose: function dispose() {
        var idx = subscribers.indexOf(handler);
        if (idx !== -1) {
          subscribers.splice(idx, 1);
        }
      }
    };
  };

  EventAggregator.prototype.subscribeOnce = function subscribeOnce(event, callback) {
    var sub = this.subscribe(event, function (a, b) {
      sub.dispose();
      return callback(a, b);
    });

    return sub;
  };

  return EventAggregator;
}();

function includeEventsIn(obj) {
  var ea = new EventAggregator();

  obj.subscribeOnce = function (event, callback) {
    return ea.subscribeOnce(event, callback);
  };

  obj.subscribe = function (event, callback) {
    return ea.subscribe(event, callback);
  };

  obj.publish = function (event, data) {
    ea.publish(event, data);
  };

  return ea;
}

function configure(config) {
  config.instance(EventAggregator, includeEventsIn(config.aurelia));
}

/***/ },
/* 18 */,
/* 19 */,
/* 20 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Authentication = undefined;

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _dec, _class;

var _aureliaDependencyInjection = __webpack_require__(0);

var _baseConfig = __webpack_require__(10);

var _storage = __webpack_require__(29);

var _authUtilities = __webpack_require__(12);

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Authentication = exports.Authentication = (_dec = (0, _aureliaDependencyInjection.inject)(_storage.Storage, _baseConfig.BaseConfig), _dec(_class = function () {
  function Authentication(storage, config) {
    _classCallCheck(this, Authentication);

    this.storage = storage;
    this.config = config.current;
    this.tokenName = this.config.tokenPrefix ? this.config.tokenPrefix + '_' + this.config.tokenName : this.config.tokenName;
    this.idTokenName = this.config.tokenPrefix ? this.config.tokenPrefix + '_' + this.config.idTokenName : this.config.idTokenName;
  }

  Authentication.prototype.getLoginRoute = function getLoginRoute() {
    return this.config.loginRoute;
  };

  Authentication.prototype.getLoginRedirect = function getLoginRedirect() {
    return this.initialUrl || this.config.loginRedirect;
  };

  Authentication.prototype.getLoginUrl = function getLoginUrl() {
    return this.config.baseUrl ? (0, _authUtilities.joinUrl)(this.config.baseUrl, this.config.loginUrl) : this.config.loginUrl;
  };

  Authentication.prototype.getSignupUrl = function getSignupUrl() {
    return this.config.baseUrl ? (0, _authUtilities.joinUrl)(this.config.baseUrl, this.config.signupUrl) : this.config.signupUrl;
  };

  Authentication.prototype.getProfileUrl = function getProfileUrl() {
    return this.config.baseUrl ? (0, _authUtilities.joinUrl)(this.config.baseUrl, this.config.profileUrl) : this.config.profileUrl;
  };

  Authentication.prototype.getToken = function getToken() {
    return this.storage.get(this.tokenName);
  };

  Authentication.prototype.getPayload = function getPayload() {
    var token = this.storage.get(this.tokenName);
    return this.decomposeToken(token);
  };

  Authentication.prototype.decomposeToken = function decomposeToken(token) {
    if (token && token.split('.').length === 3) {
      var base64Url = token.split('.')[1];
      var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');

      try {
        return JSON.parse(decodeURIComponent(escape(window.atob(base64))));
      } catch (error) {
        return null;
      }
    }
  };

  Authentication.prototype.setInitialUrl = function setInitialUrl(url) {
    this.initialUrl = url;
  };

  Authentication.prototype.setToken = function setToken(response, redirect) {
    var accessToken = response && response[this.config.responseTokenProp];
    var tokenToStore = void 0;

    if (accessToken) {
      if ((0, _authUtilities.isObject)(accessToken) && (0, _authUtilities.isObject)(accessToken.data)) {
        response = accessToken;
      } else if ((0, _authUtilities.isString)(accessToken)) {
        tokenToStore = accessToken;
      }
    }

    if (!tokenToStore && response) {
      tokenToStore = this.config.tokenRoot && response[this.config.tokenRoot] ? response[this.config.tokenRoot][this.config.tokenName] : response[this.config.tokenName];
    }

    if (tokenToStore) {
      this.storage.set(this.tokenName, tokenToStore);
    }

    var idToken = response && response[this.config.responseIdTokenProp];

    if (idToken) {
      this.storage.set(this.idTokenName, idToken);
    }

    if (this.config.loginRedirect && !redirect) {
      window.location.href = this.getLoginRedirect();
    } else if (redirect && (0, _authUtilities.isString)(redirect)) {
      window.location.href = window.encodeURI(redirect);
    }
  };

  Authentication.prototype.removeToken = function removeToken() {
    this.storage.remove(this.tokenName);
  };

  Authentication.prototype.isAuthenticated = function isAuthenticated() {
    var token = this.storage.get(this.tokenName);

    if (!token) {
      return false;
    }

    if (token.split('.').length !== 3) {
      return true;
    }

    var exp = void 0;
    try {
      var base64Url = token.split('.')[1];
      var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      exp = JSON.parse(window.atob(base64)).exp;
    } catch (error) {
      return false;
    }

    if (exp) {
      return Math.round(new Date().getTime() / 1000) <= exp;
    }

    return true;
  };

  Authentication.prototype.logout = function logout(redirect) {
    var _this = this;

    return new Promise(function (resolve) {
      _this.storage.remove(_this.tokenName);

      if (_this.config.logoutRedirect && !redirect) {
        window.location.href = _this.config.logoutRedirect;
      } else if ((0, _authUtilities.isString)(redirect)) {
        window.location.href = redirect;
      }

      resolve();
    });
  };

  _createClass(Authentication, [{
    key: 'tokenInterceptor',
    get: function get() {
      var config = this.config;
      var storage = this.storage;
      var auth = this;
      return {
        request: function request(_request) {
          if (auth.isAuthenticated() && config.httpInterceptor) {
            var tokenName = config.tokenPrefix ? config.tokenPrefix + '_' + config.tokenName : config.tokenName;
            var token = storage.get(tokenName);

            if (config.authHeader && config.authToken) {
              token = config.authToken + ' ' + token;
            }

            _request.headers.set(config.authHeader, token);
          }
          return _request;
        }
      };
    }
  }]);

  return Authentication;
}()) || _class);
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))

/***/ },
/* 21 */,
/* 22 */,
/* 23 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.bootstrap = bootstrap;

__webpack_require__(19);

var _aureliaPalBrowser = __webpack_require__(18);

var _aureliaLoaderWebpack = __webpack_require__(26);

var bootstrapQueue = [];
var sharedLoader = null;
var Aurelia = null;

function onBootstrap(callback) {
  return new Promise(function (resolve, reject) {
    if (sharedLoader) {
      resolve(callback(sharedLoader));
    } else {
      bootstrapQueue.push(function () {
        try {
          resolve(callback(sharedLoader));
        } catch (e) {
          reject(e);
        }
      });
    }
  });
}

function ready(global) {
  return new Promise(function (resolve, reject) {
    if (global.document.readyState === 'complete') {
      resolve(global.document);
    } else {
      global.document.addEventListener('DOMContentLoaded', completed);
      global.addEventListener('load', completed);
    }

    function completed() {
      global.document.removeEventListener('DOMContentLoaded', completed);
      global.removeEventListener('load', completed);
      resolve(global.document);
    }
  });
}

function handleApp(loader, appHost) {
  return config(loader, appHost, appHost.getAttribute('aurelia-app'));
}

function config(loader, appHost, configModuleId) {
  var aurelia = new Aurelia(loader);
  aurelia.host = appHost;

  if (configModuleId) {
    return loader.loadModule(configModuleId).then(function (customConfig) {
      return customConfig.configure(aurelia);
    });
  }

  aurelia.use.standardConfiguration().developmentLogging();

  return aurelia.start().then(function () {
    return aurelia.setRoot();
  });
}

function run() {
  return ready(window).then(function (doc) {
    (0, _aureliaPalBrowser.initialize)();

    var appHost = doc.querySelectorAll('[aurelia-app]');
    var loader = new _aureliaLoaderWebpack.WebpackLoader();
    loader.loadModule('aurelia-framework').then(function (m) {
      Aurelia = m.Aurelia;
      for (var i = 0, ii = appHost.length; i < ii; ++i) {
        handleApp(loader, appHost[i]).catch(console.error.bind(console));
      }

      sharedLoader = loader;
      for (var _i = 0, _ii = bootstrapQueue.length; _i < _ii; ++_i) {
        bootstrapQueue[_i]();
      }
      bootstrapQueue = null;
    });
  });
}

function bootstrap(configure) {
  return onBootstrap(function (loader) {
    var aurelia = new Aurelia(loader);
    return configure(aurelia);
  });
}

run();
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))

/***/ },
/* 24 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.LogManager = exports.FrameworkConfiguration = exports.Aurelia = undefined;

var _aureliaDependencyInjection = __webpack_require__(0);

Object.keys(_aureliaDependencyInjection).forEach(function (key) {
  if (key === "default" || key === "__esModule") return;
  Object.defineProperty(exports, key, {
    enumerable: true,
    get: function get() {
      return _aureliaDependencyInjection[key];
    }
  });
});

var _aureliaBinding = __webpack_require__(4);

Object.keys(_aureliaBinding).forEach(function (key) {
  if (key === "default" || key === "__esModule") return;
  Object.defineProperty(exports, key, {
    enumerable: true,
    get: function get() {
      return _aureliaBinding[key];
    }
  });
});

var _aureliaMetadata = __webpack_require__(6);

Object.keys(_aureliaMetadata).forEach(function (key) {
  if (key === "default" || key === "__esModule") return;
  Object.defineProperty(exports, key, {
    enumerable: true,
    get: function get() {
      return _aureliaMetadata[key];
    }
  });
});

var _aureliaTemplating = __webpack_require__(3);

Object.keys(_aureliaTemplating).forEach(function (key) {
  if (key === "default" || key === "__esModule") return;
  Object.defineProperty(exports, key, {
    enumerable: true,
    get: function get() {
      return _aureliaTemplating[key];
    }
  });
});

var _aureliaLoader = __webpack_require__(14);

Object.keys(_aureliaLoader).forEach(function (key) {
  if (key === "default" || key === "__esModule") return;
  Object.defineProperty(exports, key, {
    enumerable: true,
    get: function get() {
      return _aureliaLoader[key];
    }
  });
});

var _aureliaTaskQueue = __webpack_require__(11);

Object.keys(_aureliaTaskQueue).forEach(function (key) {
  if (key === "default" || key === "__esModule") return;
  Object.defineProperty(exports, key, {
    enumerable: true,
    get: function get() {
      return _aureliaTaskQueue[key];
    }
  });
});

var _aureliaPath = __webpack_require__(8);

Object.keys(_aureliaPath).forEach(function (key) {
  if (key === "default" || key === "__esModule") return;
  Object.defineProperty(exports, key, {
    enumerable: true,
    get: function get() {
      return _aureliaPath[key];
    }
  });
});

var _aureliaPal = __webpack_require__(2);

Object.keys(_aureliaPal).forEach(function (key) {
  if (key === "default" || key === "__esModule") return;
  Object.defineProperty(exports, key, {
    enumerable: true,
    get: function get() {
      return _aureliaPal[key];
    }
  });
});

var _aureliaLogging = __webpack_require__(7);

var TheLogManager = _interopRequireWildcard(_aureliaLogging);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }



function preventActionlessFormSubmit() {
  _aureliaPal.DOM.addEventListener('submit', function (evt) {
    var target = evt.target;
    var action = target.action;

    if (target.tagName.toLowerCase() === 'form' && !action) {
      evt.preventDefault();
    }
  });
}

var Aurelia = exports.Aurelia = function () {
  function Aurelia(loader, container, resources) {


    this.loader = loader || new _aureliaPal.PLATFORM.Loader();
    this.container = container || new _aureliaDependencyInjection.Container().makeGlobal();
    this.resources = resources || new _aureliaTemplating.ViewResources();
    this.use = new FrameworkConfiguration(this);
    this.logger = TheLogManager.getLogger('aurelia');
    this.hostConfigured = false;
    this.host = null;

    this.use.instance(Aurelia, this);
    this.use.instance(_aureliaLoader.Loader, this.loader);
    this.use.instance(_aureliaTemplating.ViewResources, this.resources);
  }

  Aurelia.prototype.start = function start() {
    var _this = this;

    if (this.started) {
      return Promise.resolve(this);
    }

    this.started = true;
    this.logger.info('Aurelia Starting');

    return this.use.apply().then(function () {
      preventActionlessFormSubmit();

      if (!_this.container.hasResolver(_aureliaTemplating.BindingLanguage)) {
        var message = 'You must configure Aurelia with a BindingLanguage implementation.';
        _this.logger.error(message);
        throw new Error(message);
      }

      _this.logger.info('Aurelia Started');
      var evt = _aureliaPal.DOM.createCustomEvent('aurelia-started', { bubbles: true, cancelable: true });
      _aureliaPal.DOM.dispatchEvent(evt);
      return _this;
    });
  };

  Aurelia.prototype.enhance = function enhance() {
    var _this2 = this;

    var bindingContext = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];
    var applicationHost = arguments.length <= 1 || arguments[1] === undefined ? null : arguments[1];

    this._configureHost(applicationHost || _aureliaPal.DOM.querySelectorAll('body')[0]);

    return new Promise(function (resolve) {
      var engine = _this2.container.get(_aureliaTemplating.TemplatingEngine);
      _this2.root = engine.enhance({ container: _this2.container, element: _this2.host, resources: _this2.resources, bindingContext: bindingContext });
      _this2.root.attached();
      _this2._onAureliaComposed();
      return _this2;
    });
  };

  Aurelia.prototype.setRoot = function setRoot() {
    var _this3 = this;

    var root = arguments.length <= 0 || arguments[0] === undefined ? null : arguments[0];
    var applicationHost = arguments.length <= 1 || arguments[1] === undefined ? null : arguments[1];

    var instruction = {};

    if (this.root && this.root.viewModel && this.root.viewModel.router) {
      this.root.viewModel.router.deactivate();
      this.root.viewModel.router.reset();
    }

    this._configureHost(applicationHost);

    var engine = this.container.get(_aureliaTemplating.TemplatingEngine);
    var transaction = this.container.get(_aureliaTemplating.CompositionTransaction);
    delete transaction.initialComposition;

    if (!root) {
      if (this.configModuleId) {
        root = (0, _aureliaPath.relativeToFile)('./app', this.configModuleId);
      } else {
        root = 'app';
      }
    }

    instruction.viewModel = root;
    instruction.container = instruction.childContainer = this.container;
    instruction.viewSlot = this.hostSlot;
    instruction.host = this.host;

    return engine.compose(instruction).then(function (r) {
      _this3.root = r;
      instruction.viewSlot.attached();
      _this3._onAureliaComposed();
      return _this3;
    });
  };

  Aurelia.prototype._configureHost = function _configureHost(applicationHost) {
    if (this.hostConfigured) {
      return;
    }
    applicationHost = applicationHost || this.host;

    if (!applicationHost || typeof applicationHost === 'string') {
      this.host = _aureliaPal.DOM.getElementById(applicationHost || 'applicationHost');
    } else {
      this.host = applicationHost;
    }

    if (!this.host) {
      throw new Error('No applicationHost was specified.');
    }

    this.hostConfigured = true;
    this.host.aurelia = this;
    this.hostSlot = new _aureliaTemplating.ViewSlot(this.host, true);
    this.hostSlot.transformChildNodesIntoView();
    this.container.registerInstance(_aureliaPal.DOM.boundary, this.host);
  };

  Aurelia.prototype._onAureliaComposed = function _onAureliaComposed() {
    var evt = _aureliaPal.DOM.createCustomEvent('aurelia-composed', { bubbles: true, cancelable: true });
    setTimeout(function () {
      return _aureliaPal.DOM.dispatchEvent(evt);
    }, 1);
  };

  return Aurelia;
}();

var logger = TheLogManager.getLogger('aurelia');
var extPattern = /\.[^/.]+$/;

function runTasks(config, tasks) {
  var current = void 0;
  var next = function next() {
    if (current = tasks.shift()) {
      return Promise.resolve(current(config)).then(next);
    }

    return Promise.resolve();
  };

  return next();
}

function loadPlugin(config, loader, info) {
  logger.debug('Loading plugin ' + info.moduleId + '.');
  config.resourcesRelativeTo = info.resourcesRelativeTo;

  var id = info.moduleId;

  if (info.resourcesRelativeTo.length > 1) {
    return loader.normalize(info.moduleId, info.resourcesRelativeTo[1]).then(function (normalizedId) {
      return _loadPlugin(normalizedId);
    });
  }

  return _loadPlugin(id);

  function _loadPlugin(moduleId) {
    return loader.loadModule(moduleId).then(function (m) {
      if ('configure' in m) {
        return Promise.resolve(m.configure(config, info.config || {})).then(function () {
          config.resourcesRelativeTo = null;
          logger.debug('Configured plugin ' + info.moduleId + '.');
        });
      }

      config.resourcesRelativeTo = null;
      logger.debug('Loaded plugin ' + info.moduleId + '.');
    });
  }
}

function loadResources(aurelia, resourcesToLoad, appResources) {
  var viewEngine = aurelia.container.get(_aureliaTemplating.ViewEngine);

  return Promise.all(Object.keys(resourcesToLoad).map(function (n) {
    return _normalize(resourcesToLoad[n]);
  })).then(function (loads) {
    var names = [];
    var importIds = [];

    loads.forEach(function (l) {
      names.push(undefined);
      importIds.push(l.importId);
    });

    return viewEngine.importViewResources(importIds, names, appResources);
  });

  function _normalize(load) {
    var moduleId = load.moduleId;
    var ext = getExt(moduleId);

    if (isOtherResource(moduleId)) {
      moduleId = removeExt(moduleId);
    }

    return aurelia.loader.normalize(moduleId, load.relativeTo).then(function (normalized) {
      return {
        name: load.moduleId,
        importId: isOtherResource(load.moduleId) ? addOriginalExt(normalized, ext) : normalized
      };
    });
  }

  function isOtherResource(name) {
    var ext = getExt(name);
    if (!ext) return false;
    if (ext === '') return false;
    if (ext === '.js' || ext === '.ts') return false;
    return true;
  }

  function removeExt(name) {
    return name.replace(extPattern, '');
  }

  function addOriginalExt(normalized, ext) {
    return removeExt(normalized) + '.' + ext;
  }
}

function getExt(name) {
  var match = name.match(extPattern);
  if (match && match.length > 0) {
    return match[0].split('.')[1];
  }
}

function assertProcessed(plugins) {
  if (plugins.processed) {
    throw new Error('This config instance has already been applied. To load more plugins or global resources, create a new FrameworkConfiguration instance.');
  }
}

var FrameworkConfiguration = function () {
  function FrameworkConfiguration(aurelia) {
    var _this4 = this;



    this.aurelia = aurelia;
    this.container = aurelia.container;
    this.info = [];
    this.processed = false;
    this.preTasks = [];
    this.postTasks = [];
    this.resourcesToLoad = {};
    this.preTask(function () {
      return aurelia.loader.normalize('aurelia-bootstrapper').then(function (name) {
        return _this4.bootstrapperName = name;
      });
    });
    this.postTask(function () {
      return loadResources(aurelia, _this4.resourcesToLoad, aurelia.resources);
    });
  }

  FrameworkConfiguration.prototype.instance = function instance(type, _instance) {
    this.container.registerInstance(type, _instance);
    return this;
  };

  FrameworkConfiguration.prototype.singleton = function singleton(type, implementation) {
    this.container.registerSingleton(type, implementation);
    return this;
  };

  FrameworkConfiguration.prototype.transient = function transient(type, implementation) {
    this.container.registerTransient(type, implementation);
    return this;
  };

  FrameworkConfiguration.prototype.preTask = function preTask(task) {
    assertProcessed(this);
    this.preTasks.push(task);
    return this;
  };

  FrameworkConfiguration.prototype.postTask = function postTask(task) {
    assertProcessed(this);
    this.postTasks.push(task);
    return this;
  };

  FrameworkConfiguration.prototype.feature = function feature(plugin, config) {
    if (getExt(plugin)) {
      return this.plugin({ moduleId: plugin, resourcesRelativeTo: [plugin, ''], config: config || {} });
    }

    return this.plugin({ moduleId: plugin + '/index', resourcesRelativeTo: [plugin, ''], config: config || {} });
  };

  FrameworkConfiguration.prototype.globalResources = function globalResources(resources) {
    assertProcessed(this);

    var toAdd = Array.isArray(resources) ? resources : arguments;
    var resource = void 0;
    var path = void 0;
    var resourcesRelativeTo = this.resourcesRelativeTo || ['', ''];

    for (var i = 0, ii = toAdd.length; i < ii; ++i) {
      resource = toAdd[i];
      if (typeof resource !== 'string') {
        throw new Error('Invalid resource path [' + resource + ']. Resources must be specified as relative module IDs.');
      }

      var parent = resourcesRelativeTo[0];
      var grandParent = resourcesRelativeTo[1];
      var name = resource;

      if ((resource.startsWith('./') || resource.startsWith('../')) && parent !== '') {
        name = (0, _aureliaPath.join)(parent, resource);
      }

      this.resourcesToLoad[name] = { moduleId: name, relativeTo: grandParent };
    }

    return this;
  };

  FrameworkConfiguration.prototype.globalName = function globalName(resourcePath, newName) {
    assertProcessed(this);
    this.resourcesToLoad[resourcePath] = { moduleId: newName, relativeTo: '' };
    return this;
  };

  FrameworkConfiguration.prototype.plugin = function plugin(_plugin, config) {
    assertProcessed(this);

    if (typeof _plugin === 'string') {
      return this.plugin({ moduleId: _plugin, resourcesRelativeTo: [_plugin, ''], config: config || {} });
    }

    this.info.push(_plugin);
    return this;
  };

  FrameworkConfiguration.prototype._addNormalizedPlugin = function _addNormalizedPlugin(name, config) {
    var _this5 = this;

    var plugin = { moduleId: name, resourcesRelativeTo: [name, ''], config: config || {} };
    this.plugin(plugin);

    this.preTask(function () {
      var relativeTo = [name, _this5.bootstrapperName];
      plugin.moduleId = name;
      plugin.resourcesRelativeTo = relativeTo;
      return Promise.resolve();
    });

    return this;
  };

  FrameworkConfiguration.prototype.defaultBindingLanguage = function defaultBindingLanguage() {
    return this._addNormalizedPlugin('aurelia-templating-binding');
  };

  FrameworkConfiguration.prototype.router = function router() {
    return this._addNormalizedPlugin('aurelia-templating-router');
  };

  FrameworkConfiguration.prototype.history = function history() {
    return this._addNormalizedPlugin('aurelia-history-browser');
  };

  FrameworkConfiguration.prototype.defaultResources = function defaultResources() {
    return this._addNormalizedPlugin('aurelia-templating-resources');
  };

  FrameworkConfiguration.prototype.eventAggregator = function eventAggregator() {
    return this._addNormalizedPlugin('aurelia-event-aggregator');
  };

  FrameworkConfiguration.prototype.basicConfiguration = function basicConfiguration() {
    return this.defaultBindingLanguage().defaultResources().eventAggregator();
  };

  FrameworkConfiguration.prototype.standardConfiguration = function standardConfiguration() {
    return this.basicConfiguration().history().router();
  };

  FrameworkConfiguration.prototype.developmentLogging = function developmentLogging() {
    var _this6 = this;

    this.preTask(function () {
      return _this6.aurelia.loader.normalize('aurelia-logging-console', _this6.bootstrapperName).then(function (name) {
        return _this6.aurelia.loader.loadModule(name).then(function (m) {
          TheLogManager.addAppender(new m.ConsoleAppender());
          TheLogManager.setLevel(TheLogManager.logLevel.debug);
        });
      });
    });

    return this;
  };

  FrameworkConfiguration.prototype.apply = function apply() {
    var _this7 = this;

    if (this.processed) {
      return Promise.resolve();
    }

    return runTasks(this, this.preTasks).then(function () {
      var loader = _this7.aurelia.loader;
      var info = _this7.info;
      var current = void 0;

      var next = function next() {
        if (current = info.shift()) {
          return loadPlugin(_this7, loader, current).then(next);
        }

        _this7.processed = true;
        return Promise.resolve();
      };

      return next().then(function () {
        return runTasks(_this7, _this7.postTasks);
      });
    });
  };

  return FrameworkConfiguration;
}();

exports.FrameworkConfiguration = FrameworkConfiguration;
var LogManager = exports.LogManager = TheLogManager;

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))

/***/ },
/* 25 */
/***/ function(module, exports) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});



function mi(name) {
  throw new Error('History must implement ' + name + '().');
}

var History = exports.History = function () {
  function History() {
    
  }

  History.prototype.activate = function activate(options) {
    mi('activate');
  };

  History.prototype.deactivate = function deactivate() {
    mi('deactivate');
  };

  History.prototype.getAbsoluteRoot = function getAbsoluteRoot() {
    mi('getAbsoluteRoot');
  };

  History.prototype.navigate = function navigate(fragment, options) {
    mi('navigate');
  };

  History.prototype.navigateBack = function navigateBack() {
    mi('navigateBack');
  };

  History.prototype.setTitle = function setTitle(title) {
    mi('setTitle');
  };

  return History;
}();

/***/ },
/* 26 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.WebpackLoader = exports.TextTemplateLoader = undefined;

var _aureliaMetadata = __webpack_require__(6);

var _aureliaLoader = __webpack_require__(14);

var _aureliaPal = __webpack_require__(2);

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }



var TextTemplateLoader = exports.TextTemplateLoader = function () {
  function TextTemplateLoader() {
    
  }

  TextTemplateLoader.prototype.loadTemplate = function loadTemplate(loader, entry) {
    return loader.loadText(entry.address).then(function (text) {
      entry.template = _aureliaPal.DOM.createTemplateFromMarkup(text);
    });
  };

  return TextTemplateLoader;
}();

function ensureOriginOnExports(executed, name) {
  var target = executed;
  var key = void 0;
  var exportedValue = void 0;

  if (target.__useDefault) {
    target = target.default;
  }

  _aureliaMetadata.Origin.set(target, new _aureliaMetadata.Origin(name, 'default'));

  for (key in target) {
    exportedValue = target[key];

    if (typeof exportedValue === 'function') {
      _aureliaMetadata.Origin.set(exportedValue, new _aureliaMetadata.Origin(name, key));
    }
  }

  return executed;
}

var WebpackLoader = exports.WebpackLoader = function (_Loader) {
  _inherits(WebpackLoader, _Loader);

  function WebpackLoader() {
    

    var _this = _possibleConstructorReturn(this, _Loader.call(this));

    _this.moduleRegistry = Object.create(null);
    _this.loaderPlugins = Object.create(null);
    _this.useTemplateLoader(new TextTemplateLoader());

    var that = _this;

    _this.addPlugin('template-registry-entry', {
      'fetch': function fetch(address) {
        var entry = that.getOrCreateTemplateRegistryEntry(address);
        return entry.templateIsLoaded ? entry : that.templateLoader.loadTemplate(that, entry).then(function (x) {
          return entry;
        });
      }
    });

    _aureliaPal.PLATFORM.eachModule = function (callback) {
      var registry = _this.moduleRegistry;

      for (var key in registry) {
        try {
          if (callback(key, registry[key])) return;
        } catch (e) {}
      }
    };
    return _this;
  }

  WebpackLoader.prototype._import = function _import(moduleId) {
    var _this2 = this;

    var moduleIdParts = moduleId.split('!');
    var path = moduleIdParts.splice(moduleIdParts.length - 1, 1)[0];
    var loaderPlugin = moduleIdParts.length === 1 ? moduleIdParts[0] : null;

    return new Promise(function (resolve, reject) {
      try {
        if (loaderPlugin) {
          resolve(_this2.loaderPlugins[loaderPlugin].fetch(path));
        } else {
          __webpack_require__.e/* nsure */(0).catch(function(err) { __webpack_require__.oe(err); }).then((function (require) {
            var result = __webpack_require__(108)("./" + path);
            if (typeof result === 'function') {
              result(function (res) {
                return resolve(res);
              });
            } else {
              resolve(result);
            }
          }).bind(null, __webpack_require__));
        }
      } catch (e) {
        reject(e);
      }
    });
  };

  WebpackLoader.prototype.map = function map(id, source) {};

  WebpackLoader.prototype.normalizeSync = function normalizeSync(moduleId, relativeTo) {
    return moduleId;
  };

  WebpackLoader.prototype.normalize = function normalize(moduleId, relativeTo) {
    return Promise.resolve(moduleId);
  };

  WebpackLoader.prototype.useTemplateLoader = function useTemplateLoader(templateLoader) {
    this.templateLoader = templateLoader;
  };

  WebpackLoader.prototype.loadAllModules = function loadAllModules(ids) {
    var loads = [];

    for (var i = 0, ii = ids.length; i < ii; ++i) {
      loads.push(this.loadModule(ids[i]));
    }

    return Promise.all(loads);
  };

  WebpackLoader.prototype.loadModule = function loadModule(id) {
    var _this3 = this;

    var existing = this.moduleRegistry[id];
    if (existing) {
      return Promise.resolve(existing);
    }

    return new Promise(function (resolve, reject) {
      try {
        _this3._import(id).then(function (m) {
          _this3.moduleRegistry[id] = m;
          resolve(ensureOriginOnExports(m, id));
        });
      } catch (e) {
        reject(e);
      }
    });
  };

  WebpackLoader.prototype.loadTemplate = function loadTemplate(url) {
    return this._import(this.applyPluginToUrl(url, 'template-registry-entry'));
  };

  WebpackLoader.prototype.loadText = function loadText(url) {
    return this._import(url).then(function (result) {
      if (result instanceof Array && result[0] instanceof Array && result.hasOwnProperty('toString')) {
        return result.toString();
      }

      return result;
    });
  };

  WebpackLoader.prototype.applyPluginToUrl = function applyPluginToUrl(url, pluginName) {
    return pluginName + '!' + url;
  };

  WebpackLoader.prototype.addPlugin = function addPlugin(pluginName, implementation) {
    this.loaderPlugins[pluginName] = implementation;
  };

  return WebpackLoader;
}(_aureliaLoader.Loader);

_aureliaPal.PLATFORM.Loader = WebpackLoader;
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))

/***/ },
/* 27 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.RouteRecognizer = exports.EpsilonSegment = exports.StarSegment = exports.DynamicSegment = exports.StaticSegment = exports.State = undefined;

var _aureliaPath = __webpack_require__(8);



var State = exports.State = function () {
  function State(charSpec) {
    

    this.charSpec = charSpec;
    this.nextStates = [];
  }

  State.prototype.get = function get(charSpec) {
    for (var _iterator = this.nextStates, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
      var _ref;

      if (_isArray) {
        if (_i >= _iterator.length) break;
        _ref = _iterator[_i++];
      } else {
        _i = _iterator.next();
        if (_i.done) break;
        _ref = _i.value;
      }

      var child = _ref;

      var isEqual = child.charSpec.validChars === charSpec.validChars && child.charSpec.invalidChars === charSpec.invalidChars;

      if (isEqual) {
        return child;
      }
    }

    return undefined;
  };

  State.prototype.put = function put(charSpec) {
    var state = this.get(charSpec);

    if (state) {
      return state;
    }

    state = new State(charSpec);

    this.nextStates.push(state);

    if (charSpec.repeat) {
      state.nextStates.push(state);
    }

    return state;
  };

  State.prototype.match = function match(ch) {
    var nextStates = this.nextStates;
    var results = [];

    for (var i = 0, l = nextStates.length; i < l; i++) {
      var child = nextStates[i];
      var charSpec = child.charSpec;

      if (charSpec.validChars !== undefined) {
        if (charSpec.validChars.indexOf(ch) !== -1) {
          results.push(child);
        }
      } else if (charSpec.invalidChars !== undefined) {
        if (charSpec.invalidChars.indexOf(ch) === -1) {
          results.push(child);
        }
      }
    }

    return results;
  };

  return State;
}();

var specials = ['/', '.', '*', '+', '?', '|', '(', ')', '[', ']', '{', '}', '\\'];

var escapeRegex = new RegExp('(\\' + specials.join('|\\') + ')', 'g');

var StaticSegment = exports.StaticSegment = function () {
  function StaticSegment(string, caseSensitive) {
    

    this.string = string;
    this.caseSensitive = caseSensitive;
  }

  StaticSegment.prototype.eachChar = function eachChar(callback) {
    var s = this.string;
    for (var i = 0, ii = s.length; i < ii; ++i) {
      var ch = s[i];
      callback({ validChars: this.caseSensitive ? ch : ch.toUpperCase() + ch.toLowerCase() });
    }
  };

  StaticSegment.prototype.regex = function regex() {
    return this.string.replace(escapeRegex, '\\$1');
  };

  StaticSegment.prototype.generate = function generate() {
    return this.string;
  };

  return StaticSegment;
}();

var DynamicSegment = exports.DynamicSegment = function () {
  function DynamicSegment(name) {
    

    this.name = name;
  }

  DynamicSegment.prototype.eachChar = function eachChar(callback) {
    callback({ invalidChars: '/', repeat: true });
  };

  DynamicSegment.prototype.regex = function regex() {
    return '([^/]+)';
  };

  DynamicSegment.prototype.generate = function generate(params, consumed) {
    consumed[this.name] = true;
    return params[this.name];
  };

  return DynamicSegment;
}();

var StarSegment = exports.StarSegment = function () {
  function StarSegment(name) {
    

    this.name = name;
  }

  StarSegment.prototype.eachChar = function eachChar(callback) {
    callback({ invalidChars: '', repeat: true });
  };

  StarSegment.prototype.regex = function regex() {
    return '(.+)';
  };

  StarSegment.prototype.generate = function generate(params, consumed) {
    consumed[this.name] = true;
    return params[this.name];
  };

  return StarSegment;
}();

var EpsilonSegment = exports.EpsilonSegment = function () {
  function EpsilonSegment() {
    
  }

  EpsilonSegment.prototype.eachChar = function eachChar() {};

  EpsilonSegment.prototype.regex = function regex() {
    return '';
  };

  EpsilonSegment.prototype.generate = function generate() {
    return '';
  };

  return EpsilonSegment;
}();

var RouteRecognizer = exports.RouteRecognizer = function () {
  function RouteRecognizer() {
    

    this.rootState = new State();
    this.names = {};
  }

  RouteRecognizer.prototype.add = function add(route) {
    var _this = this;

    if (Array.isArray(route)) {
      route.forEach(function (r) {
        return _this.add(r);
      });
      return undefined;
    }

    var currentState = this.rootState;
    var regex = '^';
    var types = { statics: 0, dynamics: 0, stars: 0 };
    var names = [];
    var routeName = route.handler.name;
    var isEmpty = true;
    var segments = parse(route.path, names, types, route.caseSensitive);

    for (var i = 0, ii = segments.length; i < ii; i++) {
      var segment = segments[i];
      if (segment instanceof EpsilonSegment) {
        continue;
      }

      isEmpty = false;

      currentState = currentState.put({ validChars: '/' });
      regex += '/';

      currentState = addSegment(currentState, segment);
      regex += segment.regex();
    }

    if (isEmpty) {
      currentState = currentState.put({ validChars: '/' });
      regex += '/';
    }

    var handlers = [{ handler: route.handler, names: names }];

    if (routeName) {
      var routeNames = Array.isArray(routeName) ? routeName : [routeName];
      for (var _i2 = 0; _i2 < routeNames.length; _i2++) {
        this.names[routeNames[_i2]] = {
          segments: segments,
          handlers: handlers
        };
      }
    }

    currentState.handlers = handlers;
    currentState.regex = new RegExp(regex + '$', route.caseSensitive ? '' : 'i');
    currentState.types = types;

    return currentState;
  };

  RouteRecognizer.prototype.handlersFor = function handlersFor(name) {
    var route = this.names[name];
    if (!route) {
      throw new Error('There is no route named ' + name);
    }

    return [].concat(route.handlers);
  };

  RouteRecognizer.prototype.hasRoute = function hasRoute(name) {
    return !!this.names[name];
  };

  RouteRecognizer.prototype.generate = function generate(name, params) {
    var route = this.names[name];
    if (!route) {
      throw new Error('There is no route named ' + name);
    }

    var handler = route.handlers[0].handler;
    if (handler.href) {
      return handler.href;
    }

    var routeParams = Object.assign({}, params);
    var segments = route.segments;
    var consumed = {};
    var output = '';

    for (var i = 0, l = segments.length; i < l; i++) {
      var segment = segments[i];

      if (segment instanceof EpsilonSegment) {
        continue;
      }

      output += '/';
      var segmentValue = segment.generate(routeParams, consumed);
      if (segmentValue === null || segmentValue === undefined) {
        throw new Error('A value is required for route parameter \'' + segment.name + '\' in route \'' + name + '\'.');
      }

      output += segmentValue;
    }

    if (output.charAt(0) !== '/') {
      output = '/' + output;
    }

    for (var param in consumed) {
      delete routeParams[param];
    }

    var queryString = (0, _aureliaPath.buildQueryString)(routeParams);
    output += queryString ? '?' + queryString : '';

    return output;
  };

  RouteRecognizer.prototype.recognize = function recognize(path) {
    var states = [this.rootState];
    var queryParams = {};
    var isSlashDropped = false;
    var normalizedPath = path;

    var queryStart = normalizedPath.indexOf('?');
    if (queryStart !== -1) {
      var queryString = normalizedPath.substr(queryStart + 1, normalizedPath.length);
      normalizedPath = normalizedPath.substr(0, queryStart);
      queryParams = (0, _aureliaPath.parseQueryString)(queryString);
    }

    normalizedPath = decodeURI(normalizedPath);

    if (normalizedPath.charAt(0) !== '/') {
      normalizedPath = '/' + normalizedPath;
    }

    var pathLen = normalizedPath.length;
    if (pathLen > 1 && normalizedPath.charAt(pathLen - 1) === '/') {
      normalizedPath = normalizedPath.substr(0, pathLen - 1);
      isSlashDropped = true;
    }

    for (var i = 0, l = normalizedPath.length; i < l; i++) {
      states = recognizeChar(states, normalizedPath.charAt(i));
      if (!states.length) {
        break;
      }
    }

    var solutions = [];
    for (var _i3 = 0, _l = states.length; _i3 < _l; _i3++) {
      if (states[_i3].handlers) {
        solutions.push(states[_i3]);
      }
    }

    states = sortSolutions(solutions);

    var state = solutions[0];
    if (state && state.handlers) {
      if (isSlashDropped && state.regex.source.slice(-5) === '(.+)$') {
        normalizedPath = normalizedPath + '/';
      }

      return findHandler(state, normalizedPath, queryParams);
    }

    return undefined;
  };

  return RouteRecognizer;
}();

var RecognizeResults = function RecognizeResults(queryParams) {
  

  this.splice = Array.prototype.splice;
  this.slice = Array.prototype.slice;
  this.push = Array.prototype.push;
  this.length = 0;
  this.queryParams = queryParams || {};
};

function parse(route, names, types, caseSensitive) {
  var normalizedRoute = route;
  if (route.charAt(0) === '/') {
    normalizedRoute = route.substr(1);
  }

  var results = [];

  var splitRoute = normalizedRoute.split('/');
  for (var i = 0, ii = splitRoute.length; i < ii; ++i) {
    var segment = splitRoute[i];
    var match = segment.match(/^:([^\/]+)$/);
    if (match) {
      results.push(new DynamicSegment(match[1]));
      names.push(match[1]);
      types.dynamics++;
      continue;
    }

    match = segment.match(/^\*([^\/]+)$/);
    if (match) {
      results.push(new StarSegment(match[1]));
      names.push(match[1]);
      types.stars++;
    } else if (segment === '') {
      results.push(new EpsilonSegment());
    } else {
      results.push(new StaticSegment(segment, caseSensitive));
      types.statics++;
    }
  }

  return results;
}

function sortSolutions(states) {
  return states.sort(function (a, b) {
    if (a.types.stars !== b.types.stars) {
      return a.types.stars - b.types.stars;
    }

    if (a.types.stars) {
      if (a.types.statics !== b.types.statics) {
        return b.types.statics - a.types.statics;
      }
      if (a.types.dynamics !== b.types.dynamics) {
        return b.types.dynamics - a.types.dynamics;
      }
    }

    if (a.types.dynamics !== b.types.dynamics) {
      return a.types.dynamics - b.types.dynamics;
    }

    if (a.types.statics !== b.types.statics) {
      return b.types.statics - a.types.statics;
    }

    return 0;
  });
}

function recognizeChar(states, ch) {
  var nextStates = [];

  for (var i = 0, l = states.length; i < l; i++) {
    var state = states[i];
    nextStates.push.apply(nextStates, state.match(ch));
  }

  return nextStates;
}

function findHandler(state, path, queryParams) {
  var handlers = state.handlers;
  var regex = state.regex;
  var captures = path.match(regex);
  var currentCapture = 1;
  var result = new RecognizeResults(queryParams);

  for (var i = 0, l = handlers.length; i < l; i++) {
    var _handler = handlers[i];
    var _names = _handler.names;
    var _params = {};

    for (var j = 0, m = _names.length; j < m; j++) {
      _params[_names[j]] = captures[currentCapture++];
    }

    result.push({ handler: _handler.handler, params: _params, isDynamic: !!_names.length });
  }

  return result;
}

function addSegment(currentState, segment) {
  var state = currentState;
  segment.eachChar(function (ch) {
    state = state.put(ch);
  });

  return state;
}

/***/ },
/* 28 */
/***/ function(module, exports) {

"use strict";
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var AuthFilterValueConverter = exports.AuthFilterValueConverter = function () {
  function AuthFilterValueConverter() {
    _classCallCheck(this, AuthFilterValueConverter);
  }

  AuthFilterValueConverter.prototype.toView = function toView(routes, isAuthenticated) {
    return routes.filter(function (r) {
      return r.config.auth === undefined || r.config.auth === isAuthenticated;
    });
  };

  return AuthFilterValueConverter;
}();

/***/ },
/* 29 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Storage = undefined;

var _dec, _class;

var _aureliaDependencyInjection = __webpack_require__(0);

var _baseConfig = __webpack_require__(10);

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Storage = exports.Storage = (_dec = (0, _aureliaDependencyInjection.inject)(_baseConfig.BaseConfig), _dec(_class = function () {
  function Storage(config) {
    _classCallCheck(this, Storage);

    this.config = config.current;
    this.storage = this._getStorage(this.config.storage);
  }

  Storage.prototype.get = function get(key) {
    return this.storage.getItem(key);
  };

  Storage.prototype.set = function set(key, value) {
    return this.storage.setItem(key, value);
  };

  Storage.prototype.remove = function remove(key) {
    return this.storage.removeItem(key);
  };

  Storage.prototype._getStorage = function _getStorage(type) {
    if (type === 'localStorage') {
      if ('localStorage' in window && window.localStorage !== null) return localStorage;
      throw new Error('Local Storage is disabled or unavailable.');
    } else if (type === 'sessionStorage') {
      if ('sessionStorage' in window && window.sessionStorage !== null) return sessionStorage;
      throw new Error('Session Storage is disabled or unavailable.');
    }

    throw new Error('Invalid storage type specified: ' + type);
  };

  return Storage;
}()) || _class);

/***/ },
/* 30 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.aureliaHideClassName = undefined;
exports.injectAureliaHideStyleAtHead = injectAureliaHideStyleAtHead;
exports.injectAureliaHideStyleAtBoundary = injectAureliaHideStyleAtBoundary;

var _aureliaPal = __webpack_require__(2);

var aureliaHideClassName = exports.aureliaHideClassName = 'aurelia-hide';

var aureliaHideClass = '.' + aureliaHideClassName + ' { display:none !important; }';

function injectAureliaHideStyleAtHead() {
  _aureliaPal.DOM.injectStyles(aureliaHideClass);
}

function injectAureliaHideStyleAtBoundary(domBoundary) {
  if (_aureliaPal.FEATURE.shadowDOM && domBoundary && !domBoundary.hasAureliaHideStyle) {
    domBoundary.hasAureliaHideStyle = true;
    _aureliaPal.DOM.injectStyles(aureliaHideClass, domBoundary);
  }
}

/***/ },
/* 31 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.TwoWayBindingBehavior = exports.OneWayBindingBehavior = exports.OneTimeBindingBehavior = undefined;

var _dec, _class, _dec2, _class2, _dec3, _class3;

var _aureliaBinding = __webpack_require__(4);

var _aureliaMetadata = __webpack_require__(6);



var modeBindingBehavior = {
  bind: function bind(binding, source, lookupFunctions) {
    binding.originalMode = binding.mode;
    binding.mode = this.mode;
  },
  unbind: function unbind(binding, source) {
    binding.mode = binding.originalMode;
    binding.originalMode = null;
  }
};

var OneTimeBindingBehavior = exports.OneTimeBindingBehavior = (_dec = (0, _aureliaMetadata.mixin)(modeBindingBehavior), _dec(_class = function OneTimeBindingBehavior() {
  

  this.mode = _aureliaBinding.bindingMode.oneTime;
}) || _class);
var OneWayBindingBehavior = exports.OneWayBindingBehavior = (_dec2 = (0, _aureliaMetadata.mixin)(modeBindingBehavior), _dec2(_class2 = function OneWayBindingBehavior() {
  

  this.mode = _aureliaBinding.bindingMode.oneWay;
}) || _class2);
var TwoWayBindingBehavior = exports.TwoWayBindingBehavior = (_dec3 = (0, _aureliaMetadata.mixin)(modeBindingBehavior), _dec3(_class3 = function TwoWayBindingBehavior() {
  

  this.mode = _aureliaBinding.bindingMode.twoWay;
}) || _class3);

/***/ },
/* 32 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Compose = undefined;

var _dec, _dec2, _class, _desc, _value, _class2, _descriptor, _descriptor2, _descriptor3;

var _aureliaDependencyInjection = __webpack_require__(0);

var _aureliaTaskQueue = __webpack_require__(11);

var _aureliaTemplating = __webpack_require__(3);

var _aureliaPal = __webpack_require__(2);

function _initDefineProp(target, property, descriptor, context) {
  if (!descriptor) return;
  Object.defineProperty(target, property, {
    enumerable: descriptor.enumerable,
    configurable: descriptor.configurable,
    writable: descriptor.writable,
    value: descriptor.initializer ? descriptor.initializer.call(context) : void 0
  });
}



function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {
  var desc = {};
  Object['ke' + 'ys'](descriptor).forEach(function (key) {
    desc[key] = descriptor[key];
  });
  desc.enumerable = !!desc.enumerable;
  desc.configurable = !!desc.configurable;

  if ('value' in desc || desc.initializer) {
    desc.writable = true;
  }

  desc = decorators.slice().reverse().reduce(function (desc, decorator) {
    return decorator(target, property, desc) || desc;
  }, desc);

  if (context && desc.initializer !== void 0) {
    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;
    desc.initializer = undefined;
  }

  if (desc.initializer === void 0) {
    Object['define' + 'Property'](target, property, desc);
    desc = null;
  }

  return desc;
}

function _initializerWarningHelper(descriptor, context) {
  throw new Error('Decorating class property failed. Please ensure that transform-class-properties is enabled.');
}

var Compose = exports.Compose = (_dec = (0, _aureliaTemplating.customElement)('compose'), _dec2 = (0, _aureliaDependencyInjection.inject)(_aureliaPal.DOM.Element, _aureliaDependencyInjection.Container, _aureliaTemplating.CompositionEngine, _aureliaTemplating.ViewSlot, _aureliaTemplating.ViewResources, _aureliaTaskQueue.TaskQueue), _dec(_class = (0, _aureliaTemplating.noView)(_class = _dec2(_class = (_class2 = function () {
  function Compose(element, container, compositionEngine, viewSlot, viewResources, taskQueue) {
    

    _initDefineProp(this, 'model', _descriptor, this);

    _initDefineProp(this, 'view', _descriptor2, this);

    _initDefineProp(this, 'viewModel', _descriptor3, this);

    this.element = element;
    this.container = container;
    this.compositionEngine = compositionEngine;
    this.viewSlot = viewSlot;
    this.viewResources = viewResources;
    this.taskQueue = taskQueue;
    this.currentController = null;
    this.currentViewModel = null;
  }

  Compose.prototype.created = function created(owningView) {
    this.owningView = owningView;
  };

  Compose.prototype.bind = function bind(bindingContext, overrideContext) {
    this.bindingContext = bindingContext;
    this.overrideContext = overrideContext;
    processInstruction(this, createInstruction(this, {
      view: this.view,
      viewModel: this.viewModel,
      model: this.model
    }));
  };

  Compose.prototype.unbind = function unbind(bindingContext, overrideContext) {
    this.bindingContext = null;
    this.overrideContext = null;
    var returnToCache = true;
    var skipAnimation = true;
    this.viewSlot.removeAll(returnToCache, skipAnimation);
  };

  Compose.prototype.modelChanged = function modelChanged(newValue, oldValue) {
    var _this = this;

    if (this.currentInstruction) {
      this.currentInstruction.model = newValue;
      return;
    }

    this.taskQueue.queueMicroTask(function () {
      if (_this.currentInstruction) {
        _this.currentInstruction.model = newValue;
        return;
      }

      var vm = _this.currentViewModel;

      if (vm && typeof vm.activate === 'function') {
        vm.activate(newValue);
      }
    });
  };

  Compose.prototype.viewChanged = function viewChanged(newValue, oldValue) {
    var _this2 = this;

    var instruction = createInstruction(this, {
      view: newValue,
      viewModel: this.currentViewModel || this.viewModel,
      model: this.model
    });

    if (this.currentInstruction) {
      this.currentInstruction = instruction;
      return;
    }

    this.currentInstruction = instruction;
    this.taskQueue.queueMicroTask(function () {
      return processInstruction(_this2, _this2.currentInstruction);
    });
  };

  Compose.prototype.viewModelChanged = function viewModelChanged(newValue, oldValue) {
    var _this3 = this;

    var instruction = createInstruction(this, {
      viewModel: newValue,
      view: this.view,
      model: this.model
    });

    if (this.currentInstruction) {
      this.currentInstruction = instruction;
      return;
    }

    this.currentInstruction = instruction;
    this.taskQueue.queueMicroTask(function () {
      return processInstruction(_this3, _this3.currentInstruction);
    });
  };

  return Compose;
}(), (_descriptor = _applyDecoratedDescriptor(_class2.prototype, 'model', [_aureliaTemplating.bindable], {
  enumerable: true,
  initializer: null
}), _descriptor2 = _applyDecoratedDescriptor(_class2.prototype, 'view', [_aureliaTemplating.bindable], {
  enumerable: true,
  initializer: null
}), _descriptor3 = _applyDecoratedDescriptor(_class2.prototype, 'viewModel', [_aureliaTemplating.bindable], {
  enumerable: true,
  initializer: null
})), _class2)) || _class) || _class) || _class);


function createInstruction(composer, instruction) {
  return Object.assign(instruction, {
    bindingContext: composer.bindingContext,
    overrideContext: composer.overrideContext,
    owningView: composer.owningView,
    container: composer.container,
    viewSlot: composer.viewSlot,
    viewResources: composer.viewResources,
    currentController: composer.currentController,
    host: composer.element
  });
}

function processInstruction(composer, instruction) {
  composer.currentInstruction = null;
  composer.compositionEngine.compose(instruction).then(function (controller) {
    composer.currentController = controller;
    composer.currentViewModel = controller ? controller.viewModel : null;
  });
}

/***/ },
/* 33 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.DebounceBindingBehavior = undefined;

var _aureliaBinding = __webpack_require__(4);



function debounce(newValue) {
  var _this = this;

  var state = this.debounceState;
  if (state.immediate) {
    state.immediate = false;
    this.debouncedMethod(newValue);
    return;
  }
  clearTimeout(state.timeoutId);
  state.timeoutId = setTimeout(function () {
    return _this.debouncedMethod(newValue);
  }, state.delay);
}

var DebounceBindingBehavior = exports.DebounceBindingBehavior = function () {
  function DebounceBindingBehavior() {
    
  }

  DebounceBindingBehavior.prototype.bind = function bind(binding, source) {
    var delay = arguments.length <= 2 || arguments[2] === undefined ? 200 : arguments[2];

    var methodToDebounce = 'updateTarget';
    if (binding.callSource) {
      methodToDebounce = 'callSource';
    } else if (binding.updateSource && binding.mode === _aureliaBinding.bindingMode.twoWay) {
        methodToDebounce = 'updateSource';
      }

    binding.debouncedMethod = binding[methodToDebounce];
    binding.debouncedMethod.originalName = methodToDebounce;

    binding[methodToDebounce] = debounce;

    binding.debounceState = {
      delay: delay,
      timeoutId: null,
      immediate: methodToDebounce === 'updateTarget' };
  };

  DebounceBindingBehavior.prototype.unbind = function unbind(binding, source) {
    var methodToRestore = binding.debouncedMethod.originalName;
    binding[methodToRestore] = binding.debouncedMethod;
    binding.debouncedMethod = null;
    clearTimeout(binding.debounceState.timeoutId);
    binding.debounceState = null;
  };

  return DebounceBindingBehavior;
}();

/***/ },
/* 34 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Focus = undefined;

var _dec, _dec2, _class;

var _aureliaTemplating = __webpack_require__(3);

var _aureliaBinding = __webpack_require__(4);

var _aureliaDependencyInjection = __webpack_require__(0);

var _aureliaTaskQueue = __webpack_require__(11);

var _aureliaPal = __webpack_require__(2);



var Focus = exports.Focus = (_dec = (0, _aureliaTemplating.customAttribute)('focus', _aureliaBinding.bindingMode.twoWay), _dec2 = (0, _aureliaDependencyInjection.inject)(_aureliaPal.DOM.Element, _aureliaTaskQueue.TaskQueue), _dec(_class = _dec2(_class = function () {
  function Focus(element, taskQueue) {
    var _this = this;

    

    this.element = element;
    this.taskQueue = taskQueue;
    this.isAttached = false;
    this.needsApply = false;

    this.focusListener = function (e) {
      _this.value = true;
    };
    this.blurListener = function (e) {
      if (_aureliaPal.DOM.activeElement !== _this.element) {
        _this.value = false;
      }
    };
  }

  Focus.prototype.valueChanged = function valueChanged(newValue) {
    if (this.isAttached) {
      this._apply();
    } else {
      this.needsApply = true;
    }
  };

  Focus.prototype._apply = function _apply() {
    var _this2 = this;

    if (this.value) {
      this.taskQueue.queueMicroTask(function () {
        if (_this2.value) {
          _this2.element.focus();
        }
      });
    } else {
      this.element.blur();
    }
  };

  Focus.prototype.attached = function attached() {
    this.isAttached = true;
    if (this.needsApply) {
      this.needsApply = false;
      this._apply();
    }
    this.element.addEventListener('focus', this.focusListener);
    this.element.addEventListener('blur', this.blurListener);
  };

  Focus.prototype.detached = function detached() {
    this.isAttached = false;
    this.element.removeEventListener('focus', this.focusListener);
    this.element.removeEventListener('blur', this.blurListener);
  };

  return Focus;
}()) || _class) || _class);

/***/ },
/* 35 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Hide = undefined;

var _dec, _dec2, _class;

var _aureliaDependencyInjection = __webpack_require__(0);

var _aureliaTemplating = __webpack_require__(3);

var _aureliaPal = __webpack_require__(2);

var _aureliaHideStyle = __webpack_require__(30);



var Hide = exports.Hide = (_dec = (0, _aureliaTemplating.customAttribute)('hide'), _dec2 = (0, _aureliaDependencyInjection.inject)(_aureliaPal.DOM.Element, _aureliaTemplating.Animator, _aureliaDependencyInjection.Optional.of(_aureliaPal.DOM.boundary, true)), _dec(_class = _dec2(_class = function () {
  function Hide(element, animator, domBoundary) {
    

    this.element = element;
    this.animator = animator;
    this.domBoundary = domBoundary;
  }

  Hide.prototype.created = function created() {
    (0, _aureliaHideStyle.injectAureliaHideStyleAtBoundary)(this.domBoundary);
  };

  Hide.prototype.valueChanged = function valueChanged(newValue) {
    if (newValue) {
      this.animator.addClass(this.element, _aureliaHideStyle.aureliaHideClassName);
    } else {
      this.animator.removeClass(this.element, _aureliaHideStyle.aureliaHideClassName);
    }
  };

  Hide.prototype.bind = function bind(bindingContext) {
    this.valueChanged(this.value);
  };

  return Hide;
}()) || _class) || _class);

/***/ },
/* 36 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.If = undefined;

var _dec, _dec2, _class;

var _aureliaTemplating = __webpack_require__(3);

var _aureliaDependencyInjection = __webpack_require__(0);



var If = exports.If = (_dec = (0, _aureliaTemplating.customAttribute)('if'), _dec2 = (0, _aureliaDependencyInjection.inject)(_aureliaTemplating.BoundViewFactory, _aureliaTemplating.ViewSlot), _dec(_class = (0, _aureliaTemplating.templateController)(_class = _dec2(_class = function () {
  function If(viewFactory, viewSlot) {
    

    this.viewFactory = viewFactory;
    this.viewSlot = viewSlot;
    this.showing = false;
    this.view = null;
    this.bindingContext = null;
    this.overrideContext = null;
  }

  If.prototype.bind = function bind(bindingContext, overrideContext) {
    this.bindingContext = bindingContext;
    this.overrideContext = overrideContext;
    this.valueChanged(this.value);
  };

  If.prototype.valueChanged = function valueChanged(newValue) {
    var _this = this;

    if (this.__queuedChanges) {
      this.__queuedChanges.push(newValue);
      return;
    }

    var maybePromise = this._runValueChanged(newValue);
    if (maybePromise instanceof Promise) {
      (function () {
        var queuedChanges = _this.__queuedChanges = [];

        var runQueuedChanges = function runQueuedChanges() {
          if (!queuedChanges.length) {
            _this.__queuedChanges = undefined;
            return;
          }

          var nextPromise = _this._runValueChanged(queuedChanges.shift()) || Promise.resolve();
          nextPromise.then(runQueuedChanges);
        };

        maybePromise.then(runQueuedChanges);
      })();
    }
  };

  If.prototype._runValueChanged = function _runValueChanged(newValue) {
    var _this2 = this;

    if (!newValue) {
      var viewOrPromise = void 0;
      if (this.view !== null && this.showing) {
        viewOrPromise = this.viewSlot.remove(this.view);
        if (viewOrPromise instanceof Promise) {
          viewOrPromise.then(function () {
            return _this2.view.unbind();
          });
        } else {
          this.view.unbind();
        }
      }

      this.showing = false;
      return viewOrPromise;
    }

    if (this.view === null) {
      this.view = this.viewFactory.create();
    }

    if (!this.view.isBound) {
      this.view.bind(this.bindingContext, this.overrideContext);
    }

    if (!this.showing) {
      this.showing = true;
      return this.viewSlot.add(this.view);
    }

    return undefined;
  };

  If.prototype.unbind = function unbind() {
    if (this.view === null) {
      return;
    }

    this.view.unbind();

    if (!this.viewFactory.isCaching) {
      return;
    }

    if (this.showing) {
      this.showing = false;
      this.viewSlot.remove(this.view, true, true);
    }
    this.view.returnToCache();
    this.view = null;
  };

  return If;
}()) || _class) || _class) || _class);
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))

/***/ },
/* 37 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Repeat = undefined;

var _dec, _dec2, _class, _desc, _value, _class2, _descriptor, _descriptor2, _descriptor3, _descriptor4;

var _aureliaDependencyInjection = __webpack_require__(0);

var _aureliaBinding = __webpack_require__(4);

var _aureliaTemplating = __webpack_require__(3);

var _repeatStrategyLocator = __webpack_require__(64);

var _repeatUtilities = __webpack_require__(13);

var _analyzeViewFactory = __webpack_require__(57);

var _abstractRepeater = __webpack_require__(56);

function _initDefineProp(target, property, descriptor, context) {
  if (!descriptor) return;
  Object.defineProperty(target, property, {
    enumerable: descriptor.enumerable,
    configurable: descriptor.configurable,
    writable: descriptor.writable,
    value: descriptor.initializer ? descriptor.initializer.call(context) : void 0
  });
}



function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {
  var desc = {};
  Object['ke' + 'ys'](descriptor).forEach(function (key) {
    desc[key] = descriptor[key];
  });
  desc.enumerable = !!desc.enumerable;
  desc.configurable = !!desc.configurable;

  if ('value' in desc || desc.initializer) {
    desc.writable = true;
  }

  desc = decorators.slice().reverse().reduce(function (desc, decorator) {
    return decorator(target, property, desc) || desc;
  }, desc);

  if (context && desc.initializer !== void 0) {
    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;
    desc.initializer = undefined;
  }

  if (desc.initializer === void 0) {
    Object['define' + 'Property'](target, property, desc);
    desc = null;
  }

  return desc;
}

function _initializerWarningHelper(descriptor, context) {
  throw new Error('Decorating class property failed. Please ensure that transform-class-properties is enabled.');
}

var Repeat = exports.Repeat = (_dec = (0, _aureliaTemplating.customAttribute)('repeat'), _dec2 = (0, _aureliaDependencyInjection.inject)(_aureliaTemplating.BoundViewFactory, _aureliaTemplating.TargetInstruction, _aureliaTemplating.ViewSlot, _aureliaTemplating.ViewResources, _aureliaBinding.ObserverLocator, _repeatStrategyLocator.RepeatStrategyLocator), _dec(_class = (0, _aureliaTemplating.templateController)(_class = _dec2(_class = (_class2 = function (_AbstractRepeater) {
  _inherits(Repeat, _AbstractRepeater);

  function Repeat(viewFactory, instruction, viewSlot, viewResources, observerLocator, strategyLocator) {
    

    var _this = _possibleConstructorReturn(this, _AbstractRepeater.call(this, {
      local: 'item',
      viewsRequireLifecycle: (0, _analyzeViewFactory.viewsRequireLifecycle)(viewFactory)
    }));

    _initDefineProp(_this, 'items', _descriptor, _this);

    _initDefineProp(_this, 'local', _descriptor2, _this);

    _initDefineProp(_this, 'key', _descriptor3, _this);

    _initDefineProp(_this, 'value', _descriptor4, _this);

    _this.viewFactory = viewFactory;
    _this.instruction = instruction;
    _this.viewSlot = viewSlot;
    _this.lookupFunctions = viewResources.lookupFunctions;
    _this.observerLocator = observerLocator;
    _this.key = 'key';
    _this.value = 'value';
    _this.strategyLocator = strategyLocator;
    _this.ignoreMutation = false;
    _this.sourceExpression = (0, _repeatUtilities.getItemsSourceExpression)(_this.instruction, 'repeat.for');
    _this.isOneTime = (0, _repeatUtilities.isOneTime)(_this.sourceExpression);
    _this.viewsRequireLifecycle = (0, _analyzeViewFactory.viewsRequireLifecycle)(viewFactory);
    return _this;
  }

  Repeat.prototype.call = function call(context, changes) {
    this[context](this.items, changes);
  };

  Repeat.prototype.bind = function bind(bindingContext, overrideContext) {
    this.scope = { bindingContext: bindingContext, overrideContext: overrideContext };
    this.matcherBinding = this._captureAndRemoveMatcherBinding();
    this.itemsChanged();
  };

  Repeat.prototype.unbind = function unbind() {
    this.scope = null;
    this.items = null;
    this.matcherBinding = null;
    this.viewSlot.removeAll(true);
    this._unsubscribeCollection();
  };

  Repeat.prototype._unsubscribeCollection = function _unsubscribeCollection() {
    if (this.collectionObserver) {
      this.collectionObserver.unsubscribe(this.callContext, this);
      this.collectionObserver = null;
      this.callContext = null;
    }
  };

  Repeat.prototype.itemsChanged = function itemsChanged() {
    this._unsubscribeCollection();

    if (!this.scope) {
      return;
    }

    var items = this.items;
    this.strategy = this.strategyLocator.getStrategy(items);
    if (!this.strategy) {
      throw new Error('Value for \'' + this.sourceExpression + '\' is non-repeatable');
    }

    if (!this.isOneTime && !this._observeInnerCollection()) {
      this._observeCollection();
    }
    this.strategy.instanceChanged(this, items);
  };

  Repeat.prototype._getInnerCollection = function _getInnerCollection() {
    var expression = (0, _repeatUtilities.unwrapExpression)(this.sourceExpression);
    if (!expression) {
      return null;
    }
    return expression.evaluate(this.scope, null);
  };

  Repeat.prototype.handleCollectionMutated = function handleCollectionMutated(collection, changes) {
    if (!this.collectionObserver) {
      return;
    }
    this.strategy.instanceMutated(this, collection, changes);
  };

  Repeat.prototype.handleInnerCollectionMutated = function handleInnerCollectionMutated(collection, changes) {
    var _this2 = this;

    if (!this.collectionObserver) {
      return;
    }

    if (this.ignoreMutation) {
      return;
    }
    this.ignoreMutation = true;
    var newItems = this.sourceExpression.evaluate(this.scope, this.lookupFunctions);
    this.observerLocator.taskQueue.queueMicroTask(function () {
      return _this2.ignoreMutation = false;
    });

    if (newItems === this.items) {
      this.itemsChanged();
    } else {
      this.items = newItems;
    }
  };

  Repeat.prototype._observeInnerCollection = function _observeInnerCollection() {
    var items = this._getInnerCollection();
    var strategy = this.strategyLocator.getStrategy(items);
    if (!strategy) {
      return false;
    }
    this.collectionObserver = strategy.getCollectionObserver(this.observerLocator, items);
    if (!this.collectionObserver) {
      return false;
    }
    this.callContext = 'handleInnerCollectionMutated';
    this.collectionObserver.subscribe(this.callContext, this);
    return true;
  };

  Repeat.prototype._observeCollection = function _observeCollection() {
    var items = this.items;
    this.collectionObserver = this.strategy.getCollectionObserver(this.observerLocator, items);
    if (this.collectionObserver) {
      this.callContext = 'handleCollectionMutated';
      this.collectionObserver.subscribe(this.callContext, this);
    }
  };

  Repeat.prototype._captureAndRemoveMatcherBinding = function _captureAndRemoveMatcherBinding() {
    if (this.viewFactory.viewFactory) {
      var instructions = this.viewFactory.viewFactory.instructions;
      var instructionIds = Object.keys(instructions);
      for (var i = 0; i < instructionIds.length; i++) {
        var expressions = instructions[instructionIds[i]].expressions;
        if (expressions) {
          for (var ii = 0; i < expressions.length; i++) {
            if (expressions[ii].targetProperty === 'matcher') {
              var matcherBinding = expressions[ii];
              expressions.splice(ii, 1);
              return matcherBinding;
            }
          }
        }
      }
    }

    return undefined;
  };

  Repeat.prototype.viewCount = function viewCount() {
    return this.viewSlot.children.length;
  };

  Repeat.prototype.views = function views() {
    return this.viewSlot.children;
  };

  Repeat.prototype.view = function view(index) {
    return this.viewSlot.children[index];
  };

  Repeat.prototype.matcher = function matcher() {
    return this.matcherBinding ? this.matcherBinding.sourceExpression.evaluate(this.scope, this.matcherBinding.lookupFunctions) : null;
  };

  Repeat.prototype.addView = function addView(bindingContext, overrideContext) {
    var view = this.viewFactory.create();
    view.bind(bindingContext, overrideContext);
    this.viewSlot.add(view);
  };

  Repeat.prototype.insertView = function insertView(index, bindingContext, overrideContext) {
    var view = this.viewFactory.create();
    view.bind(bindingContext, overrideContext);
    this.viewSlot.insert(index, view);
  };

  Repeat.prototype.moveView = function moveView(sourceIndex, targetIndex) {
    this.viewSlot.move(sourceIndex, targetIndex);
  };

  Repeat.prototype.removeAllViews = function removeAllViews(returnToCache, skipAnimation) {
    return this.viewSlot.removeAll(returnToCache, skipAnimation);
  };

  Repeat.prototype.removeViews = function removeViews(viewsToRemove, returnToCache, skipAnimation) {
    return this.viewSlot.removeMany(viewsToRemove, returnToCache, skipAnimation);
  };

  Repeat.prototype.removeView = function removeView(index, returnToCache, skipAnimation) {
    return this.viewSlot.removeAt(index, returnToCache, skipAnimation);
  };

  Repeat.prototype.updateBindings = function updateBindings(view) {
    var j = view.bindings.length;
    while (j--) {
      (0, _repeatUtilities.updateOneTimeBinding)(view.bindings[j]);
    }
    j = view.controllers.length;
    while (j--) {
      var k = view.controllers[j].boundProperties.length;
      while (k--) {
        var binding = view.controllers[j].boundProperties[k].binding;
        (0, _repeatUtilities.updateOneTimeBinding)(binding);
      }
    }
  };

  return Repeat;
}(_abstractRepeater.AbstractRepeater), (_descriptor = _applyDecoratedDescriptor(_class2.prototype, 'items', [_aureliaTemplating.bindable], {
  enumerable: true,
  initializer: null
}), _descriptor2 = _applyDecoratedDescriptor(_class2.prototype, 'local', [_aureliaTemplating.bindable], {
  enumerable: true,
  initializer: null
}), _descriptor3 = _applyDecoratedDescriptor(_class2.prototype, 'key', [_aureliaTemplating.bindable], {
  enumerable: true,
  initializer: null
}), _descriptor4 = _applyDecoratedDescriptor(_class2.prototype, 'value', [_aureliaTemplating.bindable], {
  enumerable: true,
  initializer: null
})), _class2)) || _class) || _class) || _class);

/***/ },
/* 38 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Replaceable = undefined;

var _dec, _dec2, _class;

var _aureliaDependencyInjection = __webpack_require__(0);

var _aureliaTemplating = __webpack_require__(3);



var Replaceable = exports.Replaceable = (_dec = (0, _aureliaTemplating.customAttribute)('replaceable'), _dec2 = (0, _aureliaDependencyInjection.inject)(_aureliaTemplating.BoundViewFactory, _aureliaTemplating.ViewSlot), _dec(_class = (0, _aureliaTemplating.templateController)(_class = _dec2(_class = function () {
  function Replaceable(viewFactory, viewSlot) {
    

    this.viewFactory = viewFactory;
    this.viewSlot = viewSlot;
    this.view = null;
  }

  Replaceable.prototype.bind = function bind(bindingContext, overrideContext) {
    if (this.view === null) {
      this.view = this.viewFactory.create();
      this.viewSlot.add(this.view);
    }

    this.view.bind(bindingContext, overrideContext);
  };

  Replaceable.prototype.unbind = function unbind() {
    this.view.unbind();
  };

  return Replaceable;
}()) || _class) || _class) || _class);

/***/ },
/* 39 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SanitizeHTMLValueConverter = undefined;

var _dec, _dec2, _class;

var _aureliaBinding = __webpack_require__(4);

var _aureliaDependencyInjection = __webpack_require__(0);

var _htmlSanitizer = __webpack_require__(60);



var SanitizeHTMLValueConverter = exports.SanitizeHTMLValueConverter = (_dec = (0, _aureliaBinding.valueConverter)('sanitizeHTML'), _dec2 = (0, _aureliaDependencyInjection.inject)(_htmlSanitizer.HTMLSanitizer), _dec(_class = _dec2(_class = function () {
  function SanitizeHTMLValueConverter(sanitizer) {
    

    this.sanitizer = sanitizer;
  }

  SanitizeHTMLValueConverter.prototype.toView = function toView(untrustedMarkup) {
    if (untrustedMarkup === null || untrustedMarkup === undefined) {
      return null;
    }

    return this.sanitizer.sanitize(untrustedMarkup);
  };

  return SanitizeHTMLValueConverter;
}()) || _class) || _class);

/***/ },
/* 40 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Show = undefined;

var _dec, _dec2, _class;

var _aureliaDependencyInjection = __webpack_require__(0);

var _aureliaTemplating = __webpack_require__(3);

var _aureliaPal = __webpack_require__(2);

var _aureliaHideStyle = __webpack_require__(30);



var Show = exports.Show = (_dec = (0, _aureliaTemplating.customAttribute)('show'), _dec2 = (0, _aureliaDependencyInjection.inject)(_aureliaPal.DOM.Element, _aureliaTemplating.Animator, _aureliaDependencyInjection.Optional.of(_aureliaPal.DOM.boundary, true)), _dec(_class = _dec2(_class = function () {
  function Show(element, animator, domBoundary) {
    

    this.element = element;
    this.animator = animator;
    this.domBoundary = domBoundary;
  }

  Show.prototype.created = function created() {
    (0, _aureliaHideStyle.injectAureliaHideStyleAtBoundary)(this.domBoundary);
  };

  Show.prototype.valueChanged = function valueChanged(newValue) {
    if (newValue) {
      this.animator.removeClass(this.element, _aureliaHideStyle.aureliaHideClassName);
    } else {
      this.animator.addClass(this.element, _aureliaHideStyle.aureliaHideClassName);
    }
  };

  Show.prototype.bind = function bind(bindingContext) {
    this.valueChanged(this.value);
  };

  return Show;
}()) || _class) || _class);

/***/ },
/* 41 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SignalBindingBehavior = undefined;

var _bindingSignaler = __webpack_require__(59);



var SignalBindingBehavior = exports.SignalBindingBehavior = function () {
  SignalBindingBehavior.inject = function inject() {
    return [_bindingSignaler.BindingSignaler];
  };

  function SignalBindingBehavior(bindingSignaler) {
    

    this.signals = bindingSignaler.signals;
  }

  SignalBindingBehavior.prototype.bind = function bind(binding, source) {
    if (!binding.updateTarget) {
      throw new Error('Only property bindings and string interpolation bindings can be signaled.  Trigger, delegate and call bindings cannot be signaled.');
    }
    if (arguments.length === 3) {
      var name = arguments[2];
      var bindings = this.signals[name] || (this.signals[name] = []);
      bindings.push(binding);
      binding.signalName = name;
    } else if (arguments.length > 3) {
      var names = Array.prototype.slice.call(arguments, 2);
      var i = names.length;
      while (i--) {
        var _name = names[i];
        var _bindings = this.signals[_name] || (this.signals[_name] = []);
        _bindings.push(binding);
      }
      binding.signalName = names;
    } else {
      throw new Error('Signal name is required.');
    }
  };

  SignalBindingBehavior.prototype.unbind = function unbind(binding, source) {
    var name = binding.signalName;
    binding.signalName = null;
    if (Array.isArray(name)) {
      var names = name;
      var i = names.length;
      while (i--) {
        var n = names[i];
        var bindings = this.signals[n];
        bindings.splice(bindings.indexOf(binding), 1);
      }
    } else {
      var _bindings2 = this.signals[name];
      _bindings2.splice(_bindings2.indexOf(binding), 1);
    }
  };

  return SignalBindingBehavior;
}();

/***/ },
/* 42 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ThrottleBindingBehavior = undefined;

var _aureliaBinding = __webpack_require__(4);



function throttle(newValue) {
  var _this = this;

  var state = this.throttleState;
  var elapsed = +new Date() - state.last;
  if (elapsed >= state.delay) {
    clearTimeout(state.timeoutId);
    state.timeoutId = null;
    state.last = +new Date();
    this.throttledMethod(newValue);
    return;
  }
  state.newValue = newValue;
  if (state.timeoutId === null) {
    state.timeoutId = setTimeout(function () {
      state.timeoutId = null;
      state.last = +new Date();
      _this.throttledMethod(state.newValue);
    }, state.delay - elapsed);
  }
}

var ThrottleBindingBehavior = exports.ThrottleBindingBehavior = function () {
  function ThrottleBindingBehavior() {
    
  }

  ThrottleBindingBehavior.prototype.bind = function bind(binding, source) {
    var delay = arguments.length <= 2 || arguments[2] === undefined ? 200 : arguments[2];

    var methodToThrottle = 'updateTarget';
    if (binding.callSource) {
      methodToThrottle = 'callSource';
    } else if (binding.updateSource && binding.mode === _aureliaBinding.bindingMode.twoWay) {
        methodToThrottle = 'updateSource';
      }

    binding.throttledMethod = binding[methodToThrottle];
    binding.throttledMethod.originalName = methodToThrottle;

    binding[methodToThrottle] = throttle;

    binding.throttleState = {
      delay: delay,
      last: 0,
      timeoutId: null
    };
  };

  ThrottleBindingBehavior.prototype.unbind = function unbind(binding, source) {
    var methodToRestore = binding.throttledMethod.originalName;
    binding[methodToRestore] = binding.throttledMethod;
    binding.throttledMethod = null;
    clearTimeout(binding.throttleState.timeoutId);
    binding.throttleState = null;
  };

  return ThrottleBindingBehavior;
}();

/***/ },
/* 43 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.UpdateTriggerBindingBehavior = undefined;

var _class, _temp;

var _aureliaBinding = __webpack_require__(4);



var eventNamesRequired = 'The updateTrigger binding behavior requires at least one event name argument: eg <input value.bind="firstName & updateTrigger:\'blur\'">';
var notApplicableMessage = 'The updateTrigger binding behavior can only be applied to two-way bindings on input/select elements.';

var UpdateTriggerBindingBehavior = exports.UpdateTriggerBindingBehavior = (_temp = _class = function () {
  function UpdateTriggerBindingBehavior(eventManager) {
    

    this.eventManager = eventManager;
  }

  UpdateTriggerBindingBehavior.prototype.bind = function bind(binding, source) {
    for (var _len = arguments.length, events = Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {
      events[_key - 2] = arguments[_key];
    }

    if (events.length === 0) {
      throw new Error(eventNamesRequired);
    }
    if (binding.mode !== _aureliaBinding.bindingMode.twoWay) {
      throw new Error(notApplicableMessage);
    }

    var targetObserver = binding.observerLocator.getObserver(binding.target, binding.targetProperty);
    if (!targetObserver.handler) {
      throw new Error(notApplicableMessage);
    }
    binding.targetObserver = targetObserver;

    targetObserver.originalHandler = binding.targetObserver.handler;

    var handler = this.eventManager.createElementHandler(events);
    targetObserver.handler = handler;
  };

  UpdateTriggerBindingBehavior.prototype.unbind = function unbind(binding, source) {
    binding.targetObserver.handler = binding.targetObserver.originalHandler;
    binding.targetObserver.originalHandler = null;
  };

  return UpdateTriggerBindingBehavior;
}(), _class.inject = [_aureliaBinding.EventManager], _temp);

/***/ },
/* 44 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.With = undefined;

var _dec, _dec2, _class;

var _aureliaDependencyInjection = __webpack_require__(0);

var _aureliaTemplating = __webpack_require__(3);

var _aureliaBinding = __webpack_require__(4);



var With = exports.With = (_dec = (0, _aureliaTemplating.customAttribute)('with'), _dec2 = (0, _aureliaDependencyInjection.inject)(_aureliaTemplating.BoundViewFactory, _aureliaTemplating.ViewSlot), _dec(_class = (0, _aureliaTemplating.templateController)(_class = _dec2(_class = function () {
  function With(viewFactory, viewSlot) {
    

    this.viewFactory = viewFactory;
    this.viewSlot = viewSlot;
    this.parentOverrideContext = null;
    this.view = null;
  }

  With.prototype.bind = function bind(bindingContext, overrideContext) {
    this.parentOverrideContext = overrideContext;
    this.valueChanged(this.value);
  };

  With.prototype.valueChanged = function valueChanged(newValue) {
    var overrideContext = (0, _aureliaBinding.createOverrideContext)(newValue, this.parentOverrideContext);
    if (!this.view) {
      this.view = this.viewFactory.create();
      this.view.bind(newValue, overrideContext);
      this.viewSlot.add(this.view);
    } else {
      this.view.bind(newValue, overrideContext);
    }
  };

  With.prototype.unbind = function unbind() {
    this.parentOverrideContext = null;

    if (this.view) {
      this.view.unbind();
    }
  };

  return With;
}()) || _class) || _class) || _class);

/***/ },
/* 45 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.RouteHref = undefined;

var _dec, _dec2, _dec3, _dec4, _dec5, _class;

var _aureliaTemplating = __webpack_require__(3);

var _aureliaDependencyInjection = __webpack_require__(0);

var _aureliaRouter = __webpack_require__(9);

var _aureliaPal = __webpack_require__(2);

var _aureliaLogging = __webpack_require__(7);

var LogManager = _interopRequireWildcard(_aureliaLogging);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }



var logger = LogManager.getLogger('route-href');

var RouteHref = exports.RouteHref = (_dec = (0, _aureliaTemplating.customAttribute)('route-href'), _dec2 = (0, _aureliaTemplating.bindable)({ name: 'route', changeHandler: 'processChange' }), _dec3 = (0, _aureliaTemplating.bindable)({ name: 'params', changeHandler: 'processChange' }), _dec4 = (0, _aureliaTemplating.bindable)({ name: 'attribute', defaultValue: 'href' }), _dec5 = (0, _aureliaDependencyInjection.inject)(_aureliaRouter.Router, _aureliaPal.DOM.Element), _dec(_class = _dec2(_class = _dec3(_class = _dec4(_class = _dec5(_class = function () {
  function RouteHref(router, element) {
    

    this.router = router;
    this.element = element;
  }

  RouteHref.prototype.bind = function bind() {
    this.isActive = true;
    this.processChange();
  };

  RouteHref.prototype.unbind = function unbind() {
    this.isActive = false;
  };

  RouteHref.prototype.attributeChanged = function attributeChanged(value, previous) {
    if (previous) {
      this.element.removeAttribute(previous);
    }

    this.processChange();
  };

  RouteHref.prototype.processChange = function processChange() {
    var _this = this;

    return this.router.ensureConfigured().then(function () {
      if (!_this.isActive) {
        return null;
      }

      var href = _this.router.generate(_this.route, _this.params);
      _this.element.setAttribute(_this.attribute, href);
      return null;
    }).catch(function (reason) {
      logger.error(reason);
    });
  };

  return RouteHref;
}()) || _class) || _class) || _class) || _class) || _class);

/***/ },
/* 46 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.RouterView = undefined;

var _dec, _dec2, _class, _desc, _value, _class2, _descriptor, _descriptor2, _descriptor3, _descriptor4;

var _aureliaDependencyInjection = __webpack_require__(0);

var _aureliaTemplating = __webpack_require__(3);

var _aureliaRouter = __webpack_require__(9);

var _aureliaMetadata = __webpack_require__(6);

var _aureliaPal = __webpack_require__(2);

function _initDefineProp(target, property, descriptor, context) {
  if (!descriptor) return;
  Object.defineProperty(target, property, {
    enumerable: descriptor.enumerable,
    configurable: descriptor.configurable,
    writable: descriptor.writable,
    value: descriptor.initializer ? descriptor.initializer.call(context) : void 0
  });
}

function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {
  var desc = {};
  Object['ke' + 'ys'](descriptor).forEach(function (key) {
    desc[key] = descriptor[key];
  });
  desc.enumerable = !!desc.enumerable;
  desc.configurable = !!desc.configurable;

  if ('value' in desc || desc.initializer) {
    desc.writable = true;
  }

  desc = decorators.slice().reverse().reduce(function (desc, decorator) {
    return decorator(target, property, desc) || desc;
  }, desc);

  if (context && desc.initializer !== void 0) {
    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;
    desc.initializer = undefined;
  }

  if (desc.initializer === void 0) {
    Object['define' + 'Property'](target, property, desc);
    desc = null;
  }

  return desc;
}

function _initializerWarningHelper(descriptor, context) {
  throw new Error('Decorating class property failed. Please ensure that transform-class-properties is enabled.');
}



var SwapStrategies = function () {
  function SwapStrategies() {
    
  }

  SwapStrategies.prototype.before = function before(viewSlot, previousView, callback) {
    var promise = Promise.resolve(callback());

    if (previousView !== undefined) {
      return promise.then(function () {
        return viewSlot.remove(previousView, true);
      });
    }

    return promise;
  };

  SwapStrategies.prototype.with = function _with(viewSlot, previousView, callback) {
    var promise = Promise.resolve(callback());

    if (previousView !== undefined) {
      return Promise.all([viewSlot.remove(previousView, true), promise]);
    }

    return promise;
  };

  SwapStrategies.prototype.after = function after(viewSlot, previousView, callback) {
    return Promise.resolve(viewSlot.removeAll(true)).then(callback);
  };

  return SwapStrategies;
}();

var swapStrategies = new SwapStrategies();

var RouterView = exports.RouterView = (_dec = (0, _aureliaTemplating.customElement)('router-view'), _dec2 = (0, _aureliaDependencyInjection.inject)(_aureliaPal.DOM.Element, _aureliaDependencyInjection.Container, _aureliaTemplating.ViewSlot, _aureliaRouter.Router, _aureliaTemplating.ViewLocator, _aureliaTemplating.CompositionTransaction, _aureliaTemplating.CompositionEngine), _dec(_class = (0, _aureliaTemplating.noView)(_class = _dec2(_class = (_class2 = function () {
  function RouterView(element, container, viewSlot, router, viewLocator, compositionTransaction, compositionEngine) {
    

    _initDefineProp(this, 'swapOrder', _descriptor, this);

    _initDefineProp(this, 'layoutView', _descriptor2, this);

    _initDefineProp(this, 'layoutViewModel', _descriptor3, this);

    _initDefineProp(this, 'layoutModel', _descriptor4, this);

    this.element = element;
    this.container = container;
    this.viewSlot = viewSlot;
    this.router = router;
    this.viewLocator = viewLocator;
    this.compositionTransaction = compositionTransaction;
    this.compositionEngine = compositionEngine;
    this.router.registerViewPort(this, this.element.getAttribute('name'));

    if (!('initialComposition' in compositionTransaction)) {
      compositionTransaction.initialComposition = true;
      this.compositionTransactionNotifier = compositionTransaction.enlist();
    }
  }

  RouterView.prototype.created = function created(owningView) {
    this.owningView = owningView;
  };

  RouterView.prototype.bind = function bind(bindingContext, overrideContext) {
    this.container.viewModel = bindingContext;
    this.overrideContext = overrideContext;
  };

  RouterView.prototype.process = function process(viewPortInstruction, waitToSwap) {
    var _this = this;

    var component = viewPortInstruction.component;
    var childContainer = component.childContainer;
    var viewModel = component.viewModel;
    var viewModelResource = component.viewModelResource;
    var metadata = viewModelResource.metadata;
    var config = component.router.currentInstruction.config;
    var viewPort = config.viewPorts ? config.viewPorts[viewPortInstruction.name] : {};

    var layoutInstruction = {
      viewModel: viewPort.layoutViewModel || config.layoutViewModel || this.layoutViewModel,
      view: viewPort.layoutView || config.layoutView || this.layoutView,
      model: viewPort.layoutModel || config.layoutModel || this.layoutModel,
      router: viewPortInstruction.component.router,
      childContainer: childContainer,
      viewSlot: this.viewSlot
    };

    var viewStrategy = this.viewLocator.getViewStrategy(component.view || viewModel);
    if (viewStrategy && component.view) {
      viewStrategy.makeRelativeTo(_aureliaMetadata.Origin.get(component.router.container.viewModel.constructor).moduleId);
    }

    return metadata.load(childContainer, viewModelResource.value, null, viewStrategy, true).then(function (viewFactory) {
      if (!_this.compositionTransactionNotifier) {
        _this.compositionTransactionOwnershipToken = _this.compositionTransaction.tryCapture();
      }

      if (layoutInstruction.viewModel || layoutInstruction.view) {
        viewPortInstruction.layoutInstruction = layoutInstruction;
      }

      viewPortInstruction.controller = metadata.create(childContainer, _aureliaTemplating.BehaviorInstruction.dynamic(_this.element, viewModel, viewFactory));

      if (waitToSwap) {
        return;
      }

      _this.swap(viewPortInstruction);
    });
  };

  RouterView.prototype.swap = function swap(viewPortInstruction) {
    var _this2 = this;

    var work = function work() {
      var previousView = _this2.view;
      var swapStrategy = void 0;
      var viewSlot = _this2.viewSlot;
      var layoutInstruction = viewPortInstruction.layoutInstruction;

      swapStrategy = _this2.swapOrder in swapStrategies ? swapStrategies[_this2.swapOrder] : swapStrategies.after;

      swapStrategy(viewSlot, previousView, function () {
        var waitForView = void 0;

        if (layoutInstruction) {
          if (!layoutInstruction.viewModel) {
            layoutInstruction.viewModel = {};
          }

          waitForView = _this2.compositionEngine.createController(layoutInstruction).then(function (layout) {
            _aureliaTemplating.ShadowDOM.distributeView(viewPortInstruction.controller.view, layout.slots || layout.view.slots);
            return layout.view || layout;
          });
        } else {
          waitForView = Promise.resolve(viewPortInstruction.controller.view);
        }

        return waitForView.then(function (newView) {
          _this2.view = newView;
          return viewSlot.add(newView);
        }).then(function () {
          _this2._notify();
        });
      });
    };

    viewPortInstruction.controller.automate(this.overrideContext, this.owningView);

    if (this.compositionTransactionOwnershipToken) {
      return this.compositionTransactionOwnershipToken.waitForCompositionComplete().then(function () {
        _this2.compositionTransactionOwnershipToken = null;
        return work();
      });
    }

    return work();
  };

  RouterView.prototype._notify = function _notify() {
    if (this.compositionTransactionNotifier) {
      this.compositionTransactionNotifier.done();
      this.compositionTransactionNotifier = null;
    }
  };

  return RouterView;
}(), (_descriptor = _applyDecoratedDescriptor(_class2.prototype, 'swapOrder', [_aureliaTemplating.bindable], {
  enumerable: true,
  initializer: null
}), _descriptor2 = _applyDecoratedDescriptor(_class2.prototype, 'layoutView', [_aureliaTemplating.bindable], {
  enumerable: true,
  initializer: null
}), _descriptor3 = _applyDecoratedDescriptor(_class2.prototype, 'layoutViewModel', [_aureliaTemplating.bindable], {
  enumerable: true,
  initializer: null
}), _descriptor4 = _applyDecoratedDescriptor(_class2.prototype, 'layoutModel', [_aureliaTemplating.bindable], {
  enumerable: true,
  initializer: null
})), _class2)) || _class) || _class) || _class);
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))

/***/ },
/* 47 */,
/* 48 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.BrowserHistory = exports.DefaultLinkHandler = exports.LinkHandler = undefined;

var _class, _temp;

exports.configure = configure;

var _aureliaPal = __webpack_require__(2);

var _aureliaHistory = __webpack_require__(25);

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }



var LinkHandler = exports.LinkHandler = function () {
  function LinkHandler() {
    
  }

  LinkHandler.prototype.activate = function activate(history) {};

  LinkHandler.prototype.deactivate = function deactivate() {};

  return LinkHandler;
}();

var DefaultLinkHandler = exports.DefaultLinkHandler = function (_LinkHandler) {
  _inherits(DefaultLinkHandler, _LinkHandler);

  function DefaultLinkHandler() {
    

    var _this = _possibleConstructorReturn(this, _LinkHandler.call(this));

    _this.handler = function (e) {
      var _DefaultLinkHandler$g = DefaultLinkHandler.getEventInfo(e);

      var shouldHandleEvent = _DefaultLinkHandler$g.shouldHandleEvent;
      var href = _DefaultLinkHandler$g.href;


      if (shouldHandleEvent) {
        e.preventDefault();
        _this.history.navigate(href);
      }
    };
    return _this;
  }

  DefaultLinkHandler.prototype.activate = function activate(history) {
    if (history._hasPushState) {
      this.history = history;
      _aureliaPal.DOM.addEventListener('click', this.handler, true);
    }
  };

  DefaultLinkHandler.prototype.deactivate = function deactivate() {
    _aureliaPal.DOM.removeEventListener('click', this.handler);
  };

  DefaultLinkHandler.getEventInfo = function getEventInfo(event) {
    var info = {
      shouldHandleEvent: false,
      href: null,
      anchor: null
    };

    var target = DefaultLinkHandler.findClosestAnchor(event.target);
    if (!target || !DefaultLinkHandler.targetIsThisWindow(target)) {
      return info;
    }

    if (event.altKey || event.ctrlKey || event.metaKey || event.shiftKey) {
      return info;
    }

    var href = target.getAttribute('href');
    info.anchor = target;
    info.href = href;

    var leftButtonClicked = event.which === 1;
    var isRelative = href && !(href.charAt(0) === '#' || /^[a-z]+:/i.test(href));

    info.shouldHandleEvent = leftButtonClicked && isRelative;
    return info;
  };

  DefaultLinkHandler.findClosestAnchor = function findClosestAnchor(el) {
    while (el) {
      if (el.tagName === 'A') {
        return el;
      }

      el = el.parentNode;
    }
  };

  DefaultLinkHandler.targetIsThisWindow = function targetIsThisWindow(target) {
    var targetWindow = target.getAttribute('target');
    var win = _aureliaPal.PLATFORM.global;

    return !targetWindow || targetWindow === win.name || targetWindow === '_self' || targetWindow === 'top' && win === win.top;
  };

  return DefaultLinkHandler;
}(LinkHandler);

function configure(config) {
  config.singleton(_aureliaHistory.History, BrowserHistory);
  config.transient(LinkHandler, DefaultLinkHandler);
}

var BrowserHistory = exports.BrowserHistory = (_temp = _class = function (_History) {
  _inherits(BrowserHistory, _History);

  function BrowserHistory(linkHandler) {
    

    var _this2 = _possibleConstructorReturn(this, _History.call(this));

    _this2._isActive = false;
    _this2._checkUrlCallback = _this2._checkUrl.bind(_this2);

    _this2.location = _aureliaPal.PLATFORM.location;
    _this2.history = _aureliaPal.PLATFORM.history;
    _this2.linkHandler = linkHandler;
    return _this2;
  }

  BrowserHistory.prototype.activate = function activate(options) {
    if (this._isActive) {
      throw new Error('History has already been activated.');
    }

    var wantsPushState = !!options.pushState;

    this._isActive = true;
    this.options = Object.assign({}, { root: '/' }, this.options, options);

    this.root = ('/' + this.options.root + '/').replace(rootStripper, '/');

    this._wantsHashChange = this.options.hashChange !== false;
    this._hasPushState = !!(this.options.pushState && this.history && this.history.pushState);

    var eventName = void 0;
    if (this._hasPushState) {
      eventName = 'popstate';
    } else if (this._wantsHashChange) {
      eventName = 'hashchange';
    }

    _aureliaPal.PLATFORM.addEventListener(eventName, this._checkUrlCallback);

    if (this._wantsHashChange && wantsPushState) {
      var loc = this.location;
      var atRoot = loc.pathname.replace(/[^\/]$/, '$&/') === this.root;

      if (!this._hasPushState && !atRoot) {
        this.fragment = this._getFragment(null, true);
        this.location.replace(this.root + this.location.search + '#' + this.fragment);

        return true;
      } else if (this._hasPushState && atRoot && loc.hash) {
          this.fragment = this._getHash().replace(routeStripper, '');
          this.history.replaceState({}, _aureliaPal.DOM.title, this.root + this.fragment + loc.search);
        }
    }

    if (!this.fragment) {
      this.fragment = this._getFragment();
    }

    this.linkHandler.activate(this);

    if (!this.options.silent) {
      return this._loadUrl();
    }
  };

  BrowserHistory.prototype.deactivate = function deactivate() {
    _aureliaPal.PLATFORM.removeEventListener('popstate', this._checkUrlCallback);
    _aureliaPal.PLATFORM.removeEventListener('hashchange', this._checkUrlCallback);
    this._isActive = false;
    this.linkHandler.deactivate();
  };

  BrowserHistory.prototype.getAbsoluteRoot = function getAbsoluteRoot() {
    var origin = createOrigin(this.location.protocol, this.location.hostname, this.location.port);
    return '' + origin + this.root;
  };

  BrowserHistory.prototype.navigate = function navigate(fragment) {
    var _ref = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];

    var _ref$trigger = _ref.trigger;
    var trigger = _ref$trigger === undefined ? true : _ref$trigger;
    var _ref$replace = _ref.replace;
    var replace = _ref$replace === undefined ? false : _ref$replace;

    if (fragment && absoluteUrl.test(fragment)) {
      this.location.href = fragment;
      return true;
    }

    if (!this._isActive) {
      return false;
    }

    fragment = this._getFragment(fragment || '');

    if (this.fragment === fragment && !replace) {
      return false;
    }

    this.fragment = fragment;

    var url = this.root + fragment;

    if (fragment === '' && url !== '/') {
      url = url.slice(0, -1);
    }

    if (this._hasPushState) {
      url = url.replace('//', '/');
      this.history[replace ? 'replaceState' : 'pushState']({}, _aureliaPal.DOM.title, url);
    } else if (this._wantsHashChange) {
      updateHash(this.location, fragment, replace);
    } else {
      return this.location.assign(url);
    }

    if (trigger) {
      return this._loadUrl(fragment);
    }
  };

  BrowserHistory.prototype.navigateBack = function navigateBack() {
    this.history.back();
  };

  BrowserHistory.prototype.setTitle = function setTitle(title) {
    _aureliaPal.DOM.title = title;
  };

  BrowserHistory.prototype._getHash = function _getHash() {
    return this.location.hash.substr(1);
  };

  BrowserHistory.prototype._getFragment = function _getFragment(fragment, forcePushState) {
    var root = void 0;

    if (!fragment) {
      if (this._hasPushState || !this._wantsHashChange || forcePushState) {
        fragment = this.location.pathname + this.location.search;
        root = this.root.replace(trailingSlash, '');
        if (!fragment.indexOf(root)) {
          fragment = fragment.substr(root.length);
        }
      } else {
        fragment = this._getHash();
      }
    }

    return '/' + fragment.replace(routeStripper, '');
  };

  BrowserHistory.prototype._checkUrl = function _checkUrl() {
    var current = this._getFragment();
    if (current !== this.fragment) {
      this._loadUrl();
    }
  };

  BrowserHistory.prototype._loadUrl = function _loadUrl(fragmentOverride) {
    var fragment = this.fragment = this._getFragment(fragmentOverride);

    return this.options.routeHandler ? this.options.routeHandler(fragment) : false;
  };

  return BrowserHistory;
}(_aureliaHistory.History), _class.inject = [LinkHandler], _temp);

var routeStripper = /^#?\/*|\s+$/g;

var rootStripper = /^\/+|\/+$/g;

var trailingSlash = /\/$/;

var absoluteUrl = /^([a-z][a-z0-9+\-.]*:)?\/\//i;

function updateHash(location, fragment, replace) {
  if (replace) {
    var _href = location.href.replace(/(javascript:|#).*$/, '');
    location.replace(_href + '#' + fragment);
  } else {
    location.hash = '#' + fragment;
  }
}

function createOrigin(protocol, hostname, port) {
  return protocol + '//' + hostname + (port ? ':' + port : '');
}

/***/ },
/* 49 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ConsoleAppender = undefined;

var _aureliaLogging = __webpack_require__(7);



var ConsoleAppender = exports.ConsoleAppender = function () {
  function ConsoleAppender() {
    
  }

  ConsoleAppender.prototype.debug = function debug(logger) {
    var _console;

    for (var _len = arguments.length, rest = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
      rest[_key - 1] = arguments[_key];
    }

    (_console = console).debug.apply(_console, ['DEBUG [' + logger.id + ']'].concat(rest));
  };

  ConsoleAppender.prototype.info = function info(logger) {
    var _console2;

    for (var _len2 = arguments.length, rest = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {
      rest[_key2 - 1] = arguments[_key2];
    }

    (_console2 = console).info.apply(_console2, ['INFO [' + logger.id + ']'].concat(rest));
  };

  ConsoleAppender.prototype.warn = function warn(logger) {
    var _console3;

    for (var _len3 = arguments.length, rest = Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {
      rest[_key3 - 1] = arguments[_key3];
    }

    (_console3 = console).warn.apply(_console3, ['WARN [' + logger.id + ']'].concat(rest));
  };

  ConsoleAppender.prototype.error = function error(logger) {
    var _console4;

    for (var _len4 = arguments.length, rest = Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {
      rest[_key4 - 1] = arguments[_key4];
    }

    (_console4 = console).error.apply(_console4, ['ERROR [' + logger.id + ']'].concat(rest));
  };

  return ConsoleAppender;
}();

/***/ },
/* 50 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.TemplatingBindingLanguage = exports.SyntaxInterpreter = exports.ChildInterpolationBinding = exports.InterpolationBinding = exports.InterpolationBindingExpression = exports.AttributeMap = undefined;

var _class, _temp, _dec, _class2, _class3, _temp2, _class4, _temp3;

exports.configure = configure;

var _aureliaLogging = __webpack_require__(7);

var LogManager = _interopRequireWildcard(_aureliaLogging);

var _aureliaBinding = __webpack_require__(4);

var _aureliaTemplating = __webpack_require__(3);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }



var AttributeMap = exports.AttributeMap = (_temp = _class = function () {
  function AttributeMap(svg) {
    

    this.elements = Object.create(null);
    this.allElements = Object.create(null);

    this.svg = svg;

    this.registerUniversal('accesskey', 'accessKey');
    this.registerUniversal('contenteditable', 'contentEditable');
    this.registerUniversal('tabindex', 'tabIndex');
    this.registerUniversal('textcontent', 'textContent');
    this.registerUniversal('innerhtml', 'innerHTML');
    this.registerUniversal('scrolltop', 'scrollTop');
    this.registerUniversal('scrollleft', 'scrollLeft');
    this.registerUniversal('readonly', 'readOnly');

    this.register('label', 'for', 'htmlFor');

    this.register('input', 'maxlength', 'maxLength');
    this.register('input', 'minlength', 'minLength');
    this.register('input', 'formaction', 'formAction');
    this.register('input', 'formenctype', 'formEncType');
    this.register('input', 'formmethod', 'formMethod');
    this.register('input', 'formnovalidate', 'formNoValidate');
    this.register('input', 'formtarget', 'formTarget');

    this.register('textarea', 'maxlength', 'maxLength');

    this.register('td', 'rowspan', 'rowSpan');
    this.register('td', 'colspan', 'colSpan');
    this.register('th', 'rowspan', 'rowSpan');
    this.register('th', 'colspan', 'colSpan');
  }

  AttributeMap.prototype.register = function register(elementName, attributeName, propertyName) {
    elementName = elementName.toLowerCase();
    attributeName = attributeName.toLowerCase();
    var element = this.elements[elementName] = this.elements[elementName] || Object.create(null);
    element[attributeName] = propertyName;
  };

  AttributeMap.prototype.registerUniversal = function registerUniversal(attributeName, propertyName) {
    attributeName = attributeName.toLowerCase();
    this.allElements[attributeName] = propertyName;
  };

  AttributeMap.prototype.map = function map(elementName, attributeName) {
    if (this.svg.isStandardSvgAttribute(elementName, attributeName)) {
      return attributeName;
    }
    elementName = elementName.toLowerCase();
    attributeName = attributeName.toLowerCase();
    var element = this.elements[elementName];
    if (element !== undefined && attributeName in element) {
      return element[attributeName];
    }
    if (attributeName in this.allElements) {
      return this.allElements[attributeName];
    }

    if (/(^data-)|(^aria-)|:/.test(attributeName)) {
      return attributeName;
    }
    return (0, _aureliaBinding.camelCase)(attributeName);
  };

  return AttributeMap;
}(), _class.inject = [_aureliaBinding.SVGAnalyzer], _temp);

var InterpolationBindingExpression = exports.InterpolationBindingExpression = function () {
  function InterpolationBindingExpression(observerLocator, targetProperty, parts, mode, lookupFunctions, attribute) {
    

    this.observerLocator = observerLocator;
    this.targetProperty = targetProperty;
    this.parts = parts;
    this.mode = mode;
    this.lookupFunctions = lookupFunctions;
    this.attribute = this.attrToRemove = attribute;
    this.discrete = false;
  }

  InterpolationBindingExpression.prototype.createBinding = function createBinding(target) {
    if (this.parts.length === 3) {
      return new ChildInterpolationBinding(target, this.observerLocator, this.parts[1], this.mode, this.lookupFunctions, this.targetProperty, this.parts[0], this.parts[2]);
    }
    return new InterpolationBinding(this.observerLocator, this.parts, target, this.targetProperty, this.mode, this.lookupFunctions);
  };

  return InterpolationBindingExpression;
}();

function validateTarget(target, propertyName) {
  if (propertyName === 'style') {
    LogManager.getLogger('templating-binding').info('Internet Explorer does not support interpolation in "style" attributes.  Use the style attribute\'s alias, "css" instead.');
  } else if (target.parentElement && target.parentElement.nodeName === 'TEXTAREA' && propertyName === 'textContent') {
    throw new Error('Interpolation binding cannot be used in the content of a textarea element.  Use <textarea value.bind="expression"></textarea> instead.');
  }
}

var InterpolationBinding = exports.InterpolationBinding = function () {
  function InterpolationBinding(observerLocator, parts, target, targetProperty, mode, lookupFunctions) {
    

    validateTarget(target, targetProperty);
    this.observerLocator = observerLocator;
    this.parts = parts;
    this.target = target;
    this.targetProperty = targetProperty;
    this.targetAccessor = observerLocator.getAccessor(target, targetProperty);
    this.mode = mode;
    this.lookupFunctions = lookupFunctions;
  }

  InterpolationBinding.prototype.interpolate = function interpolate() {
    if (this.isBound) {
      var value = '';
      var parts = this.parts;
      for (var i = 0, ii = parts.length; i < ii; i++) {
        value += i % 2 === 0 ? parts[i] : this['childBinding' + i].value;
      }
      this.targetAccessor.setValue(value, this.target, this.targetProperty);
    }
  };

  InterpolationBinding.prototype.updateOneTimeBindings = function updateOneTimeBindings() {
    for (var i = 1, ii = this.parts.length; i < ii; i += 2) {
      var child = this['childBinding' + i];
      if (child.mode === _aureliaBinding.bindingMode.oneTime) {
        child.call();
      }
    }
  };

  InterpolationBinding.prototype.bind = function bind(source) {
    if (this.isBound) {
      if (this.source === source) {
        return;
      }
      this.unbind();
    }
    this.source = source;

    var parts = this.parts;
    for (var i = 1, ii = parts.length; i < ii; i += 2) {
      var binding = new ChildInterpolationBinding(this, this.observerLocator, parts[i], this.mode, this.lookupFunctions);
      binding.bind(source);
      this['childBinding' + i] = binding;
    }

    this.isBound = true;
    this.interpolate();
  };

  InterpolationBinding.prototype.unbind = function unbind() {
    if (!this.isBound) {
      return;
    }
    this.isBound = false;
    this.source = null;
    var parts = this.parts;
    for (var i = 1, ii = parts.length; i < ii; i += 2) {
      var name = 'childBinding' + i;
      this[name].unbind();
    }
  };

  return InterpolationBinding;
}();

var ChildInterpolationBinding = exports.ChildInterpolationBinding = (_dec = (0, _aureliaBinding.connectable)(), _dec(_class2 = function () {
  function ChildInterpolationBinding(target, observerLocator, sourceExpression, mode, lookupFunctions, targetProperty, left, right) {
    

    if (target instanceof InterpolationBinding) {
      this.parent = target;
    } else {
      validateTarget(target, targetProperty);
      this.target = target;
      this.targetProperty = targetProperty;
      this.targetAccessor = observerLocator.getAccessor(target, targetProperty);
    }
    this.observerLocator = observerLocator;
    this.sourceExpression = sourceExpression;
    this.mode = mode;
    this.lookupFunctions = lookupFunctions;
    this.left = left;
    this.right = right;
  }

  ChildInterpolationBinding.prototype.updateTarget = function updateTarget(value) {
    value = value === null || value === undefined ? '' : value.toString();
    if (value !== this.value) {
      this.value = value;
      if (this.parent) {
        this.parent.interpolate();
      } else {
        this.targetAccessor.setValue(this.left + value + this.right, this.target, this.targetProperty);
      }
    }
  };

  ChildInterpolationBinding.prototype.call = function call() {
    if (!this.isBound) {
      return;
    }

    this.rawValue = this.sourceExpression.evaluate(this.source, this.lookupFunctions);
    this.updateTarget(this.rawValue);

    if (this.mode !== _aureliaBinding.bindingMode.oneTime) {
      this._version++;
      this.sourceExpression.connect(this, this.source);
      if (this.rawValue instanceof Array) {
        this.observeArray(this.rawValue);
      }
      this.unobserve(false);
    }
  };

  ChildInterpolationBinding.prototype.bind = function bind(source) {
    if (this.isBound) {
      if (this.source === source) {
        return;
      }
      this.unbind();
    }
    this.isBound = true;
    this.source = source;

    var sourceExpression = this.sourceExpression;
    if (sourceExpression.bind) {
      sourceExpression.bind(this, source, this.lookupFunctions);
    }

    this.rawValue = sourceExpression.evaluate(source, this.lookupFunctions);
    this.updateTarget(this.rawValue);

    if (this.mode === _aureliaBinding.bindingMode.oneWay) {
      (0, _aureliaBinding.enqueueBindingConnect)(this);
    }
  };

  ChildInterpolationBinding.prototype.unbind = function unbind() {
    if (!this.isBound) {
      return;
    }
    this.isBound = false;
    var sourceExpression = this.sourceExpression;
    if (sourceExpression.unbind) {
      sourceExpression.unbind(this, this.source);
    }
    this.source = null;
    this.value = null;
    this.rawValue = null;
    this.unobserve(true);
  };

  ChildInterpolationBinding.prototype.connect = function connect(evaluate) {
    if (!this.isBound) {
      return;
    }
    if (evaluate) {
      this.rawValue = this.sourceExpression.evaluate(this.source, this.lookupFunctions);
      this.updateTarget(this.rawValue);
    }
    this.sourceExpression.connect(this, this.source);
    if (this.rawValue instanceof Array) {
      this.observeArray(this.rawValue);
    }
  };

  return ChildInterpolationBinding;
}()) || _class2);
var SyntaxInterpreter = exports.SyntaxInterpreter = (_temp2 = _class3 = function () {
  function SyntaxInterpreter(parser, observerLocator, eventManager, attributeMap) {
    

    this.parser = parser;
    this.observerLocator = observerLocator;
    this.eventManager = eventManager;
    this.attributeMap = attributeMap;
  }

  SyntaxInterpreter.prototype.interpret = function interpret(resources, element, info, existingInstruction, context) {
    if (info.command in this) {
      return this[info.command](resources, element, info, existingInstruction, context);
    }

    return this.handleUnknownCommand(resources, element, info, existingInstruction, context);
  };

  SyntaxInterpreter.prototype.handleUnknownCommand = function handleUnknownCommand(resources, element, info, existingInstruction, context) {
    LogManager.getLogger('templating-binding').warn('Unknown binding command.', info);
    return existingInstruction;
  };

  SyntaxInterpreter.prototype.determineDefaultBindingMode = function determineDefaultBindingMode(element, attrName, context) {
    var tagName = element.tagName.toLowerCase();

    if (tagName === 'input' && (attrName === 'value' || attrName === 'files') && element.type !== 'checkbox' && element.type !== 'radio' || tagName === 'input' && attrName === 'checked' && (element.type === 'checkbox' || element.type === 'radio') || (tagName === 'textarea' || tagName === 'select') && attrName === 'value' || (attrName === 'textcontent' || attrName === 'innerhtml') && element.contentEditable === 'true' || attrName === 'scrolltop' || attrName === 'scrollleft') {
      return _aureliaBinding.bindingMode.twoWay;
    }

    if (context && attrName in context.attributes && context.attributes[attrName] && context.attributes[attrName].defaultBindingMode >= _aureliaBinding.bindingMode.oneTime) {
      return context.attributes[attrName].defaultBindingMode;
    }

    return _aureliaBinding.bindingMode.oneWay;
  };

  SyntaxInterpreter.prototype.bind = function bind(resources, element, info, existingInstruction, context) {
    var instruction = existingInstruction || _aureliaTemplating.BehaviorInstruction.attribute(info.attrName);

    instruction.attributes[info.attrName] = new _aureliaBinding.BindingExpression(this.observerLocator, this.attributeMap.map(element.tagName, info.attrName), this.parser.parse(info.attrValue), info.defaultBindingMode || this.determineDefaultBindingMode(element, info.attrName, context), resources.lookupFunctions);

    return instruction;
  };

  SyntaxInterpreter.prototype.trigger = function trigger(resources, element, info) {
    return new _aureliaBinding.ListenerExpression(this.eventManager, info.attrName, this.parser.parse(info.attrValue), false, true, resources.lookupFunctions);
  };

  SyntaxInterpreter.prototype.delegate = function delegate(resources, element, info) {
    return new _aureliaBinding.ListenerExpression(this.eventManager, info.attrName, this.parser.parse(info.attrValue), true, true, resources.lookupFunctions);
  };

  SyntaxInterpreter.prototype.call = function call(resources, element, info, existingInstruction) {
    var instruction = existingInstruction || _aureliaTemplating.BehaviorInstruction.attribute(info.attrName);

    instruction.attributes[info.attrName] = new _aureliaBinding.CallExpression(this.observerLocator, info.attrName, this.parser.parse(info.attrValue), resources.lookupFunctions);

    return instruction;
  };

  SyntaxInterpreter.prototype.options = function options(resources, element, info, existingInstruction, context) {
    var instruction = existingInstruction || _aureliaTemplating.BehaviorInstruction.attribute(info.attrName);
    var attrValue = info.attrValue;
    var language = this.language;
    var name = null;
    var target = '';
    var current = void 0;
    var i = void 0;
    var ii = void 0;
    var inString = false;
    var inEscape = false;

    for (i = 0, ii = attrValue.length; i < ii; ++i) {
      current = attrValue[i];

      if (current === ';' && !inString) {
        info = language.inspectAttribute(resources, '?', name, target.trim());
        language.createAttributeInstruction(resources, element, info, instruction, context);

        if (!instruction.attributes[info.attrName]) {
          instruction.attributes[info.attrName] = info.attrValue;
        }

        target = '';
        name = null;
      } else if (current === ':' && name === null) {
        name = target.trim();
        target = '';
      } else if (current === '\\') {
        target += current;
        inEscape = true;
        continue;
      } else {
        target += current;

        if (name !== null && inEscape === false && current === '\'') {
          inString = !inString;
        }
      }

      inEscape = false;
    }

    if (name !== null) {
      info = language.inspectAttribute(resources, '?', name, target.trim());
      language.createAttributeInstruction(resources, element, info, instruction, context);

      if (!instruction.attributes[info.attrName]) {
        instruction.attributes[info.attrName] = info.attrValue;
      }
    }

    return instruction;
  };

  SyntaxInterpreter.prototype['for'] = function _for(resources, element, info, existingInstruction) {
    var parts = void 0;
    var keyValue = void 0;
    var instruction = void 0;
    var attrValue = void 0;
    var isDestructuring = void 0;

    attrValue = info.attrValue;
    isDestructuring = attrValue.match(/^ *[[].+[\]]/);
    parts = isDestructuring ? attrValue.split('of ') : attrValue.split(' of ');

    if (parts.length !== 2) {
      throw new Error('Incorrect syntax for "for". The form is: "$local of $items" or "[$key, $value] of $items".');
    }

    instruction = existingInstruction || _aureliaTemplating.BehaviorInstruction.attribute(info.attrName);

    if (isDestructuring) {
      keyValue = parts[0].replace(/[[\]]/g, '').replace(/,/g, ' ').replace(/\s+/g, ' ').trim().split(' ');
      instruction.attributes.key = keyValue[0];
      instruction.attributes.value = keyValue[1];
    } else {
      instruction.attributes.local = parts[0];
    }

    instruction.attributes.items = new _aureliaBinding.BindingExpression(this.observerLocator, 'items', this.parser.parse(parts[1]), _aureliaBinding.bindingMode.oneWay, resources.lookupFunctions);

    return instruction;
  };

  SyntaxInterpreter.prototype['two-way'] = function twoWay(resources, element, info, existingInstruction) {
    var instruction = existingInstruction || _aureliaTemplating.BehaviorInstruction.attribute(info.attrName);

    instruction.attributes[info.attrName] = new _aureliaBinding.BindingExpression(this.observerLocator, this.attributeMap.map(element.tagName, info.attrName), this.parser.parse(info.attrValue), _aureliaBinding.bindingMode.twoWay, resources.lookupFunctions);

    return instruction;
  };

  SyntaxInterpreter.prototype['one-way'] = function oneWay(resources, element, info, existingInstruction) {
    var instruction = existingInstruction || _aureliaTemplating.BehaviorInstruction.attribute(info.attrName);

    instruction.attributes[info.attrName] = new _aureliaBinding.BindingExpression(this.observerLocator, this.attributeMap.map(element.tagName, info.attrName), this.parser.parse(info.attrValue), _aureliaBinding.bindingMode.oneWay, resources.lookupFunctions);

    return instruction;
  };

  SyntaxInterpreter.prototype['one-time'] = function oneTime(resources, element, info, existingInstruction) {
    var instruction = existingInstruction || _aureliaTemplating.BehaviorInstruction.attribute(info.attrName);

    instruction.attributes[info.attrName] = new _aureliaBinding.BindingExpression(this.observerLocator, this.attributeMap.map(element.tagName, info.attrName), this.parser.parse(info.attrValue), _aureliaBinding.bindingMode.oneTime, resources.lookupFunctions);

    return instruction;
  };

  return SyntaxInterpreter;
}(), _class3.inject = [_aureliaBinding.Parser, _aureliaBinding.ObserverLocator, _aureliaBinding.EventManager, AttributeMap], _temp2);

var info = {};

var TemplatingBindingLanguage = exports.TemplatingBindingLanguage = (_temp3 = _class4 = function (_BindingLanguage) {
  _inherits(TemplatingBindingLanguage, _BindingLanguage);

  function TemplatingBindingLanguage(parser, observerLocator, syntaxInterpreter, attributeMap) {
    

    var _this = _possibleConstructorReturn(this, _BindingLanguage.call(this));

    _this.parser = parser;
    _this.observerLocator = observerLocator;
    _this.syntaxInterpreter = syntaxInterpreter;
    _this.emptyStringExpression = _this.parser.parse('\'\'');
    syntaxInterpreter.language = _this;
    _this.attributeMap = attributeMap;
    return _this;
  }

  TemplatingBindingLanguage.prototype.inspectAttribute = function inspectAttribute(resources, elementName, attrName, attrValue) {
    var parts = attrName.split('.');

    info.defaultBindingMode = null;

    if (parts.length === 2) {
      info.attrName = parts[0].trim();
      info.attrValue = attrValue;
      info.command = parts[1].trim();

      if (info.command === 'ref') {
        info.expression = new _aureliaBinding.NameExpression(this.parser.parse(attrValue), info.attrName, resources.lookupFunctions);
        info.command = null;
        info.attrName = 'ref';
      } else {
        info.expression = null;
      }
    } else if (attrName === 'ref') {
      info.attrName = attrName;
      info.attrValue = attrValue;
      info.command = null;
      info.expression = new _aureliaBinding.NameExpression(this.parser.parse(attrValue), 'element', resources.lookupFunctions);
    } else {
      info.attrName = attrName;
      info.attrValue = attrValue;
      info.command = null;
      var interpolationParts = this.parseInterpolation(resources, attrValue);
      if (interpolationParts === null) {
        info.expression = null;
      } else {
        info.expression = new InterpolationBindingExpression(this.observerLocator, this.attributeMap.map(elementName, attrName), interpolationParts, _aureliaBinding.bindingMode.oneWay, resources.lookupFunctions, attrName);
      }
    }

    return info;
  };

  TemplatingBindingLanguage.prototype.createAttributeInstruction = function createAttributeInstruction(resources, element, theInfo, existingInstruction, context) {
    var instruction = void 0;

    if (theInfo.expression) {
      if (theInfo.attrName === 'ref') {
        return theInfo.expression;
      }

      instruction = existingInstruction || _aureliaTemplating.BehaviorInstruction.attribute(theInfo.attrName);
      instruction.attributes[theInfo.attrName] = theInfo.expression;
    } else if (theInfo.command) {
      instruction = this.syntaxInterpreter.interpret(resources, element, theInfo, existingInstruction, context);
    }

    return instruction;
  };

  TemplatingBindingLanguage.prototype.inspectTextContent = function inspectTextContent(resources, value) {
    var parts = this.parseInterpolation(resources, value);
    if (parts === null) {
      return null;
    }
    return new InterpolationBindingExpression(this.observerLocator, 'textContent', parts, _aureliaBinding.bindingMode.oneWay, resources.lookupFunctions, 'textContent');
  };

  TemplatingBindingLanguage.prototype.parseInterpolation = function parseInterpolation(resources, value) {
    var i = value.indexOf('${', 0);
    var ii = value.length;
    var char = void 0;
    var pos = 0;
    var open = 0;
    var quote = null;
    var interpolationStart = void 0;
    var parts = void 0;
    var partIndex = 0;

    while (i >= 0 && i < ii - 2) {
      open = 1;
      interpolationStart = i;
      i += 2;

      do {
        char = value[i];
        i++;

        if (char === "'" || char === '"') {
          if (quote === null) {
            quote = char;
          } else if (quote === char) {
            quote = null;
          }
          continue;
        }

        if (char === '\\') {
          i++;
          continue;
        }

        if (quote !== null) {
          continue;
        }

        if (char === '{') {
          open++;
        } else if (char === '}') {
          open--;
        }
      } while (open > 0 && i < ii);

      if (open === 0) {
        parts = parts || [];
        if (value[interpolationStart - 1] === '\\' && value[interpolationStart - 2] !== '\\') {
          parts[partIndex] = value.substring(pos, interpolationStart - 1) + value.substring(interpolationStart, i);
          partIndex++;
          parts[partIndex] = this.emptyStringExpression;
          partIndex++;
        } else {
          parts[partIndex] = value.substring(pos, interpolationStart);
          partIndex++;
          parts[partIndex] = this.parser.parse(value.substring(interpolationStart + 2, i - 1));
          partIndex++;
        }
        pos = i;
        i = value.indexOf('${', i);
      } else {
        break;
      }
    }

    if (partIndex === 0) {
      return null;
    }

    parts[partIndex] = value.substr(pos);
    return parts;
  };

  return TemplatingBindingLanguage;
}(_aureliaTemplating.BindingLanguage), _class4.inject = [_aureliaBinding.Parser, _aureliaBinding.ObserverLocator, SyntaxInterpreter, AttributeMap], _temp3);
function configure(config) {
  config.container.registerSingleton(_aureliaTemplating.BindingLanguage, TemplatingBindingLanguage);
  config.container.registerAlias(_aureliaTemplating.BindingLanguage, TemplatingBindingLanguage);
}

/***/ },
/* 51 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.viewsRequireLifecycle = exports.unwrapExpression = exports.updateOneTimeBinding = exports.isOneTime = exports.getItemsSourceExpression = exports.updateOverrideContext = exports.createFullOverrideContext = exports.NumberRepeatStrategy = exports.SetRepeatStrategy = exports.MapRepeatStrategy = exports.ArrayRepeatStrategy = exports.NullRepeatStrategy = exports.RepeatStrategyLocator = exports.AbstractRepeater = exports.UpdateTriggerBindingBehavior = exports.BindingSignaler = exports.SignalBindingBehavior = exports.DebounceBindingBehavior = exports.ThrottleBindingBehavior = exports.TwoWayBindingBehavior = exports.OneWayBindingBehavior = exports.OneTimeBindingBehavior = exports.configure = exports.Focus = exports.Replaceable = exports.SanitizeHTMLValueConverter = exports.HTMLSanitizer = exports.Hide = exports.Show = exports.Repeat = exports.With = exports.If = exports.Compose = undefined;

var _compose = __webpack_require__(32);

var _if = __webpack_require__(36);

var _with = __webpack_require__(44);

var _repeat = __webpack_require__(37);

var _show = __webpack_require__(40);

var _hide = __webpack_require__(35);

var _sanitizeHtml = __webpack_require__(39);

var _replaceable = __webpack_require__(38);

var _focus = __webpack_require__(34);

var _aureliaTemplating = __webpack_require__(3);

var _cssResource = __webpack_require__(75);

var _htmlSanitizer = __webpack_require__(60);

var _bindingModeBehaviors = __webpack_require__(31);

var _throttleBindingBehavior = __webpack_require__(42);

var _debounceBindingBehavior = __webpack_require__(33);

var _signalBindingBehavior = __webpack_require__(41);

var _bindingSignaler = __webpack_require__(59);

var _updateTriggerBindingBehavior = __webpack_require__(43);

var _abstractRepeater = __webpack_require__(56);

var _repeatStrategyLocator = __webpack_require__(64);

var _htmlResourcePlugin = __webpack_require__(77);

var _nullRepeatStrategy = __webpack_require__(62);

var _arrayRepeatStrategy = __webpack_require__(58);

var _mapRepeatStrategy = __webpack_require__(61);

var _setRepeatStrategy = __webpack_require__(65);

var _numberRepeatStrategy = __webpack_require__(63);

var _repeatUtilities = __webpack_require__(13);

var _analyzeViewFactory = __webpack_require__(57);

var _aureliaHideStyle = __webpack_require__(30);

function configure(config) {
  (0, _aureliaHideStyle.injectAureliaHideStyleAtHead)();

  config.globalResources('./compose', './if', './with', './repeat', './show', './hide', './replaceable', './sanitize-html', './focus', './binding-mode-behaviors', './throttle-binding-behavior', './debounce-binding-behavior', './signal-binding-behavior', './update-trigger-binding-behavior');

  (0, _htmlResourcePlugin.configure)(config);

  var viewEngine = config.container.get(_aureliaTemplating.ViewEngine);
  viewEngine.addResourcePlugin('.css', {
    'fetch': function fetch(address) {
      var _ref;

      return _ref = {}, _ref[address] = (0, _cssResource._createCSSResource)(address), _ref;
    }
  });
}

exports.Compose = _compose.Compose;
exports.If = _if.If;
exports.With = _with.With;
exports.Repeat = _repeat.Repeat;
exports.Show = _show.Show;
exports.Hide = _hide.Hide;
exports.HTMLSanitizer = _htmlSanitizer.HTMLSanitizer;
exports.SanitizeHTMLValueConverter = _sanitizeHtml.SanitizeHTMLValueConverter;
exports.Replaceable = _replaceable.Replaceable;
exports.Focus = _focus.Focus;
exports.configure = configure;
exports.OneTimeBindingBehavior = _bindingModeBehaviors.OneTimeBindingBehavior;
exports.OneWayBindingBehavior = _bindingModeBehaviors.OneWayBindingBehavior;
exports.TwoWayBindingBehavior = _bindingModeBehaviors.TwoWayBindingBehavior;
exports.ThrottleBindingBehavior = _throttleBindingBehavior.ThrottleBindingBehavior;
exports.DebounceBindingBehavior = _debounceBindingBehavior.DebounceBindingBehavior;
exports.SignalBindingBehavior = _signalBindingBehavior.SignalBindingBehavior;
exports.BindingSignaler = _bindingSignaler.BindingSignaler;
exports.UpdateTriggerBindingBehavior = _updateTriggerBindingBehavior.UpdateTriggerBindingBehavior;
exports.AbstractRepeater = _abstractRepeater.AbstractRepeater;
exports.RepeatStrategyLocator = _repeatStrategyLocator.RepeatStrategyLocator;
exports.NullRepeatStrategy = _nullRepeatStrategy.NullRepeatStrategy;
exports.ArrayRepeatStrategy = _arrayRepeatStrategy.ArrayRepeatStrategy;
exports.MapRepeatStrategy = _mapRepeatStrategy.MapRepeatStrategy;
exports.SetRepeatStrategy = _setRepeatStrategy.SetRepeatStrategy;
exports.NumberRepeatStrategy = _numberRepeatStrategy.NumberRepeatStrategy;
exports.createFullOverrideContext = _repeatUtilities.createFullOverrideContext;
exports.updateOverrideContext = _repeatUtilities.updateOverrideContext;
exports.getItemsSourceExpression = _repeatUtilities.getItemsSourceExpression;
exports.isOneTime = _repeatUtilities.isOneTime;
exports.updateOneTimeBinding = _repeatUtilities.updateOneTimeBinding;
exports.unwrapExpression = _repeatUtilities.unwrapExpression;
exports.viewsRequireLifecycle = _analyzeViewFactory.viewsRequireLifecycle;

/***/ },
/* 52 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.configure = exports.RouteHref = exports.RouterView = exports.TemplatingRouteLoader = undefined;

var _aureliaRouter = __webpack_require__(9);

var _routeLoader = __webpack_require__(78);

var _routerView = __webpack_require__(46);

var _routeHref = __webpack_require__(45);

function configure(config) {
  config.singleton(_aureliaRouter.RouteLoader, _routeLoader.TemplatingRouteLoader).singleton(_aureliaRouter.Router, _aureliaRouter.AppRouter).globalResources('./router-view', './route-href');

  config.container.registerAlias(_aureliaRouter.Router, _aureliaRouter.AppRouter);
}

exports.TemplatingRouteLoader = _routeLoader.TemplatingRouteLoader;
exports.RouterView = _routerView.RouterView;
exports.RouteHref = _routeHref.RouteHref;
exports.configure = configure;

/***/ },
/* 53 */,
/* 54 */,
/* 55 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Popup = undefined;

var _dec, _class;

var _authUtilities = __webpack_require__(12);

var _baseConfig = __webpack_require__(10);

var _aureliaDependencyInjection = __webpack_require__(0);

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Popup = exports.Popup = (_dec = (0, _aureliaDependencyInjection.inject)(_baseConfig.BaseConfig), _dec(_class = function () {
  function Popup(config) {
    _classCallCheck(this, Popup);

    this.config = config.current;
    this.popupWindow = null;
    this.polling = null;
    this.url = '';
  }

  Popup.prototype.open = function open(url, windowName, options, redirectUri) {
    this.url = url;
    var optionsString = this.stringifyOptions(this.prepareOptions(options || {}));
    this.popupWindow = window.open(url, windowName, optionsString);
    if (this.popupWindow && this.popupWindow.focus) {
      this.popupWindow.focus();
    }

    return this;
  };

  Popup.prototype.eventListener = function eventListener(redirectUri) {
    var self = this;
    var promise = new Promise(function (resolve, reject) {
      self.popupWindow.addEventListener('loadstart', function (event) {
        if (event.url.indexOf(redirectUri) !== 0) {
          return;
        }

        var parser = document.createElement('a');
        parser.href = event.url;

        if (parser.search || parser.hash) {
          var queryParams = parser.search.substring(1).replace(/\/$/, '');
          var hashParams = parser.hash.substring(1).replace(/\/$/, '');
          var hash = (0, _authUtilities.parseQueryString)(hashParams);
          var qs = (0, _authUtilities.parseQueryString)(queryParams);

          (0, _authUtilities.extend)(qs, hash);

          if (qs.error) {
            reject({
              error: qs.error
            });
          } else {
            resolve(qs);
          }

          self.popupWindow.close();
        }
      });

      popupWindow.addEventListener('exit', function () {
        reject({
          data: 'Provider Popup was closed'
        });
      });

      popupWindow.addEventListener('loaderror', function () {
        deferred.reject({
          data: 'Authorization Failed'
        });
      });
    });
    return promise;
  };

  Popup.prototype.pollPopup = function pollPopup() {
    var _this = this;

    var self = this;
    var promise = new Promise(function (resolve, reject) {
      _this.polling = setInterval(function () {
        try {
          var documentOrigin = document.location.host;
          var popupWindowOrigin = self.popupWindow.location.host;

          if (popupWindowOrigin === documentOrigin && (self.popupWindow.location.search || self.popupWindow.location.hash)) {
            var queryParams = self.popupWindow.location.search.substring(1).replace(/\/$/, '');
            var hashParams = self.popupWindow.location.hash.substring(1).replace(/[\/$]/, '');
            var hash = (0, _authUtilities.parseQueryString)(hashParams);
            var qs = (0, _authUtilities.parseQueryString)(queryParams);

            (0, _authUtilities.extend)(qs, hash);

            if (qs.error) {
              reject({
                error: qs.error
              });
            } else {
              resolve(qs);
            }

            self.popupWindow.close();
            clearInterval(self.polling);
          }
        } catch (error) {}

        if (!self.popupWindow) {
          clearInterval(self.polling);
          reject({
            data: 'Provider Popup Blocked'
          });
        } else if (self.popupWindow.closed) {
          clearInterval(self.polling);
          reject({
            data: 'Problem poll popup'
          });
        }
      }, 35);
    });
    return promise;
  };

  Popup.prototype.prepareOptions = function prepareOptions(options) {
    var width = options.width || 500;
    var height = options.height || 500;
    return (0, _authUtilities.extend)({
      width: width,
      height: height,
      left: window.screenX + (window.outerWidth - width) / 2,
      top: window.screenY + (window.outerHeight - height) / 2.5
    }, options);
  };

  Popup.prototype.stringifyOptions = function stringifyOptions(options) {
    var parts = [];
    (0, _authUtilities.forEach)(options, function (value, key) {
      parts.push(key + '=' + value);
    });
    return parts.join(',');
  };

  return Popup;
}()) || _class);
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))

/***/ },
/* 56 */
/***/ function(module, exports) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});



var AbstractRepeater = exports.AbstractRepeater = function () {
  function AbstractRepeater(options) {
    

    Object.assign(this, {
      local: 'items',
      viewsRequireLifecycle: true
    }, options);
  }

  AbstractRepeater.prototype.viewCount = function viewCount() {
    throw new Error('subclass must implement `viewCount`');
  };

  AbstractRepeater.prototype.views = function views() {
    throw new Error('subclass must implement `views`');
  };

  AbstractRepeater.prototype.view = function view(index) {
    throw new Error('subclass must implement `view`');
  };

  AbstractRepeater.prototype.matcher = function matcher() {
    throw new Error('subclass must implement `matcher`');
  };

  AbstractRepeater.prototype.addView = function addView(bindingContext, overrideContext) {
    throw new Error('subclass must implement `addView`');
  };

  AbstractRepeater.prototype.insertView = function insertView(index, bindingContext, overrideContext) {
    throw new Error('subclass must implement `insertView`');
  };

  AbstractRepeater.prototype.moveView = function moveView(sourceIndex, targetIndex) {
    throw new Error('subclass must implement `moveView`');
  };

  AbstractRepeater.prototype.removeAllViews = function removeAllViews(returnToCache, skipAnimation) {
    throw new Error('subclass must implement `removeAllViews`');
  };

  AbstractRepeater.prototype.removeViews = function removeViews(viewsToRemove, returnToCache, skipAnimation) {
    throw new Error('subclass must implement `removeView`');
  };

  AbstractRepeater.prototype.removeView = function removeView(index, returnToCache, skipAnimation) {
    throw new Error('subclass must implement `removeView`');
  };

  AbstractRepeater.prototype.updateBindings = function updateBindings(view) {
    throw new Error('subclass must implement `updateBindings`');
  };

  return AbstractRepeater;
}();

/***/ },
/* 57 */
/***/ function(module, exports) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.viewsRequireLifecycle = viewsRequireLifecycle;
var lifecycleOptionalBehaviors = exports.lifecycleOptionalBehaviors = ['focus', 'if', 'repeat', 'show', 'with'];

function behaviorRequiresLifecycle(instruction) {
  var t = instruction.type;
  var name = t.elementName !== null ? t.elementName : t.attributeName;
  return lifecycleOptionalBehaviors.indexOf(name) === -1 && (t.handlesAttached || t.handlesBind || t.handlesCreated || t.handlesDetached || t.handlesUnbind) || t.viewFactory && viewsRequireLifecycle(t.viewFactory) || instruction.viewFactory && viewsRequireLifecycle(instruction.viewFactory);
}

function targetRequiresLifecycle(instruction) {
  var behaviors = instruction.behaviorInstructions;
  if (behaviors) {
    var i = behaviors.length;
    while (i--) {
      if (behaviorRequiresLifecycle(behaviors[i])) {
        return true;
      }
    }
  }

  return instruction.viewFactory && viewsRequireLifecycle(instruction.viewFactory);
}

function viewsRequireLifecycle(viewFactory) {
  if ('_viewsRequireLifecycle' in viewFactory) {
    return viewFactory._viewsRequireLifecycle;
  }

  viewFactory._viewsRequireLifecycle = false;

  if (viewFactory.viewFactory) {
    viewFactory._viewsRequireLifecycle = viewsRequireLifecycle(viewFactory.viewFactory);
    return viewFactory._viewsRequireLifecycle;
  }

  if (viewFactory.template.querySelector('.au-animate')) {
    viewFactory._viewsRequireLifecycle = true;
    return true;
  }

  for (var id in viewFactory.instructions) {
    if (targetRequiresLifecycle(viewFactory.instructions[id])) {
      viewFactory._viewsRequireLifecycle = true;
      return true;
    }
  }

  viewFactory._viewsRequireLifecycle = false;
  return false;
}

/***/ },
/* 58 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ArrayRepeatStrategy = undefined;

var _repeatUtilities = __webpack_require__(13);

var _aureliaBinding = __webpack_require__(4);



var ArrayRepeatStrategy = exports.ArrayRepeatStrategy = function () {
  function ArrayRepeatStrategy() {
    
  }

  ArrayRepeatStrategy.prototype.getCollectionObserver = function getCollectionObserver(observerLocator, items) {
    return observerLocator.getArrayObserver(items);
  };

  ArrayRepeatStrategy.prototype.instanceChanged = function instanceChanged(repeat, items) {
    var _this = this;

    var itemsLength = items.length;

    if (!items || itemsLength === 0) {
      repeat.removeAllViews(true, !repeat.viewsRequireLifecycle);
      return;
    }

    var children = repeat.views();
    var viewsLength = children.length;

    if (viewsLength === 0) {
      this._standardProcessInstanceChanged(repeat, items);
      return;
    }

    if (repeat.viewsRequireLifecycle) {
      (function () {
        var childrenSnapshot = children.slice(0);
        var itemNameInBindingContext = repeat.local;
        var matcher = repeat.matcher();

        var itemsPreviouslyInViews = [];
        var viewsToRemove = [];

        for (var index = 0; index < viewsLength; index++) {
          var view = childrenSnapshot[index];
          var oldItem = view.bindingContext[itemNameInBindingContext];

          if ((0, _repeatUtilities.indexOf)(items, oldItem, matcher) === -1) {
            viewsToRemove.push(view);
          } else {
            itemsPreviouslyInViews.push(oldItem);
          }
        }

        var updateViews = void 0;
        var removePromise = void 0;

        if (itemsPreviouslyInViews.length > 0) {
          removePromise = repeat.removeViews(viewsToRemove, true, !repeat.viewsRequireLifecycle);
          updateViews = function updateViews() {
            for (var _index = 0; _index < itemsLength; _index++) {
              var item = items[_index];
              var indexOfView = (0, _repeatUtilities.indexOf)(itemsPreviouslyInViews, item, matcher, _index);
              var _view = void 0;

              if (indexOfView === -1) {
                var overrideContext = (0, _repeatUtilities.createFullOverrideContext)(repeat, items[_index], _index, itemsLength);
                repeat.insertView(_index, overrideContext.bindingContext, overrideContext);

                itemsPreviouslyInViews.splice(_index, 0, undefined);
              } else if (indexOfView === _index) {
                _view = children[indexOfView];
                itemsPreviouslyInViews[indexOfView] = undefined;
              } else {
                _view = children[indexOfView];
                repeat.moveView(indexOfView, _index);
                itemsPreviouslyInViews.splice(indexOfView, 1);
                itemsPreviouslyInViews.splice(_index, 0, undefined);
              }

              if (_view) {
                (0, _repeatUtilities.updateOverrideContext)(_view.overrideContext, _index, itemsLength);
              }
            }

            _this._inPlaceProcessItems(repeat, items);
          };
        } else {
          removePromise = repeat.removeAllViews(true, !repeat.viewsRequireLifecycle);
          updateViews = function updateViews() {
            return _this._standardProcessInstanceChanged(repeat, items);
          };
        }

        if (removePromise instanceof Promise) {
          removePromise.then(updateViews);
        } else {
          updateViews();
        }
      })();
    } else {
      this._inPlaceProcessItems(repeat, items);
    }
  };

  ArrayRepeatStrategy.prototype._standardProcessInstanceChanged = function _standardProcessInstanceChanged(repeat, items) {
    for (var i = 0, ii = items.length; i < ii; i++) {
      var overrideContext = (0, _repeatUtilities.createFullOverrideContext)(repeat, items[i], i, ii);
      repeat.addView(overrideContext.bindingContext, overrideContext);
    }
  };

  ArrayRepeatStrategy.prototype._inPlaceProcessItems = function _inPlaceProcessItems(repeat, items) {
    var itemsLength = items.length;
    var viewsLength = repeat.viewCount();

    while (viewsLength > itemsLength) {
      viewsLength--;
      repeat.removeView(viewsLength, true, !repeat.viewsRequireLifecycle);
    }

    var local = repeat.local;

    for (var i = 0; i < viewsLength; i++) {
      var view = repeat.view(i);
      var last = i === itemsLength - 1;
      var middle = i !== 0 && !last;

      if (view.bindingContext[local] === items[i] && view.overrideContext.$middle === middle && view.overrideContext.$last === last) {
        continue;
      }

      view.bindingContext[local] = items[i];
      view.overrideContext.$middle = middle;
      view.overrideContext.$last = last;
      repeat.updateBindings(view);
    }

    for (var _i = viewsLength; _i < itemsLength; _i++) {
      var overrideContext = (0, _repeatUtilities.createFullOverrideContext)(repeat, items[_i], _i, itemsLength);
      repeat.addView(overrideContext.bindingContext, overrideContext);
    }
  };

  ArrayRepeatStrategy.prototype.instanceMutated = function instanceMutated(repeat, array, splices) {
    var _this2 = this;

    if (repeat.__queuedSplices) {
      for (var i = 0, ii = splices.length; i < ii; ++i) {
        var _splices$i = splices[i];
        var index = _splices$i.index;
        var removed = _splices$i.removed;
        var addedCount = _splices$i.addedCount;

        (0, _aureliaBinding.mergeSplice)(repeat.__queuedSplices, index, removed, addedCount);
      }

      repeat.__array = array.slice(0);
      return;
    }

    var maybePromise = this._runSplices(repeat, array.slice(0), splices);
    if (maybePromise instanceof Promise) {
      (function () {
        var queuedSplices = repeat.__queuedSplices = [];

        var runQueuedSplices = function runQueuedSplices() {
          if (!queuedSplices.length) {
            repeat.__queuedSplices = undefined;
            repeat.__array = undefined;
            return;
          }

          var nextPromise = _this2._runSplices(repeat, repeat.__array, queuedSplices) || Promise.resolve();
          queuedSplices = repeat.__queuedSplices = [];
          nextPromise.then(runQueuedSplices);
        };

        maybePromise.then(runQueuedSplices);
      })();
    }
  };

  ArrayRepeatStrategy.prototype._runSplices = function _runSplices(repeat, array, splices) {
    var _this3 = this;

    var removeDelta = 0;
    var rmPromises = [];

    for (var i = 0, ii = splices.length; i < ii; ++i) {
      var splice = splices[i];
      var removed = splice.removed;

      for (var j = 0, jj = removed.length; j < jj; ++j) {
        var viewOrPromise = repeat.removeView(splice.index + removeDelta + rmPromises.length, true);
        if (viewOrPromise instanceof Promise) {
          rmPromises.push(viewOrPromise);
        }
      }
      removeDelta -= splice.addedCount;
    }

    if (rmPromises.length > 0) {
      return Promise.all(rmPromises).then(function () {
        var spliceIndexLow = _this3._handleAddedSplices(repeat, array, splices);
        (0, _repeatUtilities.updateOverrideContexts)(repeat.views(), spliceIndexLow);
      });
    }

    var spliceIndexLow = this._handleAddedSplices(repeat, array, splices);
    (0, _repeatUtilities.updateOverrideContexts)(repeat.views(), spliceIndexLow);

    return undefined;
  };

  ArrayRepeatStrategy.prototype._handleAddedSplices = function _handleAddedSplices(repeat, array, splices) {
    var spliceIndex = void 0;
    var spliceIndexLow = void 0;
    var arrayLength = array.length;
    for (var i = 0, ii = splices.length; i < ii; ++i) {
      var splice = splices[i];
      var addIndex = spliceIndex = splice.index;
      var end = splice.index + splice.addedCount;

      if (typeof spliceIndexLow === 'undefined' || spliceIndexLow === null || spliceIndexLow > splice.index) {
        spliceIndexLow = spliceIndex;
      }

      for (; addIndex < end; ++addIndex) {
        var overrideContext = (0, _repeatUtilities.createFullOverrideContext)(repeat, array[addIndex], addIndex, arrayLength);
        repeat.insertView(addIndex, overrideContext.bindingContext, overrideContext);
      }
    }

    return spliceIndexLow;
  };

  return ArrayRepeatStrategy;
}();
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))

/***/ },
/* 59 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.BindingSignaler = undefined;

var _aureliaBinding = __webpack_require__(4);



var BindingSignaler = exports.BindingSignaler = function () {
  function BindingSignaler() {
    

    this.signals = {};
  }

  BindingSignaler.prototype.signal = function signal(name) {
    var bindings = this.signals[name];
    if (!bindings) {
      return;
    }
    var i = bindings.length;
    while (i--) {
      bindings[i].call(_aureliaBinding.sourceContext);
    }
  };

  return BindingSignaler;
}();

/***/ },
/* 60 */
/***/ function(module, exports) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});



var SCRIPT_REGEX = /<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi;

var HTMLSanitizer = exports.HTMLSanitizer = function () {
  function HTMLSanitizer() {
    
  }

  HTMLSanitizer.prototype.sanitize = function sanitize(input) {
    return input.replace(SCRIPT_REGEX, '');
  };

  return HTMLSanitizer;
}();

/***/ },
/* 61 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.MapRepeatStrategy = undefined;

var _repeatUtilities = __webpack_require__(13);



var MapRepeatStrategy = exports.MapRepeatStrategy = function () {
  function MapRepeatStrategy() {
    
  }

  MapRepeatStrategy.prototype.getCollectionObserver = function getCollectionObserver(observerLocator, items) {
    return observerLocator.getMapObserver(items);
  };

  MapRepeatStrategy.prototype.instanceChanged = function instanceChanged(repeat, items) {
    var _this = this;

    var removePromise = repeat.removeAllViews(true, !repeat.viewsRequireLifecycle);
    if (removePromise instanceof Promise) {
      removePromise.then(function () {
        return _this._standardProcessItems(repeat, items);
      });
      return;
    }
    this._standardProcessItems(repeat, items);
  };

  MapRepeatStrategy.prototype._standardProcessItems = function _standardProcessItems(repeat, items) {
    var index = 0;
    var overrideContext = void 0;

    items.forEach(function (value, key) {
      overrideContext = (0, _repeatUtilities.createFullOverrideContext)(repeat, value, index, items.size, key);
      repeat.addView(overrideContext.bindingContext, overrideContext);
      ++index;
    });
  };

  MapRepeatStrategy.prototype.instanceMutated = function instanceMutated(repeat, map, records) {
    var key = void 0;
    var i = void 0;
    var ii = void 0;
    var overrideContext = void 0;
    var removeIndex = void 0;
    var record = void 0;
    var rmPromises = [];
    var viewOrPromise = void 0;

    for (i = 0, ii = records.length; i < ii; ++i) {
      record = records[i];
      key = record.key;
      switch (record.type) {
        case 'update':
          removeIndex = this._getViewIndexByKey(repeat, key);
          viewOrPromise = repeat.removeView(removeIndex, true, !repeat.viewsRequireLifecycle);
          if (viewOrPromise instanceof Promise) {
            rmPromises.push(viewOrPromise);
          }
          overrideContext = (0, _repeatUtilities.createFullOverrideContext)(repeat, map.get(key), removeIndex, map.size, key);
          repeat.insertView(removeIndex, overrideContext.bindingContext, overrideContext);
          break;
        case 'add':
          overrideContext = (0, _repeatUtilities.createFullOverrideContext)(repeat, map.get(key), map.size - 1, map.size, key);
          repeat.insertView(map.size - 1, overrideContext.bindingContext, overrideContext);
          break;
        case 'delete':
          if (record.oldValue === undefined) {
            return;
          }
          removeIndex = this._getViewIndexByKey(repeat, key);
          viewOrPromise = repeat.removeView(removeIndex, true, !repeat.viewsRequireLifecycle);
          if (viewOrPromise instanceof Promise) {
            rmPromises.push(viewOrPromise);
          }
          break;
        case 'clear':
          repeat.removeAllViews(true, !repeat.viewsRequireLifecycle);
          break;
        default:
          continue;
      }
    }

    if (rmPromises.length > 0) {
      Promise.all(rmPromises).then(function () {
        (0, _repeatUtilities.updateOverrideContexts)(repeat.views(), 0);
      });
    } else {
      (0, _repeatUtilities.updateOverrideContexts)(repeat.views(), 0);
    }
  };

  MapRepeatStrategy.prototype._getViewIndexByKey = function _getViewIndexByKey(repeat, key) {
    var i = void 0;
    var ii = void 0;
    var child = void 0;

    for (i = 0, ii = repeat.viewCount(); i < ii; ++i) {
      child = repeat.view(i);
      if (child.bindingContext[repeat.key] === key) {
        return i;
      }
    }

    return undefined;
  };

  return MapRepeatStrategy;
}();
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))

/***/ },
/* 62 */
/***/ function(module, exports) {

"use strict";
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});



var NullRepeatStrategy = exports.NullRepeatStrategy = function () {
  function NullRepeatStrategy() {
    
  }

  NullRepeatStrategy.prototype.instanceChanged = function instanceChanged(repeat, items) {
    repeat.removeAllViews(true);
  };

  NullRepeatStrategy.prototype.getCollectionObserver = function getCollectionObserver(observerLocator, items) {};

  return NullRepeatStrategy;
}();

/***/ },
/* 63 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.NumberRepeatStrategy = undefined;

var _repeatUtilities = __webpack_require__(13);



var NumberRepeatStrategy = exports.NumberRepeatStrategy = function () {
  function NumberRepeatStrategy() {
    
  }

  NumberRepeatStrategy.prototype.getCollectionObserver = function getCollectionObserver() {
    return null;
  };

  NumberRepeatStrategy.prototype.instanceChanged = function instanceChanged(repeat, value) {
    var _this = this;

    var removePromise = repeat.removeAllViews(true, !repeat.viewsRequireLifecycle);
    if (removePromise instanceof Promise) {
      removePromise.then(function () {
        return _this._standardProcessItems(repeat, value);
      });
      return;
    }
    this._standardProcessItems(repeat, value);
  };

  NumberRepeatStrategy.prototype._standardProcessItems = function _standardProcessItems(repeat, value) {
    var childrenLength = repeat.viewCount();
    var i = void 0;
    var ii = void 0;
    var overrideContext = void 0;
    var viewsToRemove = void 0;

    value = Math.floor(value);
    viewsToRemove = childrenLength - value;

    if (viewsToRemove > 0) {
      if (viewsToRemove > childrenLength) {
        viewsToRemove = childrenLength;
      }

      for (i = 0, ii = viewsToRemove; i < ii; ++i) {
        repeat.removeView(childrenLength - (i + 1), true, !repeat.viewsRequireLifecycle);
      }

      return;
    }

    for (i = childrenLength, ii = value; i < ii; ++i) {
      overrideContext = (0, _repeatUtilities.createFullOverrideContext)(repeat, i, i, ii);
      repeat.addView(overrideContext.bindingContext, overrideContext);
    }

    (0, _repeatUtilities.updateOverrideContexts)(repeat.views(), 0);
  };

  return NumberRepeatStrategy;
}();
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))

/***/ },
/* 64 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.RepeatStrategyLocator = undefined;

var _nullRepeatStrategy = __webpack_require__(62);

var _arrayRepeatStrategy = __webpack_require__(58);

var _mapRepeatStrategy = __webpack_require__(61);

var _setRepeatStrategy = __webpack_require__(65);

var _numberRepeatStrategy = __webpack_require__(63);



var RepeatStrategyLocator = exports.RepeatStrategyLocator = function () {
  function RepeatStrategyLocator() {
    

    this.matchers = [];
    this.strategies = [];

    this.addStrategy(function (items) {
      return items === null || items === undefined;
    }, new _nullRepeatStrategy.NullRepeatStrategy());
    this.addStrategy(function (items) {
      return items instanceof Array;
    }, new _arrayRepeatStrategy.ArrayRepeatStrategy());
    this.addStrategy(function (items) {
      return items instanceof Map;
    }, new _mapRepeatStrategy.MapRepeatStrategy());
    this.addStrategy(function (items) {
      return items instanceof Set;
    }, new _setRepeatStrategy.SetRepeatStrategy());
    this.addStrategy(function (items) {
      return typeof items === 'number';
    }, new _numberRepeatStrategy.NumberRepeatStrategy());
  }

  RepeatStrategyLocator.prototype.addStrategy = function addStrategy(matcher, strategy) {
    this.matchers.push(matcher);
    this.strategies.push(strategy);
  };

  RepeatStrategyLocator.prototype.getStrategy = function getStrategy(items) {
    var matchers = this.matchers;

    for (var i = 0, ii = matchers.length; i < ii; ++i) {
      if (matchers[i](items)) {
        return this.strategies[i];
      }
    }

    return null;
  };

  return RepeatStrategyLocator;
}();

/***/ },
/* 65 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SetRepeatStrategy = undefined;

var _repeatUtilities = __webpack_require__(13);



var SetRepeatStrategy = exports.SetRepeatStrategy = function () {
  function SetRepeatStrategy() {
    
  }

  SetRepeatStrategy.prototype.getCollectionObserver = function getCollectionObserver(observerLocator, items) {
    return observerLocator.getSetObserver(items);
  };

  SetRepeatStrategy.prototype.instanceChanged = function instanceChanged(repeat, items) {
    var _this = this;

    var removePromise = repeat.removeAllViews(true, !repeat.viewsRequireLifecycle);
    if (removePromise instanceof Promise) {
      removePromise.then(function () {
        return _this._standardProcessItems(repeat, items);
      });
      return;
    }
    this._standardProcessItems(repeat, items);
  };

  SetRepeatStrategy.prototype._standardProcessItems = function _standardProcessItems(repeat, items) {
    var index = 0;
    var overrideContext = void 0;

    items.forEach(function (value) {
      overrideContext = (0, _repeatUtilities.createFullOverrideContext)(repeat, value, index, items.size);
      repeat.addView(overrideContext.bindingContext, overrideContext);
      ++index;
    });
  };

  SetRepeatStrategy.prototype.instanceMutated = function instanceMutated(repeat, set, records) {
    var value = void 0;
    var i = void 0;
    var ii = void 0;
    var overrideContext = void 0;
    var removeIndex = void 0;
    var record = void 0;
    var rmPromises = [];
    var viewOrPromise = void 0;

    for (i = 0, ii = records.length; i < ii; ++i) {
      record = records[i];
      value = record.value;
      switch (record.type) {
        case 'add':
          overrideContext = (0, _repeatUtilities.createFullOverrideContext)(repeat, value, set.size - 1, set.size);
          repeat.insertView(set.size - 1, overrideContext.bindingContext, overrideContext);
          break;
        case 'delete':
          removeIndex = this._getViewIndexByValue(repeat, value);
          viewOrPromise = repeat.removeView(removeIndex, true, !repeat.viewsRequireLifecycle);
          if (viewOrPromise instanceof Promise) {
            rmPromises.push(viewOrPromise);
          }
          break;
        case 'clear':
          repeat.removeAllViews(true, !repeat.viewsRequireLifecycle);
          break;
        default:
          continue;
      }
    }

    if (rmPromises.length > 0) {
      Promise.all(rmPromises).then(function () {
        (0, _repeatUtilities.updateOverrideContexts)(repeat.views(), 0);
      });
    } else {
      (0, _repeatUtilities.updateOverrideContexts)(repeat.views(), 0);
    }
  };

  SetRepeatStrategy.prototype._getViewIndexByValue = function _getViewIndexByValue(repeat, value) {
    var i = void 0;
    var ii = void 0;
    var child = void 0;

    for (i = 0, ii = repeat.viewCount(); i < ii; ++i) {
      child = repeat.view(i);
      if (child.bindingContext[repeat.local] === value) {
        return i;
      }
    }

    return undefined;
  };

  return SetRepeatStrategy;
}();
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))

/***/ },
/* 66 */,
/* 67 */,
/* 68 */,
/* 69 */,
/* 70 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.FetchConfig = undefined;

var _dec, _class;

var _aureliaDependencyInjection = __webpack_require__(0);

var _aureliaFetchClient = __webpack_require__(15);

var _authentication = __webpack_require__(20);

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var FetchConfig = exports.FetchConfig = (_dec = (0, _aureliaDependencyInjection.inject)(_aureliaFetchClient.HttpClient, _authentication.Authentication), _dec(_class = function () {
  function FetchConfig(httpClient, authService) {
    _classCallCheck(this, FetchConfig);

    this.httpClient = httpClient;
    this.auth = authService;
  }

  FetchConfig.prototype.configure = function configure() {
    var _this = this;

    this.httpClient.configure(function (httpConfig) {
      httpConfig.withDefaults({
        headers: {
          'Accept': 'application/json'
        }
      }).withInterceptor(_this.auth.tokenInterceptor);
    });
  };

  return FetchConfig;
}()) || _class);

/***/ },
/* 71 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.AuthService = undefined;

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj; };

var _dec, _class;

var _aureliaDependencyInjection = __webpack_require__(0);

var _aureliaFetchClient = __webpack_require__(15);

var _aureliaEventAggregator = __webpack_require__(17);

var _authentication = __webpack_require__(20);

var _baseConfig = __webpack_require__(10);

var _oAuth = __webpack_require__(73);

var _oAuth2 = __webpack_require__(74);

var _authUtilities = __webpack_require__(12);

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var AuthService = exports.AuthService = (_dec = (0, _aureliaDependencyInjection.inject)(_aureliaFetchClient.HttpClient, _authentication.Authentication, _oAuth.OAuth1, _oAuth2.OAuth2, _baseConfig.BaseConfig, _aureliaEventAggregator.EventAggregator), _dec(_class = function () {
  function AuthService(http, auth, oAuth1, oAuth2, config, eventAggregator) {
    _classCallCheck(this, AuthService);

    this.http = http;
    this.auth = auth;
    this.oAuth1 = oAuth1;
    this.oAuth2 = oAuth2;
    this.config = config.current;
    this.tokenInterceptor = auth.tokenInterceptor;
    this.eventAggregator = eventAggregator;
  }

  AuthService.prototype.getMe = function getMe() {
    var profileUrl = this.auth.getProfileUrl();
    return this.http.fetch(profileUrl).then(_authUtilities.status);
  };

  AuthService.prototype.isAuthenticated = function isAuthenticated() {
    return this.auth.isAuthenticated();
  };

  AuthService.prototype.getTokenPayload = function getTokenPayload() {
    return this.auth.getPayload();
  };

  AuthService.prototype.signup = function signup(displayName, email, password) {
    var _this = this;

    var signupUrl = this.auth.getSignupUrl();
    var content = void 0;
    if (_typeof(arguments[0]) === 'object') {
      content = arguments[0];
    } else {
      content = {
        'displayName': displayName,
        'email': email,
        'password': password
      };
    }

    return this.http.fetch(signupUrl, {
      method: 'post',
      body: (0, _aureliaFetchClient.json)(content)
    }).then(_authUtilities.status).then(function (response) {
      if (_this.config.loginOnSignup) {
        _this.auth.setToken(response);
      } else if (_this.config.signupRedirect) {
        window.location.href = _this.config.signupRedirect;
      }
      _this.eventAggregator.publish('auth:signup', response);
      return response;
    });
  };

  AuthService.prototype.login = function login(email, password) {
    var _this2 = this;

    var loginUrl = this.auth.getLoginUrl();
    var content = void 0;
    if (typeof arguments[1] !== 'string') {
      content = arguments[0];
    } else {
      content = {
        'email': email,
        'password': password
      };
    }

    return this.http.fetch(loginUrl, {
      method: 'post',
      headers: typeof content === 'string' ? { 'Content-Type': 'application/x-www-form-urlencoded' } : {},
      body: typeof content === 'string' ? content : (0, _aureliaFetchClient.json)(content)
    }).then(_authUtilities.status).then(function (response) {
      _this2.auth.setToken(response);
      _this2.eventAggregator.publish('auth:login', response);
      return response;
    });
  };

  AuthService.prototype.logout = function logout(redirectUri) {
    this.eventAggregator.publish('auth:logout');
    return this.auth.logout(redirectUri);
  };

  AuthService.prototype.authenticate = function authenticate(name, redirect, userData) {
    var _this3 = this;

    var provider = this.oAuth2;
    if (this.config.providers[name].type === '1.0') {
      provider = this.oAuth1;
    }

    return provider.open(this.config.providers[name], userData || {}).then(function (response) {
      _this3.auth.setToken(response, redirect);
      _this3.eventAggregator.publish('auth:authenticate', response);
      return response;
    });
  };

  AuthService.prototype.unlink = function unlink(provider) {
    var _this4 = this;

    var unlinkUrl = this.config.baseUrl ? (0, _authUtilities.joinUrl)(this.config.baseUrl, this.config.unlinkUrl) : this.config.unlinkUrl;

    if (this.config.unlinkMethod === 'get') {
      return this.http.fetch(unlinkUrl + provider).then(_authUtilities.status).then(function (response) {
        _this4.eventAggregator.publish('auth:unlink', response);
        return response;
      });
    } else if (this.config.unlinkMethod === 'post') {
      return this.http.fetch(unlinkUrl, {
        method: 'post',
        body: (0, _aureliaFetchClient.json)(provider)
      }).then(_authUtilities.status).then(function (response) {
        _this4.eventAggregator.publish('auth:unlink', response);
        return response;
      });
    }
  };

  return AuthService;
}()) || _class);

/***/ },
/* 72 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.AuthorizeStep = undefined;

var _dec, _class;

var _aureliaDependencyInjection = __webpack_require__(0);

var _aureliaRouter = __webpack_require__(9);

var _authentication = __webpack_require__(20);

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var AuthorizeStep = exports.AuthorizeStep = (_dec = (0, _aureliaDependencyInjection.inject)(_authentication.Authentication), _dec(_class = function () {
  function AuthorizeStep(auth) {
    _classCallCheck(this, AuthorizeStep);

    this.auth = auth;
  }

  AuthorizeStep.prototype.run = function run(routingContext, next) {
    var isLoggedIn = this.auth.isAuthenticated();
    var loginRoute = this.auth.getLoginRoute();

    if (routingContext.getAllInstructions().some(function (i) {
      return i.config.auth;
    })) {
      if (!isLoggedIn) {
        this.auth.setInitialUrl(window.location.href);
        return next.cancel(new _aureliaRouter.Redirect(loginRoute));
      }
    } else if (isLoggedIn && routingContext.getAllInstructions().some(function (i) {
      return i.fragment === loginRoute;
    })) {
      var loginRedirect = this.auth.getLoginRedirect();
      return next.cancel(new _aureliaRouter.Redirect(loginRedirect));
    }

    return next();
  };

  return AuthorizeStep;
}()) || _class);

/***/ },
/* 73 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.OAuth1 = undefined;

var _dec, _class;

var _aureliaDependencyInjection = __webpack_require__(0);

var _authUtilities = __webpack_require__(12);

var _storage = __webpack_require__(29);

var _popup = __webpack_require__(55);

var _baseConfig = __webpack_require__(10);

var _aureliaFetchClient = __webpack_require__(15);

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var OAuth1 = exports.OAuth1 = (_dec = (0, _aureliaDependencyInjection.inject)(_storage.Storage, _popup.Popup, _aureliaFetchClient.HttpClient, _baseConfig.BaseConfig), _dec(_class = function () {
  function OAuth1(storage, popup, http, config) {
    _classCallCheck(this, OAuth1);

    this.storage = storage;
    this.config = config.current;
    this.popup = popup;
    this.http = http;
    this.defaults = {
      url: null,
      name: null,
      popupOptions: null,
      redirectUri: null,
      authorizationEndpoint: null
    };
  }

  OAuth1.prototype.open = function open(options, userData) {
    var _this = this;

    var current = (0, _authUtilities.extend)({}, this.defaults, options);
    var serverUrl = this.config.baseUrl ? (0, _authUtilities.joinUrl)(this.config.baseUrl, current.url) : current.url;

    if (this.config.platform !== 'mobile') {
      this.popup = this.popup.open('', current.name, current.popupOptions, current.redirectUri);
    }
    return this.http.fetch(serverUrl, {
      method: 'post'
    }).then(_authUtilities.status).then(function (response) {
      if (_this.config.platform === 'mobile') {
        _this.popup = _this.popup.open([current.authorizationEndpoint, _this.buildQueryString(response)].join('?'), current.name, current.popupOptions, current.redirectUri);
      } else {
        _this.popup.popupWindow.location = [current.authorizationEndpoint, _this.buildQueryString(response)].join('?');
      }

      var popupListener = _this.config.platform === 'mobile' ? _this.popup.eventListener(current.redirectUri) : _this.popup.pollPopup();
      return popupListener.then(function (result) {
        return _this.exchangeForToken(result, userData, current);
      });
    });
  };

  OAuth1.prototype.exchangeForToken = function exchangeForToken(oauthData, userData, current) {
    var data = (0, _authUtilities.extend)({}, userData, oauthData);
    var exchangeForTokenUrl = this.config.baseUrl ? (0, _authUtilities.joinUrl)(this.config.baseUrl, current.url) : current.url;
    var credentials = this.config.withCredentials ? 'include' : 'same-origin';

    return this.http.fetch(exchangeForTokenUrl, {
      method: 'post',
      body: (0, _aureliaFetchClient.json)(data),
      credentials: credentials
    }).then(_authUtilities.status);
  };

  OAuth1.prototype.buildQueryString = function buildQueryString(obj) {
    var str = [];
    (0, _authUtilities.forEach)(obj, function (value, key) {
      return str.push(encodeURIComponent(key) + '=' + encodeURIComponent(value));
    });
    return str.join('&');
  };

  return OAuth1;
}()) || _class);

/***/ },
/* 74 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.OAuth2 = undefined;

var _dec, _class;

var _aureliaDependencyInjection = __webpack_require__(0);

var _authUtilities = __webpack_require__(12);

var _storage = __webpack_require__(29);

var _popup = __webpack_require__(55);

var _baseConfig = __webpack_require__(10);

var _authentication = __webpack_require__(20);

var _aureliaFetchClient = __webpack_require__(15);

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var OAuth2 = exports.OAuth2 = (_dec = (0, _aureliaDependencyInjection.inject)(_storage.Storage, _popup.Popup, _aureliaFetchClient.HttpClient, _baseConfig.BaseConfig, _authentication.Authentication), _dec(_class = function () {
  function OAuth2(storage, popup, http, config, auth) {
    _classCallCheck(this, OAuth2);

    this.storage = storage;
    this.config = config.current;
    this.popup = popup;
    this.http = http;
    this.auth = auth;
    this.defaults = {
      url: null,
      name: null,
      state: null,
      scope: null,
      scopeDelimiter: null,
      redirectUri: null,
      popupOptions: null,
      authorizationEndpoint: null,
      responseParams: null,
      requiredUrlParams: null,
      optionalUrlParams: null,
      defaultUrlParams: ['response_type', 'client_id', 'redirect_uri'],
      responseType: 'code'
    };
  }

  OAuth2.prototype.open = function open(options, userData) {
    var _this = this;

    var current = (0, _authUtilities.extend)({}, this.defaults, options);

    var stateName = current.name + '_state';

    if ((0, _authUtilities.isFunction)(current.state)) {
      this.storage.set(stateName, current.state());
    } else if ((0, _authUtilities.isString)(current.state)) {
      this.storage.set(stateName, current.state);
    }

    var nonceName = current.name + '_nonce';

    if ((0, _authUtilities.isFunction)(current.nonce)) {
      this.storage.set(nonceName, current.nonce());
    } else if ((0, _authUtilities.isString)(current.nonce)) {
      this.storage.set(nonceName, current.nonce);
    }

    var url = current.authorizationEndpoint + '?' + this.buildQueryString(current);

    var openPopup = void 0;
    if (this.config.platform === 'mobile') {
      openPopup = this.popup.open(url, current.name, current.popupOptions, current.redirectUri).eventListener(current.redirectUri);
    } else {
      openPopup = this.popup.open(url, current.name, current.popupOptions, current.redirectUri).pollPopup();
    }

    return openPopup.then(function (oauthData) {
      if (oauthData.state && oauthData.state !== _this.storage.get(stateName)) {
        return Promise.reject('OAuth 2.0 state parameter mismatch.');
      }

      if (current.responseType.toUpperCase().includes('TOKEN')) {
        if (!_this.verifyIdToken(oauthData, current.name)) {
          return Promise.reject('OAuth 2.0 Nonce parameter mismatch.');
        }

        return oauthData;
      }

      return _this.exchangeForToken(oauthData, userData, current);
    });
  };

  OAuth2.prototype.verifyIdToken = function verifyIdToken(oauthData, providerName) {
    var idToken = oauthData && oauthData[this.config.responseIdTokenProp];
    if (!idToken) return true;
    var idTokenObject = this.auth.decomposeToken(idToken);
    if (!idTokenObject) return true;
    var nonceFromToken = idTokenObject.nonce;
    if (!nonceFromToken) return true;
    var nonceInStorage = this.storage.get(providerName + '_nonce');
    if (nonceFromToken !== nonceInStorage) {
      return false;
    }
    return true;
  };

  OAuth2.prototype.exchangeForToken = function exchangeForToken(oauthData, userData, current) {
    var data = (0, _authUtilities.extend)({}, userData, {
      code: oauthData.code,
      clientId: current.clientId,
      redirectUri: current.redirectUri
    });

    if (oauthData.state) {
      data.state = oauthData.state;
    }

    (0, _authUtilities.forEach)(current.responseParams, function (param) {
      return data[param] = oauthData[param];
    });

    var exchangeForTokenUrl = this.config.baseUrl ? (0, _authUtilities.joinUrl)(this.config.baseUrl, current.url) : current.url;
    var credentials = this.config.withCredentials ? 'include' : 'same-origin';

    return this.http.fetch(exchangeForTokenUrl, {
      method: 'post',
      body: (0, _aureliaFetchClient.json)(data),
      credentials: credentials
    }).then(_authUtilities.status);
  };

  OAuth2.prototype.buildQueryString = function buildQueryString(current) {
    var _this2 = this;

    var keyValuePairs = [];
    var urlParams = ['defaultUrlParams', 'requiredUrlParams', 'optionalUrlParams'];

    (0, _authUtilities.forEach)(urlParams, function (params) {
      (0, _authUtilities.forEach)(current[params], function (paramName) {
        var camelizedName = (0, _authUtilities.camelCase)(paramName);
        var paramValue = (0, _authUtilities.isFunction)(current[paramName]) ? current[paramName]() : current[camelizedName];

        if (paramName === 'state') {
          var stateName = current.name + '_state';
          paramValue = encodeURIComponent(_this2.storage.get(stateName));
        }

        if (paramName === 'nonce') {
          var nonceName = current.name + '_nonce';
          paramValue = encodeURIComponent(_this2.storage.get(nonceName));
        }

        if (paramName === 'scope' && Array.isArray(paramValue)) {
          paramValue = paramValue.join(current.scopeDelimiter);

          if (current.scopePrefix) {
            paramValue = [current.scopePrefix, paramValue].join(current.scopeDelimiter);
          }
        }

        keyValuePairs.push([paramName, paramValue]);
      });
    });

    return keyValuePairs.map(function (pair) {
      return pair.join('=');
    }).join('&');
  };

  return OAuth2;
}()) || _class);
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))

/***/ },
/* 75 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports._createCSSResource = _createCSSResource;

var _aureliaTemplating = __webpack_require__(3);

var _aureliaLoader = __webpack_require__(14);

var _aureliaDependencyInjection = __webpack_require__(0);

var _aureliaPath = __webpack_require__(8);

var _aureliaPal = __webpack_require__(2);

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }



var cssUrlMatcher = /url\((?!['"]data)([^)]+)\)/gi;

function fixupCSSUrls(address, css) {
  if (typeof css !== 'string') {
    throw new Error('Failed loading required CSS file: ' + address);
  }
  return css.replace(cssUrlMatcher, function (match, p1) {
    var quote = p1.charAt(0);
    if (quote === '\'' || quote === '"') {
      p1 = p1.substr(1, p1.length - 2);
    }
    return 'url(\'' + (0, _aureliaPath.relativeToFile)(p1, address) + '\')';
  });
}

var CSSResource = function () {
  function CSSResource(address) {
    

    this.address = address;
    this._global = null;
    this._scoped = null;
  }

  CSSResource.prototype.initialize = function initialize(container, target) {
    this._global = new target('global');
    this._scoped = new target('scoped');
  };

  CSSResource.prototype.register = function register(registry, name) {
    registry.registerViewEngineHooks(name === 'scoped' ? this._scoped : this._global);
  };

  CSSResource.prototype.load = function load(container) {
    var _this = this;

    return container.get(_aureliaLoader.Loader).loadText(this.address).catch(function (err) {
      return null;
    }).then(function (text) {
      text = fixupCSSUrls(_this.address, text);
      _this._global.css = text;
      _this._scoped.css = text;
    });
  };

  return CSSResource;
}();

var CSSViewEngineHooks = function () {
  function CSSViewEngineHooks(mode) {
    

    this.mode = mode;
    this.css = null;
    this._alreadyGloballyInjected = false;
  }

  CSSViewEngineHooks.prototype.beforeCompile = function beforeCompile(content, resources, instruction) {
    if (this.mode === 'scoped') {
      if (instruction.targetShadowDOM) {
        _aureliaPal.DOM.injectStyles(this.css, content, true);
      } else if (_aureliaPal.FEATURE.scopedCSS) {
        var styleNode = _aureliaPal.DOM.injectStyles(this.css, content, true);
        styleNode.setAttribute('scoped', 'scoped');
      } else if (!this._alreadyGloballyInjected) {
        _aureliaPal.DOM.injectStyles(this.css);
        this._alreadyGloballyInjected = true;
      }
    } else if (!this._alreadyGloballyInjected) {
      _aureliaPal.DOM.injectStyles(this.css);
      this._alreadyGloballyInjected = true;
    }
  };

  return CSSViewEngineHooks;
}();

function _createCSSResource(address) {
  var _dec, _class;

  var ViewCSS = (_dec = (0, _aureliaTemplating.resource)(new CSSResource(address)), _dec(_class = function (_CSSViewEngineHooks) {
    _inherits(ViewCSS, _CSSViewEngineHooks);

    function ViewCSS() {
      

      return _possibleConstructorReturn(this, _CSSViewEngineHooks.apply(this, arguments));
    }

    return ViewCSS;
  }(CSSViewEngineHooks)) || _class);

  return ViewCSS;
}

/***/ },
/* 76 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports._createDynamicElement = _createDynamicElement;

var _aureliaTemplating = __webpack_require__(3);



function _createDynamicElement(name, viewUrl, bindableNames) {
  var _dec, _dec2, _class;

  var DynamicElement = (_dec = (0, _aureliaTemplating.customElement)(name), _dec2 = (0, _aureliaTemplating.useView)(viewUrl), _dec(_class = _dec2(_class = function () {
    function DynamicElement() {
      
    }

    DynamicElement.prototype.bind = function bind(bindingContext) {
      this.$parent = bindingContext;
    };

    return DynamicElement;
  }()) || _class) || _class);

  for (var i = 0, ii = bindableNames.length; i < ii; ++i) {
    (0, _aureliaTemplating.bindable)(bindableNames[i])(DynamicElement);
  }
  return DynamicElement;
}

/***/ },
/* 77 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getElementName = getElementName;
exports.configure = configure;

var _aureliaTemplating = __webpack_require__(3);

var _dynamicElement = __webpack_require__(76);

function getElementName(address) {
  return (/([^\/^\?]+)\.html/i.exec(address)[1].toLowerCase()
  );
}

function configure(config) {
  var viewEngine = config.container.get(_aureliaTemplating.ViewEngine);
  var loader = config.aurelia.loader;

  viewEngine.addResourcePlugin('.html', {
    'fetch': function fetch(address) {
      return loader.loadTemplate(address).then(function (registryEntry) {
        var _ref;

        var bindable = registryEntry.template.getAttribute('bindable');
        var elementName = getElementName(address);

        if (bindable) {
          bindable = bindable.split(',').map(function (x) {
            return x.trim();
          });
          registryEntry.template.removeAttribute('bindable');
        } else {
          bindable = [];
        }

        return _ref = {}, _ref[elementName] = (0, _dynamicElement._createDynamicElement)(elementName, address, bindable), _ref;
      });
    }
  });
}

/***/ },
/* 78 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.TemplatingRouteLoader = undefined;

var _dec, _class;

var _aureliaDependencyInjection = __webpack_require__(0);

var _aureliaTemplating = __webpack_require__(3);

var _aureliaRouter = __webpack_require__(9);

var _aureliaPath = __webpack_require__(8);

var _aureliaMetadata = __webpack_require__(6);



function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var TemplatingRouteLoader = exports.TemplatingRouteLoader = (_dec = (0, _aureliaDependencyInjection.inject)(_aureliaTemplating.CompositionEngine), _dec(_class = function (_RouteLoader) {
  _inherits(TemplatingRouteLoader, _RouteLoader);

  function TemplatingRouteLoader(compositionEngine) {
    

    var _this = _possibleConstructorReturn(this, _RouteLoader.call(this));

    _this.compositionEngine = compositionEngine;
    return _this;
  }

  TemplatingRouteLoader.prototype.loadRoute = function loadRoute(router, config) {
    var childContainer = router.container.createChild();
    var instruction = {
      viewModel: (0, _aureliaPath.relativeToFile)(config.moduleId, _aureliaMetadata.Origin.get(router.container.viewModel.constructor).moduleId),
      childContainer: childContainer,
      view: config.view || config.viewStrategy,
      router: router
    };

    childContainer.getChildRouter = function () {
      var childRouter = void 0;

      childContainer.registerHandler(_aureliaRouter.Router, function (c) {
        return childRouter || (childRouter = router.createChild(childContainer));
      });

      return childContainer.get(_aureliaRouter.Router);
    };

    return this.compositionEngine.ensureViewModel(instruction);
  };

  return TemplatingRouteLoader;
}(_aureliaRouter.RouteLoader)) || _class);

/***/ },
/* 79 */,
/* 80 */,
/* 81 */,
/* 82 */,
/* 83 */,
/* 84 */,
/* 85 */,
/* 86 */,
/* 87 */,
/* 88 */,
/* 89 */,
/* 90 */,
/* 91 */,
/* 92 */,
/* 93 */,
/* 94 */,
/* 95 */,
/* 96 */,
/* 97 */,
/* 98 */,
/* 99 */,
/* 100 */,
/* 101 */,
/* 102 */,
/* 103 */,
/* 104 */,
/* 105 */,
/* 106 */,
/* 107 */,
/* 108 */,
/* 109 */,
/* 110 */
/***/ function(module, exports, __webpack_require__) {

__webpack_require__(23);
__webpack_require__(4);
__webpack_require__(0);
__webpack_require__(17);
__webpack_require__(24);
__webpack_require__(25);
__webpack_require__(48);
__webpack_require__(14);
__webpack_require__(26);
__webpack_require__(7);
__webpack_require__(49);
__webpack_require__(6);
__webpack_require__(8);
__webpack_require__(27);
__webpack_require__(9);
__webpack_require__(11);
__webpack_require__(3);
__webpack_require__(50);
__webpack_require__(52);
__webpack_require__(51);
module.exports = __webpack_require__(16);


/***/ }
],[110]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXVyZWxpYS5idW5kbGUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtZGVwZW5kZW5jeS1pbmplY3Rpb24vZGlzdC9jb21tb25qcy9hdXJlbGlhLWRlcGVuZGVuY3ktaW5qZWN0aW9uLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS10ZW1wbGF0aW5nL2Rpc3QvY29tbW9uanMvYXVyZWxpYS10ZW1wbGF0aW5nLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1iaW5kaW5nL2Rpc3QvY29tbW9uanMvYXVyZWxpYS1iaW5kaW5nLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1tZXRhZGF0YS9kaXN0L2NvbW1vbmpzL2F1cmVsaWEtbWV0YWRhdGEuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLWxvZ2dpbmcvZGlzdC9jb21tb25qcy9hdXJlbGlhLWxvZ2dpbmcuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLXBhdGgvZGlzdC9jb21tb25qcy9hdXJlbGlhLXBhdGguanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLXJvdXRlci9kaXN0L2NvbW1vbmpzL2F1cmVsaWEtcm91dGVyLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1hdXRoL2Rpc3QvY29tbW9uanMvYmFzZS1jb25maWcuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLXRhc2stcXVldWUvZGlzdC9jb21tb25qcy9hdXJlbGlhLXRhc2stcXVldWUuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLWF1dGgvZGlzdC9jb21tb25qcy9hdXRoLXV0aWxpdGllcy5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9yZXBlYXQtdXRpbGl0aWVzLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1sb2FkZXIvZGlzdC9jb21tb25qcy9hdXJlbGlhLWxvYWRlci5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtZmV0Y2gtY2xpZW50L2Rpc3QvY29tbW9uanMvYXVyZWxpYS1mZXRjaC1jbGllbnQuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLWF1dGgvZGlzdC9jb21tb25qcy9hdXJlbGlhLWF1dGguanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLWV2ZW50LWFnZ3JlZ2F0b3IvZGlzdC9jb21tb25qcy9hdXJlbGlhLWV2ZW50LWFnZ3JlZ2F0b3IuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLWF1dGgvZGlzdC9jb21tb25qcy9hdXRoZW50aWNhdGlvbi5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtYm9vdHN0cmFwcGVyLXdlYnBhY2svZGlzdC9jb21tb25qcy9hdXJlbGlhLWJvb3RzdHJhcHBlci13ZWJwYWNrLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1mcmFtZXdvcmsvZGlzdC9jb21tb25qcy9hdXJlbGlhLWZyYW1ld29yay5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtaGlzdG9yeS9kaXN0L2NvbW1vbmpzL2F1cmVsaWEtaGlzdG9yeS5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtbG9hZGVyLXdlYnBhY2svZGlzdC9jb21tb25qcy9hdXJlbGlhLWxvYWRlci13ZWJwYWNrLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1yb3V0ZS1yZWNvZ25pemVyL2Rpc3QvY29tbW9uanMvYXVyZWxpYS1yb3V0ZS1yZWNvZ25pemVyLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1hdXRoL2Rpc3QvY29tbW9uanMvYXV0aC1maWx0ZXIuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLWF1dGgvZGlzdC9jb21tb25qcy9zdG9yYWdlLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L2NvbW1vbmpzL2F1cmVsaWEtaGlkZS1zdHlsZS5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9iaW5kaW5nLW1vZGUtYmVoYXZpb3JzLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L2NvbW1vbmpzL2NvbXBvc2UuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzL2Rpc3QvY29tbW9uanMvZGVib3VuY2UtYmluZGluZy1iZWhhdmlvci5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9mb2N1cy5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9oaWRlLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L2NvbW1vbmpzL2lmLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L2NvbW1vbmpzL3JlcGVhdC5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9yZXBsYWNlYWJsZS5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9zYW5pdGl6ZS1odG1sLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L2NvbW1vbmpzL3Nob3cuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzL2Rpc3QvY29tbW9uanMvc2lnbmFsLWJpbmRpbmctYmVoYXZpb3IuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzL2Rpc3QvY29tbW9uanMvdGhyb3R0bGUtYmluZGluZy1iZWhhdmlvci5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy91cGRhdGUtdHJpZ2dlci1iaW5kaW5nLWJlaGF2aW9yLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L2NvbW1vbmpzL3dpdGguanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLXRlbXBsYXRpbmctcm91dGVyL2Rpc3QvY29tbW9uanMvcm91dGUtaHJlZi5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yb3V0ZXIvZGlzdC9jb21tb25qcy9yb3V0ZXItdmlldy5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtaGlzdG9yeS1icm93c2VyL2Rpc3QvY29tbW9uanMvYXVyZWxpYS1oaXN0b3J5LWJyb3dzZXIuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLWxvZ2dpbmctY29uc29sZS9kaXN0L2NvbW1vbmpzL2F1cmVsaWEtbG9nZ2luZy1jb25zb2xlLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS10ZW1wbGF0aW5nLWJpbmRpbmcvZGlzdC9jb21tb25qcy9hdXJlbGlhLXRlbXBsYXRpbmctYmluZGluZy5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9hdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJvdXRlci9kaXN0L2NvbW1vbmpzL2F1cmVsaWEtdGVtcGxhdGluZy1yb3V0ZXIuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLWF1dGgvZGlzdC9jb21tb25qcy9wb3B1cC5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9hYnN0cmFjdC1yZXBlYXRlci5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9hbmFseXplLXZpZXctZmFjdG9yeS5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9hcnJheS1yZXBlYXQtc3RyYXRlZ3kuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzL2Rpc3QvY29tbW9uanMvYmluZGluZy1zaWduYWxlci5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9odG1sLXNhbml0aXplci5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9tYXAtcmVwZWF0LXN0cmF0ZWd5LmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L2NvbW1vbmpzL251bGwtcmVwZWF0LXN0cmF0ZWd5LmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L2NvbW1vbmpzL251bWJlci1yZXBlYXQtc3RyYXRlZ3kuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzL2Rpc3QvY29tbW9uanMvcmVwZWF0LXN0cmF0ZWd5LWxvY2F0b3IuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzL2Rpc3QvY29tbW9uanMvc2V0LXJlcGVhdC1zdHJhdGVneS5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtYXV0aC9kaXN0L2NvbW1vbmpzL2F1dGgtZmV0Y2gtY29uZmlnLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1hdXRoL2Rpc3QvY29tbW9uanMvYXV0aC1zZXJ2aWNlLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1hdXRoL2Rpc3QvY29tbW9uanMvYXV0aG9yaXplLXN0ZXAuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLWF1dGgvZGlzdC9jb21tb25qcy9vQXV0aDEuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLWF1dGgvZGlzdC9jb21tb25qcy9vQXV0aDIuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzL2Rpc3QvY29tbW9uanMvY3NzLXJlc291cmNlLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L2NvbW1vbmpzL2R5bmFtaWMtZWxlbWVudC5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9odG1sLXJlc291cmNlLXBsdWdpbi5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yb3V0ZXIvZGlzdC9jb21tb25qcy9yb3V0ZS1sb2FkZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5Db250YWluZXIgPSBleHBvcnRzLkludm9jYXRpb25IYW5kbGVyID0gZXhwb3J0cy5fZW1wdHlQYXJhbWV0ZXJzID0gZXhwb3J0cy5TaW5nbGV0b25SZWdpc3RyYXRpb24gPSBleHBvcnRzLlRyYW5zaWVudFJlZ2lzdHJhdGlvbiA9IGV4cG9ydHMuRmFjdG9yeUludm9rZXIgPSBleHBvcnRzLk5ld0luc3RhbmNlID0gZXhwb3J0cy5GYWN0b3J5ID0gZXhwb3J0cy5TdHJhdGVneVJlc29sdmVyID0gZXhwb3J0cy5QYXJlbnQgPSBleHBvcnRzLk9wdGlvbmFsID0gZXhwb3J0cy5BbGwgPSBleHBvcnRzLkxhenkgPSBleHBvcnRzLnJlc29sdmVyID0gdW5kZWZpbmVkO1xuXG52YXIgX2RlYywgX2NsYXNzLCBfZGVjMiwgX2NsYXNzMywgX2RlYzMsIF9jbGFzczUsIF9kZWM0LCBfY2xhc3M3LCBfZGVjNSwgX2NsYXNzOSwgX2RlYzYsIF9jbGFzczExLCBfZGVjNywgX2NsYXNzMTMsIF9jbGFzc0ludm9rZXJzO1xuXG5leHBvcnRzLmludm9rZXIgPSBpbnZva2VyO1xuZXhwb3J0cy5mYWN0b3J5ID0gZmFjdG9yeTtcbmV4cG9ydHMucmVnaXN0cmF0aW9uID0gcmVnaXN0cmF0aW9uO1xuZXhwb3J0cy50cmFuc2llbnQgPSB0cmFuc2llbnQ7XG5leHBvcnRzLnNpbmdsZXRvbiA9IHNpbmdsZXRvbjtcbmV4cG9ydHMuYXV0b2luamVjdCA9IGF1dG9pbmplY3Q7XG5leHBvcnRzLmluamVjdCA9IGluamVjdDtcblxudmFyIF9hdXJlbGlhTWV0YWRhdGEgPSByZXF1aXJlKCdhdXJlbGlhLW1ldGFkYXRhJyk7XG5cbnZhciBfYXVyZWxpYVBhbCA9IHJlcXVpcmUoJ2F1cmVsaWEtcGFsJyk7XG5cblxuXG52YXIgcmVzb2x2ZXIgPSBleHBvcnRzLnJlc29sdmVyID0gX2F1cmVsaWFNZXRhZGF0YS5wcm90b2NvbC5jcmVhdGUoJ2F1cmVsaWE6cmVzb2x2ZXInLCBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gIGlmICghKHR5cGVvZiB0YXJnZXQuZ2V0ID09PSAnZnVuY3Rpb24nKSkge1xuICAgIHJldHVybiAnUmVzb2x2ZXJzIG11c3QgaW1wbGVtZW50OiBnZXQoY29udGFpbmVyOiBDb250YWluZXIsIGtleTogYW55KTogYW55JztcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufSk7XG5cbnZhciBMYXp5ID0gZXhwb3J0cy5MYXp5ID0gKF9kZWMgPSByZXNvbHZlcigpLCBfZGVjKF9jbGFzcyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gTGF6eShrZXkpIHtcbiAgICBcblxuICAgIHRoaXMuX2tleSA9IGtleTtcbiAgfVxuXG4gIExhenkucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIGdldChjb250YWluZXIpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBjb250YWluZXIuZ2V0KF90aGlzLl9rZXkpO1xuICAgIH07XG4gIH07XG5cbiAgTGF6eS5vZiA9IGZ1bmN0aW9uIG9mKGtleSkge1xuICAgIHJldHVybiBuZXcgTGF6eShrZXkpO1xuICB9O1xuXG4gIHJldHVybiBMYXp5O1xufSgpKSB8fCBfY2xhc3MpO1xudmFyIEFsbCA9IGV4cG9ydHMuQWxsID0gKF9kZWMyID0gcmVzb2x2ZXIoKSwgX2RlYzIoX2NsYXNzMyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQWxsKGtleSkge1xuICAgIFxuXG4gICAgdGhpcy5fa2V5ID0ga2V5O1xuICB9XG5cbiAgQWxsLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiBnZXQoY29udGFpbmVyKSB7XG4gICAgcmV0dXJuIGNvbnRhaW5lci5nZXRBbGwodGhpcy5fa2V5KTtcbiAgfTtcblxuICBBbGwub2YgPSBmdW5jdGlvbiBvZihrZXkpIHtcbiAgICByZXR1cm4gbmV3IEFsbChrZXkpO1xuICB9O1xuXG4gIHJldHVybiBBbGw7XG59KCkpIHx8IF9jbGFzczMpO1xudmFyIE9wdGlvbmFsID0gZXhwb3J0cy5PcHRpb25hbCA9IChfZGVjMyA9IHJlc29sdmVyKCksIF9kZWMzKF9jbGFzczUgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIE9wdGlvbmFsKGtleSkge1xuICAgIHZhciBjaGVja1BhcmVudCA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMSB8fCBhcmd1bWVudHNbMV0gPT09IHVuZGVmaW5lZCA/IHRydWUgOiBhcmd1bWVudHNbMV07XG5cbiAgICBcblxuICAgIHRoaXMuX2tleSA9IGtleTtcbiAgICB0aGlzLl9jaGVja1BhcmVudCA9IGNoZWNrUGFyZW50O1xuICB9XG5cbiAgT3B0aW9uYWwucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIGdldChjb250YWluZXIpIHtcbiAgICBpZiAoY29udGFpbmVyLmhhc1Jlc29sdmVyKHRoaXMuX2tleSwgdGhpcy5fY2hlY2tQYXJlbnQpKSB7XG4gICAgICByZXR1cm4gY29udGFpbmVyLmdldCh0aGlzLl9rZXkpO1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9O1xuXG4gIE9wdGlvbmFsLm9mID0gZnVuY3Rpb24gb2Yoa2V5KSB7XG4gICAgdmFyIGNoZWNrUGFyZW50ID0gYXJndW1lbnRzLmxlbmd0aCA8PSAxIHx8IGFyZ3VtZW50c1sxXSA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IGFyZ3VtZW50c1sxXTtcblxuICAgIHJldHVybiBuZXcgT3B0aW9uYWwoa2V5LCBjaGVja1BhcmVudCk7XG4gIH07XG5cbiAgcmV0dXJuIE9wdGlvbmFsO1xufSgpKSB8fCBfY2xhc3M1KTtcbnZhciBQYXJlbnQgPSBleHBvcnRzLlBhcmVudCA9IChfZGVjNCA9IHJlc29sdmVyKCksIF9kZWM0KF9jbGFzczcgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFBhcmVudChrZXkpIHtcbiAgICBcblxuICAgIHRoaXMuX2tleSA9IGtleTtcbiAgfVxuXG4gIFBhcmVudC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gZ2V0KGNvbnRhaW5lcikge1xuICAgIHJldHVybiBjb250YWluZXIucGFyZW50ID8gY29udGFpbmVyLnBhcmVudC5nZXQodGhpcy5fa2V5KSA6IG51bGw7XG4gIH07XG5cbiAgUGFyZW50Lm9mID0gZnVuY3Rpb24gb2Yoa2V5KSB7XG4gICAgcmV0dXJuIG5ldyBQYXJlbnQoa2V5KTtcbiAgfTtcblxuICByZXR1cm4gUGFyZW50O1xufSgpKSB8fCBfY2xhc3M3KTtcbnZhciBTdHJhdGVneVJlc29sdmVyID0gZXhwb3J0cy5TdHJhdGVneVJlc29sdmVyID0gKF9kZWM1ID0gcmVzb2x2ZXIoKSwgX2RlYzUoX2NsYXNzOSA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gU3RyYXRlZ3lSZXNvbHZlcihzdHJhdGVneSwgc3RhdGUpIHtcbiAgICBcblxuICAgIHRoaXMuc3RyYXRlZ3kgPSBzdHJhdGVneTtcbiAgICB0aGlzLnN0YXRlID0gc3RhdGU7XG4gIH1cblxuICBTdHJhdGVneVJlc29sdmVyLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiBnZXQoY29udGFpbmVyLCBrZXkpIHtcbiAgICBzd2l0Y2ggKHRoaXMuc3RyYXRlZ3kpIHtcbiAgICAgIGNhc2UgMDpcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGU7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHZhciBzaW5nbGV0b24gPSBjb250YWluZXIuaW52b2tlKHRoaXMuc3RhdGUpO1xuICAgICAgICB0aGlzLnN0YXRlID0gc2luZ2xldG9uO1xuICAgICAgICB0aGlzLnN0cmF0ZWd5ID0gMDtcbiAgICAgICAgcmV0dXJuIHNpbmdsZXRvbjtcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5pbnZva2UodGhpcy5zdGF0ZSk7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXRlKGNvbnRhaW5lciwga2V5LCB0aGlzKTtcbiAgICAgIGNhc2UgNDpcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGVbMF0uZ2V0KGNvbnRhaW5lciwga2V5KTtcbiAgICAgIGNhc2UgNTpcbiAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5nZXQodGhpcy5zdGF0ZSk7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgc3RyYXRlZ3k6ICcgKyB0aGlzLnN0cmF0ZWd5KTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIFN0cmF0ZWd5UmVzb2x2ZXI7XG59KCkpIHx8IF9jbGFzczkpO1xudmFyIEZhY3RvcnkgPSBleHBvcnRzLkZhY3RvcnkgPSAoX2RlYzYgPSByZXNvbHZlcigpLCBfZGVjNihfY2xhc3MxMSA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gRmFjdG9yeShrZXkpIHtcbiAgICBcblxuICAgIHRoaXMuX2tleSA9IGtleTtcbiAgfVxuXG4gIEZhY3RvcnkucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIGdldChjb250YWluZXIpIHtcbiAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgcmVzdCA9IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykge1xuICAgICAgICByZXN0W19rZXldID0gYXJndW1lbnRzW19rZXldO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gY29udGFpbmVyLmludm9rZShfdGhpczIuX2tleSwgcmVzdCk7XG4gICAgfTtcbiAgfTtcblxuICBGYWN0b3J5Lm9mID0gZnVuY3Rpb24gb2Yoa2V5KSB7XG4gICAgcmV0dXJuIG5ldyBGYWN0b3J5KGtleSk7XG4gIH07XG5cbiAgcmV0dXJuIEZhY3Rvcnk7XG59KCkpIHx8IF9jbGFzczExKTtcbnZhciBOZXdJbnN0YW5jZSA9IGV4cG9ydHMuTmV3SW5zdGFuY2UgPSAoX2RlYzcgPSByZXNvbHZlcigpLCBfZGVjNyhfY2xhc3MxMyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gTmV3SW5zdGFuY2Uoa2V5KSB7XG4gICAgXG5cbiAgICB0aGlzLmtleSA9IGtleTtcbiAgICB0aGlzLmFzS2V5ID0ga2V5O1xuICB9XG5cbiAgTmV3SW5zdGFuY2UucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIGdldChjb250YWluZXIpIHtcbiAgICB2YXIgaW5zdGFuY2UgPSBjb250YWluZXIuaW52b2tlKHRoaXMua2V5KTtcbiAgICBjb250YWluZXIucmVnaXN0ZXJJbnN0YW5jZSh0aGlzLmFzS2V5LCBpbnN0YW5jZSk7XG4gICAgcmV0dXJuIGluc3RhbmNlO1xuICB9O1xuXG4gIE5ld0luc3RhbmNlLnByb3RvdHlwZS5hcyA9IGZ1bmN0aW9uIGFzKGtleSkge1xuICAgIHRoaXMuYXNLZXkgPSBrZXk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgTmV3SW5zdGFuY2Uub2YgPSBmdW5jdGlvbiBvZihrZXkpIHtcbiAgICByZXR1cm4gbmV3IE5ld0luc3RhbmNlKGtleSk7XG4gIH07XG5cbiAgcmV0dXJuIE5ld0luc3RhbmNlO1xufSgpKSB8fCBfY2xhc3MxMyk7XG5mdW5jdGlvbiBpbnZva2VyKHZhbHVlKSB7XG4gIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5kZWZpbmUoX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5pbnZva2VyLCB2YWx1ZSwgdGFyZ2V0KTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gZmFjdG9yeShwb3RlbnRpYWxUYXJnZXQpIHtcbiAgdmFyIGRlY28gPSBmdW5jdGlvbiBkZWNvKHRhcmdldCkge1xuICAgIF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEuZGVmaW5lKF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEuaW52b2tlciwgRmFjdG9yeUludm9rZXIuaW5zdGFuY2UsIHRhcmdldCk7XG4gIH07XG5cbiAgcmV0dXJuIHBvdGVudGlhbFRhcmdldCA/IGRlY28ocG90ZW50aWFsVGFyZ2V0KSA6IGRlY287XG59XG5cbnZhciBGYWN0b3J5SW52b2tlciA9IGV4cG9ydHMuRmFjdG9yeUludm9rZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEZhY3RvcnlJbnZva2VyKCkge1xuICAgIFxuICB9XG5cbiAgRmFjdG9yeUludm9rZXIucHJvdG90eXBlLmludm9rZSA9IGZ1bmN0aW9uIGludm9rZShjb250YWluZXIsIGZuLCBkZXBlbmRlbmNpZXMpIHtcbiAgICB2YXIgaSA9IGRlcGVuZGVuY2llcy5sZW5ndGg7XG4gICAgdmFyIGFyZ3MgPSBuZXcgQXJyYXkoaSk7XG5cbiAgICB3aGlsZSAoaS0tKSB7XG4gICAgICBhcmdzW2ldID0gY29udGFpbmVyLmdldChkZXBlbmRlbmNpZXNbaV0pO1xuICAgIH1cblxuICAgIHJldHVybiBmbi5hcHBseSh1bmRlZmluZWQsIGFyZ3MpO1xuICB9O1xuXG4gIEZhY3RvcnlJbnZva2VyLnByb3RvdHlwZS5pbnZva2VXaXRoRHluYW1pY0RlcGVuZGVuY2llcyA9IGZ1bmN0aW9uIGludm9rZVdpdGhEeW5hbWljRGVwZW5kZW5jaWVzKGNvbnRhaW5lciwgZm4sIHN0YXRpY0RlcGVuZGVuY2llcywgZHluYW1pY0RlcGVuZGVuY2llcykge1xuICAgIHZhciBpID0gc3RhdGljRGVwZW5kZW5jaWVzLmxlbmd0aDtcbiAgICB2YXIgYXJncyA9IG5ldyBBcnJheShpKTtcblxuICAgIHdoaWxlIChpLS0pIHtcbiAgICAgIGFyZ3NbaV0gPSBjb250YWluZXIuZ2V0KHN0YXRpY0RlcGVuZGVuY2llc1tpXSk7XG4gICAgfVxuXG4gICAgaWYgKGR5bmFtaWNEZXBlbmRlbmNpZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgYXJncyA9IGFyZ3MuY29uY2F0KGR5bmFtaWNEZXBlbmRlbmNpZXMpO1xuICAgIH1cblxuICAgIHJldHVybiBmbi5hcHBseSh1bmRlZmluZWQsIGFyZ3MpO1xuICB9O1xuXG4gIHJldHVybiBGYWN0b3J5SW52b2tlcjtcbn0oKTtcblxuRmFjdG9yeUludm9rZXIuaW5zdGFuY2UgPSBuZXcgRmFjdG9yeUludm9rZXIoKTtcblxuZnVuY3Rpb24gcmVnaXN0cmF0aW9uKHZhbHVlKSB7XG4gIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5kZWZpbmUoX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5yZWdpc3RyYXRpb24sIHZhbHVlLCB0YXJnZXQpO1xuICB9O1xufVxuXG5mdW5jdGlvbiB0cmFuc2llbnQoa2V5KSB7XG4gIHJldHVybiByZWdpc3RyYXRpb24obmV3IFRyYW5zaWVudFJlZ2lzdHJhdGlvbihrZXkpKTtcbn1cblxuZnVuY3Rpb24gc2luZ2xldG9uKGtleU9yUmVnaXN0ZXJJbkNoaWxkKSB7XG4gIHZhciByZWdpc3RlckluQ2hpbGQgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDEgfHwgYXJndW1lbnRzWzFdID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IGFyZ3VtZW50c1sxXTtcblxuICByZXR1cm4gcmVnaXN0cmF0aW9uKG5ldyBTaW5nbGV0b25SZWdpc3RyYXRpb24oa2V5T3JSZWdpc3RlckluQ2hpbGQsIHJlZ2lzdGVySW5DaGlsZCkpO1xufVxuXG52YXIgVHJhbnNpZW50UmVnaXN0cmF0aW9uID0gZXhwb3J0cy5UcmFuc2llbnRSZWdpc3RyYXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFRyYW5zaWVudFJlZ2lzdHJhdGlvbihrZXkpIHtcbiAgICBcblxuICAgIHRoaXMuX2tleSA9IGtleTtcbiAgfVxuXG4gIFRyYW5zaWVudFJlZ2lzdHJhdGlvbi5wcm90b3R5cGUucmVnaXN0ZXJSZXNvbHZlciA9IGZ1bmN0aW9uIHJlZ2lzdGVyUmVzb2x2ZXIoY29udGFpbmVyLCBrZXksIGZuKSB7XG4gICAgcmV0dXJuIGNvbnRhaW5lci5yZWdpc3RlclRyYW5zaWVudCh0aGlzLl9rZXkgfHwga2V5LCBmbik7XG4gIH07XG5cbiAgcmV0dXJuIFRyYW5zaWVudFJlZ2lzdHJhdGlvbjtcbn0oKTtcblxudmFyIFNpbmdsZXRvblJlZ2lzdHJhdGlvbiA9IGV4cG9ydHMuU2luZ2xldG9uUmVnaXN0cmF0aW9uID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBTaW5nbGV0b25SZWdpc3RyYXRpb24oa2V5T3JSZWdpc3RlckluQ2hpbGQpIHtcbiAgICB2YXIgcmVnaXN0ZXJJbkNoaWxkID0gYXJndW1lbnRzLmxlbmd0aCA8PSAxIHx8IGFyZ3VtZW50c1sxXSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBhcmd1bWVudHNbMV07XG5cbiAgICBcblxuICAgIGlmICh0eXBlb2Yga2V5T3JSZWdpc3RlckluQ2hpbGQgPT09ICdib29sZWFuJykge1xuICAgICAgdGhpcy5fcmVnaXN0ZXJJbkNoaWxkID0ga2V5T3JSZWdpc3RlckluQ2hpbGQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2tleSA9IGtleU9yUmVnaXN0ZXJJbkNoaWxkO1xuICAgICAgdGhpcy5fcmVnaXN0ZXJJbkNoaWxkID0gcmVnaXN0ZXJJbkNoaWxkO1xuICAgIH1cbiAgfVxuXG4gIFNpbmdsZXRvblJlZ2lzdHJhdGlvbi5wcm90b3R5cGUucmVnaXN0ZXJSZXNvbHZlciA9IGZ1bmN0aW9uIHJlZ2lzdGVyUmVzb2x2ZXIoY29udGFpbmVyLCBrZXksIGZuKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlZ2lzdGVySW5DaGlsZCA/IGNvbnRhaW5lci5yZWdpc3RlclNpbmdsZXRvbih0aGlzLl9rZXkgfHwga2V5LCBmbikgOiBjb250YWluZXIucm9vdC5yZWdpc3RlclNpbmdsZXRvbih0aGlzLl9rZXkgfHwga2V5LCBmbik7XG4gIH07XG5cbiAgcmV0dXJuIFNpbmdsZXRvblJlZ2lzdHJhdGlvbjtcbn0oKTtcblxudmFyIGJhZEtleUVycm9yID0gJ2tleS92YWx1ZSBjYW5ub3QgYmUgbnVsbCBvciB1bmRlZmluZWQuIEFyZSB5b3UgdHJ5aW5nIHRvIGluamVjdC9yZWdpc3RlciBzb21ldGhpbmcgdGhhdCBkb2VzblxcJ3QgZXhpc3Qgd2l0aCBEST8nO1xudmFyIF9lbXB0eVBhcmFtZXRlcnMgPSBleHBvcnRzLl9lbXB0eVBhcmFtZXRlcnMgPSBPYmplY3QuZnJlZXplKFtdKTtcblxuX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5yZWdpc3RyYXRpb24gPSAnYXVyZWxpYTpyZWdpc3RyYXRpb24nO1xuX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5pbnZva2VyID0gJ2F1cmVsaWE6aW52b2tlcic7XG5cbnZhciByZXNvbHZlckRlY29yYXRlcyA9IHJlc29sdmVyLmRlY29yYXRlcztcblxudmFyIEludm9jYXRpb25IYW5kbGVyID0gZXhwb3J0cy5JbnZvY2F0aW9uSGFuZGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gSW52b2NhdGlvbkhhbmRsZXIoZm4sIGludm9rZXIsIGRlcGVuZGVuY2llcykge1xuICAgIFxuXG4gICAgdGhpcy5mbiA9IGZuO1xuICAgIHRoaXMuaW52b2tlciA9IGludm9rZXI7XG4gICAgdGhpcy5kZXBlbmRlbmNpZXMgPSBkZXBlbmRlbmNpZXM7XG4gIH1cblxuICBJbnZvY2F0aW9uSGFuZGxlci5wcm90b3R5cGUuaW52b2tlID0gZnVuY3Rpb24gaW52b2tlKGNvbnRhaW5lciwgZHluYW1pY0RlcGVuZGVuY2llcykge1xuICAgIHJldHVybiBkeW5hbWljRGVwZW5kZW5jaWVzICE9PSB1bmRlZmluZWQgPyB0aGlzLmludm9rZXIuaW52b2tlV2l0aER5bmFtaWNEZXBlbmRlbmNpZXMoY29udGFpbmVyLCB0aGlzLmZuLCB0aGlzLmRlcGVuZGVuY2llcywgZHluYW1pY0RlcGVuZGVuY2llcykgOiB0aGlzLmludm9rZXIuaW52b2tlKGNvbnRhaW5lciwgdGhpcy5mbiwgdGhpcy5kZXBlbmRlbmNpZXMpO1xuICB9O1xuXG4gIHJldHVybiBJbnZvY2F0aW9uSGFuZGxlcjtcbn0oKTtcblxuZnVuY3Rpb24gaW52b2tlV2l0aER5bmFtaWNEZXBlbmRlbmNpZXMoY29udGFpbmVyLCBmbiwgc3RhdGljRGVwZW5kZW5jaWVzLCBkeW5hbWljRGVwZW5kZW5jaWVzKSB7XG4gIHZhciBpID0gc3RhdGljRGVwZW5kZW5jaWVzLmxlbmd0aDtcbiAgdmFyIGFyZ3MgPSBuZXcgQXJyYXkoaSk7XG5cbiAgd2hpbGUgKGktLSkge1xuICAgIGFyZ3NbaV0gPSBjb250YWluZXIuZ2V0KHN0YXRpY0RlcGVuZGVuY2llc1tpXSk7XG4gIH1cblxuICBpZiAoZHluYW1pY0RlcGVuZGVuY2llcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgYXJncyA9IGFyZ3MuY29uY2F0KGR5bmFtaWNEZXBlbmRlbmNpZXMpO1xuICB9XG5cbiAgcmV0dXJuIFJlZmxlY3QuY29uc3RydWN0KGZuLCBhcmdzKTtcbn1cblxudmFyIGNsYXNzSW52b2tlcnMgPSAoX2NsYXNzSW52b2tlcnMgPSB7fSwgX2NsYXNzSW52b2tlcnNbMF0gPSB7XG4gIGludm9rZTogZnVuY3Rpb24gaW52b2tlKGNvbnRhaW5lciwgVHlwZSkge1xuICAgIHJldHVybiBuZXcgVHlwZSgpO1xuICB9LFxuXG4gIGludm9rZVdpdGhEeW5hbWljRGVwZW5kZW5jaWVzOiBpbnZva2VXaXRoRHluYW1pY0RlcGVuZGVuY2llc1xufSwgX2NsYXNzSW52b2tlcnNbMV0gPSB7XG4gIGludm9rZTogZnVuY3Rpb24gaW52b2tlKGNvbnRhaW5lciwgVHlwZSwgZGVwcykge1xuICAgIHJldHVybiBuZXcgVHlwZShjb250YWluZXIuZ2V0KGRlcHNbMF0pKTtcbiAgfSxcblxuICBpbnZva2VXaXRoRHluYW1pY0RlcGVuZGVuY2llczogaW52b2tlV2l0aER5bmFtaWNEZXBlbmRlbmNpZXNcbn0sIF9jbGFzc0ludm9rZXJzWzJdID0ge1xuICBpbnZva2U6IGZ1bmN0aW9uIGludm9rZShjb250YWluZXIsIFR5cGUsIGRlcHMpIHtcbiAgICByZXR1cm4gbmV3IFR5cGUoY29udGFpbmVyLmdldChkZXBzWzBdKSwgY29udGFpbmVyLmdldChkZXBzWzFdKSk7XG4gIH0sXG5cbiAgaW52b2tlV2l0aER5bmFtaWNEZXBlbmRlbmNpZXM6IGludm9rZVdpdGhEeW5hbWljRGVwZW5kZW5jaWVzXG59LCBfY2xhc3NJbnZva2Vyc1szXSA9IHtcbiAgaW52b2tlOiBmdW5jdGlvbiBpbnZva2UoY29udGFpbmVyLCBUeXBlLCBkZXBzKSB7XG4gICAgcmV0dXJuIG5ldyBUeXBlKGNvbnRhaW5lci5nZXQoZGVwc1swXSksIGNvbnRhaW5lci5nZXQoZGVwc1sxXSksIGNvbnRhaW5lci5nZXQoZGVwc1syXSkpO1xuICB9LFxuXG4gIGludm9rZVdpdGhEeW5hbWljRGVwZW5kZW5jaWVzOiBpbnZva2VXaXRoRHluYW1pY0RlcGVuZGVuY2llc1xufSwgX2NsYXNzSW52b2tlcnNbNF0gPSB7XG4gIGludm9rZTogZnVuY3Rpb24gaW52b2tlKGNvbnRhaW5lciwgVHlwZSwgZGVwcykge1xuICAgIHJldHVybiBuZXcgVHlwZShjb250YWluZXIuZ2V0KGRlcHNbMF0pLCBjb250YWluZXIuZ2V0KGRlcHNbMV0pLCBjb250YWluZXIuZ2V0KGRlcHNbMl0pLCBjb250YWluZXIuZ2V0KGRlcHNbM10pKTtcbiAgfSxcblxuICBpbnZva2VXaXRoRHluYW1pY0RlcGVuZGVuY2llczogaW52b2tlV2l0aER5bmFtaWNEZXBlbmRlbmNpZXNcbn0sIF9jbGFzc0ludm9rZXJzWzVdID0ge1xuICBpbnZva2U6IGZ1bmN0aW9uIGludm9rZShjb250YWluZXIsIFR5cGUsIGRlcHMpIHtcbiAgICByZXR1cm4gbmV3IFR5cGUoY29udGFpbmVyLmdldChkZXBzWzBdKSwgY29udGFpbmVyLmdldChkZXBzWzFdKSwgY29udGFpbmVyLmdldChkZXBzWzJdKSwgY29udGFpbmVyLmdldChkZXBzWzNdKSwgY29udGFpbmVyLmdldChkZXBzWzRdKSk7XG4gIH0sXG5cbiAgaW52b2tlV2l0aER5bmFtaWNEZXBlbmRlbmNpZXM6IGludm9rZVdpdGhEeW5hbWljRGVwZW5kZW5jaWVzXG59LCBfY2xhc3NJbnZva2Vycy5mYWxsYmFjayA9IHtcbiAgaW52b2tlOiBpbnZva2VXaXRoRHluYW1pY0RlcGVuZGVuY2llcyxcbiAgaW52b2tlV2l0aER5bmFtaWNEZXBlbmRlbmNpZXM6IGludm9rZVdpdGhEeW5hbWljRGVwZW5kZW5jaWVzXG59LCBfY2xhc3NJbnZva2Vycyk7XG5cbmZ1bmN0aW9uIGdldERlcGVuZGVuY2llcyhmKSB7XG4gIGlmICghZi5oYXNPd25Qcm9wZXJ0eSgnaW5qZWN0JykpIHtcbiAgICByZXR1cm4gW107XG4gIH1cblxuICBpZiAodHlwZW9mIGYuaW5qZWN0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIGYuaW5qZWN0KCk7XG4gIH1cblxuICByZXR1cm4gZi5pbmplY3Q7XG59XG5cbnZhciBDb250YWluZXIgPSBleHBvcnRzLkNvbnRhaW5lciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQ29udGFpbmVyKGNvbmZpZ3VyYXRpb24pIHtcbiAgICBcblxuICAgIGlmIChjb25maWd1cmF0aW9uID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGNvbmZpZ3VyYXRpb24gPSB7fTtcbiAgICB9XG5cbiAgICB0aGlzLl9jb25maWd1cmF0aW9uID0gY29uZmlndXJhdGlvbjtcbiAgICB0aGlzLl9vbkhhbmRsZXJDcmVhdGVkID0gY29uZmlndXJhdGlvbi5vbkhhbmRsZXJDcmVhdGVkO1xuICAgIHRoaXMuX2hhbmRsZXJzID0gY29uZmlndXJhdGlvbi5oYW5kbGVycyB8fCAoY29uZmlndXJhdGlvbi5oYW5kbGVycyA9IG5ldyBNYXAoKSk7XG4gICAgdGhpcy5fcmVzb2x2ZXJzID0gbmV3IE1hcCgpO1xuICAgIHRoaXMucm9vdCA9IHRoaXM7XG4gICAgdGhpcy5wYXJlbnQgPSBudWxsO1xuICB9XG5cbiAgQ29udGFpbmVyLnByb3RvdHlwZS5tYWtlR2xvYmFsID0gZnVuY3Rpb24gbWFrZUdsb2JhbCgpIHtcbiAgICBDb250YWluZXIuaW5zdGFuY2UgPSB0aGlzO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIENvbnRhaW5lci5wcm90b3R5cGUuc2V0SGFuZGxlckNyZWF0ZWRDYWxsYmFjayA9IGZ1bmN0aW9uIHNldEhhbmRsZXJDcmVhdGVkQ2FsbGJhY2sob25IYW5kbGVyQ3JlYXRlZCkge1xuICAgIHRoaXMuX29uSGFuZGxlckNyZWF0ZWQgPSBvbkhhbmRsZXJDcmVhdGVkO1xuICAgIHRoaXMuX2NvbmZpZ3VyYXRpb24ub25IYW5kbGVyQ3JlYXRlZCA9IG9uSGFuZGxlckNyZWF0ZWQ7XG4gIH07XG5cbiAgQ29udGFpbmVyLnByb3RvdHlwZS5yZWdpc3Rlckluc3RhbmNlID0gZnVuY3Rpb24gcmVnaXN0ZXJJbnN0YW5jZShrZXksIGluc3RhbmNlKSB7XG4gICAgcmV0dXJuIHRoaXMucmVnaXN0ZXJSZXNvbHZlcihrZXksIG5ldyBTdHJhdGVneVJlc29sdmVyKDAsIGluc3RhbmNlID09PSB1bmRlZmluZWQgPyBrZXkgOiBpbnN0YW5jZSkpO1xuICB9O1xuXG4gIENvbnRhaW5lci5wcm90b3R5cGUucmVnaXN0ZXJTaW5nbGV0b24gPSBmdW5jdGlvbiByZWdpc3RlclNpbmdsZXRvbihrZXksIGZuKSB7XG4gICAgcmV0dXJuIHRoaXMucmVnaXN0ZXJSZXNvbHZlcihrZXksIG5ldyBTdHJhdGVneVJlc29sdmVyKDEsIGZuID09PSB1bmRlZmluZWQgPyBrZXkgOiBmbikpO1xuICB9O1xuXG4gIENvbnRhaW5lci5wcm90b3R5cGUucmVnaXN0ZXJUcmFuc2llbnQgPSBmdW5jdGlvbiByZWdpc3RlclRyYW5zaWVudChrZXksIGZuKSB7XG4gICAgcmV0dXJuIHRoaXMucmVnaXN0ZXJSZXNvbHZlcihrZXksIG5ldyBTdHJhdGVneVJlc29sdmVyKDIsIGZuID09PSB1bmRlZmluZWQgPyBrZXkgOiBmbikpO1xuICB9O1xuXG4gIENvbnRhaW5lci5wcm90b3R5cGUucmVnaXN0ZXJIYW5kbGVyID0gZnVuY3Rpb24gcmVnaXN0ZXJIYW5kbGVyKGtleSwgaGFuZGxlcikge1xuICAgIHJldHVybiB0aGlzLnJlZ2lzdGVyUmVzb2x2ZXIoa2V5LCBuZXcgU3RyYXRlZ3lSZXNvbHZlcigzLCBoYW5kbGVyKSk7XG4gIH07XG5cbiAgQ29udGFpbmVyLnByb3RvdHlwZS5yZWdpc3RlckFsaWFzID0gZnVuY3Rpb24gcmVnaXN0ZXJBbGlhcyhvcmlnaW5hbEtleSwgYWxpYXNLZXkpIHtcbiAgICByZXR1cm4gdGhpcy5yZWdpc3RlclJlc29sdmVyKGFsaWFzS2V5LCBuZXcgU3RyYXRlZ3lSZXNvbHZlcig1LCBvcmlnaW5hbEtleSkpO1xuICB9O1xuXG4gIENvbnRhaW5lci5wcm90b3R5cGUucmVnaXN0ZXJSZXNvbHZlciA9IGZ1bmN0aW9uIHJlZ2lzdGVyUmVzb2x2ZXIoa2V5LCByZXNvbHZlcikge1xuICAgIGlmIChrZXkgPT09IG51bGwgfHwga2V5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihiYWRLZXlFcnJvcik7XG4gICAgfVxuXG4gICAgdmFyIGFsbFJlc29sdmVycyA9IHRoaXMuX3Jlc29sdmVycztcbiAgICB2YXIgcmVzdWx0ID0gYWxsUmVzb2x2ZXJzLmdldChrZXkpO1xuXG4gICAgaWYgKHJlc3VsdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBhbGxSZXNvbHZlcnMuc2V0KGtleSwgcmVzb2x2ZXIpO1xuICAgIH0gZWxzZSBpZiAocmVzdWx0LnN0cmF0ZWd5ID09PSA0KSB7XG4gICAgICByZXN1bHQuc3RhdGUucHVzaChyZXNvbHZlcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFsbFJlc29sdmVycy5zZXQoa2V5LCBuZXcgU3RyYXRlZ3lSZXNvbHZlcig0LCBbcmVzdWx0LCByZXNvbHZlcl0pKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzb2x2ZXI7XG4gIH07XG5cbiAgQ29udGFpbmVyLnByb3RvdHlwZS5hdXRvUmVnaXN0ZXIgPSBmdW5jdGlvbiBhdXRvUmVnaXN0ZXIoa2V5LCBmbikge1xuICAgIGZuID0gZm4gPT09IHVuZGVmaW5lZCA/IGtleSA6IGZuO1xuXG4gICAgaWYgKHR5cGVvZiBmbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdmFyIF9yZWdpc3RyYXRpb24gPSBfYXVyZWxpYU1ldGFkYXRhLm1ldGFkYXRhLmdldChfYXVyZWxpYU1ldGFkYXRhLm1ldGFkYXRhLnJlZ2lzdHJhdGlvbiwgZm4pO1xuXG4gICAgICBpZiAoX3JlZ2lzdHJhdGlvbiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlZ2lzdGVyUmVzb2x2ZXIoa2V5LCBuZXcgU3RyYXRlZ3lSZXNvbHZlcigxLCBmbikpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gX3JlZ2lzdHJhdGlvbi5yZWdpc3RlclJlc29sdmVyKHRoaXMsIGtleSwgZm4pO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnJlZ2lzdGVyUmVzb2x2ZXIoa2V5LCBuZXcgU3RyYXRlZ3lSZXNvbHZlcigwLCBmbikpO1xuICB9O1xuXG4gIENvbnRhaW5lci5wcm90b3R5cGUuYXV0b1JlZ2lzdGVyQWxsID0gZnVuY3Rpb24gYXV0b1JlZ2lzdGVyQWxsKGZucykge1xuICAgIHZhciBpID0gZm5zLmxlbmd0aDtcbiAgICB3aGlsZSAoaS0tKSB7XG4gICAgICB0aGlzLmF1dG9SZWdpc3RlcihmbnNbaV0pO1xuICAgIH1cbiAgfTtcblxuICBDb250YWluZXIucHJvdG90eXBlLnVucmVnaXN0ZXIgPSBmdW5jdGlvbiB1bnJlZ2lzdGVyKGtleSkge1xuICAgIHRoaXMuX3Jlc29sdmVycy5kZWxldGUoa2V5KTtcbiAgfTtcblxuICBDb250YWluZXIucHJvdG90eXBlLmhhc1Jlc29sdmVyID0gZnVuY3Rpb24gaGFzUmVzb2x2ZXIoa2V5KSB7XG4gICAgdmFyIGNoZWNrUGFyZW50ID0gYXJndW1lbnRzLmxlbmd0aCA8PSAxIHx8IGFyZ3VtZW50c1sxXSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBhcmd1bWVudHNbMV07XG5cbiAgICBpZiAoa2V5ID09PSBudWxsIHx8IGtleSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYmFkS2V5RXJyb3IpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLl9yZXNvbHZlcnMuaGFzKGtleSkgfHwgY2hlY2tQYXJlbnQgJiYgdGhpcy5wYXJlbnQgIT09IG51bGwgJiYgdGhpcy5wYXJlbnQuaGFzUmVzb2x2ZXIoa2V5LCBjaGVja1BhcmVudCk7XG4gIH07XG5cbiAgQ29udGFpbmVyLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiBnZXQoa2V5KSB7XG4gICAgaWYgKGtleSA9PT0gbnVsbCB8fCBrZXkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGJhZEtleUVycm9yKTtcbiAgICB9XG5cbiAgICBpZiAoa2V5ID09PSBDb250YWluZXIpIHtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGlmIChyZXNvbHZlckRlY29yYXRlcyhrZXkpKSB7XG4gICAgICByZXR1cm4ga2V5LmdldCh0aGlzLCBrZXkpO1xuICAgIH1cblxuICAgIHZhciByZXNvbHZlciA9IHRoaXMuX3Jlc29sdmVycy5nZXQoa2V5KTtcblxuICAgIGlmIChyZXNvbHZlciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBpZiAodGhpcy5wYXJlbnQgPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXV0b1JlZ2lzdGVyKGtleSkuZ2V0KHRoaXMsIGtleSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLnBhcmVudC5fZ2V0KGtleSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc29sdmVyLmdldCh0aGlzLCBrZXkpO1xuICB9O1xuXG4gIENvbnRhaW5lci5wcm90b3R5cGUuX2dldCA9IGZ1bmN0aW9uIF9nZXQoa2V5KSB7XG4gICAgdmFyIHJlc29sdmVyID0gdGhpcy5fcmVzb2x2ZXJzLmdldChrZXkpO1xuXG4gICAgaWYgKHJlc29sdmVyID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGlmICh0aGlzLnBhcmVudCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hdXRvUmVnaXN0ZXIoa2V5KS5nZXQodGhpcywga2V5KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMucGFyZW50Ll9nZXQoa2V5KTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzb2x2ZXIuZ2V0KHRoaXMsIGtleSk7XG4gIH07XG5cbiAgQ29udGFpbmVyLnByb3RvdHlwZS5nZXRBbGwgPSBmdW5jdGlvbiBnZXRBbGwoa2V5KSB7XG4gICAgaWYgKGtleSA9PT0gbnVsbCB8fCBrZXkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGJhZEtleUVycm9yKTtcbiAgICB9XG5cbiAgICB2YXIgcmVzb2x2ZXIgPSB0aGlzLl9yZXNvbHZlcnMuZ2V0KGtleSk7XG5cbiAgICBpZiAocmVzb2x2ZXIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgaWYgKHRoaXMucGFyZW50ID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBfZW1wdHlQYXJhbWV0ZXJzO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5wYXJlbnQuZ2V0QWxsKGtleSk7XG4gICAgfVxuXG4gICAgaWYgKHJlc29sdmVyLnN0cmF0ZWd5ID09PSA0KSB7XG4gICAgICB2YXIgc3RhdGUgPSByZXNvbHZlci5zdGF0ZTtcbiAgICAgIHZhciBpID0gc3RhdGUubGVuZ3RoO1xuICAgICAgdmFyIHJlc3VsdHMgPSBuZXcgQXJyYXkoaSk7XG5cbiAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgcmVzdWx0c1tpXSA9IHN0YXRlW2ldLmdldCh0aGlzLCBrZXkpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9XG5cbiAgICByZXR1cm4gW3Jlc29sdmVyLmdldCh0aGlzLCBrZXkpXTtcbiAgfTtcblxuICBDb250YWluZXIucHJvdG90eXBlLmNyZWF0ZUNoaWxkID0gZnVuY3Rpb24gY3JlYXRlQ2hpbGQoKSB7XG4gICAgdmFyIGNoaWxkID0gbmV3IENvbnRhaW5lcih0aGlzLl9jb25maWd1cmF0aW9uKTtcbiAgICBjaGlsZC5yb290ID0gdGhpcy5yb290O1xuICAgIGNoaWxkLnBhcmVudCA9IHRoaXM7XG4gICAgcmV0dXJuIGNoaWxkO1xuICB9O1xuXG4gIENvbnRhaW5lci5wcm90b3R5cGUuaW52b2tlID0gZnVuY3Rpb24gaW52b2tlKGZuLCBkeW5hbWljRGVwZW5kZW5jaWVzKSB7XG4gICAgdHJ5IHtcbiAgICAgIHZhciBfaGFuZGxlciA9IHRoaXMuX2hhbmRsZXJzLmdldChmbik7XG5cbiAgICAgIGlmIChfaGFuZGxlciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIF9oYW5kbGVyID0gdGhpcy5fY3JlYXRlSW52b2NhdGlvbkhhbmRsZXIoZm4pO1xuICAgICAgICB0aGlzLl9oYW5kbGVycy5zZXQoZm4sIF9oYW5kbGVyKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIF9oYW5kbGVyLmludm9rZSh0aGlzLCBkeW5hbWljRGVwZW5kZW5jaWVzKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aHJvdyBuZXcgX2F1cmVsaWFQYWwuQWdncmVnYXRlRXJyb3IoJ0Vycm9yIGludm9raW5nICcgKyBmbi5uYW1lICsgJy4gQ2hlY2sgdGhlIGlubmVyIGVycm9yIGZvciBkZXRhaWxzLicsIGUsIHRydWUpO1xuICAgIH1cbiAgfTtcblxuICBDb250YWluZXIucHJvdG90eXBlLl9jcmVhdGVJbnZvY2F0aW9uSGFuZGxlciA9IGZ1bmN0aW9uIF9jcmVhdGVJbnZvY2F0aW9uSGFuZGxlcihmbikge1xuICAgIHZhciBkZXBlbmRlbmNpZXMgPSB2b2lkIDA7XG5cbiAgICBpZiAoZm4uaW5qZWN0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGRlcGVuZGVuY2llcyA9IF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEuZ2V0T3duKF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEucGFyYW1UeXBlcywgZm4pIHx8IF9lbXB0eVBhcmFtZXRlcnM7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRlcGVuZGVuY2llcyA9IFtdO1xuICAgICAgdmFyIGN0b3IgPSBmbjtcbiAgICAgIHdoaWxlICh0eXBlb2YgY3RvciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB2YXIgX2RlcGVuZGVuY2llcztcblxuICAgICAgICAoX2RlcGVuZGVuY2llcyA9IGRlcGVuZGVuY2llcykucHVzaC5hcHBseShfZGVwZW5kZW5jaWVzLCBnZXREZXBlbmRlbmNpZXMoY3RvcikpO1xuICAgICAgICBjdG9yID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKGN0b3IpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBpbnZva2VyID0gX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5nZXRPd24oX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5pbnZva2VyLCBmbikgfHwgY2xhc3NJbnZva2Vyc1tkZXBlbmRlbmNpZXMubGVuZ3RoXSB8fCBjbGFzc0ludm9rZXJzLmZhbGxiYWNrO1xuXG4gICAgdmFyIGhhbmRsZXIgPSBuZXcgSW52b2NhdGlvbkhhbmRsZXIoZm4sIGludm9rZXIsIGRlcGVuZGVuY2llcyk7XG4gICAgcmV0dXJuIHRoaXMuX29uSGFuZGxlckNyZWF0ZWQgIT09IHVuZGVmaW5lZCA/IHRoaXMuX29uSGFuZGxlckNyZWF0ZWQoaGFuZGxlcikgOiBoYW5kbGVyO1xuICB9O1xuXG4gIHJldHVybiBDb250YWluZXI7XG59KCk7XG5cbmZ1bmN0aW9uIGF1dG9pbmplY3QocG90ZW50aWFsVGFyZ2V0KSB7XG4gIHZhciBkZWNvID0gZnVuY3Rpb24gZGVjbyh0YXJnZXQpIHtcbiAgICB0YXJnZXQuaW5qZWN0ID0gX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5nZXRPd24oX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5wYXJhbVR5cGVzLCB0YXJnZXQpIHx8IF9lbXB0eVBhcmFtZXRlcnM7XG4gIH07XG5cbiAgcmV0dXJuIHBvdGVudGlhbFRhcmdldCA/IGRlY28ocG90ZW50aWFsVGFyZ2V0KSA6IGRlY287XG59XG5cbmZ1bmN0aW9uIGluamVjdCgpIHtcbiAgZm9yICh2YXIgX2xlbjIgPSBhcmd1bWVudHMubGVuZ3RoLCByZXN0ID0gQXJyYXkoX2xlbjIpLCBfa2V5MiA9IDA7IF9rZXkyIDwgX2xlbjI7IF9rZXkyKyspIHtcbiAgICByZXN0W19rZXkyXSA9IGFyZ3VtZW50c1tfa2V5Ml07XG4gIH1cblxuICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5LCBkZXNjcmlwdG9yKSB7XG4gICAgaWYgKGRlc2NyaXB0b3IpIHtcbiAgICAgIHZhciBfZm4gPSBkZXNjcmlwdG9yLnZhbHVlO1xuICAgICAgX2ZuLmluamVjdCA9IHJlc3Q7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRhcmdldC5pbmplY3QgPSByZXN0O1xuICAgIH1cbiAgfTtcbn1cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbi9kaXN0L2NvbW1vbmpzL2F1cmVsaWEtZGVwZW5kZW5jeS1pbmplY3Rpb24uanNcbi8vIG1vZHVsZSBpZCA9IDBcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5UZW1wbGF0aW5nRW5naW5lID0gZXhwb3J0cy5FbGVtZW50Q29uZmlnUmVzb3VyY2UgPSBleHBvcnRzLkNvbXBvc2l0aW9uRW5naW5lID0gZXhwb3J0cy5IdG1sQmVoYXZpb3JSZXNvdXJjZSA9IGV4cG9ydHMuQmluZGFibGVQcm9wZXJ0eSA9IGV4cG9ydHMuQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyID0gZXhwb3J0cy5Db250cm9sbGVyID0gZXhwb3J0cy5WaWV3RW5naW5lID0gZXhwb3J0cy5Nb2R1bGVBbmFseXplciA9IGV4cG9ydHMuUmVzb3VyY2VEZXNjcmlwdGlvbiA9IGV4cG9ydHMuUmVzb3VyY2VNb2R1bGUgPSBleHBvcnRzLlZpZXdDb21waWxlciA9IGV4cG9ydHMuVmlld0ZhY3RvcnkgPSBleHBvcnRzLkJvdW5kVmlld0ZhY3RvcnkgPSBleHBvcnRzLlZpZXdTbG90ID0gZXhwb3J0cy5WaWV3ID0gZXhwb3J0cy5WaWV3UmVzb3VyY2VzID0gZXhwb3J0cy5TaGFkb3dET00gPSBleHBvcnRzLlNoYWRvd1Nsb3QgPSBleHBvcnRzLlBhc3NUaHJvdWdoU2xvdCA9IGV4cG9ydHMuU2xvdEN1c3RvbUF0dHJpYnV0ZSA9IGV4cG9ydHMuQmluZGluZ0xhbmd1YWdlID0gZXhwb3J0cy5WaWV3TG9jYXRvciA9IGV4cG9ydHMuSW5saW5lVmlld1N0cmF0ZWd5ID0gZXhwb3J0cy5UZW1wbGF0ZVJlZ2lzdHJ5Vmlld1N0cmF0ZWd5ID0gZXhwb3J0cy5Ob1ZpZXdTdHJhdGVneSA9IGV4cG9ydHMuQ29udmVudGlvbmFsVmlld1N0cmF0ZWd5ID0gZXhwb3J0cy5SZWxhdGl2ZVZpZXdTdHJhdGVneSA9IGV4cG9ydHMudmlld1N0cmF0ZWd5ID0gZXhwb3J0cy5UYXJnZXRJbnN0cnVjdGlvbiA9IGV4cG9ydHMuQmVoYXZpb3JJbnN0cnVjdGlvbiA9IGV4cG9ydHMuVmlld0NvbXBpbGVJbnN0cnVjdGlvbiA9IGV4cG9ydHMuUmVzb3VyY2VMb2FkQ29udGV4dCA9IGV4cG9ydHMuRWxlbWVudEV2ZW50cyA9IGV4cG9ydHMuVmlld0VuZ2luZUhvb2tzUmVzb3VyY2UgPSBleHBvcnRzLkNvbXBvc2l0aW9uVHJhbnNhY3Rpb24gPSBleHBvcnRzLkNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbiA9IGV4cG9ydHMuQ29tcG9zaXRpb25UcmFuc2FjdGlvbk5vdGlmaWVyID0gZXhwb3J0cy5BbmltYXRvciA9IGV4cG9ydHMuYW5pbWF0aW9uRXZlbnQgPSB1bmRlZmluZWQ7XG5cbnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7XG5cbnZhciBfY2xhc3M0LCBfdGVtcCwgX2RlYywgX2NsYXNzNSwgX2RlYzIsIF9jbGFzczYsIF9kZWMzLCBfY2xhc3M3LCBfZGVjNCwgX2NsYXNzOCwgX2RlYzUsIF9jbGFzczksIF9jbGFzczEwLCBfdGVtcDIsIF9kZWM2LCBfY2xhc3MxMSwgX2NsYXNzMTIsIF90ZW1wMywgX2NsYXNzMTUsIF9kZWM3LCBfY2xhc3MxNywgX2RlYzgsIF9jbGFzczE4LCBfZGVjOSwgX2NsYXNzMjAsIF9kZWMxMCwgX2NsYXNzMjEsIF9kZWMxMSwgX2NsYXNzMjI7XG5cbnZhciBfdHlwZW9mID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09IFwic3ltYm9sXCIgPyBmdW5jdGlvbiAob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9IDogZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCA/IFwic3ltYm9sXCIgOiB0eXBlb2Ygb2JqOyB9O1xuXG5leHBvcnRzLl9oeXBoZW5hdGUgPSBfaHlwaGVuYXRlO1xuZXhwb3J0cy5faXNBbGxXaGl0ZXNwYWNlID0gX2lzQWxsV2hpdGVzcGFjZTtcbmV4cG9ydHMudmlld0VuZ2luZUhvb2tzID0gdmlld0VuZ2luZUhvb2tzO1xuZXhwb3J0cy5jaGlsZHJlbiA9IGNoaWxkcmVuO1xuZXhwb3J0cy5jaGlsZCA9IGNoaWxkO1xuZXhwb3J0cy5yZXNvdXJjZSA9IHJlc291cmNlO1xuZXhwb3J0cy5iZWhhdmlvciA9IGJlaGF2aW9yO1xuZXhwb3J0cy5jdXN0b21FbGVtZW50ID0gY3VzdG9tRWxlbWVudDtcbmV4cG9ydHMuY3VzdG9tQXR0cmlidXRlID0gY3VzdG9tQXR0cmlidXRlO1xuZXhwb3J0cy50ZW1wbGF0ZUNvbnRyb2xsZXIgPSB0ZW1wbGF0ZUNvbnRyb2xsZXI7XG5leHBvcnRzLmJpbmRhYmxlID0gYmluZGFibGU7XG5leHBvcnRzLmR5bmFtaWNPcHRpb25zID0gZHluYW1pY09wdGlvbnM7XG5leHBvcnRzLnVzZVNoYWRvd0RPTSA9IHVzZVNoYWRvd0RPTTtcbmV4cG9ydHMucHJvY2Vzc0F0dHJpYnV0ZXMgPSBwcm9jZXNzQXR0cmlidXRlcztcbmV4cG9ydHMucHJvY2Vzc0NvbnRlbnQgPSBwcm9jZXNzQ29udGVudDtcbmV4cG9ydHMuY29udGFpbmVybGVzcyA9IGNvbnRhaW5lcmxlc3M7XG5leHBvcnRzLnVzZVZpZXdTdHJhdGVneSA9IHVzZVZpZXdTdHJhdGVneTtcbmV4cG9ydHMudXNlVmlldyA9IHVzZVZpZXc7XG5leHBvcnRzLmlubGluZVZpZXcgPSBpbmxpbmVWaWV3O1xuZXhwb3J0cy5ub1ZpZXcgPSBub1ZpZXc7XG5leHBvcnRzLmVsZW1lbnRDb25maWcgPSBlbGVtZW50Q29uZmlnO1xuXG52YXIgX2F1cmVsaWFMb2dnaW5nID0gcmVxdWlyZSgnYXVyZWxpYS1sb2dnaW5nJyk7XG5cbnZhciBMb2dNYW5hZ2VyID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQoX2F1cmVsaWFMb2dnaW5nKTtcblxudmFyIF9hdXJlbGlhTWV0YWRhdGEgPSByZXF1aXJlKCdhdXJlbGlhLW1ldGFkYXRhJyk7XG5cbnZhciBfYXVyZWxpYVBhbCA9IHJlcXVpcmUoJ2F1cmVsaWEtcGFsJyk7XG5cbnZhciBfYXVyZWxpYVBhdGggPSByZXF1aXJlKCdhdXJlbGlhLXBhdGgnKTtcblxudmFyIF9hdXJlbGlhTG9hZGVyID0gcmVxdWlyZSgnYXVyZWxpYS1sb2FkZXInKTtcblxudmFyIF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbiA9IHJlcXVpcmUoJ2F1cmVsaWEtZGVwZW5kZW5jeS1pbmplY3Rpb24nKTtcblxudmFyIF9hdXJlbGlhQmluZGluZyA9IHJlcXVpcmUoJ2F1cmVsaWEtYmluZGluZycpO1xuXG52YXIgX2F1cmVsaWFUYXNrUXVldWUgPSByZXF1aXJlKCdhdXJlbGlhLXRhc2stcXVldWUnKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7IGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsgcmV0dXJuIG9iajsgfSBlbHNlIHsgdmFyIG5ld09iaiA9IHt9OyBpZiAob2JqICE9IG51bGwpIHsgZm9yICh2YXIga2V5IGluIG9iaikgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsgfSB9IG5ld09iai5kZWZhdWx0ID0gb2JqOyByZXR1cm4gbmV3T2JqOyB9IH1cblxuXG5cbnZhciBhbmltYXRpb25FdmVudCA9IGV4cG9ydHMuYW5pbWF0aW9uRXZlbnQgPSB7XG4gIGVudGVyQmVnaW46ICdhbmltYXRpb246ZW50ZXI6YmVnaW4nLFxuICBlbnRlckFjdGl2ZTogJ2FuaW1hdGlvbjplbnRlcjphY3RpdmUnLFxuICBlbnRlckRvbmU6ICdhbmltYXRpb246ZW50ZXI6ZG9uZScsXG4gIGVudGVyVGltZW91dDogJ2FuaW1hdGlvbjplbnRlcjp0aW1lb3V0JyxcblxuICBsZWF2ZUJlZ2luOiAnYW5pbWF0aW9uOmxlYXZlOmJlZ2luJyxcbiAgbGVhdmVBY3RpdmU6ICdhbmltYXRpb246bGVhdmU6YWN0aXZlJyxcbiAgbGVhdmVEb25lOiAnYW5pbWF0aW9uOmxlYXZlOmRvbmUnLFxuICBsZWF2ZVRpbWVvdXQ6ICdhbmltYXRpb246bGVhdmU6dGltZW91dCcsXG5cbiAgc3RhZ2dlck5leHQ6ICdhbmltYXRpb246c3RhZ2dlcjpuZXh0JyxcblxuICByZW1vdmVDbGFzc0JlZ2luOiAnYW5pbWF0aW9uOnJlbW92ZS1jbGFzczpiZWdpbicsXG4gIHJlbW92ZUNsYXNzQWN0aXZlOiAnYW5pbWF0aW9uOnJlbW92ZS1jbGFzczphY3RpdmUnLFxuICByZW1vdmVDbGFzc0RvbmU6ICdhbmltYXRpb246cmVtb3ZlLWNsYXNzOmRvbmUnLFxuICByZW1vdmVDbGFzc1RpbWVvdXQ6ICdhbmltYXRpb246cmVtb3ZlLWNsYXNzOnRpbWVvdXQnLFxuXG4gIGFkZENsYXNzQmVnaW46ICdhbmltYXRpb246YWRkLWNsYXNzOmJlZ2luJyxcbiAgYWRkQ2xhc3NBY3RpdmU6ICdhbmltYXRpb246YWRkLWNsYXNzOmFjdGl2ZScsXG4gIGFkZENsYXNzRG9uZTogJ2FuaW1hdGlvbjphZGQtY2xhc3M6ZG9uZScsXG4gIGFkZENsYXNzVGltZW91dDogJ2FuaW1hdGlvbjphZGQtY2xhc3M6dGltZW91dCcsXG5cbiAgYW5pbWF0ZUJlZ2luOiAnYW5pbWF0aW9uOmFuaW1hdGU6YmVnaW4nLFxuICBhbmltYXRlQWN0aXZlOiAnYW5pbWF0aW9uOmFuaW1hdGU6YWN0aXZlJyxcbiAgYW5pbWF0ZURvbmU6ICdhbmltYXRpb246YW5pbWF0ZTpkb25lJyxcbiAgYW5pbWF0ZVRpbWVvdXQ6ICdhbmltYXRpb246YW5pbWF0ZTp0aW1lb3V0JyxcblxuICBzZXF1ZW5jZUJlZ2luOiAnYW5pbWF0aW9uOnNlcXVlbmNlOmJlZ2luJyxcbiAgc2VxdWVuY2VEb25lOiAnYW5pbWF0aW9uOnNlcXVlbmNlOmRvbmUnXG59O1xuXG52YXIgQW5pbWF0b3IgPSBleHBvcnRzLkFuaW1hdG9yID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBBbmltYXRvcigpIHtcbiAgICBcbiAgfVxuXG4gIEFuaW1hdG9yLnByb3RvdHlwZS5lbnRlciA9IGZ1bmN0aW9uIGVudGVyKGVsZW1lbnQpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKTtcbiAgfTtcblxuICBBbmltYXRvci5wcm90b3R5cGUubGVhdmUgPSBmdW5jdGlvbiBsZWF2ZShlbGVtZW50KSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShmYWxzZSk7XG4gIH07XG5cbiAgQW5pbWF0b3IucHJvdG90eXBlLnJlbW92ZUNsYXNzID0gZnVuY3Rpb24gcmVtb3ZlQ2xhc3MoZWxlbWVudCwgY2xhc3NOYW1lKSB7XG4gICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzTmFtZSk7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShmYWxzZSk7XG4gIH07XG5cbiAgQW5pbWF0b3IucHJvdG90eXBlLmFkZENsYXNzID0gZnVuY3Rpb24gYWRkQ2xhc3MoZWxlbWVudCwgY2xhc3NOYW1lKSB7XG4gICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShmYWxzZSk7XG4gIH07XG5cbiAgQW5pbWF0b3IucHJvdG90eXBlLmFuaW1hdGUgPSBmdW5jdGlvbiBhbmltYXRlKGVsZW1lbnQsIGNsYXNzTmFtZSkge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZmFsc2UpO1xuICB9O1xuXG4gIEFuaW1hdG9yLnByb3RvdHlwZS5ydW5TZXF1ZW5jZSA9IGZ1bmN0aW9uIHJ1blNlcXVlbmNlKGFuaW1hdGlvbnMpIHt9O1xuXG4gIEFuaW1hdG9yLnByb3RvdHlwZS5yZWdpc3RlckVmZmVjdCA9IGZ1bmN0aW9uIHJlZ2lzdGVyRWZmZWN0KGVmZmVjdE5hbWUsIHByb3BlcnRpZXMpIHt9O1xuXG4gIEFuaW1hdG9yLnByb3RvdHlwZS51bnJlZ2lzdGVyRWZmZWN0ID0gZnVuY3Rpb24gdW5yZWdpc3RlckVmZmVjdChlZmZlY3ROYW1lKSB7fTtcblxuICByZXR1cm4gQW5pbWF0b3I7XG59KCk7XG5cbnZhciBDb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXIgPSBleHBvcnRzLkNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQ29tcG9zaXRpb25UcmFuc2FjdGlvbk5vdGlmaWVyKG93bmVyKSB7XG4gICAgXG5cbiAgICB0aGlzLm93bmVyID0gb3duZXI7XG4gICAgdGhpcy5vd25lci5fY29tcG9zaXRpb25Db3VudCsrO1xuICB9XG5cbiAgQ29tcG9zaXRpb25UcmFuc2FjdGlvbk5vdGlmaWVyLnByb3RvdHlwZS5kb25lID0gZnVuY3Rpb24gZG9uZSgpIHtcbiAgICB0aGlzLm93bmVyLl9jb21wb3NpdGlvbkNvdW50LS07XG4gICAgdGhpcy5vd25lci5fdHJ5Q29tcGxldGVUcmFuc2FjdGlvbigpO1xuICB9O1xuXG4gIHJldHVybiBDb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXI7XG59KCk7XG5cbnZhciBDb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4gPSBleHBvcnRzLkNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbiA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQ29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuKG93bmVyKSB7XG4gICAgXG5cbiAgICB0aGlzLm93bmVyID0gb3duZXI7XG4gICAgdGhpcy5vd25lci5fb3duZXJzaGlwVG9rZW4gPSB0aGlzO1xuICAgIHRoaXMudGhlbmFibGUgPSB0aGlzLl9jcmVhdGVUaGVuYWJsZSgpO1xuICB9XG5cbiAgQ29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuLnByb3RvdHlwZS53YWl0Rm9yQ29tcG9zaXRpb25Db21wbGV0ZSA9IGZ1bmN0aW9uIHdhaXRGb3JDb21wb3NpdGlvbkNvbXBsZXRlKCkge1xuICAgIHRoaXMub3duZXIuX3RyeUNvbXBsZXRlVHJhbnNhY3Rpb24oKTtcbiAgICByZXR1cm4gdGhpcy50aGVuYWJsZTtcbiAgfTtcblxuICBDb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4ucHJvdG90eXBlLnJlc29sdmUgPSBmdW5jdGlvbiByZXNvbHZlKCkge1xuICAgIHRoaXMuX3Jlc29sdmVDYWxsYmFjaygpO1xuICB9O1xuXG4gIENvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbi5wcm90b3R5cGUuX2NyZWF0ZVRoZW5hYmxlID0gZnVuY3Rpb24gX2NyZWF0ZVRoZW5hYmxlKCkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgX3RoaXMuX3Jlc29sdmVDYWxsYmFjayA9IHJlc29sdmU7XG4gICAgfSk7XG4gIH07XG5cbiAgcmV0dXJuIENvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbjtcbn0oKTtcblxudmFyIENvbXBvc2l0aW9uVHJhbnNhY3Rpb24gPSBleHBvcnRzLkNvbXBvc2l0aW9uVHJhbnNhY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIENvbXBvc2l0aW9uVHJhbnNhY3Rpb24oKSB7XG4gICAgXG5cbiAgICB0aGlzLl9vd25lcnNoaXBUb2tlbiA9IG51bGw7XG4gICAgdGhpcy5fY29tcG9zaXRpb25Db3VudCA9IDA7XG4gIH1cblxuICBDb21wb3NpdGlvblRyYW5zYWN0aW9uLnByb3RvdHlwZS50cnlDYXB0dXJlID0gZnVuY3Rpb24gdHJ5Q2FwdHVyZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fb3duZXJzaGlwVG9rZW4gPT09IG51bGwgPyBuZXcgQ29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuKHRoaXMpIDogbnVsbDtcbiAgfTtcblxuICBDb21wb3NpdGlvblRyYW5zYWN0aW9uLnByb3RvdHlwZS5lbmxpc3QgPSBmdW5jdGlvbiBlbmxpc3QoKSB7XG4gICAgcmV0dXJuIG5ldyBDb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXIodGhpcyk7XG4gIH07XG5cbiAgQ29tcG9zaXRpb25UcmFuc2FjdGlvbi5wcm90b3R5cGUuX3RyeUNvbXBsZXRlVHJhbnNhY3Rpb24gPSBmdW5jdGlvbiBfdHJ5Q29tcGxldGVUcmFuc2FjdGlvbigpIHtcbiAgICBpZiAodGhpcy5fY29tcG9zaXRpb25Db3VudCA8PSAwKSB7XG4gICAgICB0aGlzLl9jb21wb3NpdGlvbkNvdW50ID0gMDtcblxuICAgICAgaWYgKHRoaXMuX293bmVyc2hpcFRva2VuICE9PSBudWxsKSB7XG4gICAgICAgIHZhciB0b2tlbiA9IHRoaXMuX293bmVyc2hpcFRva2VuO1xuICAgICAgICB0aGlzLl9vd25lcnNoaXBUb2tlbiA9IG51bGw7XG4gICAgICAgIHRva2VuLnJlc29sdmUoKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIENvbXBvc2l0aW9uVHJhbnNhY3Rpb247XG59KCk7XG5cbnZhciBjYXBpdGFsTWF0Y2hlciA9IC8oW0EtWl0pL2c7XG5cbmZ1bmN0aW9uIGFkZEh5cGhlbkFuZExvd2VyKGNoYXIpIHtcbiAgcmV0dXJuICctJyArIGNoYXIudG9Mb3dlckNhc2UoKTtcbn1cblxuZnVuY3Rpb24gX2h5cGhlbmF0ZShuYW1lKSB7XG4gIHJldHVybiAobmFtZS5jaGFyQXQoMCkudG9Mb3dlckNhc2UoKSArIG5hbWUuc2xpY2UoMSkpLnJlcGxhY2UoY2FwaXRhbE1hdGNoZXIsIGFkZEh5cGhlbkFuZExvd2VyKTtcbn1cblxuZnVuY3Rpb24gX2lzQWxsV2hpdGVzcGFjZShub2RlKSB7XG4gIHJldHVybiAhKG5vZGUuYXVJbnRlcnBvbGF0aW9uVGFyZ2V0IHx8IC9bXlxcdFxcblxcciBdLy50ZXN0KG5vZGUudGV4dENvbnRlbnQpKTtcbn1cblxudmFyIFZpZXdFbmdpbmVIb29rc1Jlc291cmNlID0gZXhwb3J0cy5WaWV3RW5naW5lSG9va3NSZXNvdXJjZSA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gVmlld0VuZ2luZUhvb2tzUmVzb3VyY2UoKSB7XG4gICAgXG4gIH1cblxuICBWaWV3RW5naW5lSG9va3NSZXNvdXJjZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIGluaXRpYWxpemUoY29udGFpbmVyLCB0YXJnZXQpIHtcbiAgICB0aGlzLmluc3RhbmNlID0gY29udGFpbmVyLmdldCh0YXJnZXQpO1xuICB9O1xuXG4gIFZpZXdFbmdpbmVIb29rc1Jlc291cmNlLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIHJlZ2lzdGVyKHJlZ2lzdHJ5LCBuYW1lKSB7XG4gICAgcmVnaXN0cnkucmVnaXN0ZXJWaWV3RW5naW5lSG9va3ModGhpcy5pbnN0YW5jZSk7XG4gIH07XG5cbiAgVmlld0VuZ2luZUhvb2tzUmVzb3VyY2UucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbiBsb2FkKGNvbnRhaW5lciwgdGFyZ2V0KSB7fTtcblxuICBWaWV3RW5naW5lSG9va3NSZXNvdXJjZS5jb252ZW50aW9uID0gZnVuY3Rpb24gY29udmVudGlvbihuYW1lKSB7XG4gICAgaWYgKG5hbWUuZW5kc1dpdGgoJ1ZpZXdFbmdpbmVIb29rcycpKSB7XG4gICAgICByZXR1cm4gbmV3IFZpZXdFbmdpbmVIb29rc1Jlc291cmNlKCk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBWaWV3RW5naW5lSG9va3NSZXNvdXJjZTtcbn0oKTtcblxuZnVuY3Rpb24gdmlld0VuZ2luZUhvb2tzKHRhcmdldCkge1xuICB2YXIgZGVjbyA9IGZ1bmN0aW9uIGRlY28odCkge1xuICAgIF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEuZGVmaW5lKF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEucmVzb3VyY2UsIG5ldyBWaWV3RW5naW5lSG9va3NSZXNvdXJjZSgpLCB0KTtcbiAgfTtcblxuICByZXR1cm4gdGFyZ2V0ID8gZGVjbyh0YXJnZXQpIDogZGVjbztcbn1cblxudmFyIEVsZW1lbnRFdmVudHMgPSBleHBvcnRzLkVsZW1lbnRFdmVudHMgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEVsZW1lbnRFdmVudHMoZWxlbWVudCkge1xuICAgIFxuXG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSB7fTtcbiAgfVxuXG4gIEVsZW1lbnRFdmVudHMucHJvdG90eXBlLl9lbnF1ZXVlSGFuZGxlciA9IGZ1bmN0aW9uIF9lbnF1ZXVlSGFuZGxlcihoYW5kbGVyKSB7XG4gICAgdGhpcy5zdWJzY3JpcHRpb25zW2hhbmRsZXIuZXZlbnROYW1lXSA9IHRoaXMuc3Vic2NyaXB0aW9uc1toYW5kbGVyLmV2ZW50TmFtZV0gfHwgW107XG4gICAgdGhpcy5zdWJzY3JpcHRpb25zW2hhbmRsZXIuZXZlbnROYW1lXS5wdXNoKGhhbmRsZXIpO1xuICB9O1xuXG4gIEVsZW1lbnRFdmVudHMucHJvdG90eXBlLl9kZXF1ZXVlSGFuZGxlciA9IGZ1bmN0aW9uIF9kZXF1ZXVlSGFuZGxlcihoYW5kbGVyKSB7XG4gICAgdmFyIGluZGV4ID0gdm9pZCAwO1xuICAgIHZhciBzdWJzY3JpcHRpb25zID0gdGhpcy5zdWJzY3JpcHRpb25zW2hhbmRsZXIuZXZlbnROYW1lXTtcbiAgICBpZiAoc3Vic2NyaXB0aW9ucykge1xuICAgICAgaW5kZXggPSBzdWJzY3JpcHRpb25zLmluZGV4T2YoaGFuZGxlcik7XG4gICAgICBpZiAoaW5kZXggPiAtMSkge1xuICAgICAgICBzdWJzY3JpcHRpb25zLnNwbGljZShpbmRleCwgMSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBoYW5kbGVyO1xuICB9O1xuXG4gIEVsZW1lbnRFdmVudHMucHJvdG90eXBlLnB1Ymxpc2ggPSBmdW5jdGlvbiBwdWJsaXNoKGV2ZW50TmFtZSkge1xuICAgIHZhciBkZXRhaWwgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDEgfHwgYXJndW1lbnRzWzFdID09PSB1bmRlZmluZWQgPyB7fSA6IGFyZ3VtZW50c1sxXTtcbiAgICB2YXIgYnViYmxlcyA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMiB8fCBhcmd1bWVudHNbMl0gPT09IHVuZGVmaW5lZCA/IHRydWUgOiBhcmd1bWVudHNbMl07XG4gICAgdmFyIGNhbmNlbGFibGUgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDMgfHwgYXJndW1lbnRzWzNdID09PSB1bmRlZmluZWQgPyB0cnVlIDogYXJndW1lbnRzWzNdO1xuXG4gICAgdmFyIGV2ZW50ID0gX2F1cmVsaWFQYWwuRE9NLmNyZWF0ZUN1c3RvbUV2ZW50KGV2ZW50TmFtZSwgeyBjYW5jZWxhYmxlOiBjYW5jZWxhYmxlLCBidWJibGVzOiBidWJibGVzLCBkZXRhaWw6IGRldGFpbCB9KTtcbiAgICB0aGlzLmVsZW1lbnQuZGlzcGF0Y2hFdmVudChldmVudCk7XG4gIH07XG5cbiAgRWxlbWVudEV2ZW50cy5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gc3Vic2NyaWJlKGV2ZW50TmFtZSwgaGFuZGxlcikge1xuICAgIHZhciBfdGhpczIgPSB0aGlzO1xuXG4gICAgdmFyIGJ1YmJsZXMgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDIgfHwgYXJndW1lbnRzWzJdID09PSB1bmRlZmluZWQgPyB0cnVlIDogYXJndW1lbnRzWzJdO1xuXG4gICAgaWYgKGhhbmRsZXIgJiYgdHlwZW9mIGhhbmRsZXIgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGhhbmRsZXIuZXZlbnROYW1lID0gZXZlbnROYW1lO1xuICAgICAgaGFuZGxlci5oYW5kbGVyID0gaGFuZGxlcjtcbiAgICAgIGhhbmRsZXIuYnViYmxlcyA9IGJ1YmJsZXM7XG4gICAgICBoYW5kbGVyLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIF90aGlzMi5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBoYW5kbGVyLCBidWJibGVzKTtcbiAgICAgICAgX3RoaXMyLl9kZXF1ZXVlSGFuZGxlcihoYW5kbGVyKTtcbiAgICAgIH07XG4gICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGhhbmRsZXIsIGJ1YmJsZXMpO1xuICAgICAgdGhpcy5fZW5xdWV1ZUhhbmRsZXIoaGFuZGxlcik7XG4gICAgICByZXR1cm4gaGFuZGxlcjtcbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9O1xuXG4gIEVsZW1lbnRFdmVudHMucHJvdG90eXBlLnN1YnNjcmliZU9uY2UgPSBmdW5jdGlvbiBzdWJzY3JpYmVPbmNlKGV2ZW50TmFtZSwgaGFuZGxlcikge1xuICAgIHZhciBfdGhpczMgPSB0aGlzO1xuXG4gICAgdmFyIGJ1YmJsZXMgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDIgfHwgYXJndW1lbnRzWzJdID09PSB1bmRlZmluZWQgPyB0cnVlIDogYXJndW1lbnRzWzJdO1xuXG4gICAgaWYgKGhhbmRsZXIgJiYgdHlwZW9mIGhhbmRsZXIgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHZhciBfcmV0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX2hhbmRsZXIgPSBmdW5jdGlvbiBfaGFuZGxlcihldmVudCkge1xuICAgICAgICAgIGhhbmRsZXIoZXZlbnQpO1xuICAgICAgICAgIF9oYW5kbGVyLmRpc3Bvc2UoKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2OiBfdGhpczMuc3Vic2NyaWJlKGV2ZW50TmFtZSwgX2hhbmRsZXIsIGJ1YmJsZXMpXG4gICAgICAgIH07XG4gICAgICB9KCk7XG5cbiAgICAgIGlmICgodHlwZW9mIF9yZXQgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKF9yZXQpKSA9PT0gXCJvYmplY3RcIikgcmV0dXJuIF9yZXQudjtcbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9O1xuXG4gIEVsZW1lbnRFdmVudHMucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiBkaXNwb3NlKGV2ZW50TmFtZSkge1xuICAgIGlmIChldmVudE5hbWUgJiYgdHlwZW9mIGV2ZW50TmFtZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHZhciBzdWJzY3JpcHRpb25zID0gdGhpcy5zdWJzY3JpcHRpb25zW2V2ZW50TmFtZV07XG4gICAgICBpZiAoc3Vic2NyaXB0aW9ucykge1xuICAgICAgICB3aGlsZSAoc3Vic2NyaXB0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgICB2YXIgc3Vic2NyaXB0aW9uID0gc3Vic2NyaXB0aW9ucy5wb3AoKTtcbiAgICAgICAgICBpZiAoc3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICBzdWJzY3JpcHRpb24uZGlzcG9zZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRpc3Bvc2VBbGwoKTtcbiAgICB9XG4gIH07XG5cbiAgRWxlbWVudEV2ZW50cy5wcm90b3R5cGUuZGlzcG9zZUFsbCA9IGZ1bmN0aW9uIGRpc3Bvc2VBbGwoKSB7XG4gICAgZm9yICh2YXIga2V5IGluIHRoaXMuc3Vic2NyaXB0aW9ucykge1xuICAgICAgdGhpcy5kaXNwb3NlKGtleSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBFbGVtZW50RXZlbnRzO1xufSgpO1xuXG52YXIgUmVzb3VyY2VMb2FkQ29udGV4dCA9IGV4cG9ydHMuUmVzb3VyY2VMb2FkQ29udGV4dCA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gUmVzb3VyY2VMb2FkQ29udGV4dCgpIHtcbiAgICBcblxuICAgIHRoaXMuZGVwZW5kZW5jaWVzID0ge307XG4gIH1cblxuICBSZXNvdXJjZUxvYWRDb250ZXh0LnByb3RvdHlwZS5hZGREZXBlbmRlbmN5ID0gZnVuY3Rpb24gYWRkRGVwZW5kZW5jeSh1cmwpIHtcbiAgICB0aGlzLmRlcGVuZGVuY2llc1t1cmxdID0gdHJ1ZTtcbiAgfTtcblxuICBSZXNvdXJjZUxvYWRDb250ZXh0LnByb3RvdHlwZS5oYXNEZXBlbmRlbmN5ID0gZnVuY3Rpb24gaGFzRGVwZW5kZW5jeSh1cmwpIHtcbiAgICByZXR1cm4gdXJsIGluIHRoaXMuZGVwZW5kZW5jaWVzO1xuICB9O1xuXG4gIHJldHVybiBSZXNvdXJjZUxvYWRDb250ZXh0O1xufSgpO1xuXG52YXIgVmlld0NvbXBpbGVJbnN0cnVjdGlvbiA9IGV4cG9ydHMuVmlld0NvbXBpbGVJbnN0cnVjdGlvbiA9IGZ1bmN0aW9uIFZpZXdDb21waWxlSW5zdHJ1Y3Rpb24oKSB7XG4gIHZhciB0YXJnZXRTaGFkb3dET00gPSBhcmd1bWVudHMubGVuZ3RoIDw9IDAgfHwgYXJndW1lbnRzWzBdID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IGFyZ3VtZW50c1swXTtcbiAgdmFyIGNvbXBpbGVTdXJyb2dhdGUgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDEgfHwgYXJndW1lbnRzWzFdID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IGFyZ3VtZW50c1sxXTtcblxuICBcblxuICB0aGlzLnRhcmdldFNoYWRvd0RPTSA9IHRhcmdldFNoYWRvd0RPTTtcbiAgdGhpcy5jb21waWxlU3Vycm9nYXRlID0gY29tcGlsZVN1cnJvZ2F0ZTtcbiAgdGhpcy5hc3NvY2lhdGVkTW9kdWxlSWQgPSBudWxsO1xufTtcblxuVmlld0NvbXBpbGVJbnN0cnVjdGlvbi5ub3JtYWwgPSBuZXcgVmlld0NvbXBpbGVJbnN0cnVjdGlvbigpO1xuXG52YXIgQmVoYXZpb3JJbnN0cnVjdGlvbiA9IGV4cG9ydHMuQmVoYXZpb3JJbnN0cnVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgQmVoYXZpb3JJbnN0cnVjdGlvbi5lbmhhbmNlID0gZnVuY3Rpb24gZW5oYW5jZSgpIHtcbiAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBuZXcgQmVoYXZpb3JJbnN0cnVjdGlvbigpO1xuICAgIGluc3RydWN0aW9uLmVuaGFuY2UgPSB0cnVlO1xuICAgIHJldHVybiBpbnN0cnVjdGlvbjtcbiAgfTtcblxuICBCZWhhdmlvckluc3RydWN0aW9uLnVuaXRUZXN0ID0gZnVuY3Rpb24gdW5pdFRlc3QodHlwZSwgYXR0cmlidXRlcykge1xuICAgIHZhciBpbnN0cnVjdGlvbiA9IG5ldyBCZWhhdmlvckluc3RydWN0aW9uKCk7XG4gICAgaW5zdHJ1Y3Rpb24udHlwZSA9IHR5cGU7XG4gICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlcyA9IGF0dHJpYnV0ZXMgfHwge307XG4gICAgcmV0dXJuIGluc3RydWN0aW9uO1xuICB9O1xuXG4gIEJlaGF2aW9ySW5zdHJ1Y3Rpb24uZWxlbWVudCA9IGZ1bmN0aW9uIGVsZW1lbnQobm9kZSwgdHlwZSkge1xuICAgIHZhciBpbnN0cnVjdGlvbiA9IG5ldyBCZWhhdmlvckluc3RydWN0aW9uKCk7XG4gICAgaW5zdHJ1Y3Rpb24udHlwZSA9IHR5cGU7XG4gICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlcyA9IHt9O1xuICAgIGluc3RydWN0aW9uLmFuY2hvcklzQ29udGFpbmVyID0gIShub2RlLmhhc0F0dHJpYnV0ZSgnY29udGFpbmVybGVzcycpIHx8IHR5cGUuY29udGFpbmVybGVzcyk7XG4gICAgaW5zdHJ1Y3Rpb24uaW5pdGlhdGVkQnlCZWhhdmlvciA9IHRydWU7XG4gICAgcmV0dXJuIGluc3RydWN0aW9uO1xuICB9O1xuXG4gIEJlaGF2aW9ySW5zdHJ1Y3Rpb24uYXR0cmlidXRlID0gZnVuY3Rpb24gYXR0cmlidXRlKGF0dHJOYW1lLCB0eXBlKSB7XG4gICAgdmFyIGluc3RydWN0aW9uID0gbmV3IEJlaGF2aW9ySW5zdHJ1Y3Rpb24oKTtcbiAgICBpbnN0cnVjdGlvbi5hdHRyTmFtZSA9IGF0dHJOYW1lO1xuICAgIGluc3RydWN0aW9uLnR5cGUgPSB0eXBlIHx8IG51bGw7XG4gICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlcyA9IHt9O1xuICAgIHJldHVybiBpbnN0cnVjdGlvbjtcbiAgfTtcblxuICBCZWhhdmlvckluc3RydWN0aW9uLmR5bmFtaWMgPSBmdW5jdGlvbiBkeW5hbWljKGhvc3QsIHZpZXdNb2RlbCwgdmlld0ZhY3RvcnkpIHtcbiAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBuZXcgQmVoYXZpb3JJbnN0cnVjdGlvbigpO1xuICAgIGluc3RydWN0aW9uLmhvc3QgPSBob3N0O1xuICAgIGluc3RydWN0aW9uLnZpZXdNb2RlbCA9IHZpZXdNb2RlbDtcbiAgICBpbnN0cnVjdGlvbi52aWV3RmFjdG9yeSA9IHZpZXdGYWN0b3J5O1xuICAgIGluc3RydWN0aW9uLmluaGVyaXRCaW5kaW5nQ29udGV4dCA9IHRydWU7XG4gICAgcmV0dXJuIGluc3RydWN0aW9uO1xuICB9O1xuXG4gIGZ1bmN0aW9uIEJlaGF2aW9ySW5zdHJ1Y3Rpb24oKSB7XG4gICAgXG5cbiAgICB0aGlzLmluaXRpYXRlZEJ5QmVoYXZpb3IgPSBmYWxzZTtcbiAgICB0aGlzLmVuaGFuY2UgPSBmYWxzZTtcbiAgICB0aGlzLnBhcnRSZXBsYWNlbWVudHMgPSBudWxsO1xuICAgIHRoaXMudmlld0ZhY3RvcnkgPSBudWxsO1xuICAgIHRoaXMub3JpZ2luYWxBdHRyTmFtZSA9IG51bGw7XG4gICAgdGhpcy5za2lwQ29udGVudFByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICB0aGlzLmNvbnRlbnRGYWN0b3J5ID0gbnVsbDtcbiAgICB0aGlzLnZpZXdNb2RlbCA9IG51bGw7XG4gICAgdGhpcy5hbmNob3JJc0NvbnRhaW5lciA9IGZhbHNlO1xuICAgIHRoaXMuaG9zdCA9IG51bGw7XG4gICAgdGhpcy5hdHRyaWJ1dGVzID0gbnVsbDtcbiAgICB0aGlzLnR5cGUgPSBudWxsO1xuICAgIHRoaXMuYXR0ck5hbWUgPSBudWxsO1xuICAgIHRoaXMuaW5oZXJpdEJpbmRpbmdDb250ZXh0ID0gZmFsc2U7XG4gIH1cblxuICByZXR1cm4gQmVoYXZpb3JJbnN0cnVjdGlvbjtcbn0oKTtcblxuQmVoYXZpb3JJbnN0cnVjdGlvbi5ub3JtYWwgPSBuZXcgQmVoYXZpb3JJbnN0cnVjdGlvbigpO1xuXG52YXIgVGFyZ2V0SW5zdHJ1Y3Rpb24gPSBleHBvcnRzLlRhcmdldEluc3RydWN0aW9uID0gKF90ZW1wID0gX2NsYXNzNCA9IGZ1bmN0aW9uICgpIHtcbiAgVGFyZ2V0SW5zdHJ1Y3Rpb24uc2hhZG93U2xvdCA9IGZ1bmN0aW9uIHNoYWRvd1Nsb3QocGFyZW50SW5qZWN0b3JJZCkge1xuICAgIHZhciBpbnN0cnVjdGlvbiA9IG5ldyBUYXJnZXRJbnN0cnVjdGlvbigpO1xuICAgIGluc3RydWN0aW9uLnBhcmVudEluamVjdG9ySWQgPSBwYXJlbnRJbmplY3RvcklkO1xuICAgIGluc3RydWN0aW9uLnNoYWRvd1Nsb3QgPSB0cnVlO1xuICAgIHJldHVybiBpbnN0cnVjdGlvbjtcbiAgfTtcblxuICBUYXJnZXRJbnN0cnVjdGlvbi5jb250ZW50RXhwcmVzc2lvbiA9IGZ1bmN0aW9uIGNvbnRlbnRFeHByZXNzaW9uKGV4cHJlc3Npb24pIHtcbiAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBuZXcgVGFyZ2V0SW5zdHJ1Y3Rpb24oKTtcbiAgICBpbnN0cnVjdGlvbi5jb250ZW50RXhwcmVzc2lvbiA9IGV4cHJlc3Npb247XG4gICAgcmV0dXJuIGluc3RydWN0aW9uO1xuICB9O1xuXG4gIFRhcmdldEluc3RydWN0aW9uLmxpZnRpbmcgPSBmdW5jdGlvbiBsaWZ0aW5nKHBhcmVudEluamVjdG9ySWQsIGxpZnRpbmdJbnN0cnVjdGlvbikge1xuICAgIHZhciBpbnN0cnVjdGlvbiA9IG5ldyBUYXJnZXRJbnN0cnVjdGlvbigpO1xuICAgIGluc3RydWN0aW9uLnBhcmVudEluamVjdG9ySWQgPSBwYXJlbnRJbmplY3RvcklkO1xuICAgIGluc3RydWN0aW9uLmV4cHJlc3Npb25zID0gVGFyZ2V0SW5zdHJ1Y3Rpb24ubm9FeHByZXNzaW9ucztcbiAgICBpbnN0cnVjdGlvbi5iZWhhdmlvckluc3RydWN0aW9ucyA9IFtsaWZ0aW5nSW5zdHJ1Y3Rpb25dO1xuICAgIGluc3RydWN0aW9uLnZpZXdGYWN0b3J5ID0gbGlmdGluZ0luc3RydWN0aW9uLnZpZXdGYWN0b3J5O1xuICAgIGluc3RydWN0aW9uLnByb3ZpZGVycyA9IFtsaWZ0aW5nSW5zdHJ1Y3Rpb24udHlwZS50YXJnZXRdO1xuICAgIGluc3RydWN0aW9uLmxpZnRpbmcgPSB0cnVlO1xuICAgIHJldHVybiBpbnN0cnVjdGlvbjtcbiAgfTtcblxuICBUYXJnZXRJbnN0cnVjdGlvbi5ub3JtYWwgPSBmdW5jdGlvbiBub3JtYWwoaW5qZWN0b3JJZCwgcGFyZW50SW5qZWN0b3JJZCwgcHJvdmlkZXJzLCBiZWhhdmlvckluc3RydWN0aW9ucywgZXhwcmVzc2lvbnMsIGVsZW1lbnRJbnN0cnVjdGlvbikge1xuICAgIHZhciBpbnN0cnVjdGlvbiA9IG5ldyBUYXJnZXRJbnN0cnVjdGlvbigpO1xuICAgIGluc3RydWN0aW9uLmluamVjdG9ySWQgPSBpbmplY3RvcklkO1xuICAgIGluc3RydWN0aW9uLnBhcmVudEluamVjdG9ySWQgPSBwYXJlbnRJbmplY3RvcklkO1xuICAgIGluc3RydWN0aW9uLnByb3ZpZGVycyA9IHByb3ZpZGVycztcbiAgICBpbnN0cnVjdGlvbi5iZWhhdmlvckluc3RydWN0aW9ucyA9IGJlaGF2aW9ySW5zdHJ1Y3Rpb25zO1xuICAgIGluc3RydWN0aW9uLmV4cHJlc3Npb25zID0gZXhwcmVzc2lvbnM7XG4gICAgaW5zdHJ1Y3Rpb24uYW5jaG9ySXNDb250YWluZXIgPSBlbGVtZW50SW5zdHJ1Y3Rpb24gPyBlbGVtZW50SW5zdHJ1Y3Rpb24uYW5jaG9ySXNDb250YWluZXIgOiB0cnVlO1xuICAgIGluc3RydWN0aW9uLmVsZW1lbnRJbnN0cnVjdGlvbiA9IGVsZW1lbnRJbnN0cnVjdGlvbjtcbiAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XG4gIH07XG5cbiAgVGFyZ2V0SW5zdHJ1Y3Rpb24uc3Vycm9nYXRlID0gZnVuY3Rpb24gc3Vycm9nYXRlKHByb3ZpZGVycywgYmVoYXZpb3JJbnN0cnVjdGlvbnMsIGV4cHJlc3Npb25zLCB2YWx1ZXMpIHtcbiAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBuZXcgVGFyZ2V0SW5zdHJ1Y3Rpb24oKTtcbiAgICBpbnN0cnVjdGlvbi5leHByZXNzaW9ucyA9IGV4cHJlc3Npb25zO1xuICAgIGluc3RydWN0aW9uLmJlaGF2aW9ySW5zdHJ1Y3Rpb25zID0gYmVoYXZpb3JJbnN0cnVjdGlvbnM7XG4gICAgaW5zdHJ1Y3Rpb24ucHJvdmlkZXJzID0gcHJvdmlkZXJzO1xuICAgIGluc3RydWN0aW9uLnZhbHVlcyA9IHZhbHVlcztcbiAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XG4gIH07XG5cbiAgZnVuY3Rpb24gVGFyZ2V0SW5zdHJ1Y3Rpb24oKSB7XG4gICAgXG5cbiAgICB0aGlzLmluamVjdG9ySWQgPSBudWxsO1xuICAgIHRoaXMucGFyZW50SW5qZWN0b3JJZCA9IG51bGw7XG5cbiAgICB0aGlzLnNoYWRvd1Nsb3QgPSBmYWxzZTtcbiAgICB0aGlzLnNsb3ROYW1lID0gbnVsbDtcbiAgICB0aGlzLnNsb3RGYWxsYmFja0ZhY3RvcnkgPSBudWxsO1xuXG4gICAgdGhpcy5jb250ZW50RXhwcmVzc2lvbiA9IG51bGw7XG5cbiAgICB0aGlzLmV4cHJlc3Npb25zID0gbnVsbDtcbiAgICB0aGlzLmJlaGF2aW9ySW5zdHJ1Y3Rpb25zID0gbnVsbDtcbiAgICB0aGlzLnByb3ZpZGVycyA9IG51bGw7XG5cbiAgICB0aGlzLnZpZXdGYWN0b3J5ID0gbnVsbDtcblxuICAgIHRoaXMuYW5jaG9ySXNDb250YWluZXIgPSBmYWxzZTtcbiAgICB0aGlzLmVsZW1lbnRJbnN0cnVjdGlvbiA9IG51bGw7XG4gICAgdGhpcy5saWZ0aW5nID0gZmFsc2U7XG5cbiAgICB0aGlzLnZhbHVlcyA9IG51bGw7XG4gIH1cblxuICByZXR1cm4gVGFyZ2V0SW5zdHJ1Y3Rpb247XG59KCksIF9jbGFzczQubm9FeHByZXNzaW9ucyA9IE9iamVjdC5mcmVlemUoW10pLCBfdGVtcCk7XG52YXIgdmlld1N0cmF0ZWd5ID0gZXhwb3J0cy52aWV3U3RyYXRlZ3kgPSBfYXVyZWxpYU1ldGFkYXRhLnByb3RvY29sLmNyZWF0ZSgnYXVyZWxpYTp2aWV3LXN0cmF0ZWd5Jywge1xuICB2YWxpZGF0ZTogZnVuY3Rpb24gdmFsaWRhdGUodGFyZ2V0KSB7XG4gICAgaWYgKCEodHlwZW9mIHRhcmdldC5sb2FkVmlld0ZhY3RvcnkgPT09ICdmdW5jdGlvbicpKSB7XG4gICAgICByZXR1cm4gJ1ZpZXcgc3RyYXRlZ2llcyBtdXN0IGltcGxlbWVudDogbG9hZFZpZXdGYWN0b3J5KHZpZXdFbmdpbmU6IFZpZXdFbmdpbmUsIGNvbXBpbGVJbnN0cnVjdGlvbjogVmlld0NvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQ/OiBSZXNvdXJjZUxvYWRDb250ZXh0KTogUHJvbWlzZTxWaWV3RmFjdG9yeT4nO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9LFxuICBjb21wb3NlOiBmdW5jdGlvbiBjb21wb3NlKHRhcmdldCkge1xuICAgIGlmICghKHR5cGVvZiB0YXJnZXQubWFrZVJlbGF0aXZlVG8gPT09ICdmdW5jdGlvbicpKSB7XG4gICAgICB0YXJnZXQubWFrZVJlbGF0aXZlVG8gPSBfYXVyZWxpYVBhbC5QTEFURk9STS5ub29wO1xuICAgIH1cbiAgfVxufSk7XG5cbnZhciBSZWxhdGl2ZVZpZXdTdHJhdGVneSA9IGV4cG9ydHMuUmVsYXRpdmVWaWV3U3RyYXRlZ3kgPSAoX2RlYyA9IHZpZXdTdHJhdGVneSgpLCBfZGVjKF9jbGFzczUgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFJlbGF0aXZlVmlld1N0cmF0ZWd5KHBhdGgpIHtcbiAgICBcblxuICAgIHRoaXMucGF0aCA9IHBhdGg7XG4gICAgdGhpcy5hYnNvbHV0ZVBhdGggPSBudWxsO1xuICB9XG5cbiAgUmVsYXRpdmVWaWV3U3RyYXRlZ3kucHJvdG90eXBlLmxvYWRWaWV3RmFjdG9yeSA9IGZ1bmN0aW9uIGxvYWRWaWV3RmFjdG9yeSh2aWV3RW5naW5lLCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0KSB7XG4gICAgaWYgKHRoaXMuYWJzb2x1dGVQYXRoID09PSBudWxsICYmIHRoaXMubW9kdWxlSWQpIHtcbiAgICAgIHRoaXMuYWJzb2x1dGVQYXRoID0gKDAsIF9hdXJlbGlhUGF0aC5yZWxhdGl2ZVRvRmlsZSkodGhpcy5wYXRoLCB0aGlzLm1vZHVsZUlkKTtcbiAgICB9XG5cbiAgICBjb21waWxlSW5zdHJ1Y3Rpb24uYXNzb2NpYXRlZE1vZHVsZUlkID0gdGhpcy5tb2R1bGVJZDtcbiAgICByZXR1cm4gdmlld0VuZ2luZS5sb2FkVmlld0ZhY3RvcnkodGhpcy5hYnNvbHV0ZVBhdGggfHwgdGhpcy5wYXRoLCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0KTtcbiAgfTtcblxuICBSZWxhdGl2ZVZpZXdTdHJhdGVneS5wcm90b3R5cGUubWFrZVJlbGF0aXZlVG8gPSBmdW5jdGlvbiBtYWtlUmVsYXRpdmVUbyhmaWxlKSB7XG4gICAgaWYgKHRoaXMuYWJzb2x1dGVQYXRoID09PSBudWxsKSB7XG4gICAgICB0aGlzLmFic29sdXRlUGF0aCA9ICgwLCBfYXVyZWxpYVBhdGgucmVsYXRpdmVUb0ZpbGUpKHRoaXMucGF0aCwgZmlsZSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBSZWxhdGl2ZVZpZXdTdHJhdGVneTtcbn0oKSkgfHwgX2NsYXNzNSk7XG52YXIgQ29udmVudGlvbmFsVmlld1N0cmF0ZWd5ID0gZXhwb3J0cy5Db252ZW50aW9uYWxWaWV3U3RyYXRlZ3kgPSAoX2RlYzIgPSB2aWV3U3RyYXRlZ3koKSwgX2RlYzIoX2NsYXNzNiA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQ29udmVudGlvbmFsVmlld1N0cmF0ZWd5KHZpZXdMb2NhdG9yLCBvcmlnaW4pIHtcbiAgICBcblxuICAgIHRoaXMubW9kdWxlSWQgPSBvcmlnaW4ubW9kdWxlSWQ7XG4gICAgdGhpcy52aWV3VXJsID0gdmlld0xvY2F0b3IuY29udmVydE9yaWdpblRvVmlld1VybChvcmlnaW4pO1xuICB9XG5cbiAgQ29udmVudGlvbmFsVmlld1N0cmF0ZWd5LnByb3RvdHlwZS5sb2FkVmlld0ZhY3RvcnkgPSBmdW5jdGlvbiBsb2FkVmlld0ZhY3Rvcnkodmlld0VuZ2luZSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCkge1xuICAgIGNvbXBpbGVJbnN0cnVjdGlvbi5hc3NvY2lhdGVkTW9kdWxlSWQgPSB0aGlzLm1vZHVsZUlkO1xuICAgIHJldHVybiB2aWV3RW5naW5lLmxvYWRWaWV3RmFjdG9yeSh0aGlzLnZpZXdVcmwsIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQpO1xuICB9O1xuXG4gIHJldHVybiBDb252ZW50aW9uYWxWaWV3U3RyYXRlZ3k7XG59KCkpIHx8IF9jbGFzczYpO1xudmFyIE5vVmlld1N0cmF0ZWd5ID0gZXhwb3J0cy5Ob1ZpZXdTdHJhdGVneSA9IChfZGVjMyA9IHZpZXdTdHJhdGVneSgpLCBfZGVjMyhfY2xhc3M3ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBOb1ZpZXdTdHJhdGVneSgpIHtcbiAgICBcbiAgfVxuXG4gIE5vVmlld1N0cmF0ZWd5LnByb3RvdHlwZS5sb2FkVmlld0ZhY3RvcnkgPSBmdW5jdGlvbiBsb2FkVmlld0ZhY3Rvcnkodmlld0VuZ2luZSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCkge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gIH07XG5cbiAgcmV0dXJuIE5vVmlld1N0cmF0ZWd5O1xufSgpKSB8fCBfY2xhc3M3KTtcbnZhciBUZW1wbGF0ZVJlZ2lzdHJ5Vmlld1N0cmF0ZWd5ID0gZXhwb3J0cy5UZW1wbGF0ZVJlZ2lzdHJ5Vmlld1N0cmF0ZWd5ID0gKF9kZWM0ID0gdmlld1N0cmF0ZWd5KCksIF9kZWM0KF9jbGFzczggPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFRlbXBsYXRlUmVnaXN0cnlWaWV3U3RyYXRlZ3kobW9kdWxlSWQsIGVudHJ5KSB7XG4gICAgXG5cbiAgICB0aGlzLm1vZHVsZUlkID0gbW9kdWxlSWQ7XG4gICAgdGhpcy5lbnRyeSA9IGVudHJ5O1xuICB9XG5cbiAgVGVtcGxhdGVSZWdpc3RyeVZpZXdTdHJhdGVneS5wcm90b3R5cGUubG9hZFZpZXdGYWN0b3J5ID0gZnVuY3Rpb24gbG9hZFZpZXdGYWN0b3J5KHZpZXdFbmdpbmUsIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQpIHtcbiAgICB2YXIgZW50cnkgPSB0aGlzLmVudHJ5O1xuXG4gICAgaWYgKGVudHJ5LmZhY3RvcnlJc1JlYWR5KSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGVudHJ5LmZhY3RvcnkpO1xuICAgIH1cblxuICAgIGNvbXBpbGVJbnN0cnVjdGlvbi5hc3NvY2lhdGVkTW9kdWxlSWQgPSB0aGlzLm1vZHVsZUlkO1xuICAgIHJldHVybiB2aWV3RW5naW5lLmxvYWRWaWV3RmFjdG9yeShlbnRyeSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCk7XG4gIH07XG5cbiAgcmV0dXJuIFRlbXBsYXRlUmVnaXN0cnlWaWV3U3RyYXRlZ3k7XG59KCkpIHx8IF9jbGFzczgpO1xudmFyIElubGluZVZpZXdTdHJhdGVneSA9IGV4cG9ydHMuSW5saW5lVmlld1N0cmF0ZWd5ID0gKF9kZWM1ID0gdmlld1N0cmF0ZWd5KCksIF9kZWM1KF9jbGFzczkgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIElubGluZVZpZXdTdHJhdGVneShtYXJrdXAsIGRlcGVuZGVuY2llcywgZGVwZW5kZW5jeUJhc2VVcmwpIHtcbiAgICBcblxuICAgIHRoaXMubWFya3VwID0gbWFya3VwO1xuICAgIHRoaXMuZGVwZW5kZW5jaWVzID0gZGVwZW5kZW5jaWVzIHx8IG51bGw7XG4gICAgdGhpcy5kZXBlbmRlbmN5QmFzZVVybCA9IGRlcGVuZGVuY3lCYXNlVXJsIHx8ICcnO1xuICB9XG5cbiAgSW5saW5lVmlld1N0cmF0ZWd5LnByb3RvdHlwZS5sb2FkVmlld0ZhY3RvcnkgPSBmdW5jdGlvbiBsb2FkVmlld0ZhY3Rvcnkodmlld0VuZ2luZSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCkge1xuICAgIHZhciBlbnRyeSA9IHRoaXMuZW50cnk7XG4gICAgdmFyIGRlcGVuZGVuY2llcyA9IHRoaXMuZGVwZW5kZW5jaWVzO1xuXG4gICAgaWYgKGVudHJ5ICYmIGVudHJ5LmZhY3RvcnlJc1JlYWR5KSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGVudHJ5LmZhY3RvcnkpO1xuICAgIH1cblxuICAgIHRoaXMuZW50cnkgPSBlbnRyeSA9IG5ldyBfYXVyZWxpYUxvYWRlci5UZW1wbGF0ZVJlZ2lzdHJ5RW50cnkodGhpcy5tb2R1bGVJZCB8fCB0aGlzLmRlcGVuZGVuY3lCYXNlVXJsKTtcbiAgICBlbnRyeS50ZW1wbGF0ZSA9IF9hdXJlbGlhUGFsLkRPTS5jcmVhdGVUZW1wbGF0ZUZyb21NYXJrdXAodGhpcy5tYXJrdXApO1xuXG4gICAgaWYgKGRlcGVuZGVuY2llcyAhPT0gbnVsbCkge1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gZGVwZW5kZW5jaWVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgdmFyIGN1cnJlbnQgPSBkZXBlbmRlbmNpZXNbaV07XG5cbiAgICAgICAgaWYgKHR5cGVvZiBjdXJyZW50ID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgY3VycmVudCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIGVudHJ5LmFkZERlcGVuZGVuY3koY3VycmVudCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZW50cnkuYWRkRGVwZW5kZW5jeShjdXJyZW50LmZyb20sIGN1cnJlbnQuYXMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29tcGlsZUluc3RydWN0aW9uLmFzc29jaWF0ZWRNb2R1bGVJZCA9IHRoaXMubW9kdWxlSWQ7XG4gICAgcmV0dXJuIHZpZXdFbmdpbmUubG9hZFZpZXdGYWN0b3J5KGVudHJ5LCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0KTtcbiAgfTtcblxuICByZXR1cm4gSW5saW5lVmlld1N0cmF0ZWd5O1xufSgpKSB8fCBfY2xhc3M5KTtcbnZhciBWaWV3TG9jYXRvciA9IGV4cG9ydHMuVmlld0xvY2F0b3IgPSAoX3RlbXAyID0gX2NsYXNzMTAgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFZpZXdMb2NhdG9yKCkge1xuICAgIFxuICB9XG5cbiAgVmlld0xvY2F0b3IucHJvdG90eXBlLmdldFZpZXdTdHJhdGVneSA9IGZ1bmN0aW9uIGdldFZpZXdTdHJhdGVneSh2YWx1ZSkge1xuICAgIGlmICghdmFsdWUpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGlmICgodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZih2YWx1ZSkpID09PSAnb2JqZWN0JyAmJiAnZ2V0Vmlld1N0cmF0ZWd5JyBpbiB2YWx1ZSkge1xuICAgICAgdmFyIF9vcmlnaW4gPSBfYXVyZWxpYU1ldGFkYXRhLk9yaWdpbi5nZXQodmFsdWUuY29uc3RydWN0b3IpO1xuXG4gICAgICB2YWx1ZSA9IHZhbHVlLmdldFZpZXdTdHJhdGVneSgpO1xuXG4gICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICB2YWx1ZSA9IG5ldyBSZWxhdGl2ZVZpZXdTdHJhdGVneSh2YWx1ZSk7XG4gICAgICB9XG5cbiAgICAgIHZpZXdTdHJhdGVneS5hc3NlcnQodmFsdWUpO1xuXG4gICAgICBpZiAoX29yaWdpbikge1xuICAgICAgICB2YWx1ZS5tYWtlUmVsYXRpdmVUbyhfb3JpZ2luLm1vZHVsZUlkKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICB2YWx1ZSA9IG5ldyBSZWxhdGl2ZVZpZXdTdHJhdGVneSh2YWx1ZSk7XG4gICAgfVxuXG4gICAgaWYgKHZpZXdTdHJhdGVneS52YWxpZGF0ZSh2YWx1ZSkpIHtcbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICB2YWx1ZSA9IHZhbHVlLmNvbnN0cnVjdG9yO1xuICAgIH1cblxuICAgIHZhciBvcmlnaW4gPSBfYXVyZWxpYU1ldGFkYXRhLk9yaWdpbi5nZXQodmFsdWUpO1xuICAgIHZhciBzdHJhdGVneSA9IF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEuZ2V0KFZpZXdMb2NhdG9yLnZpZXdTdHJhdGVneU1ldGFkYXRhS2V5LCB2YWx1ZSk7XG5cbiAgICBpZiAoIXN0cmF0ZWd5KSB7XG4gICAgICBpZiAoIW9yaWdpbikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBkZXRlcm1pbmUgZGVmYXVsdCB2aWV3IHN0cmF0ZWd5IGZvciBvYmplY3QuJywgdmFsdWUpO1xuICAgICAgfVxuXG4gICAgICBzdHJhdGVneSA9IHRoaXMuY3JlYXRlRmFsbGJhY2tWaWV3U3RyYXRlZ3kob3JpZ2luKTtcbiAgICB9IGVsc2UgaWYgKG9yaWdpbikge1xuICAgICAgc3RyYXRlZ3kubW9kdWxlSWQgPSBvcmlnaW4ubW9kdWxlSWQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0cmF0ZWd5O1xuICB9O1xuXG4gIFZpZXdMb2NhdG9yLnByb3RvdHlwZS5jcmVhdGVGYWxsYmFja1ZpZXdTdHJhdGVneSA9IGZ1bmN0aW9uIGNyZWF0ZUZhbGxiYWNrVmlld1N0cmF0ZWd5KG9yaWdpbikge1xuICAgIHJldHVybiBuZXcgQ29udmVudGlvbmFsVmlld1N0cmF0ZWd5KHRoaXMsIG9yaWdpbik7XG4gIH07XG5cbiAgVmlld0xvY2F0b3IucHJvdG90eXBlLmNvbnZlcnRPcmlnaW5Ub1ZpZXdVcmwgPSBmdW5jdGlvbiBjb252ZXJ0T3JpZ2luVG9WaWV3VXJsKG9yaWdpbikge1xuICAgIHZhciBtb2R1bGVJZCA9IG9yaWdpbi5tb2R1bGVJZDtcbiAgICB2YXIgaWQgPSBtb2R1bGVJZC5lbmRzV2l0aCgnLmpzJykgfHwgbW9kdWxlSWQuZW5kc1dpdGgoJy50cycpID8gbW9kdWxlSWQuc3Vic3RyaW5nKDAsIG1vZHVsZUlkLmxlbmd0aCAtIDMpIDogbW9kdWxlSWQ7XG4gICAgcmV0dXJuIGlkICsgJy5odG1sJztcbiAgfTtcblxuICByZXR1cm4gVmlld0xvY2F0b3I7XG59KCksIF9jbGFzczEwLnZpZXdTdHJhdGVneU1ldGFkYXRhS2V5ID0gJ2F1cmVsaWE6dmlldy1zdHJhdGVneScsIF90ZW1wMik7XG5cblxuZnVuY3Rpb24gbWkobmFtZSkge1xuICB0aHJvdyBuZXcgRXJyb3IoJ0JpbmRpbmdMYW5ndWFnZSBtdXN0IGltcGxlbWVudCAnICsgbmFtZSArICcoKS4nKTtcbn1cblxudmFyIEJpbmRpbmdMYW5ndWFnZSA9IGV4cG9ydHMuQmluZGluZ0xhbmd1YWdlID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBCaW5kaW5nTGFuZ3VhZ2UoKSB7XG4gICAgXG4gIH1cblxuICBCaW5kaW5nTGFuZ3VhZ2UucHJvdG90eXBlLmluc3BlY3RBdHRyaWJ1dGUgPSBmdW5jdGlvbiBpbnNwZWN0QXR0cmlidXRlKHJlc291cmNlcywgZWxlbWVudE5hbWUsIGF0dHJOYW1lLCBhdHRyVmFsdWUpIHtcbiAgICBtaSgnaW5zcGVjdEF0dHJpYnV0ZScpO1xuICB9O1xuXG4gIEJpbmRpbmdMYW5ndWFnZS5wcm90b3R5cGUuY3JlYXRlQXR0cmlidXRlSW5zdHJ1Y3Rpb24gPSBmdW5jdGlvbiBjcmVhdGVBdHRyaWJ1dGVJbnN0cnVjdGlvbihyZXNvdXJjZXMsIGVsZW1lbnQsIGluZm8sIGV4aXN0aW5nSW5zdHJ1Y3Rpb24pIHtcbiAgICBtaSgnY3JlYXRlQXR0cmlidXRlSW5zdHJ1Y3Rpb24nKTtcbiAgfTtcblxuICBCaW5kaW5nTGFuZ3VhZ2UucHJvdG90eXBlLmluc3BlY3RUZXh0Q29udGVudCA9IGZ1bmN0aW9uIGluc3BlY3RUZXh0Q29udGVudChyZXNvdXJjZXMsIHZhbHVlKSB7XG4gICAgbWkoJ2luc3BlY3RUZXh0Q29udGVudCcpO1xuICB9O1xuXG4gIHJldHVybiBCaW5kaW5nTGFuZ3VhZ2U7XG59KCk7XG5cbnZhciBub05vZGVzID0gT2JqZWN0LmZyZWV6ZShbXSk7XG5cbnZhciBTbG90Q3VzdG9tQXR0cmlidXRlID0gZXhwb3J0cy5TbG90Q3VzdG9tQXR0cmlidXRlID0gKF9kZWM2ID0gKDAsIF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbi5pbmplY3QpKF9hdXJlbGlhUGFsLkRPTS5FbGVtZW50KSwgX2RlYzYoX2NsYXNzMTEgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFNsb3RDdXN0b21BdHRyaWJ1dGUoZWxlbWVudCkge1xuICAgIFxuXG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICB0aGlzLmVsZW1lbnQuYXVTbG90QXR0cmlidXRlID0gdGhpcztcbiAgfVxuXG4gIFNsb3RDdXN0b21BdHRyaWJ1dGUucHJvdG90eXBlLnZhbHVlQ2hhbmdlZCA9IGZ1bmN0aW9uIHZhbHVlQ2hhbmdlZChuZXdWYWx1ZSwgb2xkVmFsdWUpIHt9O1xuXG4gIHJldHVybiBTbG90Q3VzdG9tQXR0cmlidXRlO1xufSgpKSB8fCBfY2xhc3MxMSk7XG5cbnZhciBQYXNzVGhyb3VnaFNsb3QgPSBleHBvcnRzLlBhc3NUaHJvdWdoU2xvdCA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gUGFzc1Rocm91Z2hTbG90KGFuY2hvciwgbmFtZSwgZGVzdGluYXRpb25OYW1lLCBmYWxsYmFja0ZhY3RvcnkpIHtcbiAgICBcblxuICAgIHRoaXMuYW5jaG9yID0gYW5jaG9yO1xuICAgIHRoaXMuYW5jaG9yLnZpZXdTbG90ID0gdGhpcztcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIHRoaXMuZGVzdGluYXRpb25OYW1lID0gZGVzdGluYXRpb25OYW1lO1xuICAgIHRoaXMuZmFsbGJhY2tGYWN0b3J5ID0gZmFsbGJhY2tGYWN0b3J5O1xuICAgIHRoaXMuZGVzdGluYXRpb25TbG90ID0gbnVsbDtcbiAgICB0aGlzLnByb2plY3Rpb25zID0gMDtcbiAgICB0aGlzLmNvbnRlbnRWaWV3ID0gbnVsbDtcblxuICAgIHZhciBhdHRyID0gbmV3IFNsb3RDdXN0b21BdHRyaWJ1dGUodGhpcy5hbmNob3IpO1xuICAgIGF0dHIudmFsdWUgPSB0aGlzLmRlc3RpbmF0aW9uTmFtZTtcbiAgfVxuXG4gIFBhc3NUaHJvdWdoU2xvdC5wcm90b3R5cGUucmVuZGVyRmFsbGJhY2tDb250ZW50ID0gZnVuY3Rpb24gcmVuZGVyRmFsbGJhY2tDb250ZW50KHZpZXcsIG5vZGVzLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCkge1xuICAgIGlmICh0aGlzLmNvbnRlbnRWaWV3ID09PSBudWxsKSB7XG4gICAgICB0aGlzLmNvbnRlbnRWaWV3ID0gdGhpcy5mYWxsYmFja0ZhY3RvcnkuY3JlYXRlKHRoaXMub3duZXJWaWV3LmNvbnRhaW5lcik7XG4gICAgICB0aGlzLmNvbnRlbnRWaWV3LmJpbmQodGhpcy5vd25lclZpZXcuYmluZGluZ0NvbnRleHQsIHRoaXMub3duZXJWaWV3Lm92ZXJyaWRlQ29udGV4dCk7XG5cbiAgICAgIHZhciBzbG90cyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgICBzbG90c1t0aGlzLmRlc3RpbmF0aW9uU2xvdC5uYW1lXSA9IHRoaXMuZGVzdGluYXRpb25TbG90O1xuXG4gICAgICBTaGFkb3dET00uZGlzdHJpYnV0ZVZpZXcodGhpcy5jb250ZW50Vmlldywgc2xvdHMsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4LCB0aGlzLmRlc3RpbmF0aW9uU2xvdC5uYW1lKTtcbiAgICB9XG4gIH07XG5cbiAgUGFzc1Rocm91Z2hTbG90LnByb3RvdHlwZS5wYXNzVGhyb3VnaFRvID0gZnVuY3Rpb24gcGFzc1Rocm91Z2hUbyhkZXN0aW5hdGlvblNsb3QpIHtcbiAgICB0aGlzLmRlc3RpbmF0aW9uU2xvdCA9IGRlc3RpbmF0aW9uU2xvdDtcbiAgfTtcblxuICBQYXNzVGhyb3VnaFNsb3QucHJvdG90eXBlLmFkZE5vZGUgPSBmdW5jdGlvbiBhZGROb2RlKHZpZXcsIG5vZGUsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4KSB7XG4gICAgaWYgKHRoaXMuY29udGVudFZpZXcgIT09IG51bGwpIHtcbiAgICAgIHRoaXMuY29udGVudFZpZXcucmVtb3ZlTm9kZXMoKTtcbiAgICAgIHRoaXMuY29udGVudFZpZXcuZGV0YWNoZWQoKTtcbiAgICAgIHRoaXMuY29udGVudFZpZXcudW5iaW5kKCk7XG4gICAgICB0aGlzLmNvbnRlbnRWaWV3ID0gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAobm9kZS52aWV3U2xvdCBpbnN0YW5jZW9mIFBhc3NUaHJvdWdoU2xvdCkge1xuICAgICAgbm9kZS52aWV3U2xvdC5wYXNzVGhyb3VnaFRvKHRoaXMpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMucHJvamVjdGlvbnMrKztcbiAgICB0aGlzLmRlc3RpbmF0aW9uU2xvdC5hZGROb2RlKHZpZXcsIG5vZGUsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4KTtcbiAgfTtcblxuICBQYXNzVGhyb3VnaFNsb3QucHJvdG90eXBlLnJlbW92ZVZpZXcgPSBmdW5jdGlvbiByZW1vdmVWaWV3KHZpZXcsIHByb2plY3Rpb25Tb3VyY2UpIHtcbiAgICB0aGlzLnByb2plY3Rpb25zLS07XG4gICAgdGhpcy5kZXN0aW5hdGlvblNsb3QucmVtb3ZlVmlldyh2aWV3LCBwcm9qZWN0aW9uU291cmNlKTtcblxuICAgIGlmICh0aGlzLm5lZWRzRmFsbGJhY2tSZW5kZXJpbmcpIHtcbiAgICAgIHRoaXMucmVuZGVyRmFsbGJhY2tDb250ZW50KG51bGwsIG5vTm9kZXMsIHByb2plY3Rpb25Tb3VyY2UpO1xuICAgIH1cbiAgfTtcblxuICBQYXNzVGhyb3VnaFNsb3QucHJvdG90eXBlLnJlbW92ZUFsbCA9IGZ1bmN0aW9uIHJlbW92ZUFsbChwcm9qZWN0aW9uU291cmNlKSB7XG4gICAgdGhpcy5wcm9qZWN0aW9ucyA9IDA7XG4gICAgdGhpcy5kZXN0aW5hdGlvblNsb3QucmVtb3ZlQWxsKHByb2plY3Rpb25Tb3VyY2UpO1xuXG4gICAgaWYgKHRoaXMubmVlZHNGYWxsYmFja1JlbmRlcmluZykge1xuICAgICAgdGhpcy5yZW5kZXJGYWxsYmFja0NvbnRlbnQobnVsbCwgbm9Ob2RlcywgcHJvamVjdGlvblNvdXJjZSk7XG4gICAgfVxuICB9O1xuXG4gIFBhc3NUaHJvdWdoU2xvdC5wcm90b3R5cGUucHJvamVjdEZyb20gPSBmdW5jdGlvbiBwcm9qZWN0RnJvbSh2aWV3LCBwcm9qZWN0aW9uU291cmNlKSB7XG4gICAgdGhpcy5kZXN0aW5hdGlvblNsb3QucHJvamVjdEZyb20odmlldywgcHJvamVjdGlvblNvdXJjZSk7XG4gIH07XG5cbiAgUGFzc1Rocm91Z2hTbG90LnByb3RvdHlwZS5jcmVhdGVkID0gZnVuY3Rpb24gY3JlYXRlZChvd25lclZpZXcpIHtcbiAgICB0aGlzLm93bmVyVmlldyA9IG93bmVyVmlldztcbiAgfTtcblxuICBQYXNzVGhyb3VnaFNsb3QucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiBiaW5kKHZpZXcpIHtcbiAgICBpZiAodGhpcy5jb250ZW50Vmlldykge1xuICAgICAgdGhpcy5jb250ZW50Vmlldy5iaW5kKHZpZXcuYmluZGluZ0NvbnRleHQsIHZpZXcub3ZlcnJpZGVDb250ZXh0KTtcbiAgICB9XG4gIH07XG5cbiAgUGFzc1Rocm91Z2hTbG90LnByb3RvdHlwZS5hdHRhY2hlZCA9IGZ1bmN0aW9uIGF0dGFjaGVkKCkge1xuICAgIGlmICh0aGlzLmNvbnRlbnRWaWV3KSB7XG4gICAgICB0aGlzLmNvbnRlbnRWaWV3LmF0dGFjaGVkKCk7XG4gICAgfVxuICB9O1xuXG4gIFBhc3NUaHJvdWdoU2xvdC5wcm90b3R5cGUuZGV0YWNoZWQgPSBmdW5jdGlvbiBkZXRhY2hlZCgpIHtcbiAgICBpZiAodGhpcy5jb250ZW50Vmlldykge1xuICAgICAgdGhpcy5jb250ZW50Vmlldy5kZXRhY2hlZCgpO1xuICAgIH1cbiAgfTtcblxuICBQYXNzVGhyb3VnaFNsb3QucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uIHVuYmluZCgpIHtcbiAgICBpZiAodGhpcy5jb250ZW50Vmlldykge1xuICAgICAgdGhpcy5jb250ZW50Vmlldy51bmJpbmQoKTtcbiAgICB9XG4gIH07XG5cbiAgX2NyZWF0ZUNsYXNzKFBhc3NUaHJvdWdoU2xvdCwgW3tcbiAgICBrZXk6ICduZWVkc0ZhbGxiYWNrUmVuZGVyaW5nJyxcbiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgIHJldHVybiB0aGlzLmZhbGxiYWNrRmFjdG9yeSAmJiB0aGlzLnByb2plY3Rpb25zID09PSAwO1xuICAgIH1cbiAgfV0pO1xuXG4gIHJldHVybiBQYXNzVGhyb3VnaFNsb3Q7XG59KCk7XG5cbnZhciBTaGFkb3dTbG90ID0gZXhwb3J0cy5TaGFkb3dTbG90ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBTaGFkb3dTbG90KGFuY2hvciwgbmFtZSwgZmFsbGJhY2tGYWN0b3J5KSB7XG4gICAgXG5cbiAgICB0aGlzLmFuY2hvciA9IGFuY2hvcjtcbiAgICB0aGlzLmFuY2hvci5pc0NvbnRlbnRQcm9qZWN0aW9uU291cmNlID0gdHJ1ZTtcbiAgICB0aGlzLmFuY2hvci52aWV3U2xvdCA9IHRoaXM7XG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB0aGlzLmZhbGxiYWNrRmFjdG9yeSA9IGZhbGxiYWNrRmFjdG9yeTtcbiAgICB0aGlzLmNvbnRlbnRWaWV3ID0gbnVsbDtcbiAgICB0aGlzLnByb2plY3Rpb25zID0gMDtcbiAgICB0aGlzLmNoaWxkcmVuID0gW107XG4gICAgdGhpcy5wcm9qZWN0RnJvbUFuY2hvcnMgPSBudWxsO1xuICAgIHRoaXMuZGVzdGluYXRpb25TbG90cyA9IG51bGw7XG4gIH1cblxuICBTaGFkb3dTbG90LnByb3RvdHlwZS5hZGROb2RlID0gZnVuY3Rpb24gYWRkTm9kZSh2aWV3LCBub2RlLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCwgZGVzdGluYXRpb24pIHtcbiAgICBpZiAodGhpcy5jb250ZW50VmlldyAhPT0gbnVsbCkge1xuICAgICAgdGhpcy5jb250ZW50Vmlldy5yZW1vdmVOb2RlcygpO1xuICAgICAgdGhpcy5jb250ZW50Vmlldy5kZXRhY2hlZCgpO1xuICAgICAgdGhpcy5jb250ZW50Vmlldy51bmJpbmQoKTtcbiAgICAgIHRoaXMuY29udGVudFZpZXcgPSBudWxsO1xuICAgIH1cblxuICAgIGlmIChub2RlLnZpZXdTbG90IGluc3RhbmNlb2YgUGFzc1Rocm91Z2hTbG90KSB7XG4gICAgICBub2RlLnZpZXdTbG90LnBhc3NUaHJvdWdoVG8odGhpcyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZGVzdGluYXRpb25TbG90cyAhPT0gbnVsbCkge1xuICAgICAgU2hhZG93RE9NLmRpc3RyaWJ1dGVOb2Rlcyh2aWV3LCBbbm9kZV0sIHRoaXMuZGVzdGluYXRpb25TbG90cywgdGhpcywgaW5kZXgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBub2RlLmF1T3duZXJWaWV3ID0gdmlldztcbiAgICAgIG5vZGUuYXVQcm9qZWN0aW9uU291cmNlID0gcHJvamVjdGlvblNvdXJjZTtcbiAgICAgIG5vZGUuYXVBc3NpZ25lZFNsb3QgPSB0aGlzO1xuXG4gICAgICB2YXIgYW5jaG9yID0gdGhpcy5fZmluZEFuY2hvcih2aWV3LCBub2RlLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCk7XG4gICAgICB2YXIgcGFyZW50ID0gYW5jaG9yLnBhcmVudE5vZGU7XG5cbiAgICAgIHBhcmVudC5pbnNlcnRCZWZvcmUobm9kZSwgYW5jaG9yKTtcbiAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaChub2RlKTtcbiAgICAgIHRoaXMucHJvamVjdGlvbnMrKztcbiAgICB9XG4gIH07XG5cbiAgU2hhZG93U2xvdC5wcm90b3R5cGUucmVtb3ZlVmlldyA9IGZ1bmN0aW9uIHJlbW92ZVZpZXcodmlldywgcHJvamVjdGlvblNvdXJjZSkge1xuICAgIGlmICh0aGlzLmRlc3RpbmF0aW9uU2xvdHMgIT09IG51bGwpIHtcbiAgICAgIFNoYWRvd0RPTS51bmRpc3RyaWJ1dGVWaWV3KHZpZXcsIHRoaXMuZGVzdGluYXRpb25TbG90cywgdGhpcyk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmNvbnRlbnRWaWV3ICYmIHRoaXMuY29udGVudFZpZXcuaGFzU2xvdHMpIHtcbiAgICAgIFNoYWRvd0RPTS51bmRpc3RyaWJ1dGVWaWV3KHZpZXcsIHRoaXMuY29udGVudFZpZXcuc2xvdHMsIHByb2plY3Rpb25Tb3VyY2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgZm91bmQgPSB0aGlzLmNoaWxkcmVuLmZpbmQoZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgcmV0dXJuIHguYXVTbG90UHJvamVjdEZyb20gPT09IHByb2plY3Rpb25Tb3VyY2U7XG4gICAgICB9KTtcbiAgICAgIGlmIChmb3VuZCkge1xuICAgICAgICB2YXIgX2NoaWxkcmVuID0gZm91bmQuYXVQcm9qZWN0aW9uQ2hpbGRyZW47XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gX2NoaWxkcmVuLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgICB2YXIgX2NoaWxkID0gX2NoaWxkcmVuW2ldO1xuXG4gICAgICAgICAgaWYgKF9jaGlsZC5hdU93bmVyVmlldyA9PT0gdmlldykge1xuICAgICAgICAgICAgX2NoaWxkcmVuLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgIHZpZXcuZnJhZ21lbnQuYXBwZW5kQ2hpbGQoX2NoaWxkKTtcbiAgICAgICAgICAgIGktLTtpaS0tO1xuICAgICAgICAgICAgdGhpcy5wcm9qZWN0aW9ucy0tO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLm5lZWRzRmFsbGJhY2tSZW5kZXJpbmcpIHtcbiAgICAgICAgICB0aGlzLnJlbmRlckZhbGxiYWNrQ29udGVudCh2aWV3LCBub05vZGVzLCBwcm9qZWN0aW9uU291cmNlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBTaGFkb3dTbG90LnByb3RvdHlwZS5yZW1vdmVBbGwgPSBmdW5jdGlvbiByZW1vdmVBbGwocHJvamVjdGlvblNvdXJjZSkge1xuICAgIGlmICh0aGlzLmRlc3RpbmF0aW9uU2xvdHMgIT09IG51bGwpIHtcbiAgICAgIFNoYWRvd0RPTS51bmRpc3RyaWJ1dGVBbGwodGhpcy5kZXN0aW5hdGlvblNsb3RzLCB0aGlzKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuY29udGVudFZpZXcgJiYgdGhpcy5jb250ZW50Vmlldy5oYXNTbG90cykge1xuICAgICAgU2hhZG93RE9NLnVuZGlzdHJpYnV0ZUFsbCh0aGlzLmNvbnRlbnRWaWV3LnNsb3RzLCBwcm9qZWN0aW9uU291cmNlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGZvdW5kID0gdGhpcy5jaGlsZHJlbi5maW5kKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIHJldHVybiB4LmF1U2xvdFByb2plY3RGcm9tID09PSBwcm9qZWN0aW9uU291cmNlO1xuICAgICAgfSk7XG5cbiAgICAgIGlmIChmb3VuZCkge1xuICAgICAgICB2YXIgX2NoaWxkcmVuMiA9IGZvdW5kLmF1UHJvamVjdGlvbkNoaWxkcmVuO1xuICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBfY2hpbGRyZW4yLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgICB2YXIgX2NoaWxkMiA9IF9jaGlsZHJlbjJbaV07XG4gICAgICAgICAgX2NoaWxkMi5hdU93bmVyVmlldy5mcmFnbWVudC5hcHBlbmRDaGlsZChfY2hpbGQyKTtcbiAgICAgICAgICB0aGlzLnByb2plY3Rpb25zLS07XG4gICAgICAgIH1cblxuICAgICAgICBmb3VuZC5hdVByb2plY3Rpb25DaGlsZHJlbiA9IFtdO1xuXG4gICAgICAgIGlmICh0aGlzLm5lZWRzRmFsbGJhY2tSZW5kZXJpbmcpIHtcbiAgICAgICAgICB0aGlzLnJlbmRlckZhbGxiYWNrQ29udGVudChudWxsLCBub05vZGVzLCBwcm9qZWN0aW9uU291cmNlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBTaGFkb3dTbG90LnByb3RvdHlwZS5fZmluZEFuY2hvciA9IGZ1bmN0aW9uIF9maW5kQW5jaG9yKHZpZXcsIG5vZGUsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4KSB7XG4gICAgaWYgKHByb2plY3Rpb25Tb3VyY2UpIHtcbiAgICAgIHZhciBmb3VuZCA9IHRoaXMuY2hpbGRyZW4uZmluZChmdW5jdGlvbiAoeCkge1xuICAgICAgICByZXR1cm4geC5hdVNsb3RQcm9qZWN0RnJvbSA9PT0gcHJvamVjdGlvblNvdXJjZTtcbiAgICAgIH0pO1xuICAgICAgaWYgKGZvdW5kKSB7XG4gICAgICAgIGlmIChpbmRleCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgdmFyIF9jaGlsZHJlbjMgPSBmb3VuZC5hdVByb2plY3Rpb25DaGlsZHJlbjtcbiAgICAgICAgICB2YXIgdmlld0luZGV4ID0gLTE7XG4gICAgICAgICAgdmFyIGxhc3RWaWV3ID0gdm9pZCAwO1xuXG4gICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gX2NoaWxkcmVuMy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgICAgICB2YXIgY3VycmVudCA9IF9jaGlsZHJlbjNbaV07XG5cbiAgICAgICAgICAgIGlmIChjdXJyZW50LmF1T3duZXJWaWV3ICE9PSBsYXN0Vmlldykge1xuICAgICAgICAgICAgICB2aWV3SW5kZXgrKztcbiAgICAgICAgICAgICAgbGFzdFZpZXcgPSBjdXJyZW50LmF1T3duZXJWaWV3O1xuXG4gICAgICAgICAgICAgIGlmICh2aWV3SW5kZXggPj0gaW5kZXggJiYgbGFzdFZpZXcgIT09IHZpZXcpIHtcbiAgICAgICAgICAgICAgICBfY2hpbGRyZW4zLnNwbGljZShpLCAwLCBub2RlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZvdW5kLmF1UHJvamVjdGlvbkNoaWxkcmVuLnB1c2gobm9kZSk7XG4gICAgICAgIHJldHVybiBmb3VuZDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5hbmNob3I7XG4gIH07XG5cbiAgU2hhZG93U2xvdC5wcm90b3R5cGUucHJvamVjdFRvID0gZnVuY3Rpb24gcHJvamVjdFRvKHNsb3RzKSB7XG4gICAgdGhpcy5kZXN0aW5hdGlvblNsb3RzID0gc2xvdHM7XG4gIH07XG5cbiAgU2hhZG93U2xvdC5wcm90b3R5cGUucHJvamVjdEZyb20gPSBmdW5jdGlvbiBwcm9qZWN0RnJvbSh2aWV3LCBwcm9qZWN0aW9uU291cmNlKSB7XG4gICAgdmFyIGFuY2hvciA9IF9hdXJlbGlhUGFsLkRPTS5jcmVhdGVDb21tZW50KCdhbmNob3InKTtcbiAgICB2YXIgcGFyZW50ID0gdGhpcy5hbmNob3IucGFyZW50Tm9kZTtcbiAgICBhbmNob3IuYXVTbG90UHJvamVjdEZyb20gPSBwcm9qZWN0aW9uU291cmNlO1xuICAgIGFuY2hvci5hdU93bmVyVmlldyA9IHZpZXc7XG4gICAgYW5jaG9yLmF1UHJvamVjdGlvbkNoaWxkcmVuID0gW107XG4gICAgcGFyZW50Lmluc2VydEJlZm9yZShhbmNob3IsIHRoaXMuYW5jaG9yKTtcbiAgICB0aGlzLmNoaWxkcmVuLnB1c2goYW5jaG9yKTtcblxuICAgIGlmICh0aGlzLnByb2plY3RGcm9tQW5jaG9ycyA9PT0gbnVsbCkge1xuICAgICAgdGhpcy5wcm9qZWN0RnJvbUFuY2hvcnMgPSBbXTtcbiAgICB9XG5cbiAgICB0aGlzLnByb2plY3RGcm9tQW5jaG9ycy5wdXNoKGFuY2hvcik7XG4gIH07XG5cbiAgU2hhZG93U2xvdC5wcm90b3R5cGUucmVuZGVyRmFsbGJhY2tDb250ZW50ID0gZnVuY3Rpb24gcmVuZGVyRmFsbGJhY2tDb250ZW50KHZpZXcsIG5vZGVzLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCkge1xuICAgIGlmICh0aGlzLmNvbnRlbnRWaWV3ID09PSBudWxsKSB7XG4gICAgICB0aGlzLmNvbnRlbnRWaWV3ID0gdGhpcy5mYWxsYmFja0ZhY3RvcnkuY3JlYXRlKHRoaXMub3duZXJWaWV3LmNvbnRhaW5lcik7XG4gICAgICB0aGlzLmNvbnRlbnRWaWV3LmJpbmQodGhpcy5vd25lclZpZXcuYmluZGluZ0NvbnRleHQsIHRoaXMub3duZXJWaWV3Lm92ZXJyaWRlQ29udGV4dCk7XG4gICAgICB0aGlzLmNvbnRlbnRWaWV3Lmluc2VydE5vZGVzQmVmb3JlKHRoaXMuYW5jaG9yKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5jb250ZW50Vmlldy5oYXNTbG90cykge1xuICAgICAgdmFyIHNsb3RzID0gdGhpcy5jb250ZW50Vmlldy5zbG90cztcbiAgICAgIHZhciBwcm9qZWN0RnJvbUFuY2hvcnMgPSB0aGlzLnByb2plY3RGcm9tQW5jaG9ycztcblxuICAgICAgaWYgKHByb2plY3RGcm9tQW5jaG9ycyAhPT0gbnVsbCkge1xuICAgICAgICBmb3IgKHZhciBzbG90TmFtZSBpbiBzbG90cykge1xuICAgICAgICAgIHZhciBzbG90ID0gc2xvdHNbc2xvdE5hbWVdO1xuXG4gICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gcHJvamVjdEZyb21BbmNob3JzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBhbmNob3IgPSBwcm9qZWN0RnJvbUFuY2hvcnNbaV07XG4gICAgICAgICAgICBzbG90LnByb2plY3RGcm9tKGFuY2hvci5hdU93bmVyVmlldywgYW5jaG9yLmF1U2xvdFByb2plY3RGcm9tKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5mYWxsYmFja1Nsb3RzID0gc2xvdHM7XG4gICAgICBTaGFkb3dET00uZGlzdHJpYnV0ZU5vZGVzKHZpZXcsIG5vZGVzLCBzbG90cywgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgpO1xuICAgIH1cbiAgfTtcblxuICBTaGFkb3dTbG90LnByb3RvdHlwZS5jcmVhdGVkID0gZnVuY3Rpb24gY3JlYXRlZChvd25lclZpZXcpIHtcbiAgICB0aGlzLm93bmVyVmlldyA9IG93bmVyVmlldztcbiAgfTtcblxuICBTaGFkb3dTbG90LnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZCh2aWV3KSB7XG4gICAgaWYgKHRoaXMuY29udGVudFZpZXcpIHtcbiAgICAgIHRoaXMuY29udGVudFZpZXcuYmluZCh2aWV3LmJpbmRpbmdDb250ZXh0LCB2aWV3Lm92ZXJyaWRlQ29udGV4dCk7XG4gICAgfVxuICB9O1xuXG4gIFNoYWRvd1Nsb3QucHJvdG90eXBlLmF0dGFjaGVkID0gZnVuY3Rpb24gYXR0YWNoZWQoKSB7XG4gICAgaWYgKHRoaXMuY29udGVudFZpZXcpIHtcbiAgICAgIHRoaXMuY29udGVudFZpZXcuYXR0YWNoZWQoKTtcbiAgICB9XG4gIH07XG5cbiAgU2hhZG93U2xvdC5wcm90b3R5cGUuZGV0YWNoZWQgPSBmdW5jdGlvbiBkZXRhY2hlZCgpIHtcbiAgICBpZiAodGhpcy5jb250ZW50Vmlldykge1xuICAgICAgdGhpcy5jb250ZW50Vmlldy5kZXRhY2hlZCgpO1xuICAgIH1cbiAgfTtcblxuICBTaGFkb3dTbG90LnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiB1bmJpbmQoKSB7XG4gICAgaWYgKHRoaXMuY29udGVudFZpZXcpIHtcbiAgICAgIHRoaXMuY29udGVudFZpZXcudW5iaW5kKCk7XG4gICAgfVxuICB9O1xuXG4gIF9jcmVhdGVDbGFzcyhTaGFkb3dTbG90LCBbe1xuICAgIGtleTogJ25lZWRzRmFsbGJhY2tSZW5kZXJpbmcnLFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgcmV0dXJuIHRoaXMuZmFsbGJhY2tGYWN0b3J5ICYmIHRoaXMucHJvamVjdGlvbnMgPT09IDA7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIFNoYWRvd1Nsb3Q7XG59KCk7XG5cbnZhciBTaGFkb3dET00gPSBleHBvcnRzLlNoYWRvd0RPTSA9IChfdGVtcDMgPSBfY2xhc3MxMiA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gU2hhZG93RE9NKCkge1xuICAgIFxuICB9XG5cbiAgU2hhZG93RE9NLmdldFNsb3ROYW1lID0gZnVuY3Rpb24gZ2V0U2xvdE5hbWUobm9kZSkge1xuICAgIGlmIChub2RlLmF1U2xvdEF0dHJpYnV0ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gU2hhZG93RE9NLmRlZmF1bHRTbG90S2V5O1xuICAgIH1cblxuICAgIHJldHVybiBub2RlLmF1U2xvdEF0dHJpYnV0ZS52YWx1ZTtcbiAgfTtcblxuICBTaGFkb3dET00uZGlzdHJpYnV0ZVZpZXcgPSBmdW5jdGlvbiBkaXN0cmlidXRlVmlldyh2aWV3LCBzbG90cywgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgsIGRlc3RpbmF0aW9uT3ZlcnJpZGUpIHtcbiAgICB2YXIgbm9kZXMgPSB2b2lkIDA7XG5cbiAgICBpZiAodmlldyA9PT0gbnVsbCkge1xuICAgICAgbm9kZXMgPSBub05vZGVzO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgY2hpbGROb2RlcyA9IHZpZXcuZnJhZ21lbnQuY2hpbGROb2RlcztcbiAgICAgIHZhciBpaSA9IGNoaWxkTm9kZXMubGVuZ3RoO1xuICAgICAgbm9kZXMgPSBuZXcgQXJyYXkoaWkpO1xuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgbm9kZXNbaV0gPSBjaGlsZE5vZGVzW2ldO1xuICAgICAgfVxuICAgIH1cblxuICAgIFNoYWRvd0RPTS5kaXN0cmlidXRlTm9kZXModmlldywgbm9kZXMsIHNsb3RzLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCwgZGVzdGluYXRpb25PdmVycmlkZSk7XG4gIH07XG5cbiAgU2hhZG93RE9NLnVuZGlzdHJpYnV0ZVZpZXcgPSBmdW5jdGlvbiB1bmRpc3RyaWJ1dGVWaWV3KHZpZXcsIHNsb3RzLCBwcm9qZWN0aW9uU291cmNlKSB7XG4gICAgZm9yICh2YXIgc2xvdE5hbWUgaW4gc2xvdHMpIHtcbiAgICAgIHNsb3RzW3Nsb3ROYW1lXS5yZW1vdmVWaWV3KHZpZXcsIHByb2plY3Rpb25Tb3VyY2UpO1xuICAgIH1cbiAgfTtcblxuICBTaGFkb3dET00udW5kaXN0cmlidXRlQWxsID0gZnVuY3Rpb24gdW5kaXN0cmlidXRlQWxsKHNsb3RzLCBwcm9qZWN0aW9uU291cmNlKSB7XG4gICAgZm9yICh2YXIgc2xvdE5hbWUgaW4gc2xvdHMpIHtcbiAgICAgIHNsb3RzW3Nsb3ROYW1lXS5yZW1vdmVBbGwocHJvamVjdGlvblNvdXJjZSk7XG4gICAgfVxuICB9O1xuXG4gIFNoYWRvd0RPTS5kaXN0cmlidXRlTm9kZXMgPSBmdW5jdGlvbiBkaXN0cmlidXRlTm9kZXModmlldywgbm9kZXMsIHNsb3RzLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCwgZGVzdGluYXRpb25PdmVycmlkZSkge1xuICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IG5vZGVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgIHZhciBjdXJyZW50Tm9kZSA9IG5vZGVzW2ldO1xuICAgICAgdmFyIG5vZGVUeXBlID0gY3VycmVudE5vZGUubm9kZVR5cGU7XG5cbiAgICAgIGlmIChjdXJyZW50Tm9kZS5pc0NvbnRlbnRQcm9qZWN0aW9uU291cmNlKSB7XG4gICAgICAgIGN1cnJlbnROb2RlLnZpZXdTbG90LnByb2plY3RUbyhzbG90cyk7XG5cbiAgICAgICAgZm9yICh2YXIgc2xvdE5hbWUgaW4gc2xvdHMpIHtcbiAgICAgICAgICBzbG90c1tzbG90TmFtZV0ucHJvamVjdEZyb20odmlldywgY3VycmVudE5vZGUudmlld1Nsb3QpO1xuICAgICAgICB9XG5cbiAgICAgICAgbm9kZXMuc3BsaWNlKGksIDEpO1xuICAgICAgICBpaS0tO2ktLTtcbiAgICAgIH0gZWxzZSBpZiAobm9kZVR5cGUgPT09IDEgfHwgbm9kZVR5cGUgPT09IDMgfHwgY3VycmVudE5vZGUudmlld1Nsb3QgaW5zdGFuY2VvZiBQYXNzVGhyb3VnaFNsb3QpIHtcbiAgICAgICAgaWYgKG5vZGVUeXBlID09PSAzICYmIF9pc0FsbFdoaXRlc3BhY2UoY3VycmVudE5vZGUpKSB7XG4gICAgICAgICAgbm9kZXMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgIGlpLS07aS0tO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciBmb3VuZCA9IHNsb3RzW2Rlc3RpbmF0aW9uT3ZlcnJpZGUgfHwgU2hhZG93RE9NLmdldFNsb3ROYW1lKGN1cnJlbnROb2RlKV07XG5cbiAgICAgICAgICBpZiAoZm91bmQpIHtcbiAgICAgICAgICAgIGZvdW5kLmFkZE5vZGUodmlldywgY3VycmVudE5vZGUsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4KTtcbiAgICAgICAgICAgIG5vZGVzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgIGlpLS07aS0tO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbm9kZXMuc3BsaWNlKGksIDEpO1xuICAgICAgICBpaS0tO2ktLTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IgKHZhciBfc2xvdE5hbWUgaW4gc2xvdHMpIHtcbiAgICAgIHZhciBzbG90ID0gc2xvdHNbX3Nsb3ROYW1lXTtcblxuICAgICAgaWYgKHNsb3QubmVlZHNGYWxsYmFja1JlbmRlcmluZykge1xuICAgICAgICBzbG90LnJlbmRlckZhbGxiYWNrQ29udGVudCh2aWV3LCBub2RlcywgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICByZXR1cm4gU2hhZG93RE9NO1xufSgpLCBfY2xhc3MxMi5kZWZhdWx0U2xvdEtleSA9ICdfX2F1LWRlZmF1bHQtc2xvdC1rZXlfXycsIF90ZW1wMyk7XG5cblxuZnVuY3Rpb24gcmVnaXN0ZXIobG9va3VwLCBuYW1lLCByZXNvdXJjZSwgdHlwZSkge1xuICBpZiAoIW5hbWUpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgZXhpc3RpbmcgPSBsb29rdXBbbmFtZV07XG4gIGlmIChleGlzdGluZykge1xuICAgIGlmIChleGlzdGluZyAhPT0gcmVzb3VyY2UpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQXR0ZW1wdGVkIHRvIHJlZ2lzdGVyICcgKyB0eXBlICsgJyB3aGVuIG9uZSB3aXRoIHRoZSBzYW1lIG5hbWUgYWxyZWFkeSBleGlzdHMuIE5hbWU6ICcgKyBuYW1lICsgJy4nKTtcbiAgICB9XG5cbiAgICByZXR1cm47XG4gIH1cblxuICBsb29rdXBbbmFtZV0gPSByZXNvdXJjZTtcbn1cblxudmFyIFZpZXdSZXNvdXJjZXMgPSBleHBvcnRzLlZpZXdSZXNvdXJjZXMgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFZpZXdSZXNvdXJjZXMocGFyZW50LCB2aWV3VXJsKSB7XG4gICAgXG5cbiAgICB0aGlzLmJpbmRpbmdMYW5ndWFnZSA9IG51bGw7XG5cbiAgICB0aGlzLnBhcmVudCA9IHBhcmVudCB8fCBudWxsO1xuICAgIHRoaXMuaGFzUGFyZW50ID0gdGhpcy5wYXJlbnQgIT09IG51bGw7XG4gICAgdGhpcy52aWV3VXJsID0gdmlld1VybCB8fCAnJztcbiAgICB0aGlzLmxvb2t1cEZ1bmN0aW9ucyA9IHtcbiAgICAgIHZhbHVlQ29udmVydGVyczogdGhpcy5nZXRWYWx1ZUNvbnZlcnRlci5iaW5kKHRoaXMpLFxuICAgICAgYmluZGluZ0JlaGF2aW9yczogdGhpcy5nZXRCaW5kaW5nQmVoYXZpb3IuYmluZCh0aGlzKVxuICAgIH07XG4gICAgdGhpcy5hdHRyaWJ1dGVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICB0aGlzLmVsZW1lbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICB0aGlzLnZhbHVlQ29udmVydGVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgdGhpcy5iaW5kaW5nQmVoYXZpb3JzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICB0aGlzLmF0dHJpYnV0ZU1hcCA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgdGhpcy52YWx1ZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgIHRoaXMuYmVmb3JlQ29tcGlsZSA9IHRoaXMuYWZ0ZXJDb21waWxlID0gdGhpcy5iZWZvcmVDcmVhdGUgPSB0aGlzLmFmdGVyQ3JlYXRlID0gdGhpcy5iZWZvcmVCaW5kID0gdGhpcy5iZWZvcmVVbmJpbmQgPSBmYWxzZTtcbiAgfVxuXG4gIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLl90cnlBZGRIb29rID0gZnVuY3Rpb24gX3RyeUFkZEhvb2sob2JqLCBuYW1lKSB7XG4gICAgaWYgKHR5cGVvZiBvYmpbbmFtZV0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHZhciBmdW5jID0gb2JqW25hbWVdLmJpbmQob2JqKTtcbiAgICAgIHZhciBjb3VudGVyID0gMTtcbiAgICAgIHZhciBjYWxsYmFja05hbWUgPSB2b2lkIDA7XG5cbiAgICAgIHdoaWxlICh0aGlzW2NhbGxiYWNrTmFtZSA9IG5hbWUgKyBjb3VudGVyLnRvU3RyaW5nKCldICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY291bnRlcisrO1xuICAgICAgfVxuXG4gICAgICB0aGlzW25hbWVdID0gdHJ1ZTtcbiAgICAgIHRoaXNbY2FsbGJhY2tOYW1lXSA9IGZ1bmM7XG4gICAgfVxuICB9O1xuXG4gIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLl9pbnZva2VIb29rID0gZnVuY3Rpb24gX2ludm9rZUhvb2sobmFtZSwgb25lLCB0d28sIHRocmVlLCBmb3VyKSB7XG4gICAgaWYgKHRoaXMuaGFzUGFyZW50KSB7XG4gICAgICB0aGlzLnBhcmVudC5faW52b2tlSG9vayhuYW1lLCBvbmUsIHR3bywgdGhyZWUsIGZvdXIpO1xuICAgIH1cblxuICAgIGlmICh0aGlzW25hbWVdKSB7XG4gICAgICB0aGlzW25hbWUgKyAnMSddKG9uZSwgdHdvLCB0aHJlZSwgZm91cik7XG5cbiAgICAgIHZhciBjYWxsYmFja05hbWUgPSBuYW1lICsgJzInO1xuICAgICAgaWYgKHRoaXNbY2FsbGJhY2tOYW1lXSkge1xuICAgICAgICB0aGlzW2NhbGxiYWNrTmFtZV0ob25lLCB0d28sIHRocmVlLCBmb3VyKTtcblxuICAgICAgICBjYWxsYmFja05hbWUgPSBuYW1lICsgJzMnO1xuICAgICAgICBpZiAodGhpc1tjYWxsYmFja05hbWVdKSB7XG4gICAgICAgICAgdGhpc1tjYWxsYmFja05hbWVdKG9uZSwgdHdvLCB0aHJlZSwgZm91cik7XG5cbiAgICAgICAgICB2YXIgY291bnRlciA9IDQ7XG5cbiAgICAgICAgICB3aGlsZSAodGhpc1tjYWxsYmFja05hbWUgPSBuYW1lICsgY291bnRlci50b1N0cmluZygpXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzW2NhbGxiYWNrTmFtZV0ob25lLCB0d28sIHRocmVlLCBmb3VyKTtcbiAgICAgICAgICAgIGNvdW50ZXIrKztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUucmVnaXN0ZXJWaWV3RW5naW5lSG9va3MgPSBmdW5jdGlvbiByZWdpc3RlclZpZXdFbmdpbmVIb29rcyhob29rcykge1xuICAgIHRoaXMuX3RyeUFkZEhvb2soaG9va3MsICdiZWZvcmVDb21waWxlJyk7XG4gICAgdGhpcy5fdHJ5QWRkSG9vayhob29rcywgJ2FmdGVyQ29tcGlsZScpO1xuICAgIHRoaXMuX3RyeUFkZEhvb2soaG9va3MsICdiZWZvcmVDcmVhdGUnKTtcbiAgICB0aGlzLl90cnlBZGRIb29rKGhvb2tzLCAnYWZ0ZXJDcmVhdGUnKTtcbiAgICB0aGlzLl90cnlBZGRIb29rKGhvb2tzLCAnYmVmb3JlQmluZCcpO1xuICAgIHRoaXMuX3RyeUFkZEhvb2soaG9va3MsICdiZWZvcmVVbmJpbmQnKTtcbiAgfTtcblxuICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5nZXRCaW5kaW5nTGFuZ3VhZ2UgPSBmdW5jdGlvbiBnZXRCaW5kaW5nTGFuZ3VhZ2UoYmluZGluZ0xhbmd1YWdlRmFsbGJhY2spIHtcbiAgICByZXR1cm4gdGhpcy5iaW5kaW5nTGFuZ3VhZ2UgfHwgKHRoaXMuYmluZGluZ0xhbmd1YWdlID0gYmluZGluZ0xhbmd1YWdlRmFsbGJhY2spO1xuICB9O1xuXG4gIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLnBhdGNoSW5QYXJlbnQgPSBmdW5jdGlvbiBwYXRjaEluUGFyZW50KG5ld1BhcmVudCkge1xuICAgIHZhciBvcmlnaW5hbFBhcmVudCA9IHRoaXMucGFyZW50O1xuXG4gICAgdGhpcy5wYXJlbnQgPSBuZXdQYXJlbnQgfHwgbnVsbDtcbiAgICB0aGlzLmhhc1BhcmVudCA9IHRoaXMucGFyZW50ICE9PSBudWxsO1xuXG4gICAgaWYgKG5ld1BhcmVudC5wYXJlbnQgPT09IG51bGwpIHtcbiAgICAgIG5ld1BhcmVudC5wYXJlbnQgPSBvcmlnaW5hbFBhcmVudDtcbiAgICAgIG5ld1BhcmVudC5oYXNQYXJlbnQgPSBvcmlnaW5hbFBhcmVudCAhPT0gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUucmVsYXRpdmVUb1ZpZXcgPSBmdW5jdGlvbiByZWxhdGl2ZVRvVmlldyhwYXRoKSB7XG4gICAgcmV0dXJuICgwLCBfYXVyZWxpYVBhdGgucmVsYXRpdmVUb0ZpbGUpKHBhdGgsIHRoaXMudmlld1VybCk7XG4gIH07XG5cbiAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUucmVnaXN0ZXJFbGVtZW50ID0gZnVuY3Rpb24gcmVnaXN0ZXJFbGVtZW50KHRhZ05hbWUsIGJlaGF2aW9yKSB7XG4gICAgcmVnaXN0ZXIodGhpcy5lbGVtZW50cywgdGFnTmFtZSwgYmVoYXZpb3IsICdhbiBFbGVtZW50Jyk7XG4gIH07XG5cbiAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUuZ2V0RWxlbWVudCA9IGZ1bmN0aW9uIGdldEVsZW1lbnQodGFnTmFtZSkge1xuICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW3RhZ05hbWVdIHx8ICh0aGlzLmhhc1BhcmVudCA/IHRoaXMucGFyZW50LmdldEVsZW1lbnQodGFnTmFtZSkgOiBudWxsKTtcbiAgfTtcblxuICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5tYXBBdHRyaWJ1dGUgPSBmdW5jdGlvbiBtYXBBdHRyaWJ1dGUoYXR0cmlidXRlKSB7XG4gICAgcmV0dXJuIHRoaXMuYXR0cmlidXRlTWFwW2F0dHJpYnV0ZV0gfHwgKHRoaXMuaGFzUGFyZW50ID8gdGhpcy5wYXJlbnQubWFwQXR0cmlidXRlKGF0dHJpYnV0ZSkgOiBudWxsKTtcbiAgfTtcblxuICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5yZWdpc3RlckF0dHJpYnV0ZSA9IGZ1bmN0aW9uIHJlZ2lzdGVyQXR0cmlidXRlKGF0dHJpYnV0ZSwgYmVoYXZpb3IsIGtub3duQXR0cmlidXRlKSB7XG4gICAgdGhpcy5hdHRyaWJ1dGVNYXBbYXR0cmlidXRlXSA9IGtub3duQXR0cmlidXRlO1xuICAgIHJlZ2lzdGVyKHRoaXMuYXR0cmlidXRlcywgYXR0cmlidXRlLCBiZWhhdmlvciwgJ2FuIEF0dHJpYnV0ZScpO1xuICB9O1xuXG4gIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLmdldEF0dHJpYnV0ZSA9IGZ1bmN0aW9uIGdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpIHtcbiAgICByZXR1cm4gdGhpcy5hdHRyaWJ1dGVzW2F0dHJpYnV0ZV0gfHwgKHRoaXMuaGFzUGFyZW50ID8gdGhpcy5wYXJlbnQuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSkgOiBudWxsKTtcbiAgfTtcblxuICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5yZWdpc3RlclZhbHVlQ29udmVydGVyID0gZnVuY3Rpb24gcmVnaXN0ZXJWYWx1ZUNvbnZlcnRlcihuYW1lLCB2YWx1ZUNvbnZlcnRlcikge1xuICAgIHJlZ2lzdGVyKHRoaXMudmFsdWVDb252ZXJ0ZXJzLCBuYW1lLCB2YWx1ZUNvbnZlcnRlciwgJ2EgVmFsdWVDb252ZXJ0ZXInKTtcbiAgfTtcblxuICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5nZXRWYWx1ZUNvbnZlcnRlciA9IGZ1bmN0aW9uIGdldFZhbHVlQ29udmVydGVyKG5hbWUpIHtcbiAgICByZXR1cm4gdGhpcy52YWx1ZUNvbnZlcnRlcnNbbmFtZV0gfHwgKHRoaXMuaGFzUGFyZW50ID8gdGhpcy5wYXJlbnQuZ2V0VmFsdWVDb252ZXJ0ZXIobmFtZSkgOiBudWxsKTtcbiAgfTtcblxuICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5yZWdpc3RlckJpbmRpbmdCZWhhdmlvciA9IGZ1bmN0aW9uIHJlZ2lzdGVyQmluZGluZ0JlaGF2aW9yKG5hbWUsIGJpbmRpbmdCZWhhdmlvcikge1xuICAgIHJlZ2lzdGVyKHRoaXMuYmluZGluZ0JlaGF2aW9ycywgbmFtZSwgYmluZGluZ0JlaGF2aW9yLCAnYSBCaW5kaW5nQmVoYXZpb3InKTtcbiAgfTtcblxuICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5nZXRCaW5kaW5nQmVoYXZpb3IgPSBmdW5jdGlvbiBnZXRCaW5kaW5nQmVoYXZpb3IobmFtZSkge1xuICAgIHJldHVybiB0aGlzLmJpbmRpbmdCZWhhdmlvcnNbbmFtZV0gfHwgKHRoaXMuaGFzUGFyZW50ID8gdGhpcy5wYXJlbnQuZ2V0QmluZGluZ0JlaGF2aW9yKG5hbWUpIDogbnVsbCk7XG4gIH07XG5cbiAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUucmVnaXN0ZXJWYWx1ZSA9IGZ1bmN0aW9uIHJlZ2lzdGVyVmFsdWUobmFtZSwgdmFsdWUpIHtcbiAgICByZWdpc3Rlcih0aGlzLnZhbHVlcywgbmFtZSwgdmFsdWUsICdhIHZhbHVlJyk7XG4gIH07XG5cbiAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiBnZXRWYWx1ZShuYW1lKSB7XG4gICAgcmV0dXJuIHRoaXMudmFsdWVzW25hbWVdIHx8ICh0aGlzLmhhc1BhcmVudCA/IHRoaXMucGFyZW50LmdldFZhbHVlKG5hbWUpIDogbnVsbCk7XG4gIH07XG5cbiAgcmV0dXJuIFZpZXdSZXNvdXJjZXM7XG59KCk7XG5cbnZhciBWaWV3ID0gZXhwb3J0cy5WaWV3ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBWaWV3KGNvbnRhaW5lciwgdmlld0ZhY3RvcnksIGZyYWdtZW50LCBjb250cm9sbGVycywgYmluZGluZ3MsIGNoaWxkcmVuLCBzbG90cykge1xuICAgIFxuXG4gICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgdGhpcy52aWV3RmFjdG9yeSA9IHZpZXdGYWN0b3J5O1xuICAgIHRoaXMucmVzb3VyY2VzID0gdmlld0ZhY3RvcnkucmVzb3VyY2VzO1xuICAgIHRoaXMuZnJhZ21lbnQgPSBmcmFnbWVudDtcbiAgICB0aGlzLmZpcnN0Q2hpbGQgPSBmcmFnbWVudC5maXJzdENoaWxkO1xuICAgIHRoaXMubGFzdENoaWxkID0gZnJhZ21lbnQubGFzdENoaWxkO1xuICAgIHRoaXMuY29udHJvbGxlcnMgPSBjb250cm9sbGVycztcbiAgICB0aGlzLmJpbmRpbmdzID0gYmluZGluZ3M7XG4gICAgdGhpcy5jaGlsZHJlbiA9IGNoaWxkcmVuO1xuICAgIHRoaXMuc2xvdHMgPSBzbG90cztcbiAgICB0aGlzLmhhc1Nsb3RzID0gZmFsc2U7XG4gICAgdGhpcy5mcm9tQ2FjaGUgPSBmYWxzZTtcbiAgICB0aGlzLmlzQm91bmQgPSBmYWxzZTtcbiAgICB0aGlzLmlzQXR0YWNoZWQgPSBmYWxzZTtcbiAgICB0aGlzLmJpbmRpbmdDb250ZXh0ID0gbnVsbDtcbiAgICB0aGlzLm92ZXJyaWRlQ29udGV4dCA9IG51bGw7XG4gICAgdGhpcy5jb250cm9sbGVyID0gbnVsbDtcbiAgICB0aGlzLnZpZXdNb2RlbFNjb3BlID0gbnVsbDtcbiAgICB0aGlzLmFuaW1hdGFibGVFbGVtZW50ID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuX2lzVXNlckNvbnRyb2xsZWQgPSBmYWxzZTtcbiAgICB0aGlzLmNvbnRlbnRWaWV3ID0gbnVsbDtcblxuICAgIGZvciAodmFyIGtleSBpbiBzbG90cykge1xuICAgICAgdGhpcy5oYXNTbG90cyA9IHRydWU7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBWaWV3LnByb3RvdHlwZS5yZXR1cm5Ub0NhY2hlID0gZnVuY3Rpb24gcmV0dXJuVG9DYWNoZSgpIHtcbiAgICB0aGlzLnZpZXdGYWN0b3J5LnJldHVyblZpZXdUb0NhY2hlKHRoaXMpO1xuICB9O1xuXG4gIFZpZXcucHJvdG90eXBlLmNyZWF0ZWQgPSBmdW5jdGlvbiBjcmVhdGVkKCkge1xuICAgIHZhciBpID0gdm9pZCAwO1xuICAgIHZhciBpaSA9IHZvaWQgMDtcbiAgICB2YXIgY29udHJvbGxlcnMgPSB0aGlzLmNvbnRyb2xsZXJzO1xuXG4gICAgZm9yIChpID0gMCwgaWkgPSBjb250cm9sbGVycy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICBjb250cm9sbGVyc1tpXS5jcmVhdGVkKHRoaXMpO1xuICAgIH1cbiAgfTtcblxuICBWaWV3LnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0LCBfc3lzdGVtVXBkYXRlKSB7XG4gICAgdmFyIGNvbnRyb2xsZXJzID0gdm9pZCAwO1xuICAgIHZhciBiaW5kaW5ncyA9IHZvaWQgMDtcbiAgICB2YXIgY2hpbGRyZW4gPSB2b2lkIDA7XG4gICAgdmFyIGkgPSB2b2lkIDA7XG4gICAgdmFyIGlpID0gdm9pZCAwO1xuXG4gICAgaWYgKF9zeXN0ZW1VcGRhdGUgJiYgdGhpcy5faXNVc2VyQ29udHJvbGxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzQm91bmQpIHtcbiAgICAgIGlmICh0aGlzLmJpbmRpbmdDb250ZXh0ID09PSBiaW5kaW5nQ29udGV4dCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMudW5iaW5kKCk7XG4gICAgfVxuXG4gICAgdGhpcy5pc0JvdW5kID0gdHJ1ZTtcbiAgICB0aGlzLmJpbmRpbmdDb250ZXh0ID0gYmluZGluZ0NvbnRleHQ7XG4gICAgdGhpcy5vdmVycmlkZUNvbnRleHQgPSBvdmVycmlkZUNvbnRleHQgfHwgKDAsIF9hdXJlbGlhQmluZGluZy5jcmVhdGVPdmVycmlkZUNvbnRleHQpKGJpbmRpbmdDb250ZXh0KTtcblxuICAgIHRoaXMucmVzb3VyY2VzLl9pbnZva2VIb29rKCdiZWZvcmVCaW5kJywgdGhpcyk7XG5cbiAgICBiaW5kaW5ncyA9IHRoaXMuYmluZGluZ3M7XG4gICAgZm9yIChpID0gMCwgaWkgPSBiaW5kaW5ncy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICBiaW5kaW5nc1tpXS5iaW5kKHRoaXMpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnZpZXdNb2RlbFNjb3BlICE9PSBudWxsKSB7XG4gICAgICBiaW5kaW5nQ29udGV4dC5iaW5kKHRoaXMudmlld01vZGVsU2NvcGUuYmluZGluZ0NvbnRleHQsIHRoaXMudmlld01vZGVsU2NvcGUub3ZlcnJpZGVDb250ZXh0KTtcbiAgICAgIHRoaXMudmlld01vZGVsU2NvcGUgPSBudWxsO1xuICAgIH1cblxuICAgIGNvbnRyb2xsZXJzID0gdGhpcy5jb250cm9sbGVycztcbiAgICBmb3IgKGkgPSAwLCBpaSA9IGNvbnRyb2xsZXJzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgIGNvbnRyb2xsZXJzW2ldLmJpbmQodGhpcyk7XG4gICAgfVxuXG4gICAgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xuICAgIGZvciAoaSA9IDAsIGlpID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgY2hpbGRyZW5baV0uYmluZChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0LCB0cnVlKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5oYXNTbG90cykge1xuICAgICAgU2hhZG93RE9NLmRpc3RyaWJ1dGVWaWV3KHRoaXMuY29udGVudFZpZXcsIHRoaXMuc2xvdHMpO1xuICAgIH1cbiAgfTtcblxuICBWaWV3LnByb3RvdHlwZS5hZGRCaW5kaW5nID0gZnVuY3Rpb24gYWRkQmluZGluZyhiaW5kaW5nKSB7XG4gICAgdGhpcy5iaW5kaW5ncy5wdXNoKGJpbmRpbmcpO1xuXG4gICAgaWYgKHRoaXMuaXNCb3VuZCkge1xuICAgICAgYmluZGluZy5iaW5kKHRoaXMpO1xuICAgIH1cbiAgfTtcblxuICBWaWV3LnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiB1bmJpbmQoKSB7XG4gICAgdmFyIGNvbnRyb2xsZXJzID0gdm9pZCAwO1xuICAgIHZhciBiaW5kaW5ncyA9IHZvaWQgMDtcbiAgICB2YXIgY2hpbGRyZW4gPSB2b2lkIDA7XG4gICAgdmFyIGkgPSB2b2lkIDA7XG4gICAgdmFyIGlpID0gdm9pZCAwO1xuXG4gICAgaWYgKHRoaXMuaXNCb3VuZCkge1xuICAgICAgdGhpcy5pc0JvdW5kID0gZmFsc2U7XG4gICAgICB0aGlzLnJlc291cmNlcy5faW52b2tlSG9vaygnYmVmb3JlVW5iaW5kJywgdGhpcyk7XG5cbiAgICAgIGlmICh0aGlzLmNvbnRyb2xsZXIgIT09IG51bGwpIHtcbiAgICAgICAgdGhpcy5jb250cm9sbGVyLnVuYmluZCgpO1xuICAgICAgfVxuXG4gICAgICBiaW5kaW5ncyA9IHRoaXMuYmluZGluZ3M7XG4gICAgICBmb3IgKGkgPSAwLCBpaSA9IGJpbmRpbmdzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgYmluZGluZ3NbaV0udW5iaW5kKCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnRyb2xsZXJzID0gdGhpcy5jb250cm9sbGVycztcbiAgICAgIGZvciAoaSA9IDAsIGlpID0gY29udHJvbGxlcnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgICBjb250cm9sbGVyc1tpXS51bmJpbmQoKTtcbiAgICAgIH1cblxuICAgICAgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xuICAgICAgZm9yIChpID0gMCwgaWkgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgIGNoaWxkcmVuW2ldLnVuYmluZCgpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmJpbmRpbmdDb250ZXh0ID0gbnVsbDtcbiAgICAgIHRoaXMub3ZlcnJpZGVDb250ZXh0ID0gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgVmlldy5wcm90b3R5cGUuaW5zZXJ0Tm9kZXNCZWZvcmUgPSBmdW5jdGlvbiBpbnNlcnROb2Rlc0JlZm9yZShyZWZOb2RlKSB7XG4gICAgcmVmTm9kZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0aGlzLmZyYWdtZW50LCByZWZOb2RlKTtcbiAgfTtcblxuICBWaWV3LnByb3RvdHlwZS5hcHBlbmROb2Rlc1RvID0gZnVuY3Rpb24gYXBwZW5kTm9kZXNUbyhwYXJlbnQpIHtcbiAgICBwYXJlbnQuYXBwZW5kQ2hpbGQodGhpcy5mcmFnbWVudCk7XG4gIH07XG5cbiAgVmlldy5wcm90b3R5cGUucmVtb3ZlTm9kZXMgPSBmdW5jdGlvbiByZW1vdmVOb2RlcygpIHtcbiAgICB2YXIgZnJhZ21lbnQgPSB0aGlzLmZyYWdtZW50O1xuICAgIHZhciBjdXJyZW50ID0gdGhpcy5maXJzdENoaWxkO1xuICAgIHZhciBlbmQgPSB0aGlzLmxhc3RDaGlsZDtcbiAgICB2YXIgbmV4dCA9IHZvaWQgMDtcblxuICAgIHdoaWxlIChjdXJyZW50KSB7XG4gICAgICBuZXh0ID0gY3VycmVudC5uZXh0U2libGluZztcbiAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKGN1cnJlbnQpO1xuXG4gICAgICBpZiAoY3VycmVudCA9PT0gZW5kKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICBjdXJyZW50ID0gbmV4dDtcbiAgICB9XG4gIH07XG5cbiAgVmlldy5wcm90b3R5cGUuYXR0YWNoZWQgPSBmdW5jdGlvbiBhdHRhY2hlZCgpIHtcbiAgICB2YXIgY29udHJvbGxlcnMgPSB2b2lkIDA7XG4gICAgdmFyIGNoaWxkcmVuID0gdm9pZCAwO1xuICAgIHZhciBpID0gdm9pZCAwO1xuICAgIHZhciBpaSA9IHZvaWQgMDtcblxuICAgIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmlzQXR0YWNoZWQgPSB0cnVlO1xuXG4gICAgaWYgKHRoaXMuY29udHJvbGxlciAhPT0gbnVsbCkge1xuICAgICAgdGhpcy5jb250cm9sbGVyLmF0dGFjaGVkKCk7XG4gICAgfVxuXG4gICAgY29udHJvbGxlcnMgPSB0aGlzLmNvbnRyb2xsZXJzO1xuICAgIGZvciAoaSA9IDAsIGlpID0gY29udHJvbGxlcnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgY29udHJvbGxlcnNbaV0uYXR0YWNoZWQoKTtcbiAgICB9XG5cbiAgICBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XG4gICAgZm9yIChpID0gMCwgaWkgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICBjaGlsZHJlbltpXS5hdHRhY2hlZCgpO1xuICAgIH1cbiAgfTtcblxuICBWaWV3LnByb3RvdHlwZS5kZXRhY2hlZCA9IGZ1bmN0aW9uIGRldGFjaGVkKCkge1xuICAgIHZhciBjb250cm9sbGVycyA9IHZvaWQgMDtcbiAgICB2YXIgY2hpbGRyZW4gPSB2b2lkIDA7XG4gICAgdmFyIGkgPSB2b2lkIDA7XG4gICAgdmFyIGlpID0gdm9pZCAwO1xuXG4gICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xuICAgICAgdGhpcy5pc0F0dGFjaGVkID0gZmFsc2U7XG5cbiAgICAgIGlmICh0aGlzLmNvbnRyb2xsZXIgIT09IG51bGwpIHtcbiAgICAgICAgdGhpcy5jb250cm9sbGVyLmRldGFjaGVkKCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnRyb2xsZXJzID0gdGhpcy5jb250cm9sbGVycztcbiAgICAgIGZvciAoaSA9IDAsIGlpID0gY29udHJvbGxlcnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgICBjb250cm9sbGVyc1tpXS5kZXRhY2hlZCgpO1xuICAgICAgfVxuXG4gICAgICBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XG4gICAgICBmb3IgKGkgPSAwLCBpaSA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgY2hpbGRyZW5baV0uZGV0YWNoZWQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIFZpZXc7XG59KCk7XG5cbmZ1bmN0aW9uIGdldEFuaW1hdGFibGVFbGVtZW50KHZpZXcpIHtcbiAgaWYgKHZpZXcuYW5pbWF0YWJsZUVsZW1lbnQgIT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiB2aWV3LmFuaW1hdGFibGVFbGVtZW50O1xuICB9XG5cbiAgdmFyIGN1cnJlbnQgPSB2aWV3LmZpcnN0Q2hpbGQ7XG5cbiAgd2hpbGUgKGN1cnJlbnQgJiYgY3VycmVudC5ub2RlVHlwZSAhPT0gMSkge1xuICAgIGN1cnJlbnQgPSBjdXJyZW50Lm5leHRTaWJsaW5nO1xuICB9XG5cbiAgaWYgKGN1cnJlbnQgJiYgY3VycmVudC5ub2RlVHlwZSA9PT0gMSkge1xuICAgIHJldHVybiB2aWV3LmFuaW1hdGFibGVFbGVtZW50ID0gY3VycmVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2F1LWFuaW1hdGUnKSA/IGN1cnJlbnQgOiBudWxsO1xuICB9XG5cbiAgcmV0dXJuIHZpZXcuYW5pbWF0YWJsZUVsZW1lbnQgPSBudWxsO1xufVxuXG52YXIgVmlld1Nsb3QgPSBleHBvcnRzLlZpZXdTbG90ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBWaWV3U2xvdChhbmNob3IsIGFuY2hvcklzQ29udGFpbmVyKSB7XG4gICAgdmFyIGFuaW1hdG9yID0gYXJndW1lbnRzLmxlbmd0aCA8PSAyIHx8IGFyZ3VtZW50c1syXSA9PT0gdW5kZWZpbmVkID8gQW5pbWF0b3IuaW5zdGFuY2UgOiBhcmd1bWVudHNbMl07XG5cbiAgICBcblxuICAgIHRoaXMuYW5jaG9yID0gYW5jaG9yO1xuICAgIHRoaXMuYW5jaG9ySXNDb250YWluZXIgPSBhbmNob3JJc0NvbnRhaW5lcjtcbiAgICB0aGlzLmJpbmRpbmdDb250ZXh0ID0gbnVsbDtcbiAgICB0aGlzLm92ZXJyaWRlQ29udGV4dCA9IG51bGw7XG4gICAgdGhpcy5hbmltYXRvciA9IGFuaW1hdG9yO1xuICAgIHRoaXMuY2hpbGRyZW4gPSBbXTtcbiAgICB0aGlzLmlzQm91bmQgPSBmYWxzZTtcbiAgICB0aGlzLmlzQXR0YWNoZWQgPSBmYWxzZTtcbiAgICB0aGlzLmNvbnRlbnRTZWxlY3RvcnMgPSBudWxsO1xuICAgIGFuY2hvci52aWV3U2xvdCA9IHRoaXM7XG4gICAgYW5jaG9yLmlzQ29udGVudFByb2plY3Rpb25Tb3VyY2UgPSBmYWxzZTtcbiAgfVxuXG4gIFZpZXdTbG90LnByb3RvdHlwZS5hbmltYXRlVmlldyA9IGZ1bmN0aW9uIGFuaW1hdGVWaWV3KHZpZXcpIHtcbiAgICB2YXIgZGlyZWN0aW9uID0gYXJndW1lbnRzLmxlbmd0aCA8PSAxIHx8IGFyZ3VtZW50c1sxXSA9PT0gdW5kZWZpbmVkID8gJ2VudGVyJyA6IGFyZ3VtZW50c1sxXTtcblxuICAgIHZhciBhbmltYXRhYmxlRWxlbWVudCA9IGdldEFuaW1hdGFibGVFbGVtZW50KHZpZXcpO1xuXG4gICAgaWYgKGFuaW1hdGFibGVFbGVtZW50ICE9PSBudWxsKSB7XG4gICAgICBzd2l0Y2ggKGRpcmVjdGlvbikge1xuICAgICAgICBjYXNlICdlbnRlcic6XG4gICAgICAgICAgcmV0dXJuIHRoaXMuYW5pbWF0b3IuZW50ZXIoYW5pbWF0YWJsZUVsZW1lbnQpO1xuICAgICAgICBjYXNlICdsZWF2ZSc6XG4gICAgICAgICAgcmV0dXJuIHRoaXMuYW5pbWF0b3IubGVhdmUoYW5pbWF0YWJsZUVsZW1lbnQpO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBhbmltYXRpb24gZGlyZWN0aW9uOiAnICsgZGlyZWN0aW9uKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgVmlld1Nsb3QucHJvdG90eXBlLnRyYW5zZm9ybUNoaWxkTm9kZXNJbnRvVmlldyA9IGZ1bmN0aW9uIHRyYW5zZm9ybUNoaWxkTm9kZXNJbnRvVmlldygpIHtcbiAgICB2YXIgcGFyZW50ID0gdGhpcy5hbmNob3I7XG5cbiAgICB0aGlzLmNoaWxkcmVuLnB1c2goe1xuICAgICAgZnJhZ21lbnQ6IHBhcmVudCxcbiAgICAgIGZpcnN0Q2hpbGQ6IHBhcmVudC5maXJzdENoaWxkLFxuICAgICAgbGFzdENoaWxkOiBwYXJlbnQubGFzdENoaWxkLFxuICAgICAgcmV0dXJuVG9DYWNoZTogZnVuY3Rpb24gcmV0dXJuVG9DYWNoZSgpIHt9LFxuICAgICAgcmVtb3ZlTm9kZXM6IGZ1bmN0aW9uIHJlbW92ZU5vZGVzKCkge1xuICAgICAgICB2YXIgbGFzdCA9IHZvaWQgMDtcblxuICAgICAgICB3aGlsZSAobGFzdCA9IHBhcmVudC5sYXN0Q2hpbGQpIHtcbiAgICAgICAgICBwYXJlbnQucmVtb3ZlQ2hpbGQobGFzdCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkge30sXG4gICAgICBiaW5kOiBmdW5jdGlvbiBiaW5kKCkge30sXG4gICAgICB1bmJpbmQ6IGZ1bmN0aW9uIHVuYmluZCgpIHt9LFxuICAgICAgYXR0YWNoZWQ6IGZ1bmN0aW9uIGF0dGFjaGVkKCkge30sXG4gICAgICBkZXRhY2hlZDogZnVuY3Rpb24gZGV0YWNoZWQoKSB7fVxuICAgIH0pO1xuICB9O1xuXG4gIFZpZXdTbG90LnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KSB7XG4gICAgdmFyIGkgPSB2b2lkIDA7XG4gICAgdmFyIGlpID0gdm9pZCAwO1xuICAgIHZhciBjaGlsZHJlbiA9IHZvaWQgMDtcblxuICAgIGlmICh0aGlzLmlzQm91bmQpIHtcbiAgICAgIGlmICh0aGlzLmJpbmRpbmdDb250ZXh0ID09PSBiaW5kaW5nQ29udGV4dCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMudW5iaW5kKCk7XG4gICAgfVxuXG4gICAgdGhpcy5pc0JvdW5kID0gdHJ1ZTtcbiAgICB0aGlzLmJpbmRpbmdDb250ZXh0ID0gYmluZGluZ0NvbnRleHQgPSBiaW5kaW5nQ29udGV4dCB8fCB0aGlzLmJpbmRpbmdDb250ZXh0O1xuICAgIHRoaXMub3ZlcnJpZGVDb250ZXh0ID0gb3ZlcnJpZGVDb250ZXh0ID0gb3ZlcnJpZGVDb250ZXh0IHx8IHRoaXMub3ZlcnJpZGVDb250ZXh0O1xuXG4gICAgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xuICAgIGZvciAoaSA9IDAsIGlpID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgY2hpbGRyZW5baV0uYmluZChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0LCB0cnVlKTtcbiAgICB9XG4gIH07XG5cbiAgVmlld1Nsb3QucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uIHVuYmluZCgpIHtcbiAgICBpZiAodGhpcy5pc0JvdW5kKSB7XG4gICAgICB2YXIgaSA9IHZvaWQgMDtcbiAgICAgIHZhciBpaSA9IHZvaWQgMDtcbiAgICAgIHZhciBfY2hpbGRyZW40ID0gdGhpcy5jaGlsZHJlbjtcblxuICAgICAgdGhpcy5pc0JvdW5kID0gZmFsc2U7XG4gICAgICB0aGlzLmJpbmRpbmdDb250ZXh0ID0gbnVsbDtcbiAgICAgIHRoaXMub3ZlcnJpZGVDb250ZXh0ID0gbnVsbDtcblxuICAgICAgZm9yIChpID0gMCwgaWkgPSBfY2hpbGRyZW40Lmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgX2NoaWxkcmVuNFtpXS51bmJpbmQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgVmlld1Nsb3QucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIGFkZCh2aWV3KSB7XG4gICAgaWYgKHRoaXMuYW5jaG9ySXNDb250YWluZXIpIHtcbiAgICAgIHZpZXcuYXBwZW5kTm9kZXNUbyh0aGlzLmFuY2hvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZpZXcuaW5zZXJ0Tm9kZXNCZWZvcmUodGhpcy5hbmNob3IpO1xuICAgIH1cblxuICAgIHRoaXMuY2hpbGRyZW4ucHVzaCh2aWV3KTtcblxuICAgIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcbiAgICAgIHZpZXcuYXR0YWNoZWQoKTtcbiAgICAgIHJldHVybiB0aGlzLmFuaW1hdGVWaWV3KHZpZXcsICdlbnRlcicpO1xuICAgIH1cbiAgfTtcblxuICBWaWV3U2xvdC5wcm90b3R5cGUuaW5zZXJ0ID0gZnVuY3Rpb24gaW5zZXJ0KGluZGV4LCB2aWV3KSB7XG4gICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcbiAgICB2YXIgbGVuZ3RoID0gY2hpbGRyZW4ubGVuZ3RoO1xuXG4gICAgaWYgKGluZGV4ID09PSAwICYmIGxlbmd0aCA9PT0gMCB8fCBpbmRleCA+PSBsZW5ndGgpIHtcbiAgICAgIHJldHVybiB0aGlzLmFkZCh2aWV3KTtcbiAgICB9XG5cbiAgICB2aWV3Lmluc2VydE5vZGVzQmVmb3JlKGNoaWxkcmVuW2luZGV4XS5maXJzdENoaWxkKTtcbiAgICBjaGlsZHJlbi5zcGxpY2UoaW5kZXgsIDAsIHZpZXcpO1xuXG4gICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xuICAgICAgdmlldy5hdHRhY2hlZCgpO1xuICAgICAgcmV0dXJuIHRoaXMuYW5pbWF0ZVZpZXcodmlldywgJ2VudGVyJyk7XG4gICAgfVxuICB9O1xuXG4gIFZpZXdTbG90LnByb3RvdHlwZS5tb3ZlID0gZnVuY3Rpb24gbW92ZShzb3VyY2VJbmRleCwgdGFyZ2V0SW5kZXgpIHtcbiAgICBpZiAoc291cmNlSW5kZXggPT09IHRhcmdldEluZGV4KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcbiAgICB2YXIgdmlldyA9IGNoaWxkcmVuW3NvdXJjZUluZGV4XTtcblxuICAgIHZpZXcucmVtb3ZlTm9kZXMoKTtcbiAgICB2aWV3Lmluc2VydE5vZGVzQmVmb3JlKGNoaWxkcmVuW3RhcmdldEluZGV4XS5maXJzdENoaWxkKTtcbiAgICBjaGlsZHJlbi5zcGxpY2Uoc291cmNlSW5kZXgsIDEpO1xuICAgIGNoaWxkcmVuLnNwbGljZSh0YXJnZXRJbmRleCwgMCwgdmlldyk7XG4gIH07XG5cbiAgVmlld1Nsb3QucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uIHJlbW92ZSh2aWV3LCByZXR1cm5Ub0NhY2hlLCBza2lwQW5pbWF0aW9uKSB7XG4gICAgcmV0dXJuIHRoaXMucmVtb3ZlQXQodGhpcy5jaGlsZHJlbi5pbmRleE9mKHZpZXcpLCByZXR1cm5Ub0NhY2hlLCBza2lwQW5pbWF0aW9uKTtcbiAgfTtcblxuICBWaWV3U2xvdC5wcm90b3R5cGUucmVtb3ZlTWFueSA9IGZ1bmN0aW9uIHJlbW92ZU1hbnkodmlld3NUb1JlbW92ZSwgcmV0dXJuVG9DYWNoZSwgc2tpcEFuaW1hdGlvbikge1xuICAgIHZhciBfdGhpczQgPSB0aGlzO1xuXG4gICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcbiAgICB2YXIgaWkgPSB2aWV3c1RvUmVtb3ZlLmxlbmd0aDtcbiAgICB2YXIgaSA9IHZvaWQgMDtcbiAgICB2YXIgcm1Qcm9taXNlcyA9IFtdO1xuXG4gICAgdmlld3NUb1JlbW92ZS5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZCkge1xuICAgICAgaWYgKHNraXBBbmltYXRpb24pIHtcbiAgICAgICAgY2hpbGQucmVtb3ZlTm9kZXMoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB2YXIgYW5pbWF0aW9uID0gX3RoaXM0LmFuaW1hdGVWaWV3KGNoaWxkLCAnbGVhdmUnKTtcbiAgICAgIGlmIChhbmltYXRpb24pIHtcbiAgICAgICAgcm1Qcm9taXNlcy5wdXNoKGFuaW1hdGlvbi50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gY2hpbGQucmVtb3ZlTm9kZXMoKTtcbiAgICAgICAgfSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2hpbGQucmVtb3ZlTm9kZXMoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHZhciByZW1vdmVBY3Rpb24gPSBmdW5jdGlvbiByZW1vdmVBY3Rpb24oKSB7XG4gICAgICBpZiAoX3RoaXM0LmlzQXR0YWNoZWQpIHtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgICB2aWV3c1RvUmVtb3ZlW2ldLmRldGFjaGVkKCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHJldHVyblRvQ2FjaGUpIHtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgICB2aWV3c1RvUmVtb3ZlW2ldLnJldHVyblRvQ2FjaGUoKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmb3IgKGkgPSAwOyBpIDwgaWk7ICsraSkge1xuICAgICAgICB2YXIgaW5kZXggPSBjaGlsZHJlbi5pbmRleE9mKHZpZXdzVG9SZW1vdmVbaV0pO1xuICAgICAgICBpZiAoaW5kZXggPj0gMCkge1xuICAgICAgICAgIGNoaWxkcmVuLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgaWYgKHJtUHJvbWlzZXMubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIFByb21pc2UuYWxsKHJtUHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gcmVtb3ZlQWN0aW9uKCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVtb3ZlQWN0aW9uKCk7XG4gIH07XG5cbiAgVmlld1Nsb3QucHJvdG90eXBlLnJlbW92ZUF0ID0gZnVuY3Rpb24gcmVtb3ZlQXQoaW5kZXgsIHJldHVyblRvQ2FjaGUsIHNraXBBbmltYXRpb24pIHtcbiAgICB2YXIgX3RoaXM1ID0gdGhpcztcblxuICAgIHZhciB2aWV3ID0gdGhpcy5jaGlsZHJlbltpbmRleF07XG5cbiAgICB2YXIgcmVtb3ZlQWN0aW9uID0gZnVuY3Rpb24gcmVtb3ZlQWN0aW9uKCkge1xuICAgICAgaW5kZXggPSBfdGhpczUuY2hpbGRyZW4uaW5kZXhPZih2aWV3KTtcbiAgICAgIHZpZXcucmVtb3ZlTm9kZXMoKTtcbiAgICAgIF90aGlzNS5jaGlsZHJlbi5zcGxpY2UoaW5kZXgsIDEpO1xuXG4gICAgICBpZiAoX3RoaXM1LmlzQXR0YWNoZWQpIHtcbiAgICAgICAgdmlldy5kZXRhY2hlZCgpO1xuICAgICAgfVxuXG4gICAgICBpZiAocmV0dXJuVG9DYWNoZSkge1xuICAgICAgICB2aWV3LnJldHVyblRvQ2FjaGUoKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHZpZXc7XG4gICAgfTtcblxuICAgIGlmICghc2tpcEFuaW1hdGlvbikge1xuICAgICAgdmFyIGFuaW1hdGlvbiA9IHRoaXMuYW5pbWF0ZVZpZXcodmlldywgJ2xlYXZlJyk7XG4gICAgICBpZiAoYW5pbWF0aW9uKSB7XG4gICAgICAgIHJldHVybiBhbmltYXRpb24udGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHJlbW92ZUFjdGlvbigpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVtb3ZlQWN0aW9uKCk7XG4gIH07XG5cbiAgVmlld1Nsb3QucHJvdG90eXBlLnJlbW92ZUFsbCA9IGZ1bmN0aW9uIHJlbW92ZUFsbChyZXR1cm5Ub0NhY2hlLCBza2lwQW5pbWF0aW9uKSB7XG4gICAgdmFyIF90aGlzNiA9IHRoaXM7XG5cbiAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xuICAgIHZhciBpaSA9IGNoaWxkcmVuLmxlbmd0aDtcbiAgICB2YXIgaSA9IHZvaWQgMDtcbiAgICB2YXIgcm1Qcm9taXNlcyA9IFtdO1xuXG4gICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHtcbiAgICAgIGlmIChza2lwQW5pbWF0aW9uKSB7XG4gICAgICAgIGNoaWxkLnJlbW92ZU5vZGVzKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdmFyIGFuaW1hdGlvbiA9IF90aGlzNi5hbmltYXRlVmlldyhjaGlsZCwgJ2xlYXZlJyk7XG4gICAgICBpZiAoYW5pbWF0aW9uKSB7XG4gICAgICAgIHJtUHJvbWlzZXMucHVzaChhbmltYXRpb24udGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGNoaWxkLnJlbW92ZU5vZGVzKCk7XG4gICAgICAgIH0pKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNoaWxkLnJlbW92ZU5vZGVzKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgcmVtb3ZlQWN0aW9uID0gZnVuY3Rpb24gcmVtb3ZlQWN0aW9uKCkge1xuICAgICAgaWYgKF90aGlzNi5pc0F0dGFjaGVkKSB7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgICAgY2hpbGRyZW5baV0uZGV0YWNoZWQoKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAocmV0dXJuVG9DYWNoZSkge1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaWk7ICsraSkge1xuICAgICAgICAgIGNoaWxkcmVuW2ldLnJldHVyblRvQ2FjaGUoKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBfdGhpczYuY2hpbGRyZW4gPSBbXTtcbiAgICB9O1xuXG4gICAgaWYgKHJtUHJvbWlzZXMubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIFByb21pc2UuYWxsKHJtUHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gcmVtb3ZlQWN0aW9uKCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVtb3ZlQWN0aW9uKCk7XG4gIH07XG5cbiAgVmlld1Nsb3QucHJvdG90eXBlLmF0dGFjaGVkID0gZnVuY3Rpb24gYXR0YWNoZWQoKSB7XG4gICAgdmFyIGkgPSB2b2lkIDA7XG4gICAgdmFyIGlpID0gdm9pZCAwO1xuICAgIHZhciBjaGlsZHJlbiA9IHZvaWQgMDtcbiAgICB2YXIgY2hpbGQgPSB2b2lkIDA7XG5cbiAgICBpZiAodGhpcy5pc0F0dGFjaGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5pc0F0dGFjaGVkID0gdHJ1ZTtcblxuICAgIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcbiAgICBmb3IgKGkgPSAwLCBpaSA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgIGNoaWxkID0gY2hpbGRyZW5baV07XG4gICAgICBjaGlsZC5hdHRhY2hlZCgpO1xuICAgICAgdGhpcy5hbmltYXRlVmlldyhjaGlsZCwgJ2VudGVyJyk7XG4gICAgfVxuICB9O1xuXG4gIFZpZXdTbG90LnByb3RvdHlwZS5kZXRhY2hlZCA9IGZ1bmN0aW9uIGRldGFjaGVkKCkge1xuICAgIHZhciBpID0gdm9pZCAwO1xuICAgIHZhciBpaSA9IHZvaWQgMDtcbiAgICB2YXIgY2hpbGRyZW4gPSB2b2lkIDA7XG5cbiAgICBpZiAodGhpcy5pc0F0dGFjaGVkKSB7XG4gICAgICB0aGlzLmlzQXR0YWNoZWQgPSBmYWxzZTtcbiAgICAgIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcbiAgICAgIGZvciAoaSA9IDAsIGlpID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgICBjaGlsZHJlbltpXS5kZXRhY2hlZCgpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBWaWV3U2xvdC5wcm90b3R5cGUucHJvamVjdFRvID0gZnVuY3Rpb24gcHJvamVjdFRvKHNsb3RzKSB7XG4gICAgdmFyIF90aGlzNyA9IHRoaXM7XG5cbiAgICB0aGlzLnByb2plY3RUb1Nsb3RzID0gc2xvdHM7XG4gICAgdGhpcy5hZGQgPSB0aGlzLl9wcm9qZWN0aW9uQWRkO1xuICAgIHRoaXMuaW5zZXJ0ID0gdGhpcy5fcHJvamVjdGlvbkluc2VydDtcbiAgICB0aGlzLm1vdmUgPSB0aGlzLl9wcm9qZWN0aW9uTW92ZTtcbiAgICB0aGlzLnJlbW92ZSA9IHRoaXMuX3Byb2plY3Rpb25SZW1vdmU7XG4gICAgdGhpcy5yZW1vdmVBdCA9IHRoaXMuX3Byb2plY3Rpb25SZW1vdmVBdDtcbiAgICB0aGlzLnJlbW92ZU1hbnkgPSB0aGlzLl9wcm9qZWN0aW9uUmVtb3ZlTWFueTtcbiAgICB0aGlzLnJlbW92ZUFsbCA9IHRoaXMuX3Byb2plY3Rpb25SZW1vdmVBbGw7XG4gICAgdGhpcy5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uICh2aWV3KSB7XG4gICAgICByZXR1cm4gU2hhZG93RE9NLmRpc3RyaWJ1dGVWaWV3KHZpZXcsIHNsb3RzLCBfdGhpczcpO1xuICAgIH0pO1xuICB9O1xuXG4gIFZpZXdTbG90LnByb3RvdHlwZS5fcHJvamVjdGlvbkFkZCA9IGZ1bmN0aW9uIF9wcm9qZWN0aW9uQWRkKHZpZXcpIHtcbiAgICBTaGFkb3dET00uZGlzdHJpYnV0ZVZpZXcodmlldywgdGhpcy5wcm9qZWN0VG9TbG90cywgdGhpcyk7XG5cbiAgICB0aGlzLmNoaWxkcmVuLnB1c2godmlldyk7XG5cbiAgICBpZiAodGhpcy5pc0F0dGFjaGVkKSB7XG4gICAgICB2aWV3LmF0dGFjaGVkKCk7XG4gICAgfVxuICB9O1xuXG4gIFZpZXdTbG90LnByb3RvdHlwZS5fcHJvamVjdGlvbkluc2VydCA9IGZ1bmN0aW9uIF9wcm9qZWN0aW9uSW5zZXJ0KGluZGV4LCB2aWV3KSB7XG4gICAgaWYgKGluZGV4ID09PSAwICYmICF0aGlzLmNoaWxkcmVuLmxlbmd0aCB8fCBpbmRleCA+PSB0aGlzLmNoaWxkcmVuLmxlbmd0aCkge1xuICAgICAgdGhpcy5hZGQodmlldyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIFNoYWRvd0RPTS5kaXN0cmlidXRlVmlldyh2aWV3LCB0aGlzLnByb2plY3RUb1Nsb3RzLCB0aGlzLCBpbmRleCk7XG5cbiAgICAgIHRoaXMuY2hpbGRyZW4uc3BsaWNlKGluZGV4LCAwLCB2aWV3KTtcblxuICAgICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xuICAgICAgICB2aWV3LmF0dGFjaGVkKCk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIFZpZXdTbG90LnByb3RvdHlwZS5fcHJvamVjdGlvbk1vdmUgPSBmdW5jdGlvbiBfcHJvamVjdGlvbk1vdmUoc291cmNlSW5kZXgsIHRhcmdldEluZGV4KSB7XG4gICAgaWYgKHNvdXJjZUluZGV4ID09PSB0YXJnZXRJbmRleCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XG4gICAgdmFyIHZpZXcgPSBjaGlsZHJlbltzb3VyY2VJbmRleF07XG5cbiAgICBTaGFkb3dET00udW5kaXN0cmlidXRlVmlldyh2aWV3LCB0aGlzLnByb2plY3RUb1Nsb3RzLCB0aGlzKTtcbiAgICBTaGFkb3dET00uZGlzdHJpYnV0ZVZpZXcodmlldywgdGhpcy5wcm9qZWN0VG9TbG90cywgdGhpcywgdGFyZ2V0SW5kZXgpO1xuXG4gICAgY2hpbGRyZW4uc3BsaWNlKHNvdXJjZUluZGV4LCAxKTtcbiAgICBjaGlsZHJlbi5zcGxpY2UodGFyZ2V0SW5kZXgsIDAsIHZpZXcpO1xuICB9O1xuXG4gIFZpZXdTbG90LnByb3RvdHlwZS5fcHJvamVjdGlvblJlbW92ZSA9IGZ1bmN0aW9uIF9wcm9qZWN0aW9uUmVtb3ZlKHZpZXcsIHJldHVyblRvQ2FjaGUpIHtcbiAgICBTaGFkb3dET00udW5kaXN0cmlidXRlVmlldyh2aWV3LCB0aGlzLnByb2plY3RUb1Nsb3RzLCB0aGlzKTtcbiAgICB0aGlzLmNoaWxkcmVuLnNwbGljZSh0aGlzLmNoaWxkcmVuLmluZGV4T2YodmlldyksIDEpO1xuXG4gICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xuICAgICAgdmlldy5kZXRhY2hlZCgpO1xuICAgIH1cbiAgfTtcblxuICBWaWV3U2xvdC5wcm90b3R5cGUuX3Byb2plY3Rpb25SZW1vdmVBdCA9IGZ1bmN0aW9uIF9wcm9qZWN0aW9uUmVtb3ZlQXQoaW5kZXgsIHJldHVyblRvQ2FjaGUpIHtcbiAgICB2YXIgdmlldyA9IHRoaXMuY2hpbGRyZW5baW5kZXhdO1xuXG4gICAgU2hhZG93RE9NLnVuZGlzdHJpYnV0ZVZpZXcodmlldywgdGhpcy5wcm9qZWN0VG9TbG90cywgdGhpcyk7XG4gICAgdGhpcy5jaGlsZHJlbi5zcGxpY2UoaW5kZXgsIDEpO1xuXG4gICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xuICAgICAgdmlldy5kZXRhY2hlZCgpO1xuICAgIH1cbiAgfTtcblxuICBWaWV3U2xvdC5wcm90b3R5cGUuX3Byb2plY3Rpb25SZW1vdmVNYW55ID0gZnVuY3Rpb24gX3Byb2plY3Rpb25SZW1vdmVNYW55KHZpZXdzVG9SZW1vdmUsIHJldHVyblRvQ2FjaGUpIHtcbiAgICB2YXIgX3RoaXM4ID0gdGhpcztcblxuICAgIHZpZXdzVG9SZW1vdmUuZm9yRWFjaChmdW5jdGlvbiAodmlldykge1xuICAgICAgcmV0dXJuIF90aGlzOC5yZW1vdmUodmlldywgcmV0dXJuVG9DYWNoZSk7XG4gICAgfSk7XG4gIH07XG5cbiAgVmlld1Nsb3QucHJvdG90eXBlLl9wcm9qZWN0aW9uUmVtb3ZlQWxsID0gZnVuY3Rpb24gX3Byb2plY3Rpb25SZW1vdmVBbGwocmV0dXJuVG9DYWNoZSkge1xuICAgIFNoYWRvd0RPTS51bmRpc3RyaWJ1dGVBbGwodGhpcy5wcm9qZWN0VG9TbG90cywgdGhpcyk7XG5cbiAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xuXG4gICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgICBjaGlsZHJlbltpXS5kZXRhY2hlZCgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuY2hpbGRyZW4gPSBbXTtcbiAgfTtcblxuICByZXR1cm4gVmlld1Nsb3Q7XG59KCk7XG5cbnZhciBQcm92aWRlclJlc29sdmVyID0gKDAsIF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbi5yZXNvbHZlcikoX2NsYXNzMTUgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFByb3ZpZGVyUmVzb2x2ZXIoKSB7XG4gICAgXG4gIH1cblxuICBQcm92aWRlclJlc29sdmVyLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiBnZXQoY29udGFpbmVyLCBrZXkpIHtcbiAgICB2YXIgaWQgPSBrZXkuX19wcm92aWRlcklkX187XG4gICAgcmV0dXJuIGlkIGluIGNvbnRhaW5lciA/IGNvbnRhaW5lcltpZF0gOiBjb250YWluZXJbaWRdID0gY29udGFpbmVyLmludm9rZShrZXkpO1xuICB9O1xuXG4gIHJldHVybiBQcm92aWRlclJlc29sdmVyO1xufSgpKSB8fCBfY2xhc3MxNTtcblxudmFyIHByb3ZpZGVyUmVzb2x2ZXJJbnN0YW5jZSA9IG5ldyBQcm92aWRlclJlc29sdmVyKCk7XG5cbmZ1bmN0aW9uIGVsZW1lbnRDb250YWluZXJHZXQoa2V5KSB7XG4gIGlmIChrZXkgPT09IF9hdXJlbGlhUGFsLkRPTS5FbGVtZW50KSB7XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudDtcbiAgfVxuXG4gIGlmIChrZXkgPT09IEJvdW5kVmlld0ZhY3RvcnkpIHtcbiAgICBpZiAodGhpcy5ib3VuZFZpZXdGYWN0b3J5KSB7XG4gICAgICByZXR1cm4gdGhpcy5ib3VuZFZpZXdGYWN0b3J5O1xuICAgIH1cblxuICAgIHZhciBmYWN0b3J5ID0gdGhpcy5pbnN0cnVjdGlvbi52aWV3RmFjdG9yeTtcbiAgICB2YXIgX3BhcnRSZXBsYWNlbWVudHMgPSB0aGlzLnBhcnRSZXBsYWNlbWVudHM7XG5cbiAgICBpZiAoX3BhcnRSZXBsYWNlbWVudHMpIHtcbiAgICAgIGZhY3RvcnkgPSBfcGFydFJlcGxhY2VtZW50c1tmYWN0b3J5LnBhcnRdIHx8IGZhY3Rvcnk7XG4gICAgfVxuXG4gICAgdGhpcy5ib3VuZFZpZXdGYWN0b3J5ID0gbmV3IEJvdW5kVmlld0ZhY3RvcnkodGhpcywgZmFjdG9yeSwgX3BhcnRSZXBsYWNlbWVudHMpO1xuICAgIHJldHVybiB0aGlzLmJvdW5kVmlld0ZhY3Rvcnk7XG4gIH1cblxuICBpZiAoa2V5ID09PSBWaWV3U2xvdCkge1xuICAgIGlmICh0aGlzLnZpZXdTbG90ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMudmlld1Nsb3QgPSBuZXcgVmlld1Nsb3QodGhpcy5lbGVtZW50LCB0aGlzLmluc3RydWN0aW9uLmFuY2hvcklzQ29udGFpbmVyKTtcbiAgICAgIHRoaXMuZWxlbWVudC5pc0NvbnRlbnRQcm9qZWN0aW9uU291cmNlID0gdGhpcy5pbnN0cnVjdGlvbi5saWZ0aW5nO1xuICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKHRoaXMudmlld1Nsb3QpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnZpZXdTbG90O1xuICB9XG5cbiAgaWYgKGtleSA9PT0gRWxlbWVudEV2ZW50cykge1xuICAgIHJldHVybiB0aGlzLmVsZW1lbnRFdmVudHMgfHwgKHRoaXMuZWxlbWVudEV2ZW50cyA9IG5ldyBFbGVtZW50RXZlbnRzKHRoaXMuZWxlbWVudCkpO1xuICB9XG5cbiAgaWYgKGtleSA9PT0gQ29tcG9zaXRpb25UcmFuc2FjdGlvbikge1xuICAgIHJldHVybiB0aGlzLmNvbXBvc2l0aW9uVHJhbnNhY3Rpb24gfHwgKHRoaXMuY29tcG9zaXRpb25UcmFuc2FjdGlvbiA9IHRoaXMucGFyZW50LmdldChrZXkpKTtcbiAgfVxuXG4gIGlmIChrZXkgPT09IFZpZXdSZXNvdXJjZXMpIHtcbiAgICByZXR1cm4gdGhpcy52aWV3UmVzb3VyY2VzO1xuICB9XG5cbiAgaWYgKGtleSA9PT0gVGFyZ2V0SW5zdHJ1Y3Rpb24pIHtcbiAgICByZXR1cm4gdGhpcy5pbnN0cnVjdGlvbjtcbiAgfVxuXG4gIHJldHVybiB0aGlzLnN1cGVyR2V0KGtleSk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnRDb250YWluZXIocGFyZW50LCBlbGVtZW50LCBpbnN0cnVjdGlvbiwgY2hpbGRyZW4sIHBhcnRSZXBsYWNlbWVudHMsIHJlc291cmNlcykge1xuICB2YXIgY29udGFpbmVyID0gcGFyZW50LmNyZWF0ZUNoaWxkKCk7XG4gIHZhciBwcm92aWRlcnMgPSB2b2lkIDA7XG4gIHZhciBpID0gdm9pZCAwO1xuXG4gIGNvbnRhaW5lci5lbGVtZW50ID0gZWxlbWVudDtcbiAgY29udGFpbmVyLmluc3RydWN0aW9uID0gaW5zdHJ1Y3Rpb247XG4gIGNvbnRhaW5lci5jaGlsZHJlbiA9IGNoaWxkcmVuO1xuICBjb250YWluZXIudmlld1Jlc291cmNlcyA9IHJlc291cmNlcztcbiAgY29udGFpbmVyLnBhcnRSZXBsYWNlbWVudHMgPSBwYXJ0UmVwbGFjZW1lbnRzO1xuXG4gIHByb3ZpZGVycyA9IGluc3RydWN0aW9uLnByb3ZpZGVycztcbiAgaSA9IHByb3ZpZGVycy5sZW5ndGg7XG5cbiAgd2hpbGUgKGktLSkge1xuICAgIGNvbnRhaW5lci5fcmVzb2x2ZXJzLnNldChwcm92aWRlcnNbaV0sIHByb3ZpZGVyUmVzb2x2ZXJJbnN0YW5jZSk7XG4gIH1cblxuICBjb250YWluZXIuc3VwZXJHZXQgPSBjb250YWluZXIuZ2V0O1xuICBjb250YWluZXIuZ2V0ID0gZWxlbWVudENvbnRhaW5lckdldDtcblxuICByZXR1cm4gY29udGFpbmVyO1xufVxuXG5mdW5jdGlvbiBtYWtlRWxlbWVudEludG9BbmNob3IoZWxlbWVudCwgZWxlbWVudEluc3RydWN0aW9uKSB7XG4gIHZhciBhbmNob3IgPSBfYXVyZWxpYVBhbC5ET00uY3JlYXRlQ29tbWVudCgnYW5jaG9yJyk7XG5cbiAgaWYgKGVsZW1lbnRJbnN0cnVjdGlvbikge1xuICAgIHZhciBmaXJzdENoaWxkID0gZWxlbWVudC5maXJzdENoaWxkO1xuXG4gICAgaWYgKGZpcnN0Q2hpbGQgJiYgZmlyc3RDaGlsZC50YWdOYW1lID09PSAnQVUtQ09OVEVOVCcpIHtcbiAgICAgIGFuY2hvci5jb250ZW50RWxlbWVudCA9IGZpcnN0Q2hpbGQ7XG4gICAgfVxuXG4gICAgYW5jaG9yLmhhc0F0dHJpYnV0ZSA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICByZXR1cm4gZWxlbWVudC5oYXNBdHRyaWJ1dGUobmFtZSk7XG4gICAgfTtcbiAgICBhbmNob3IuZ2V0QXR0cmlidXRlID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgIHJldHVybiBlbGVtZW50LmdldEF0dHJpYnV0ZShuYW1lKTtcbiAgICB9O1xuICAgIGFuY2hvci5zZXRBdHRyaWJ1dGUgPSBmdW5jdGlvbiAobmFtZSwgdmFsdWUpIHtcbiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKG5hbWUsIHZhbHVlKTtcbiAgICB9O1xuICB9XG5cbiAgX2F1cmVsaWFQYWwuRE9NLnJlcGxhY2VOb2RlKGFuY2hvciwgZWxlbWVudCk7XG5cbiAgcmV0dXJuIGFuY2hvcjtcbn1cblxuZnVuY3Rpb24gYXBwbHlJbnN0cnVjdGlvbnMoY29udGFpbmVycywgZWxlbWVudCwgaW5zdHJ1Y3Rpb24sIGNvbnRyb2xsZXJzLCBiaW5kaW5ncywgY2hpbGRyZW4sIHNoYWRvd1Nsb3RzLCBwYXJ0UmVwbGFjZW1lbnRzLCByZXNvdXJjZXMpIHtcbiAgdmFyIGJlaGF2aW9ySW5zdHJ1Y3Rpb25zID0gaW5zdHJ1Y3Rpb24uYmVoYXZpb3JJbnN0cnVjdGlvbnM7XG4gIHZhciBleHByZXNzaW9ucyA9IGluc3RydWN0aW9uLmV4cHJlc3Npb25zO1xuICB2YXIgZWxlbWVudENvbnRhaW5lciA9IHZvaWQgMDtcbiAgdmFyIGkgPSB2b2lkIDA7XG4gIHZhciBpaSA9IHZvaWQgMDtcbiAgdmFyIGN1cnJlbnQgPSB2b2lkIDA7XG4gIHZhciBpbnN0YW5jZSA9IHZvaWQgMDtcblxuICBpZiAoaW5zdHJ1Y3Rpb24uY29udGVudEV4cHJlc3Npb24pIHtcbiAgICBiaW5kaW5ncy5wdXNoKGluc3RydWN0aW9uLmNvbnRlbnRFeHByZXNzaW9uLmNyZWF0ZUJpbmRpbmcoZWxlbWVudC5uZXh0U2libGluZykpO1xuICAgIGVsZW1lbnQubmV4dFNpYmxpbmcuYXVJbnRlcnBvbGF0aW9uVGFyZ2V0ID0gdHJ1ZTtcbiAgICBlbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWxlbWVudCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGluc3RydWN0aW9uLnNoYWRvd1Nsb3QpIHtcbiAgICB2YXIgY29tbWVudEFuY2hvciA9IF9hdXJlbGlhUGFsLkRPTS5jcmVhdGVDb21tZW50KCdzbG90Jyk7XG4gICAgdmFyIHNsb3QgPSB2b2lkIDA7XG5cbiAgICBpZiAoaW5zdHJ1Y3Rpb24uc2xvdERlc3RpbmF0aW9uKSB7XG4gICAgICBzbG90ID0gbmV3IFBhc3NUaHJvdWdoU2xvdChjb21tZW50QW5jaG9yLCBpbnN0cnVjdGlvbi5zbG90TmFtZSwgaW5zdHJ1Y3Rpb24uc2xvdERlc3RpbmF0aW9uLCBpbnN0cnVjdGlvbi5zbG90RmFsbGJhY2tGYWN0b3J5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2xvdCA9IG5ldyBTaGFkb3dTbG90KGNvbW1lbnRBbmNob3IsIGluc3RydWN0aW9uLnNsb3ROYW1lLCBpbnN0cnVjdGlvbi5zbG90RmFsbGJhY2tGYWN0b3J5KTtcbiAgICB9XG5cbiAgICBfYXVyZWxpYVBhbC5ET00ucmVwbGFjZU5vZGUoY29tbWVudEFuY2hvciwgZWxlbWVudCk7XG4gICAgc2hhZG93U2xvdHNbaW5zdHJ1Y3Rpb24uc2xvdE5hbWVdID0gc2xvdDtcbiAgICBjb250cm9sbGVycy5wdXNoKHNsb3QpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChiZWhhdmlvckluc3RydWN0aW9ucy5sZW5ndGgpIHtcbiAgICBpZiAoIWluc3RydWN0aW9uLmFuY2hvcklzQ29udGFpbmVyKSB7XG4gICAgICBlbGVtZW50ID0gbWFrZUVsZW1lbnRJbnRvQW5jaG9yKGVsZW1lbnQsIGluc3RydWN0aW9uLmVsZW1lbnRJbnN0cnVjdGlvbik7XG4gICAgfVxuXG4gICAgY29udGFpbmVyc1tpbnN0cnVjdGlvbi5pbmplY3RvcklkXSA9IGVsZW1lbnRDb250YWluZXIgPSBjcmVhdGVFbGVtZW50Q29udGFpbmVyKGNvbnRhaW5lcnNbaW5zdHJ1Y3Rpb24ucGFyZW50SW5qZWN0b3JJZF0sIGVsZW1lbnQsIGluc3RydWN0aW9uLCBjaGlsZHJlbiwgcGFydFJlcGxhY2VtZW50cywgcmVzb3VyY2VzKTtcblxuICAgIGZvciAoaSA9IDAsIGlpID0gYmVoYXZpb3JJbnN0cnVjdGlvbnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgY3VycmVudCA9IGJlaGF2aW9ySW5zdHJ1Y3Rpb25zW2ldO1xuICAgICAgaW5zdGFuY2UgPSBjdXJyZW50LnR5cGUuY3JlYXRlKGVsZW1lbnRDb250YWluZXIsIGN1cnJlbnQsIGVsZW1lbnQsIGJpbmRpbmdzKTtcbiAgICAgIGNvbnRyb2xsZXJzLnB1c2goaW5zdGFuY2UpO1xuICAgIH1cbiAgfVxuXG4gIGZvciAoaSA9IDAsIGlpID0gZXhwcmVzc2lvbnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgIGJpbmRpbmdzLnB1c2goZXhwcmVzc2lvbnNbaV0uY3JlYXRlQmluZGluZyhlbGVtZW50KSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gc3R5bGVTdHJpbmdUb09iamVjdChzdHlsZSwgdGFyZ2V0KSB7XG4gIHZhciBhdHRyaWJ1dGVzID0gc3R5bGUuc3BsaXQoJzsnKTtcbiAgdmFyIGZpcnN0SW5kZXhPZkNvbG9uID0gdm9pZCAwO1xuICB2YXIgaSA9IHZvaWQgMDtcbiAgdmFyIGN1cnJlbnQgPSB2b2lkIDA7XG4gIHZhciBrZXkgPSB2b2lkIDA7XG4gIHZhciB2YWx1ZSA9IHZvaWQgMDtcblxuICB0YXJnZXQgPSB0YXJnZXQgfHwge307XG5cbiAgZm9yIChpID0gMDsgaSA8IGF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICBjdXJyZW50ID0gYXR0cmlidXRlc1tpXTtcbiAgICBmaXJzdEluZGV4T2ZDb2xvbiA9IGN1cnJlbnQuaW5kZXhPZignOicpO1xuICAgIGtleSA9IGN1cnJlbnQuc3Vic3RyaW5nKDAsIGZpcnN0SW5kZXhPZkNvbG9uKS50cmltKCk7XG4gICAgdmFsdWUgPSBjdXJyZW50LnN1YnN0cmluZyhmaXJzdEluZGV4T2ZDb2xvbiArIDEpLnRyaW0oKTtcbiAgICB0YXJnZXRba2V5XSA9IHZhbHVlO1xuICB9XG5cbiAgcmV0dXJuIHRhcmdldDtcbn1cblxuZnVuY3Rpb24gc3R5bGVPYmplY3RUb1N0cmluZyhvYmopIHtcbiAgdmFyIHJlc3VsdCA9ICcnO1xuXG4gIGZvciAodmFyIGtleSBpbiBvYmopIHtcbiAgICByZXN1bHQgKz0ga2V5ICsgJzonICsgb2JqW2tleV0gKyAnOyc7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5mdW5jdGlvbiBhcHBseVN1cnJvZ2F0ZUluc3RydWN0aW9uKGNvbnRhaW5lciwgZWxlbWVudCwgaW5zdHJ1Y3Rpb24sIGNvbnRyb2xsZXJzLCBiaW5kaW5ncywgY2hpbGRyZW4pIHtcbiAgdmFyIGJlaGF2aW9ySW5zdHJ1Y3Rpb25zID0gaW5zdHJ1Y3Rpb24uYmVoYXZpb3JJbnN0cnVjdGlvbnM7XG4gIHZhciBleHByZXNzaW9ucyA9IGluc3RydWN0aW9uLmV4cHJlc3Npb25zO1xuICB2YXIgcHJvdmlkZXJzID0gaW5zdHJ1Y3Rpb24ucHJvdmlkZXJzO1xuICB2YXIgdmFsdWVzID0gaW5zdHJ1Y3Rpb24udmFsdWVzO1xuICB2YXIgaSA9IHZvaWQgMDtcbiAgdmFyIGlpID0gdm9pZCAwO1xuICB2YXIgY3VycmVudCA9IHZvaWQgMDtcbiAgdmFyIGluc3RhbmNlID0gdm9pZCAwO1xuICB2YXIgY3VycmVudEF0dHJpYnV0ZVZhbHVlID0gdm9pZCAwO1xuXG4gIGkgPSBwcm92aWRlcnMubGVuZ3RoO1xuICB3aGlsZSAoaS0tKSB7XG4gICAgY29udGFpbmVyLl9yZXNvbHZlcnMuc2V0KHByb3ZpZGVyc1tpXSwgcHJvdmlkZXJSZXNvbHZlckluc3RhbmNlKTtcbiAgfVxuXG4gIGZvciAodmFyIGtleSBpbiB2YWx1ZXMpIHtcbiAgICBjdXJyZW50QXR0cmlidXRlVmFsdWUgPSBlbGVtZW50LmdldEF0dHJpYnV0ZShrZXkpO1xuXG4gICAgaWYgKGN1cnJlbnRBdHRyaWJ1dGVWYWx1ZSkge1xuICAgICAgaWYgKGtleSA9PT0gJ2NsYXNzJykge1xuICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnY2xhc3MnLCBjdXJyZW50QXR0cmlidXRlVmFsdWUgKyAnICcgKyB2YWx1ZXNba2V5XSk7XG4gICAgICB9IGVsc2UgaWYgKGtleSA9PT0gJ3N0eWxlJykge1xuICAgICAgICB2YXIgc3R5bGVPYmplY3QgPSBzdHlsZVN0cmluZ1RvT2JqZWN0KHZhbHVlc1trZXldKTtcbiAgICAgICAgc3R5bGVTdHJpbmdUb09iamVjdChjdXJyZW50QXR0cmlidXRlVmFsdWUsIHN0eWxlT2JqZWN0KTtcbiAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgc3R5bGVPYmplY3RUb1N0cmluZyhzdHlsZU9iamVjdCkpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKGtleSwgdmFsdWVzW2tleV0pO1xuICAgICAgfVxuICB9XG5cbiAgaWYgKGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLmxlbmd0aCkge1xuICAgIGZvciAoaSA9IDAsIGlpID0gYmVoYXZpb3JJbnN0cnVjdGlvbnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgY3VycmVudCA9IGJlaGF2aW9ySW5zdHJ1Y3Rpb25zW2ldO1xuICAgICAgaW5zdGFuY2UgPSBjdXJyZW50LnR5cGUuY3JlYXRlKGNvbnRhaW5lciwgY3VycmVudCwgZWxlbWVudCwgYmluZGluZ3MpO1xuXG4gICAgICBpZiAoaW5zdGFuY2UuY29udGVudFZpZXcpIHtcbiAgICAgICAgY2hpbGRyZW4ucHVzaChpbnN0YW5jZS5jb250ZW50Vmlldyk7XG4gICAgICB9XG5cbiAgICAgIGNvbnRyb2xsZXJzLnB1c2goaW5zdGFuY2UpO1xuICAgIH1cbiAgfVxuXG4gIGZvciAoaSA9IDAsIGlpID0gZXhwcmVzc2lvbnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgIGJpbmRpbmdzLnB1c2goZXhwcmVzc2lvbnNbaV0uY3JlYXRlQmluZGluZyhlbGVtZW50KSk7XG4gIH1cbn1cblxudmFyIEJvdW5kVmlld0ZhY3RvcnkgPSBleHBvcnRzLkJvdW5kVmlld0ZhY3RvcnkgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEJvdW5kVmlld0ZhY3RvcnkocGFyZW50Q29udGFpbmVyLCB2aWV3RmFjdG9yeSwgcGFydFJlcGxhY2VtZW50cykge1xuICAgIFxuXG4gICAgdGhpcy5wYXJlbnRDb250YWluZXIgPSBwYXJlbnRDb250YWluZXI7XG4gICAgdGhpcy52aWV3RmFjdG9yeSA9IHZpZXdGYWN0b3J5O1xuICAgIHRoaXMuZmFjdG9yeUNyZWF0ZUluc3RydWN0aW9uID0geyBwYXJ0UmVwbGFjZW1lbnRzOiBwYXJ0UmVwbGFjZW1lbnRzIH07XG4gIH1cblxuICBCb3VuZFZpZXdGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIHZpZXcgPSB0aGlzLnZpZXdGYWN0b3J5LmNyZWF0ZSh0aGlzLnBhcmVudENvbnRhaW5lci5jcmVhdGVDaGlsZCgpLCB0aGlzLmZhY3RvcnlDcmVhdGVJbnN0cnVjdGlvbik7XG4gICAgdmlldy5faXNVc2VyQ29udHJvbGxlZCA9IHRydWU7XG4gICAgcmV0dXJuIHZpZXc7XG4gIH07XG5cbiAgQm91bmRWaWV3RmFjdG9yeS5wcm90b3R5cGUuc2V0Q2FjaGVTaXplID0gZnVuY3Rpb24gc2V0Q2FjaGVTaXplKHNpemUsIGRvTm90T3ZlcnJpZGVJZkFscmVhZHlTZXQpIHtcbiAgICB0aGlzLnZpZXdGYWN0b3J5LnNldENhY2hlU2l6ZShzaXplLCBkb05vdE92ZXJyaWRlSWZBbHJlYWR5U2V0KTtcbiAgfTtcblxuICBCb3VuZFZpZXdGYWN0b3J5LnByb3RvdHlwZS5nZXRDYWNoZWRWaWV3ID0gZnVuY3Rpb24gZ2V0Q2FjaGVkVmlldygpIHtcbiAgICByZXR1cm4gdGhpcy52aWV3RmFjdG9yeS5nZXRDYWNoZWRWaWV3KCk7XG4gIH07XG5cbiAgQm91bmRWaWV3RmFjdG9yeS5wcm90b3R5cGUucmV0dXJuVmlld1RvQ2FjaGUgPSBmdW5jdGlvbiByZXR1cm5WaWV3VG9DYWNoZSh2aWV3KSB7XG4gICAgdGhpcy52aWV3RmFjdG9yeS5yZXR1cm5WaWV3VG9DYWNoZSh2aWV3KTtcbiAgfTtcblxuICBfY3JlYXRlQ2xhc3MoQm91bmRWaWV3RmFjdG9yeSwgW3tcbiAgICBrZXk6ICdpc0NhY2hpbmcnLFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgcmV0dXJuIHRoaXMudmlld0ZhY3RvcnkuaXNDYWNoaW5nO1xuICAgIH1cbiAgfV0pO1xuXG4gIHJldHVybiBCb3VuZFZpZXdGYWN0b3J5O1xufSgpO1xuXG52YXIgVmlld0ZhY3RvcnkgPSBleHBvcnRzLlZpZXdGYWN0b3J5ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBWaWV3RmFjdG9yeSh0ZW1wbGF0ZSwgaW5zdHJ1Y3Rpb25zLCByZXNvdXJjZXMpIHtcbiAgICBcblxuICAgIHRoaXMuaXNDYWNoaW5nID0gZmFsc2U7XG5cbiAgICB0aGlzLnRlbXBsYXRlID0gdGVtcGxhdGU7XG4gICAgdGhpcy5pbnN0cnVjdGlvbnMgPSBpbnN0cnVjdGlvbnM7XG4gICAgdGhpcy5yZXNvdXJjZXMgPSByZXNvdXJjZXM7XG4gICAgdGhpcy5jYWNoZVNpemUgPSAtMTtcbiAgICB0aGlzLmNhY2hlID0gbnVsbDtcbiAgfVxuXG4gIFZpZXdGYWN0b3J5LnByb3RvdHlwZS5zZXRDYWNoZVNpemUgPSBmdW5jdGlvbiBzZXRDYWNoZVNpemUoc2l6ZSwgZG9Ob3RPdmVycmlkZUlmQWxyZWFkeVNldCkge1xuICAgIGlmIChzaXplKSB7XG4gICAgICBpZiAoc2l6ZSA9PT0gJyonKSB7XG4gICAgICAgIHNpemUgPSBOdW1iZXIuTUFYX1ZBTFVFO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygc2l6ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgc2l6ZSA9IHBhcnNlSW50KHNpemUsIDEwKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5jYWNoZVNpemUgPT09IC0xIHx8ICFkb05vdE92ZXJyaWRlSWZBbHJlYWR5U2V0KSB7XG4gICAgICB0aGlzLmNhY2hlU2l6ZSA9IHNpemU7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY2FjaGVTaXplID4gMCkge1xuICAgICAgdGhpcy5jYWNoZSA9IFtdO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNhY2hlID0gbnVsbDtcbiAgICB9XG5cbiAgICB0aGlzLmlzQ2FjaGluZyA9IHRoaXMuY2FjaGVTaXplID4gMDtcbiAgfTtcblxuICBWaWV3RmFjdG9yeS5wcm90b3R5cGUuZ2V0Q2FjaGVkVmlldyA9IGZ1bmN0aW9uIGdldENhY2hlZFZpZXcoKSB7XG4gICAgcmV0dXJuIHRoaXMuY2FjaGUgIT09IG51bGwgPyB0aGlzLmNhY2hlLnBvcCgpIHx8IG51bGwgOiBudWxsO1xuICB9O1xuXG4gIFZpZXdGYWN0b3J5LnByb3RvdHlwZS5yZXR1cm5WaWV3VG9DYWNoZSA9IGZ1bmN0aW9uIHJldHVyblZpZXdUb0NhY2hlKHZpZXcpIHtcbiAgICBpZiAodmlldy5pc0F0dGFjaGVkKSB7XG4gICAgICB2aWV3LmRldGFjaGVkKCk7XG4gICAgfVxuXG4gICAgaWYgKHZpZXcuaXNCb3VuZCkge1xuICAgICAgdmlldy51bmJpbmQoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5jYWNoZSAhPT0gbnVsbCAmJiB0aGlzLmNhY2hlLmxlbmd0aCA8IHRoaXMuY2FjaGVTaXplKSB7XG4gICAgICB2aWV3LmZyb21DYWNoZSA9IHRydWU7XG4gICAgICB0aGlzLmNhY2hlLnB1c2godmlldyk7XG4gICAgfVxuICB9O1xuXG4gIFZpZXdGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbiBjcmVhdGUoY29udGFpbmVyLCBjcmVhdGVJbnN0cnVjdGlvbiwgZWxlbWVudCkge1xuICAgIGNyZWF0ZUluc3RydWN0aW9uID0gY3JlYXRlSW5zdHJ1Y3Rpb24gfHwgQmVoYXZpb3JJbnN0cnVjdGlvbi5ub3JtYWw7XG5cbiAgICB2YXIgY2FjaGVkVmlldyA9IHRoaXMuZ2V0Q2FjaGVkVmlldygpO1xuICAgIGlmIChjYWNoZWRWaWV3ICE9PSBudWxsKSB7XG4gICAgICByZXR1cm4gY2FjaGVkVmlldztcbiAgICB9XG5cbiAgICB2YXIgZnJhZ21lbnQgPSBjcmVhdGVJbnN0cnVjdGlvbi5lbmhhbmNlID8gdGhpcy50ZW1wbGF0ZSA6IHRoaXMudGVtcGxhdGUuY2xvbmVOb2RlKHRydWUpO1xuICAgIHZhciBpbnN0cnVjdGFibGVzID0gZnJhZ21lbnQucXVlcnlTZWxlY3RvckFsbCgnLmF1LXRhcmdldCcpO1xuICAgIHZhciBpbnN0cnVjdGlvbnMgPSB0aGlzLmluc3RydWN0aW9ucztcbiAgICB2YXIgcmVzb3VyY2VzID0gdGhpcy5yZXNvdXJjZXM7XG4gICAgdmFyIGNvbnRyb2xsZXJzID0gW107XG4gICAgdmFyIGJpbmRpbmdzID0gW107XG4gICAgdmFyIGNoaWxkcmVuID0gW107XG4gICAgdmFyIHNoYWRvd1Nsb3RzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICB2YXIgY29udGFpbmVycyA9IHsgcm9vdDogY29udGFpbmVyIH07XG4gICAgdmFyIHBhcnRSZXBsYWNlbWVudHMgPSBjcmVhdGVJbnN0cnVjdGlvbi5wYXJ0UmVwbGFjZW1lbnRzO1xuICAgIHZhciBpID0gdm9pZCAwO1xuICAgIHZhciBpaSA9IHZvaWQgMDtcbiAgICB2YXIgdmlldyA9IHZvaWQgMDtcbiAgICB2YXIgaW5zdHJ1Y3RhYmxlID0gdm9pZCAwO1xuICAgIHZhciBpbnN0cnVjdGlvbiA9IHZvaWQgMDtcblxuICAgIHRoaXMucmVzb3VyY2VzLl9pbnZva2VIb29rKCdiZWZvcmVDcmVhdGUnLCB0aGlzLCBjb250YWluZXIsIGZyYWdtZW50LCBjcmVhdGVJbnN0cnVjdGlvbik7XG5cbiAgICBpZiAoZWxlbWVudCAmJiB0aGlzLnN1cnJvZ2F0ZUluc3RydWN0aW9uICE9PSBudWxsKSB7XG4gICAgICBhcHBseVN1cnJvZ2F0ZUluc3RydWN0aW9uKGNvbnRhaW5lciwgZWxlbWVudCwgdGhpcy5zdXJyb2dhdGVJbnN0cnVjdGlvbiwgY29udHJvbGxlcnMsIGJpbmRpbmdzLCBjaGlsZHJlbik7XG4gICAgfVxuXG4gICAgaWYgKGNyZWF0ZUluc3RydWN0aW9uLmVuaGFuY2UgJiYgZnJhZ21lbnQuaGFzQXR0cmlidXRlKCdhdS10YXJnZXQtaWQnKSkge1xuICAgICAgaW5zdHJ1Y3RhYmxlID0gZnJhZ21lbnQ7XG4gICAgICBpbnN0cnVjdGlvbiA9IGluc3RydWN0aW9uc1tpbnN0cnVjdGFibGUuZ2V0QXR0cmlidXRlKCdhdS10YXJnZXQtaWQnKV07XG4gICAgICBhcHBseUluc3RydWN0aW9ucyhjb250YWluZXJzLCBpbnN0cnVjdGFibGUsIGluc3RydWN0aW9uLCBjb250cm9sbGVycywgYmluZGluZ3MsIGNoaWxkcmVuLCBzaGFkb3dTbG90cywgcGFydFJlcGxhY2VtZW50cywgcmVzb3VyY2VzKTtcbiAgICB9XG5cbiAgICBmb3IgKGkgPSAwLCBpaSA9IGluc3RydWN0YWJsZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgaW5zdHJ1Y3RhYmxlID0gaW5zdHJ1Y3RhYmxlc1tpXTtcbiAgICAgIGluc3RydWN0aW9uID0gaW5zdHJ1Y3Rpb25zW2luc3RydWN0YWJsZS5nZXRBdHRyaWJ1dGUoJ2F1LXRhcmdldC1pZCcpXTtcbiAgICAgIGFwcGx5SW5zdHJ1Y3Rpb25zKGNvbnRhaW5lcnMsIGluc3RydWN0YWJsZSwgaW5zdHJ1Y3Rpb24sIGNvbnRyb2xsZXJzLCBiaW5kaW5ncywgY2hpbGRyZW4sIHNoYWRvd1Nsb3RzLCBwYXJ0UmVwbGFjZW1lbnRzLCByZXNvdXJjZXMpO1xuICAgIH1cblxuICAgIHZpZXcgPSBuZXcgVmlldyhjb250YWluZXIsIHRoaXMsIGZyYWdtZW50LCBjb250cm9sbGVycywgYmluZGluZ3MsIGNoaWxkcmVuLCBzaGFkb3dTbG90cyk7XG5cbiAgICBpZiAoIWNyZWF0ZUluc3RydWN0aW9uLmluaXRpYXRlZEJ5QmVoYXZpb3IpIHtcbiAgICAgIHZpZXcuY3JlYXRlZCgpO1xuICAgIH1cblxuICAgIHRoaXMucmVzb3VyY2VzLl9pbnZva2VIb29rKCdhZnRlckNyZWF0ZScsIHZpZXcpO1xuXG4gICAgcmV0dXJuIHZpZXc7XG4gIH07XG5cbiAgcmV0dXJuIFZpZXdGYWN0b3J5O1xufSgpO1xuXG52YXIgbmV4dEluamVjdG9ySWQgPSAwO1xuZnVuY3Rpb24gZ2V0TmV4dEluamVjdG9ySWQoKSB7XG4gIHJldHVybiArK25leHRJbmplY3RvcklkO1xufVxuXG5mdW5jdGlvbiBjb25maWd1cmVQcm9wZXJ0aWVzKGluc3RydWN0aW9uLCByZXNvdXJjZXMpIHtcbiAgdmFyIHR5cGUgPSBpbnN0cnVjdGlvbi50eXBlO1xuICB2YXIgYXR0ck5hbWUgPSBpbnN0cnVjdGlvbi5hdHRyTmFtZTtcbiAgdmFyIGF0dHJpYnV0ZXMgPSBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzO1xuICB2YXIgcHJvcGVydHkgPSB2b2lkIDA7XG4gIHZhciBrZXkgPSB2b2lkIDA7XG4gIHZhciB2YWx1ZSA9IHZvaWQgMDtcblxuICB2YXIga25vd25BdHRyaWJ1dGUgPSByZXNvdXJjZXMubWFwQXR0cmlidXRlKGF0dHJOYW1lKTtcbiAgaWYgKGtub3duQXR0cmlidXRlICYmIGF0dHJOYW1lIGluIGF0dHJpYnV0ZXMgJiYga25vd25BdHRyaWJ1dGUgIT09IGF0dHJOYW1lKSB7XG4gICAgYXR0cmlidXRlc1trbm93bkF0dHJpYnV0ZV0gPSBhdHRyaWJ1dGVzW2F0dHJOYW1lXTtcbiAgICBkZWxldGUgYXR0cmlidXRlc1thdHRyTmFtZV07XG4gIH1cblxuICBmb3IgKGtleSBpbiBhdHRyaWJ1dGVzKSB7XG4gICAgdmFsdWUgPSBhdHRyaWJ1dGVzW2tleV07XG5cbiAgICBpZiAodmFsdWUgIT09IG51bGwgJiYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YodmFsdWUpKSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIHByb3BlcnR5ID0gdHlwZS5hdHRyaWJ1dGVzW2tleV07XG5cbiAgICAgIGlmIChwcm9wZXJ0eSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHZhbHVlLnRhcmdldFByb3BlcnR5ID0gcHJvcGVydHkubmFtZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhbHVlLnRhcmdldFByb3BlcnR5ID0ga2V5O1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG52YXIgbGFzdEFVVGFyZ2V0SUQgPSAwO1xuZnVuY3Rpb24gZ2V0TmV4dEFVVGFyZ2V0SUQoKSB7XG4gIHJldHVybiAoKytsYXN0QVVUYXJnZXRJRCkudG9TdHJpbmcoKTtcbn1cblxuZnVuY3Rpb24gbWFrZUludG9JbnN0cnVjdGlvblRhcmdldChlbGVtZW50KSB7XG4gIHZhciB2YWx1ZSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdjbGFzcycpO1xuICB2YXIgYXVUYXJnZXRJRCA9IGdldE5leHRBVVRhcmdldElEKCk7XG5cbiAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgdmFsdWUgPyB2YWx1ZSArPSAnIGF1LXRhcmdldCcgOiAnYXUtdGFyZ2V0Jyk7XG4gIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdhdS10YXJnZXQtaWQnLCBhdVRhcmdldElEKTtcblxuICByZXR1cm4gYXVUYXJnZXRJRDtcbn1cblxuZnVuY3Rpb24gbWFrZVNoYWRvd1Nsb3QoY29tcGlsZXIsIHJlc291cmNlcywgbm9kZSwgaW5zdHJ1Y3Rpb25zLCBwYXJlbnRJbmplY3RvcklkKSB7XG4gIHZhciBhdVNoYWRvd1Nsb3QgPSBfYXVyZWxpYVBhbC5ET00uY3JlYXRlRWxlbWVudCgnYXUtc2hhZG93LXNsb3QnKTtcbiAgX2F1cmVsaWFQYWwuRE9NLnJlcGxhY2VOb2RlKGF1U2hhZG93U2xvdCwgbm9kZSk7XG5cbiAgdmFyIGF1VGFyZ2V0SUQgPSBtYWtlSW50b0luc3RydWN0aW9uVGFyZ2V0KGF1U2hhZG93U2xvdCk7XG4gIHZhciBpbnN0cnVjdGlvbiA9IFRhcmdldEluc3RydWN0aW9uLnNoYWRvd1Nsb3QocGFyZW50SW5qZWN0b3JJZCk7XG5cbiAgaW5zdHJ1Y3Rpb24uc2xvdE5hbWUgPSBub2RlLmdldEF0dHJpYnV0ZSgnbmFtZScpIHx8IFNoYWRvd0RPTS5kZWZhdWx0U2xvdEtleTtcbiAgaW5zdHJ1Y3Rpb24uc2xvdERlc3RpbmF0aW9uID0gbm9kZS5nZXRBdHRyaWJ1dGUoJ3Nsb3QnKTtcblxuICBpZiAobm9kZS5pbm5lckhUTUwudHJpbSgpKSB7XG4gICAgdmFyIGZyYWdtZW50ID0gX2F1cmVsaWFQYWwuRE9NLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICB2YXIgX2NoaWxkMyA9IHZvaWQgMDtcblxuICAgIHdoaWxlIChfY2hpbGQzID0gbm9kZS5maXJzdENoaWxkKSB7XG4gICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChfY2hpbGQzKTtcbiAgICB9XG5cbiAgICBpbnN0cnVjdGlvbi5zbG90RmFsbGJhY2tGYWN0b3J5ID0gY29tcGlsZXIuY29tcGlsZShmcmFnbWVudCwgcmVzb3VyY2VzKTtcbiAgfVxuXG4gIGluc3RydWN0aW9uc1thdVRhcmdldElEXSA9IGluc3RydWN0aW9uO1xuXG4gIHJldHVybiBhdVNoYWRvd1Nsb3Q7XG59XG5cbnZhciBWaWV3Q29tcGlsZXIgPSBleHBvcnRzLlZpZXdDb21waWxlciA9IChfZGVjNyA9ICgwLCBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24uaW5qZWN0KShCaW5kaW5nTGFuZ3VhZ2UsIFZpZXdSZXNvdXJjZXMpLCBfZGVjNyhfY2xhc3MxNyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gVmlld0NvbXBpbGVyKGJpbmRpbmdMYW5ndWFnZSwgcmVzb3VyY2VzKSB7XG4gICAgXG5cbiAgICB0aGlzLmJpbmRpbmdMYW5ndWFnZSA9IGJpbmRpbmdMYW5ndWFnZTtcbiAgICB0aGlzLnJlc291cmNlcyA9IHJlc291cmNlcztcbiAgfVxuXG4gIFZpZXdDb21waWxlci5wcm90b3R5cGUuY29tcGlsZSA9IGZ1bmN0aW9uIGNvbXBpbGUoc291cmNlLCByZXNvdXJjZXMsIGNvbXBpbGVJbnN0cnVjdGlvbikge1xuICAgIHJlc291cmNlcyA9IHJlc291cmNlcyB8fCB0aGlzLnJlc291cmNlcztcbiAgICBjb21waWxlSW5zdHJ1Y3Rpb24gPSBjb21waWxlSW5zdHJ1Y3Rpb24gfHwgVmlld0NvbXBpbGVJbnN0cnVjdGlvbi5ub3JtYWw7XG4gICAgc291cmNlID0gdHlwZW9mIHNvdXJjZSA9PT0gJ3N0cmluZycgPyBfYXVyZWxpYVBhbC5ET00uY3JlYXRlVGVtcGxhdGVGcm9tTWFya3VwKHNvdXJjZSkgOiBzb3VyY2U7XG5cbiAgICB2YXIgY29udGVudCA9IHZvaWQgMDtcbiAgICB2YXIgcGFydCA9IHZvaWQgMDtcbiAgICB2YXIgY2FjaGVTaXplID0gdm9pZCAwO1xuXG4gICAgaWYgKHNvdXJjZS5jb250ZW50KSB7XG4gICAgICBwYXJ0ID0gc291cmNlLmdldEF0dHJpYnV0ZSgncGFydCcpO1xuICAgICAgY2FjaGVTaXplID0gc291cmNlLmdldEF0dHJpYnV0ZSgndmlldy1jYWNoZScpO1xuICAgICAgY29udGVudCA9IF9hdXJlbGlhUGFsLkRPTS5hZG9wdE5vZGUoc291cmNlLmNvbnRlbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb250ZW50ID0gc291cmNlO1xuICAgIH1cblxuICAgIGNvbXBpbGVJbnN0cnVjdGlvbi50YXJnZXRTaGFkb3dET00gPSBjb21waWxlSW5zdHJ1Y3Rpb24udGFyZ2V0U2hhZG93RE9NICYmIF9hdXJlbGlhUGFsLkZFQVRVUkUuc2hhZG93RE9NO1xuICAgIHJlc291cmNlcy5faW52b2tlSG9vaygnYmVmb3JlQ29tcGlsZScsIGNvbnRlbnQsIHJlc291cmNlcywgY29tcGlsZUluc3RydWN0aW9uKTtcblxuICAgIHZhciBpbnN0cnVjdGlvbnMgPSB7fTtcbiAgICB0aGlzLl9jb21waWxlTm9kZShjb250ZW50LCByZXNvdXJjZXMsIGluc3RydWN0aW9ucywgc291cmNlLCAncm9vdCcsICFjb21waWxlSW5zdHJ1Y3Rpb24udGFyZ2V0U2hhZG93RE9NKTtcblxuICAgIHZhciBmaXJzdENoaWxkID0gY29udGVudC5maXJzdENoaWxkO1xuICAgIGlmIChmaXJzdENoaWxkICYmIGZpcnN0Q2hpbGQubm9kZVR5cGUgPT09IDEpIHtcbiAgICAgIHZhciB0YXJnZXRJZCA9IGZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCdhdS10YXJnZXQtaWQnKTtcbiAgICAgIGlmICh0YXJnZXRJZCkge1xuICAgICAgICB2YXIgaW5zID0gaW5zdHJ1Y3Rpb25zW3RhcmdldElkXTtcblxuICAgICAgICBpZiAoaW5zLnNoYWRvd1Nsb3QgfHwgaW5zLmxpZnRpbmcpIHtcbiAgICAgICAgICBjb250ZW50Lmluc2VydEJlZm9yZShfYXVyZWxpYVBhbC5ET00uY3JlYXRlQ29tbWVudCgndmlldycpLCBmaXJzdENoaWxkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBmYWN0b3J5ID0gbmV3IFZpZXdGYWN0b3J5KGNvbnRlbnQsIGluc3RydWN0aW9ucywgcmVzb3VyY2VzKTtcblxuICAgIGZhY3Rvcnkuc3Vycm9nYXRlSW5zdHJ1Y3Rpb24gPSBjb21waWxlSW5zdHJ1Y3Rpb24uY29tcGlsZVN1cnJvZ2F0ZSA/IHRoaXMuX2NvbXBpbGVTdXJyb2dhdGUoc291cmNlLCByZXNvdXJjZXMpIDogbnVsbDtcbiAgICBmYWN0b3J5LnBhcnQgPSBwYXJ0O1xuXG4gICAgaWYgKGNhY2hlU2l6ZSkge1xuICAgICAgZmFjdG9yeS5zZXRDYWNoZVNpemUoY2FjaGVTaXplKTtcbiAgICB9XG5cbiAgICByZXNvdXJjZXMuX2ludm9rZUhvb2soJ2FmdGVyQ29tcGlsZScsIGZhY3RvcnkpO1xuXG4gICAgcmV0dXJuIGZhY3Rvcnk7XG4gIH07XG5cbiAgVmlld0NvbXBpbGVyLnByb3RvdHlwZS5fY29tcGlsZU5vZGUgPSBmdW5jdGlvbiBfY29tcGlsZU5vZGUobm9kZSwgcmVzb3VyY2VzLCBpbnN0cnVjdGlvbnMsIHBhcmVudE5vZGUsIHBhcmVudEluamVjdG9ySWQsIHRhcmdldExpZ2h0RE9NKSB7XG4gICAgc3dpdGNoIChub2RlLm5vZGVUeXBlKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHJldHVybiB0aGlzLl9jb21waWxlRWxlbWVudChub2RlLCByZXNvdXJjZXMsIGluc3RydWN0aW9ucywgcGFyZW50Tm9kZSwgcGFyZW50SW5qZWN0b3JJZCwgdGFyZ2V0TGlnaHRET00pO1xuICAgICAgY2FzZSAzOlxuICAgICAgICB2YXIgZXhwcmVzc2lvbiA9IHJlc291cmNlcy5nZXRCaW5kaW5nTGFuZ3VhZ2UodGhpcy5iaW5kaW5nTGFuZ3VhZ2UpLmluc3BlY3RUZXh0Q29udGVudChyZXNvdXJjZXMsIG5vZGUud2hvbGVUZXh0KTtcbiAgICAgICAgaWYgKGV4cHJlc3Npb24pIHtcbiAgICAgICAgICB2YXIgbWFya2VyID0gX2F1cmVsaWFQYWwuRE9NLmNyZWF0ZUVsZW1lbnQoJ2F1LW1hcmtlcicpO1xuICAgICAgICAgIHZhciBhdVRhcmdldElEID0gbWFrZUludG9JbnN0cnVjdGlvblRhcmdldChtYXJrZXIpO1xuICAgICAgICAgIChub2RlLnBhcmVudE5vZGUgfHwgcGFyZW50Tm9kZSkuaW5zZXJ0QmVmb3JlKG1hcmtlciwgbm9kZSk7XG4gICAgICAgICAgbm9kZS50ZXh0Q29udGVudCA9ICcgJztcbiAgICAgICAgICBpbnN0cnVjdGlvbnNbYXVUYXJnZXRJRF0gPSBUYXJnZXRJbnN0cnVjdGlvbi5jb250ZW50RXhwcmVzc2lvbihleHByZXNzaW9uKTtcblxuICAgICAgICAgIHdoaWxlIChub2RlLm5leHRTaWJsaW5nICYmIG5vZGUubmV4dFNpYmxpbmcubm9kZVR5cGUgPT09IDMpIHtcbiAgICAgICAgICAgIChub2RlLnBhcmVudE5vZGUgfHwgcGFyZW50Tm9kZSkucmVtb3ZlQ2hpbGQobm9kZS5uZXh0U2libGluZyk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHdoaWxlIChub2RlLm5leHRTaWJsaW5nICYmIG5vZGUubmV4dFNpYmxpbmcubm9kZVR5cGUgPT09IDMpIHtcbiAgICAgICAgICAgIG5vZGUgPSBub2RlLm5leHRTaWJsaW5nO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbm9kZS5uZXh0U2libGluZztcbiAgICAgIGNhc2UgMTE6XG4gICAgICAgIHZhciBjdXJyZW50Q2hpbGQgPSBub2RlLmZpcnN0Q2hpbGQ7XG4gICAgICAgIHdoaWxlIChjdXJyZW50Q2hpbGQpIHtcbiAgICAgICAgICBjdXJyZW50Q2hpbGQgPSB0aGlzLl9jb21waWxlTm9kZShjdXJyZW50Q2hpbGQsIHJlc291cmNlcywgaW5zdHJ1Y3Rpb25zLCBub2RlLCBwYXJlbnRJbmplY3RvcklkLCB0YXJnZXRMaWdodERPTSk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICByZXR1cm4gbm9kZS5uZXh0U2libGluZztcbiAgfTtcblxuICBWaWV3Q29tcGlsZXIucHJvdG90eXBlLl9jb21waWxlU3Vycm9nYXRlID0gZnVuY3Rpb24gX2NvbXBpbGVTdXJyb2dhdGUobm9kZSwgcmVzb3VyY2VzKSB7XG4gICAgdmFyIHRhZ05hbWUgPSBub2RlLnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgICB2YXIgYXR0cmlidXRlcyA9IG5vZGUuYXR0cmlidXRlcztcbiAgICB2YXIgYmluZGluZ0xhbmd1YWdlID0gcmVzb3VyY2VzLmdldEJpbmRpbmdMYW5ndWFnZSh0aGlzLmJpbmRpbmdMYW5ndWFnZSk7XG4gICAgdmFyIGtub3duQXR0cmlidXRlID0gdm9pZCAwO1xuICAgIHZhciBwcm9wZXJ0eSA9IHZvaWQgMDtcbiAgICB2YXIgaW5zdHJ1Y3Rpb24gPSB2b2lkIDA7XG4gICAgdmFyIGkgPSB2b2lkIDA7XG4gICAgdmFyIGlpID0gdm9pZCAwO1xuICAgIHZhciBhdHRyID0gdm9pZCAwO1xuICAgIHZhciBhdHRyTmFtZSA9IHZvaWQgMDtcbiAgICB2YXIgYXR0clZhbHVlID0gdm9pZCAwO1xuICAgIHZhciBpbmZvID0gdm9pZCAwO1xuICAgIHZhciB0eXBlID0gdm9pZCAwO1xuICAgIHZhciBleHByZXNzaW9ucyA9IFtdO1xuICAgIHZhciBleHByZXNzaW9uID0gdm9pZCAwO1xuICAgIHZhciBiZWhhdmlvckluc3RydWN0aW9ucyA9IFtdO1xuICAgIHZhciB2YWx1ZXMgPSB7fTtcbiAgICB2YXIgaGFzVmFsdWVzID0gZmFsc2U7XG4gICAgdmFyIHByb3ZpZGVycyA9IFtdO1xuXG4gICAgZm9yIChpID0gMCwgaWkgPSBhdHRyaWJ1dGVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgIGF0dHIgPSBhdHRyaWJ1dGVzW2ldO1xuICAgICAgYXR0ck5hbWUgPSBhdHRyLm5hbWU7XG4gICAgICBhdHRyVmFsdWUgPSBhdHRyLnZhbHVlO1xuXG4gICAgICBpbmZvID0gYmluZGluZ0xhbmd1YWdlLmluc3BlY3RBdHRyaWJ1dGUocmVzb3VyY2VzLCB0YWdOYW1lLCBhdHRyTmFtZSwgYXR0clZhbHVlKTtcbiAgICAgIHR5cGUgPSByZXNvdXJjZXMuZ2V0QXR0cmlidXRlKGluZm8uYXR0ck5hbWUpO1xuXG4gICAgICBpZiAodHlwZSkge1xuICAgICAgICBrbm93bkF0dHJpYnV0ZSA9IHJlc291cmNlcy5tYXBBdHRyaWJ1dGUoaW5mby5hdHRyTmFtZSk7XG4gICAgICAgIGlmIChrbm93bkF0dHJpYnV0ZSkge1xuICAgICAgICAgIHByb3BlcnR5ID0gdHlwZS5hdHRyaWJ1dGVzW2tub3duQXR0cmlidXRlXTtcblxuICAgICAgICAgIGlmIChwcm9wZXJ0eSkge1xuICAgICAgICAgICAgaW5mby5kZWZhdWx0QmluZGluZ01vZGUgPSBwcm9wZXJ0eS5kZWZhdWx0QmluZGluZ01vZGU7XG5cbiAgICAgICAgICAgIGlmICghaW5mby5jb21tYW5kICYmICFpbmZvLmV4cHJlc3Npb24pIHtcbiAgICAgICAgICAgICAgaW5mby5jb21tYW5kID0gcHJvcGVydHkuaGFzT3B0aW9ucyA/ICdvcHRpb25zJyA6IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGluc3RydWN0aW9uID0gYmluZGluZ0xhbmd1YWdlLmNyZWF0ZUF0dHJpYnV0ZUluc3RydWN0aW9uKHJlc291cmNlcywgbm9kZSwgaW5mbywgdW5kZWZpbmVkLCB0eXBlKTtcblxuICAgICAgaWYgKGluc3RydWN0aW9uKSB7XG4gICAgICAgIGlmIChpbnN0cnVjdGlvbi5hbHRlcmVkQXR0cikge1xuICAgICAgICAgIHR5cGUgPSByZXNvdXJjZXMuZ2V0QXR0cmlidXRlKGluc3RydWN0aW9uLmF0dHJOYW1lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpbnN0cnVjdGlvbi5kaXNjcmV0ZSkge1xuICAgICAgICAgIGV4cHJlc3Npb25zLnB1c2goaW5zdHJ1Y3Rpb24pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmICh0eXBlKSB7XG4gICAgICAgICAgICBpbnN0cnVjdGlvbi50eXBlID0gdHlwZTtcbiAgICAgICAgICAgIGNvbmZpZ3VyZVByb3BlcnRpZXMoaW5zdHJ1Y3Rpb24sIHJlc291cmNlcyk7XG5cbiAgICAgICAgICAgIGlmICh0eXBlLmxpZnRzQ29udGVudCkge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1lvdSBjYW5ub3QgcGxhY2UgYSB0ZW1wbGF0ZSBjb250cm9sbGVyIG9uIGEgc3Vycm9nYXRlIGVsZW1lbnQuJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBiZWhhdmlvckluc3RydWN0aW9ucy5wdXNoKGluc3RydWN0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZXhwcmVzc2lvbnMucHVzaChpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW2luc3RydWN0aW9uLmF0dHJOYW1lXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodHlwZSkge1xuICAgICAgICAgIGluc3RydWN0aW9uID0gQmVoYXZpb3JJbnN0cnVjdGlvbi5hdHRyaWJ1dGUoYXR0ck5hbWUsIHR5cGUpO1xuICAgICAgICAgIGluc3RydWN0aW9uLmF0dHJpYnV0ZXNbcmVzb3VyY2VzLm1hcEF0dHJpYnV0ZShhdHRyTmFtZSldID0gYXR0clZhbHVlO1xuXG4gICAgICAgICAgaWYgKHR5cGUubGlmdHNDb250ZW50KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1lvdSBjYW5ub3QgcGxhY2UgYSB0ZW1wbGF0ZSBjb250cm9sbGVyIG9uIGEgc3Vycm9nYXRlIGVsZW1lbnQuJyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLnB1c2goaW5zdHJ1Y3Rpb24pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChhdHRyTmFtZSAhPT0gJ2lkJyAmJiBhdHRyTmFtZSAhPT0gJ3BhcnQnICYmIGF0dHJOYW1lICE9PSAncmVwbGFjZS1wYXJ0Jykge1xuICAgICAgICAgIGhhc1ZhbHVlcyA9IHRydWU7XG4gICAgICAgICAgdmFsdWVzW2F0dHJOYW1lXSA9IGF0dHJWYWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChleHByZXNzaW9ucy5sZW5ndGggfHwgYmVoYXZpb3JJbnN0cnVjdGlvbnMubGVuZ3RoIHx8IGhhc1ZhbHVlcykge1xuICAgICAgZm9yIChpID0gMCwgaWkgPSBiZWhhdmlvckluc3RydWN0aW9ucy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgIGluc3RydWN0aW9uID0gYmVoYXZpb3JJbnN0cnVjdGlvbnNbaV07XG4gICAgICAgIGluc3RydWN0aW9uLnR5cGUuY29tcGlsZSh0aGlzLCByZXNvdXJjZXMsIG5vZGUsIGluc3RydWN0aW9uKTtcbiAgICAgICAgcHJvdmlkZXJzLnB1c2goaW5zdHJ1Y3Rpb24udHlwZS50YXJnZXQpO1xuICAgICAgfVxuXG4gICAgICBmb3IgKGkgPSAwLCBpaSA9IGV4cHJlc3Npb25zLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb25zW2ldO1xuICAgICAgICBpZiAoZXhwcmVzc2lvbi5hdHRyVG9SZW1vdmUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIG5vZGUucmVtb3ZlQXR0cmlidXRlKGV4cHJlc3Npb24uYXR0clRvUmVtb3ZlKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gVGFyZ2V0SW5zdHJ1Y3Rpb24uc3Vycm9nYXRlKHByb3ZpZGVycywgYmVoYXZpb3JJbnN0cnVjdGlvbnMsIGV4cHJlc3Npb25zLCB2YWx1ZXMpO1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9O1xuXG4gIFZpZXdDb21waWxlci5wcm90b3R5cGUuX2NvbXBpbGVFbGVtZW50ID0gZnVuY3Rpb24gX2NvbXBpbGVFbGVtZW50KG5vZGUsIHJlc291cmNlcywgaW5zdHJ1Y3Rpb25zLCBwYXJlbnROb2RlLCBwYXJlbnRJbmplY3RvcklkLCB0YXJnZXRMaWdodERPTSkge1xuICAgIHZhciB0YWdOYW1lID0gbm9kZS50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgdmFyIGF0dHJpYnV0ZXMgPSBub2RlLmF0dHJpYnV0ZXM7XG4gICAgdmFyIGV4cHJlc3Npb25zID0gW107XG4gICAgdmFyIGV4cHJlc3Npb24gPSB2b2lkIDA7XG4gICAgdmFyIGJlaGF2aW9ySW5zdHJ1Y3Rpb25zID0gW107XG4gICAgdmFyIHByb3ZpZGVycyA9IFtdO1xuICAgIHZhciBiaW5kaW5nTGFuZ3VhZ2UgPSByZXNvdXJjZXMuZ2V0QmluZGluZ0xhbmd1YWdlKHRoaXMuYmluZGluZ0xhbmd1YWdlKTtcbiAgICB2YXIgbGlmdGluZ0luc3RydWN0aW9uID0gdm9pZCAwO1xuICAgIHZhciB2aWV3RmFjdG9yeSA9IHZvaWQgMDtcbiAgICB2YXIgdHlwZSA9IHZvaWQgMDtcbiAgICB2YXIgZWxlbWVudEluc3RydWN0aW9uID0gdm9pZCAwO1xuICAgIHZhciBlbGVtZW50UHJvcGVydHkgPSB2b2lkIDA7XG4gICAgdmFyIGkgPSB2b2lkIDA7XG4gICAgdmFyIGlpID0gdm9pZCAwO1xuICAgIHZhciBhdHRyID0gdm9pZCAwO1xuICAgIHZhciBhdHRyTmFtZSA9IHZvaWQgMDtcbiAgICB2YXIgYXR0clZhbHVlID0gdm9pZCAwO1xuICAgIHZhciBpbnN0cnVjdGlvbiA9IHZvaWQgMDtcbiAgICB2YXIgaW5mbyA9IHZvaWQgMDtcbiAgICB2YXIgcHJvcGVydHkgPSB2b2lkIDA7XG4gICAgdmFyIGtub3duQXR0cmlidXRlID0gdm9pZCAwO1xuICAgIHZhciBhdVRhcmdldElEID0gdm9pZCAwO1xuICAgIHZhciBpbmplY3RvcklkID0gdm9pZCAwO1xuXG4gICAgaWYgKHRhZ05hbWUgPT09ICdzbG90Jykge1xuICAgICAgaWYgKHRhcmdldExpZ2h0RE9NKSB7XG4gICAgICAgIG5vZGUgPSBtYWtlU2hhZG93U2xvdCh0aGlzLCByZXNvdXJjZXMsIG5vZGUsIGluc3RydWN0aW9ucywgcGFyZW50SW5qZWN0b3JJZCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbm9kZS5uZXh0U2libGluZztcbiAgICB9IGVsc2UgaWYgKHRhZ05hbWUgPT09ICd0ZW1wbGF0ZScpIHtcbiAgICAgIHZpZXdGYWN0b3J5ID0gdGhpcy5jb21waWxlKG5vZGUsIHJlc291cmNlcyk7XG4gICAgICB2aWV3RmFjdG9yeS5wYXJ0ID0gbm9kZS5nZXRBdHRyaWJ1dGUoJ3BhcnQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdHlwZSA9IHJlc291cmNlcy5nZXRFbGVtZW50KG5vZGUuZ2V0QXR0cmlidXRlKCdhcy1lbGVtZW50JykgfHwgdGFnTmFtZSk7XG4gICAgICBpZiAodHlwZSkge1xuICAgICAgICBlbGVtZW50SW5zdHJ1Y3Rpb24gPSBCZWhhdmlvckluc3RydWN0aW9uLmVsZW1lbnQobm9kZSwgdHlwZSk7XG4gICAgICAgIHR5cGUucHJvY2Vzc0F0dHJpYnV0ZXModGhpcywgcmVzb3VyY2VzLCBub2RlLCBhdHRyaWJ1dGVzLCBlbGVtZW50SW5zdHJ1Y3Rpb24pO1xuICAgICAgICBiZWhhdmlvckluc3RydWN0aW9ucy5wdXNoKGVsZW1lbnRJbnN0cnVjdGlvbik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZm9yIChpID0gMCwgaWkgPSBhdHRyaWJ1dGVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgIGF0dHIgPSBhdHRyaWJ1dGVzW2ldO1xuICAgICAgYXR0ck5hbWUgPSBhdHRyLm5hbWU7XG4gICAgICBhdHRyVmFsdWUgPSBhdHRyLnZhbHVlO1xuICAgICAgaW5mbyA9IGJpbmRpbmdMYW5ndWFnZS5pbnNwZWN0QXR0cmlidXRlKHJlc291cmNlcywgdGFnTmFtZSwgYXR0ck5hbWUsIGF0dHJWYWx1ZSk7XG5cbiAgICAgIGlmICh0YXJnZXRMaWdodERPTSAmJiBpbmZvLmF0dHJOYW1lID09PSAnc2xvdCcpIHtcbiAgICAgICAgaW5mby5hdHRyTmFtZSA9IGF0dHJOYW1lID0gJ2F1LXNsb3QnO1xuICAgICAgfVxuXG4gICAgICB0eXBlID0gcmVzb3VyY2VzLmdldEF0dHJpYnV0ZShpbmZvLmF0dHJOYW1lKTtcbiAgICAgIGVsZW1lbnRQcm9wZXJ0eSA9IG51bGw7XG5cbiAgICAgIGlmICh0eXBlKSB7XG4gICAgICAgIGtub3duQXR0cmlidXRlID0gcmVzb3VyY2VzLm1hcEF0dHJpYnV0ZShpbmZvLmF0dHJOYW1lKTtcbiAgICAgICAgaWYgKGtub3duQXR0cmlidXRlKSB7XG4gICAgICAgICAgcHJvcGVydHkgPSB0eXBlLmF0dHJpYnV0ZXNba25vd25BdHRyaWJ1dGVdO1xuXG4gICAgICAgICAgaWYgKHByb3BlcnR5KSB7XG4gICAgICAgICAgICBpbmZvLmRlZmF1bHRCaW5kaW5nTW9kZSA9IHByb3BlcnR5LmRlZmF1bHRCaW5kaW5nTW9kZTtcblxuICAgICAgICAgICAgaWYgKCFpbmZvLmNvbW1hbmQgJiYgIWluZm8uZXhwcmVzc2lvbikge1xuICAgICAgICAgICAgICBpbmZvLmNvbW1hbmQgPSBwcm9wZXJ0eS5oYXNPcHRpb25zID8gJ29wdGlvbnMnIDogbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoZWxlbWVudEluc3RydWN0aW9uKSB7XG4gICAgICAgICAgZWxlbWVudFByb3BlcnR5ID0gZWxlbWVudEluc3RydWN0aW9uLnR5cGUuYXR0cmlidXRlc1tpbmZvLmF0dHJOYW1lXTtcbiAgICAgICAgICBpZiAoZWxlbWVudFByb3BlcnR5KSB7XG4gICAgICAgICAgICBpbmZvLmRlZmF1bHRCaW5kaW5nTW9kZSA9IGVsZW1lbnRQcm9wZXJ0eS5kZWZhdWx0QmluZGluZ01vZGU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgIGlmIChlbGVtZW50UHJvcGVydHkpIHtcbiAgICAgICAgaW5zdHJ1Y3Rpb24gPSBiaW5kaW5nTGFuZ3VhZ2UuY3JlYXRlQXR0cmlidXRlSW5zdHJ1Y3Rpb24ocmVzb3VyY2VzLCBub2RlLCBpbmZvLCBlbGVtZW50SW5zdHJ1Y3Rpb24pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaW5zdHJ1Y3Rpb24gPSBiaW5kaW5nTGFuZ3VhZ2UuY3JlYXRlQXR0cmlidXRlSW5zdHJ1Y3Rpb24ocmVzb3VyY2VzLCBub2RlLCBpbmZvLCB1bmRlZmluZWQsIHR5cGUpO1xuICAgICAgfVxuXG4gICAgICBpZiAoaW5zdHJ1Y3Rpb24pIHtcbiAgICAgICAgaWYgKGluc3RydWN0aW9uLmFsdGVyZWRBdHRyKSB7XG4gICAgICAgICAgdHlwZSA9IHJlc291cmNlcy5nZXRBdHRyaWJ1dGUoaW5zdHJ1Y3Rpb24uYXR0ck5hbWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGluc3RydWN0aW9uLmRpc2NyZXRlKSB7XG4gICAgICAgICAgZXhwcmVzc2lvbnMucHVzaChpbnN0cnVjdGlvbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKHR5cGUpIHtcbiAgICAgICAgICAgIGluc3RydWN0aW9uLnR5cGUgPSB0eXBlO1xuICAgICAgICAgICAgY29uZmlndXJlUHJvcGVydGllcyhpbnN0cnVjdGlvbiwgcmVzb3VyY2VzKTtcblxuICAgICAgICAgICAgaWYgKHR5cGUubGlmdHNDb250ZW50KSB7XG4gICAgICAgICAgICAgIGluc3RydWN0aW9uLm9yaWdpbmFsQXR0ck5hbWUgPSBhdHRyTmFtZTtcbiAgICAgICAgICAgICAgbGlmdGluZ0luc3RydWN0aW9uID0gaW5zdHJ1Y3Rpb247XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgYmVoYXZpb3JJbnN0cnVjdGlvbnMucHVzaChpbnN0cnVjdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50UHJvcGVydHkpIHtcbiAgICAgICAgICAgIGVsZW1lbnRJbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW2luZm8uYXR0ck5hbWVdLnRhcmdldFByb3BlcnR5ID0gZWxlbWVudFByb3BlcnR5Lm5hbWU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGV4cHJlc3Npb25zLnB1c2goaW5zdHJ1Y3Rpb24uYXR0cmlidXRlc1tpbnN0cnVjdGlvbi5hdHRyTmFtZV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHR5cGUpIHtcbiAgICAgICAgICBpbnN0cnVjdGlvbiA9IEJlaGF2aW9ySW5zdHJ1Y3Rpb24uYXR0cmlidXRlKGF0dHJOYW1lLCB0eXBlKTtcbiAgICAgICAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW3Jlc291cmNlcy5tYXBBdHRyaWJ1dGUoYXR0ck5hbWUpXSA9IGF0dHJWYWx1ZTtcblxuICAgICAgICAgIGlmICh0eXBlLmxpZnRzQ29udGVudCkge1xuICAgICAgICAgICAgaW5zdHJ1Y3Rpb24ub3JpZ2luYWxBdHRyTmFtZSA9IGF0dHJOYW1lO1xuICAgICAgICAgICAgbGlmdGluZ0luc3RydWN0aW9uID0gaW5zdHJ1Y3Rpb247XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYmVoYXZpb3JJbnN0cnVjdGlvbnMucHVzaChpbnN0cnVjdGlvbik7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnRQcm9wZXJ0eSkge1xuICAgICAgICAgIGVsZW1lbnRJbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW2F0dHJOYW1lXSA9IGF0dHJWYWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChsaWZ0aW5nSW5zdHJ1Y3Rpb24pIHtcbiAgICAgIGxpZnRpbmdJbnN0cnVjdGlvbi52aWV3RmFjdG9yeSA9IHZpZXdGYWN0b3J5O1xuICAgICAgbm9kZSA9IGxpZnRpbmdJbnN0cnVjdGlvbi50eXBlLmNvbXBpbGUodGhpcywgcmVzb3VyY2VzLCBub2RlLCBsaWZ0aW5nSW5zdHJ1Y3Rpb24sIHBhcmVudE5vZGUpO1xuICAgICAgYXVUYXJnZXRJRCA9IG1ha2VJbnRvSW5zdHJ1Y3Rpb25UYXJnZXQobm9kZSk7XG4gICAgICBpbnN0cnVjdGlvbnNbYXVUYXJnZXRJRF0gPSBUYXJnZXRJbnN0cnVjdGlvbi5saWZ0aW5nKHBhcmVudEluamVjdG9ySWQsIGxpZnRpbmdJbnN0cnVjdGlvbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChleHByZXNzaW9ucy5sZW5ndGggfHwgYmVoYXZpb3JJbnN0cnVjdGlvbnMubGVuZ3RoKSB7XG4gICAgICAgIGluamVjdG9ySWQgPSBiZWhhdmlvckluc3RydWN0aW9ucy5sZW5ndGggPyBnZXROZXh0SW5qZWN0b3JJZCgpIDogZmFsc2U7XG5cbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBiZWhhdmlvckluc3RydWN0aW9ucy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgICAgaW5zdHJ1Y3Rpb24gPSBiZWhhdmlvckluc3RydWN0aW9uc1tpXTtcbiAgICAgICAgICBpbnN0cnVjdGlvbi50eXBlLmNvbXBpbGUodGhpcywgcmVzb3VyY2VzLCBub2RlLCBpbnN0cnVjdGlvbiwgcGFyZW50Tm9kZSk7XG4gICAgICAgICAgcHJvdmlkZXJzLnB1c2goaW5zdHJ1Y3Rpb24udHlwZS50YXJnZXQpO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBleHByZXNzaW9ucy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb25zW2ldO1xuICAgICAgICAgIGlmIChleHByZXNzaW9uLmF0dHJUb1JlbW92ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBub2RlLnJlbW92ZUF0dHJpYnV0ZShleHByZXNzaW9uLmF0dHJUb1JlbW92ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgYXVUYXJnZXRJRCA9IG1ha2VJbnRvSW5zdHJ1Y3Rpb25UYXJnZXQobm9kZSk7XG4gICAgICAgIGluc3RydWN0aW9uc1thdVRhcmdldElEXSA9IFRhcmdldEluc3RydWN0aW9uLm5vcm1hbChpbmplY3RvcklkLCBwYXJlbnRJbmplY3RvcklkLCBwcm92aWRlcnMsIGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLCBleHByZXNzaW9ucywgZWxlbWVudEluc3RydWN0aW9uKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGVsZW1lbnRJbnN0cnVjdGlvbiAmJiBlbGVtZW50SW5zdHJ1Y3Rpb24uc2tpcENvbnRlbnRQcm9jZXNzaW5nKSB7XG4gICAgICAgIHJldHVybiBub2RlLm5leHRTaWJsaW5nO1xuICAgICAgfVxuXG4gICAgICB2YXIgY3VycmVudENoaWxkID0gbm9kZS5maXJzdENoaWxkO1xuICAgICAgd2hpbGUgKGN1cnJlbnRDaGlsZCkge1xuICAgICAgICBjdXJyZW50Q2hpbGQgPSB0aGlzLl9jb21waWxlTm9kZShjdXJyZW50Q2hpbGQsIHJlc291cmNlcywgaW5zdHJ1Y3Rpb25zLCBub2RlLCBpbmplY3RvcklkIHx8IHBhcmVudEluamVjdG9ySWQsIHRhcmdldExpZ2h0RE9NKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbm9kZS5uZXh0U2libGluZztcbiAgfTtcblxuICByZXR1cm4gVmlld0NvbXBpbGVyO1xufSgpKSB8fCBfY2xhc3MxNyk7XG5cbnZhciBSZXNvdXJjZU1vZHVsZSA9IGV4cG9ydHMuUmVzb3VyY2VNb2R1bGUgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFJlc291cmNlTW9kdWxlKG1vZHVsZUlkKSB7XG4gICAgXG5cbiAgICB0aGlzLmlkID0gbW9kdWxlSWQ7XG4gICAgdGhpcy5tb2R1bGVJbnN0YW5jZSA9IG51bGw7XG4gICAgdGhpcy5tYWluUmVzb3VyY2UgPSBudWxsO1xuICAgIHRoaXMucmVzb3VyY2VzID0gbnVsbDtcbiAgICB0aGlzLnZpZXdTdHJhdGVneSA9IG51bGw7XG4gICAgdGhpcy5pc0luaXRpYWxpemVkID0gZmFsc2U7XG4gICAgdGhpcy5vbkxvYWRlZCA9IG51bGw7XG4gICAgdGhpcy5sb2FkQ29udGV4dCA9IG51bGw7XG4gIH1cblxuICBSZXNvdXJjZU1vZHVsZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIGluaXRpYWxpemUoY29udGFpbmVyKSB7XG4gICAgdmFyIGN1cnJlbnQgPSB0aGlzLm1haW5SZXNvdXJjZTtcbiAgICB2YXIgcmVzb3VyY2VzID0gdGhpcy5yZXNvdXJjZXM7XG4gICAgdmFyIHZzID0gdGhpcy52aWV3U3RyYXRlZ3k7XG5cbiAgICBpZiAodGhpcy5pc0luaXRpYWxpemVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5pc0luaXRpYWxpemVkID0gdHJ1ZTtcblxuICAgIGlmIChjdXJyZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGN1cnJlbnQubWV0YWRhdGEudmlld1N0cmF0ZWd5ID0gdnM7XG4gICAgICBjdXJyZW50LmluaXRpYWxpemUoY29udGFpbmVyKTtcbiAgICB9XG5cbiAgICBmb3IgKHZhciBpID0gMCwgaWkgPSByZXNvdXJjZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgY3VycmVudCA9IHJlc291cmNlc1tpXTtcbiAgICAgIGN1cnJlbnQubWV0YWRhdGEudmlld1N0cmF0ZWd5ID0gdnM7XG4gICAgICBjdXJyZW50LmluaXRpYWxpemUoY29udGFpbmVyKTtcbiAgICB9XG4gIH07XG5cbiAgUmVzb3VyY2VNb2R1bGUucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gcmVnaXN0ZXIocmVnaXN0cnksIG5hbWUpIHtcbiAgICB2YXIgbWFpbiA9IHRoaXMubWFpblJlc291cmNlO1xuICAgIHZhciByZXNvdXJjZXMgPSB0aGlzLnJlc291cmNlcztcblxuICAgIGlmIChtYWluICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIG1haW4ucmVnaXN0ZXIocmVnaXN0cnksIG5hbWUpO1xuICAgICAgbmFtZSA9IG51bGw7XG4gICAgfVxuXG4gICAgZm9yICh2YXIgaSA9IDAsIGlpID0gcmVzb3VyY2VzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgIHJlc291cmNlc1tpXS5yZWdpc3RlcihyZWdpc3RyeSwgbmFtZSk7XG4gICAgICBuYW1lID0gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgUmVzb3VyY2VNb2R1bGUucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbiBsb2FkKGNvbnRhaW5lciwgbG9hZENvbnRleHQpIHtcbiAgICBpZiAodGhpcy5vbkxvYWRlZCAhPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHRoaXMubG9hZENvbnRleHQgPT09IGxvYWRDb250ZXh0ID8gUHJvbWlzZS5yZXNvbHZlKCkgOiB0aGlzLm9uTG9hZGVkO1xuICAgIH1cblxuICAgIHZhciBtYWluID0gdGhpcy5tYWluUmVzb3VyY2U7XG4gICAgdmFyIHJlc291cmNlcyA9IHRoaXMucmVzb3VyY2VzO1xuICAgIHZhciBsb2FkcyA9IHZvaWQgMDtcblxuICAgIGlmIChtYWluICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGxvYWRzID0gbmV3IEFycmF5KHJlc291cmNlcy5sZW5ndGggKyAxKTtcbiAgICAgIGxvYWRzWzBdID0gbWFpbi5sb2FkKGNvbnRhaW5lciwgbG9hZENvbnRleHQpO1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gcmVzb3VyY2VzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgbG9hZHNbaSArIDFdID0gcmVzb3VyY2VzW2ldLmxvYWQoY29udGFpbmVyLCBsb2FkQ29udGV4dCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvYWRzID0gbmV3IEFycmF5KHJlc291cmNlcy5sZW5ndGgpO1xuICAgICAgZm9yICh2YXIgX2kgPSAwLCBfaWkgPSByZXNvdXJjZXMubGVuZ3RoOyBfaSA8IF9paTsgKytfaSkge1xuICAgICAgICBsb2Fkc1tfaV0gPSByZXNvdXJjZXNbX2ldLmxvYWQoY29udGFpbmVyLCBsb2FkQ29udGV4dCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5sb2FkQ29udGV4dCA9IGxvYWRDb250ZXh0O1xuICAgIHRoaXMub25Mb2FkZWQgPSBQcm9taXNlLmFsbChsb2Fkcyk7XG4gICAgcmV0dXJuIHRoaXMub25Mb2FkZWQ7XG4gIH07XG5cbiAgcmV0dXJuIFJlc291cmNlTW9kdWxlO1xufSgpO1xuXG52YXIgUmVzb3VyY2VEZXNjcmlwdGlvbiA9IGV4cG9ydHMuUmVzb3VyY2VEZXNjcmlwdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gUmVzb3VyY2VEZXNjcmlwdGlvbihrZXksIGV4cG9ydGVkVmFsdWUsIHJlc291cmNlVHlwZU1ldGEpIHtcbiAgICBcblxuICAgIGlmICghcmVzb3VyY2VUeXBlTWV0YSkge1xuICAgICAgcmVzb3VyY2VUeXBlTWV0YSA9IF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEuZ2V0KF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEucmVzb3VyY2UsIGV4cG9ydGVkVmFsdWUpO1xuXG4gICAgICBpZiAoIXJlc291cmNlVHlwZU1ldGEpIHtcbiAgICAgICAgcmVzb3VyY2VUeXBlTWV0YSA9IG5ldyBIdG1sQmVoYXZpb3JSZXNvdXJjZSgpO1xuICAgICAgICByZXNvdXJjZVR5cGVNZXRhLmVsZW1lbnROYW1lID0gX2h5cGhlbmF0ZShrZXkpO1xuICAgICAgICBfYXVyZWxpYU1ldGFkYXRhLm1ldGFkYXRhLmRlZmluZShfYXVyZWxpYU1ldGFkYXRhLm1ldGFkYXRhLnJlc291cmNlLCByZXNvdXJjZVR5cGVNZXRhLCBleHBvcnRlZFZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAocmVzb3VyY2VUeXBlTWV0YSBpbnN0YW5jZW9mIEh0bWxCZWhhdmlvclJlc291cmNlKSB7XG4gICAgICBpZiAocmVzb3VyY2VUeXBlTWV0YS5lbGVtZW50TmFtZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJlc291cmNlVHlwZU1ldGEuZWxlbWVudE5hbWUgPSBfaHlwaGVuYXRlKGtleSk7XG4gICAgICB9IGVsc2UgaWYgKHJlc291cmNlVHlwZU1ldGEuYXR0cmlidXRlTmFtZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJlc291cmNlVHlwZU1ldGEuYXR0cmlidXRlTmFtZSA9IF9oeXBoZW5hdGUoa2V5KTtcbiAgICAgIH0gZWxzZSBpZiAocmVzb3VyY2VUeXBlTWV0YS5hdHRyaWJ1dGVOYW1lID09PSBudWxsICYmIHJlc291cmNlVHlwZU1ldGEuZWxlbWVudE5hbWUgPT09IG51bGwpIHtcbiAgICAgICAgSHRtbEJlaGF2aW9yUmVzb3VyY2UuY29udmVudGlvbihrZXksIHJlc291cmNlVHlwZU1ldGEpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoIXJlc291cmNlVHlwZU1ldGEubmFtZSkge1xuICAgICAgcmVzb3VyY2VUeXBlTWV0YS5uYW1lID0gX2h5cGhlbmF0ZShrZXkpO1xuICAgIH1cblxuICAgIHRoaXMubWV0YWRhdGEgPSByZXNvdXJjZVR5cGVNZXRhO1xuICAgIHRoaXMudmFsdWUgPSBleHBvcnRlZFZhbHVlO1xuICB9XG5cbiAgUmVzb3VyY2VEZXNjcmlwdGlvbi5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIGluaXRpYWxpemUoY29udGFpbmVyKSB7XG4gICAgdGhpcy5tZXRhZGF0YS5pbml0aWFsaXplKGNvbnRhaW5lciwgdGhpcy52YWx1ZSk7XG4gIH07XG5cbiAgUmVzb3VyY2VEZXNjcmlwdGlvbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiByZWdpc3RlcihyZWdpc3RyeSwgbmFtZSkge1xuICAgIHRoaXMubWV0YWRhdGEucmVnaXN0ZXIocmVnaXN0cnksIG5hbWUpO1xuICB9O1xuXG4gIFJlc291cmNlRGVzY3JpcHRpb24ucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbiBsb2FkKGNvbnRhaW5lciwgbG9hZENvbnRleHQpIHtcbiAgICByZXR1cm4gdGhpcy5tZXRhZGF0YS5sb2FkKGNvbnRhaW5lciwgdGhpcy52YWx1ZSwgbG9hZENvbnRleHQpO1xuICB9O1xuXG4gIHJldHVybiBSZXNvdXJjZURlc2NyaXB0aW9uO1xufSgpO1xuXG52YXIgTW9kdWxlQW5hbHl6ZXIgPSBleHBvcnRzLk1vZHVsZUFuYWx5emVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBNb2R1bGVBbmFseXplcigpIHtcbiAgICBcblxuICAgIHRoaXMuY2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICB9XG5cbiAgTW9kdWxlQW5hbHl6ZXIucHJvdG90eXBlLmdldEFuYWx5c2lzID0gZnVuY3Rpb24gZ2V0QW5hbHlzaXMobW9kdWxlSWQpIHtcbiAgICByZXR1cm4gdGhpcy5jYWNoZVttb2R1bGVJZF07XG4gIH07XG5cbiAgTW9kdWxlQW5hbHl6ZXIucHJvdG90eXBlLmFuYWx5emUgPSBmdW5jdGlvbiBhbmFseXplKG1vZHVsZUlkLCBtb2R1bGVJbnN0YW5jZSwgbWFpblJlc291cmNlS2V5KSB7XG4gICAgdmFyIG1haW5SZXNvdXJjZSA9IHZvaWQgMDtcbiAgICB2YXIgZmFsbGJhY2tWYWx1ZSA9IHZvaWQgMDtcbiAgICB2YXIgZmFsbGJhY2tLZXkgPSB2b2lkIDA7XG4gICAgdmFyIHJlc291cmNlVHlwZU1ldGEgPSB2b2lkIDA7XG4gICAgdmFyIGtleSA9IHZvaWQgMDtcbiAgICB2YXIgZXhwb3J0ZWRWYWx1ZSA9IHZvaWQgMDtcbiAgICB2YXIgcmVzb3VyY2VzID0gW107XG4gICAgdmFyIGNvbnZlbnRpb25hbCA9IHZvaWQgMDtcbiAgICB2YXIgdnMgPSB2b2lkIDA7XG4gICAgdmFyIHJlc291cmNlTW9kdWxlID0gdm9pZCAwO1xuXG4gICAgcmVzb3VyY2VNb2R1bGUgPSB0aGlzLmNhY2hlW21vZHVsZUlkXTtcbiAgICBpZiAocmVzb3VyY2VNb2R1bGUpIHtcbiAgICAgIHJldHVybiByZXNvdXJjZU1vZHVsZTtcbiAgICB9XG5cbiAgICByZXNvdXJjZU1vZHVsZSA9IG5ldyBSZXNvdXJjZU1vZHVsZShtb2R1bGVJZCk7XG4gICAgdGhpcy5jYWNoZVttb2R1bGVJZF0gPSByZXNvdXJjZU1vZHVsZTtcblxuICAgIGlmICh0eXBlb2YgbW9kdWxlSW5zdGFuY2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIG1vZHVsZUluc3RhbmNlID0geyAnZGVmYXVsdCc6IG1vZHVsZUluc3RhbmNlIH07XG4gICAgfVxuXG4gICAgaWYgKG1haW5SZXNvdXJjZUtleSkge1xuICAgICAgbWFpblJlc291cmNlID0gbmV3IFJlc291cmNlRGVzY3JpcHRpb24obWFpblJlc291cmNlS2V5LCBtb2R1bGVJbnN0YW5jZVttYWluUmVzb3VyY2VLZXldKTtcbiAgICB9XG5cbiAgICBmb3IgKGtleSBpbiBtb2R1bGVJbnN0YW5jZSkge1xuICAgICAgZXhwb3J0ZWRWYWx1ZSA9IG1vZHVsZUluc3RhbmNlW2tleV07XG5cbiAgICAgIGlmIChrZXkgPT09IG1haW5SZXNvdXJjZUtleSB8fCB0eXBlb2YgZXhwb3J0ZWRWYWx1ZSAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgcmVzb3VyY2VUeXBlTWV0YSA9IF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEuZ2V0KF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEucmVzb3VyY2UsIGV4cG9ydGVkVmFsdWUpO1xuXG4gICAgICBpZiAocmVzb3VyY2VUeXBlTWV0YSkge1xuICAgICAgICBpZiAocmVzb3VyY2VUeXBlTWV0YS5hdHRyaWJ1dGVOYW1lID09PSBudWxsICYmIHJlc291cmNlVHlwZU1ldGEuZWxlbWVudE5hbWUgPT09IG51bGwpIHtcbiAgICAgICAgICBIdG1sQmVoYXZpb3JSZXNvdXJjZS5jb252ZW50aW9uKGtleSwgcmVzb3VyY2VUeXBlTWV0YSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocmVzb3VyY2VUeXBlTWV0YS5hdHRyaWJ1dGVOYW1lID09PSBudWxsICYmIHJlc291cmNlVHlwZU1ldGEuZWxlbWVudE5hbWUgPT09IG51bGwpIHtcbiAgICAgICAgICByZXNvdXJjZVR5cGVNZXRhLmVsZW1lbnROYW1lID0gX2h5cGhlbmF0ZShrZXkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFtYWluUmVzb3VyY2UgJiYgcmVzb3VyY2VUeXBlTWV0YSBpbnN0YW5jZW9mIEh0bWxCZWhhdmlvclJlc291cmNlICYmIHJlc291cmNlVHlwZU1ldGEuZWxlbWVudE5hbWUgIT09IG51bGwpIHtcbiAgICAgICAgICBtYWluUmVzb3VyY2UgPSBuZXcgUmVzb3VyY2VEZXNjcmlwdGlvbihrZXksIGV4cG9ydGVkVmFsdWUsIHJlc291cmNlVHlwZU1ldGEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc291cmNlcy5wdXNoKG5ldyBSZXNvdXJjZURlc2NyaXB0aW9uKGtleSwgZXhwb3J0ZWRWYWx1ZSwgcmVzb3VyY2VUeXBlTWV0YSkpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHZpZXdTdHJhdGVneS5kZWNvcmF0ZXMoZXhwb3J0ZWRWYWx1ZSkpIHtcbiAgICAgICAgdnMgPSBleHBvcnRlZFZhbHVlO1xuICAgICAgfSBlbHNlIGlmIChleHBvcnRlZFZhbHVlIGluc3RhbmNlb2YgX2F1cmVsaWFMb2FkZXIuVGVtcGxhdGVSZWdpc3RyeUVudHJ5KSB7XG4gICAgICAgIHZzID0gbmV3IFRlbXBsYXRlUmVnaXN0cnlWaWV3U3RyYXRlZ3kobW9kdWxlSWQsIGV4cG9ydGVkVmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGNvbnZlbnRpb25hbCA9IEh0bWxCZWhhdmlvclJlc291cmNlLmNvbnZlbnRpb24oa2V5KSkge1xuICAgICAgICAgIGlmIChjb252ZW50aW9uYWwuZWxlbWVudE5hbWUgIT09IG51bGwgJiYgIW1haW5SZXNvdXJjZSkge1xuICAgICAgICAgICAgbWFpblJlc291cmNlID0gbmV3IFJlc291cmNlRGVzY3JpcHRpb24oa2V5LCBleHBvcnRlZFZhbHVlLCBjb252ZW50aW9uYWwpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXNvdXJjZXMucHVzaChuZXcgUmVzb3VyY2VEZXNjcmlwdGlvbihrZXksIGV4cG9ydGVkVmFsdWUsIGNvbnZlbnRpb25hbCkpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEuZGVmaW5lKF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEucmVzb3VyY2UsIGNvbnZlbnRpb25hbCwgZXhwb3J0ZWRWYWx1ZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoY29udmVudGlvbmFsID0gX2F1cmVsaWFCaW5kaW5nLlZhbHVlQ29udmVydGVyUmVzb3VyY2UuY29udmVudGlvbihrZXkpIHx8IF9hdXJlbGlhQmluZGluZy5CaW5kaW5nQmVoYXZpb3JSZXNvdXJjZS5jb252ZW50aW9uKGtleSkgfHwgVmlld0VuZ2luZUhvb2tzUmVzb3VyY2UuY29udmVudGlvbihrZXkpKSB7XG4gICAgICAgICAgcmVzb3VyY2VzLnB1c2gobmV3IFJlc291cmNlRGVzY3JpcHRpb24oa2V5LCBleHBvcnRlZFZhbHVlLCBjb252ZW50aW9uYWwpKTtcbiAgICAgICAgICBfYXVyZWxpYU1ldGFkYXRhLm1ldGFkYXRhLmRlZmluZShfYXVyZWxpYU1ldGFkYXRhLm1ldGFkYXRhLnJlc291cmNlLCBjb252ZW50aW9uYWwsIGV4cG9ydGVkVmFsdWUpO1xuICAgICAgICB9IGVsc2UgaWYgKCFmYWxsYmFja1ZhbHVlKSB7XG4gICAgICAgICAgZmFsbGJhY2tWYWx1ZSA9IGV4cG9ydGVkVmFsdWU7XG4gICAgICAgICAgZmFsbGJhY2tLZXkgPSBrZXk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIW1haW5SZXNvdXJjZSAmJiBmYWxsYmFja1ZhbHVlKSB7XG4gICAgICBtYWluUmVzb3VyY2UgPSBuZXcgUmVzb3VyY2VEZXNjcmlwdGlvbihmYWxsYmFja0tleSwgZmFsbGJhY2tWYWx1ZSk7XG4gICAgfVxuXG4gICAgcmVzb3VyY2VNb2R1bGUubW9kdWxlSW5zdGFuY2UgPSBtb2R1bGVJbnN0YW5jZTtcbiAgICByZXNvdXJjZU1vZHVsZS5tYWluUmVzb3VyY2UgPSBtYWluUmVzb3VyY2U7XG4gICAgcmVzb3VyY2VNb2R1bGUucmVzb3VyY2VzID0gcmVzb3VyY2VzO1xuICAgIHJlc291cmNlTW9kdWxlLnZpZXdTdHJhdGVneSA9IHZzO1xuXG4gICAgcmV0dXJuIHJlc291cmNlTW9kdWxlO1xuICB9O1xuXG4gIHJldHVybiBNb2R1bGVBbmFseXplcjtcbn0oKTtcblxudmFyIGxvZ2dlciA9IExvZ01hbmFnZXIuZ2V0TG9nZ2VyKCd0ZW1wbGF0aW5nJyk7XG5cbmZ1bmN0aW9uIGVuc3VyZVJlZ2lzdHJ5RW50cnkobG9hZGVyLCB1cmxPclJlZ2lzdHJ5RW50cnkpIHtcbiAgaWYgKHVybE9yUmVnaXN0cnlFbnRyeSBpbnN0YW5jZW9mIF9hdXJlbGlhTG9hZGVyLlRlbXBsYXRlUmVnaXN0cnlFbnRyeSkge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodXJsT3JSZWdpc3RyeUVudHJ5KTtcbiAgfVxuXG4gIHJldHVybiBsb2FkZXIubG9hZFRlbXBsYXRlKHVybE9yUmVnaXN0cnlFbnRyeSk7XG59XG5cbnZhciBQcm94eVZpZXdGYWN0b3J5ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBQcm94eVZpZXdGYWN0b3J5KHByb21pc2UpIHtcbiAgICB2YXIgX3RoaXM5ID0gdGhpcztcblxuICAgIFxuXG4gICAgcHJvbWlzZS50aGVuKGZ1bmN0aW9uICh4KSB7XG4gICAgICByZXR1cm4gX3RoaXM5LnZpZXdGYWN0b3J5ID0geDtcbiAgICB9KTtcbiAgfVxuXG4gIFByb3h5Vmlld0ZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uIGNyZWF0ZShjb250YWluZXIsIGJpbmRpbmdDb250ZXh0LCBjcmVhdGVJbnN0cnVjdGlvbiwgZWxlbWVudCkge1xuICAgIHJldHVybiB0aGlzLnZpZXdGYWN0b3J5LmNyZWF0ZShjb250YWluZXIsIGJpbmRpbmdDb250ZXh0LCBjcmVhdGVJbnN0cnVjdGlvbiwgZWxlbWVudCk7XG4gIH07XG5cbiAgUHJveHlWaWV3RmFjdG9yeS5wcm90b3R5cGUuc2V0Q2FjaGVTaXplID0gZnVuY3Rpb24gc2V0Q2FjaGVTaXplKHNpemUsIGRvTm90T3ZlcnJpZGVJZkFscmVhZHlTZXQpIHtcbiAgICB0aGlzLnZpZXdGYWN0b3J5LnNldENhY2hlU2l6ZShzaXplLCBkb05vdE92ZXJyaWRlSWZBbHJlYWR5U2V0KTtcbiAgfTtcblxuICBQcm94eVZpZXdGYWN0b3J5LnByb3RvdHlwZS5nZXRDYWNoZWRWaWV3ID0gZnVuY3Rpb24gZ2V0Q2FjaGVkVmlldygpIHtcbiAgICByZXR1cm4gdGhpcy52aWV3RmFjdG9yeS5nZXRDYWNoZWRWaWV3KCk7XG4gIH07XG5cbiAgUHJveHlWaWV3RmFjdG9yeS5wcm90b3R5cGUucmV0dXJuVmlld1RvQ2FjaGUgPSBmdW5jdGlvbiByZXR1cm5WaWV3VG9DYWNoZSh2aWV3KSB7XG4gICAgdGhpcy52aWV3RmFjdG9yeS5yZXR1cm5WaWV3VG9DYWNoZSh2aWV3KTtcbiAgfTtcblxuICBfY3JlYXRlQ2xhc3MoUHJveHlWaWV3RmFjdG9yeSwgW3tcbiAgICBrZXk6ICdpc0NhY2hpbmcnLFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgcmV0dXJuIHRoaXMudmlld0ZhY3RvcnkuaXNDYWNoaW5nO1xuICAgIH1cbiAgfV0pO1xuXG4gIHJldHVybiBQcm94eVZpZXdGYWN0b3J5O1xufSgpO1xuXG52YXIgVmlld0VuZ2luZSA9IGV4cG9ydHMuVmlld0VuZ2luZSA9IChfZGVjOCA9ICgwLCBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24uaW5qZWN0KShfYXVyZWxpYUxvYWRlci5Mb2FkZXIsIF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbi5Db250YWluZXIsIFZpZXdDb21waWxlciwgTW9kdWxlQW5hbHl6ZXIsIFZpZXdSZXNvdXJjZXMpLCBfZGVjOChfY2xhc3MxOCA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gVmlld0VuZ2luZShsb2FkZXIsIGNvbnRhaW5lciwgdmlld0NvbXBpbGVyLCBtb2R1bGVBbmFseXplciwgYXBwUmVzb3VyY2VzKSB7XG4gICAgXG5cbiAgICB0aGlzLmxvYWRlciA9IGxvYWRlcjtcbiAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICB0aGlzLnZpZXdDb21waWxlciA9IHZpZXdDb21waWxlcjtcbiAgICB0aGlzLm1vZHVsZUFuYWx5emVyID0gbW9kdWxlQW5hbHl6ZXI7XG4gICAgdGhpcy5hcHBSZXNvdXJjZXMgPSBhcHBSZXNvdXJjZXM7XG4gICAgdGhpcy5fcGx1Z2luTWFwID0ge307XG5cbiAgICB2YXIgYXVTbG90QmVoYXZpb3IgPSBuZXcgSHRtbEJlaGF2aW9yUmVzb3VyY2UoKTtcbiAgICBhdVNsb3RCZWhhdmlvci5hdHRyaWJ1dGVOYW1lID0gJ2F1LXNsb3QnO1xuICAgIGF1U2xvdEJlaGF2aW9yLmluaXRpYWxpemUoY29udGFpbmVyLCBTbG90Q3VzdG9tQXR0cmlidXRlKTtcbiAgICBhdVNsb3RCZWhhdmlvci5yZWdpc3RlcihhcHBSZXNvdXJjZXMpO1xuICB9XG5cbiAgVmlld0VuZ2luZS5wcm90b3R5cGUuYWRkUmVzb3VyY2VQbHVnaW4gPSBmdW5jdGlvbiBhZGRSZXNvdXJjZVBsdWdpbihleHRlbnNpb24sIGltcGxlbWVudGF0aW9uKSB7XG4gICAgdmFyIG5hbWUgPSBleHRlbnNpb24ucmVwbGFjZSgnLicsICcnKSArICctcmVzb3VyY2UtcGx1Z2luJztcbiAgICB0aGlzLl9wbHVnaW5NYXBbZXh0ZW5zaW9uXSA9IG5hbWU7XG4gICAgdGhpcy5sb2FkZXIuYWRkUGx1Z2luKG5hbWUsIGltcGxlbWVudGF0aW9uKTtcbiAgfTtcblxuICBWaWV3RW5naW5lLnByb3RvdHlwZS5sb2FkVmlld0ZhY3RvcnkgPSBmdW5jdGlvbiBsb2FkVmlld0ZhY3RvcnkodXJsT3JSZWdpc3RyeUVudHJ5LCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0KSB7XG4gICAgdmFyIF90aGlzMTAgPSB0aGlzO1xuXG4gICAgbG9hZENvbnRleHQgPSBsb2FkQ29udGV4dCB8fCBuZXcgUmVzb3VyY2VMb2FkQ29udGV4dCgpO1xuXG4gICAgcmV0dXJuIGVuc3VyZVJlZ2lzdHJ5RW50cnkodGhpcy5sb2FkZXIsIHVybE9yUmVnaXN0cnlFbnRyeSkudGhlbihmdW5jdGlvbiAocmVnaXN0cnlFbnRyeSkge1xuICAgICAgaWYgKHJlZ2lzdHJ5RW50cnkub25SZWFkeSkge1xuICAgICAgICBpZiAoIWxvYWRDb250ZXh0Lmhhc0RlcGVuZGVuY3kodXJsT3JSZWdpc3RyeUVudHJ5KSkge1xuICAgICAgICAgIGxvYWRDb250ZXh0LmFkZERlcGVuZGVuY3kodXJsT3JSZWdpc3RyeUVudHJ5KTtcbiAgICAgICAgICByZXR1cm4gcmVnaXN0cnlFbnRyeS5vblJlYWR5O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXcgUHJveHlWaWV3RmFjdG9yeShyZWdpc3RyeUVudHJ5Lm9uUmVhZHkpKTtcbiAgICAgIH1cblxuICAgICAgbG9hZENvbnRleHQuYWRkRGVwZW5kZW5jeSh1cmxPclJlZ2lzdHJ5RW50cnkpO1xuXG4gICAgICByZWdpc3RyeUVudHJ5Lm9uUmVhZHkgPSBfdGhpczEwLmxvYWRUZW1wbGF0ZVJlc291cmNlcyhyZWdpc3RyeUVudHJ5LCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0KS50aGVuKGZ1bmN0aW9uIChyZXNvdXJjZXMpIHtcbiAgICAgICAgcmVnaXN0cnlFbnRyeS5yZXNvdXJjZXMgPSByZXNvdXJjZXM7XG4gICAgICAgIHZhciB2aWV3RmFjdG9yeSA9IF90aGlzMTAudmlld0NvbXBpbGVyLmNvbXBpbGUocmVnaXN0cnlFbnRyeS50ZW1wbGF0ZSwgcmVzb3VyY2VzLCBjb21waWxlSW5zdHJ1Y3Rpb24pO1xuICAgICAgICByZWdpc3RyeUVudHJ5LmZhY3RvcnkgPSB2aWV3RmFjdG9yeTtcbiAgICAgICAgcmV0dXJuIHZpZXdGYWN0b3J5O1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiByZWdpc3RyeUVudHJ5Lm9uUmVhZHk7XG4gICAgfSk7XG4gIH07XG5cbiAgVmlld0VuZ2luZS5wcm90b3R5cGUubG9hZFRlbXBsYXRlUmVzb3VyY2VzID0gZnVuY3Rpb24gbG9hZFRlbXBsYXRlUmVzb3VyY2VzKHJlZ2lzdHJ5RW50cnksIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQpIHtcbiAgICB2YXIgcmVzb3VyY2VzID0gbmV3IFZpZXdSZXNvdXJjZXModGhpcy5hcHBSZXNvdXJjZXMsIHJlZ2lzdHJ5RW50cnkuYWRkcmVzcyk7XG4gICAgdmFyIGRlcGVuZGVuY2llcyA9IHJlZ2lzdHJ5RW50cnkuZGVwZW5kZW5jaWVzO1xuICAgIHZhciBpbXBvcnRJZHMgPSB2b2lkIDA7XG4gICAgdmFyIG5hbWVzID0gdm9pZCAwO1xuXG4gICAgY29tcGlsZUluc3RydWN0aW9uID0gY29tcGlsZUluc3RydWN0aW9uIHx8IFZpZXdDb21waWxlSW5zdHJ1Y3Rpb24ubm9ybWFsO1xuXG4gICAgaWYgKGRlcGVuZGVuY2llcy5sZW5ndGggPT09IDAgJiYgIWNvbXBpbGVJbnN0cnVjdGlvbi5hc3NvY2lhdGVkTW9kdWxlSWQpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzb3VyY2VzKTtcbiAgICB9XG5cbiAgICBpbXBvcnRJZHMgPSBkZXBlbmRlbmNpZXMubWFwKGZ1bmN0aW9uICh4KSB7XG4gICAgICByZXR1cm4geC5zcmM7XG4gICAgfSk7XG4gICAgbmFtZXMgPSBkZXBlbmRlbmNpZXMubWFwKGZ1bmN0aW9uICh4KSB7XG4gICAgICByZXR1cm4geC5uYW1lO1xuICAgIH0pO1xuICAgIGxvZ2dlci5kZWJ1ZygnaW1wb3J0aW5nIHJlc291cmNlcyBmb3IgJyArIHJlZ2lzdHJ5RW50cnkuYWRkcmVzcywgaW1wb3J0SWRzKTtcblxuICAgIHJldHVybiB0aGlzLmltcG9ydFZpZXdSZXNvdXJjZXMoaW1wb3J0SWRzLCBuYW1lcywgcmVzb3VyY2VzLCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0KTtcbiAgfTtcblxuICBWaWV3RW5naW5lLnByb3RvdHlwZS5pbXBvcnRWaWV3TW9kZWxSZXNvdXJjZSA9IGZ1bmN0aW9uIGltcG9ydFZpZXdNb2RlbFJlc291cmNlKG1vZHVsZUltcG9ydCwgbW9kdWxlTWVtYmVyKSB7XG4gICAgdmFyIF90aGlzMTEgPSB0aGlzO1xuXG4gICAgcmV0dXJuIHRoaXMubG9hZGVyLmxvYWRNb2R1bGUobW9kdWxlSW1wb3J0KS50aGVuKGZ1bmN0aW9uICh2aWV3TW9kZWxNb2R1bGUpIHtcbiAgICAgIHZhciBub3JtYWxpemVkSWQgPSBfYXVyZWxpYU1ldGFkYXRhLk9yaWdpbi5nZXQodmlld01vZGVsTW9kdWxlKS5tb2R1bGVJZDtcbiAgICAgIHZhciByZXNvdXJjZU1vZHVsZSA9IF90aGlzMTEubW9kdWxlQW5hbHl6ZXIuYW5hbHl6ZShub3JtYWxpemVkSWQsIHZpZXdNb2RlbE1vZHVsZSwgbW9kdWxlTWVtYmVyKTtcblxuICAgICAgaWYgKCFyZXNvdXJjZU1vZHVsZS5tYWluUmVzb3VyY2UpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyB2aWV3IG1vZGVsIGZvdW5kIGluIG1vZHVsZSBcIicgKyBtb2R1bGVJbXBvcnQgKyAnXCIuJyk7XG4gICAgICB9XG5cbiAgICAgIHJlc291cmNlTW9kdWxlLmluaXRpYWxpemUoX3RoaXMxMS5jb250YWluZXIpO1xuXG4gICAgICByZXR1cm4gcmVzb3VyY2VNb2R1bGUubWFpblJlc291cmNlO1xuICAgIH0pO1xuICB9O1xuXG4gIFZpZXdFbmdpbmUucHJvdG90eXBlLmltcG9ydFZpZXdSZXNvdXJjZXMgPSBmdW5jdGlvbiBpbXBvcnRWaWV3UmVzb3VyY2VzKG1vZHVsZUlkcywgbmFtZXMsIHJlc291cmNlcywgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCkge1xuICAgIHZhciBfdGhpczEyID0gdGhpcztcblxuICAgIGxvYWRDb250ZXh0ID0gbG9hZENvbnRleHQgfHwgbmV3IFJlc291cmNlTG9hZENvbnRleHQoKTtcbiAgICBjb21waWxlSW5zdHJ1Y3Rpb24gPSBjb21waWxlSW5zdHJ1Y3Rpb24gfHwgVmlld0NvbXBpbGVJbnN0cnVjdGlvbi5ub3JtYWw7XG5cbiAgICBtb2R1bGVJZHMgPSBtb2R1bGVJZHMubWFwKGZ1bmN0aW9uICh4KSB7XG4gICAgICByZXR1cm4gX3RoaXMxMi5fYXBwbHlMb2FkZXJQbHVnaW4oeCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcy5sb2FkZXIubG9hZEFsbE1vZHVsZXMobW9kdWxlSWRzKS50aGVuKGZ1bmN0aW9uIChpbXBvcnRzKSB7XG4gICAgICB2YXIgaSA9IHZvaWQgMDtcbiAgICAgIHZhciBpaSA9IHZvaWQgMDtcbiAgICAgIHZhciBhbmFseXNpcyA9IHZvaWQgMDtcbiAgICAgIHZhciBub3JtYWxpemVkSWQgPSB2b2lkIDA7XG4gICAgICB2YXIgY3VycmVudCA9IHZvaWQgMDtcbiAgICAgIHZhciBhc3NvY2lhdGVkTW9kdWxlID0gdm9pZCAwO1xuICAgICAgdmFyIGNvbnRhaW5lciA9IF90aGlzMTIuY29udGFpbmVyO1xuICAgICAgdmFyIG1vZHVsZUFuYWx5emVyID0gX3RoaXMxMi5tb2R1bGVBbmFseXplcjtcbiAgICAgIHZhciBhbGxBbmFseXNpcyA9IG5ldyBBcnJheShpbXBvcnRzLmxlbmd0aCk7XG5cbiAgICAgIGZvciAoaSA9IDAsIGlpID0gaW1wb3J0cy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgIGN1cnJlbnQgPSBpbXBvcnRzW2ldO1xuICAgICAgICBub3JtYWxpemVkSWQgPSBfYXVyZWxpYU1ldGFkYXRhLk9yaWdpbi5nZXQoY3VycmVudCkubW9kdWxlSWQ7XG5cbiAgICAgICAgYW5hbHlzaXMgPSBtb2R1bGVBbmFseXplci5hbmFseXplKG5vcm1hbGl6ZWRJZCwgY3VycmVudCk7XG4gICAgICAgIGFuYWx5c2lzLmluaXRpYWxpemUoY29udGFpbmVyKTtcbiAgICAgICAgYW5hbHlzaXMucmVnaXN0ZXIocmVzb3VyY2VzLCBuYW1lc1tpXSk7XG5cbiAgICAgICAgYWxsQW5hbHlzaXNbaV0gPSBhbmFseXNpcztcbiAgICAgIH1cblxuICAgICAgaWYgKGNvbXBpbGVJbnN0cnVjdGlvbi5hc3NvY2lhdGVkTW9kdWxlSWQpIHtcbiAgICAgICAgYXNzb2NpYXRlZE1vZHVsZSA9IG1vZHVsZUFuYWx5emVyLmdldEFuYWx5c2lzKGNvbXBpbGVJbnN0cnVjdGlvbi5hc3NvY2lhdGVkTW9kdWxlSWQpO1xuXG4gICAgICAgIGlmIChhc3NvY2lhdGVkTW9kdWxlKSB7XG4gICAgICAgICAgYXNzb2NpYXRlZE1vZHVsZS5yZWdpc3RlcihyZXNvdXJjZXMpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGZvciAoaSA9IDAsIGlpID0gYWxsQW5hbHlzaXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgICBhbGxBbmFseXNpc1tpXSA9IGFsbEFuYWx5c2lzW2ldLmxvYWQoY29udGFpbmVyLCBsb2FkQ29udGV4dCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChhbGxBbmFseXNpcykudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiByZXNvdXJjZXM7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcblxuICBWaWV3RW5naW5lLnByb3RvdHlwZS5fYXBwbHlMb2FkZXJQbHVnaW4gPSBmdW5jdGlvbiBfYXBwbHlMb2FkZXJQbHVnaW4oaWQpIHtcbiAgICB2YXIgaW5kZXggPSBpZC5sYXN0SW5kZXhPZignLicpO1xuICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgIHZhciBleHQgPSBpZC5zdWJzdHJpbmcoaW5kZXgpO1xuICAgICAgdmFyIHBsdWdpbk5hbWUgPSB0aGlzLl9wbHVnaW5NYXBbZXh0XTtcblxuICAgICAgaWYgKHBsdWdpbk5hbWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gaWQ7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLmxvYWRlci5hcHBseVBsdWdpblRvVXJsKGlkLCBwbHVnaW5OYW1lKTtcbiAgICB9XG5cbiAgICByZXR1cm4gaWQ7XG4gIH07XG5cbiAgcmV0dXJuIFZpZXdFbmdpbmU7XG59KCkpIHx8IF9jbGFzczE4KTtcblxudmFyIENvbnRyb2xsZXIgPSBleHBvcnRzLkNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIENvbnRyb2xsZXIoYmVoYXZpb3IsIGluc3RydWN0aW9uLCB2aWV3TW9kZWwsIGVsZW1lbnRFdmVudHMpIHtcbiAgICBcblxuICAgIHRoaXMuYmVoYXZpb3IgPSBiZWhhdmlvcjtcbiAgICB0aGlzLmluc3RydWN0aW9uID0gaW5zdHJ1Y3Rpb247XG4gICAgdGhpcy52aWV3TW9kZWwgPSB2aWV3TW9kZWw7XG4gICAgdGhpcy5pc0F0dGFjaGVkID0gZmFsc2U7XG4gICAgdGhpcy52aWV3ID0gbnVsbDtcbiAgICB0aGlzLmlzQm91bmQgPSBmYWxzZTtcbiAgICB0aGlzLnNjb3BlID0gbnVsbDtcbiAgICB0aGlzLmVsZW1lbnRFdmVudHMgPSBlbGVtZW50RXZlbnRzIHx8IG51bGw7XG5cbiAgICB2YXIgb2JzZXJ2ZXJMb29rdXAgPSBiZWhhdmlvci5vYnNlcnZlckxvY2F0b3IuZ2V0T3JDcmVhdGVPYnNlcnZlcnNMb29rdXAodmlld01vZGVsKTtcbiAgICB2YXIgaGFuZGxlc0JpbmQgPSBiZWhhdmlvci5oYW5kbGVzQmluZDtcbiAgICB2YXIgYXR0cmlidXRlcyA9IGluc3RydWN0aW9uLmF0dHJpYnV0ZXM7XG4gICAgdmFyIGJvdW5kUHJvcGVydGllcyA9IHRoaXMuYm91bmRQcm9wZXJ0aWVzID0gW107XG4gICAgdmFyIHByb3BlcnRpZXMgPSBiZWhhdmlvci5wcm9wZXJ0aWVzO1xuICAgIHZhciBpID0gdm9pZCAwO1xuICAgIHZhciBpaSA9IHZvaWQgMDtcblxuICAgIGJlaGF2aW9yLl9lbnN1cmVQcm9wZXJ0aWVzRGVmaW5lZCh2aWV3TW9kZWwsIG9ic2VydmVyTG9va3VwKTtcblxuICAgIGZvciAoaSA9IDAsIGlpID0gcHJvcGVydGllcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICBwcm9wZXJ0aWVzW2ldLl9pbml0aWFsaXplKHZpZXdNb2RlbCwgb2JzZXJ2ZXJMb29rdXAsIGF0dHJpYnV0ZXMsIGhhbmRsZXNCaW5kLCBib3VuZFByb3BlcnRpZXMpO1xuICAgIH1cbiAgfVxuXG4gIENvbnRyb2xsZXIucHJvdG90eXBlLmNyZWF0ZWQgPSBmdW5jdGlvbiBjcmVhdGVkKG93bmluZ1ZpZXcpIHtcbiAgICBpZiAodGhpcy5iZWhhdmlvci5oYW5kbGVzQ3JlYXRlZCkge1xuICAgICAgdGhpcy52aWV3TW9kZWwuY3JlYXRlZChvd25pbmdWaWV3LCB0aGlzLnZpZXcpO1xuICAgIH1cbiAgfTtcblxuICBDb250cm9sbGVyLnByb3RvdHlwZS5hdXRvbWF0ZSA9IGZ1bmN0aW9uIGF1dG9tYXRlKG92ZXJyaWRlQ29udGV4dCwgb3duaW5nVmlldykge1xuICAgIHRoaXMudmlldy5iaW5kaW5nQ29udGV4dCA9IHRoaXMudmlld01vZGVsO1xuICAgIHRoaXMudmlldy5vdmVycmlkZUNvbnRleHQgPSBvdmVycmlkZUNvbnRleHQgfHwgKDAsIF9hdXJlbGlhQmluZGluZy5jcmVhdGVPdmVycmlkZUNvbnRleHQpKHRoaXMudmlld01vZGVsKTtcbiAgICB0aGlzLnZpZXcuX2lzVXNlckNvbnRyb2xsZWQgPSB0cnVlO1xuXG4gICAgaWYgKHRoaXMuYmVoYXZpb3IuaGFuZGxlc0NyZWF0ZWQpIHtcbiAgICAgIHRoaXMudmlld01vZGVsLmNyZWF0ZWQob3duaW5nVmlldyB8fCBudWxsLCB0aGlzLnZpZXcpO1xuICAgIH1cblxuICAgIHRoaXMuYmluZCh0aGlzLnZpZXcpO1xuICB9O1xuXG4gIENvbnRyb2xsZXIucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiBiaW5kKHNjb3BlKSB7XG4gICAgdmFyIHNraXBTZWxmU3Vic2NyaWJlciA9IHRoaXMuYmVoYXZpb3IuaGFuZGxlc0JpbmQ7XG4gICAgdmFyIGJvdW5kUHJvcGVydGllcyA9IHRoaXMuYm91bmRQcm9wZXJ0aWVzO1xuICAgIHZhciBpID0gdm9pZCAwO1xuICAgIHZhciBpaSA9IHZvaWQgMDtcbiAgICB2YXIgeCA9IHZvaWQgMDtcbiAgICB2YXIgb2JzZXJ2ZXIgPSB2b2lkIDA7XG4gICAgdmFyIHNlbGZTdWJzY3JpYmVyID0gdm9pZCAwO1xuXG4gICAgaWYgKHRoaXMuaXNCb3VuZCkge1xuICAgICAgaWYgKHRoaXMuc2NvcGUgPT09IHNjb3BlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy51bmJpbmQoKTtcbiAgICB9XG5cbiAgICB0aGlzLmlzQm91bmQgPSB0cnVlO1xuICAgIHRoaXMuc2NvcGUgPSBzY29wZTtcblxuICAgIGZvciAoaSA9IDAsIGlpID0gYm91bmRQcm9wZXJ0aWVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgIHggPSBib3VuZFByb3BlcnRpZXNbaV07XG4gICAgICBvYnNlcnZlciA9IHgub2JzZXJ2ZXI7XG4gICAgICBzZWxmU3Vic2NyaWJlciA9IG9ic2VydmVyLnNlbGZTdWJzY3JpYmVyO1xuICAgICAgb2JzZXJ2ZXIucHVibGlzaGluZyA9IGZhbHNlO1xuXG4gICAgICBpZiAoc2tpcFNlbGZTdWJzY3JpYmVyKSB7XG4gICAgICAgIG9ic2VydmVyLnNlbGZTdWJzY3JpYmVyID0gbnVsbDtcbiAgICAgIH1cblxuICAgICAgeC5iaW5kaW5nLmJpbmQoc2NvcGUpO1xuICAgICAgb2JzZXJ2ZXIuY2FsbCgpO1xuXG4gICAgICBvYnNlcnZlci5wdWJsaXNoaW5nID0gdHJ1ZTtcbiAgICAgIG9ic2VydmVyLnNlbGZTdWJzY3JpYmVyID0gc2VsZlN1YnNjcmliZXI7XG4gICAgfVxuXG4gICAgdmFyIG92ZXJyaWRlQ29udGV4dCA9IHZvaWQgMDtcbiAgICBpZiAodGhpcy52aWV3ICE9PSBudWxsKSB7XG4gICAgICBpZiAoc2tpcFNlbGZTdWJzY3JpYmVyKSB7XG4gICAgICAgIHRoaXMudmlldy52aWV3TW9kZWxTY29wZSA9IHNjb3BlO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy52aWV3TW9kZWwgPT09IHNjb3BlLm92ZXJyaWRlQ29udGV4dC5iaW5kaW5nQ29udGV4dCkge1xuICAgICAgICBvdmVycmlkZUNvbnRleHQgPSBzY29wZS5vdmVycmlkZUNvbnRleHQ7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuaW5zdHJ1Y3Rpb24uaW5oZXJpdEJpbmRpbmdDb250ZXh0KSB7XG4gICAgICAgICAgb3ZlcnJpZGVDb250ZXh0ID0gKDAsIF9hdXJlbGlhQmluZGluZy5jcmVhdGVPdmVycmlkZUNvbnRleHQpKHRoaXMudmlld01vZGVsLCBzY29wZS5vdmVycmlkZUNvbnRleHQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgb3ZlcnJpZGVDb250ZXh0ID0gKDAsIF9hdXJlbGlhQmluZGluZy5jcmVhdGVPdmVycmlkZUNvbnRleHQpKHRoaXMudmlld01vZGVsKTtcbiAgICAgICAgICAgIG92ZXJyaWRlQ29udGV4dC5fX3BhcmVudE92ZXJyaWRlQ29udGV4dCA9IHNjb3BlLm92ZXJyaWRlQ29udGV4dDtcbiAgICAgICAgICB9XG5cbiAgICAgIHRoaXMudmlldy5iaW5kKHRoaXMudmlld01vZGVsLCBvdmVycmlkZUNvbnRleHQpO1xuICAgIH0gZWxzZSBpZiAoc2tpcFNlbGZTdWJzY3JpYmVyKSB7XG4gICAgICBvdmVycmlkZUNvbnRleHQgPSBzY29wZS5vdmVycmlkZUNvbnRleHQ7XG5cbiAgICAgIGlmIChzY29wZS5vdmVycmlkZUNvbnRleHQuX19wYXJlbnRPdmVycmlkZUNvbnRleHQgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnZpZXdNb2RlbC52aWV3RmFjdG9yeSAmJiB0aGlzLnZpZXdNb2RlbC52aWV3RmFjdG9yeS5mYWN0b3J5Q3JlYXRlSW5zdHJ1Y3Rpb24ucGFydFJlcGxhY2VtZW50cykge1xuICAgICAgICBvdmVycmlkZUNvbnRleHQgPSBPYmplY3QuYXNzaWduKHt9LCBzY29wZS5vdmVycmlkZUNvbnRleHQpO1xuICAgICAgICBvdmVycmlkZUNvbnRleHQucGFyZW50T3ZlcnJpZGVDb250ZXh0ID0gc2NvcGUub3ZlcnJpZGVDb250ZXh0Ll9fcGFyZW50T3ZlcnJpZGVDb250ZXh0O1xuICAgICAgfVxuICAgICAgdGhpcy52aWV3TW9kZWwuYmluZChzY29wZS5iaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KTtcbiAgICB9XG4gIH07XG5cbiAgQ29udHJvbGxlci5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gdW5iaW5kKCkge1xuICAgIGlmICh0aGlzLmlzQm91bmQpIHtcbiAgICAgIHZhciBib3VuZFByb3BlcnRpZXMgPSB0aGlzLmJvdW5kUHJvcGVydGllcztcbiAgICAgIHZhciBpID0gdm9pZCAwO1xuICAgICAgdmFyIGlpID0gdm9pZCAwO1xuXG4gICAgICB0aGlzLmlzQm91bmQgPSBmYWxzZTtcbiAgICAgIHRoaXMuc2NvcGUgPSBudWxsO1xuXG4gICAgICBpZiAodGhpcy52aWV3ICE9PSBudWxsKSB7XG4gICAgICAgIHRoaXMudmlldy51bmJpbmQoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuYmVoYXZpb3IuaGFuZGxlc1VuYmluZCkge1xuICAgICAgICB0aGlzLnZpZXdNb2RlbC51bmJpbmQoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuZWxlbWVudEV2ZW50cyAhPT0gbnVsbCkge1xuICAgICAgICB0aGlzLmVsZW1lbnRFdmVudHMuZGlzcG9zZUFsbCgpO1xuICAgICAgfVxuXG4gICAgICBmb3IgKGkgPSAwLCBpaSA9IGJvdW5kUHJvcGVydGllcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgIGJvdW5kUHJvcGVydGllc1tpXS5iaW5kaW5nLnVuYmluZCgpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBDb250cm9sbGVyLnByb3RvdHlwZS5hdHRhY2hlZCA9IGZ1bmN0aW9uIGF0dGFjaGVkKCkge1xuICAgIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmlzQXR0YWNoZWQgPSB0cnVlO1xuXG4gICAgaWYgKHRoaXMuYmVoYXZpb3IuaGFuZGxlc0F0dGFjaGVkKSB7XG4gICAgICB0aGlzLnZpZXdNb2RlbC5hdHRhY2hlZCgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnZpZXcgIT09IG51bGwpIHtcbiAgICAgIHRoaXMudmlldy5hdHRhY2hlZCgpO1xuICAgIH1cbiAgfTtcblxuICBDb250cm9sbGVyLnByb3RvdHlwZS5kZXRhY2hlZCA9IGZ1bmN0aW9uIGRldGFjaGVkKCkge1xuICAgIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcbiAgICAgIHRoaXMuaXNBdHRhY2hlZCA9IGZhbHNlO1xuXG4gICAgICBpZiAodGhpcy52aWV3ICE9PSBudWxsKSB7XG4gICAgICAgIHRoaXMudmlldy5kZXRhY2hlZCgpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5iZWhhdmlvci5oYW5kbGVzRGV0YWNoZWQpIHtcbiAgICAgICAgdGhpcy52aWV3TW9kZWwuZGV0YWNoZWQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIENvbnRyb2xsZXI7XG59KCk7XG5cbnZhciBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIgPSBleHBvcnRzLkJlaGF2aW9yUHJvcGVydHlPYnNlcnZlciA9IChfZGVjOSA9ICgwLCBfYXVyZWxpYUJpbmRpbmcuc3Vic2NyaWJlckNvbGxlY3Rpb24pKCksIF9kZWM5KF9jbGFzczIwID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIodGFza1F1ZXVlLCBvYmosIHByb3BlcnR5TmFtZSwgc2VsZlN1YnNjcmliZXIsIGluaXRpYWxWYWx1ZSkge1xuICAgIFxuXG4gICAgdGhpcy50YXNrUXVldWUgPSB0YXNrUXVldWU7XG4gICAgdGhpcy5vYmogPSBvYmo7XG4gICAgdGhpcy5wcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eU5hbWU7XG4gICAgdGhpcy5ub3RxdWV1ZWQgPSB0cnVlO1xuICAgIHRoaXMucHVibGlzaGluZyA9IGZhbHNlO1xuICAgIHRoaXMuc2VsZlN1YnNjcmliZXIgPSBzZWxmU3Vic2NyaWJlcjtcbiAgICB0aGlzLmN1cnJlbnRWYWx1ZSA9IHRoaXMub2xkVmFsdWUgPSBpbml0aWFsVmFsdWU7XG4gIH1cblxuICBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gZ2V0VmFsdWUoKSB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudFZhbHVlO1xuICB9O1xuXG4gIEJlaGF2aW9yUHJvcGVydHlPYnNlcnZlci5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbiBzZXRWYWx1ZShuZXdWYWx1ZSkge1xuICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMuY3VycmVudFZhbHVlO1xuXG4gICAgaWYgKG9sZFZhbHVlICE9PSBuZXdWYWx1ZSkge1xuICAgICAgaWYgKHRoaXMucHVibGlzaGluZyAmJiB0aGlzLm5vdHF1ZXVlZCkge1xuICAgICAgICB0aGlzLm5vdHF1ZXVlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnRhc2tRdWV1ZS5xdWV1ZU1pY3JvVGFzayh0aGlzKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5vbGRWYWx1ZSA9IG9sZFZhbHVlO1xuICAgICAgdGhpcy5jdXJyZW50VmFsdWUgPSBuZXdWYWx1ZTtcbiAgICB9XG4gIH07XG5cbiAgQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyLnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gY2FsbCgpIHtcbiAgICB2YXIgb2xkVmFsdWUgPSB0aGlzLm9sZFZhbHVlO1xuICAgIHZhciBuZXdWYWx1ZSA9IHRoaXMuY3VycmVudFZhbHVlO1xuXG4gICAgdGhpcy5ub3RxdWV1ZWQgPSB0cnVlO1xuXG4gICAgaWYgKG5ld1ZhbHVlID09PSBvbGRWYWx1ZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnNlbGZTdWJzY3JpYmVyKSB7XG4gICAgICB0aGlzLnNlbGZTdWJzY3JpYmVyKG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gICAgfVxuXG4gICAgdGhpcy5jYWxsU3Vic2NyaWJlcnMobmV3VmFsdWUsIG9sZFZhbHVlKTtcbiAgICB0aGlzLm9sZFZhbHVlID0gbmV3VmFsdWU7XG4gIH07XG5cbiAgQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiBzdWJzY3JpYmUoY29udGV4dCwgY2FsbGFibGUpIHtcbiAgICB0aGlzLmFkZFN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpO1xuICB9O1xuXG4gIEJlaGF2aW9yUHJvcGVydHlPYnNlcnZlci5wcm90b3R5cGUudW5zdWJzY3JpYmUgPSBmdW5jdGlvbiB1bnN1YnNjcmliZShjb250ZXh0LCBjYWxsYWJsZSkge1xuICAgIHRoaXMucmVtb3ZlU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSk7XG4gIH07XG5cbiAgcmV0dXJuIEJlaGF2aW9yUHJvcGVydHlPYnNlcnZlcjtcbn0oKSkgfHwgX2NsYXNzMjApO1xuXG5cbmZ1bmN0aW9uIGdldE9ic2VydmVyKGJlaGF2aW9yLCBpbnN0YW5jZSwgbmFtZSkge1xuICB2YXIgbG9va3VwID0gaW5zdGFuY2UuX19vYnNlcnZlcnNfXztcblxuICBpZiAobG9va3VwID09PSB1bmRlZmluZWQpIHtcbiAgICBpZiAoIWJlaGF2aW9yLmlzSW5pdGlhbGl6ZWQpIHtcbiAgICAgIGJlaGF2aW9yLmluaXRpYWxpemUoX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uLkNvbnRhaW5lci5pbnN0YW5jZSB8fCBuZXcgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uLkNvbnRhaW5lcigpLCBpbnN0YW5jZS5jb25zdHJ1Y3Rvcik7XG4gICAgfVxuXG4gICAgbG9va3VwID0gYmVoYXZpb3Iub2JzZXJ2ZXJMb2NhdG9yLmdldE9yQ3JlYXRlT2JzZXJ2ZXJzTG9va3VwKGluc3RhbmNlKTtcbiAgICBiZWhhdmlvci5fZW5zdXJlUHJvcGVydGllc0RlZmluZWQoaW5zdGFuY2UsIGxvb2t1cCk7XG4gIH1cblxuICByZXR1cm4gbG9va3VwW25hbWVdO1xufVxuXG52YXIgQmluZGFibGVQcm9wZXJ0eSA9IGV4cG9ydHMuQmluZGFibGVQcm9wZXJ0eSA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQmluZGFibGVQcm9wZXJ0eShuYW1lT3JDb25maWcpIHtcbiAgICBcblxuICAgIGlmICh0eXBlb2YgbmFtZU9yQ29uZmlnID09PSAnc3RyaW5nJykge1xuICAgICAgdGhpcy5uYW1lID0gbmFtZU9yQ29uZmlnO1xuICAgIH0gZWxzZSB7XG4gICAgICBPYmplY3QuYXNzaWduKHRoaXMsIG5hbWVPckNvbmZpZyk7XG4gICAgfVxuXG4gICAgdGhpcy5hdHRyaWJ1dGUgPSB0aGlzLmF0dHJpYnV0ZSB8fCBfaHlwaGVuYXRlKHRoaXMubmFtZSk7XG4gICAgaWYgKHRoaXMuZGVmYXVsdEJpbmRpbmdNb2RlID09PSBudWxsIHx8IHRoaXMuZGVmYXVsdEJpbmRpbmdNb2RlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuZGVmYXVsdEJpbmRpbmdNb2RlID0gX2F1cmVsaWFCaW5kaW5nLmJpbmRpbmdNb2RlLm9uZVdheTtcbiAgICB9XG4gICAgdGhpcy5jaGFuZ2VIYW5kbGVyID0gdGhpcy5jaGFuZ2VIYW5kbGVyIHx8IG51bGw7XG4gICAgdGhpcy5vd25lciA9IG51bGw7XG4gICAgdGhpcy5kZXNjcmlwdG9yID0gbnVsbDtcbiAgfVxuXG4gIEJpbmRhYmxlUHJvcGVydHkucHJvdG90eXBlLnJlZ2lzdGVyV2l0aCA9IGZ1bmN0aW9uIHJlZ2lzdGVyV2l0aCh0YXJnZXQsIGJlaGF2aW9yLCBkZXNjcmlwdG9yKSB7XG4gICAgYmVoYXZpb3IucHJvcGVydGllcy5wdXNoKHRoaXMpO1xuICAgIGJlaGF2aW9yLmF0dHJpYnV0ZXNbdGhpcy5hdHRyaWJ1dGVdID0gdGhpcztcbiAgICB0aGlzLm93bmVyID0gYmVoYXZpb3I7XG5cbiAgICBpZiAoZGVzY3JpcHRvcikge1xuICAgICAgdGhpcy5kZXNjcmlwdG9yID0gZGVzY3JpcHRvcjtcbiAgICAgIHJldHVybiB0aGlzLl9jb25maWd1cmVEZXNjcmlwdG9yKGJlaGF2aW9yLCBkZXNjcmlwdG9yKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9O1xuXG4gIEJpbmRhYmxlUHJvcGVydHkucHJvdG90eXBlLl9jb25maWd1cmVEZXNjcmlwdG9yID0gZnVuY3Rpb24gX2NvbmZpZ3VyZURlc2NyaXB0b3IoYmVoYXZpb3IsIGRlc2NyaXB0b3IpIHtcbiAgICB2YXIgbmFtZSA9IHRoaXMubmFtZTtcblxuICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtcbiAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSB0cnVlO1xuXG4gICAgaWYgKCdpbml0aWFsaXplcicgaW4gZGVzY3JpcHRvcikge1xuICAgICAgdGhpcy5kZWZhdWx0VmFsdWUgPSBkZXNjcmlwdG9yLmluaXRpYWxpemVyO1xuICAgICAgZGVsZXRlIGRlc2NyaXB0b3IuaW5pdGlhbGl6ZXI7XG4gICAgICBkZWxldGUgZGVzY3JpcHRvci53cml0YWJsZTtcbiAgICB9XG5cbiAgICBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSB7XG4gICAgICB0aGlzLmRlZmF1bHRWYWx1ZSA9IGRlc2NyaXB0b3IudmFsdWU7XG4gICAgICBkZWxldGUgZGVzY3JpcHRvci52YWx1ZTtcbiAgICAgIGRlbGV0ZSBkZXNjcmlwdG9yLndyaXRhYmxlO1xuICAgIH1cblxuICAgIGRlc2NyaXB0b3IuZ2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIGdldE9ic2VydmVyKGJlaGF2aW9yLCB0aGlzLCBuYW1lKS5nZXRWYWx1ZSgpO1xuICAgIH07XG5cbiAgICBkZXNjcmlwdG9yLnNldCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgZ2V0T2JzZXJ2ZXIoYmVoYXZpb3IsIHRoaXMsIG5hbWUpLnNldFZhbHVlKHZhbHVlKTtcbiAgICB9O1xuXG4gICAgZGVzY3JpcHRvci5nZXQuZ2V0T2JzZXJ2ZXIgPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgICByZXR1cm4gZ2V0T2JzZXJ2ZXIoYmVoYXZpb3IsIG9iaiwgbmFtZSk7XG4gICAgfTtcblxuICAgIHJldHVybiBkZXNjcmlwdG9yO1xuICB9O1xuXG4gIEJpbmRhYmxlUHJvcGVydHkucHJvdG90eXBlLmRlZmluZU9uID0gZnVuY3Rpb24gZGVmaW5lT24odGFyZ2V0LCBiZWhhdmlvcikge1xuICAgIHZhciBuYW1lID0gdGhpcy5uYW1lO1xuICAgIHZhciBoYW5kbGVyTmFtZSA9IHZvaWQgMDtcblxuICAgIGlmICh0aGlzLmNoYW5nZUhhbmRsZXIgPT09IG51bGwpIHtcbiAgICAgIGhhbmRsZXJOYW1lID0gbmFtZSArICdDaGFuZ2VkJztcbiAgICAgIGlmIChoYW5kbGVyTmFtZSBpbiB0YXJnZXQucHJvdG90eXBlKSB7XG4gICAgICAgIHRoaXMuY2hhbmdlSGFuZGxlciA9IGhhbmRsZXJOYW1lO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLmRlc2NyaXB0b3IgPT09IG51bGwpIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQucHJvdG90eXBlLCBuYW1lLCB0aGlzLl9jb25maWd1cmVEZXNjcmlwdG9yKGJlaGF2aW9yLCB7fSkpO1xuICAgIH1cbiAgfTtcblxuICBCaW5kYWJsZVByb3BlcnR5LnByb3RvdHlwZS5jcmVhdGVPYnNlcnZlciA9IGZ1bmN0aW9uIGNyZWF0ZU9ic2VydmVyKHZpZXdNb2RlbCkge1xuICAgIHZhciBzZWxmU3Vic2NyaWJlciA9IG51bGw7XG4gICAgdmFyIGRlZmF1bHRWYWx1ZSA9IHRoaXMuZGVmYXVsdFZhbHVlO1xuICAgIHZhciBjaGFuZ2VIYW5kbGVyTmFtZSA9IHRoaXMuY2hhbmdlSGFuZGxlcjtcbiAgICB2YXIgbmFtZSA9IHRoaXMubmFtZTtcbiAgICB2YXIgaW5pdGlhbFZhbHVlID0gdm9pZCAwO1xuXG4gICAgaWYgKHRoaXMuaGFzT3B0aW9ucykge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBpZiAoY2hhbmdlSGFuZGxlck5hbWUgaW4gdmlld01vZGVsKSB7XG4gICAgICBpZiAoJ3Byb3BlcnR5Q2hhbmdlZCcgaW4gdmlld01vZGVsKSB7XG4gICAgICAgIHNlbGZTdWJzY3JpYmVyID0gZnVuY3Rpb24gc2VsZlN1YnNjcmliZXIobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgdmlld01vZGVsW2NoYW5nZUhhbmRsZXJOYW1lXShuZXdWYWx1ZSwgb2xkVmFsdWUpO1xuICAgICAgICAgIHZpZXdNb2RlbC5wcm9wZXJ0eUNoYW5nZWQobmFtZSwgbmV3VmFsdWUsIG9sZFZhbHVlKTtcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNlbGZTdWJzY3JpYmVyID0gZnVuY3Rpb24gc2VsZlN1YnNjcmliZXIobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgcmV0dXJuIHZpZXdNb2RlbFtjaGFuZ2VIYW5kbGVyTmFtZV0obmV3VmFsdWUsIG9sZFZhbHVlKTtcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCdwcm9wZXJ0eUNoYW5nZWQnIGluIHZpZXdNb2RlbCkge1xuICAgICAgc2VsZlN1YnNjcmliZXIgPSBmdW5jdGlvbiBzZWxmU3Vic2NyaWJlcihuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHZpZXdNb2RlbC5wcm9wZXJ0eUNoYW5nZWQobmFtZSwgbmV3VmFsdWUsIG9sZFZhbHVlKTtcbiAgICAgIH07XG4gICAgfSBlbHNlIGlmIChjaGFuZ2VIYW5kbGVyTmFtZSAhPT0gbnVsbCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDaGFuZ2UgaGFuZGxlciAnICsgY2hhbmdlSGFuZGxlck5hbWUgKyAnIHdhcyBzcGVjaWZpZWQgYnV0IG5vdCBkZWNsYXJlZCBvbiB0aGUgY2xhc3MuJyk7XG4gICAgfVxuXG4gICAgaWYgKGRlZmF1bHRWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBpbml0aWFsVmFsdWUgPSB0eXBlb2YgZGVmYXVsdFZhbHVlID09PSAnZnVuY3Rpb24nID8gZGVmYXVsdFZhbHVlLmNhbGwodmlld01vZGVsKSA6IGRlZmF1bHRWYWx1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IEJlaGF2aW9yUHJvcGVydHlPYnNlcnZlcih0aGlzLm93bmVyLnRhc2tRdWV1ZSwgdmlld01vZGVsLCB0aGlzLm5hbWUsIHNlbGZTdWJzY3JpYmVyLCBpbml0aWFsVmFsdWUpO1xuICB9O1xuXG4gIEJpbmRhYmxlUHJvcGVydHkucHJvdG90eXBlLl9pbml0aWFsaXplID0gZnVuY3Rpb24gX2luaXRpYWxpemUodmlld01vZGVsLCBvYnNlcnZlckxvb2t1cCwgYXR0cmlidXRlcywgYmVoYXZpb3JIYW5kbGVzQmluZCwgYm91bmRQcm9wZXJ0aWVzKSB7XG4gICAgdmFyIHNlbGZTdWJzY3JpYmVyID0gdm9pZCAwO1xuICAgIHZhciBvYnNlcnZlciA9IHZvaWQgMDtcbiAgICB2YXIgYXR0cmlidXRlID0gdm9pZCAwO1xuICAgIHZhciBkZWZhdWx0VmFsdWUgPSB0aGlzLmRlZmF1bHRWYWx1ZTtcblxuICAgIGlmICh0aGlzLmlzRHluYW1pYykge1xuICAgICAgZm9yICh2YXIga2V5IGluIGF0dHJpYnV0ZXMpIHtcbiAgICAgICAgdGhpcy5fY3JlYXRlRHluYW1pY1Byb3BlcnR5KHZpZXdNb2RlbCwgb2JzZXJ2ZXJMb29rdXAsIGJlaGF2aW9ySGFuZGxlc0JpbmQsIGtleSwgYXR0cmlidXRlc1trZXldLCBib3VuZFByb3BlcnRpZXMpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoIXRoaXMuaGFzT3B0aW9ucykge1xuICAgICAgb2JzZXJ2ZXIgPSBvYnNlcnZlckxvb2t1cFt0aGlzLm5hbWVdO1xuXG4gICAgICBpZiAoYXR0cmlidXRlcyAhPT0gbnVsbCkge1xuICAgICAgICBzZWxmU3Vic2NyaWJlciA9IG9ic2VydmVyLnNlbGZTdWJzY3JpYmVyO1xuICAgICAgICBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzW3RoaXMuYXR0cmlidXRlXTtcblxuICAgICAgICBpZiAoYmVoYXZpb3JIYW5kbGVzQmluZCkge1xuICAgICAgICAgIG9ic2VydmVyLnNlbGZTdWJzY3JpYmVyID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0eXBlb2YgYXR0cmlidXRlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgIHZpZXdNb2RlbFt0aGlzLm5hbWVdID0gYXR0cmlidXRlO1xuICAgICAgICAgIG9ic2VydmVyLmNhbGwoKTtcbiAgICAgICAgfSBlbHNlIGlmIChhdHRyaWJ1dGUpIHtcbiAgICAgICAgICBib3VuZFByb3BlcnRpZXMucHVzaCh7IG9ic2VydmVyOiBvYnNlcnZlciwgYmluZGluZzogYXR0cmlidXRlLmNyZWF0ZUJpbmRpbmcodmlld01vZGVsKSB9KTtcbiAgICAgICAgfSBlbHNlIGlmIChkZWZhdWx0VmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIG9ic2VydmVyLmNhbGwoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIG9ic2VydmVyLnNlbGZTdWJzY3JpYmVyID0gc2VsZlN1YnNjcmliZXI7XG4gICAgICB9XG5cbiAgICAgIG9ic2VydmVyLnB1Ymxpc2hpbmcgPSB0cnVlO1xuICAgIH1cbiAgfTtcblxuICBCaW5kYWJsZVByb3BlcnR5LnByb3RvdHlwZS5fY3JlYXRlRHluYW1pY1Byb3BlcnR5ID0gZnVuY3Rpb24gX2NyZWF0ZUR5bmFtaWNQcm9wZXJ0eSh2aWV3TW9kZWwsIG9ic2VydmVyTG9va3VwLCBiZWhhdmlvckhhbmRsZXNCaW5kLCBuYW1lLCBhdHRyaWJ1dGUsIGJvdW5kUHJvcGVydGllcykge1xuICAgIHZhciBjaGFuZ2VIYW5kbGVyTmFtZSA9IG5hbWUgKyAnQ2hhbmdlZCc7XG4gICAgdmFyIHNlbGZTdWJzY3JpYmVyID0gbnVsbDtcbiAgICB2YXIgb2JzZXJ2ZXIgPSB2b2lkIDA7XG4gICAgdmFyIGluZm8gPSB2b2lkIDA7XG5cbiAgICBpZiAoY2hhbmdlSGFuZGxlck5hbWUgaW4gdmlld01vZGVsKSB7XG4gICAgICBpZiAoJ3Byb3BlcnR5Q2hhbmdlZCcgaW4gdmlld01vZGVsKSB7XG4gICAgICAgIHNlbGZTdWJzY3JpYmVyID0gZnVuY3Rpb24gc2VsZlN1YnNjcmliZXIobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgdmlld01vZGVsW2NoYW5nZUhhbmRsZXJOYW1lXShuZXdWYWx1ZSwgb2xkVmFsdWUpO1xuICAgICAgICAgIHZpZXdNb2RlbC5wcm9wZXJ0eUNoYW5nZWQobmFtZSwgbmV3VmFsdWUsIG9sZFZhbHVlKTtcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNlbGZTdWJzY3JpYmVyID0gZnVuY3Rpb24gc2VsZlN1YnNjcmliZXIobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgcmV0dXJuIHZpZXdNb2RlbFtjaGFuZ2VIYW5kbGVyTmFtZV0obmV3VmFsdWUsIG9sZFZhbHVlKTtcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCdwcm9wZXJ0eUNoYW5nZWQnIGluIHZpZXdNb2RlbCkge1xuICAgICAgc2VsZlN1YnNjcmliZXIgPSBmdW5jdGlvbiBzZWxmU3Vic2NyaWJlcihuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHZpZXdNb2RlbC5wcm9wZXJ0eUNoYW5nZWQobmFtZSwgbmV3VmFsdWUsIG9sZFZhbHVlKTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgb2JzZXJ2ZXIgPSBvYnNlcnZlckxvb2t1cFtuYW1lXSA9IG5ldyBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIodGhpcy5vd25lci50YXNrUXVldWUsIHZpZXdNb2RlbCwgbmFtZSwgc2VsZlN1YnNjcmliZXIpO1xuXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHZpZXdNb2RlbCwgbmFtZSwge1xuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgIGdldDogb2JzZXJ2ZXIuZ2V0VmFsdWUuYmluZChvYnNlcnZlciksXG4gICAgICBzZXQ6IG9ic2VydmVyLnNldFZhbHVlLmJpbmQob2JzZXJ2ZXIpXG4gICAgfSk7XG5cbiAgICBpZiAoYmVoYXZpb3JIYW5kbGVzQmluZCkge1xuICAgICAgb2JzZXJ2ZXIuc2VsZlN1YnNjcmliZXIgPSBudWxsO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgYXR0cmlidXRlID09PSAnc3RyaW5nJykge1xuICAgICAgdmlld01vZGVsW25hbWVdID0gYXR0cmlidXRlO1xuICAgICAgb2JzZXJ2ZXIuY2FsbCgpO1xuICAgIH0gZWxzZSBpZiAoYXR0cmlidXRlKSB7XG4gICAgICBpbmZvID0geyBvYnNlcnZlcjogb2JzZXJ2ZXIsIGJpbmRpbmc6IGF0dHJpYnV0ZS5jcmVhdGVCaW5kaW5nKHZpZXdNb2RlbCkgfTtcbiAgICAgIGJvdW5kUHJvcGVydGllcy5wdXNoKGluZm8pO1xuICAgIH1cblxuICAgIG9ic2VydmVyLnB1Ymxpc2hpbmcgPSB0cnVlO1xuICAgIG9ic2VydmVyLnNlbGZTdWJzY3JpYmVyID0gc2VsZlN1YnNjcmliZXI7XG4gIH07XG5cbiAgcmV0dXJuIEJpbmRhYmxlUHJvcGVydHk7XG59KCk7XG5cbnZhciBsYXN0UHJvdmlkZXJJZCA9IDA7XG5cbmZ1bmN0aW9uIG5leHRQcm92aWRlcklkKCkge1xuICByZXR1cm4gKytsYXN0UHJvdmlkZXJJZDtcbn1cblxuZnVuY3Rpb24gZG9Qcm9jZXNzQ29udGVudCgpIHtcbiAgcmV0dXJuIHRydWU7XG59XG5mdW5jdGlvbiBkb1Byb2Nlc3NBdHRyaWJ1dGVzKCkge31cblxudmFyIEh0bWxCZWhhdmlvclJlc291cmNlID0gZXhwb3J0cy5IdG1sQmVoYXZpb3JSZXNvdXJjZSA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gSHRtbEJlaGF2aW9yUmVzb3VyY2UoKSB7XG4gICAgXG5cbiAgICB0aGlzLmVsZW1lbnROYW1lID0gbnVsbDtcbiAgICB0aGlzLmF0dHJpYnV0ZU5hbWUgPSBudWxsO1xuICAgIHRoaXMuYXR0cmlidXRlRGVmYXVsdEJpbmRpbmdNb2RlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubGlmdHNDb250ZW50ID0gZmFsc2U7XG4gICAgdGhpcy50YXJnZXRTaGFkb3dET00gPSBmYWxzZTtcbiAgICB0aGlzLnNoYWRvd0RPTU9wdGlvbnMgPSBudWxsO1xuICAgIHRoaXMucHJvY2Vzc0F0dHJpYnV0ZXMgPSBkb1Byb2Nlc3NBdHRyaWJ1dGVzO1xuICAgIHRoaXMucHJvY2Vzc0NvbnRlbnQgPSBkb1Byb2Nlc3NDb250ZW50O1xuICAgIHRoaXMudXNlc1NoYWRvd0RPTSA9IGZhbHNlO1xuICAgIHRoaXMuY2hpbGRCaW5kaW5ncyA9IG51bGw7XG4gICAgdGhpcy5oYXNEeW5hbWljT3B0aW9ucyA9IGZhbHNlO1xuICAgIHRoaXMuY29udGFpbmVybGVzcyA9IGZhbHNlO1xuICAgIHRoaXMucHJvcGVydGllcyA9IFtdO1xuICAgIHRoaXMuYXR0cmlidXRlcyA9IHt9O1xuICAgIHRoaXMuaXNJbml0aWFsaXplZCA9IGZhbHNlO1xuICB9XG5cbiAgSHRtbEJlaGF2aW9yUmVzb3VyY2UuY29udmVudGlvbiA9IGZ1bmN0aW9uIGNvbnZlbnRpb24obmFtZSwgZXhpc3RpbmcpIHtcbiAgICB2YXIgYmVoYXZpb3IgPSB2b2lkIDA7XG5cbiAgICBpZiAobmFtZS5lbmRzV2l0aCgnQ3VzdG9tQXR0cmlidXRlJykpIHtcbiAgICAgIGJlaGF2aW9yID0gZXhpc3RpbmcgfHwgbmV3IEh0bWxCZWhhdmlvclJlc291cmNlKCk7XG4gICAgICBiZWhhdmlvci5hdHRyaWJ1dGVOYW1lID0gX2h5cGhlbmF0ZShuYW1lLnN1YnN0cmluZygwLCBuYW1lLmxlbmd0aCAtIDE1KSk7XG4gICAgfVxuXG4gICAgaWYgKG5hbWUuZW5kc1dpdGgoJ0N1c3RvbUVsZW1lbnQnKSkge1xuICAgICAgYmVoYXZpb3IgPSBleGlzdGluZyB8fCBuZXcgSHRtbEJlaGF2aW9yUmVzb3VyY2UoKTtcbiAgICAgIGJlaGF2aW9yLmVsZW1lbnROYW1lID0gX2h5cGhlbmF0ZShuYW1lLnN1YnN0cmluZygwLCBuYW1lLmxlbmd0aCAtIDEzKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGJlaGF2aW9yO1xuICB9O1xuXG4gIEh0bWxCZWhhdmlvclJlc291cmNlLnByb3RvdHlwZS5hZGRDaGlsZEJpbmRpbmcgPSBmdW5jdGlvbiBhZGRDaGlsZEJpbmRpbmcoYmVoYXZpb3IpIHtcbiAgICBpZiAodGhpcy5jaGlsZEJpbmRpbmdzID09PSBudWxsKSB7XG4gICAgICB0aGlzLmNoaWxkQmluZGluZ3MgPSBbXTtcbiAgICB9XG5cbiAgICB0aGlzLmNoaWxkQmluZGluZ3MucHVzaChiZWhhdmlvcik7XG4gIH07XG5cbiAgSHRtbEJlaGF2aW9yUmVzb3VyY2UucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiBpbml0aWFsaXplKGNvbnRhaW5lciwgdGFyZ2V0KSB7XG4gICAgdmFyIHByb3RvID0gdGFyZ2V0LnByb3RvdHlwZTtcbiAgICB2YXIgcHJvcGVydGllcyA9IHRoaXMucHJvcGVydGllcztcbiAgICB2YXIgYXR0cmlidXRlTmFtZSA9IHRoaXMuYXR0cmlidXRlTmFtZTtcbiAgICB2YXIgYXR0cmlidXRlRGVmYXVsdEJpbmRpbmdNb2RlID0gdGhpcy5hdHRyaWJ1dGVEZWZhdWx0QmluZGluZ01vZGU7XG4gICAgdmFyIGkgPSB2b2lkIDA7XG4gICAgdmFyIGlpID0gdm9pZCAwO1xuICAgIHZhciBjdXJyZW50ID0gdm9pZCAwO1xuXG4gICAgaWYgKHRoaXMuaXNJbml0aWFsaXplZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuaXNJbml0aWFsaXplZCA9IHRydWU7XG4gICAgdGFyZ2V0Ll9fcHJvdmlkZXJJZF9fID0gbmV4dFByb3ZpZGVySWQoKTtcblxuICAgIHRoaXMub2JzZXJ2ZXJMb2NhdG9yID0gY29udGFpbmVyLmdldChfYXVyZWxpYUJpbmRpbmcuT2JzZXJ2ZXJMb2NhdG9yKTtcbiAgICB0aGlzLnRhc2tRdWV1ZSA9IGNvbnRhaW5lci5nZXQoX2F1cmVsaWFUYXNrUXVldWUuVGFza1F1ZXVlKTtcblxuICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xuICAgIHRoaXMudXNlc1NoYWRvd0RPTSA9IHRoaXMudGFyZ2V0U2hhZG93RE9NICYmIF9hdXJlbGlhUGFsLkZFQVRVUkUuc2hhZG93RE9NO1xuICAgIHRoaXMuaGFuZGxlc0NyZWF0ZWQgPSAnY3JlYXRlZCcgaW4gcHJvdG87XG4gICAgdGhpcy5oYW5kbGVzQmluZCA9ICdiaW5kJyBpbiBwcm90bztcbiAgICB0aGlzLmhhbmRsZXNVbmJpbmQgPSAndW5iaW5kJyBpbiBwcm90bztcbiAgICB0aGlzLmhhbmRsZXNBdHRhY2hlZCA9ICdhdHRhY2hlZCcgaW4gcHJvdG87XG4gICAgdGhpcy5oYW5kbGVzRGV0YWNoZWQgPSAnZGV0YWNoZWQnIGluIHByb3RvO1xuICAgIHRoaXMuaHRtbE5hbWUgPSB0aGlzLmVsZW1lbnROYW1lIHx8IHRoaXMuYXR0cmlidXRlTmFtZTtcblxuICAgIGlmIChhdHRyaWJ1dGVOYW1lICE9PSBudWxsKSB7XG4gICAgICBpZiAocHJvcGVydGllcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgbmV3IEJpbmRhYmxlUHJvcGVydHkoe1xuICAgICAgICAgIG5hbWU6ICd2YWx1ZScsXG4gICAgICAgICAgY2hhbmdlSGFuZGxlcjogJ3ZhbHVlQ2hhbmdlZCcgaW4gcHJvdG8gPyAndmFsdWVDaGFuZ2VkJyA6IG51bGwsXG4gICAgICAgICAgYXR0cmlidXRlOiBhdHRyaWJ1dGVOYW1lLFxuICAgICAgICAgIGRlZmF1bHRCaW5kaW5nTW9kZTogYXR0cmlidXRlRGVmYXVsdEJpbmRpbmdNb2RlXG4gICAgICAgIH0pLnJlZ2lzdGVyV2l0aCh0YXJnZXQsIHRoaXMpO1xuICAgICAgfVxuXG4gICAgICBjdXJyZW50ID0gcHJvcGVydGllc1swXTtcblxuICAgICAgaWYgKHByb3BlcnRpZXMubGVuZ3RoID09PSAxICYmIGN1cnJlbnQubmFtZSA9PT0gJ3ZhbHVlJykge1xuICAgICAgICBjdXJyZW50LmlzRHluYW1pYyA9IGN1cnJlbnQuaGFzT3B0aW9ucyA9IHRoaXMuaGFzRHluYW1pY09wdGlvbnM7XG4gICAgICAgIGN1cnJlbnQuZGVmaW5lT24odGFyZ2V0LCB0aGlzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZvciAoaSA9IDAsIGlpID0gcHJvcGVydGllcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgICAgcHJvcGVydGllc1tpXS5kZWZpbmVPbih0YXJnZXQsIHRoaXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgY3VycmVudCA9IG5ldyBCaW5kYWJsZVByb3BlcnR5KHtcbiAgICAgICAgICBuYW1lOiAndmFsdWUnLFxuICAgICAgICAgIGNoYW5nZUhhbmRsZXI6ICd2YWx1ZUNoYW5nZWQnIGluIHByb3RvID8gJ3ZhbHVlQ2hhbmdlZCcgOiBudWxsLFxuICAgICAgICAgIGF0dHJpYnV0ZTogYXR0cmlidXRlTmFtZSxcbiAgICAgICAgICBkZWZhdWx0QmluZGluZ01vZGU6IGF0dHJpYnV0ZURlZmF1bHRCaW5kaW5nTW9kZVxuICAgICAgICB9KTtcblxuICAgICAgICBjdXJyZW50Lmhhc09wdGlvbnMgPSB0cnVlO1xuICAgICAgICBjdXJyZW50LnJlZ2lzdGVyV2l0aCh0YXJnZXQsIHRoaXMpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBmb3IgKGkgPSAwLCBpaSA9IHByb3BlcnRpZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgICBwcm9wZXJ0aWVzW2ldLmRlZmluZU9uKHRhcmdldCwgdGhpcyk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIEh0bWxCZWhhdmlvclJlc291cmNlLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIHJlZ2lzdGVyKHJlZ2lzdHJ5LCBuYW1lKSB7XG4gICAgaWYgKHRoaXMuYXR0cmlidXRlTmFtZSAhPT0gbnVsbCkge1xuICAgICAgcmVnaXN0cnkucmVnaXN0ZXJBdHRyaWJ1dGUobmFtZSB8fCB0aGlzLmF0dHJpYnV0ZU5hbWUsIHRoaXMsIHRoaXMuYXR0cmlidXRlTmFtZSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZWxlbWVudE5hbWUgIT09IG51bGwpIHtcbiAgICAgIHJlZ2lzdHJ5LnJlZ2lzdGVyRWxlbWVudChuYW1lIHx8IHRoaXMuZWxlbWVudE5hbWUsIHRoaXMpO1xuICAgIH1cbiAgfTtcblxuICBIdG1sQmVoYXZpb3JSZXNvdXJjZS5wcm90b3R5cGUubG9hZCA9IGZ1bmN0aW9uIGxvYWQoY29udGFpbmVyLCB0YXJnZXQsIGxvYWRDb250ZXh0LCB2aWV3U3RyYXRlZ3ksIHRyYW5zaWVudFZpZXcpIHtcbiAgICB2YXIgX3RoaXMxMyA9IHRoaXM7XG5cbiAgICB2YXIgb3B0aW9ucyA9IHZvaWQgMDtcblxuICAgIGlmICh0aGlzLmVsZW1lbnROYW1lICE9PSBudWxsKSB7XG4gICAgICB2aWV3U3RyYXRlZ3kgPSBjb250YWluZXIuZ2V0KFZpZXdMb2NhdG9yKS5nZXRWaWV3U3RyYXRlZ3kodmlld1N0cmF0ZWd5IHx8IHRoaXMudmlld1N0cmF0ZWd5IHx8IHRhcmdldCk7XG4gICAgICBvcHRpb25zID0gbmV3IFZpZXdDb21waWxlSW5zdHJ1Y3Rpb24odGhpcy50YXJnZXRTaGFkb3dET00sIHRydWUpO1xuXG4gICAgICBpZiAoIXZpZXdTdHJhdGVneS5tb2R1bGVJZCkge1xuICAgICAgICB2aWV3U3RyYXRlZ3kubW9kdWxlSWQgPSBfYXVyZWxpYU1ldGFkYXRhLk9yaWdpbi5nZXQodGFyZ2V0KS5tb2R1bGVJZDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHZpZXdTdHJhdGVneS5sb2FkVmlld0ZhY3RvcnkoY29udGFpbmVyLmdldChWaWV3RW5naW5lKSwgb3B0aW9ucywgbG9hZENvbnRleHQpLnRoZW4oZnVuY3Rpb24gKHZpZXdGYWN0b3J5KSB7XG4gICAgICAgIGlmICghdHJhbnNpZW50VmlldyB8fCAhX3RoaXMxMy52aWV3RmFjdG9yeSkge1xuICAgICAgICAgIF90aGlzMTMudmlld0ZhY3RvcnkgPSB2aWV3RmFjdG9yeTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB2aWV3RmFjdG9yeTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcyk7XG4gIH07XG5cbiAgSHRtbEJlaGF2aW9yUmVzb3VyY2UucHJvdG90eXBlLmNvbXBpbGUgPSBmdW5jdGlvbiBjb21waWxlKGNvbXBpbGVyLCByZXNvdXJjZXMsIG5vZGUsIGluc3RydWN0aW9uLCBwYXJlbnROb2RlKSB7XG4gICAgaWYgKHRoaXMubGlmdHNDb250ZW50KSB7XG4gICAgICBpZiAoIWluc3RydWN0aW9uLnZpZXdGYWN0b3J5KSB7XG4gICAgICAgIHZhciB0ZW1wbGF0ZSA9IF9hdXJlbGlhUGFsLkRPTS5jcmVhdGVFbGVtZW50KCd0ZW1wbGF0ZScpO1xuICAgICAgICB2YXIgZnJhZ21lbnQgPSBfYXVyZWxpYVBhbC5ET00uY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgICAgICB2YXIgY2FjaGVTaXplID0gbm9kZS5nZXRBdHRyaWJ1dGUoJ3ZpZXctY2FjaGUnKTtcbiAgICAgICAgdmFyIHBhcnQgPSBub2RlLmdldEF0dHJpYnV0ZSgncGFydCcpO1xuXG4gICAgICAgIG5vZGUucmVtb3ZlQXR0cmlidXRlKGluc3RydWN0aW9uLm9yaWdpbmFsQXR0ck5hbWUpO1xuICAgICAgICBfYXVyZWxpYVBhbC5ET00ucmVwbGFjZU5vZGUodGVtcGxhdGUsIG5vZGUsIHBhcmVudE5vZGUpO1xuICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChub2RlKTtcbiAgICAgICAgaW5zdHJ1Y3Rpb24udmlld0ZhY3RvcnkgPSBjb21waWxlci5jb21waWxlKGZyYWdtZW50LCByZXNvdXJjZXMpO1xuXG4gICAgICAgIGlmIChwYXJ0KSB7XG4gICAgICAgICAgaW5zdHJ1Y3Rpb24udmlld0ZhY3RvcnkucGFydCA9IHBhcnQ7XG4gICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoJ3BhcnQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjYWNoZVNpemUpIHtcbiAgICAgICAgICBpbnN0cnVjdGlvbi52aWV3RmFjdG9yeS5zZXRDYWNoZVNpemUoY2FjaGVTaXplKTtcbiAgICAgICAgICBub2RlLnJlbW92ZUF0dHJpYnV0ZSgndmlldy1jYWNoZScpO1xuICAgICAgICB9XG5cbiAgICAgICAgbm9kZSA9IHRlbXBsYXRlO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodGhpcy5lbGVtZW50TmFtZSAhPT0gbnVsbCkge1xuICAgICAgdmFyIF9wYXJ0UmVwbGFjZW1lbnRzMiA9IHt9O1xuXG4gICAgICBpZiAodGhpcy5wcm9jZXNzQ29udGVudChjb21waWxlciwgcmVzb3VyY2VzLCBub2RlLCBpbnN0cnVjdGlvbikgJiYgbm9kZS5oYXNDaGlsZE5vZGVzKCkpIHtcbiAgICAgICAgdmFyIGN1cnJlbnRDaGlsZCA9IG5vZGUuZmlyc3RDaGlsZDtcbiAgICAgICAgdmFyIGNvbnRlbnRFbGVtZW50ID0gdGhpcy51c2VzU2hhZG93RE9NID8gbnVsbCA6IF9hdXJlbGlhUGFsLkRPTS5jcmVhdGVFbGVtZW50KCdhdS1jb250ZW50Jyk7XG4gICAgICAgIHZhciBuZXh0U2libGluZyA9IHZvaWQgMDtcbiAgICAgICAgdmFyIHRvUmVwbGFjZSA9IHZvaWQgMDtcblxuICAgICAgICB3aGlsZSAoY3VycmVudENoaWxkKSB7XG4gICAgICAgICAgbmV4dFNpYmxpbmcgPSBjdXJyZW50Q2hpbGQubmV4dFNpYmxpbmc7XG5cbiAgICAgICAgICBpZiAoY3VycmVudENoaWxkLnRhZ05hbWUgPT09ICdURU1QTEFURScgJiYgKHRvUmVwbGFjZSA9IGN1cnJlbnRDaGlsZC5nZXRBdHRyaWJ1dGUoJ3JlcGxhY2UtcGFydCcpKSkge1xuICAgICAgICAgICAgX3BhcnRSZXBsYWNlbWVudHMyW3RvUmVwbGFjZV0gPSBjb21waWxlci5jb21waWxlKGN1cnJlbnRDaGlsZCwgcmVzb3VyY2VzKTtcbiAgICAgICAgICAgIF9hdXJlbGlhUGFsLkRPTS5yZW1vdmVOb2RlKGN1cnJlbnRDaGlsZCwgcGFyZW50Tm9kZSk7XG4gICAgICAgICAgICBpbnN0cnVjdGlvbi5wYXJ0UmVwbGFjZW1lbnRzID0gX3BhcnRSZXBsYWNlbWVudHMyO1xuICAgICAgICAgIH0gZWxzZSBpZiAoY29udGVudEVsZW1lbnQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGlmIChjdXJyZW50Q2hpbGQubm9kZVR5cGUgPT09IDMgJiYgX2lzQWxsV2hpdGVzcGFjZShjdXJyZW50Q2hpbGQpKSB7XG4gICAgICAgICAgICAgIF9hdXJlbGlhUGFsLkRPTS5yZW1vdmVOb2RlKGN1cnJlbnRDaGlsZCwgcGFyZW50Tm9kZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjb250ZW50RWxlbWVudC5hcHBlbmRDaGlsZChjdXJyZW50Q2hpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGN1cnJlbnRDaGlsZCA9IG5leHRTaWJsaW5nO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbnRlbnRFbGVtZW50ICE9PSBudWxsICYmIGNvbnRlbnRFbGVtZW50Lmhhc0NoaWxkTm9kZXMoKSkge1xuICAgICAgICAgIG5vZGUuYXBwZW5kQ2hpbGQoY29udGVudEVsZW1lbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaW5zdHJ1Y3Rpb24uc2tpcENvbnRlbnRQcm9jZXNzaW5nID0gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpbnN0cnVjdGlvbi5za2lwQ29udGVudFByb2Nlc3NpbmcgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBub2RlO1xuICB9O1xuXG4gIEh0bWxCZWhhdmlvclJlc291cmNlLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbiBjcmVhdGUoY29udGFpbmVyLCBpbnN0cnVjdGlvbiwgZWxlbWVudCwgYmluZGluZ3MpIHtcbiAgICB2YXIgdmlld0hvc3QgPSB2b2lkIDA7XG4gICAgdmFyIGF1ID0gbnVsbDtcblxuICAgIGluc3RydWN0aW9uID0gaW5zdHJ1Y3Rpb24gfHwgQmVoYXZpb3JJbnN0cnVjdGlvbi5ub3JtYWw7XG4gICAgZWxlbWVudCA9IGVsZW1lbnQgfHwgbnVsbDtcbiAgICBiaW5kaW5ncyA9IGJpbmRpbmdzIHx8IG51bGw7XG5cbiAgICBpZiAodGhpcy5lbGVtZW50TmFtZSAhPT0gbnVsbCAmJiBlbGVtZW50KSB7XG4gICAgICBpZiAodGhpcy51c2VzU2hhZG93RE9NKSB7XG4gICAgICAgIHZpZXdIb3N0ID0gZWxlbWVudC5hdHRhY2hTaGFkb3codGhpcy5zaGFkb3dET01PcHRpb25zKTtcbiAgICAgICAgY29udGFpbmVyLnJlZ2lzdGVySW5zdGFuY2UoX2F1cmVsaWFQYWwuRE9NLmJvdW5kYXJ5LCB2aWV3SG9zdCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2aWV3SG9zdCA9IGVsZW1lbnQ7XG4gICAgICAgIGlmICh0aGlzLnRhcmdldFNoYWRvd0RPTSkge1xuICAgICAgICAgIGNvbnRhaW5lci5yZWdpc3Rlckluc3RhbmNlKF9hdXJlbGlhUGFsLkRPTS5ib3VuZGFyeSwgdmlld0hvc3QpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGVsZW1lbnQgIT09IG51bGwpIHtcbiAgICAgIGVsZW1lbnQuYXUgPSBhdSA9IGVsZW1lbnQuYXUgfHwge307XG4gICAgfVxuXG4gICAgdmFyIHZpZXdNb2RlbCA9IGluc3RydWN0aW9uLnZpZXdNb2RlbCB8fCBjb250YWluZXIuZ2V0KHRoaXMudGFyZ2V0KTtcbiAgICB2YXIgY29udHJvbGxlciA9IG5ldyBDb250cm9sbGVyKHRoaXMsIGluc3RydWN0aW9uLCB2aWV3TW9kZWwsIGNvbnRhaW5lci5lbGVtZW50RXZlbnRzKTtcbiAgICB2YXIgY2hpbGRCaW5kaW5ncyA9IHRoaXMuY2hpbGRCaW5kaW5ncztcbiAgICB2YXIgdmlld0ZhY3RvcnkgPSB2b2lkIDA7XG5cbiAgICBpZiAodGhpcy5saWZ0c0NvbnRlbnQpIHtcbiAgICAgIGF1LmNvbnRyb2xsZXIgPSBjb250cm9sbGVyO1xuICAgIH0gZWxzZSBpZiAodGhpcy5lbGVtZW50TmFtZSAhPT0gbnVsbCkge1xuICAgICAgdmlld0ZhY3RvcnkgPSBpbnN0cnVjdGlvbi52aWV3RmFjdG9yeSB8fCB0aGlzLnZpZXdGYWN0b3J5O1xuICAgICAgY29udGFpbmVyLnZpZXdNb2RlbCA9IHZpZXdNb2RlbDtcblxuICAgICAgaWYgKHZpZXdGYWN0b3J5KSB7XG4gICAgICAgIGNvbnRyb2xsZXIudmlldyA9IHZpZXdGYWN0b3J5LmNyZWF0ZShjb250YWluZXIsIGluc3RydWN0aW9uLCBlbGVtZW50KTtcbiAgICAgIH1cblxuICAgICAgaWYgKGVsZW1lbnQgIT09IG51bGwpIHtcbiAgICAgICAgYXUuY29udHJvbGxlciA9IGNvbnRyb2xsZXI7XG5cbiAgICAgICAgaWYgKGNvbnRyb2xsZXIudmlldykge1xuICAgICAgICAgIGlmICghdGhpcy51c2VzU2hhZG93RE9NICYmIChlbGVtZW50LmNoaWxkTm9kZXMubGVuZ3RoID09PSAxIHx8IGVsZW1lbnQuY29udGVudEVsZW1lbnQpKSB7XG4gICAgICAgICAgICB2YXIgY29udGVudEVsZW1lbnQgPSBlbGVtZW50LmNoaWxkTm9kZXNbMF0gfHwgZWxlbWVudC5jb250ZW50RWxlbWVudDtcbiAgICAgICAgICAgIGNvbnRyb2xsZXIudmlldy5jb250ZW50VmlldyA9IHsgZnJhZ21lbnQ6IGNvbnRlbnRFbGVtZW50IH07XG4gICAgICAgICAgICBjb250ZW50RWxlbWVudC5wYXJlbnROb2RlICYmIF9hdXJlbGlhUGFsLkRPTS5yZW1vdmVOb2RlKGNvbnRlbnRFbGVtZW50KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoaW5zdHJ1Y3Rpb24uYW5jaG9ySXNDb250YWluZXIpIHtcbiAgICAgICAgICAgIGlmIChjaGlsZEJpbmRpbmdzICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGNoaWxkQmluZGluZ3MubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXIudmlldy5hZGRCaW5kaW5nKGNoaWxkQmluZGluZ3NbaV0uY3JlYXRlKGVsZW1lbnQsIHZpZXdNb2RlbCwgY29udHJvbGxlcikpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnRyb2xsZXIudmlldy5hcHBlbmROb2Rlc1RvKHZpZXdIb3N0KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29udHJvbGxlci52aWV3Lmluc2VydE5vZGVzQmVmb3JlKHZpZXdIb3N0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoY2hpbGRCaW5kaW5ncyAhPT0gbnVsbCkge1xuICAgICAgICAgIGZvciAodmFyIF9pMiA9IDAsIF9paTIgPSBjaGlsZEJpbmRpbmdzLmxlbmd0aDsgX2kyIDwgX2lpMjsgKytfaTIpIHtcbiAgICAgICAgICAgIGJpbmRpbmdzLnB1c2goY2hpbGRCaW5kaW5nc1tfaTJdLmNyZWF0ZShlbGVtZW50LCB2aWV3TW9kZWwsIGNvbnRyb2xsZXIpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoY29udHJvbGxlci52aWV3KSB7XG4gICAgICAgIGNvbnRyb2xsZXIudmlldy5jb250cm9sbGVyID0gY29udHJvbGxlcjtcblxuICAgICAgICBpZiAoY2hpbGRCaW5kaW5ncyAhPT0gbnVsbCkge1xuICAgICAgICAgIGZvciAodmFyIF9pMyA9IDAsIF9paTMgPSBjaGlsZEJpbmRpbmdzLmxlbmd0aDsgX2kzIDwgX2lpMzsgKytfaTMpIHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXIudmlldy5hZGRCaW5kaW5nKGNoaWxkQmluZGluZ3NbX2kzXS5jcmVhdGUoaW5zdHJ1Y3Rpb24uaG9zdCwgdmlld01vZGVsLCBjb250cm9sbGVyKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGNoaWxkQmluZGluZ3MgIT09IG51bGwpIHtcbiAgICAgICAgZm9yICh2YXIgX2k0ID0gMCwgX2lpNCA9IGNoaWxkQmluZGluZ3MubGVuZ3RoOyBfaTQgPCBfaWk0OyArK19pNCkge1xuICAgICAgICAgIGJpbmRpbmdzLnB1c2goY2hpbGRCaW5kaW5nc1tfaTRdLmNyZWF0ZShpbnN0cnVjdGlvbi5ob3N0LCB2aWV3TW9kZWwsIGNvbnRyb2xsZXIpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoY2hpbGRCaW5kaW5ncyAhPT0gbnVsbCkge1xuICAgICAgZm9yICh2YXIgX2k1ID0gMCwgX2lpNSA9IGNoaWxkQmluZGluZ3MubGVuZ3RoOyBfaTUgPCBfaWk1OyArK19pNSkge1xuICAgICAgICBiaW5kaW5ncy5wdXNoKGNoaWxkQmluZGluZ3NbX2k1XS5jcmVhdGUoZWxlbWVudCwgdmlld01vZGVsLCBjb250cm9sbGVyKSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGF1ICE9PSBudWxsKSB7XG4gICAgICBhdVt0aGlzLmh0bWxOYW1lXSA9IGNvbnRyb2xsZXI7XG4gICAgfVxuXG4gICAgaWYgKGluc3RydWN0aW9uLmluaXRpYXRlZEJ5QmVoYXZpb3IgJiYgdmlld0ZhY3RvcnkpIHtcbiAgICAgIGNvbnRyb2xsZXIudmlldy5jcmVhdGVkKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNvbnRyb2xsZXI7XG4gIH07XG5cbiAgSHRtbEJlaGF2aW9yUmVzb3VyY2UucHJvdG90eXBlLl9lbnN1cmVQcm9wZXJ0aWVzRGVmaW5lZCA9IGZ1bmN0aW9uIF9lbnN1cmVQcm9wZXJ0aWVzRGVmaW5lZChpbnN0YW5jZSwgbG9va3VwKSB7XG4gICAgdmFyIHByb3BlcnRpZXMgPSB2b2lkIDA7XG4gICAgdmFyIGkgPSB2b2lkIDA7XG4gICAgdmFyIGlpID0gdm9pZCAwO1xuICAgIHZhciBvYnNlcnZlciA9IHZvaWQgMDtcblxuICAgIGlmICgnX19wcm9wZXJ0aWVzRGVmaW5lZF9fJyBpbiBsb29rdXApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsb29rdXAuX19wcm9wZXJ0aWVzRGVmaW5lZF9fID0gdHJ1ZTtcbiAgICBwcm9wZXJ0aWVzID0gdGhpcy5wcm9wZXJ0aWVzO1xuXG4gICAgZm9yIChpID0gMCwgaWkgPSBwcm9wZXJ0aWVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgIG9ic2VydmVyID0gcHJvcGVydGllc1tpXS5jcmVhdGVPYnNlcnZlcihpbnN0YW5jZSk7XG5cbiAgICAgIGlmIChvYnNlcnZlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGxvb2t1cFtvYnNlcnZlci5wcm9wZXJ0eU5hbWVdID0gb2JzZXJ2ZXI7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBIdG1sQmVoYXZpb3JSZXNvdXJjZTtcbn0oKTtcblxuZnVuY3Rpb24gY3JlYXRlQ2hpbGRPYnNlcnZlckRlY29yYXRvcihzZWxlY3Rvck9yQ29uZmlnLCBhbGwpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIGtleSwgZGVzY3JpcHRvcikge1xuICAgIHZhciBhY3R1YWxUYXJnZXQgPSB0eXBlb2Yga2V5ID09PSAnc3RyaW5nJyA/IHRhcmdldC5jb25zdHJ1Y3RvciA6IHRhcmdldDtcbiAgICB2YXIgciA9IF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEuZ2V0T3JDcmVhdGVPd24oX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIGFjdHVhbFRhcmdldCk7XG5cbiAgICBpZiAodHlwZW9mIHNlbGVjdG9yT3JDb25maWcgPT09ICdzdHJpbmcnKSB7XG4gICAgICBzZWxlY3Rvck9yQ29uZmlnID0ge1xuICAgICAgICBzZWxlY3Rvcjogc2VsZWN0b3JPckNvbmZpZyxcbiAgICAgICAgbmFtZToga2V5XG4gICAgICB9O1xuICAgIH1cblxuICAgIGlmIChkZXNjcmlwdG9yKSB7XG4gICAgICBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBzZWxlY3Rvck9yQ29uZmlnLmFsbCA9IGFsbDtcbiAgICByLmFkZENoaWxkQmluZGluZyhuZXcgQ2hpbGRPYnNlcnZlcihzZWxlY3Rvck9yQ29uZmlnKSk7XG4gIH07XG59XG5cbmZ1bmN0aW9uIGNoaWxkcmVuKHNlbGVjdG9yT3JDb25maWcpIHtcbiAgcmV0dXJuIGNyZWF0ZUNoaWxkT2JzZXJ2ZXJEZWNvcmF0b3Ioc2VsZWN0b3JPckNvbmZpZywgdHJ1ZSk7XG59XG5cbmZ1bmN0aW9uIGNoaWxkKHNlbGVjdG9yT3JDb25maWcpIHtcbiAgcmV0dXJuIGNyZWF0ZUNoaWxkT2JzZXJ2ZXJEZWNvcmF0b3Ioc2VsZWN0b3JPckNvbmZpZywgZmFsc2UpO1xufVxuXG52YXIgQ2hpbGRPYnNlcnZlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQ2hpbGRPYnNlcnZlcihjb25maWcpIHtcbiAgICBcblxuICAgIHRoaXMubmFtZSA9IGNvbmZpZy5uYW1lO1xuICAgIHRoaXMuY2hhbmdlSGFuZGxlciA9IGNvbmZpZy5jaGFuZ2VIYW5kbGVyIHx8IHRoaXMubmFtZSArICdDaGFuZ2VkJztcbiAgICB0aGlzLnNlbGVjdG9yID0gY29uZmlnLnNlbGVjdG9yO1xuICAgIHRoaXMuYWxsID0gY29uZmlnLmFsbDtcbiAgfVxuXG4gIENoaWxkT2JzZXJ2ZXIucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uIGNyZWF0ZSh2aWV3SG9zdCwgdmlld01vZGVsLCBjb250cm9sbGVyKSB7XG4gICAgcmV0dXJuIG5ldyBDaGlsZE9ic2VydmVyQmluZGVyKHRoaXMuc2VsZWN0b3IsIHZpZXdIb3N0LCB0aGlzLm5hbWUsIHZpZXdNb2RlbCwgY29udHJvbGxlciwgdGhpcy5jaGFuZ2VIYW5kbGVyLCB0aGlzLmFsbCk7XG4gIH07XG5cbiAgcmV0dXJuIENoaWxkT2JzZXJ2ZXI7XG59KCk7XG5cbnZhciBub011dGF0aW9ucyA9IFtdO1xuXG5mdW5jdGlvbiB0cmFja011dGF0aW9uKGdyb3VwZWRNdXRhdGlvbnMsIGJpbmRlciwgcmVjb3JkKSB7XG4gIHZhciBtdXRhdGlvbnMgPSBncm91cGVkTXV0YXRpb25zLmdldChiaW5kZXIpO1xuXG4gIGlmICghbXV0YXRpb25zKSB7XG4gICAgbXV0YXRpb25zID0gW107XG4gICAgZ3JvdXBlZE11dGF0aW9ucy5zZXQoYmluZGVyLCBtdXRhdGlvbnMpO1xuICB9XG5cbiAgbXV0YXRpb25zLnB1c2gocmVjb3JkKTtcbn1cblxuZnVuY3Rpb24gb25DaGlsZENoYW5nZShtdXRhdGlvbnMsIG9ic2VydmVyKSB7XG4gIHZhciBiaW5kZXJzID0gb2JzZXJ2ZXIuYmluZGVycztcbiAgdmFyIGJpbmRlcnNMZW5ndGggPSBiaW5kZXJzLmxlbmd0aDtcbiAgdmFyIGdyb3VwZWRNdXRhdGlvbnMgPSBuZXcgTWFwKCk7XG5cbiAgZm9yICh2YXIgaSA9IDAsIGlpID0gbXV0YXRpb25zLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICB2YXIgcmVjb3JkID0gbXV0YXRpb25zW2ldO1xuICAgIHZhciBhZGRlZCA9IHJlY29yZC5hZGRlZE5vZGVzO1xuICAgIHZhciByZW1vdmVkID0gcmVjb3JkLnJlbW92ZWROb2RlcztcblxuICAgIGZvciAodmFyIGogPSAwLCBqaiA9IHJlbW92ZWQubGVuZ3RoOyBqIDwgamo7ICsraikge1xuICAgICAgdmFyIG5vZGUgPSByZW1vdmVkW2pdO1xuICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IDEpIHtcbiAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBiaW5kZXJzTGVuZ3RoOyArK2spIHtcbiAgICAgICAgICB2YXIgYmluZGVyID0gYmluZGVyc1trXTtcbiAgICAgICAgICBpZiAoYmluZGVyLm9uUmVtb3ZlKG5vZGUpKSB7XG4gICAgICAgICAgICB0cmFja011dGF0aW9uKGdyb3VwZWRNdXRhdGlvbnMsIGJpbmRlciwgcmVjb3JkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IgKHZhciBfaiA9IDAsIF9qaiA9IGFkZGVkLmxlbmd0aDsgX2ogPCBfamo7ICsrX2opIHtcbiAgICAgIHZhciBfbm9kZSA9IGFkZGVkW19qXTtcbiAgICAgIGlmIChfbm9kZS5ub2RlVHlwZSA9PT0gMSkge1xuICAgICAgICBmb3IgKHZhciBfayA9IDA7IF9rIDwgYmluZGVyc0xlbmd0aDsgKytfaykge1xuICAgICAgICAgIHZhciBfYmluZGVyID0gYmluZGVyc1tfa107XG4gICAgICAgICAgaWYgKF9iaW5kZXIub25BZGQoX25vZGUpKSB7XG4gICAgICAgICAgICB0cmFja011dGF0aW9uKGdyb3VwZWRNdXRhdGlvbnMsIF9iaW5kZXIsIHJlY29yZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZ3JvdXBlZE11dGF0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XG4gICAgaWYgKGtleS5jaGFuZ2VIYW5kbGVyICE9PSBudWxsKSB7XG4gICAgICBrZXkudmlld01vZGVsW2tleS5jaGFuZ2VIYW5kbGVyXSh2YWx1ZSk7XG4gICAgfVxuICB9KTtcbn1cblxudmFyIENoaWxkT2JzZXJ2ZXJCaW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIENoaWxkT2JzZXJ2ZXJCaW5kZXIoc2VsZWN0b3IsIHZpZXdIb3N0LCBwcm9wZXJ0eSwgdmlld01vZGVsLCBjb250cm9sbGVyLCBjaGFuZ2VIYW5kbGVyLCBhbGwpIHtcbiAgICBcblxuICAgIHRoaXMuc2VsZWN0b3IgPSBzZWxlY3RvcjtcbiAgICB0aGlzLnZpZXdIb3N0ID0gdmlld0hvc3Q7XG4gICAgdGhpcy5wcm9wZXJ0eSA9IHByb3BlcnR5O1xuICAgIHRoaXMudmlld01vZGVsID0gdmlld01vZGVsO1xuICAgIHRoaXMuY29udHJvbGxlciA9IGNvbnRyb2xsZXI7XG4gICAgdGhpcy5jaGFuZ2VIYW5kbGVyID0gY2hhbmdlSGFuZGxlciBpbiB2aWV3TW9kZWwgPyBjaGFuZ2VIYW5kbGVyIDogbnVsbDtcbiAgICB0aGlzLnVzZXNTaGFkb3dET00gPSBjb250cm9sbGVyLmJlaGF2aW9yLnVzZXNTaGFkb3dET007XG4gICAgdGhpcy5hbGwgPSBhbGw7XG5cbiAgICBpZiAoIXRoaXMudXNlc1NoYWRvd0RPTSAmJiBjb250cm9sbGVyLnZpZXcgJiYgY29udHJvbGxlci52aWV3LmNvbnRlbnRWaWV3KSB7XG4gICAgICB0aGlzLmNvbnRlbnRWaWV3ID0gY29udHJvbGxlci52aWV3LmNvbnRlbnRWaWV3O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNvbnRlbnRWaWV3ID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICBDaGlsZE9ic2VydmVyQmluZGVyLnByb3RvdHlwZS5tYXRjaGVzID0gZnVuY3Rpb24gbWF0Y2hlcyhlbGVtZW50KSB7XG4gICAgaWYgKGVsZW1lbnQubWF0Y2hlcyh0aGlzLnNlbGVjdG9yKSkge1xuICAgICAgaWYgKHRoaXMuY29udGVudFZpZXcgPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIHZhciBjb250ZW50VmlldyA9IHRoaXMuY29udGVudFZpZXc7XG4gICAgICB2YXIgYXNzaWduZWRTbG90ID0gZWxlbWVudC5hdUFzc2lnbmVkU2xvdDtcblxuICAgICAgaWYgKGFzc2lnbmVkU2xvdCAmJiBhc3NpZ25lZFNsb3QucHJvamVjdEZyb21BbmNob3JzKSB7XG4gICAgICAgIHZhciBhbmNob3JzID0gYXNzaWduZWRTbG90LnByb2plY3RGcm9tQW5jaG9ycztcblxuICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBhbmNob3JzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgICBpZiAoYW5jaG9yc1tpXS5hdU93bmVyVmlldyA9PT0gY29udGVudFZpZXcpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGVsZW1lbnQuYXVPd25lclZpZXcgPT09IGNvbnRlbnRWaWV3O1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBDaGlsZE9ic2VydmVyQmluZGVyLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZChzb3VyY2UpIHtcbiAgICB2YXIgdmlld0hvc3QgPSB0aGlzLnZpZXdIb3N0O1xuICAgIHZhciB2aWV3TW9kZWwgPSB0aGlzLnZpZXdNb2RlbDtcbiAgICB2YXIgb2JzZXJ2ZXIgPSB2aWV3SG9zdC5fX2NoaWxkT2JzZXJ2ZXJfXztcblxuICAgIGlmICghb2JzZXJ2ZXIpIHtcbiAgICAgIG9ic2VydmVyID0gdmlld0hvc3QuX19jaGlsZE9ic2VydmVyX18gPSBfYXVyZWxpYVBhbC5ET00uY3JlYXRlTXV0YXRpb25PYnNlcnZlcihvbkNoaWxkQ2hhbmdlKTtcblxuICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgIGNoaWxkTGlzdDogdHJ1ZSxcbiAgICAgICAgc3VidHJlZTogIXRoaXMudXNlc1NoYWRvd0RPTVxuICAgICAgfTtcblxuICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZSh2aWV3SG9zdCwgb3B0aW9ucyk7XG4gICAgICBvYnNlcnZlci5iaW5kZXJzID0gW107XG4gICAgfVxuXG4gICAgb2JzZXJ2ZXIuYmluZGVycy5wdXNoKHRoaXMpO1xuXG4gICAgaWYgKHRoaXMudXNlc1NoYWRvd0RPTSkge1xuICAgICAgdmFyIGN1cnJlbnQgPSB2aWV3SG9zdC5maXJzdEVsZW1lbnRDaGlsZDtcblxuICAgICAgaWYgKHRoaXMuYWxsKSB7XG4gICAgICAgIHZhciBpdGVtcyA9IHZpZXdNb2RlbFt0aGlzLnByb3BlcnR5XTtcbiAgICAgICAgaWYgKCFpdGVtcykge1xuICAgICAgICAgIGl0ZW1zID0gdmlld01vZGVsW3RoaXMucHJvcGVydHldID0gW107XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaXRlbXMubGVuZ3RoID0gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIHdoaWxlIChjdXJyZW50KSB7XG4gICAgICAgICAgaWYgKHRoaXMubWF0Y2hlcyhjdXJyZW50KSkge1xuICAgICAgICAgICAgaXRlbXMucHVzaChjdXJyZW50LmF1ICYmIGN1cnJlbnQuYXUuY29udHJvbGxlciA/IGN1cnJlbnQuYXUuY29udHJvbGxlci52aWV3TW9kZWwgOiBjdXJyZW50KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjdXJyZW50ID0gY3VycmVudC5uZXh0RWxlbWVudFNpYmxpbmc7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5jaGFuZ2VIYW5kbGVyICE9PSBudWxsKSB7XG4gICAgICAgICAgdGhpcy52aWV3TW9kZWxbdGhpcy5jaGFuZ2VIYW5kbGVyXShub011dGF0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHdoaWxlIChjdXJyZW50KSB7XG4gICAgICAgICAgaWYgKHRoaXMubWF0Y2hlcyhjdXJyZW50KSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gY3VycmVudC5hdSAmJiBjdXJyZW50LmF1LmNvbnRyb2xsZXIgPyBjdXJyZW50LmF1LmNvbnRyb2xsZXIudmlld01vZGVsIDogY3VycmVudDtcbiAgICAgICAgICAgIHRoaXMudmlld01vZGVsW3RoaXMucHJvcGVydHldID0gdmFsdWU7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmNoYW5nZUhhbmRsZXIgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgdGhpcy52aWV3TW9kZWxbdGhpcy5jaGFuZ2VIYW5kbGVyXSh2YWx1ZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGN1cnJlbnQgPSBjdXJyZW50Lm5leHRFbGVtZW50U2libGluZztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBDaGlsZE9ic2VydmVyQmluZGVyLnByb3RvdHlwZS5vblJlbW92ZSA9IGZ1bmN0aW9uIG9uUmVtb3ZlKGVsZW1lbnQpIHtcbiAgICBpZiAodGhpcy5tYXRjaGVzKGVsZW1lbnQpKSB7XG4gICAgICB2YXIgdmFsdWUgPSBlbGVtZW50LmF1ICYmIGVsZW1lbnQuYXUuY29udHJvbGxlciA/IGVsZW1lbnQuYXUuY29udHJvbGxlci52aWV3TW9kZWwgOiBlbGVtZW50O1xuXG4gICAgICBpZiAodGhpcy5hbGwpIHtcbiAgICAgICAgdmFyIGl0ZW1zID0gdGhpcy52aWV3TW9kZWxbdGhpcy5wcm9wZXJ0eV0gfHwgKHRoaXMudmlld01vZGVsW3RoaXMucHJvcGVydHldID0gW10pO1xuICAgICAgICB2YXIgaW5kZXggPSBpdGVtcy5pbmRleE9mKHZhbHVlKTtcblxuICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgaXRlbXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIENoaWxkT2JzZXJ2ZXJCaW5kZXIucHJvdG90eXBlLm9uQWRkID0gZnVuY3Rpb24gb25BZGQoZWxlbWVudCkge1xuICAgIGlmICh0aGlzLm1hdGNoZXMoZWxlbWVudCkpIHtcbiAgICAgIHZhciB2YWx1ZSA9IGVsZW1lbnQuYXUgJiYgZWxlbWVudC5hdS5jb250cm9sbGVyID8gZWxlbWVudC5hdS5jb250cm9sbGVyLnZpZXdNb2RlbCA6IGVsZW1lbnQ7XG5cbiAgICAgIGlmICh0aGlzLmFsbCkge1xuICAgICAgICB2YXIgaXRlbXMgPSB0aGlzLnZpZXdNb2RlbFt0aGlzLnByb3BlcnR5XSB8fCAodGhpcy52aWV3TW9kZWxbdGhpcy5wcm9wZXJ0eV0gPSBbXSk7XG4gICAgICAgIHZhciBpbmRleCA9IDA7XG4gICAgICAgIHZhciBwcmV2ID0gZWxlbWVudC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nO1xuXG4gICAgICAgIHdoaWxlIChwcmV2KSB7XG4gICAgICAgICAgaWYgKHRoaXMubWF0Y2hlcyhwcmV2KSkge1xuICAgICAgICAgICAgaW5kZXgrKztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBwcmV2ID0gcHJldi5wcmV2aW91c0VsZW1lbnRTaWJsaW5nO1xuICAgICAgICB9XG5cbiAgICAgICAgaXRlbXMuc3BsaWNlKGluZGV4LCAwLCB2YWx1ZSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnZpZXdNb2RlbFt0aGlzLnByb3BlcnR5XSA9IHZhbHVlO1xuXG4gICAgICBpZiAodGhpcy5jaGFuZ2VIYW5kbGVyICE9PSBudWxsKSB7XG4gICAgICAgIHRoaXMudmlld01vZGVsW3RoaXMuY2hhbmdlSGFuZGxlcl0odmFsdWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBDaGlsZE9ic2VydmVyQmluZGVyLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiB1bmJpbmQoKSB7XG4gICAgaWYgKHRoaXMudmlld0hvc3QuX19jaGlsZE9ic2VydmVyX18pIHtcbiAgICAgIHRoaXMudmlld0hvc3QuX19jaGlsZE9ic2VydmVyX18uZGlzY29ubmVjdCgpO1xuICAgICAgdGhpcy52aWV3SG9zdC5fX2NoaWxkT2JzZXJ2ZXJfXyA9IG51bGw7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBDaGlsZE9ic2VydmVyQmluZGVyO1xufSgpO1xuXG5mdW5jdGlvbiB0cnlBY3RpdmF0ZVZpZXdNb2RlbChjb250ZXh0KSB7XG4gIGlmIChjb250ZXh0LnNraXBBY3RpdmF0aW9uIHx8IHR5cGVvZiBjb250ZXh0LnZpZXdNb2RlbC5hY3RpdmF0ZSAhPT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgfVxuXG4gIHJldHVybiBjb250ZXh0LnZpZXdNb2RlbC5hY3RpdmF0ZShjb250ZXh0Lm1vZGVsKSB8fCBQcm9taXNlLnJlc29sdmUoKTtcbn1cblxudmFyIENvbXBvc2l0aW9uRW5naW5lID0gZXhwb3J0cy5Db21wb3NpdGlvbkVuZ2luZSA9IChfZGVjMTAgPSAoMCwgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uLmluamVjdCkoVmlld0VuZ2luZSwgVmlld0xvY2F0b3IpLCBfZGVjMTAoX2NsYXNzMjEgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIENvbXBvc2l0aW9uRW5naW5lKHZpZXdFbmdpbmUsIHZpZXdMb2NhdG9yKSB7XG4gICAgXG5cbiAgICB0aGlzLnZpZXdFbmdpbmUgPSB2aWV3RW5naW5lO1xuICAgIHRoaXMudmlld0xvY2F0b3IgPSB2aWV3TG9jYXRvcjtcbiAgfVxuXG4gIENvbXBvc2l0aW9uRW5naW5lLnByb3RvdHlwZS5fY3JlYXRlQ29udHJvbGxlckFuZFN3YXAgPSBmdW5jdGlvbiBfY3JlYXRlQ29udHJvbGxlckFuZFN3YXAoY29udGV4dCkge1xuICAgIGZ1bmN0aW9uIHN3YXAoY29udHJvbGxlcikge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShjb250ZXh0LnZpZXdTbG90LnJlbW92ZUFsbCh0cnVlKSkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChjb250ZXh0LmN1cnJlbnRDb250cm9sbGVyKSB7XG4gICAgICAgICAgY29udGV4dC5jdXJyZW50Q29udHJvbGxlci51bmJpbmQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnRleHQudmlld1Nsb3QuYWRkKGNvbnRyb2xsZXIudmlldyk7XG5cbiAgICAgICAgaWYgKGNvbnRleHQuY29tcG9zaXRpb25UcmFuc2FjdGlvbk5vdGlmaWVyKSB7XG4gICAgICAgICAgY29udGV4dC5jb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXIuZG9uZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNvbnRyb2xsZXI7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5jcmVhdGVDb250cm9sbGVyKGNvbnRleHQpLnRoZW4oZnVuY3Rpb24gKGNvbnRyb2xsZXIpIHtcbiAgICAgIGNvbnRyb2xsZXIuYXV0b21hdGUoY29udGV4dC5vdmVycmlkZUNvbnRleHQsIGNvbnRleHQub3duaW5nVmlldyk7XG5cbiAgICAgIGlmIChjb250ZXh0LmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbikge1xuICAgICAgICByZXR1cm4gY29udGV4dC5jb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4ud2FpdEZvckNvbXBvc2l0aW9uQ29tcGxldGUoKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gc3dhcChjb250cm9sbGVyKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBzd2FwKGNvbnRyb2xsZXIpO1xuICAgIH0pO1xuICB9O1xuXG4gIENvbXBvc2l0aW9uRW5naW5lLnByb3RvdHlwZS5jcmVhdGVDb250cm9sbGVyID0gZnVuY3Rpb24gY3JlYXRlQ29udHJvbGxlcihjb250ZXh0KSB7XG4gICAgdmFyIF90aGlzMTQgPSB0aGlzO1xuXG4gICAgdmFyIGNoaWxkQ29udGFpbmVyID0gdm9pZCAwO1xuICAgIHZhciB2aWV3TW9kZWwgPSB2b2lkIDA7XG4gICAgdmFyIHZpZXdNb2RlbFJlc291cmNlID0gdm9pZCAwO1xuICAgIHZhciBtID0gdm9pZCAwO1xuXG4gICAgcmV0dXJuIHRoaXMuZW5zdXJlVmlld01vZGVsKGNvbnRleHQpLnRoZW4odHJ5QWN0aXZhdGVWaWV3TW9kZWwpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgY2hpbGRDb250YWluZXIgPSBjb250ZXh0LmNoaWxkQ29udGFpbmVyO1xuICAgICAgdmlld01vZGVsID0gY29udGV4dC52aWV3TW9kZWw7XG4gICAgICB2aWV3TW9kZWxSZXNvdXJjZSA9IGNvbnRleHQudmlld01vZGVsUmVzb3VyY2U7XG4gICAgICBtID0gdmlld01vZGVsUmVzb3VyY2UubWV0YWRhdGE7XG5cbiAgICAgIHZhciB2aWV3U3RyYXRlZ3kgPSBfdGhpczE0LnZpZXdMb2NhdG9yLmdldFZpZXdTdHJhdGVneShjb250ZXh0LnZpZXcgfHwgdmlld01vZGVsKTtcblxuICAgICAgaWYgKGNvbnRleHQudmlld1Jlc291cmNlcykge1xuICAgICAgICB2aWV3U3RyYXRlZ3kubWFrZVJlbGF0aXZlVG8oY29udGV4dC52aWV3UmVzb3VyY2VzLnZpZXdVcmwpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbS5sb2FkKGNoaWxkQ29udGFpbmVyLCB2aWV3TW9kZWxSZXNvdXJjZS52YWx1ZSwgbnVsbCwgdmlld1N0cmF0ZWd5LCB0cnVlKTtcbiAgICB9KS50aGVuKGZ1bmN0aW9uICh2aWV3RmFjdG9yeSkge1xuICAgICAgcmV0dXJuIG0uY3JlYXRlKGNoaWxkQ29udGFpbmVyLCBCZWhhdmlvckluc3RydWN0aW9uLmR5bmFtaWMoY29udGV4dC5ob3N0LCB2aWV3TW9kZWwsIHZpZXdGYWN0b3J5KSk7XG4gICAgfSk7XG4gIH07XG5cbiAgQ29tcG9zaXRpb25FbmdpbmUucHJvdG90eXBlLmVuc3VyZVZpZXdNb2RlbCA9IGZ1bmN0aW9uIGVuc3VyZVZpZXdNb2RlbChjb250ZXh0KSB7XG4gICAgdmFyIGNoaWxkQ29udGFpbmVyID0gY29udGV4dC5jaGlsZENvbnRhaW5lciA9IGNvbnRleHQuY2hpbGRDb250YWluZXIgfHwgY29udGV4dC5jb250YWluZXIuY3JlYXRlQ2hpbGQoKTtcblxuICAgIGlmICh0eXBlb2YgY29udGV4dC52aWV3TW9kZWwgPT09ICdzdHJpbmcnKSB7XG4gICAgICBjb250ZXh0LnZpZXdNb2RlbCA9IGNvbnRleHQudmlld1Jlc291cmNlcyA/IGNvbnRleHQudmlld1Jlc291cmNlcy5yZWxhdGl2ZVRvVmlldyhjb250ZXh0LnZpZXdNb2RlbCkgOiBjb250ZXh0LnZpZXdNb2RlbDtcblxuICAgICAgcmV0dXJuIHRoaXMudmlld0VuZ2luZS5pbXBvcnRWaWV3TW9kZWxSZXNvdXJjZShjb250ZXh0LnZpZXdNb2RlbCkudGhlbihmdW5jdGlvbiAodmlld01vZGVsUmVzb3VyY2UpIHtcbiAgICAgICAgY2hpbGRDb250YWluZXIuYXV0b1JlZ2lzdGVyKHZpZXdNb2RlbFJlc291cmNlLnZhbHVlKTtcblxuICAgICAgICBpZiAoY29udGV4dC5ob3N0KSB7XG4gICAgICAgICAgY2hpbGRDb250YWluZXIucmVnaXN0ZXJJbnN0YW5jZShfYXVyZWxpYVBhbC5ET00uRWxlbWVudCwgY29udGV4dC5ob3N0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnRleHQudmlld01vZGVsID0gY2hpbGRDb250YWluZXIudmlld01vZGVsID0gY2hpbGRDb250YWluZXIuZ2V0KHZpZXdNb2RlbFJlc291cmNlLnZhbHVlKTtcbiAgICAgICAgY29udGV4dC52aWV3TW9kZWxSZXNvdXJjZSA9IHZpZXdNb2RlbFJlc291cmNlO1xuICAgICAgICByZXR1cm4gY29udGV4dDtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHZhciBtID0gX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5nZXRPckNyZWF0ZU93bihfYXVyZWxpYU1ldGFkYXRhLm1ldGFkYXRhLnJlc291cmNlLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgY29udGV4dC52aWV3TW9kZWwuY29uc3RydWN0b3IpO1xuICAgIG0uZWxlbWVudE5hbWUgPSBtLmVsZW1lbnROYW1lIHx8ICdkeW5hbWljLWVsZW1lbnQnO1xuICAgIG0uaW5pdGlhbGl6ZShjb250ZXh0LmNvbnRhaW5lciB8fCBjaGlsZENvbnRhaW5lciwgY29udGV4dC52aWV3TW9kZWwuY29uc3RydWN0b3IpO1xuICAgIGNvbnRleHQudmlld01vZGVsUmVzb3VyY2UgPSB7IG1ldGFkYXRhOiBtLCB2YWx1ZTogY29udGV4dC52aWV3TW9kZWwuY29uc3RydWN0b3IgfTtcbiAgICBjaGlsZENvbnRhaW5lci52aWV3TW9kZWwgPSBjb250ZXh0LnZpZXdNb2RlbDtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGNvbnRleHQpO1xuICB9O1xuXG4gIENvbXBvc2l0aW9uRW5naW5lLnByb3RvdHlwZS5jb21wb3NlID0gZnVuY3Rpb24gY29tcG9zZShjb250ZXh0KSB7XG4gICAgY29udGV4dC5jaGlsZENvbnRhaW5lciA9IGNvbnRleHQuY2hpbGRDb250YWluZXIgfHwgY29udGV4dC5jb250YWluZXIuY3JlYXRlQ2hpbGQoKTtcbiAgICBjb250ZXh0LnZpZXcgPSB0aGlzLnZpZXdMb2NhdG9yLmdldFZpZXdTdHJhdGVneShjb250ZXh0LnZpZXcpO1xuXG4gICAgdmFyIHRyYW5zYWN0aW9uID0gY29udGV4dC5jaGlsZENvbnRhaW5lci5nZXQoQ29tcG9zaXRpb25UcmFuc2FjdGlvbik7XG4gICAgdmFyIGNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbiA9IHRyYW5zYWN0aW9uLnRyeUNhcHR1cmUoKTtcblxuICAgIGlmIChjb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4pIHtcbiAgICAgIGNvbnRleHQuY29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuID0gY29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb250ZXh0LmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllciA9IHRyYW5zYWN0aW9uLmVubGlzdCgpO1xuICAgIH1cblxuICAgIGlmIChjb250ZXh0LnZpZXdNb2RlbCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2NyZWF0ZUNvbnRyb2xsZXJBbmRTd2FwKGNvbnRleHQpO1xuICAgIH0gZWxzZSBpZiAoY29udGV4dC52aWV3KSB7XG4gICAgICBpZiAoY29udGV4dC52aWV3UmVzb3VyY2VzKSB7XG4gICAgICAgIGNvbnRleHQudmlldy5tYWtlUmVsYXRpdmVUbyhjb250ZXh0LnZpZXdSZXNvdXJjZXMudmlld1VybCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBjb250ZXh0LnZpZXcubG9hZFZpZXdGYWN0b3J5KHRoaXMudmlld0VuZ2luZSwgbmV3IFZpZXdDb21waWxlSW5zdHJ1Y3Rpb24oKSkudGhlbihmdW5jdGlvbiAodmlld0ZhY3RvcnkpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHZpZXdGYWN0b3J5LmNyZWF0ZShjb250ZXh0LmNoaWxkQ29udGFpbmVyKTtcbiAgICAgICAgcmVzdWx0LmJpbmQoY29udGV4dC5iaW5kaW5nQ29udGV4dCwgY29udGV4dC5vdmVycmlkZUNvbnRleHQpO1xuXG4gICAgICAgIHZhciB3b3JrID0gZnVuY3Rpb24gd29yaygpIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGNvbnRleHQudmlld1Nsb3QucmVtb3ZlQWxsKHRydWUpKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnRleHQudmlld1Nsb3QuYWRkKHJlc3VsdCk7XG5cbiAgICAgICAgICAgIGlmIChjb250ZXh0LmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllcikge1xuICAgICAgICAgICAgICBjb250ZXh0LmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllci5kb25lKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKGNvbnRleHQuY29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuKSB7XG4gICAgICAgICAgcmV0dXJuIGNvbnRleHQuY29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuLndhaXRGb3JDb21wb3NpdGlvbkNvbXBsZXRlKCkudGhlbih3b3JrKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB3b3JrKCk7XG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGNvbnRleHQudmlld1Nsb3QpIHtcbiAgICAgIGNvbnRleHQudmlld1Nsb3QucmVtb3ZlQWxsKCk7XG5cbiAgICAgIGlmIChjb250ZXh0LmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllcikge1xuICAgICAgICBjb250ZXh0LmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllci5kb25lKCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgfTtcblxuICByZXR1cm4gQ29tcG9zaXRpb25FbmdpbmU7XG59KCkpIHx8IF9jbGFzczIxKTtcblxudmFyIEVsZW1lbnRDb25maWdSZXNvdXJjZSA9IGV4cG9ydHMuRWxlbWVudENvbmZpZ1Jlc291cmNlID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBFbGVtZW50Q29uZmlnUmVzb3VyY2UoKSB7XG4gICAgXG4gIH1cblxuICBFbGVtZW50Q29uZmlnUmVzb3VyY2UucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiBpbml0aWFsaXplKGNvbnRhaW5lciwgdGFyZ2V0KSB7fTtcblxuICBFbGVtZW50Q29uZmlnUmVzb3VyY2UucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gcmVnaXN0ZXIocmVnaXN0cnksIG5hbWUpIHt9O1xuXG4gIEVsZW1lbnRDb25maWdSZXNvdXJjZS5wcm90b3R5cGUubG9hZCA9IGZ1bmN0aW9uIGxvYWQoY29udGFpbmVyLCB0YXJnZXQpIHtcbiAgICB2YXIgY29uZmlnID0gbmV3IHRhcmdldCgpO1xuICAgIHZhciBldmVudE1hbmFnZXIgPSBjb250YWluZXIuZ2V0KF9hdXJlbGlhQmluZGluZy5FdmVudE1hbmFnZXIpO1xuICAgIGV2ZW50TWFuYWdlci5yZWdpc3RlckVsZW1lbnRDb25maWcoY29uZmlnKTtcbiAgfTtcblxuICByZXR1cm4gRWxlbWVudENvbmZpZ1Jlc291cmNlO1xufSgpO1xuXG5mdW5jdGlvbiB2YWxpZGF0ZUJlaGF2aW9yTmFtZShuYW1lLCB0eXBlKSB7XG4gIGlmICgvW0EtWl0vLnRlc3QobmFtZSkpIHtcbiAgICB2YXIgbmV3TmFtZSA9IF9oeXBoZW5hdGUobmFtZSk7XG4gICAgTG9nTWFuYWdlci5nZXRMb2dnZXIoJ3RlbXBsYXRpbmcnKS53YXJuKCdcXCcnICsgbmFtZSArICdcXCcgaXMgbm90IGEgdmFsaWQgJyArIHR5cGUgKyAnIG5hbWUgYW5kIGhhcyBiZWVuIGNvbnZlcnRlZCB0byBcXCcnICsgbmV3TmFtZSArICdcXCcuIFVwcGVyLWNhc2UgbGV0dGVycyBhcmUgbm90IGFsbG93ZWQgYmVjYXVzZSB0aGUgRE9NIGlzIG5vdCBjYXNlLXNlbnNpdGl2ZS4nKTtcbiAgICByZXR1cm4gbmV3TmFtZTtcbiAgfVxuICByZXR1cm4gbmFtZTtcbn1cblxuZnVuY3Rpb24gcmVzb3VyY2UoaW5zdGFuY2UpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICBfYXVyZWxpYU1ldGFkYXRhLm1ldGFkYXRhLmRlZmluZShfYXVyZWxpYU1ldGFkYXRhLm1ldGFkYXRhLnJlc291cmNlLCBpbnN0YW5jZSwgdGFyZ2V0KTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gYmVoYXZpb3Iob3ZlcnJpZGUpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICBpZiAob3ZlcnJpZGUgaW5zdGFuY2VvZiBIdG1sQmVoYXZpb3JSZXNvdXJjZSkge1xuICAgICAgX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5kZWZpbmUoX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5yZXNvdXJjZSwgb3ZlcnJpZGUsIHRhcmdldCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciByID0gX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5nZXRPckNyZWF0ZU93bihfYXVyZWxpYU1ldGFkYXRhLm1ldGFkYXRhLnJlc291cmNlLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgdGFyZ2V0KTtcbiAgICAgIE9iamVjdC5hc3NpZ24ociwgb3ZlcnJpZGUpO1xuICAgIH1cbiAgfTtcbn1cblxuZnVuY3Rpb24gY3VzdG9tRWxlbWVudChuYW1lKSB7XG4gIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgdmFyIHIgPSBfYXVyZWxpYU1ldGFkYXRhLm1ldGFkYXRhLmdldE9yQ3JlYXRlT3duKF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEucmVzb3VyY2UsIEh0bWxCZWhhdmlvclJlc291cmNlLCB0YXJnZXQpO1xuICAgIHIuZWxlbWVudE5hbWUgPSB2YWxpZGF0ZUJlaGF2aW9yTmFtZShuYW1lLCAnY3VzdG9tIGVsZW1lbnQnKTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gY3VzdG9tQXR0cmlidXRlKG5hbWUsIGRlZmF1bHRCaW5kaW5nTW9kZSkge1xuICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCkge1xuICAgIHZhciByID0gX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5nZXRPckNyZWF0ZU93bihfYXVyZWxpYU1ldGFkYXRhLm1ldGFkYXRhLnJlc291cmNlLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgdGFyZ2V0KTtcbiAgICByLmF0dHJpYnV0ZU5hbWUgPSB2YWxpZGF0ZUJlaGF2aW9yTmFtZShuYW1lLCAnY3VzdG9tIGF0dHJpYnV0ZScpO1xuICAgIHIuYXR0cmlidXRlRGVmYXVsdEJpbmRpbmdNb2RlID0gZGVmYXVsdEJpbmRpbmdNb2RlO1xuICB9O1xufVxuXG5mdW5jdGlvbiB0ZW1wbGF0ZUNvbnRyb2xsZXIodGFyZ2V0KSB7XG4gIHZhciBkZWNvID0gZnVuY3Rpb24gZGVjbyh0KSB7XG4gICAgdmFyIHIgPSBfYXVyZWxpYU1ldGFkYXRhLm1ldGFkYXRhLmdldE9yQ3JlYXRlT3duKF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEucmVzb3VyY2UsIEh0bWxCZWhhdmlvclJlc291cmNlLCB0KTtcbiAgICByLmxpZnRzQ29udGVudCA9IHRydWU7XG4gIH07XG5cbiAgcmV0dXJuIHRhcmdldCA/IGRlY28odGFyZ2V0KSA6IGRlY287XG59XG5cbmZ1bmN0aW9uIGJpbmRhYmxlKG5hbWVPckNvbmZpZ09yVGFyZ2V0LCBrZXksIGRlc2NyaXB0b3IpIHtcbiAgdmFyIGRlY28gPSBmdW5jdGlvbiBkZWNvKHRhcmdldCwga2V5MiwgZGVzY3JpcHRvcjIpIHtcbiAgICB2YXIgYWN0dWFsVGFyZ2V0ID0ga2V5MiA/IHRhcmdldC5jb25zdHJ1Y3RvciA6IHRhcmdldDtcbiAgICB2YXIgciA9IF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEuZ2V0T3JDcmVhdGVPd24oX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIGFjdHVhbFRhcmdldCk7XG4gICAgdmFyIHByb3AgPSB2b2lkIDA7XG5cbiAgICBpZiAoa2V5Mikge1xuICAgICAgbmFtZU9yQ29uZmlnT3JUYXJnZXQgPSBuYW1lT3JDb25maWdPclRhcmdldCB8fCB7fTtcbiAgICAgIG5hbWVPckNvbmZpZ09yVGFyZ2V0Lm5hbWUgPSBrZXkyO1xuICAgIH1cblxuICAgIHByb3AgPSBuZXcgQmluZGFibGVQcm9wZXJ0eShuYW1lT3JDb25maWdPclRhcmdldCk7XG4gICAgcmV0dXJuIHByb3AucmVnaXN0ZXJXaXRoKGFjdHVhbFRhcmdldCwgciwgZGVzY3JpcHRvcjIpO1xuICB9O1xuXG4gIGlmICghbmFtZU9yQ29uZmlnT3JUYXJnZXQpIHtcbiAgICByZXR1cm4gZGVjbztcbiAgfVxuXG4gIGlmIChrZXkpIHtcbiAgICB2YXIgdGFyZ2V0ID0gbmFtZU9yQ29uZmlnT3JUYXJnZXQ7XG4gICAgbmFtZU9yQ29uZmlnT3JUYXJnZXQgPSBudWxsO1xuICAgIHJldHVybiBkZWNvKHRhcmdldCwga2V5LCBkZXNjcmlwdG9yKTtcbiAgfVxuXG4gIHJldHVybiBkZWNvO1xufVxuXG5mdW5jdGlvbiBkeW5hbWljT3B0aW9ucyh0YXJnZXQpIHtcbiAgdmFyIGRlY28gPSBmdW5jdGlvbiBkZWNvKHQpIHtcbiAgICB2YXIgciA9IF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEuZ2V0T3JDcmVhdGVPd24oX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIHQpO1xuICAgIHIuaGFzRHluYW1pY09wdGlvbnMgPSB0cnVlO1xuICB9O1xuXG4gIHJldHVybiB0YXJnZXQgPyBkZWNvKHRhcmdldCkgOiBkZWNvO1xufVxuXG52YXIgZGVmYXVsdFNoYWRvd0RPTU9wdGlvbnMgPSB7IG1vZGU6ICdvcGVuJyB9O1xuZnVuY3Rpb24gdXNlU2hhZG93RE9NKHRhcmdldE9yT3B0aW9ucykge1xuICB2YXIgb3B0aW9ucyA9IHR5cGVvZiB0YXJnZXRPck9wdGlvbnMgPT09ICdmdW5jdGlvbicgfHwgIXRhcmdldE9yT3B0aW9ucyA/IGRlZmF1bHRTaGFkb3dET01PcHRpb25zIDogdGFyZ2V0T3JPcHRpb25zO1xuXG4gIHZhciBkZWNvID0gZnVuY3Rpb24gZGVjbyh0KSB7XG4gICAgdmFyIHIgPSBfYXVyZWxpYU1ldGFkYXRhLm1ldGFkYXRhLmdldE9yQ3JlYXRlT3duKF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEucmVzb3VyY2UsIEh0bWxCZWhhdmlvclJlc291cmNlLCB0KTtcbiAgICByLnRhcmdldFNoYWRvd0RPTSA9IHRydWU7XG4gICAgci5zaGFkb3dET01PcHRpb25zID0gb3B0aW9ucztcbiAgfTtcblxuICByZXR1cm4gdHlwZW9mIHRhcmdldE9yT3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJyA/IGRlY28odGFyZ2V0T3JPcHRpb25zKSA6IGRlY287XG59XG5cbmZ1bmN0aW9uIHByb2Nlc3NBdHRyaWJ1dGVzKHByb2Nlc3Nvcikge1xuICByZXR1cm4gZnVuY3Rpb24gKHQpIHtcbiAgICB2YXIgciA9IF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEuZ2V0T3JDcmVhdGVPd24oX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIHQpO1xuICAgIHIucHJvY2Vzc0F0dHJpYnV0ZXMgPSBmdW5jdGlvbiAoY29tcGlsZXIsIHJlc291cmNlcywgbm9kZSwgYXR0cmlidXRlcywgZWxlbWVudEluc3RydWN0aW9uKSB7XG4gICAgICB0cnkge1xuICAgICAgICBwcm9jZXNzb3IoY29tcGlsZXIsIHJlc291cmNlcywgbm9kZSwgYXR0cmlidXRlcywgZWxlbWVudEluc3RydWN0aW9uKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIExvZ01hbmFnZXIuZ2V0TG9nZ2VyKCd0ZW1wbGF0aW5nJykuZXJyb3IoZXJyb3IpO1xuICAgICAgfVxuICAgIH07XG4gIH07XG59XG5cbmZ1bmN0aW9uIGRvTm90UHJvY2Vzc0NvbnRlbnQoKSB7XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gcHJvY2Vzc0NvbnRlbnQocHJvY2Vzc29yKSB7XG4gIHJldHVybiBmdW5jdGlvbiAodCkge1xuICAgIHZhciByID0gX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5nZXRPckNyZWF0ZU93bihfYXVyZWxpYU1ldGFkYXRhLm1ldGFkYXRhLnJlc291cmNlLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgdCk7XG4gICAgci5wcm9jZXNzQ29udGVudCA9IHByb2Nlc3NvciA/IGZ1bmN0aW9uIChjb21waWxlciwgcmVzb3VyY2VzLCBub2RlLCBpbnN0cnVjdGlvbikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIHByb2Nlc3Nvcihjb21waWxlciwgcmVzb3VyY2VzLCBub2RlLCBpbnN0cnVjdGlvbik7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBMb2dNYW5hZ2VyLmdldExvZ2dlcigndGVtcGxhdGluZycpLmVycm9yKGVycm9yKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0gOiBkb05vdFByb2Nlc3NDb250ZW50O1xuICB9O1xufVxuXG5mdW5jdGlvbiBjb250YWluZXJsZXNzKHRhcmdldCkge1xuICB2YXIgZGVjbyA9IGZ1bmN0aW9uIGRlY28odCkge1xuICAgIHZhciByID0gX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5nZXRPckNyZWF0ZU93bihfYXVyZWxpYU1ldGFkYXRhLm1ldGFkYXRhLnJlc291cmNlLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgdCk7XG4gICAgci5jb250YWluZXJsZXNzID0gdHJ1ZTtcbiAgfTtcblxuICByZXR1cm4gdGFyZ2V0ID8gZGVjbyh0YXJnZXQpIDogZGVjbztcbn1cblxuZnVuY3Rpb24gdXNlVmlld1N0cmF0ZWd5KHN0cmF0ZWd5KSB7XG4gIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5kZWZpbmUoVmlld0xvY2F0b3Iudmlld1N0cmF0ZWd5TWV0YWRhdGFLZXksIHN0cmF0ZWd5LCB0YXJnZXQpO1xuICB9O1xufVxuXG5mdW5jdGlvbiB1c2VWaWV3KHBhdGgpIHtcbiAgcmV0dXJuIHVzZVZpZXdTdHJhdGVneShuZXcgUmVsYXRpdmVWaWV3U3RyYXRlZ3kocGF0aCkpO1xufVxuXG5mdW5jdGlvbiBpbmxpbmVWaWV3KG1hcmt1cCwgZGVwZW5kZW5jaWVzLCBkZXBlbmRlbmN5QmFzZVVybCkge1xuICByZXR1cm4gdXNlVmlld1N0cmF0ZWd5KG5ldyBJbmxpbmVWaWV3U3RyYXRlZ3kobWFya3VwLCBkZXBlbmRlbmNpZXMsIGRlcGVuZGVuY3lCYXNlVXJsKSk7XG59XG5cbmZ1bmN0aW9uIG5vVmlldyh0YXJnZXQpIHtcbiAgdmFyIGRlY28gPSBmdW5jdGlvbiBkZWNvKHQpIHtcbiAgICBfYXVyZWxpYU1ldGFkYXRhLm1ldGFkYXRhLmRlZmluZShWaWV3TG9jYXRvci52aWV3U3RyYXRlZ3lNZXRhZGF0YUtleSwgbmV3IE5vVmlld1N0cmF0ZWd5KCksIHQpO1xuICB9O1xuXG4gIHJldHVybiB0YXJnZXQgPyBkZWNvKHRhcmdldCkgOiBkZWNvO1xufVxuXG5mdW5jdGlvbiBlbGVtZW50Q29uZmlnKHRhcmdldCkge1xuICB2YXIgZGVjbyA9IGZ1bmN0aW9uIGRlY28odCkge1xuICAgIF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEuZGVmaW5lKF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEucmVzb3VyY2UsIG5ldyBFbGVtZW50Q29uZmlnUmVzb3VyY2UoKSwgdCk7XG4gIH07XG5cbiAgcmV0dXJuIHRhcmdldCA/IGRlY28odGFyZ2V0KSA6IGRlY287XG59XG5cbnZhciBUZW1wbGF0aW5nRW5naW5lID0gZXhwb3J0cy5UZW1wbGF0aW5nRW5naW5lID0gKF9kZWMxMSA9ICgwLCBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24uaW5qZWN0KShfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24uQ29udGFpbmVyLCBNb2R1bGVBbmFseXplciwgVmlld0NvbXBpbGVyLCBDb21wb3NpdGlvbkVuZ2luZSksIF9kZWMxMShfY2xhc3MyMiA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gVGVtcGxhdGluZ0VuZ2luZShjb250YWluZXIsIG1vZHVsZUFuYWx5emVyLCB2aWV3Q29tcGlsZXIsIGNvbXBvc2l0aW9uRW5naW5lKSB7XG4gICAgXG5cbiAgICB0aGlzLl9jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgdGhpcy5fbW9kdWxlQW5hbHl6ZXIgPSBtb2R1bGVBbmFseXplcjtcbiAgICB0aGlzLl92aWV3Q29tcGlsZXIgPSB2aWV3Q29tcGlsZXI7XG4gICAgdGhpcy5fY29tcG9zaXRpb25FbmdpbmUgPSBjb21wb3NpdGlvbkVuZ2luZTtcbiAgICBjb250YWluZXIucmVnaXN0ZXJJbnN0YW5jZShBbmltYXRvciwgQW5pbWF0b3IuaW5zdGFuY2UgPSBuZXcgQW5pbWF0b3IoKSk7XG4gIH1cblxuICBUZW1wbGF0aW5nRW5naW5lLnByb3RvdHlwZS5jb25maWd1cmVBbmltYXRvciA9IGZ1bmN0aW9uIGNvbmZpZ3VyZUFuaW1hdG9yKGFuaW1hdG9yKSB7XG4gICAgdGhpcy5fY29udGFpbmVyLnVucmVnaXN0ZXIoQW5pbWF0b3IpO1xuICAgIHRoaXMuX2NvbnRhaW5lci5yZWdpc3Rlckluc3RhbmNlKEFuaW1hdG9yLCBBbmltYXRvci5pbnN0YW5jZSA9IGFuaW1hdG9yKTtcbiAgfTtcblxuICBUZW1wbGF0aW5nRW5naW5lLnByb3RvdHlwZS5jb21wb3NlID0gZnVuY3Rpb24gY29tcG9zZShjb250ZXh0KSB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbXBvc2l0aW9uRW5naW5lLmNvbXBvc2UoY29udGV4dCk7XG4gIH07XG5cbiAgVGVtcGxhdGluZ0VuZ2luZS5wcm90b3R5cGUuZW5oYW5jZSA9IGZ1bmN0aW9uIGVuaGFuY2UoaW5zdHJ1Y3Rpb24pIHtcbiAgICBpZiAoaW5zdHJ1Y3Rpb24gaW5zdGFuY2VvZiBfYXVyZWxpYVBhbC5ET00uRWxlbWVudCkge1xuICAgICAgaW5zdHJ1Y3Rpb24gPSB7IGVsZW1lbnQ6IGluc3RydWN0aW9uIH07XG4gICAgfVxuXG4gICAgdmFyIGNvbXBpbGVySW5zdHJ1Y3Rpb25zID0ge307XG4gICAgdmFyIHJlc291cmNlcyA9IGluc3RydWN0aW9uLnJlc291cmNlcyB8fCB0aGlzLl9jb250YWluZXIuZ2V0KFZpZXdSZXNvdXJjZXMpO1xuXG4gICAgdGhpcy5fdmlld0NvbXBpbGVyLl9jb21waWxlTm9kZShpbnN0cnVjdGlvbi5lbGVtZW50LCByZXNvdXJjZXMsIGNvbXBpbGVySW5zdHJ1Y3Rpb25zLCBpbnN0cnVjdGlvbi5lbGVtZW50LnBhcmVudE5vZGUsICdyb290JywgdHJ1ZSk7XG5cbiAgICB2YXIgZmFjdG9yeSA9IG5ldyBWaWV3RmFjdG9yeShpbnN0cnVjdGlvbi5lbGVtZW50LCBjb21waWxlckluc3RydWN0aW9ucywgcmVzb3VyY2VzKTtcbiAgICB2YXIgY29udGFpbmVyID0gaW5zdHJ1Y3Rpb24uY29udGFpbmVyIHx8IHRoaXMuX2NvbnRhaW5lci5jcmVhdGVDaGlsZCgpO1xuICAgIHZhciB2aWV3ID0gZmFjdG9yeS5jcmVhdGUoY29udGFpbmVyLCBCZWhhdmlvckluc3RydWN0aW9uLmVuaGFuY2UoKSk7XG5cbiAgICB2aWV3LmJpbmQoaW5zdHJ1Y3Rpb24uYmluZGluZ0NvbnRleHQgfHwge30sIGluc3RydWN0aW9uLm92ZXJyaWRlQ29udGV4dCk7XG5cbiAgICByZXR1cm4gdmlldztcbiAgfTtcblxuICByZXR1cm4gVGVtcGxhdGluZ0VuZ2luZTtcbn0oKSkgfHwgX2NsYXNzMjIpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLXRlbXBsYXRpbmcvZGlzdC9jb21tb25qcy9hdXJlbGlhLXRlbXBsYXRpbmcuanNcbi8vIG1vZHVsZSBpZCA9IDNcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5nZXRTZXRPYnNlcnZlciA9IGV4cG9ydHMuQmluZGluZ0VuZ2luZSA9IGV4cG9ydHMuTmFtZUV4cHJlc3Npb24gPSBleHBvcnRzLkxpc3RlbmVyID0gZXhwb3J0cy5MaXN0ZW5lckV4cHJlc3Npb24gPSBleHBvcnRzLkJpbmRpbmdCZWhhdmlvclJlc291cmNlID0gZXhwb3J0cy5WYWx1ZUNvbnZlcnRlclJlc291cmNlID0gZXhwb3J0cy5DYWxsID0gZXhwb3J0cy5DYWxsRXhwcmVzc2lvbiA9IGV4cG9ydHMuQmluZGluZyA9IGV4cG9ydHMuQmluZGluZ0V4cHJlc3Npb24gPSBleHBvcnRzLk9iamVjdE9ic2VydmF0aW9uQWRhcHRlciA9IGV4cG9ydHMuT2JzZXJ2ZXJMb2NhdG9yID0gZXhwb3J0cy5TVkdBbmFseXplciA9IGV4cG9ydHMucHJlc2VudGF0aW9uQXR0cmlidXRlcyA9IGV4cG9ydHMucHJlc2VudGF0aW9uRWxlbWVudHMgPSBleHBvcnRzLmVsZW1lbnRzID0gZXhwb3J0cy5Db21wdXRlZEV4cHJlc3Npb24gPSBleHBvcnRzLkNsYXNzT2JzZXJ2ZXIgPSBleHBvcnRzLlNlbGVjdFZhbHVlT2JzZXJ2ZXIgPSBleHBvcnRzLkNoZWNrZWRPYnNlcnZlciA9IGV4cG9ydHMuVmFsdWVBdHRyaWJ1dGVPYnNlcnZlciA9IGV4cG9ydHMuU3R5bGVPYnNlcnZlciA9IGV4cG9ydHMuRGF0YUF0dHJpYnV0ZU9ic2VydmVyID0gZXhwb3J0cy5kYXRhQXR0cmlidXRlQWNjZXNzb3IgPSBleHBvcnRzLlhMaW5rQXR0cmlidXRlT2JzZXJ2ZXIgPSBleHBvcnRzLlNldHRlck9ic2VydmVyID0gZXhwb3J0cy5QcmltaXRpdmVPYnNlcnZlciA9IGV4cG9ydHMucHJvcGVydHlBY2Nlc3NvciA9IGV4cG9ydHMuRGlydHlDaGVja1Byb3BlcnR5ID0gZXhwb3J0cy5EaXJ0eUNoZWNrZXIgPSBleHBvcnRzLkV2ZW50TWFuYWdlciA9IGV4cG9ydHMuZ2V0TWFwT2JzZXJ2ZXIgPSBleHBvcnRzLlBhcnNlckltcGxlbWVudGF0aW9uID0gZXhwb3J0cy5QYXJzZXIgPSBleHBvcnRzLlNjYW5uZXIgPSBleHBvcnRzLkxleGVyID0gZXhwb3J0cy5Ub2tlbiA9IGV4cG9ydHMuYmluZGluZ01vZGUgPSBleHBvcnRzLkV4cHJlc3Npb25DbG9uZXIgPSBleHBvcnRzLlVucGFyc2VyID0gZXhwb3J0cy5MaXRlcmFsT2JqZWN0ID0gZXhwb3J0cy5MaXRlcmFsQXJyYXkgPSBleHBvcnRzLkxpdGVyYWxTdHJpbmcgPSBleHBvcnRzLkxpdGVyYWxQcmltaXRpdmUgPSBleHBvcnRzLlByZWZpeE5vdCA9IGV4cG9ydHMuQmluYXJ5ID0gZXhwb3J0cy5DYWxsRnVuY3Rpb24gPSBleHBvcnRzLkNhbGxNZW1iZXIgPSBleHBvcnRzLkNhbGxTY29wZSA9IGV4cG9ydHMuQWNjZXNzS2V5ZWQgPSBleHBvcnRzLkFjY2Vzc01lbWJlciA9IGV4cG9ydHMuQWNjZXNzU2NvcGUgPSBleHBvcnRzLkFjY2Vzc1RoaXMgPSBleHBvcnRzLkNvbmRpdGlvbmFsID0gZXhwb3J0cy5Bc3NpZ24gPSBleHBvcnRzLlZhbHVlQ29udmVydGVyID0gZXhwb3J0cy5CaW5kaW5nQmVoYXZpb3IgPSBleHBvcnRzLkNoYWluID0gZXhwb3J0cy5FeHByZXNzaW9uID0gZXhwb3J0cy5nZXRBcnJheU9ic2VydmVyID0gZXhwb3J0cy5Db2xsZWN0aW9uTGVuZ3RoT2JzZXJ2ZXIgPSBleHBvcnRzLk1vZGlmeUNvbGxlY3Rpb25PYnNlcnZlciA9IGV4cG9ydHMuRXhwcmVzc2lvbk9ic2VydmVyID0gZXhwb3J0cy5zb3VyY2VDb250ZXh0ID0gdW5kZWZpbmVkO1xuXG52YXIgX3R5cGVvZiA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSBcInN5bWJvbFwiID8gZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfSA6IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgPyBcInN5bWJvbFwiIDogdHlwZW9mIG9iajsgfTtcblxudmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTtcblxudmFyIF9kZWMsIF9kZWMyLCBfY2xhc3MsIF9kZWMzLCBfY2xhc3MyLCBfZGVjNCwgX2NsYXNzMywgX2RlYzUsIF9jbGFzczUsIF9kZWM2LCBfY2xhc3M3LCBfZGVjNywgX2NsYXNzOCwgX2RlYzgsIF9jbGFzczksIF9kZWM5LCBfY2xhc3MxMCwgX2NsYXNzMTEsIF90ZW1wLCBfZGVjMTAsIF9jbGFzczEyLCBfY2xhc3MxMywgX3RlbXAyO1xuXG5leHBvcnRzLmNhbWVsQ2FzZSA9IGNhbWVsQ2FzZTtcbmV4cG9ydHMuY3JlYXRlT3ZlcnJpZGVDb250ZXh0ID0gY3JlYXRlT3ZlcnJpZGVDb250ZXh0O1xuZXhwb3J0cy5nZXRDb250ZXh0Rm9yID0gZ2V0Q29udGV4dEZvcjtcbmV4cG9ydHMuY3JlYXRlU2NvcGVGb3JUZXN0ID0gY3JlYXRlU2NvcGVGb3JUZXN0O1xuZXhwb3J0cy5jb25uZWN0YWJsZSA9IGNvbm5lY3RhYmxlO1xuZXhwb3J0cy5lbnF1ZXVlQmluZGluZ0Nvbm5lY3QgPSBlbnF1ZXVlQmluZGluZ0Nvbm5lY3Q7XG5leHBvcnRzLnN1YnNjcmliZXJDb2xsZWN0aW9uID0gc3Vic2NyaWJlckNvbGxlY3Rpb247XG5leHBvcnRzLmNhbGNTcGxpY2VzID0gY2FsY1NwbGljZXM7XG5leHBvcnRzLm1lcmdlU3BsaWNlID0gbWVyZ2VTcGxpY2U7XG5leHBvcnRzLnByb2plY3RBcnJheVNwbGljZXMgPSBwcm9qZWN0QXJyYXlTcGxpY2VzO1xuZXhwb3J0cy5nZXRDaGFuZ2VSZWNvcmRzID0gZ2V0Q2hhbmdlUmVjb3JkcztcbmV4cG9ydHMuY2xvbmVFeHByZXNzaW9uID0gY2xvbmVFeHByZXNzaW9uO1xuZXhwb3J0cy5oYXNEZWNsYXJlZERlcGVuZGVuY2llcyA9IGhhc0RlY2xhcmVkRGVwZW5kZW5jaWVzO1xuZXhwb3J0cy5kZWNsYXJlUHJvcGVydHlEZXBlbmRlbmNpZXMgPSBkZWNsYXJlUHJvcGVydHlEZXBlbmRlbmNpZXM7XG5leHBvcnRzLmNvbXB1dGVkRnJvbSA9IGNvbXB1dGVkRnJvbTtcbmV4cG9ydHMuY3JlYXRlQ29tcHV0ZWRPYnNlcnZlciA9IGNyZWF0ZUNvbXB1dGVkT2JzZXJ2ZXI7XG5leHBvcnRzLnZhbHVlQ29udmVydGVyID0gdmFsdWVDb252ZXJ0ZXI7XG5leHBvcnRzLmJpbmRpbmdCZWhhdmlvciA9IGJpbmRpbmdCZWhhdmlvcjtcbmV4cG9ydHMub2JzZXJ2YWJsZSA9IG9ic2VydmFibGU7XG5cbnZhciBfYXVyZWxpYUxvZ2dpbmcgPSByZXF1aXJlKCdhdXJlbGlhLWxvZ2dpbmcnKTtcblxudmFyIExvZ01hbmFnZXIgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChfYXVyZWxpYUxvZ2dpbmcpO1xuXG52YXIgX2F1cmVsaWFQYWwgPSByZXF1aXJlKCdhdXJlbGlhLXBhbCcpO1xuXG52YXIgX2F1cmVsaWFUYXNrUXVldWUgPSByZXF1aXJlKCdhdXJlbGlhLXRhc2stcXVldWUnKTtcblxudmFyIF9hdXJlbGlhTWV0YWRhdGEgPSByZXF1aXJlKCdhdXJlbGlhLW1ldGFkYXRhJyk7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgeyBpZiAob2JqICYmIG9iai5fX2VzTW9kdWxlKSB7IHJldHVybiBvYmo7IH0gZWxzZSB7IHZhciBuZXdPYmogPSB7fTsgaWYgKG9iaiAhPSBudWxsKSB7IGZvciAodmFyIGtleSBpbiBvYmopIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIG5ld09ialtrZXldID0gb2JqW2tleV07IH0gfSBuZXdPYmouZGVmYXVsdCA9IG9iajsgcmV0dXJuIG5ld09iajsgfSB9XG5cbmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKCFzZWxmKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcihcInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZFwiKTsgfSByZXR1cm4gY2FsbCAmJiAodHlwZW9mIGNhbGwgPT09IFwib2JqZWN0XCIgfHwgdHlwZW9mIGNhbGwgPT09IFwiZnVuY3Rpb25cIikgPyBjYWxsIDogc2VsZjsgfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSBcImZ1bmN0aW9uXCIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCBcIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH1cblxuXG5cbnZhciBtYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXG5mdW5jdGlvbiBjYW1lbENhc2UobmFtZSkge1xuICBpZiAobmFtZSBpbiBtYXApIHtcbiAgICByZXR1cm4gbWFwW25hbWVdO1xuICB9XG4gIHZhciByZXN1bHQgPSBuYW1lLmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpICsgbmFtZS5zbGljZSgxKS5yZXBsYWNlKC9bXy4tXShcXHd8JCkvZywgZnVuY3Rpb24gKF8sIHgpIHtcbiAgICByZXR1cm4geC50b1VwcGVyQ2FzZSgpO1xuICB9KTtcbiAgbWFwW25hbWVdID0gcmVzdWx0O1xuICByZXR1cm4gcmVzdWx0O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVPdmVycmlkZUNvbnRleHQoYmluZGluZ0NvbnRleHQsIHBhcmVudE92ZXJyaWRlQ29udGV4dCkge1xuICByZXR1cm4ge1xuICAgIGJpbmRpbmdDb250ZXh0OiBiaW5kaW5nQ29udGV4dCxcbiAgICBwYXJlbnRPdmVycmlkZUNvbnRleHQ6IHBhcmVudE92ZXJyaWRlQ29udGV4dCB8fCBudWxsXG4gIH07XG59XG5cbmZ1bmN0aW9uIGdldENvbnRleHRGb3IobmFtZSwgc2NvcGUsIGFuY2VzdG9yKSB7XG4gIHZhciBvYyA9IHNjb3BlLm92ZXJyaWRlQ29udGV4dDtcblxuICBpZiAoYW5jZXN0b3IpIHtcbiAgICB3aGlsZSAoYW5jZXN0b3IgJiYgb2MpIHtcbiAgICAgIGFuY2VzdG9yLS07XG4gICAgICBvYyA9IG9jLnBhcmVudE92ZXJyaWRlQ29udGV4dDtcbiAgICB9XG4gICAgaWYgKGFuY2VzdG9yIHx8ICFvYykge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgcmV0dXJuIG5hbWUgaW4gb2MgPyBvYyA6IG9jLmJpbmRpbmdDb250ZXh0O1xuICB9XG5cbiAgd2hpbGUgKG9jICYmICEobmFtZSBpbiBvYykgJiYgIShvYy5iaW5kaW5nQ29udGV4dCAmJiBuYW1lIGluIG9jLmJpbmRpbmdDb250ZXh0KSkge1xuICAgIG9jID0gb2MucGFyZW50T3ZlcnJpZGVDb250ZXh0O1xuICB9XG4gIGlmIChvYykge1xuICAgIHJldHVybiBuYW1lIGluIG9jID8gb2MgOiBvYy5iaW5kaW5nQ29udGV4dDtcbiAgfVxuXG4gIHJldHVybiBzY29wZS5iaW5kaW5nQ29udGV4dCB8fCBzY29wZS5vdmVycmlkZUNvbnRleHQ7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVNjb3BlRm9yVGVzdChiaW5kaW5nQ29udGV4dCwgcGFyZW50QmluZGluZ0NvbnRleHQpIHtcbiAgaWYgKHBhcmVudEJpbmRpbmdDb250ZXh0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGJpbmRpbmdDb250ZXh0OiBiaW5kaW5nQ29udGV4dCxcbiAgICAgIG92ZXJyaWRlQ29udGV4dDogY3JlYXRlT3ZlcnJpZGVDb250ZXh0KGJpbmRpbmdDb250ZXh0LCBjcmVhdGVPdmVycmlkZUNvbnRleHQocGFyZW50QmluZGluZ0NvbnRleHQpKVxuICAgIH07XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBiaW5kaW5nQ29udGV4dDogYmluZGluZ0NvbnRleHQsXG4gICAgb3ZlcnJpZGVDb250ZXh0OiBjcmVhdGVPdmVycmlkZUNvbnRleHQoYmluZGluZ0NvbnRleHQpXG4gIH07XG59XG5cbnZhciBzb3VyY2VDb250ZXh0ID0gZXhwb3J0cy5zb3VyY2VDb250ZXh0ID0gJ0JpbmRpbmc6c291cmNlJztcbnZhciBzbG90TmFtZXMgPSBbXTtcbnZhciB2ZXJzaW9uU2xvdE5hbWVzID0gW107XG5cbmZvciAodmFyIGkgPSAwOyBpIDwgMTAwOyBpKyspIHtcbiAgc2xvdE5hbWVzLnB1c2goJ19vYnNlcnZlcicgKyBpKTtcbiAgdmVyc2lvblNsb3ROYW1lcy5wdXNoKCdfb2JzZXJ2ZXJWZXJzaW9uJyArIGkpO1xufVxuXG5mdW5jdGlvbiBhZGRPYnNlcnZlcihvYnNlcnZlcikge1xuICB2YXIgb2JzZXJ2ZXJTbG90cyA9IHRoaXMuX29ic2VydmVyU2xvdHMgPT09IHVuZGVmaW5lZCA/IDAgOiB0aGlzLl9vYnNlcnZlclNsb3RzO1xuICB2YXIgaSA9IG9ic2VydmVyU2xvdHM7XG4gIHdoaWxlIChpLS0gJiYgdGhpc1tzbG90TmFtZXNbaV1dICE9PSBvYnNlcnZlcikge31cblxuICBpZiAoaSA9PT0gLTEpIHtcbiAgICBpID0gMDtcbiAgICB3aGlsZSAodGhpc1tzbG90TmFtZXNbaV1dKSB7XG4gICAgICBpKys7XG4gICAgfVxuICAgIHRoaXNbc2xvdE5hbWVzW2ldXSA9IG9ic2VydmVyO1xuICAgIG9ic2VydmVyLnN1YnNjcmliZShzb3VyY2VDb250ZXh0LCB0aGlzKTtcblxuICAgIGlmIChpID09PSBvYnNlcnZlclNsb3RzKSB7XG4gICAgICB0aGlzLl9vYnNlcnZlclNsb3RzID0gaSArIDE7XG4gICAgfVxuICB9XG5cbiAgaWYgKHRoaXMuX3ZlcnNpb24gPT09IHVuZGVmaW5lZCkge1xuICAgIHRoaXMuX3ZlcnNpb24gPSAwO1xuICB9XG4gIHRoaXNbdmVyc2lvblNsb3ROYW1lc1tpXV0gPSB0aGlzLl92ZXJzaW9uO1xufVxuXG5mdW5jdGlvbiBvYnNlcnZlUHJvcGVydHkob2JqLCBwcm9wZXJ0eU5hbWUpIHtcbiAgdmFyIG9ic2VydmVyID0gdGhpcy5vYnNlcnZlckxvY2F0b3IuZ2V0T2JzZXJ2ZXIob2JqLCBwcm9wZXJ0eU5hbWUpO1xuICBhZGRPYnNlcnZlci5jYWxsKHRoaXMsIG9ic2VydmVyKTtcbn1cblxuZnVuY3Rpb24gb2JzZXJ2ZUFycmF5KGFycmF5KSB7XG4gIHZhciBvYnNlcnZlciA9IHRoaXMub2JzZXJ2ZXJMb2NhdG9yLmdldEFycmF5T2JzZXJ2ZXIoYXJyYXkpO1xuICBhZGRPYnNlcnZlci5jYWxsKHRoaXMsIG9ic2VydmVyKTtcbn1cblxuZnVuY3Rpb24gdW5vYnNlcnZlKGFsbCkge1xuICB2YXIgaSA9IHRoaXMuX29ic2VydmVyU2xvdHM7XG4gIHdoaWxlIChpLS0pIHtcbiAgICBpZiAoYWxsIHx8IHRoaXNbdmVyc2lvblNsb3ROYW1lc1tpXV0gIT09IHRoaXMuX3ZlcnNpb24pIHtcbiAgICAgIHZhciBvYnNlcnZlciA9IHRoaXNbc2xvdE5hbWVzW2ldXTtcbiAgICAgIHRoaXNbc2xvdE5hbWVzW2ldXSA9IG51bGw7XG4gICAgICBpZiAob2JzZXJ2ZXIpIHtcbiAgICAgICAgb2JzZXJ2ZXIudW5zdWJzY3JpYmUoc291cmNlQ29udGV4dCwgdGhpcyk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGNvbm5lY3RhYmxlKCkge1xuICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCkge1xuICAgIHRhcmdldC5wcm90b3R5cGUub2JzZXJ2ZVByb3BlcnR5ID0gb2JzZXJ2ZVByb3BlcnR5O1xuICAgIHRhcmdldC5wcm90b3R5cGUub2JzZXJ2ZUFycmF5ID0gb2JzZXJ2ZUFycmF5O1xuICAgIHRhcmdldC5wcm90b3R5cGUudW5vYnNlcnZlID0gdW5vYnNlcnZlO1xuICAgIHRhcmdldC5wcm90b3R5cGUuYWRkT2JzZXJ2ZXIgPSBhZGRPYnNlcnZlcjtcbiAgfTtcbn1cblxudmFyIGJpbmRpbmdzID0gbmV3IE1hcCgpO1xudmFyIG1pbmltdW1JbW1lZGlhdGUgPSAxMDA7XG52YXIgZnJhbWVCdWRnZXQgPSAxNTtcblxudmFyIGlzRmx1c2hSZXF1ZXN0ZWQgPSBmYWxzZTtcbnZhciBpbW1lZGlhdGUgPSAwO1xuXG5mdW5jdGlvbiBmbHVzaChhbmltYXRpb25GcmFtZVN0YXJ0KSB7XG4gIHZhciBpID0gMDtcbiAgdmFyIGtleXMgPSBiaW5kaW5ncy5rZXlzKCk7XG4gIHZhciBpdGVtID0gdm9pZCAwO1xuXG4gIHdoaWxlIChpdGVtID0ga2V5cy5uZXh0KCkpIHtcbiAgICBpZiAoaXRlbS5kb25lKSB7XG4gICAgICBicmVhaztcbiAgICB9XG5cbiAgICB2YXIgYmluZGluZyA9IGl0ZW0udmFsdWU7XG4gICAgYmluZGluZ3MuZGVsZXRlKGJpbmRpbmcpO1xuICAgIGJpbmRpbmcuY29ubmVjdCh0cnVlKTtcbiAgICBpKys7XG5cbiAgICBpZiAoaSAlIDEwMCA9PT0gMCAmJiBfYXVyZWxpYVBhbC5QTEFURk9STS5wZXJmb3JtYW5jZS5ub3coKSAtIGFuaW1hdGlvbkZyYW1lU3RhcnQgPiBmcmFtZUJ1ZGdldCkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgaWYgKGJpbmRpbmdzLnNpemUpIHtcbiAgICBfYXVyZWxpYVBhbC5QTEFURk9STS5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZmx1c2gpO1xuICB9IGVsc2Uge1xuICAgIGlzRmx1c2hSZXF1ZXN0ZWQgPSBmYWxzZTtcbiAgICBpbW1lZGlhdGUgPSAwO1xuICB9XG59XG5cbmZ1bmN0aW9uIGVucXVldWVCaW5kaW5nQ29ubmVjdChiaW5kaW5nKSB7XG4gIGlmIChpbW1lZGlhdGUgPCBtaW5pbXVtSW1tZWRpYXRlKSB7XG4gICAgaW1tZWRpYXRlKys7XG4gICAgYmluZGluZy5jb25uZWN0KGZhbHNlKTtcbiAgfSBlbHNlIHtcbiAgICBiaW5kaW5ncy5zZXQoYmluZGluZyk7XG4gIH1cbiAgaWYgKCFpc0ZsdXNoUmVxdWVzdGVkKSB7XG4gICAgaXNGbHVzaFJlcXVlc3RlZCA9IHRydWU7XG4gICAgX2F1cmVsaWFQYWwuUExBVEZPUk0ucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZsdXNoKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhZGRTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gIGlmICh0aGlzLmhhc1N1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGlmICghdGhpcy5fY29udGV4dDApIHtcbiAgICB0aGlzLl9jb250ZXh0MCA9IGNvbnRleHQ7XG4gICAgdGhpcy5fY2FsbGFibGUwID0gY2FsbGFibGU7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgaWYgKCF0aGlzLl9jb250ZXh0MSkge1xuICAgIHRoaXMuX2NvbnRleHQxID0gY29udGV4dDtcbiAgICB0aGlzLl9jYWxsYWJsZTEgPSBjYWxsYWJsZTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAoIXRoaXMuX2NvbnRleHQyKSB7XG4gICAgdGhpcy5fY29udGV4dDIgPSBjb250ZXh0O1xuICAgIHRoaXMuX2NhbGxhYmxlMiA9IGNhbGxhYmxlO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGlmICghdGhpcy5fY29udGV4dHNSZXN0KSB7XG4gICAgdGhpcy5fY29udGV4dHNSZXN0ID0gW2NvbnRleHRdO1xuICAgIHRoaXMuX2NhbGxhYmxlc1Jlc3QgPSBbY2FsbGFibGVdO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHRoaXMuX2NvbnRleHRzUmVzdC5wdXNoKGNvbnRleHQpO1xuICB0aGlzLl9jYWxsYWJsZXNSZXN0LnB1c2goY2FsbGFibGUpO1xuICByZXR1cm4gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gcmVtb3ZlU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSkge1xuICBpZiAodGhpcy5fY29udGV4dDAgPT09IGNvbnRleHQgJiYgdGhpcy5fY2FsbGFibGUwID09PSBjYWxsYWJsZSkge1xuICAgIHRoaXMuX2NvbnRleHQwID0gbnVsbDtcbiAgICB0aGlzLl9jYWxsYWJsZTAgPSBudWxsO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGlmICh0aGlzLl9jb250ZXh0MSA9PT0gY29udGV4dCAmJiB0aGlzLl9jYWxsYWJsZTEgPT09IGNhbGxhYmxlKSB7XG4gICAgdGhpcy5fY29udGV4dDEgPSBudWxsO1xuICAgIHRoaXMuX2NhbGxhYmxlMSA9IG51bGw7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgaWYgKHRoaXMuX2NvbnRleHQyID09PSBjb250ZXh0ICYmIHRoaXMuX2NhbGxhYmxlMiA9PT0gY2FsbGFibGUpIHtcbiAgICB0aGlzLl9jb250ZXh0MiA9IG51bGw7XG4gICAgdGhpcy5fY2FsbGFibGUyID0gbnVsbDtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICB2YXIgcmVzdCA9IHRoaXMuX2NvbnRleHRzUmVzdDtcbiAgdmFyIGluZGV4ID0gdm9pZCAwO1xuICBpZiAoIXJlc3QgfHwgIXJlc3QubGVuZ3RoIHx8IChpbmRleCA9IHJlc3QuaW5kZXhPZihjb250ZXh0KSkgPT09IC0xIHx8IHRoaXMuX2NhbGxhYmxlc1Jlc3RbaW5kZXhdICE9PSBjYWxsYWJsZSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICByZXN0LnNwbGljZShpbmRleCwgMSk7XG4gIHRoaXMuX2NhbGxhYmxlc1Jlc3Quc3BsaWNlKGluZGV4LCAxKTtcbiAgcmV0dXJuIHRydWU7XG59XG5cbnZhciBhcnJheVBvb2wxID0gW107XG52YXIgYXJyYXlQb29sMiA9IFtdO1xudmFyIHBvb2xVdGlsaXphdGlvbiA9IFtdO1xuXG5mdW5jdGlvbiBjYWxsU3Vic2NyaWJlcnMobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gIHZhciBjb250ZXh0MCA9IHRoaXMuX2NvbnRleHQwO1xuICB2YXIgY2FsbGFibGUwID0gdGhpcy5fY2FsbGFibGUwO1xuICB2YXIgY29udGV4dDEgPSB0aGlzLl9jb250ZXh0MTtcbiAgdmFyIGNhbGxhYmxlMSA9IHRoaXMuX2NhbGxhYmxlMTtcbiAgdmFyIGNvbnRleHQyID0gdGhpcy5fY29udGV4dDI7XG4gIHZhciBjYWxsYWJsZTIgPSB0aGlzLl9jYWxsYWJsZTI7XG4gIHZhciBsZW5ndGggPSB0aGlzLl9jb250ZXh0c1Jlc3QgPyB0aGlzLl9jb250ZXh0c1Jlc3QubGVuZ3RoIDogMDtcbiAgdmFyIGNvbnRleHRzUmVzdCA9IHZvaWQgMDtcbiAgdmFyIGNhbGxhYmxlc1Jlc3QgPSB2b2lkIDA7XG4gIHZhciBwb29sSW5kZXggPSB2b2lkIDA7XG4gIHZhciBpID0gdm9pZCAwO1xuICBpZiAobGVuZ3RoKSB7XG4gICAgcG9vbEluZGV4ID0gcG9vbFV0aWxpemF0aW9uLmxlbmd0aDtcbiAgICB3aGlsZSAocG9vbEluZGV4LS0gJiYgcG9vbFV0aWxpemF0aW9uW3Bvb2xJbmRleF0pIHt9XG4gICAgaWYgKHBvb2xJbmRleCA8IDApIHtcbiAgICAgIHBvb2xJbmRleCA9IHBvb2xVdGlsaXphdGlvbi5sZW5ndGg7XG4gICAgICBjb250ZXh0c1Jlc3QgPSBbXTtcbiAgICAgIGNhbGxhYmxlc1Jlc3QgPSBbXTtcbiAgICAgIHBvb2xVdGlsaXphdGlvbi5wdXNoKHRydWUpO1xuICAgICAgYXJyYXlQb29sMS5wdXNoKGNvbnRleHRzUmVzdCk7XG4gICAgICBhcnJheVBvb2wyLnB1c2goY2FsbGFibGVzUmVzdCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBvb2xVdGlsaXphdGlvbltwb29sSW5kZXhdID0gdHJ1ZTtcbiAgICAgIGNvbnRleHRzUmVzdCA9IGFycmF5UG9vbDFbcG9vbEluZGV4XTtcbiAgICAgIGNhbGxhYmxlc1Jlc3QgPSBhcnJheVBvb2wyW3Bvb2xJbmRleF07XG4gICAgfVxuXG4gICAgaSA9IGxlbmd0aDtcbiAgICB3aGlsZSAoaS0tKSB7XG4gICAgICBjb250ZXh0c1Jlc3RbaV0gPSB0aGlzLl9jb250ZXh0c1Jlc3RbaV07XG4gICAgICBjYWxsYWJsZXNSZXN0W2ldID0gdGhpcy5fY2FsbGFibGVzUmVzdFtpXTtcbiAgICB9XG4gIH1cblxuICBpZiAoY29udGV4dDApIHtcbiAgICBpZiAoY2FsbGFibGUwKSB7XG4gICAgICBjYWxsYWJsZTAuY2FsbChjb250ZXh0MCwgbmV3VmFsdWUsIG9sZFZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29udGV4dDAobmV3VmFsdWUsIG9sZFZhbHVlKTtcbiAgICB9XG4gIH1cbiAgaWYgKGNvbnRleHQxKSB7XG4gICAgaWYgKGNhbGxhYmxlMSkge1xuICAgICAgY2FsbGFibGUxLmNhbGwoY29udGV4dDEsIG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnRleHQxKG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gICAgfVxuICB9XG4gIGlmIChjb250ZXh0Mikge1xuICAgIGlmIChjYWxsYWJsZTIpIHtcbiAgICAgIGNhbGxhYmxlMi5jYWxsKGNvbnRleHQyLCBuZXdWYWx1ZSwgb2xkVmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb250ZXh0MihuZXdWYWx1ZSwgb2xkVmFsdWUpO1xuICAgIH1cbiAgfVxuICBpZiAobGVuZ3RoKSB7XG4gICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgY2FsbGFibGUgPSBjYWxsYWJsZXNSZXN0W2ldO1xuICAgICAgdmFyIGNvbnRleHQgPSBjb250ZXh0c1Jlc3RbaV07XG4gICAgICBpZiAoY2FsbGFibGUpIHtcbiAgICAgICAgY2FsbGFibGUuY2FsbChjb250ZXh0LCBuZXdWYWx1ZSwgb2xkVmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29udGV4dChuZXdWYWx1ZSwgb2xkVmFsdWUpO1xuICAgICAgfVxuICAgICAgY29udGV4dHNSZXN0W2ldID0gbnVsbDtcbiAgICAgIGNhbGxhYmxlc1Jlc3RbaV0gPSBudWxsO1xuICAgIH1cbiAgICBwb29sVXRpbGl6YXRpb25bcG9vbEluZGV4XSA9IGZhbHNlO1xuICB9XG59XG5cbmZ1bmN0aW9uIGhhc1N1YnNjcmliZXJzKCkge1xuICByZXR1cm4gISEodGhpcy5fY29udGV4dDAgfHwgdGhpcy5fY29udGV4dDEgfHwgdGhpcy5fY29udGV4dDIgfHwgdGhpcy5fY29udGV4dHNSZXN0ICYmIHRoaXMuX2NvbnRleHRzUmVzdC5sZW5ndGgpO1xufVxuXG5mdW5jdGlvbiBoYXNTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gIHZhciBoYXMgPSB0aGlzLl9jb250ZXh0MCA9PT0gY29udGV4dCAmJiB0aGlzLl9jYWxsYWJsZTAgPT09IGNhbGxhYmxlIHx8IHRoaXMuX2NvbnRleHQxID09PSBjb250ZXh0ICYmIHRoaXMuX2NhbGxhYmxlMSA9PT0gY2FsbGFibGUgfHwgdGhpcy5fY29udGV4dDIgPT09IGNvbnRleHQgJiYgdGhpcy5fY2FsbGFibGUyID09PSBjYWxsYWJsZTtcbiAgaWYgKGhhcykge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHZhciBpbmRleCA9IHZvaWQgMDtcbiAgdmFyIGNvbnRleHRzID0gdGhpcy5fY29udGV4dHNSZXN0O1xuICBpZiAoIWNvbnRleHRzIHx8IChpbmRleCA9IGNvbnRleHRzLmxlbmd0aCkgPT09IDApIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgdmFyIGNhbGxhYmxlcyA9IHRoaXMuX2NhbGxhYmxlc1Jlc3Q7XG4gIHdoaWxlIChpbmRleC0tKSB7XG4gICAgaWYgKGNvbnRleHRzW2luZGV4XSA9PT0gY29udGV4dCAmJiBjYWxsYWJsZXNbaW5kZXhdID09PSBjYWxsYWJsZSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gc3Vic2NyaWJlckNvbGxlY3Rpb24oKSB7XG4gIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgdGFyZ2V0LnByb3RvdHlwZS5hZGRTdWJzY3JpYmVyID0gYWRkU3Vic2NyaWJlcjtcbiAgICB0YXJnZXQucHJvdG90eXBlLnJlbW92ZVN1YnNjcmliZXIgPSByZW1vdmVTdWJzY3JpYmVyO1xuICAgIHRhcmdldC5wcm90b3R5cGUuY2FsbFN1YnNjcmliZXJzID0gY2FsbFN1YnNjcmliZXJzO1xuICAgIHRhcmdldC5wcm90b3R5cGUuaGFzU3Vic2NyaWJlcnMgPSBoYXNTdWJzY3JpYmVycztcbiAgICB0YXJnZXQucHJvdG90eXBlLmhhc1N1YnNjcmliZXIgPSBoYXNTdWJzY3JpYmVyO1xuICB9O1xufVxuXG52YXIgRXhwcmVzc2lvbk9ic2VydmVyID0gZXhwb3J0cy5FeHByZXNzaW9uT2JzZXJ2ZXIgPSAoX2RlYyA9IGNvbm5lY3RhYmxlKCksIF9kZWMyID0gc3Vic2NyaWJlckNvbGxlY3Rpb24oKSwgX2RlYyhfY2xhc3MgPSBfZGVjMihfY2xhc3MgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEV4cHJlc3Npb25PYnNlcnZlcihzY29wZSwgZXhwcmVzc2lvbiwgb2JzZXJ2ZXJMb2NhdG9yLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICBcblxuICAgIHRoaXMuc2NvcGUgPSBzY29wZTtcbiAgICB0aGlzLmV4cHJlc3Npb24gPSBleHByZXNzaW9uO1xuICAgIHRoaXMub2JzZXJ2ZXJMb2NhdG9yID0gb2JzZXJ2ZXJMb2NhdG9yO1xuICAgIHRoaXMubG9va3VwRnVuY3Rpb25zID0gbG9va3VwRnVuY3Rpb25zO1xuICB9XG5cbiAgRXhwcmVzc2lvbk9ic2VydmVyLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIGdldFZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLmV4cHJlc3Npb24uZXZhbHVhdGUodGhpcy5zY29wZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25PYnNlcnZlci5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbiBzZXRWYWx1ZShuZXdWYWx1ZSkge1xuICAgIHRoaXMuZXhwcmVzc2lvbi5hc3NpZ24odGhpcy5zY29wZSwgbmV3VmFsdWUpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25PYnNlcnZlci5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gc3Vic2NyaWJlKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgIGlmICghdGhpcy5oYXNTdWJzY3JpYmVycygpKSB7XG4gICAgICB0aGlzLm9sZFZhbHVlID0gdGhpcy5leHByZXNzaW9uLmV2YWx1YXRlKHRoaXMuc2NvcGUsIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcbiAgICAgIHRoaXMuZXhwcmVzc2lvbi5jb25uZWN0KHRoaXMsIHRoaXMuc2NvcGUpO1xuICAgIH1cbiAgICB0aGlzLmFkZFN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpO1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxICYmIGNvbnRleHQgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZGlzcG9zZTogZnVuY3Rpb24gZGlzcG9zZSgpIHtcbiAgICAgICAgICBfdGhpcy51bnN1YnNjcmliZShjb250ZXh0LCBjYWxsYWJsZSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICB9O1xuXG4gIEV4cHJlc3Npb25PYnNlcnZlci5wcm90b3R5cGUudW5zdWJzY3JpYmUgPSBmdW5jdGlvbiB1bnN1YnNjcmliZShjb250ZXh0LCBjYWxsYWJsZSkge1xuICAgIGlmICh0aGlzLnJlbW92ZVN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpICYmICF0aGlzLmhhc1N1YnNjcmliZXJzKCkpIHtcbiAgICAgIHRoaXMudW5vYnNlcnZlKHRydWUpO1xuICAgICAgdGhpcy5vbGRWYWx1ZSA9IHVuZGVmaW5lZDtcbiAgICB9XG4gIH07XG5cbiAgRXhwcmVzc2lvbk9ic2VydmVyLnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gY2FsbCgpIHtcbiAgICB2YXIgbmV3VmFsdWUgPSB0aGlzLmV4cHJlc3Npb24uZXZhbHVhdGUodGhpcy5zY29wZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMub2xkVmFsdWU7XG4gICAgaWYgKG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSkge1xuICAgICAgdGhpcy5vbGRWYWx1ZSA9IG5ld1ZhbHVlO1xuICAgICAgdGhpcy5jYWxsU3Vic2NyaWJlcnMobmV3VmFsdWUsIG9sZFZhbHVlKTtcbiAgICB9XG4gICAgdGhpcy5fdmVyc2lvbisrO1xuICAgIHRoaXMuZXhwcmVzc2lvbi5jb25uZWN0KHRoaXMsIHRoaXMuc2NvcGUpO1xuICAgIHRoaXMudW5vYnNlcnZlKGZhbHNlKTtcbiAgfTtcblxuICByZXR1cm4gRXhwcmVzc2lvbk9ic2VydmVyO1xufSgpKSB8fCBfY2xhc3MpIHx8IF9jbGFzcyk7XG5cblxuZnVuY3Rpb24gaXNJbmRleChzKSB7XG4gIHJldHVybiArcyA9PT0gcyA+Pj4gMDtcbn1cblxuZnVuY3Rpb24gdG9OdW1iZXIocykge1xuICByZXR1cm4gK3M7XG59XG5cbmZ1bmN0aW9uIG5ld1NwbGljZShpbmRleCwgcmVtb3ZlZCwgYWRkZWRDb3VudCkge1xuICByZXR1cm4ge1xuICAgIGluZGV4OiBpbmRleCxcbiAgICByZW1vdmVkOiByZW1vdmVkLFxuICAgIGFkZGVkQ291bnQ6IGFkZGVkQ291bnRcbiAgfTtcbn1cblxudmFyIEVESVRfTEVBVkUgPSAwO1xudmFyIEVESVRfVVBEQVRFID0gMTtcbnZhciBFRElUX0FERCA9IDI7XG52YXIgRURJVF9ERUxFVEUgPSAzO1xuXG5mdW5jdGlvbiBBcnJheVNwbGljZSgpIHt9XG5cbkFycmF5U3BsaWNlLnByb3RvdHlwZSA9IHtcbiAgY2FsY0VkaXREaXN0YW5jZXM6IGZ1bmN0aW9uIGNhbGNFZGl0RGlzdGFuY2VzKGN1cnJlbnQsIGN1cnJlbnRTdGFydCwgY3VycmVudEVuZCwgb2xkLCBvbGRTdGFydCwgb2xkRW5kKSB7XG4gICAgdmFyIHJvd0NvdW50ID0gb2xkRW5kIC0gb2xkU3RhcnQgKyAxO1xuICAgIHZhciBjb2x1bW5Db3VudCA9IGN1cnJlbnRFbmQgLSBjdXJyZW50U3RhcnQgKyAxO1xuICAgIHZhciBkaXN0YW5jZXMgPSBuZXcgQXJyYXkocm93Q291bnQpO1xuICAgIHZhciBub3J0aCA9IHZvaWQgMDtcbiAgICB2YXIgd2VzdCA9IHZvaWQgMDtcblxuICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCByb3dDb3VudDsgKytfaSkge1xuICAgICAgZGlzdGFuY2VzW19pXSA9IG5ldyBBcnJheShjb2x1bW5Db3VudCk7XG4gICAgICBkaXN0YW5jZXNbX2ldWzBdID0gX2k7XG4gICAgfVxuXG4gICAgZm9yICh2YXIgaiA9IDA7IGogPCBjb2x1bW5Db3VudDsgKytqKSB7XG4gICAgICBkaXN0YW5jZXNbMF1bal0gPSBqO1xuICAgIH1cblxuICAgIGZvciAodmFyIF9pMiA9IDE7IF9pMiA8IHJvd0NvdW50OyArK19pMikge1xuICAgICAgZm9yICh2YXIgX2ogPSAxOyBfaiA8IGNvbHVtbkNvdW50OyArK19qKSB7XG4gICAgICAgIGlmICh0aGlzLmVxdWFscyhjdXJyZW50W2N1cnJlbnRTdGFydCArIF9qIC0gMV0sIG9sZFtvbGRTdGFydCArIF9pMiAtIDFdKSkge1xuICAgICAgICAgIGRpc3RhbmNlc1tfaTJdW19qXSA9IGRpc3RhbmNlc1tfaTIgLSAxXVtfaiAtIDFdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5vcnRoID0gZGlzdGFuY2VzW19pMiAtIDFdW19qXSArIDE7XG4gICAgICAgICAgd2VzdCA9IGRpc3RhbmNlc1tfaTJdW19qIC0gMV0gKyAxO1xuICAgICAgICAgIGRpc3RhbmNlc1tfaTJdW19qXSA9IG5vcnRoIDwgd2VzdCA/IG5vcnRoIDogd2VzdDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBkaXN0YW5jZXM7XG4gIH0sXG5cbiAgc3BsaWNlT3BlcmF0aW9uc0Zyb21FZGl0RGlzdGFuY2VzOiBmdW5jdGlvbiBzcGxpY2VPcGVyYXRpb25zRnJvbUVkaXREaXN0YW5jZXMoZGlzdGFuY2VzKSB7XG4gICAgdmFyIGkgPSBkaXN0YW5jZXMubGVuZ3RoIC0gMTtcbiAgICB2YXIgaiA9IGRpc3RhbmNlc1swXS5sZW5ndGggLSAxO1xuICAgIHZhciBjdXJyZW50ID0gZGlzdGFuY2VzW2ldW2pdO1xuICAgIHZhciBlZGl0cyA9IFtdO1xuICAgIHdoaWxlIChpID4gMCB8fCBqID4gMCkge1xuICAgICAgaWYgKGkgPT09IDApIHtcbiAgICAgICAgZWRpdHMucHVzaChFRElUX0FERCk7XG4gICAgICAgIGotLTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAoaiA9PT0gMCkge1xuICAgICAgICBlZGl0cy5wdXNoKEVESVRfREVMRVRFKTtcbiAgICAgICAgaS0tO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHZhciBub3J0aFdlc3QgPSBkaXN0YW5jZXNbaSAtIDFdW2ogLSAxXTtcbiAgICAgIHZhciB3ZXN0ID0gZGlzdGFuY2VzW2kgLSAxXVtqXTtcbiAgICAgIHZhciBub3J0aCA9IGRpc3RhbmNlc1tpXVtqIC0gMV07XG5cbiAgICAgIHZhciBtaW4gPSB2b2lkIDA7XG4gICAgICBpZiAod2VzdCA8IG5vcnRoKSB7XG4gICAgICAgIG1pbiA9IHdlc3QgPCBub3J0aFdlc3QgPyB3ZXN0IDogbm9ydGhXZXN0O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbWluID0gbm9ydGggPCBub3J0aFdlc3QgPyBub3J0aCA6IG5vcnRoV2VzdDtcbiAgICAgIH1cblxuICAgICAgaWYgKG1pbiA9PT0gbm9ydGhXZXN0KSB7XG4gICAgICAgIGlmIChub3J0aFdlc3QgPT09IGN1cnJlbnQpIHtcbiAgICAgICAgICBlZGl0cy5wdXNoKEVESVRfTEVBVkUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGVkaXRzLnB1c2goRURJVF9VUERBVEUpO1xuICAgICAgICAgIGN1cnJlbnQgPSBub3J0aFdlc3Q7XG4gICAgICAgIH1cbiAgICAgICAgaS0tO1xuICAgICAgICBqLS07XG4gICAgICB9IGVsc2UgaWYgKG1pbiA9PT0gd2VzdCkge1xuICAgICAgICBlZGl0cy5wdXNoKEVESVRfREVMRVRFKTtcbiAgICAgICAgaS0tO1xuICAgICAgICBjdXJyZW50ID0gd2VzdDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVkaXRzLnB1c2goRURJVF9BREQpO1xuICAgICAgICBqLS07XG4gICAgICAgIGN1cnJlbnQgPSBub3J0aDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBlZGl0cy5yZXZlcnNlKCk7XG4gICAgcmV0dXJuIGVkaXRzO1xuICB9LFxuXG4gIGNhbGNTcGxpY2VzOiBmdW5jdGlvbiBjYWxjU3BsaWNlcyhjdXJyZW50LCBjdXJyZW50U3RhcnQsIGN1cnJlbnRFbmQsIG9sZCwgb2xkU3RhcnQsIG9sZEVuZCkge1xuICAgIHZhciBwcmVmaXhDb3VudCA9IDA7XG4gICAgdmFyIHN1ZmZpeENvdW50ID0gMDtcblxuICAgIHZhciBtaW5MZW5ndGggPSBNYXRoLm1pbihjdXJyZW50RW5kIC0gY3VycmVudFN0YXJ0LCBvbGRFbmQgLSBvbGRTdGFydCk7XG4gICAgaWYgKGN1cnJlbnRTdGFydCA9PT0gMCAmJiBvbGRTdGFydCA9PT0gMCkge1xuICAgICAgcHJlZml4Q291bnQgPSB0aGlzLnNoYXJlZFByZWZpeChjdXJyZW50LCBvbGQsIG1pbkxlbmd0aCk7XG4gICAgfVxuXG4gICAgaWYgKGN1cnJlbnRFbmQgPT09IGN1cnJlbnQubGVuZ3RoICYmIG9sZEVuZCA9PT0gb2xkLmxlbmd0aCkge1xuICAgICAgc3VmZml4Q291bnQgPSB0aGlzLnNoYXJlZFN1ZmZpeChjdXJyZW50LCBvbGQsIG1pbkxlbmd0aCAtIHByZWZpeENvdW50KTtcbiAgICB9XG5cbiAgICBjdXJyZW50U3RhcnQgKz0gcHJlZml4Q291bnQ7XG4gICAgb2xkU3RhcnQgKz0gcHJlZml4Q291bnQ7XG4gICAgY3VycmVudEVuZCAtPSBzdWZmaXhDb3VudDtcbiAgICBvbGRFbmQgLT0gc3VmZml4Q291bnQ7XG5cbiAgICBpZiAoY3VycmVudEVuZCAtIGN1cnJlbnRTdGFydCA9PT0gMCAmJiBvbGRFbmQgLSBvbGRTdGFydCA9PT0gMCkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIGlmIChjdXJyZW50U3RhcnQgPT09IGN1cnJlbnRFbmQpIHtcbiAgICAgIHZhciBfc3BsaWNlID0gbmV3U3BsaWNlKGN1cnJlbnRTdGFydCwgW10sIDApO1xuICAgICAgd2hpbGUgKG9sZFN0YXJ0IDwgb2xkRW5kKSB7XG4gICAgICAgIF9zcGxpY2UucmVtb3ZlZC5wdXNoKG9sZFtvbGRTdGFydCsrXSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBbX3NwbGljZV07XG4gICAgfSBlbHNlIGlmIChvbGRTdGFydCA9PT0gb2xkRW5kKSB7XG4gICAgICByZXR1cm4gW25ld1NwbGljZShjdXJyZW50U3RhcnQsIFtdLCBjdXJyZW50RW5kIC0gY3VycmVudFN0YXJ0KV07XG4gICAgfVxuXG4gICAgdmFyIG9wcyA9IHRoaXMuc3BsaWNlT3BlcmF0aW9uc0Zyb21FZGl0RGlzdGFuY2VzKHRoaXMuY2FsY0VkaXREaXN0YW5jZXMoY3VycmVudCwgY3VycmVudFN0YXJ0LCBjdXJyZW50RW5kLCBvbGQsIG9sZFN0YXJ0LCBvbGRFbmQpKTtcblxuICAgIHZhciBzcGxpY2UgPSB1bmRlZmluZWQ7XG4gICAgdmFyIHNwbGljZXMgPSBbXTtcbiAgICB2YXIgaW5kZXggPSBjdXJyZW50U3RhcnQ7XG4gICAgdmFyIG9sZEluZGV4ID0gb2xkU3RhcnQ7XG4gICAgZm9yICh2YXIgX2kzID0gMDsgX2kzIDwgb3BzLmxlbmd0aDsgKytfaTMpIHtcbiAgICAgIHN3aXRjaCAob3BzW19pM10pIHtcbiAgICAgICAgY2FzZSBFRElUX0xFQVZFOlxuICAgICAgICAgIGlmIChzcGxpY2UpIHtcbiAgICAgICAgICAgIHNwbGljZXMucHVzaChzcGxpY2UpO1xuICAgICAgICAgICAgc3BsaWNlID0gdW5kZWZpbmVkO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGluZGV4Kys7XG4gICAgICAgICAgb2xkSW5kZXgrKztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBFRElUX1VQREFURTpcbiAgICAgICAgICBpZiAoIXNwbGljZSkge1xuICAgICAgICAgICAgc3BsaWNlID0gbmV3U3BsaWNlKGluZGV4LCBbXSwgMCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgc3BsaWNlLmFkZGVkQ291bnQrKztcbiAgICAgICAgICBpbmRleCsrO1xuXG4gICAgICAgICAgc3BsaWNlLnJlbW92ZWQucHVzaChvbGRbb2xkSW5kZXhdKTtcbiAgICAgICAgICBvbGRJbmRleCsrO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEVESVRfQUREOlxuICAgICAgICAgIGlmICghc3BsaWNlKSB7XG4gICAgICAgICAgICBzcGxpY2UgPSBuZXdTcGxpY2UoaW5kZXgsIFtdLCAwKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBzcGxpY2UuYWRkZWRDb3VudCsrO1xuICAgICAgICAgIGluZGV4Kys7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgRURJVF9ERUxFVEU6XG4gICAgICAgICAgaWYgKCFzcGxpY2UpIHtcbiAgICAgICAgICAgIHNwbGljZSA9IG5ld1NwbGljZShpbmRleCwgW10sIDApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHNwbGljZS5yZW1vdmVkLnB1c2gob2xkW29sZEluZGV4XSk7XG4gICAgICAgICAgb2xkSW5kZXgrKztcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoc3BsaWNlKSB7XG4gICAgICBzcGxpY2VzLnB1c2goc3BsaWNlKTtcbiAgICB9XG4gICAgcmV0dXJuIHNwbGljZXM7XG4gIH0sXG5cbiAgc2hhcmVkUHJlZml4OiBmdW5jdGlvbiBzaGFyZWRQcmVmaXgoY3VycmVudCwgb2xkLCBzZWFyY2hMZW5ndGgpIHtcbiAgICBmb3IgKHZhciBfaTQgPSAwOyBfaTQgPCBzZWFyY2hMZW5ndGg7ICsrX2k0KSB7XG4gICAgICBpZiAoIXRoaXMuZXF1YWxzKGN1cnJlbnRbX2k0XSwgb2xkW19pNF0pKSB7XG4gICAgICAgIHJldHVybiBfaTQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHNlYXJjaExlbmd0aDtcbiAgfSxcblxuICBzaGFyZWRTdWZmaXg6IGZ1bmN0aW9uIHNoYXJlZFN1ZmZpeChjdXJyZW50LCBvbGQsIHNlYXJjaExlbmd0aCkge1xuICAgIHZhciBpbmRleDEgPSBjdXJyZW50Lmxlbmd0aDtcbiAgICB2YXIgaW5kZXgyID0gb2xkLmxlbmd0aDtcbiAgICB2YXIgY291bnQgPSAwO1xuICAgIHdoaWxlIChjb3VudCA8IHNlYXJjaExlbmd0aCAmJiB0aGlzLmVxdWFscyhjdXJyZW50Wy0taW5kZXgxXSwgb2xkWy0taW5kZXgyXSkpIHtcbiAgICAgIGNvdW50Kys7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNvdW50O1xuICB9LFxuXG4gIGNhbGN1bGF0ZVNwbGljZXM6IGZ1bmN0aW9uIGNhbGN1bGF0ZVNwbGljZXMoY3VycmVudCwgcHJldmlvdXMpIHtcbiAgICByZXR1cm4gdGhpcy5jYWxjU3BsaWNlcyhjdXJyZW50LCAwLCBjdXJyZW50Lmxlbmd0aCwgcHJldmlvdXMsIDAsIHByZXZpb3VzLmxlbmd0aCk7XG4gIH0sXG5cbiAgZXF1YWxzOiBmdW5jdGlvbiBlcXVhbHMoY3VycmVudFZhbHVlLCBwcmV2aW91c1ZhbHVlKSB7XG4gICAgcmV0dXJuIGN1cnJlbnRWYWx1ZSA9PT0gcHJldmlvdXNWYWx1ZTtcbiAgfVxufTtcblxudmFyIGFycmF5U3BsaWNlID0gbmV3IEFycmF5U3BsaWNlKCk7XG5cbmZ1bmN0aW9uIGNhbGNTcGxpY2VzKGN1cnJlbnQsIGN1cnJlbnRTdGFydCwgY3VycmVudEVuZCwgb2xkLCBvbGRTdGFydCwgb2xkRW5kKSB7XG4gIHJldHVybiBhcnJheVNwbGljZS5jYWxjU3BsaWNlcyhjdXJyZW50LCBjdXJyZW50U3RhcnQsIGN1cnJlbnRFbmQsIG9sZCwgb2xkU3RhcnQsIG9sZEVuZCk7XG59XG5cbmZ1bmN0aW9uIGludGVyc2VjdChzdGFydDEsIGVuZDEsIHN0YXJ0MiwgZW5kMikge1xuICBpZiAoZW5kMSA8IHN0YXJ0MiB8fCBlbmQyIDwgc3RhcnQxKSB7XG4gICAgcmV0dXJuIC0xO1xuICB9XG5cbiAgaWYgKGVuZDEgPT09IHN0YXJ0MiB8fCBlbmQyID09PSBzdGFydDEpIHtcbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIGlmIChzdGFydDEgPCBzdGFydDIpIHtcbiAgICBpZiAoZW5kMSA8IGVuZDIpIHtcbiAgICAgIHJldHVybiBlbmQxIC0gc3RhcnQyO1xuICAgIH1cblxuICAgIHJldHVybiBlbmQyIC0gc3RhcnQyO1xuICB9XG5cbiAgaWYgKGVuZDIgPCBlbmQxKSB7XG4gICAgcmV0dXJuIGVuZDIgLSBzdGFydDE7XG4gIH1cblxuICByZXR1cm4gZW5kMSAtIHN0YXJ0MTtcbn1cblxuZnVuY3Rpb24gbWVyZ2VTcGxpY2Uoc3BsaWNlcywgaW5kZXgsIHJlbW92ZWQsIGFkZGVkQ291bnQpIHtcbiAgdmFyIHNwbGljZSA9IG5ld1NwbGljZShpbmRleCwgcmVtb3ZlZCwgYWRkZWRDb3VudCk7XG5cbiAgdmFyIGluc2VydGVkID0gZmFsc2U7XG4gIHZhciBpbnNlcnRpb25PZmZzZXQgPSAwO1xuXG4gIGZvciAodmFyIF9pNSA9IDA7IF9pNSA8IHNwbGljZXMubGVuZ3RoOyBfaTUrKykge1xuICAgIHZhciBjdXJyZW50ID0gc3BsaWNlc1tfaTVdO1xuICAgIGN1cnJlbnQuaW5kZXggKz0gaW5zZXJ0aW9uT2Zmc2V0O1xuXG4gICAgaWYgKGluc2VydGVkKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICB2YXIgaW50ZXJzZWN0Q291bnQgPSBpbnRlcnNlY3Qoc3BsaWNlLmluZGV4LCBzcGxpY2UuaW5kZXggKyBzcGxpY2UucmVtb3ZlZC5sZW5ndGgsIGN1cnJlbnQuaW5kZXgsIGN1cnJlbnQuaW5kZXggKyBjdXJyZW50LmFkZGVkQ291bnQpO1xuXG4gICAgaWYgKGludGVyc2VjdENvdW50ID49IDApIHtcblxuICAgICAgc3BsaWNlcy5zcGxpY2UoX2k1LCAxKTtcbiAgICAgIF9pNS0tO1xuXG4gICAgICBpbnNlcnRpb25PZmZzZXQgLT0gY3VycmVudC5hZGRlZENvdW50IC0gY3VycmVudC5yZW1vdmVkLmxlbmd0aDtcblxuICAgICAgc3BsaWNlLmFkZGVkQ291bnQgKz0gY3VycmVudC5hZGRlZENvdW50IC0gaW50ZXJzZWN0Q291bnQ7XG4gICAgICB2YXIgZGVsZXRlQ291bnQgPSBzcGxpY2UucmVtb3ZlZC5sZW5ndGggKyBjdXJyZW50LnJlbW92ZWQubGVuZ3RoIC0gaW50ZXJzZWN0Q291bnQ7XG5cbiAgICAgIGlmICghc3BsaWNlLmFkZGVkQ291bnQgJiYgIWRlbGV0ZUNvdW50KSB7XG4gICAgICAgIGluc2VydGVkID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBjdXJyZW50UmVtb3ZlZCA9IGN1cnJlbnQucmVtb3ZlZDtcblxuICAgICAgICBpZiAoc3BsaWNlLmluZGV4IDwgY3VycmVudC5pbmRleCkge1xuICAgICAgICAgIHZhciBwcmVwZW5kID0gc3BsaWNlLnJlbW92ZWQuc2xpY2UoMCwgY3VycmVudC5pbmRleCAtIHNwbGljZS5pbmRleCk7XG4gICAgICAgICAgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkocHJlcGVuZCwgY3VycmVudFJlbW92ZWQpO1xuICAgICAgICAgIGN1cnJlbnRSZW1vdmVkID0gcHJlcGVuZDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzcGxpY2UuaW5kZXggKyBzcGxpY2UucmVtb3ZlZC5sZW5ndGggPiBjdXJyZW50LmluZGV4ICsgY3VycmVudC5hZGRlZENvdW50KSB7XG4gICAgICAgICAgdmFyIGFwcGVuZCA9IHNwbGljZS5yZW1vdmVkLnNsaWNlKGN1cnJlbnQuaW5kZXggKyBjdXJyZW50LmFkZGVkQ291bnQgLSBzcGxpY2UuaW5kZXgpO1xuICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KGN1cnJlbnRSZW1vdmVkLCBhcHBlbmQpO1xuICAgICAgICB9XG5cbiAgICAgICAgc3BsaWNlLnJlbW92ZWQgPSBjdXJyZW50UmVtb3ZlZDtcbiAgICAgICAgaWYgKGN1cnJlbnQuaW5kZXggPCBzcGxpY2UuaW5kZXgpIHtcbiAgICAgICAgICBzcGxpY2UuaW5kZXggPSBjdXJyZW50LmluZGV4O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChzcGxpY2UuaW5kZXggPCBjdXJyZW50LmluZGV4KSB7XG5cbiAgICAgIGluc2VydGVkID0gdHJ1ZTtcblxuICAgICAgc3BsaWNlcy5zcGxpY2UoX2k1LCAwLCBzcGxpY2UpO1xuICAgICAgX2k1Kys7XG5cbiAgICAgIHZhciBvZmZzZXQgPSBzcGxpY2UuYWRkZWRDb3VudCAtIHNwbGljZS5yZW1vdmVkLmxlbmd0aDtcbiAgICAgIGN1cnJlbnQuaW5kZXggKz0gb2Zmc2V0O1xuICAgICAgaW5zZXJ0aW9uT2Zmc2V0ICs9IG9mZnNldDtcbiAgICB9XG4gIH1cblxuICBpZiAoIWluc2VydGVkKSB7XG4gICAgc3BsaWNlcy5wdXNoKHNwbGljZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gY3JlYXRlSW5pdGlhbFNwbGljZXMoYXJyYXksIGNoYW5nZVJlY29yZHMpIHtcbiAgdmFyIHNwbGljZXMgPSBbXTtcblxuICBmb3IgKHZhciBfaTYgPSAwOyBfaTYgPCBjaGFuZ2VSZWNvcmRzLmxlbmd0aDsgX2k2KyspIHtcbiAgICB2YXIgcmVjb3JkID0gY2hhbmdlUmVjb3Jkc1tfaTZdO1xuICAgIHN3aXRjaCAocmVjb3JkLnR5cGUpIHtcbiAgICAgIGNhc2UgJ3NwbGljZSc6XG4gICAgICAgIG1lcmdlU3BsaWNlKHNwbGljZXMsIHJlY29yZC5pbmRleCwgcmVjb3JkLnJlbW92ZWQuc2xpY2UoKSwgcmVjb3JkLmFkZGVkQ291bnQpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2FkZCc6XG4gICAgICBjYXNlICd1cGRhdGUnOlxuICAgICAgY2FzZSAnZGVsZXRlJzpcbiAgICAgICAgaWYgKCFpc0luZGV4KHJlY29yZC5uYW1lKSkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGluZGV4ID0gdG9OdW1iZXIocmVjb3JkLm5hbWUpO1xuICAgICAgICBpZiAoaW5kZXggPCAwKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICBtZXJnZVNwbGljZShzcGxpY2VzLCBpbmRleCwgW3JlY29yZC5vbGRWYWx1ZV0sIHJlY29yZC50eXBlID09PSAnZGVsZXRlJyA/IDAgOiAxKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBjb25zb2xlLmVycm9yKCdVbmV4cGVjdGVkIHJlY29yZCB0eXBlOiAnICsgSlNPTi5zdHJpbmdpZnkocmVjb3JkKSk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBzcGxpY2VzO1xufVxuXG5mdW5jdGlvbiBwcm9qZWN0QXJyYXlTcGxpY2VzKGFycmF5LCBjaGFuZ2VSZWNvcmRzKSB7XG4gIHZhciBzcGxpY2VzID0gW107XG5cbiAgY3JlYXRlSW5pdGlhbFNwbGljZXMoYXJyYXksIGNoYW5nZVJlY29yZHMpLmZvckVhY2goZnVuY3Rpb24gKHNwbGljZSkge1xuICAgIGlmIChzcGxpY2UuYWRkZWRDb3VudCA9PT0gMSAmJiBzcGxpY2UucmVtb3ZlZC5sZW5ndGggPT09IDEpIHtcbiAgICAgIGlmIChzcGxpY2UucmVtb3ZlZFswXSAhPT0gYXJyYXlbc3BsaWNlLmluZGV4XSkge1xuICAgICAgICBzcGxpY2VzLnB1c2goc3BsaWNlKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHNwbGljZXMgPSBzcGxpY2VzLmNvbmNhdChjYWxjU3BsaWNlcyhhcnJheSwgc3BsaWNlLmluZGV4LCBzcGxpY2UuaW5kZXggKyBzcGxpY2UuYWRkZWRDb3VudCwgc3BsaWNlLnJlbW92ZWQsIDAsIHNwbGljZS5yZW1vdmVkLmxlbmd0aCkpO1xuICB9KTtcblxuICByZXR1cm4gc3BsaWNlcztcbn1cblxuZnVuY3Rpb24gbmV3UmVjb3JkKHR5cGUsIG9iamVjdCwga2V5LCBvbGRWYWx1ZSkge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IHR5cGUsXG4gICAgb2JqZWN0OiBvYmplY3QsXG4gICAga2V5OiBrZXksXG4gICAgb2xkVmFsdWU6IG9sZFZhbHVlXG4gIH07XG59XG5cbmZ1bmN0aW9uIGdldENoYW5nZVJlY29yZHMobWFwKSB7XG4gIHZhciBlbnRyaWVzID0gbmV3IEFycmF5KG1hcC5zaXplKTtcbiAgdmFyIGtleXMgPSBtYXAua2V5cygpO1xuICB2YXIgaSA9IDA7XG4gIHZhciBpdGVtID0gdm9pZCAwO1xuXG4gIHdoaWxlIChpdGVtID0ga2V5cy5uZXh0KCkpIHtcbiAgICBpZiAoaXRlbS5kb25lKSB7XG4gICAgICBicmVhaztcbiAgICB9XG5cbiAgICBlbnRyaWVzW2ldID0gbmV3UmVjb3JkKCdhZGRlZCcsIG1hcCwgaXRlbS52YWx1ZSk7XG4gICAgaSsrO1xuICB9XG5cbiAgcmV0dXJuIGVudHJpZXM7XG59XG5cbnZhciBNb2RpZnlDb2xsZWN0aW9uT2JzZXJ2ZXIgPSBleHBvcnRzLk1vZGlmeUNvbGxlY3Rpb25PYnNlcnZlciA9IChfZGVjMyA9IHN1YnNjcmliZXJDb2xsZWN0aW9uKCksIF9kZWMzKF9jbGFzczIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIE1vZGlmeUNvbGxlY3Rpb25PYnNlcnZlcih0YXNrUXVldWUsIGNvbGxlY3Rpb24pIHtcbiAgICBcblxuICAgIHRoaXMudGFza1F1ZXVlID0gdGFza1F1ZXVlO1xuICAgIHRoaXMucXVldWVkID0gZmFsc2U7XG4gICAgdGhpcy5jaGFuZ2VSZWNvcmRzID0gbnVsbDtcbiAgICB0aGlzLm9sZENvbGxlY3Rpb24gPSBudWxsO1xuICAgIHRoaXMuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb247XG4gICAgdGhpcy5sZW5ndGhQcm9wZXJ0eU5hbWUgPSBjb2xsZWN0aW9uIGluc3RhbmNlb2YgTWFwIHx8IGNvbGxlY3Rpb24gaW5zdGFuY2VvZiBTZXQgPyAnc2l6ZScgOiAnbGVuZ3RoJztcbiAgfVxuXG4gIE1vZGlmeUNvbGxlY3Rpb25PYnNlcnZlci5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gc3Vic2NyaWJlKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gICAgdGhpcy5hZGRTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKTtcbiAgfTtcblxuICBNb2RpZnlDb2xsZWN0aW9uT2JzZXJ2ZXIucHJvdG90eXBlLnVuc3Vic2NyaWJlID0gZnVuY3Rpb24gdW5zdWJzY3JpYmUoY29udGV4dCwgY2FsbGFibGUpIHtcbiAgICB0aGlzLnJlbW92ZVN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpO1xuICB9O1xuXG4gIE1vZGlmeUNvbGxlY3Rpb25PYnNlcnZlci5wcm90b3R5cGUuYWRkQ2hhbmdlUmVjb3JkID0gZnVuY3Rpb24gYWRkQ2hhbmdlUmVjb3JkKGNoYW5nZVJlY29yZCkge1xuICAgIGlmICghdGhpcy5oYXNTdWJzY3JpYmVycygpICYmICF0aGlzLmxlbmd0aE9ic2VydmVyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGNoYW5nZVJlY29yZC50eXBlID09PSAnc3BsaWNlJykge1xuICAgICAgdmFyIGluZGV4ID0gY2hhbmdlUmVjb3JkLmluZGV4O1xuICAgICAgdmFyIGFycmF5TGVuZ3RoID0gY2hhbmdlUmVjb3JkLm9iamVjdC5sZW5ndGg7XG4gICAgICBpZiAoaW5kZXggPiBhcnJheUxlbmd0aCkge1xuICAgICAgICBpbmRleCA9IGFycmF5TGVuZ3RoIC0gY2hhbmdlUmVjb3JkLmFkZGVkQ291bnQ7XG4gICAgICB9IGVsc2UgaWYgKGluZGV4IDwgMCkge1xuICAgICAgICBpbmRleCA9IGFycmF5TGVuZ3RoICsgY2hhbmdlUmVjb3JkLnJlbW92ZWQubGVuZ3RoICsgaW5kZXggLSBjaGFuZ2VSZWNvcmQuYWRkZWRDb3VudDtcbiAgICAgIH1cbiAgICAgIGlmIChpbmRleCA8IDApIHtcbiAgICAgICAgaW5kZXggPSAwO1xuICAgICAgfVxuICAgICAgY2hhbmdlUmVjb3JkLmluZGV4ID0gaW5kZXg7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY2hhbmdlUmVjb3JkcyA9PT0gbnVsbCkge1xuICAgICAgdGhpcy5jaGFuZ2VSZWNvcmRzID0gW2NoYW5nZVJlY29yZF07XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2hhbmdlUmVjb3Jkcy5wdXNoKGNoYW5nZVJlY29yZCk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLnF1ZXVlZCkge1xuICAgICAgdGhpcy5xdWV1ZWQgPSB0cnVlO1xuICAgICAgdGhpcy50YXNrUXVldWUucXVldWVNaWNyb1Rhc2sodGhpcyk7XG4gICAgfVxuICB9O1xuXG4gIE1vZGlmeUNvbGxlY3Rpb25PYnNlcnZlci5wcm90b3R5cGUuZmx1c2hDaGFuZ2VSZWNvcmRzID0gZnVuY3Rpb24gZmx1c2hDaGFuZ2VSZWNvcmRzKCkge1xuICAgIGlmICh0aGlzLmNoYW5nZVJlY29yZHMgJiYgdGhpcy5jaGFuZ2VSZWNvcmRzLmxlbmd0aCB8fCB0aGlzLm9sZENvbGxlY3Rpb24pIHtcbiAgICAgIHRoaXMuY2FsbCgpO1xuICAgIH1cbiAgfTtcblxuICBNb2RpZnlDb2xsZWN0aW9uT2JzZXJ2ZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gcmVzZXQob2xkQ29sbGVjdGlvbikge1xuICAgIHRoaXMub2xkQ29sbGVjdGlvbiA9IG9sZENvbGxlY3Rpb247XG5cbiAgICBpZiAodGhpcy5oYXNTdWJzY3JpYmVycygpICYmICF0aGlzLnF1ZXVlZCkge1xuICAgICAgdGhpcy5xdWV1ZWQgPSB0cnVlO1xuICAgICAgdGhpcy50YXNrUXVldWUucXVldWVNaWNyb1Rhc2sodGhpcyk7XG4gICAgfVxuICB9O1xuXG4gIE1vZGlmeUNvbGxlY3Rpb25PYnNlcnZlci5wcm90b3R5cGUuZ2V0TGVuZ3RoT2JzZXJ2ZXIgPSBmdW5jdGlvbiBnZXRMZW5ndGhPYnNlcnZlcigpIHtcbiAgICByZXR1cm4gdGhpcy5sZW5ndGhPYnNlcnZlciB8fCAodGhpcy5sZW5ndGhPYnNlcnZlciA9IG5ldyBDb2xsZWN0aW9uTGVuZ3RoT2JzZXJ2ZXIodGhpcy5jb2xsZWN0aW9uKSk7XG4gIH07XG5cbiAgTW9kaWZ5Q29sbGVjdGlvbk9ic2VydmVyLnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gY2FsbCgpIHtcbiAgICB2YXIgY2hhbmdlUmVjb3JkcyA9IHRoaXMuY2hhbmdlUmVjb3JkcztcbiAgICB2YXIgb2xkQ29sbGVjdGlvbiA9IHRoaXMub2xkQ29sbGVjdGlvbjtcbiAgICB2YXIgcmVjb3JkcyA9IHZvaWQgMDtcblxuICAgIHRoaXMucXVldWVkID0gZmFsc2U7XG4gICAgdGhpcy5jaGFuZ2VSZWNvcmRzID0gW107XG4gICAgdGhpcy5vbGRDb2xsZWN0aW9uID0gbnVsbDtcblxuICAgIGlmICh0aGlzLmhhc1N1YnNjcmliZXJzKCkpIHtcbiAgICAgIGlmIChvbGRDb2xsZWN0aW9uKSB7XG4gICAgICAgIGlmICh0aGlzLmNvbGxlY3Rpb24gaW5zdGFuY2VvZiBNYXAgfHwgdGhpcy5jb2xsZWN0aW9uIGluc3RhbmNlb2YgU2V0KSB7XG4gICAgICAgICAgcmVjb3JkcyA9IGdldENoYW5nZVJlY29yZHMob2xkQ29sbGVjdGlvbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVjb3JkcyA9IGNhbGNTcGxpY2VzKHRoaXMuY29sbGVjdGlvbiwgMCwgdGhpcy5jb2xsZWN0aW9uLmxlbmd0aCwgb2xkQ29sbGVjdGlvbiwgMCwgb2xkQ29sbGVjdGlvbi5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodGhpcy5jb2xsZWN0aW9uIGluc3RhbmNlb2YgTWFwIHx8IHRoaXMuY29sbGVjdGlvbiBpbnN0YW5jZW9mIFNldCkge1xuICAgICAgICAgIHJlY29yZHMgPSBjaGFuZ2VSZWNvcmRzO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlY29yZHMgPSBwcm9qZWN0QXJyYXlTcGxpY2VzKHRoaXMuY29sbGVjdGlvbiwgY2hhbmdlUmVjb3Jkcyk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5jYWxsU3Vic2NyaWJlcnMocmVjb3Jkcyk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMubGVuZ3RoT2JzZXJ2ZXIpIHtcbiAgICAgIHRoaXMubGVuZ3RoT2JzZXJ2ZXIuY2FsbCh0aGlzLmNvbGxlY3Rpb25bdGhpcy5sZW5ndGhQcm9wZXJ0eU5hbWVdKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIE1vZGlmeUNvbGxlY3Rpb25PYnNlcnZlcjtcbn0oKSkgfHwgX2NsYXNzMik7XG52YXIgQ29sbGVjdGlvbkxlbmd0aE9ic2VydmVyID0gZXhwb3J0cy5Db2xsZWN0aW9uTGVuZ3RoT2JzZXJ2ZXIgPSAoX2RlYzQgPSBzdWJzY3JpYmVyQ29sbGVjdGlvbigpLCBfZGVjNChfY2xhc3MzID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBDb2xsZWN0aW9uTGVuZ3RoT2JzZXJ2ZXIoY29sbGVjdGlvbikge1xuICAgIFxuXG4gICAgdGhpcy5jb2xsZWN0aW9uID0gY29sbGVjdGlvbjtcbiAgICB0aGlzLmxlbmd0aFByb3BlcnR5TmFtZSA9IGNvbGxlY3Rpb24gaW5zdGFuY2VvZiBNYXAgfHwgY29sbGVjdGlvbiBpbnN0YW5jZW9mIFNldCA/ICdzaXplJyA6ICdsZW5ndGgnO1xuICAgIHRoaXMuY3VycmVudFZhbHVlID0gY29sbGVjdGlvblt0aGlzLmxlbmd0aFByb3BlcnR5TmFtZV07XG4gIH1cblxuICBDb2xsZWN0aW9uTGVuZ3RoT2JzZXJ2ZXIucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gZ2V0VmFsdWUoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29sbGVjdGlvblt0aGlzLmxlbmd0aFByb3BlcnR5TmFtZV07XG4gIH07XG5cbiAgQ29sbGVjdGlvbkxlbmd0aE9ic2VydmVyLnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uIHNldFZhbHVlKG5ld1ZhbHVlKSB7XG4gICAgdGhpcy5jb2xsZWN0aW9uW3RoaXMubGVuZ3RoUHJvcGVydHlOYW1lXSA9IG5ld1ZhbHVlO1xuICB9O1xuXG4gIENvbGxlY3Rpb25MZW5ndGhPYnNlcnZlci5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gc3Vic2NyaWJlKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gICAgdGhpcy5hZGRTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKTtcbiAgfTtcblxuICBDb2xsZWN0aW9uTGVuZ3RoT2JzZXJ2ZXIucHJvdG90eXBlLnVuc3Vic2NyaWJlID0gZnVuY3Rpb24gdW5zdWJzY3JpYmUoY29udGV4dCwgY2FsbGFibGUpIHtcbiAgICB0aGlzLnJlbW92ZVN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpO1xuICB9O1xuXG4gIENvbGxlY3Rpb25MZW5ndGhPYnNlcnZlci5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uIGNhbGwobmV3VmFsdWUpIHtcbiAgICB2YXIgb2xkVmFsdWUgPSB0aGlzLmN1cnJlbnRWYWx1ZTtcbiAgICB0aGlzLmNhbGxTdWJzY3JpYmVycyhuZXdWYWx1ZSwgb2xkVmFsdWUpO1xuICAgIHRoaXMuY3VycmVudFZhbHVlID0gbmV3VmFsdWU7XG4gIH07XG5cbiAgcmV0dXJuIENvbGxlY3Rpb25MZW5ndGhPYnNlcnZlcjtcbn0oKSkgfHwgX2NsYXNzMyk7XG5cbnZhciBwb3AgPSBBcnJheS5wcm90b3R5cGUucG9wO1xudmFyIHB1c2ggPSBBcnJheS5wcm90b3R5cGUucHVzaDtcbnZhciByZXZlcnNlID0gQXJyYXkucHJvdG90eXBlLnJldmVyc2U7XG52YXIgc2hpZnQgPSBBcnJheS5wcm90b3R5cGUuc2hpZnQ7XG52YXIgc29ydCA9IEFycmF5LnByb3RvdHlwZS5zb3J0O1xudmFyIHNwbGljZSA9IEFycmF5LnByb3RvdHlwZS5zcGxpY2U7XG52YXIgdW5zaGlmdCA9IEFycmF5LnByb3RvdHlwZS51bnNoaWZ0O1xuXG5BcnJheS5wcm90b3R5cGUucG9wID0gZnVuY3Rpb24gKCkge1xuICB2YXIgbm90RW1wdHkgPSB0aGlzLmxlbmd0aCA+IDA7XG4gIHZhciBtZXRob2RDYWxsUmVzdWx0ID0gcG9wLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIGlmIChub3RFbXB0eSAmJiB0aGlzLl9fYXJyYXlfb2JzZXJ2ZXJfXyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5fX2FycmF5X29ic2VydmVyX18uYWRkQ2hhbmdlUmVjb3JkKHtcbiAgICAgIHR5cGU6ICdkZWxldGUnLFxuICAgICAgb2JqZWN0OiB0aGlzLFxuICAgICAgbmFtZTogdGhpcy5sZW5ndGgsXG4gICAgICBvbGRWYWx1ZTogbWV0aG9kQ2FsbFJlc3VsdFxuICAgIH0pO1xuICB9XG4gIHJldHVybiBtZXRob2RDYWxsUmVzdWx0O1xufTtcblxuQXJyYXkucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBtZXRob2RDYWxsUmVzdWx0ID0gcHVzaC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICBpZiAodGhpcy5fX2FycmF5X29ic2VydmVyX18gIT09IHVuZGVmaW5lZCkge1xuICAgIHRoaXMuX19hcnJheV9vYnNlcnZlcl9fLmFkZENoYW5nZVJlY29yZCh7XG4gICAgICB0eXBlOiAnc3BsaWNlJyxcbiAgICAgIG9iamVjdDogdGhpcyxcbiAgICAgIGluZGV4OiB0aGlzLmxlbmd0aCAtIGFyZ3VtZW50cy5sZW5ndGgsXG4gICAgICByZW1vdmVkOiBbXSxcbiAgICAgIGFkZGVkQ291bnQ6IGFyZ3VtZW50cy5sZW5ndGhcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gbWV0aG9kQ2FsbFJlc3VsdDtcbn07XG5cbkFycmF5LnByb3RvdHlwZS5yZXZlcnNlID0gZnVuY3Rpb24gKCkge1xuICB2YXIgb2xkQXJyYXkgPSB2b2lkIDA7XG4gIGlmICh0aGlzLl9fYXJyYXlfb2JzZXJ2ZXJfXyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5fX2FycmF5X29ic2VydmVyX18uZmx1c2hDaGFuZ2VSZWNvcmRzKCk7XG4gICAgb2xkQXJyYXkgPSB0aGlzLnNsaWNlKCk7XG4gIH1cbiAgdmFyIG1ldGhvZENhbGxSZXN1bHQgPSByZXZlcnNlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIGlmICh0aGlzLl9fYXJyYXlfb2JzZXJ2ZXJfXyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5fX2FycmF5X29ic2VydmVyX18ucmVzZXQob2xkQXJyYXkpO1xuICB9XG4gIHJldHVybiBtZXRob2RDYWxsUmVzdWx0O1xufTtcblxuQXJyYXkucHJvdG90eXBlLnNoaWZ0ID0gZnVuY3Rpb24gKCkge1xuICB2YXIgbm90RW1wdHkgPSB0aGlzLmxlbmd0aCA+IDA7XG4gIHZhciBtZXRob2RDYWxsUmVzdWx0ID0gc2hpZnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgaWYgKG5vdEVtcHR5ICYmIHRoaXMuX19hcnJheV9vYnNlcnZlcl9fICE9PSB1bmRlZmluZWQpIHtcbiAgICB0aGlzLl9fYXJyYXlfb2JzZXJ2ZXJfXy5hZGRDaGFuZ2VSZWNvcmQoe1xuICAgICAgdHlwZTogJ2RlbGV0ZScsXG4gICAgICBvYmplY3Q6IHRoaXMsXG4gICAgICBuYW1lOiAwLFxuICAgICAgb2xkVmFsdWU6IG1ldGhvZENhbGxSZXN1bHRcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gbWV0aG9kQ2FsbFJlc3VsdDtcbn07XG5cbkFycmF5LnByb3RvdHlwZS5zb3J0ID0gZnVuY3Rpb24gKCkge1xuICB2YXIgb2xkQXJyYXkgPSB2b2lkIDA7XG4gIGlmICh0aGlzLl9fYXJyYXlfb2JzZXJ2ZXJfXyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5fX2FycmF5X29ic2VydmVyX18uZmx1c2hDaGFuZ2VSZWNvcmRzKCk7XG4gICAgb2xkQXJyYXkgPSB0aGlzLnNsaWNlKCk7XG4gIH1cbiAgdmFyIG1ldGhvZENhbGxSZXN1bHQgPSBzb3J0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIGlmICh0aGlzLl9fYXJyYXlfb2JzZXJ2ZXJfXyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5fX2FycmF5X29ic2VydmVyX18ucmVzZXQob2xkQXJyYXkpO1xuICB9XG4gIHJldHVybiBtZXRob2RDYWxsUmVzdWx0O1xufTtcblxuQXJyYXkucHJvdG90eXBlLnNwbGljZSA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIG1ldGhvZENhbGxSZXN1bHQgPSBzcGxpY2UuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgaWYgKHRoaXMuX19hcnJheV9vYnNlcnZlcl9fICE9PSB1bmRlZmluZWQpIHtcbiAgICB0aGlzLl9fYXJyYXlfb2JzZXJ2ZXJfXy5hZGRDaGFuZ2VSZWNvcmQoe1xuICAgICAgdHlwZTogJ3NwbGljZScsXG4gICAgICBvYmplY3Q6IHRoaXMsXG4gICAgICBpbmRleDogYXJndW1lbnRzWzBdLFxuICAgICAgcmVtb3ZlZDogbWV0aG9kQ2FsbFJlc3VsdCxcbiAgICAgIGFkZGVkQ291bnQ6IGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzLmxlbmd0aCAtIDIgOiAwXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIG1ldGhvZENhbGxSZXN1bHQ7XG59O1xuXG5BcnJheS5wcm90b3R5cGUudW5zaGlmdCA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIG1ldGhvZENhbGxSZXN1bHQgPSB1bnNoaWZ0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIGlmICh0aGlzLl9fYXJyYXlfb2JzZXJ2ZXJfXyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5fX2FycmF5X29ic2VydmVyX18uYWRkQ2hhbmdlUmVjb3JkKHtcbiAgICAgIHR5cGU6ICdzcGxpY2UnLFxuICAgICAgb2JqZWN0OiB0aGlzLFxuICAgICAgaW5kZXg6IDAsXG4gICAgICByZW1vdmVkOiBbXSxcbiAgICAgIGFkZGVkQ291bnQ6IGFyZ3VtZW50cy5sZW5ndGhcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gbWV0aG9kQ2FsbFJlc3VsdDtcbn07XG5cbmZ1bmN0aW9uIF9nZXRBcnJheU9ic2VydmVyKHRhc2tRdWV1ZSwgYXJyYXkpIHtcbiAgcmV0dXJuIE1vZGlmeUFycmF5T2JzZXJ2ZXIuZm9yKHRhc2tRdWV1ZSwgYXJyYXkpO1xufVxuXG5leHBvcnRzLmdldEFycmF5T2JzZXJ2ZXIgPSBfZ2V0QXJyYXlPYnNlcnZlcjtcblxudmFyIE1vZGlmeUFycmF5T2JzZXJ2ZXIgPSBmdW5jdGlvbiAoX01vZGlmeUNvbGxlY3Rpb25PYnNlKSB7XG4gIF9pbmhlcml0cyhNb2RpZnlBcnJheU9ic2VydmVyLCBfTW9kaWZ5Q29sbGVjdGlvbk9ic2UpO1xuXG4gIGZ1bmN0aW9uIE1vZGlmeUFycmF5T2JzZXJ2ZXIodGFza1F1ZXVlLCBhcnJheSkge1xuICAgIFxuXG4gICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9Nb2RpZnlDb2xsZWN0aW9uT2JzZS5jYWxsKHRoaXMsIHRhc2tRdWV1ZSwgYXJyYXkpKTtcbiAgfVxuXG4gIE1vZGlmeUFycmF5T2JzZXJ2ZXIuZm9yID0gZnVuY3Rpb24gX2Zvcih0YXNrUXVldWUsIGFycmF5KSB7XG4gICAgaWYgKCEoJ19fYXJyYXlfb2JzZXJ2ZXJfXycgaW4gYXJyYXkpKSB7XG4gICAgICB2YXIgb2JzZXJ2ZXIgPSBNb2RpZnlBcnJheU9ic2VydmVyLmNyZWF0ZSh0YXNrUXVldWUsIGFycmF5KTtcbiAgICAgIFJlZmxlY3QuZGVmaW5lUHJvcGVydHkoYXJyYXksICdfX2FycmF5X29ic2VydmVyX18nLCB7IHZhbHVlOiBvYnNlcnZlciwgZW51bWVyYWJsZTogZmFsc2UsIGNvbmZpZ3VyYWJsZTogZmFsc2UgfSk7XG4gICAgfVxuICAgIHJldHVybiBhcnJheS5fX2FycmF5X29ic2VydmVyX187XG4gIH07XG5cbiAgTW9kaWZ5QXJyYXlPYnNlcnZlci5jcmVhdGUgPSBmdW5jdGlvbiBjcmVhdGUodGFza1F1ZXVlLCBhcnJheSkge1xuICAgIHZhciBvYnNlcnZlciA9IG5ldyBNb2RpZnlBcnJheU9ic2VydmVyKHRhc2tRdWV1ZSwgYXJyYXkpO1xuICAgIHJldHVybiBvYnNlcnZlcjtcbiAgfTtcblxuICByZXR1cm4gTW9kaWZ5QXJyYXlPYnNlcnZlcjtcbn0oTW9kaWZ5Q29sbGVjdGlvbk9ic2VydmVyKTtcblxudmFyIEV4cHJlc3Npb24gPSBleHBvcnRzLkV4cHJlc3Npb24gPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEV4cHJlc3Npb24oKSB7XG4gICAgXG5cbiAgICB0aGlzLmlzQ2hhaW4gPSBmYWxzZTtcbiAgICB0aGlzLmlzQXNzaWduYWJsZSA9IGZhbHNlO1xuICB9XG5cbiAgRXhwcmVzc2lvbi5wcm90b3R5cGUuZXZhbHVhdGUgPSBmdW5jdGlvbiBldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zLCBhcmdzKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdCaW5kaW5nIGV4cHJlc3Npb24gXCInICsgdGhpcyArICdcIiBjYW5ub3QgYmUgZXZhbHVhdGVkLicpO1xuICB9O1xuXG4gIEV4cHJlc3Npb24ucHJvdG90eXBlLmFzc2lnbiA9IGZ1bmN0aW9uIGFzc2lnbihzY29wZSwgdmFsdWUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHRocm93IG5ldyBFcnJvcignQmluZGluZyBleHByZXNzaW9uIFwiJyArIHRoaXMgKyAnXCIgY2Fubm90IGJlIGFzc2lnbmVkIHRvLicpO1xuICB9O1xuXG4gIEV4cHJlc3Npb24ucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gdG9TdHJpbmcoKSB7XG4gICAgcmV0dXJuIFVucGFyc2VyLnVucGFyc2UodGhpcyk7XG4gIH07XG5cbiAgcmV0dXJuIEV4cHJlc3Npb247XG59KCk7XG5cbnZhciBDaGFpbiA9IGV4cG9ydHMuQ2hhaW4gPSBmdW5jdGlvbiAoX0V4cHJlc3Npb24pIHtcbiAgX2luaGVyaXRzKENoYWluLCBfRXhwcmVzc2lvbik7XG5cbiAgZnVuY3Rpb24gQ2hhaW4oZXhwcmVzc2lvbnMpIHtcbiAgICBcblxuICAgIHZhciBfdGhpczMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfRXhwcmVzc2lvbi5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzMy5leHByZXNzaW9ucyA9IGV4cHJlc3Npb25zO1xuICAgIF90aGlzMy5pc0NoYWluID0gdHJ1ZTtcbiAgICByZXR1cm4gX3RoaXMzO1xuICB9XG5cbiAgQ2hhaW4ucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHZhciByZXN1bHQgPSB2b2lkIDA7XG4gICAgdmFyIGV4cHJlc3Npb25zID0gdGhpcy5leHByZXNzaW9ucztcbiAgICB2YXIgbGFzdCA9IHZvaWQgMDtcblxuICAgIGZvciAodmFyIF9pNyA9IDAsIGxlbmd0aCA9IGV4cHJlc3Npb25zLmxlbmd0aDsgX2k3IDwgbGVuZ3RoOyArK19pNykge1xuICAgICAgbGFzdCA9IGV4cHJlc3Npb25zW19pN10uZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG5cbiAgICAgIGlmIChsYXN0ICE9PSBudWxsKSB7XG4gICAgICAgIHJlc3VsdCA9IGxhc3Q7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBDaGFpbi5wcm90b3R5cGUuYWNjZXB0ID0gZnVuY3Rpb24gYWNjZXB0KHZpc2l0b3IpIHtcbiAgICByZXR1cm4gdmlzaXRvci52aXNpdENoYWluKHRoaXMpO1xuICB9O1xuXG4gIHJldHVybiBDaGFpbjtcbn0oRXhwcmVzc2lvbik7XG5cbnZhciBCaW5kaW5nQmVoYXZpb3IgPSBleHBvcnRzLkJpbmRpbmdCZWhhdmlvciA9IGZ1bmN0aW9uIChfRXhwcmVzc2lvbjIpIHtcbiAgX2luaGVyaXRzKEJpbmRpbmdCZWhhdmlvciwgX0V4cHJlc3Npb24yKTtcblxuICBmdW5jdGlvbiBCaW5kaW5nQmVoYXZpb3IoZXhwcmVzc2lvbiwgbmFtZSwgYXJncykge1xuICAgIFxuXG4gICAgdmFyIF90aGlzNCA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9FeHByZXNzaW9uMi5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzNC5leHByZXNzaW9uID0gZXhwcmVzc2lvbjtcbiAgICBfdGhpczQubmFtZSA9IG5hbWU7XG4gICAgX3RoaXM0LmFyZ3MgPSBhcmdzO1xuICAgIHJldHVybiBfdGhpczQ7XG4gIH1cblxuICBCaW5kaW5nQmVoYXZpb3IucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHJldHVybiB0aGlzLmV4cHJlc3Npb24uZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgQmluZGluZ0JlaGF2aW9yLnByb3RvdHlwZS5hc3NpZ24gPSBmdW5jdGlvbiBhc3NpZ24oc2NvcGUsIHZhbHVlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICByZXR1cm4gdGhpcy5leHByZXNzaW9uLmFzc2lnbihzY29wZSwgdmFsdWUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgQmluZGluZ0JlaGF2aW9yLnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiBhY2NlcHQodmlzaXRvcikge1xuICAgIHJldHVybiB2aXNpdG9yLnZpc2l0QmluZGluZ0JlaGF2aW9yKHRoaXMpO1xuICB9O1xuXG4gIEJpbmRpbmdCZWhhdmlvci5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uIGNvbm5lY3QoYmluZGluZywgc2NvcGUpIHtcbiAgICB0aGlzLmV4cHJlc3Npb24uY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gIH07XG5cbiAgQmluZGluZ0JlaGF2aW9yLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZChiaW5kaW5nLCBzY29wZSwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgaWYgKHRoaXMuZXhwcmVzc2lvbi5leHByZXNzaW9uICYmIHRoaXMuZXhwcmVzc2lvbi5iaW5kKSB7XG4gICAgICB0aGlzLmV4cHJlc3Npb24uYmluZChiaW5kaW5nLCBzY29wZSwgbG9va3VwRnVuY3Rpb25zKTtcbiAgICB9XG4gICAgdmFyIGJlaGF2aW9yID0gbG9va3VwRnVuY3Rpb25zLmJpbmRpbmdCZWhhdmlvcnModGhpcy5uYW1lKTtcbiAgICBpZiAoIWJlaGF2aW9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIEJpbmRpbmdCZWhhdmlvciBuYW1lZCBcIicgKyB0aGlzLm5hbWUgKyAnXCIgd2FzIGZvdW5kIScpO1xuICAgIH1cbiAgICB2YXIgYmVoYXZpb3JLZXkgPSAnYmVoYXZpb3ItJyArIHRoaXMubmFtZTtcbiAgICBpZiAoYmluZGluZ1tiZWhhdmlvcktleV0pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQSBiaW5kaW5nIGJlaGF2aW9yIG5hbWVkIFwiJyArIHRoaXMubmFtZSArICdcIiBoYXMgYWxyZWFkeSBiZWVuIGFwcGxpZWQgdG8gXCInICsgdGhpcy5leHByZXNzaW9uICsgJ1wiJyk7XG4gICAgfVxuICAgIGJpbmRpbmdbYmVoYXZpb3JLZXldID0gYmVoYXZpb3I7XG4gICAgYmVoYXZpb3IuYmluZC5hcHBseShiZWhhdmlvciwgW2JpbmRpbmcsIHNjb3BlXS5jb25jYXQoZXZhbExpc3Qoc2NvcGUsIHRoaXMuYXJncywgYmluZGluZy5sb29rdXBGdW5jdGlvbnMpKSk7XG4gIH07XG5cbiAgQmluZGluZ0JlaGF2aW9yLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiB1bmJpbmQoYmluZGluZywgc2NvcGUpIHtcbiAgICB2YXIgYmVoYXZpb3JLZXkgPSAnYmVoYXZpb3ItJyArIHRoaXMubmFtZTtcbiAgICBiaW5kaW5nW2JlaGF2aW9yS2V5XS51bmJpbmQoYmluZGluZywgc2NvcGUpO1xuICAgIGJpbmRpbmdbYmVoYXZpb3JLZXldID0gbnVsbDtcbiAgICBpZiAodGhpcy5leHByZXNzaW9uLmV4cHJlc3Npb24gJiYgdGhpcy5leHByZXNzaW9uLnVuYmluZCkge1xuICAgICAgdGhpcy5leHByZXNzaW9uLnVuYmluZChiaW5kaW5nLCBzY29wZSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBCaW5kaW5nQmVoYXZpb3I7XG59KEV4cHJlc3Npb24pO1xuXG52YXIgVmFsdWVDb252ZXJ0ZXIgPSBleHBvcnRzLlZhbHVlQ29udmVydGVyID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uMykge1xuICBfaW5oZXJpdHMoVmFsdWVDb252ZXJ0ZXIsIF9FeHByZXNzaW9uMyk7XG5cbiAgZnVuY3Rpb24gVmFsdWVDb252ZXJ0ZXIoZXhwcmVzc2lvbiwgbmFtZSwgYXJncywgYWxsQXJncykge1xuICAgIFxuXG4gICAgdmFyIF90aGlzNSA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9FeHByZXNzaW9uMy5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzNS5leHByZXNzaW9uID0gZXhwcmVzc2lvbjtcbiAgICBfdGhpczUubmFtZSA9IG5hbWU7XG4gICAgX3RoaXM1LmFyZ3MgPSBhcmdzO1xuICAgIF90aGlzNS5hbGxBcmdzID0gYWxsQXJncztcbiAgICByZXR1cm4gX3RoaXM1O1xuICB9XG5cbiAgVmFsdWVDb252ZXJ0ZXIucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHZhciBjb252ZXJ0ZXIgPSBsb29rdXBGdW5jdGlvbnMudmFsdWVDb252ZXJ0ZXJzKHRoaXMubmFtZSk7XG4gICAgaWYgKCFjb252ZXJ0ZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gVmFsdWVDb252ZXJ0ZXIgbmFtZWQgXCInICsgdGhpcy5uYW1lICsgJ1wiIHdhcyBmb3VuZCEnKTtcbiAgICB9XG5cbiAgICBpZiAoJ3RvVmlldycgaW4gY29udmVydGVyKSB7XG4gICAgICByZXR1cm4gY29udmVydGVyLnRvVmlldy5hcHBseShjb252ZXJ0ZXIsIGV2YWxMaXN0KHNjb3BlLCB0aGlzLmFsbEFyZ3MsIGxvb2t1cEZ1bmN0aW9ucykpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmFsbEFyZ3NbMF0uZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgVmFsdWVDb252ZXJ0ZXIucHJvdG90eXBlLmFzc2lnbiA9IGZ1bmN0aW9uIGFzc2lnbihzY29wZSwgdmFsdWUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHZhciBjb252ZXJ0ZXIgPSBsb29rdXBGdW5jdGlvbnMudmFsdWVDb252ZXJ0ZXJzKHRoaXMubmFtZSk7XG4gICAgaWYgKCFjb252ZXJ0ZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gVmFsdWVDb252ZXJ0ZXIgbmFtZWQgXCInICsgdGhpcy5uYW1lICsgJ1wiIHdhcyBmb3VuZCEnKTtcbiAgICB9XG5cbiAgICBpZiAoJ2Zyb21WaWV3JyBpbiBjb252ZXJ0ZXIpIHtcbiAgICAgIHZhbHVlID0gY29udmVydGVyLmZyb21WaWV3LmFwcGx5KGNvbnZlcnRlciwgW3ZhbHVlXS5jb25jYXQoZXZhbExpc3Qoc2NvcGUsIHRoaXMuYXJncywgbG9va3VwRnVuY3Rpb25zKSkpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmFsbEFyZ3NbMF0uYXNzaWduKHNjb3BlLCB2YWx1ZSwgbG9va3VwRnVuY3Rpb25zKTtcbiAgfTtcblxuICBWYWx1ZUNvbnZlcnRlci5wcm90b3R5cGUuYWNjZXB0ID0gZnVuY3Rpb24gYWNjZXB0KHZpc2l0b3IpIHtcbiAgICByZXR1cm4gdmlzaXRvci52aXNpdFZhbHVlQ29udmVydGVyKHRoaXMpO1xuICB9O1xuXG4gIFZhbHVlQ29udmVydGVyLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChiaW5kaW5nLCBzY29wZSkge1xuICAgIHZhciBleHByZXNzaW9ucyA9IHRoaXMuYWxsQXJncztcbiAgICB2YXIgaSA9IGV4cHJlc3Npb25zLmxlbmd0aDtcbiAgICB3aGlsZSAoaS0tKSB7XG4gICAgICBleHByZXNzaW9uc1tpXS5jb25uZWN0KGJpbmRpbmcsIHNjb3BlKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIFZhbHVlQ29udmVydGVyO1xufShFeHByZXNzaW9uKTtcblxudmFyIEFzc2lnbiA9IGV4cG9ydHMuQXNzaWduID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uNCkge1xuICBfaW5oZXJpdHMoQXNzaWduLCBfRXhwcmVzc2lvbjQpO1xuXG4gIGZ1bmN0aW9uIEFzc2lnbih0YXJnZXQsIHZhbHVlKSB7XG4gICAgXG5cbiAgICB2YXIgX3RoaXM2ID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX0V4cHJlc3Npb240LmNhbGwodGhpcykpO1xuXG4gICAgX3RoaXM2LnRhcmdldCA9IHRhcmdldDtcbiAgICBfdGhpczYudmFsdWUgPSB2YWx1ZTtcbiAgICByZXR1cm4gX3RoaXM2O1xuICB9XG5cbiAgQXNzaWduLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICByZXR1cm4gdGhpcy50YXJnZXQuYXNzaWduKHNjb3BlLCB0aGlzLnZhbHVlLmV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpKTtcbiAgfTtcblxuICBBc3NpZ24ucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uIGFjY2VwdCh2aXN0b3IpIHtcbiAgICB2aXN0b3IudmlzaXRBc3NpZ24odGhpcyk7XG4gIH07XG5cbiAgQXNzaWduLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChiaW5kaW5nLCBzY29wZSkge307XG5cbiAgcmV0dXJuIEFzc2lnbjtcbn0oRXhwcmVzc2lvbik7XG5cbnZhciBDb25kaXRpb25hbCA9IGV4cG9ydHMuQ29uZGl0aW9uYWwgPSBmdW5jdGlvbiAoX0V4cHJlc3Npb241KSB7XG4gIF9pbmhlcml0cyhDb25kaXRpb25hbCwgX0V4cHJlc3Npb241KTtcblxuICBmdW5jdGlvbiBDb25kaXRpb25hbChjb25kaXRpb24sIHllcywgbm8pIHtcbiAgICBcblxuICAgIHZhciBfdGhpczcgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfRXhwcmVzc2lvbjUuY2FsbCh0aGlzKSk7XG5cbiAgICBfdGhpczcuY29uZGl0aW9uID0gY29uZGl0aW9uO1xuICAgIF90aGlzNy55ZXMgPSB5ZXM7XG4gICAgX3RoaXM3Lm5vID0gbm87XG4gICAgcmV0dXJuIF90aGlzNztcbiAgfVxuXG4gIENvbmRpdGlvbmFsLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICByZXR1cm4gISF0aGlzLmNvbmRpdGlvbi5ldmFsdWF0ZShzY29wZSkgPyB0aGlzLnllcy5ldmFsdWF0ZShzY29wZSkgOiB0aGlzLm5vLmV2YWx1YXRlKHNjb3BlKTtcbiAgfTtcblxuICBDb25kaXRpb25hbC5wcm90b3R5cGUuYWNjZXB0ID0gZnVuY3Rpb24gYWNjZXB0KHZpc2l0b3IpIHtcbiAgICByZXR1cm4gdmlzaXRvci52aXNpdENvbmRpdGlvbmFsKHRoaXMpO1xuICB9O1xuXG4gIENvbmRpdGlvbmFsLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChiaW5kaW5nLCBzY29wZSkge1xuICAgIHRoaXMuY29uZGl0aW9uLmNvbm5lY3QoYmluZGluZywgc2NvcGUpO1xuICAgIGlmICh0aGlzLmNvbmRpdGlvbi5ldmFsdWF0ZShzY29wZSkpIHtcbiAgICAgIHRoaXMueWVzLmNvbm5lY3QoYmluZGluZywgc2NvcGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm5vLmNvbm5lY3QoYmluZGluZywgc2NvcGUpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gQ29uZGl0aW9uYWw7XG59KEV4cHJlc3Npb24pO1xuXG52YXIgQWNjZXNzVGhpcyA9IGV4cG9ydHMuQWNjZXNzVGhpcyA9IGZ1bmN0aW9uIChfRXhwcmVzc2lvbjYpIHtcbiAgX2luaGVyaXRzKEFjY2Vzc1RoaXMsIF9FeHByZXNzaW9uNik7XG5cbiAgZnVuY3Rpb24gQWNjZXNzVGhpcyhhbmNlc3Rvcikge1xuICAgIFxuXG4gICAgdmFyIF90aGlzOCA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9FeHByZXNzaW9uNi5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzOC5hbmNlc3RvciA9IGFuY2VzdG9yO1xuICAgIHJldHVybiBfdGhpczg7XG4gIH1cblxuICBBY2Nlc3NUaGlzLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICB2YXIgb2MgPSBzY29wZS5vdmVycmlkZUNvbnRleHQ7XG4gICAgdmFyIGkgPSB0aGlzLmFuY2VzdG9yO1xuICAgIHdoaWxlIChpLS0gJiYgb2MpIHtcbiAgICAgIG9jID0gb2MucGFyZW50T3ZlcnJpZGVDb250ZXh0O1xuICAgIH1cbiAgICByZXR1cm4gaSA8IDEgJiYgb2MgPyBvYy5iaW5kaW5nQ29udGV4dCA6IHVuZGVmaW5lZDtcbiAgfTtcblxuICBBY2Nlc3NUaGlzLnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiBhY2NlcHQodmlzaXRvcikge1xuICAgIHJldHVybiB2aXNpdG9yLnZpc2l0QWNjZXNzVGhpcyh0aGlzKTtcbiAgfTtcblxuICBBY2Nlc3NUaGlzLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChiaW5kaW5nLCBzY29wZSkge307XG5cbiAgcmV0dXJuIEFjY2Vzc1RoaXM7XG59KEV4cHJlc3Npb24pO1xuXG52YXIgQWNjZXNzU2NvcGUgPSBleHBvcnRzLkFjY2Vzc1Njb3BlID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uNykge1xuICBfaW5oZXJpdHMoQWNjZXNzU2NvcGUsIF9FeHByZXNzaW9uNyk7XG5cbiAgZnVuY3Rpb24gQWNjZXNzU2NvcGUobmFtZSwgYW5jZXN0b3IpIHtcbiAgICBcblxuICAgIHZhciBfdGhpczkgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfRXhwcmVzc2lvbjcuY2FsbCh0aGlzKSk7XG5cbiAgICBfdGhpczkubmFtZSA9IG5hbWU7XG4gICAgX3RoaXM5LmFuY2VzdG9yID0gYW5jZXN0b3I7XG4gICAgX3RoaXM5LmlzQXNzaWduYWJsZSA9IHRydWU7XG4gICAgcmV0dXJuIF90aGlzOTtcbiAgfVxuXG4gIEFjY2Vzc1Njb3BlLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICB2YXIgY29udGV4dCA9IGdldENvbnRleHRGb3IodGhpcy5uYW1lLCBzY29wZSwgdGhpcy5hbmNlc3Rvcik7XG4gICAgcmV0dXJuIGNvbnRleHRbdGhpcy5uYW1lXTtcbiAgfTtcblxuICBBY2Nlc3NTY29wZS5wcm90b3R5cGUuYXNzaWduID0gZnVuY3Rpb24gYXNzaWduKHNjb3BlLCB2YWx1ZSkge1xuICAgIHZhciBjb250ZXh0ID0gZ2V0Q29udGV4dEZvcih0aGlzLm5hbWUsIHNjb3BlLCB0aGlzLmFuY2VzdG9yKTtcbiAgICByZXR1cm4gY29udGV4dCA/IGNvbnRleHRbdGhpcy5uYW1lXSA9IHZhbHVlIDogdW5kZWZpbmVkO1xuICB9O1xuXG4gIEFjY2Vzc1Njb3BlLnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiBhY2NlcHQodmlzaXRvcikge1xuICAgIHJldHVybiB2aXNpdG9yLnZpc2l0QWNjZXNzU2NvcGUodGhpcyk7XG4gIH07XG5cbiAgQWNjZXNzU2NvcGUucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KGJpbmRpbmcsIHNjb3BlKSB7XG4gICAgdmFyIGNvbnRleHQgPSBnZXRDb250ZXh0Rm9yKHRoaXMubmFtZSwgc2NvcGUsIHRoaXMuYW5jZXN0b3IpO1xuICAgIGJpbmRpbmcub2JzZXJ2ZVByb3BlcnR5KGNvbnRleHQsIHRoaXMubmFtZSk7XG4gIH07XG5cbiAgcmV0dXJuIEFjY2Vzc1Njb3BlO1xufShFeHByZXNzaW9uKTtcblxudmFyIEFjY2Vzc01lbWJlciA9IGV4cG9ydHMuQWNjZXNzTWVtYmVyID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uOCkge1xuICBfaW5oZXJpdHMoQWNjZXNzTWVtYmVyLCBfRXhwcmVzc2lvbjgpO1xuXG4gIGZ1bmN0aW9uIEFjY2Vzc01lbWJlcihvYmplY3QsIG5hbWUpIHtcbiAgICBcblxuICAgIHZhciBfdGhpczEwID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX0V4cHJlc3Npb244LmNhbGwodGhpcykpO1xuXG4gICAgX3RoaXMxMC5vYmplY3QgPSBvYmplY3Q7XG4gICAgX3RoaXMxMC5uYW1lID0gbmFtZTtcbiAgICBfdGhpczEwLmlzQXNzaWduYWJsZSA9IHRydWU7XG4gICAgcmV0dXJuIF90aGlzMTA7XG4gIH1cblxuICBBY2Nlc3NNZW1iZXIucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHZhciBpbnN0YW5jZSA9IHRoaXMub2JqZWN0LmV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpO1xuICAgIHJldHVybiBpbnN0YW5jZSA9PT0gbnVsbCB8fCBpbnN0YW5jZSA9PT0gdW5kZWZpbmVkID8gaW5zdGFuY2UgOiBpbnN0YW5jZVt0aGlzLm5hbWVdO1xuICB9O1xuXG4gIEFjY2Vzc01lbWJlci5wcm90b3R5cGUuYXNzaWduID0gZnVuY3Rpb24gYXNzaWduKHNjb3BlLCB2YWx1ZSkge1xuICAgIHZhciBpbnN0YW5jZSA9IHRoaXMub2JqZWN0LmV2YWx1YXRlKHNjb3BlKTtcblxuICAgIGlmIChpbnN0YW5jZSA9PT0gbnVsbCB8fCBpbnN0YW5jZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBpbnN0YW5jZSA9IHt9O1xuICAgICAgdGhpcy5vYmplY3QuYXNzaWduKHNjb3BlLCBpbnN0YW5jZSk7XG4gICAgfVxuXG4gICAgaW5zdGFuY2VbdGhpcy5uYW1lXSA9IHZhbHVlO1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfTtcblxuICBBY2Nlc3NNZW1iZXIucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uIGFjY2VwdCh2aXNpdG9yKSB7XG4gICAgcmV0dXJuIHZpc2l0b3IudmlzaXRBY2Nlc3NNZW1iZXIodGhpcyk7XG4gIH07XG5cbiAgQWNjZXNzTWVtYmVyLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChiaW5kaW5nLCBzY29wZSkge1xuICAgIHRoaXMub2JqZWN0LmNvbm5lY3QoYmluZGluZywgc2NvcGUpO1xuICAgIHZhciBvYmogPSB0aGlzLm9iamVjdC5ldmFsdWF0ZShzY29wZSk7XG4gICAgaWYgKG9iaikge1xuICAgICAgYmluZGluZy5vYnNlcnZlUHJvcGVydHkob2JqLCB0aGlzLm5hbWUpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gQWNjZXNzTWVtYmVyO1xufShFeHByZXNzaW9uKTtcblxudmFyIEFjY2Vzc0tleWVkID0gZXhwb3J0cy5BY2Nlc3NLZXllZCA9IGZ1bmN0aW9uIChfRXhwcmVzc2lvbjkpIHtcbiAgX2luaGVyaXRzKEFjY2Vzc0tleWVkLCBfRXhwcmVzc2lvbjkpO1xuXG4gIGZ1bmN0aW9uIEFjY2Vzc0tleWVkKG9iamVjdCwga2V5KSB7XG4gICAgXG5cbiAgICB2YXIgX3RoaXMxMSA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9FeHByZXNzaW9uOS5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzMTEub2JqZWN0ID0gb2JqZWN0O1xuICAgIF90aGlzMTEua2V5ID0ga2V5O1xuICAgIF90aGlzMTEuaXNBc3NpZ25hYmxlID0gdHJ1ZTtcbiAgICByZXR1cm4gX3RoaXMxMTtcbiAgfVxuXG4gIEFjY2Vzc0tleWVkLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICB2YXIgaW5zdGFuY2UgPSB0aGlzLm9iamVjdC5ldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKTtcbiAgICB2YXIgbG9va3VwID0gdGhpcy5rZXkuZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgcmV0dXJuIGdldEtleWVkKGluc3RhbmNlLCBsb29rdXApO1xuICB9O1xuXG4gIEFjY2Vzc0tleWVkLnByb3RvdHlwZS5hc3NpZ24gPSBmdW5jdGlvbiBhc3NpZ24oc2NvcGUsIHZhbHVlKSB7XG4gICAgdmFyIGluc3RhbmNlID0gdGhpcy5vYmplY3QuZXZhbHVhdGUoc2NvcGUpO1xuICAgIHZhciBsb29rdXAgPSB0aGlzLmtleS5ldmFsdWF0ZShzY29wZSk7XG4gICAgcmV0dXJuIHNldEtleWVkKGluc3RhbmNlLCBsb29rdXAsIHZhbHVlKTtcbiAgfTtcblxuICBBY2Nlc3NLZXllZC5wcm90b3R5cGUuYWNjZXB0ID0gZnVuY3Rpb24gYWNjZXB0KHZpc2l0b3IpIHtcbiAgICByZXR1cm4gdmlzaXRvci52aXNpdEFjY2Vzc0tleWVkKHRoaXMpO1xuICB9O1xuXG4gIEFjY2Vzc0tleWVkLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChiaW5kaW5nLCBzY29wZSkge1xuICAgIHRoaXMub2JqZWN0LmNvbm5lY3QoYmluZGluZywgc2NvcGUpO1xuICAgIHZhciBvYmogPSB0aGlzLm9iamVjdC5ldmFsdWF0ZShzY29wZSk7XG4gICAgaWYgKG9iaiBpbnN0YW5jZW9mIE9iamVjdCkge1xuICAgICAgdGhpcy5rZXkuY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gICAgICB2YXIga2V5ID0gdGhpcy5rZXkuZXZhbHVhdGUoc2NvcGUpO1xuXG4gICAgICBpZiAoa2V5ICE9PSBudWxsICYmIGtleSAhPT0gdW5kZWZpbmVkICYmICEoQXJyYXkuaXNBcnJheShvYmopICYmIHR5cGVvZiBrZXkgPT09ICdudW1iZXInKSkge1xuICAgICAgICBiaW5kaW5nLm9ic2VydmVQcm9wZXJ0eShvYmosIGtleSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBBY2Nlc3NLZXllZDtcbn0oRXhwcmVzc2lvbik7XG5cbnZhciBDYWxsU2NvcGUgPSBleHBvcnRzLkNhbGxTY29wZSA9IGZ1bmN0aW9uIChfRXhwcmVzc2lvbjEwKSB7XG4gIF9pbmhlcml0cyhDYWxsU2NvcGUsIF9FeHByZXNzaW9uMTApO1xuXG4gIGZ1bmN0aW9uIENhbGxTY29wZShuYW1lLCBhcmdzLCBhbmNlc3Rvcikge1xuICAgIFxuXG4gICAgdmFyIF90aGlzMTIgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfRXhwcmVzc2lvbjEwLmNhbGwodGhpcykpO1xuXG4gICAgX3RoaXMxMi5uYW1lID0gbmFtZTtcbiAgICBfdGhpczEyLmFyZ3MgPSBhcmdzO1xuICAgIF90aGlzMTIuYW5jZXN0b3IgPSBhbmNlc3RvcjtcbiAgICByZXR1cm4gX3RoaXMxMjtcbiAgfVxuXG4gIENhbGxTY29wZS5wcm90b3R5cGUuZXZhbHVhdGUgPSBmdW5jdGlvbiBldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zLCBtdXN0RXZhbHVhdGUpIHtcbiAgICB2YXIgYXJncyA9IGV2YWxMaXN0KHNjb3BlLCB0aGlzLmFyZ3MsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgdmFyIGNvbnRleHQgPSBnZXRDb250ZXh0Rm9yKHRoaXMubmFtZSwgc2NvcGUsIHRoaXMuYW5jZXN0b3IpO1xuICAgIHZhciBmdW5jID0gZ2V0RnVuY3Rpb24oY29udGV4dCwgdGhpcy5uYW1lLCBtdXN0RXZhbHVhdGUpO1xuICAgIGlmIChmdW5jKSB7XG4gICAgICByZXR1cm4gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfTtcblxuICBDYWxsU2NvcGUucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uIGFjY2VwdCh2aXNpdG9yKSB7XG4gICAgcmV0dXJuIHZpc2l0b3IudmlzaXRDYWxsU2NvcGUodGhpcyk7XG4gIH07XG5cbiAgQ2FsbFNjb3BlLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChiaW5kaW5nLCBzY29wZSkge1xuICAgIHZhciBhcmdzID0gdGhpcy5hcmdzO1xuICAgIHZhciBpID0gYXJncy5sZW5ndGg7XG4gICAgd2hpbGUgKGktLSkge1xuICAgICAgYXJnc1tpXS5jb25uZWN0KGJpbmRpbmcsIHNjb3BlKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIENhbGxTY29wZTtcbn0oRXhwcmVzc2lvbik7XG5cbnZhciBDYWxsTWVtYmVyID0gZXhwb3J0cy5DYWxsTWVtYmVyID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uMTEpIHtcbiAgX2luaGVyaXRzKENhbGxNZW1iZXIsIF9FeHByZXNzaW9uMTEpO1xuXG4gIGZ1bmN0aW9uIENhbGxNZW1iZXIob2JqZWN0LCBuYW1lLCBhcmdzKSB7XG4gICAgXG5cbiAgICB2YXIgX3RoaXMxMyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9FeHByZXNzaW9uMTEuY2FsbCh0aGlzKSk7XG5cbiAgICBfdGhpczEzLm9iamVjdCA9IG9iamVjdDtcbiAgICBfdGhpczEzLm5hbWUgPSBuYW1lO1xuICAgIF90aGlzMTMuYXJncyA9IGFyZ3M7XG4gICAgcmV0dXJuIF90aGlzMTM7XG4gIH1cblxuICBDYWxsTWVtYmVyLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMsIG11c3RFdmFsdWF0ZSkge1xuICAgIHZhciBpbnN0YW5jZSA9IHRoaXMub2JqZWN0LmV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpO1xuICAgIHZhciBhcmdzID0gZXZhbExpc3Qoc2NvcGUsIHRoaXMuYXJncywgbG9va3VwRnVuY3Rpb25zKTtcbiAgICB2YXIgZnVuYyA9IGdldEZ1bmN0aW9uKGluc3RhbmNlLCB0aGlzLm5hbWUsIG11c3RFdmFsdWF0ZSk7XG4gICAgaWYgKGZ1bmMpIHtcbiAgICAgIHJldHVybiBmdW5jLmFwcGx5KGluc3RhbmNlLCBhcmdzKTtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfTtcblxuICBDYWxsTWVtYmVyLnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiBhY2NlcHQodmlzaXRvcikge1xuICAgIHJldHVybiB2aXNpdG9yLnZpc2l0Q2FsbE1lbWJlcih0aGlzKTtcbiAgfTtcblxuICBDYWxsTWVtYmVyLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChiaW5kaW5nLCBzY29wZSkge1xuICAgIHRoaXMub2JqZWN0LmNvbm5lY3QoYmluZGluZywgc2NvcGUpO1xuICAgIHZhciBvYmogPSB0aGlzLm9iamVjdC5ldmFsdWF0ZShzY29wZSk7XG4gICAgaWYgKGdldEZ1bmN0aW9uKG9iaiwgdGhpcy5uYW1lLCBmYWxzZSkpIHtcbiAgICAgIHZhciBhcmdzID0gdGhpcy5hcmdzO1xuICAgICAgdmFyIF9pOCA9IGFyZ3MubGVuZ3RoO1xuICAgICAgd2hpbGUgKF9pOC0tKSB7XG4gICAgICAgIGFyZ3NbX2k4XS5jb25uZWN0KGJpbmRpbmcsIHNjb3BlKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIENhbGxNZW1iZXI7XG59KEV4cHJlc3Npb24pO1xuXG52YXIgQ2FsbEZ1bmN0aW9uID0gZXhwb3J0cy5DYWxsRnVuY3Rpb24gPSBmdW5jdGlvbiAoX0V4cHJlc3Npb24xMikge1xuICBfaW5oZXJpdHMoQ2FsbEZ1bmN0aW9uLCBfRXhwcmVzc2lvbjEyKTtcblxuICBmdW5jdGlvbiBDYWxsRnVuY3Rpb24oZnVuYywgYXJncykge1xuICAgIFxuXG4gICAgdmFyIF90aGlzMTQgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfRXhwcmVzc2lvbjEyLmNhbGwodGhpcykpO1xuXG4gICAgX3RoaXMxNC5mdW5jID0gZnVuYztcbiAgICBfdGhpczE0LmFyZ3MgPSBhcmdzO1xuICAgIHJldHVybiBfdGhpczE0O1xuICB9XG5cbiAgQ2FsbEZ1bmN0aW9uLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMsIG11c3RFdmFsdWF0ZSkge1xuICAgIHZhciBmdW5jID0gdGhpcy5mdW5jLmV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpO1xuICAgIGlmICh0eXBlb2YgZnVuYyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkobnVsbCwgZXZhbExpc3Qoc2NvcGUsIHRoaXMuYXJncywgbG9va3VwRnVuY3Rpb25zKSk7XG4gICAgfVxuICAgIGlmICghbXVzdEV2YWx1YXRlICYmIChmdW5jID09PSBudWxsIHx8IGZ1bmMgPT09IHVuZGVmaW5lZCkpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcih0aGlzLmZ1bmMgKyAnIGlzIG5vdCBhIGZ1bmN0aW9uJyk7XG4gIH07XG5cbiAgQ2FsbEZ1bmN0aW9uLnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiBhY2NlcHQodmlzaXRvcikge1xuICAgIHJldHVybiB2aXNpdG9yLnZpc2l0Q2FsbEZ1bmN0aW9uKHRoaXMpO1xuICB9O1xuXG4gIENhbGxGdW5jdGlvbi5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uIGNvbm5lY3QoYmluZGluZywgc2NvcGUpIHtcbiAgICB0aGlzLmZ1bmMuY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gICAgdmFyIGZ1bmMgPSB0aGlzLmZ1bmMuZXZhbHVhdGUoc2NvcGUpO1xuICAgIGlmICh0eXBlb2YgZnVuYyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdmFyIGFyZ3MgPSB0aGlzLmFyZ3M7XG4gICAgICB2YXIgX2k5ID0gYXJncy5sZW5ndGg7XG4gICAgICB3aGlsZSAoX2k5LS0pIHtcbiAgICAgICAgYXJnc1tfaTldLmNvbm5lY3QoYmluZGluZywgc2NvcGUpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICByZXR1cm4gQ2FsbEZ1bmN0aW9uO1xufShFeHByZXNzaW9uKTtcblxudmFyIEJpbmFyeSA9IGV4cG9ydHMuQmluYXJ5ID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uMTMpIHtcbiAgX2luaGVyaXRzKEJpbmFyeSwgX0V4cHJlc3Npb24xMyk7XG5cbiAgZnVuY3Rpb24gQmluYXJ5KG9wZXJhdGlvbiwgbGVmdCwgcmlnaHQpIHtcbiAgICBcblxuICAgIHZhciBfdGhpczE1ID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX0V4cHJlc3Npb24xMy5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzMTUub3BlcmF0aW9uID0gb3BlcmF0aW9uO1xuICAgIF90aGlzMTUubGVmdCA9IGxlZnQ7XG4gICAgX3RoaXMxNS5yaWdodCA9IHJpZ2h0O1xuICAgIHJldHVybiBfdGhpczE1O1xuICB9XG5cbiAgQmluYXJ5LnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICB2YXIgbGVmdCA9IHRoaXMubGVmdC5ldmFsdWF0ZShzY29wZSk7XG5cbiAgICBzd2l0Y2ggKHRoaXMub3BlcmF0aW9uKSB7XG4gICAgICBjYXNlICcmJic6XG4gICAgICAgIHJldHVybiBsZWZ0ICYmIHRoaXMucmlnaHQuZXZhbHVhdGUoc2NvcGUpO1xuICAgICAgY2FzZSAnfHwnOlxuICAgICAgICByZXR1cm4gbGVmdCB8fCB0aGlzLnJpZ2h0LmV2YWx1YXRlKHNjb3BlKTtcbiAgICB9XG5cbiAgICB2YXIgcmlnaHQgPSB0aGlzLnJpZ2h0LmV2YWx1YXRlKHNjb3BlKTtcblxuICAgIHN3aXRjaCAodGhpcy5vcGVyYXRpb24pIHtcbiAgICAgIGNhc2UgJz09JzpcbiAgICAgICAgcmV0dXJuIGxlZnQgPT0gcmlnaHQ7XG4gICAgICBjYXNlICc9PT0nOlxuICAgICAgICByZXR1cm4gbGVmdCA9PT0gcmlnaHQ7XG4gICAgICBjYXNlICchPSc6XG4gICAgICAgIHJldHVybiBsZWZ0ICE9IHJpZ2h0O1xuICAgICAgY2FzZSAnIT09JzpcbiAgICAgICAgcmV0dXJuIGxlZnQgIT09IHJpZ2h0O1xuICAgIH1cblxuICAgIGlmIChsZWZ0ID09PSBudWxsIHx8IHJpZ2h0ID09PSBudWxsIHx8IGxlZnQgPT09IHVuZGVmaW5lZCB8fCByaWdodCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBzd2l0Y2ggKHRoaXMub3BlcmF0aW9uKSB7XG4gICAgICAgIGNhc2UgJysnOlxuICAgICAgICAgIGlmIChsZWZ0ICE9PSBudWxsICYmIGxlZnQgIT09IHVuZGVmaW5lZCkgcmV0dXJuIGxlZnQ7XG4gICAgICAgICAgaWYgKHJpZ2h0ICE9PSBudWxsICYmIHJpZ2h0ICE9PSB1bmRlZmluZWQpIHJldHVybiByaWdodDtcbiAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgY2FzZSAnLSc6XG4gICAgICAgICAgaWYgKGxlZnQgIT09IG51bGwgJiYgbGVmdCAhPT0gdW5kZWZpbmVkKSByZXR1cm4gbGVmdDtcbiAgICAgICAgICBpZiAocmlnaHQgIT09IG51bGwgJiYgcmlnaHQgIT09IHVuZGVmaW5lZCkgcmV0dXJuIDAgLSByaWdodDtcbiAgICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgc3dpdGNoICh0aGlzLm9wZXJhdGlvbikge1xuICAgICAgY2FzZSAnKyc6XG4gICAgICAgIHJldHVybiBhdXRvQ29udmVydEFkZChsZWZ0LCByaWdodCk7XG4gICAgICBjYXNlICctJzpcbiAgICAgICAgcmV0dXJuIGxlZnQgLSByaWdodDtcbiAgICAgIGNhc2UgJyonOlxuICAgICAgICByZXR1cm4gbGVmdCAqIHJpZ2h0O1xuICAgICAgY2FzZSAnLyc6XG4gICAgICAgIHJldHVybiBsZWZ0IC8gcmlnaHQ7XG4gICAgICBjYXNlICclJzpcbiAgICAgICAgcmV0dXJuIGxlZnQgJSByaWdodDtcbiAgICAgIGNhc2UgJzwnOlxuICAgICAgICByZXR1cm4gbGVmdCA8IHJpZ2h0O1xuICAgICAgY2FzZSAnPic6XG4gICAgICAgIHJldHVybiBsZWZ0ID4gcmlnaHQ7XG4gICAgICBjYXNlICc8PSc6XG4gICAgICAgIHJldHVybiBsZWZ0IDw9IHJpZ2h0O1xuICAgICAgY2FzZSAnPj0nOlxuICAgICAgICByZXR1cm4gbGVmdCA+PSByaWdodDtcbiAgICAgIGNhc2UgJ14nOlxuICAgICAgICByZXR1cm4gbGVmdCBeIHJpZ2h0O1xuICAgIH1cblxuICAgIHRocm93IG5ldyBFcnJvcignSW50ZXJuYWwgZXJyb3IgWycgKyB0aGlzLm9wZXJhdGlvbiArICddIG5vdCBoYW5kbGVkJyk7XG4gIH07XG5cbiAgQmluYXJ5LnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiBhY2NlcHQodmlzaXRvcikge1xuICAgIHJldHVybiB2aXNpdG9yLnZpc2l0QmluYXJ5KHRoaXMpO1xuICB9O1xuXG4gIEJpbmFyeS5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uIGNvbm5lY3QoYmluZGluZywgc2NvcGUpIHtcbiAgICB0aGlzLmxlZnQuY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gICAgdmFyIGxlZnQgPSB0aGlzLmxlZnQuZXZhbHVhdGUoc2NvcGUpO1xuICAgIGlmICh0aGlzLm9wZXJhdGlvbiA9PT0gJyYmJyAmJiAhbGVmdCB8fCB0aGlzLm9wZXJhdGlvbiA9PT0gJ3x8JyAmJiBsZWZ0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMucmlnaHQuY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gIH07XG5cbiAgcmV0dXJuIEJpbmFyeTtcbn0oRXhwcmVzc2lvbik7XG5cbnZhciBQcmVmaXhOb3QgPSBleHBvcnRzLlByZWZpeE5vdCA9IGZ1bmN0aW9uIChfRXhwcmVzc2lvbjE0KSB7XG4gIF9pbmhlcml0cyhQcmVmaXhOb3QsIF9FeHByZXNzaW9uMTQpO1xuXG4gIGZ1bmN0aW9uIFByZWZpeE5vdChvcGVyYXRpb24sIGV4cHJlc3Npb24pIHtcbiAgICBcblxuICAgIHZhciBfdGhpczE2ID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX0V4cHJlc3Npb24xNC5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzMTYub3BlcmF0aW9uID0gb3BlcmF0aW9uO1xuICAgIF90aGlzMTYuZXhwcmVzc2lvbiA9IGV4cHJlc3Npb247XG4gICAgcmV0dXJuIF90aGlzMTY7XG4gIH1cblxuICBQcmVmaXhOb3QucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHJldHVybiAhdGhpcy5leHByZXNzaW9uLmV2YWx1YXRlKHNjb3BlKTtcbiAgfTtcblxuICBQcmVmaXhOb3QucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uIGFjY2VwdCh2aXNpdG9yKSB7XG4gICAgcmV0dXJuIHZpc2l0b3IudmlzaXRQcmVmaXgodGhpcyk7XG4gIH07XG5cbiAgUHJlZml4Tm90LnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChiaW5kaW5nLCBzY29wZSkge1xuICAgIHRoaXMuZXhwcmVzc2lvbi5jb25uZWN0KGJpbmRpbmcsIHNjb3BlKTtcbiAgfTtcblxuICByZXR1cm4gUHJlZml4Tm90O1xufShFeHByZXNzaW9uKTtcblxudmFyIExpdGVyYWxQcmltaXRpdmUgPSBleHBvcnRzLkxpdGVyYWxQcmltaXRpdmUgPSBmdW5jdGlvbiAoX0V4cHJlc3Npb24xNSkge1xuICBfaW5oZXJpdHMoTGl0ZXJhbFByaW1pdGl2ZSwgX0V4cHJlc3Npb24xNSk7XG5cbiAgZnVuY3Rpb24gTGl0ZXJhbFByaW1pdGl2ZSh2YWx1ZSkge1xuICAgIFxuXG4gICAgdmFyIF90aGlzMTcgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfRXhwcmVzc2lvbjE1LmNhbGwodGhpcykpO1xuXG4gICAgX3RoaXMxNy52YWx1ZSA9IHZhbHVlO1xuICAgIHJldHVybiBfdGhpczE3O1xuICB9XG5cbiAgTGl0ZXJhbFByaW1pdGl2ZS5wcm90b3R5cGUuZXZhbHVhdGUgPSBmdW5jdGlvbiBldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgcmV0dXJuIHRoaXMudmFsdWU7XG4gIH07XG5cbiAgTGl0ZXJhbFByaW1pdGl2ZS5wcm90b3R5cGUuYWNjZXB0ID0gZnVuY3Rpb24gYWNjZXB0KHZpc2l0b3IpIHtcbiAgICByZXR1cm4gdmlzaXRvci52aXNpdExpdGVyYWxQcmltaXRpdmUodGhpcyk7XG4gIH07XG5cbiAgTGl0ZXJhbFByaW1pdGl2ZS5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uIGNvbm5lY3QoYmluZGluZywgc2NvcGUpIHt9O1xuXG4gIHJldHVybiBMaXRlcmFsUHJpbWl0aXZlO1xufShFeHByZXNzaW9uKTtcblxudmFyIExpdGVyYWxTdHJpbmcgPSBleHBvcnRzLkxpdGVyYWxTdHJpbmcgPSBmdW5jdGlvbiAoX0V4cHJlc3Npb24xNikge1xuICBfaW5oZXJpdHMoTGl0ZXJhbFN0cmluZywgX0V4cHJlc3Npb24xNik7XG5cbiAgZnVuY3Rpb24gTGl0ZXJhbFN0cmluZyh2YWx1ZSkge1xuICAgIFxuXG4gICAgdmFyIF90aGlzMTggPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfRXhwcmVzc2lvbjE2LmNhbGwodGhpcykpO1xuXG4gICAgX3RoaXMxOC52YWx1ZSA9IHZhbHVlO1xuICAgIHJldHVybiBfdGhpczE4O1xuICB9XG5cbiAgTGl0ZXJhbFN0cmluZy5wcm90b3R5cGUuZXZhbHVhdGUgPSBmdW5jdGlvbiBldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgcmV0dXJuIHRoaXMudmFsdWU7XG4gIH07XG5cbiAgTGl0ZXJhbFN0cmluZy5wcm90b3R5cGUuYWNjZXB0ID0gZnVuY3Rpb24gYWNjZXB0KHZpc2l0b3IpIHtcbiAgICByZXR1cm4gdmlzaXRvci52aXNpdExpdGVyYWxTdHJpbmcodGhpcyk7XG4gIH07XG5cbiAgTGl0ZXJhbFN0cmluZy5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uIGNvbm5lY3QoYmluZGluZywgc2NvcGUpIHt9O1xuXG4gIHJldHVybiBMaXRlcmFsU3RyaW5nO1xufShFeHByZXNzaW9uKTtcblxudmFyIExpdGVyYWxBcnJheSA9IGV4cG9ydHMuTGl0ZXJhbEFycmF5ID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uMTcpIHtcbiAgX2luaGVyaXRzKExpdGVyYWxBcnJheSwgX0V4cHJlc3Npb24xNyk7XG5cbiAgZnVuY3Rpb24gTGl0ZXJhbEFycmF5KGVsZW1lbnRzKSB7XG4gICAgXG5cbiAgICB2YXIgX3RoaXMxOSA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9FeHByZXNzaW9uMTcuY2FsbCh0aGlzKSk7XG5cbiAgICBfdGhpczE5LmVsZW1lbnRzID0gZWxlbWVudHM7XG4gICAgcmV0dXJuIF90aGlzMTk7XG4gIH1cblxuICBMaXRlcmFsQXJyYXkucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHZhciBlbGVtZW50cyA9IHRoaXMuZWxlbWVudHM7XG4gICAgdmFyIHJlc3VsdCA9IFtdO1xuXG4gICAgZm9yICh2YXIgX2kxMCA9IDAsIGxlbmd0aCA9IGVsZW1lbnRzLmxlbmd0aDsgX2kxMCA8IGxlbmd0aDsgKytfaTEwKSB7XG4gICAgICByZXN1bHRbX2kxMF0gPSBlbGVtZW50c1tfaTEwXS5ldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIExpdGVyYWxBcnJheS5wcm90b3R5cGUuYWNjZXB0ID0gZnVuY3Rpb24gYWNjZXB0KHZpc2l0b3IpIHtcbiAgICByZXR1cm4gdmlzaXRvci52aXNpdExpdGVyYWxBcnJheSh0aGlzKTtcbiAgfTtcblxuICBMaXRlcmFsQXJyYXkucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KGJpbmRpbmcsIHNjb3BlKSB7XG4gICAgdmFyIGxlbmd0aCA9IHRoaXMuZWxlbWVudHMubGVuZ3RoO1xuICAgIGZvciAodmFyIF9pMTEgPSAwOyBfaTExIDwgbGVuZ3RoOyBfaTExKyspIHtcbiAgICAgIHRoaXMuZWxlbWVudHNbX2kxMV0uY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBMaXRlcmFsQXJyYXk7XG59KEV4cHJlc3Npb24pO1xuXG52YXIgTGl0ZXJhbE9iamVjdCA9IGV4cG9ydHMuTGl0ZXJhbE9iamVjdCA9IGZ1bmN0aW9uIChfRXhwcmVzc2lvbjE4KSB7XG4gIF9pbmhlcml0cyhMaXRlcmFsT2JqZWN0LCBfRXhwcmVzc2lvbjE4KTtcblxuICBmdW5jdGlvbiBMaXRlcmFsT2JqZWN0KGtleXMsIHZhbHVlcykge1xuICAgIFxuXG4gICAgdmFyIF90aGlzMjAgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfRXhwcmVzc2lvbjE4LmNhbGwodGhpcykpO1xuXG4gICAgX3RoaXMyMC5rZXlzID0ga2V5cztcbiAgICBfdGhpczIwLnZhbHVlcyA9IHZhbHVlcztcbiAgICByZXR1cm4gX3RoaXMyMDtcbiAgfVxuXG4gIExpdGVyYWxPYmplY3QucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHZhciBpbnN0YW5jZSA9IHt9O1xuICAgIHZhciBrZXlzID0gdGhpcy5rZXlzO1xuICAgIHZhciB2YWx1ZXMgPSB0aGlzLnZhbHVlcztcblxuICAgIGZvciAodmFyIF9pMTIgPSAwLCBsZW5ndGggPSBrZXlzLmxlbmd0aDsgX2kxMiA8IGxlbmd0aDsgKytfaTEyKSB7XG4gICAgICBpbnN0YW5jZVtrZXlzW19pMTJdXSA9IHZhbHVlc1tfaTEyXS5ldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKTtcbiAgICB9XG5cbiAgICByZXR1cm4gaW5zdGFuY2U7XG4gIH07XG5cbiAgTGl0ZXJhbE9iamVjdC5wcm90b3R5cGUuYWNjZXB0ID0gZnVuY3Rpb24gYWNjZXB0KHZpc2l0b3IpIHtcbiAgICByZXR1cm4gdmlzaXRvci52aXNpdExpdGVyYWxPYmplY3QodGhpcyk7XG4gIH07XG5cbiAgTGl0ZXJhbE9iamVjdC5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uIGNvbm5lY3QoYmluZGluZywgc2NvcGUpIHtcbiAgICB2YXIgbGVuZ3RoID0gdGhpcy5rZXlzLmxlbmd0aDtcbiAgICBmb3IgKHZhciBfaTEzID0gMDsgX2kxMyA8IGxlbmd0aDsgX2kxMysrKSB7XG4gICAgICB0aGlzLnZhbHVlc1tfaTEzXS5jb25uZWN0KGJpbmRpbmcsIHNjb3BlKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIExpdGVyYWxPYmplY3Q7XG59KEV4cHJlc3Npb24pO1xuXG52YXIgZXZhbExpc3RDYWNoZSA9IFtbXSwgWzBdLCBbMCwgMF0sIFswLCAwLCAwXSwgWzAsIDAsIDAsIDBdLCBbMCwgMCwgMCwgMCwgMF1dO1xuXG5mdW5jdGlvbiBldmFsTGlzdChzY29wZSwgbGlzdCwgbG9va3VwRnVuY3Rpb25zKSB7XG4gIHZhciBsZW5ndGggPSBsaXN0Lmxlbmd0aDtcblxuICBmb3IgKHZhciBjYWNoZUxlbmd0aCA9IGV2YWxMaXN0Q2FjaGUubGVuZ3RoOyBjYWNoZUxlbmd0aCA8PSBsZW5ndGg7ICsrY2FjaGVMZW5ndGgpIHtcbiAgICBldmFsTGlzdENhY2hlLnB1c2goW10pO1xuICB9XG5cbiAgdmFyIHJlc3VsdCA9IGV2YWxMaXN0Q2FjaGVbbGVuZ3RoXTtcblxuICBmb3IgKHZhciBfaTE0ID0gMDsgX2kxNCA8IGxlbmd0aDsgKytfaTE0KSB7XG4gICAgcmVzdWx0W19pMTRdID0gbGlzdFtfaTE0XS5ldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIGF1dG9Db252ZXJ0QWRkKGEsIGIpIHtcbiAgaWYgKGEgIT09IG51bGwgJiYgYiAhPT0gbnVsbCkge1xuICAgIGlmICh0eXBlb2YgYSA9PT0gJ3N0cmluZycgJiYgdHlwZW9mIGIgIT09ICdzdHJpbmcnKSB7XG4gICAgICByZXR1cm4gYSArIGIudG9TdHJpbmcoKTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIGEgIT09ICdzdHJpbmcnICYmIHR5cGVvZiBiID09PSAnc3RyaW5nJykge1xuICAgICAgcmV0dXJuIGEudG9TdHJpbmcoKSArIGI7XG4gICAgfVxuXG4gICAgcmV0dXJuIGEgKyBiO1xuICB9XG5cbiAgaWYgKGEgIT09IG51bGwpIHtcbiAgICByZXR1cm4gYTtcbiAgfVxuXG4gIGlmIChiICE9PSBudWxsKSB7XG4gICAgcmV0dXJuIGI7XG4gIH1cblxuICByZXR1cm4gMDtcbn1cblxuZnVuY3Rpb24gZ2V0RnVuY3Rpb24ob2JqLCBuYW1lLCBtdXN0RXhpc3QpIHtcbiAgdmFyIGZ1bmMgPSBvYmogPT09IG51bGwgfHwgb2JqID09PSB1bmRlZmluZWQgPyBudWxsIDogb2JqW25hbWVdO1xuICBpZiAodHlwZW9mIGZ1bmMgPT09ICdmdW5jdGlvbicpIHtcbiAgICByZXR1cm4gZnVuYztcbiAgfVxuICBpZiAoIW11c3RFeGlzdCAmJiAoZnVuYyA9PT0gbnVsbCB8fCBmdW5jID09PSB1bmRlZmluZWQpKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgdGhyb3cgbmV3IEVycm9yKG5hbWUgKyAnIGlzIG5vdCBhIGZ1bmN0aW9uJyk7XG59XG5cbmZ1bmN0aW9uIGdldEtleWVkKG9iaiwga2V5KSB7XG4gIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcbiAgICByZXR1cm4gb2JqW3BhcnNlSW50KGtleSwgMTApXTtcbiAgfSBlbHNlIGlmIChvYmopIHtcbiAgICByZXR1cm4gb2JqW2tleV07XG4gIH0gZWxzZSBpZiAob2JqID09PSBudWxsIHx8IG9iaiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIHJldHVybiBvYmpba2V5XTtcbn1cblxuZnVuY3Rpb24gc2V0S2V5ZWQob2JqLCBrZXksIHZhbHVlKSB7XG4gIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcbiAgICB2YXIgaW5kZXggPSBwYXJzZUludChrZXksIDEwKTtcblxuICAgIGlmIChvYmoubGVuZ3RoIDw9IGluZGV4KSB7XG4gICAgICBvYmoubGVuZ3RoID0gaW5kZXggKyAxO1xuICAgIH1cblxuICAgIG9ialtpbmRleF0gPSB2YWx1ZTtcbiAgfSBlbHNlIHtcbiAgICBvYmpba2V5XSA9IHZhbHVlO1xuICB9XG5cbiAgcmV0dXJuIHZhbHVlO1xufVxuXG52YXIgVW5wYXJzZXIgPSBleHBvcnRzLlVucGFyc2VyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBVbnBhcnNlcihidWZmZXIpIHtcbiAgICBcblxuICAgIHRoaXMuYnVmZmVyID0gYnVmZmVyO1xuICB9XG5cbiAgVW5wYXJzZXIudW5wYXJzZSA9IGZ1bmN0aW9uIHVucGFyc2UoZXhwcmVzc2lvbikge1xuICAgIHZhciBidWZmZXIgPSBbXTtcbiAgICB2YXIgdmlzaXRvciA9IG5ldyBVbnBhcnNlcihidWZmZXIpO1xuXG4gICAgZXhwcmVzc2lvbi5hY2NlcHQodmlzaXRvcik7XG5cbiAgICByZXR1cm4gYnVmZmVyLmpvaW4oJycpO1xuICB9O1xuXG4gIFVucGFyc2VyLnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uIHdyaXRlKHRleHQpIHtcbiAgICB0aGlzLmJ1ZmZlci5wdXNoKHRleHQpO1xuICB9O1xuXG4gIFVucGFyc2VyLnByb3RvdHlwZS53cml0ZUFyZ3MgPSBmdW5jdGlvbiB3cml0ZUFyZ3MoYXJncykge1xuICAgIHRoaXMud3JpdGUoJygnKTtcblxuICAgIGZvciAodmFyIF9pMTUgPSAwLCBsZW5ndGggPSBhcmdzLmxlbmd0aDsgX2kxNSA8IGxlbmd0aDsgKytfaTE1KSB7XG4gICAgICBpZiAoX2kxNSAhPT0gMCkge1xuICAgICAgICB0aGlzLndyaXRlKCcsJyk7XG4gICAgICB9XG5cbiAgICAgIGFyZ3NbX2kxNV0uYWNjZXB0KHRoaXMpO1xuICAgIH1cblxuICAgIHRoaXMud3JpdGUoJyknKTtcbiAgfTtcblxuICBVbnBhcnNlci5wcm90b3R5cGUudmlzaXRDaGFpbiA9IGZ1bmN0aW9uIHZpc2l0Q2hhaW4oY2hhaW4pIHtcbiAgICB2YXIgZXhwcmVzc2lvbnMgPSBjaGFpbi5leHByZXNzaW9ucztcblxuICAgIGZvciAodmFyIF9pMTYgPSAwLCBsZW5ndGggPSBleHByZXNzaW9uLmxlbmd0aDsgX2kxNiA8IGxlbmd0aDsgKytfaTE2KSB7XG4gICAgICBpZiAoX2kxNiAhPT0gMCkge1xuICAgICAgICB0aGlzLndyaXRlKCc7Jyk7XG4gICAgICB9XG5cbiAgICAgIGV4cHJlc3Npb25zW19pMTZdLmFjY2VwdCh0aGlzKTtcbiAgICB9XG4gIH07XG5cbiAgVW5wYXJzZXIucHJvdG90eXBlLnZpc2l0QmluZGluZ0JlaGF2aW9yID0gZnVuY3Rpb24gdmlzaXRCaW5kaW5nQmVoYXZpb3IoYmVoYXZpb3IpIHtcbiAgICB2YXIgYXJncyA9IGJlaGF2aW9yLmFyZ3M7XG5cbiAgICBiZWhhdmlvci5leHByZXNzaW9uLmFjY2VwdCh0aGlzKTtcbiAgICB0aGlzLndyaXRlKCcmJyArIGJlaGF2aW9yLm5hbWUpO1xuXG4gICAgZm9yICh2YXIgX2kxNyA9IDAsIGxlbmd0aCA9IGFyZ3MubGVuZ3RoOyBfaTE3IDwgbGVuZ3RoOyArK19pMTcpIHtcbiAgICAgIHRoaXMud3JpdGUoJzonKTtcbiAgICAgIGFyZ3NbX2kxN10uYWNjZXB0KHRoaXMpO1xuICAgIH1cbiAgfTtcblxuICBVbnBhcnNlci5wcm90b3R5cGUudmlzaXRWYWx1ZUNvbnZlcnRlciA9IGZ1bmN0aW9uIHZpc2l0VmFsdWVDb252ZXJ0ZXIoY29udmVydGVyKSB7XG4gICAgdmFyIGFyZ3MgPSBjb252ZXJ0ZXIuYXJncztcblxuICAgIGNvbnZlcnRlci5leHByZXNzaW9uLmFjY2VwdCh0aGlzKTtcbiAgICB0aGlzLndyaXRlKCd8JyArIGNvbnZlcnRlci5uYW1lKTtcblxuICAgIGZvciAodmFyIF9pMTggPSAwLCBsZW5ndGggPSBhcmdzLmxlbmd0aDsgX2kxOCA8IGxlbmd0aDsgKytfaTE4KSB7XG4gICAgICB0aGlzLndyaXRlKCc6Jyk7XG4gICAgICBhcmdzW19pMThdLmFjY2VwdCh0aGlzKTtcbiAgICB9XG4gIH07XG5cbiAgVW5wYXJzZXIucHJvdG90eXBlLnZpc2l0QXNzaWduID0gZnVuY3Rpb24gdmlzaXRBc3NpZ24oYXNzaWduKSB7XG4gICAgYXNzaWduLnRhcmdldC5hY2NlcHQodGhpcyk7XG4gICAgdGhpcy53cml0ZSgnPScpO1xuICAgIGFzc2lnbi52YWx1ZS5hY2NlcHQodGhpcyk7XG4gIH07XG5cbiAgVW5wYXJzZXIucHJvdG90eXBlLnZpc2l0Q29uZGl0aW9uYWwgPSBmdW5jdGlvbiB2aXNpdENvbmRpdGlvbmFsKGNvbmRpdGlvbmFsKSB7XG4gICAgY29uZGl0aW9uYWwuY29uZGl0aW9uLmFjY2VwdCh0aGlzKTtcbiAgICB0aGlzLndyaXRlKCc/Jyk7XG4gICAgY29uZGl0aW9uYWwueWVzLmFjY2VwdCh0aGlzKTtcbiAgICB0aGlzLndyaXRlKCc6Jyk7XG4gICAgY29uZGl0aW9uYWwubm8uYWNjZXB0KHRoaXMpO1xuICB9O1xuXG4gIFVucGFyc2VyLnByb3RvdHlwZS52aXNpdEFjY2Vzc1RoaXMgPSBmdW5jdGlvbiB2aXNpdEFjY2Vzc1RoaXMoYWNjZXNzKSB7XG4gICAgaWYgKGFjY2Vzcy5hbmNlc3RvciA9PT0gMCkge1xuICAgICAgdGhpcy53cml0ZSgnJHRoaXMnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy53cml0ZSgnJHBhcmVudCcpO1xuICAgIHZhciBpID0gYWNjZXNzLmFuY2VzdG9yIC0gMTtcbiAgICB3aGlsZSAoaS0tKSB7XG4gICAgICB0aGlzLndyaXRlKCcuJHBhcmVudCcpO1xuICAgIH1cbiAgfTtcblxuICBVbnBhcnNlci5wcm90b3R5cGUudmlzaXRBY2Nlc3NTY29wZSA9IGZ1bmN0aW9uIHZpc2l0QWNjZXNzU2NvcGUoYWNjZXNzKSB7XG4gICAgdmFyIGkgPSBhY2Nlc3MuYW5jZXN0b3I7XG4gICAgd2hpbGUgKGktLSkge1xuICAgICAgdGhpcy53cml0ZSgnJHBhcmVudC4nKTtcbiAgICB9XG4gICAgdGhpcy53cml0ZShhY2Nlc3MubmFtZSk7XG4gIH07XG5cbiAgVW5wYXJzZXIucHJvdG90eXBlLnZpc2l0QWNjZXNzTWVtYmVyID0gZnVuY3Rpb24gdmlzaXRBY2Nlc3NNZW1iZXIoYWNjZXNzKSB7XG4gICAgYWNjZXNzLm9iamVjdC5hY2NlcHQodGhpcyk7XG4gICAgdGhpcy53cml0ZSgnLicgKyBhY2Nlc3MubmFtZSk7XG4gIH07XG5cbiAgVW5wYXJzZXIucHJvdG90eXBlLnZpc2l0QWNjZXNzS2V5ZWQgPSBmdW5jdGlvbiB2aXNpdEFjY2Vzc0tleWVkKGFjY2Vzcykge1xuICAgIGFjY2Vzcy5vYmplY3QuYWNjZXB0KHRoaXMpO1xuICAgIHRoaXMud3JpdGUoJ1snKTtcbiAgICBhY2Nlc3Mua2V5LmFjY2VwdCh0aGlzKTtcbiAgICB0aGlzLndyaXRlKCddJyk7XG4gIH07XG5cbiAgVW5wYXJzZXIucHJvdG90eXBlLnZpc2l0Q2FsbFNjb3BlID0gZnVuY3Rpb24gdmlzaXRDYWxsU2NvcGUoY2FsbCkge1xuICAgIHZhciBpID0gY2FsbC5hbmNlc3RvcjtcbiAgICB3aGlsZSAoaS0tKSB7XG4gICAgICB0aGlzLndyaXRlKCckcGFyZW50LicpO1xuICAgIH1cbiAgICB0aGlzLndyaXRlKGNhbGwubmFtZSk7XG4gICAgdGhpcy53cml0ZUFyZ3MoY2FsbC5hcmdzKTtcbiAgfTtcblxuICBVbnBhcnNlci5wcm90b3R5cGUudmlzaXRDYWxsRnVuY3Rpb24gPSBmdW5jdGlvbiB2aXNpdENhbGxGdW5jdGlvbihjYWxsKSB7XG4gICAgY2FsbC5mdW5jLmFjY2VwdCh0aGlzKTtcbiAgICB0aGlzLndyaXRlQXJncyhjYWxsLmFyZ3MpO1xuICB9O1xuXG4gIFVucGFyc2VyLnByb3RvdHlwZS52aXNpdENhbGxNZW1iZXIgPSBmdW5jdGlvbiB2aXNpdENhbGxNZW1iZXIoY2FsbCkge1xuICAgIGNhbGwub2JqZWN0LmFjY2VwdCh0aGlzKTtcbiAgICB0aGlzLndyaXRlKCcuJyArIGNhbGwubmFtZSk7XG4gICAgdGhpcy53cml0ZUFyZ3MoY2FsbC5hcmdzKTtcbiAgfTtcblxuICBVbnBhcnNlci5wcm90b3R5cGUudmlzaXRQcmVmaXggPSBmdW5jdGlvbiB2aXNpdFByZWZpeChwcmVmaXgpIHtcbiAgICB0aGlzLndyaXRlKCcoJyArIHByZWZpeC5vcGVyYXRpb24pO1xuICAgIHByZWZpeC5leHByZXNzaW9uLmFjY2VwdCh0aGlzKTtcbiAgICB0aGlzLndyaXRlKCcpJyk7XG4gIH07XG5cbiAgVW5wYXJzZXIucHJvdG90eXBlLnZpc2l0QmluYXJ5ID0gZnVuY3Rpb24gdmlzaXRCaW5hcnkoYmluYXJ5KSB7XG4gICAgYmluYXJ5LmxlZnQuYWNjZXB0KHRoaXMpO1xuICAgIHRoaXMud3JpdGUoYmluYXJ5Lm9wZXJhdGlvbik7XG4gICAgYmluYXJ5LnJpZ2h0LmFjY2VwdCh0aGlzKTtcbiAgfTtcblxuICBVbnBhcnNlci5wcm90b3R5cGUudmlzaXRMaXRlcmFsUHJpbWl0aXZlID0gZnVuY3Rpb24gdmlzaXRMaXRlcmFsUHJpbWl0aXZlKGxpdGVyYWwpIHtcbiAgICB0aGlzLndyaXRlKCcnICsgbGl0ZXJhbC52YWx1ZSk7XG4gIH07XG5cbiAgVW5wYXJzZXIucHJvdG90eXBlLnZpc2l0TGl0ZXJhbEFycmF5ID0gZnVuY3Rpb24gdmlzaXRMaXRlcmFsQXJyYXkobGl0ZXJhbCkge1xuICAgIHZhciBlbGVtZW50cyA9IGxpdGVyYWwuZWxlbWVudHM7XG5cbiAgICB0aGlzLndyaXRlKCdbJyk7XG5cbiAgICBmb3IgKHZhciBfaTE5ID0gMCwgbGVuZ3RoID0gZWxlbWVudHMubGVuZ3RoOyBfaTE5IDwgbGVuZ3RoOyArK19pMTkpIHtcbiAgICAgIGlmIChfaTE5ICE9PSAwKSB7XG4gICAgICAgIHRoaXMud3JpdGUoJywnKTtcbiAgICAgIH1cblxuICAgICAgZWxlbWVudHNbX2kxOV0uYWNjZXB0KHRoaXMpO1xuICAgIH1cblxuICAgIHRoaXMud3JpdGUoJ10nKTtcbiAgfTtcblxuICBVbnBhcnNlci5wcm90b3R5cGUudmlzaXRMaXRlcmFsT2JqZWN0ID0gZnVuY3Rpb24gdmlzaXRMaXRlcmFsT2JqZWN0KGxpdGVyYWwpIHtcbiAgICB2YXIga2V5cyA9IGxpdGVyYWwua2V5cztcbiAgICB2YXIgdmFsdWVzID0gbGl0ZXJhbC52YWx1ZXM7XG5cbiAgICB0aGlzLndyaXRlKCd7Jyk7XG5cbiAgICBmb3IgKHZhciBfaTIwID0gMCwgbGVuZ3RoID0ga2V5cy5sZW5ndGg7IF9pMjAgPCBsZW5ndGg7ICsrX2kyMCkge1xuICAgICAgaWYgKF9pMjAgIT09IDApIHtcbiAgICAgICAgdGhpcy53cml0ZSgnLCcpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLndyaXRlKCdcXCcnICsga2V5c1tfaTIwXSArICdcXCc6Jyk7XG4gICAgICB2YWx1ZXNbX2kyMF0uYWNjZXB0KHRoaXMpO1xuICAgIH1cblxuICAgIHRoaXMud3JpdGUoJ30nKTtcbiAgfTtcblxuICBVbnBhcnNlci5wcm90b3R5cGUudmlzaXRMaXRlcmFsU3RyaW5nID0gZnVuY3Rpb24gdmlzaXRMaXRlcmFsU3RyaW5nKGxpdGVyYWwpIHtcbiAgICB2YXIgZXNjYXBlZCA9IGxpdGVyYWwudmFsdWUucmVwbGFjZSgvJy9nLCBcIlxcJ1wiKTtcbiAgICB0aGlzLndyaXRlKCdcXCcnICsgZXNjYXBlZCArICdcXCcnKTtcbiAgfTtcblxuICByZXR1cm4gVW5wYXJzZXI7XG59KCk7XG5cbnZhciBFeHByZXNzaW9uQ2xvbmVyID0gZXhwb3J0cy5FeHByZXNzaW9uQ2xvbmVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBFeHByZXNzaW9uQ2xvbmVyKCkge1xuICAgIFxuICB9XG5cbiAgRXhwcmVzc2lvbkNsb25lci5wcm90b3R5cGUuY2xvbmVFeHByZXNzaW9uQXJyYXkgPSBmdW5jdGlvbiBjbG9uZUV4cHJlc3Npb25BcnJheShhcnJheSkge1xuICAgIHZhciBjbG9uZWRBcnJheSA9IFtdO1xuICAgIHZhciBpID0gYXJyYXkubGVuZ3RoO1xuICAgIHdoaWxlIChpLS0pIHtcbiAgICAgIGNsb25lZEFycmF5W2ldID0gYXJyYXlbaV0uYWNjZXB0KHRoaXMpO1xuICAgIH1cbiAgICByZXR1cm4gY2xvbmVkQXJyYXk7XG4gIH07XG5cbiAgRXhwcmVzc2lvbkNsb25lci5wcm90b3R5cGUudmlzaXRDaGFpbiA9IGZ1bmN0aW9uIHZpc2l0Q2hhaW4oY2hhaW4pIHtcbiAgICByZXR1cm4gbmV3IENoYWluKHRoaXMuY2xvbmVFeHByZXNzaW9uQXJyYXkoY2hhaW4uZXhwcmVzc2lvbnMpKTtcbiAgfTtcblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS52aXNpdEJpbmRpbmdCZWhhdmlvciA9IGZ1bmN0aW9uIHZpc2l0QmluZGluZ0JlaGF2aW9yKGJlaGF2aW9yKSB7XG4gICAgcmV0dXJuIG5ldyBCaW5kaW5nQmVoYXZpb3IoYmVoYXZpb3IuZXhwcmVzc2lvbi5hY2NlcHQodGhpcyksIGJlaGF2aW9yLm5hbWUsIHRoaXMuY2xvbmVFeHByZXNzaW9uQXJyYXkoYmVoYXZpb3IuYXJncykpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0VmFsdWVDb252ZXJ0ZXIgPSBmdW5jdGlvbiB2aXNpdFZhbHVlQ29udmVydGVyKGNvbnZlcnRlcikge1xuICAgIHJldHVybiBuZXcgVmFsdWVDb252ZXJ0ZXIoY29udmVydGVyLmV4cHJlc3Npb24uYWNjZXB0KHRoaXMpLCBjb252ZXJ0ZXIubmFtZSwgdGhpcy5jbG9uZUV4cHJlc3Npb25BcnJheShjb252ZXJ0ZXIuYXJncykpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0QXNzaWduID0gZnVuY3Rpb24gdmlzaXRBc3NpZ24oYXNzaWduKSB7XG4gICAgcmV0dXJuIG5ldyBBc3NpZ24oYXNzaWduLnRhcmdldC5hY2NlcHQodGhpcyksIGFzc2lnbi52YWx1ZS5hY2NlcHQodGhpcykpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0Q29uZGl0aW9uYWwgPSBmdW5jdGlvbiB2aXNpdENvbmRpdGlvbmFsKGNvbmRpdGlvbmFsKSB7XG4gICAgcmV0dXJuIG5ldyBDb25kaXRpb25hbChjb25kaXRpb25hbC5jb25kaXRpb24uYWNjZXB0KHRoaXMpLCBjb25kaXRpb25hbC55ZXMuYWNjZXB0KHRoaXMpLCBjb25kaXRpb25hbC5uby5hY2NlcHQodGhpcykpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0QWNjZXNzVGhpcyA9IGZ1bmN0aW9uIHZpc2l0QWNjZXNzVGhpcyhhY2Nlc3MpIHtcbiAgICByZXR1cm4gbmV3IEFjY2Vzc1RoaXMoYWNjZXNzLmFuY2VzdG9yKTtcbiAgfTtcblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS52aXNpdEFjY2Vzc1Njb3BlID0gZnVuY3Rpb24gdmlzaXRBY2Nlc3NTY29wZShhY2Nlc3MpIHtcbiAgICByZXR1cm4gbmV3IEFjY2Vzc1Njb3BlKGFjY2Vzcy5uYW1lLCBhY2Nlc3MuYW5jZXN0b3IpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0QWNjZXNzTWVtYmVyID0gZnVuY3Rpb24gdmlzaXRBY2Nlc3NNZW1iZXIoYWNjZXNzKSB7XG4gICAgcmV0dXJuIG5ldyBBY2Nlc3NNZW1iZXIoYWNjZXNzLm9iamVjdC5hY2NlcHQodGhpcyksIGFjY2Vzcy5uYW1lKTtcbiAgfTtcblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS52aXNpdEFjY2Vzc0tleWVkID0gZnVuY3Rpb24gdmlzaXRBY2Nlc3NLZXllZChhY2Nlc3MpIHtcbiAgICByZXR1cm4gbmV3IEFjY2Vzc0tleWVkKGFjY2Vzcy5vYmplY3QuYWNjZXB0KHRoaXMpLCBhY2Nlc3Mua2V5LmFjY2VwdCh0aGlzKSk7XG4gIH07XG5cbiAgRXhwcmVzc2lvbkNsb25lci5wcm90b3R5cGUudmlzaXRDYWxsU2NvcGUgPSBmdW5jdGlvbiB2aXNpdENhbGxTY29wZShjYWxsKSB7XG4gICAgcmV0dXJuIG5ldyBDYWxsU2NvcGUoY2FsbC5uYW1lLCB0aGlzLmNsb25lRXhwcmVzc2lvbkFycmF5KGNhbGwuYXJncyksIGNhbGwuYW5jZXN0b3IpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0Q2FsbEZ1bmN0aW9uID0gZnVuY3Rpb24gdmlzaXRDYWxsRnVuY3Rpb24oY2FsbCkge1xuICAgIHJldHVybiBuZXcgQ2FsbEZ1bmN0aW9uKGNhbGwuZnVuYy5hY2NlcHQodGhpcyksIHRoaXMuY2xvbmVFeHByZXNzaW9uQXJyYXkoY2FsbC5hcmdzKSk7XG4gIH07XG5cbiAgRXhwcmVzc2lvbkNsb25lci5wcm90b3R5cGUudmlzaXRDYWxsTWVtYmVyID0gZnVuY3Rpb24gdmlzaXRDYWxsTWVtYmVyKGNhbGwpIHtcbiAgICByZXR1cm4gbmV3IENhbGxNZW1iZXIoY2FsbC5vYmplY3QuYWNjZXB0KHRoaXMpLCBjYWxsLm5hbWUsIHRoaXMuY2xvbmVFeHByZXNzaW9uQXJyYXkoY2FsbC5hcmdzKSk7XG4gIH07XG5cbiAgRXhwcmVzc2lvbkNsb25lci5wcm90b3R5cGUudmlzaXRQcmVmaXggPSBmdW5jdGlvbiB2aXNpdFByZWZpeChwcmVmaXgpIHtcbiAgICByZXR1cm4gbmV3IFByZWZpeE5vdChwcmVmaXgub3BlcmF0aW9uLCBwcmVmaXguZXhwcmVzc2lvbi5hY2NlcHQodGhpcykpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0QmluYXJ5ID0gZnVuY3Rpb24gdmlzaXRCaW5hcnkoYmluYXJ5KSB7XG4gICAgcmV0dXJuIG5ldyBCaW5hcnkoYmluYXJ5Lm9wZXJhdGlvbiwgYmluYXJ5LmxlZnQuYWNjZXB0KHRoaXMpLCBiaW5hcnkucmlnaHQuYWNjZXB0KHRoaXMpKTtcbiAgfTtcblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS52aXNpdExpdGVyYWxQcmltaXRpdmUgPSBmdW5jdGlvbiB2aXNpdExpdGVyYWxQcmltaXRpdmUobGl0ZXJhbCkge1xuICAgIHJldHVybiBuZXcgTGl0ZXJhbFByaW1pdGl2ZShsaXRlcmFsKTtcbiAgfTtcblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS52aXNpdExpdGVyYWxBcnJheSA9IGZ1bmN0aW9uIHZpc2l0TGl0ZXJhbEFycmF5KGxpdGVyYWwpIHtcbiAgICByZXR1cm4gbmV3IExpdGVyYWxBcnJheSh0aGlzLmNsb25lRXhwcmVzc2lvbkFycmF5KGxpdGVyYWwuZWxlbWVudHMpKTtcbiAgfTtcblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS52aXNpdExpdGVyYWxPYmplY3QgPSBmdW5jdGlvbiB2aXNpdExpdGVyYWxPYmplY3QobGl0ZXJhbCkge1xuICAgIHJldHVybiBuZXcgTGl0ZXJhbE9iamVjdChsaXRlcmFsLmtleXMsIHRoaXMuY2xvbmVFeHByZXNzaW9uQXJyYXkobGl0ZXJhbC52YWx1ZXMpKTtcbiAgfTtcblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS52aXNpdExpdGVyYWxTdHJpbmcgPSBmdW5jdGlvbiB2aXNpdExpdGVyYWxTdHJpbmcobGl0ZXJhbCkge1xuICAgIHJldHVybiBuZXcgTGl0ZXJhbFN0cmluZyhsaXRlcmFsLnZhbHVlKTtcbiAgfTtcblxuICByZXR1cm4gRXhwcmVzc2lvbkNsb25lcjtcbn0oKTtcblxuZnVuY3Rpb24gY2xvbmVFeHByZXNzaW9uKGV4cHJlc3Npb24pIHtcbiAgdmFyIHZpc2l0b3IgPSBuZXcgRXhwcmVzc2lvbkNsb25lcigpO1xuICByZXR1cm4gZXhwcmVzc2lvbi5hY2NlcHQodmlzaXRvcik7XG59XG5cbnZhciBiaW5kaW5nTW9kZSA9IGV4cG9ydHMuYmluZGluZ01vZGUgPSB7XG4gIG9uZVRpbWU6IDAsXG4gIG9uZVdheTogMSxcbiAgdHdvV2F5OiAyXG59O1xuXG52YXIgVG9rZW4gPSBleHBvcnRzLlRva2VuID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBUb2tlbihpbmRleCwgdGV4dCkge1xuICAgIFxuXG4gICAgdGhpcy5pbmRleCA9IGluZGV4O1xuICAgIHRoaXMudGV4dCA9IHRleHQ7XG4gIH1cblxuICBUb2tlbi5wcm90b3R5cGUud2l0aE9wID0gZnVuY3Rpb24gd2l0aE9wKG9wKSB7XG4gICAgdGhpcy5vcEtleSA9IG9wO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIFRva2VuLnByb3RvdHlwZS53aXRoR2V0dGVyU2V0dGVyID0gZnVuY3Rpb24gd2l0aEdldHRlclNldHRlcihrZXkpIHtcbiAgICB0aGlzLmtleSA9IGtleTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBUb2tlbi5wcm90b3R5cGUud2l0aFZhbHVlID0gZnVuY3Rpb24gd2l0aFZhbHVlKHZhbHVlKSB7XG4gICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIFRva2VuLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uIHRvU3RyaW5nKCkge1xuICAgIHJldHVybiAnVG9rZW4oJyArIHRoaXMudGV4dCArICcpJztcbiAgfTtcblxuICByZXR1cm4gVG9rZW47XG59KCk7XG5cbnZhciBMZXhlciA9IGV4cG9ydHMuTGV4ZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIExleGVyKCkge1xuICAgIFxuICB9XG5cbiAgTGV4ZXIucHJvdG90eXBlLmxleCA9IGZ1bmN0aW9uIGxleCh0ZXh0KSB7XG4gICAgdmFyIHNjYW5uZXIgPSBuZXcgU2Nhbm5lcih0ZXh0KTtcbiAgICB2YXIgdG9rZW5zID0gW107XG4gICAgdmFyIHRva2VuID0gc2Nhbm5lci5zY2FuVG9rZW4oKTtcblxuICAgIHdoaWxlICh0b2tlbikge1xuICAgICAgdG9rZW5zLnB1c2godG9rZW4pO1xuICAgICAgdG9rZW4gPSBzY2FubmVyLnNjYW5Ub2tlbigpO1xuICAgIH1cblxuICAgIHJldHVybiB0b2tlbnM7XG4gIH07XG5cbiAgcmV0dXJuIExleGVyO1xufSgpO1xuXG52YXIgU2Nhbm5lciA9IGV4cG9ydHMuU2Nhbm5lciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gU2Nhbm5lcihpbnB1dCkge1xuICAgIFxuXG4gICAgdGhpcy5pbnB1dCA9IGlucHV0O1xuICAgIHRoaXMubGVuZ3RoID0gaW5wdXQubGVuZ3RoO1xuICAgIHRoaXMucGVlayA9IDA7XG4gICAgdGhpcy5pbmRleCA9IC0xO1xuXG4gICAgdGhpcy5hZHZhbmNlKCk7XG4gIH1cblxuICBTY2FubmVyLnByb3RvdHlwZS5zY2FuVG9rZW4gPSBmdW5jdGlvbiBzY2FuVG9rZW4oKSB7XG4gICAgd2hpbGUgKHRoaXMucGVlayA8PSAkU1BBQ0UpIHtcbiAgICAgIGlmICgrK3RoaXMuaW5kZXggPj0gdGhpcy5sZW5ndGgpIHtcbiAgICAgICAgdGhpcy5wZWVrID0gJEVPRjtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIHRoaXMucGVlayA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLmluZGV4KTtcbiAgICB9XG5cbiAgICBpZiAoaXNJZGVudGlmaWVyU3RhcnQodGhpcy5wZWVrKSkge1xuICAgICAgcmV0dXJuIHRoaXMuc2NhbklkZW50aWZpZXIoKTtcbiAgICB9XG5cbiAgICBpZiAoaXNEaWdpdCh0aGlzLnBlZWspKSB7XG4gICAgICByZXR1cm4gdGhpcy5zY2FuTnVtYmVyKHRoaXMuaW5kZXgpO1xuICAgIH1cblxuICAgIHZhciBzdGFydCA9IHRoaXMuaW5kZXg7XG5cbiAgICBzd2l0Y2ggKHRoaXMucGVlaykge1xuICAgICAgY2FzZSAkUEVSSU9EOlxuICAgICAgICB0aGlzLmFkdmFuY2UoKTtcbiAgICAgICAgcmV0dXJuIGlzRGlnaXQodGhpcy5wZWVrKSA/IHRoaXMuc2Nhbk51bWJlcihzdGFydCkgOiBuZXcgVG9rZW4oc3RhcnQsICcuJyk7XG4gICAgICBjYXNlICRMUEFSRU46XG4gICAgICBjYXNlICRSUEFSRU46XG4gICAgICBjYXNlICRMQlJBQ0U6XG4gICAgICBjYXNlICRSQlJBQ0U6XG4gICAgICBjYXNlICRMQlJBQ0tFVDpcbiAgICAgIGNhc2UgJFJCUkFDS0VUOlxuICAgICAgY2FzZSAkQ09NTUE6XG4gICAgICBjYXNlICRDT0xPTjpcbiAgICAgIGNhc2UgJFNFTUlDT0xPTjpcbiAgICAgICAgcmV0dXJuIHRoaXMuc2NhbkNoYXJhY3RlcihzdGFydCwgU3RyaW5nLmZyb21DaGFyQ29kZSh0aGlzLnBlZWspKTtcbiAgICAgIGNhc2UgJFNROlxuICAgICAgY2FzZSAkRFE6XG4gICAgICAgIHJldHVybiB0aGlzLnNjYW5TdHJpbmcoKTtcbiAgICAgIGNhc2UgJFBMVVM6XG4gICAgICBjYXNlICRNSU5VUzpcbiAgICAgIGNhc2UgJFNUQVI6XG4gICAgICBjYXNlICRTTEFTSDpcbiAgICAgIGNhc2UgJFBFUkNFTlQ6XG4gICAgICBjYXNlICRDQVJFVDpcbiAgICAgIGNhc2UgJFFVRVNUSU9OOlxuICAgICAgICByZXR1cm4gdGhpcy5zY2FuT3BlcmF0b3Ioc3RhcnQsIFN0cmluZy5mcm9tQ2hhckNvZGUodGhpcy5wZWVrKSk7XG4gICAgICBjYXNlICRMVDpcbiAgICAgIGNhc2UgJEdUOlxuICAgICAgY2FzZSAkQkFORzpcbiAgICAgIGNhc2UgJEVROlxuICAgICAgICByZXR1cm4gdGhpcy5zY2FuQ29tcGxleE9wZXJhdG9yKHN0YXJ0LCAkRVEsIFN0cmluZy5mcm9tQ2hhckNvZGUodGhpcy5wZWVrKSwgJz0nKTtcbiAgICAgIGNhc2UgJEFNUEVSU0FORDpcbiAgICAgICAgcmV0dXJuIHRoaXMuc2NhbkNvbXBsZXhPcGVyYXRvcihzdGFydCwgJEFNUEVSU0FORCwgJyYnLCAnJicpO1xuICAgICAgY2FzZSAkQkFSOlxuICAgICAgICByZXR1cm4gdGhpcy5zY2FuQ29tcGxleE9wZXJhdG9yKHN0YXJ0LCAkQkFSLCAnfCcsICd8Jyk7XG4gICAgICBjYXNlICROQlNQOlxuICAgICAgICB3aGlsZSAoaXNXaGl0ZXNwYWNlKHRoaXMucGVlaykpIHtcbiAgICAgICAgICB0aGlzLmFkdmFuY2UoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLnNjYW5Ub2tlbigpO1xuICAgIH1cblxuICAgIHZhciBjaGFyYWN0ZXIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHRoaXMucGVlayk7XG4gICAgdGhpcy5lcnJvcignVW5leHBlY3RlZCBjaGFyYWN0ZXIgWycgKyBjaGFyYWN0ZXIgKyAnXScpO1xuICAgIHJldHVybiBudWxsO1xuICB9O1xuXG4gIFNjYW5uZXIucHJvdG90eXBlLnNjYW5DaGFyYWN0ZXIgPSBmdW5jdGlvbiBzY2FuQ2hhcmFjdGVyKHN0YXJ0LCB0ZXh0KSB7XG4gICAgYXNzZXJ0KHRoaXMucGVlayA9PT0gdGV4dC5jaGFyQ29kZUF0KDApKTtcbiAgICB0aGlzLmFkdmFuY2UoKTtcbiAgICByZXR1cm4gbmV3IFRva2VuKHN0YXJ0LCB0ZXh0KTtcbiAgfTtcblxuICBTY2FubmVyLnByb3RvdHlwZS5zY2FuT3BlcmF0b3IgPSBmdW5jdGlvbiBzY2FuT3BlcmF0b3Ioc3RhcnQsIHRleHQpIHtcbiAgICBhc3NlcnQodGhpcy5wZWVrID09PSB0ZXh0LmNoYXJDb2RlQXQoMCkpO1xuICAgIGFzc2VydChPUEVSQVRPUlMuaW5kZXhPZih0ZXh0KSAhPT0gLTEpO1xuICAgIHRoaXMuYWR2YW5jZSgpO1xuICAgIHJldHVybiBuZXcgVG9rZW4oc3RhcnQsIHRleHQpLndpdGhPcCh0ZXh0KTtcbiAgfTtcblxuICBTY2FubmVyLnByb3RvdHlwZS5zY2FuQ29tcGxleE9wZXJhdG9yID0gZnVuY3Rpb24gc2NhbkNvbXBsZXhPcGVyYXRvcihzdGFydCwgY29kZSwgb25lLCB0d28pIHtcbiAgICBhc3NlcnQodGhpcy5wZWVrID09PSBvbmUuY2hhckNvZGVBdCgwKSk7XG4gICAgdGhpcy5hZHZhbmNlKCk7XG5cbiAgICB2YXIgdGV4dCA9IG9uZTtcblxuICAgIGlmICh0aGlzLnBlZWsgPT09IGNvZGUpIHtcbiAgICAgIHRoaXMuYWR2YW5jZSgpO1xuICAgICAgdGV4dCArPSB0d287XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucGVlayA9PT0gY29kZSkge1xuICAgICAgdGhpcy5hZHZhbmNlKCk7XG4gICAgICB0ZXh0ICs9IHR3bztcbiAgICB9XG5cbiAgICBhc3NlcnQoT1BFUkFUT1JTLmluZGV4T2YodGV4dCkgIT09IC0xKTtcblxuICAgIHJldHVybiBuZXcgVG9rZW4oc3RhcnQsIHRleHQpLndpdGhPcCh0ZXh0KTtcbiAgfTtcblxuICBTY2FubmVyLnByb3RvdHlwZS5zY2FuSWRlbnRpZmllciA9IGZ1bmN0aW9uIHNjYW5JZGVudGlmaWVyKCkge1xuICAgIGFzc2VydChpc0lkZW50aWZpZXJTdGFydCh0aGlzLnBlZWspKTtcbiAgICB2YXIgc3RhcnQgPSB0aGlzLmluZGV4O1xuXG4gICAgdGhpcy5hZHZhbmNlKCk7XG5cbiAgICB3aGlsZSAoaXNJZGVudGlmaWVyUGFydCh0aGlzLnBlZWspKSB7XG4gICAgICB0aGlzLmFkdmFuY2UoKTtcbiAgICB9XG5cbiAgICB2YXIgdGV4dCA9IHRoaXMuaW5wdXQuc3Vic3RyaW5nKHN0YXJ0LCB0aGlzLmluZGV4KTtcbiAgICB2YXIgcmVzdWx0ID0gbmV3IFRva2VuKHN0YXJ0LCB0ZXh0KTtcblxuICAgIGlmIChPUEVSQVRPUlMuaW5kZXhPZih0ZXh0KSAhPT0gLTEpIHtcbiAgICAgIHJlc3VsdC53aXRoT3AodGV4dCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc3VsdC53aXRoR2V0dGVyU2V0dGVyKHRleHQpO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgU2Nhbm5lci5wcm90b3R5cGUuc2Nhbk51bWJlciA9IGZ1bmN0aW9uIHNjYW5OdW1iZXIoc3RhcnQpIHtcbiAgICBhc3NlcnQoaXNEaWdpdCh0aGlzLnBlZWspKTtcbiAgICB2YXIgc2ltcGxlID0gdGhpcy5pbmRleCA9PT0gc3RhcnQ7XG4gICAgdGhpcy5hZHZhbmNlKCk7XG5cbiAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgaWYgKCFpc0RpZ2l0KHRoaXMucGVlaykpIHtcbiAgICAgICAgaWYgKHRoaXMucGVlayA9PT0gJFBFUklPRCkge1xuICAgICAgICAgIHNpbXBsZSA9IGZhbHNlO1xuICAgICAgICB9IGVsc2UgaWYgKGlzRXhwb25lbnRTdGFydCh0aGlzLnBlZWspKSB7XG4gICAgICAgICAgdGhpcy5hZHZhbmNlKCk7XG5cbiAgICAgICAgICBpZiAoaXNFeHBvbmVudFNpZ24odGhpcy5wZWVrKSkge1xuICAgICAgICAgICAgdGhpcy5hZHZhbmNlKCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKCFpc0RpZ2l0KHRoaXMucGVlaykpIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3IoJ0ludmFsaWQgZXhwb25lbnQnLCAtMSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgc2ltcGxlID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5hZHZhbmNlKCk7XG4gICAgfVxuXG4gICAgdmFyIHRleHQgPSB0aGlzLmlucHV0LnN1YnN0cmluZyhzdGFydCwgdGhpcy5pbmRleCk7XG4gICAgdmFyIHZhbHVlID0gc2ltcGxlID8gcGFyc2VJbnQodGV4dCwgMTApIDogcGFyc2VGbG9hdCh0ZXh0KTtcbiAgICByZXR1cm4gbmV3IFRva2VuKHN0YXJ0LCB0ZXh0KS53aXRoVmFsdWUodmFsdWUpO1xuICB9O1xuXG4gIFNjYW5uZXIucHJvdG90eXBlLnNjYW5TdHJpbmcgPSBmdW5jdGlvbiBzY2FuU3RyaW5nKCkge1xuICAgIGFzc2VydCh0aGlzLnBlZWsgPT09ICRTUSB8fCB0aGlzLnBlZWsgPT09ICREUSk7XG5cbiAgICB2YXIgc3RhcnQgPSB0aGlzLmluZGV4O1xuICAgIHZhciBxdW90ZSA9IHRoaXMucGVlaztcblxuICAgIHRoaXMuYWR2YW5jZSgpO1xuXG4gICAgdmFyIGJ1ZmZlciA9IHZvaWQgMDtcbiAgICB2YXIgbWFya2VyID0gdGhpcy5pbmRleDtcblxuICAgIHdoaWxlICh0aGlzLnBlZWsgIT09IHF1b3RlKSB7XG4gICAgICBpZiAodGhpcy5wZWVrID09PSAkQkFDS1NMQVNIKSB7XG4gICAgICAgIGlmICghYnVmZmVyKSB7XG4gICAgICAgICAgYnVmZmVyID0gW107XG4gICAgICAgIH1cblxuICAgICAgICBidWZmZXIucHVzaCh0aGlzLmlucHV0LnN1YnN0cmluZyhtYXJrZXIsIHRoaXMuaW5kZXgpKTtcbiAgICAgICAgdGhpcy5hZHZhbmNlKCk7XG5cbiAgICAgICAgdmFyIF91bmVzY2FwZWQgPSB2b2lkIDA7XG5cbiAgICAgICAgaWYgKHRoaXMucGVlayA9PT0gJHUpIHtcbiAgICAgICAgICB2YXIgaGV4ID0gdGhpcy5pbnB1dC5zdWJzdHJpbmcodGhpcy5pbmRleCArIDEsIHRoaXMuaW5kZXggKyA1KTtcblxuICAgICAgICAgIGlmICghL1tBLVowLTldezR9Ly50ZXN0KGhleCkpIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3IoJ0ludmFsaWQgdW5pY29kZSBlc2NhcGUgW1xcXFx1JyArIGhleCArICddJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgX3VuZXNjYXBlZCA9IHBhcnNlSW50KGhleCwgMTYpO1xuXG4gICAgICAgICAgZm9yICh2YXIgX2kyMSA9IDA7IF9pMjEgPCA1OyArK19pMjEpIHtcbiAgICAgICAgICAgIHRoaXMuYWR2YW5jZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBfdW5lc2NhcGVkID0gdW5lc2NhcGUodGhpcy5wZWVrKTtcbiAgICAgICAgICB0aGlzLmFkdmFuY2UoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGJ1ZmZlci5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoX3VuZXNjYXBlZCkpO1xuICAgICAgICBtYXJrZXIgPSB0aGlzLmluZGV4O1xuICAgICAgfSBlbHNlIGlmICh0aGlzLnBlZWsgPT09ICRFT0YpIHtcbiAgICAgICAgdGhpcy5lcnJvcignVW50ZXJtaW5hdGVkIHF1b3RlJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmFkdmFuY2UoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgbGFzdCA9IHRoaXMuaW5wdXQuc3Vic3RyaW5nKG1hcmtlciwgdGhpcy5pbmRleCk7XG4gICAgdGhpcy5hZHZhbmNlKCk7XG4gICAgdmFyIHRleHQgPSB0aGlzLmlucHV0LnN1YnN0cmluZyhzdGFydCwgdGhpcy5pbmRleCk7XG5cbiAgICB2YXIgdW5lc2NhcGVkID0gbGFzdDtcblxuICAgIGlmIChidWZmZXIgIT09IG51bGwgJiYgYnVmZmVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGJ1ZmZlci5wdXNoKGxhc3QpO1xuICAgICAgdW5lc2NhcGVkID0gYnVmZmVyLmpvaW4oJycpO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgVG9rZW4oc3RhcnQsIHRleHQpLndpdGhWYWx1ZSh1bmVzY2FwZWQpO1xuICB9O1xuXG4gIFNjYW5uZXIucHJvdG90eXBlLmFkdmFuY2UgPSBmdW5jdGlvbiBhZHZhbmNlKCkge1xuICAgIGlmICgrK3RoaXMuaW5kZXggPj0gdGhpcy5sZW5ndGgpIHtcbiAgICAgIHRoaXMucGVlayA9ICRFT0Y7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucGVlayA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLmluZGV4KTtcbiAgICB9XG4gIH07XG5cbiAgU2Nhbm5lci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiBlcnJvcihtZXNzYWdlKSB7XG4gICAgdmFyIG9mZnNldCA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMSB8fCBhcmd1bWVudHNbMV0gPT09IHVuZGVmaW5lZCA/IDAgOiBhcmd1bWVudHNbMV07XG5cbiAgICB2YXIgcG9zaXRpb24gPSB0aGlzLmluZGV4ICsgb2Zmc2V0O1xuICAgIHRocm93IG5ldyBFcnJvcignTGV4ZXIgRXJyb3I6ICcgKyBtZXNzYWdlICsgJyBhdCBjb2x1bW4gJyArIHBvc2l0aW9uICsgJyBpbiBleHByZXNzaW9uIFsnICsgdGhpcy5pbnB1dCArICddJyk7XG4gIH07XG5cbiAgcmV0dXJuIFNjYW5uZXI7XG59KCk7XG5cbnZhciBPUEVSQVRPUlMgPSBbJ3VuZGVmaW5lZCcsICdudWxsJywgJ3RydWUnLCAnZmFsc2UnLCAnKycsICctJywgJyonLCAnLycsICclJywgJ14nLCAnPScsICc9PScsICc9PT0nLCAnIT0nLCAnIT09JywgJzwnLCAnPicsICc8PScsICc+PScsICcmJicsICd8fCcsICcmJywgJ3wnLCAnIScsICc/J107XG5cbnZhciAkRU9GID0gMDtcbnZhciAkVEFCID0gOTtcbnZhciAkTEYgPSAxMDtcbnZhciAkVlRBQiA9IDExO1xudmFyICRGRiA9IDEyO1xudmFyICRDUiA9IDEzO1xudmFyICRTUEFDRSA9IDMyO1xudmFyICRCQU5HID0gMzM7XG52YXIgJERRID0gMzQ7XG52YXIgJCQgPSAzNjtcbnZhciAkUEVSQ0VOVCA9IDM3O1xudmFyICRBTVBFUlNBTkQgPSAzODtcbnZhciAkU1EgPSAzOTtcbnZhciAkTFBBUkVOID0gNDA7XG52YXIgJFJQQVJFTiA9IDQxO1xudmFyICRTVEFSID0gNDI7XG52YXIgJFBMVVMgPSA0MztcbnZhciAkQ09NTUEgPSA0NDtcbnZhciAkTUlOVVMgPSA0NTtcbnZhciAkUEVSSU9EID0gNDY7XG52YXIgJFNMQVNIID0gNDc7XG52YXIgJENPTE9OID0gNTg7XG52YXIgJFNFTUlDT0xPTiA9IDU5O1xudmFyICRMVCA9IDYwO1xudmFyICRFUSA9IDYxO1xudmFyICRHVCA9IDYyO1xudmFyICRRVUVTVElPTiA9IDYzO1xuXG52YXIgJDAgPSA0ODtcbnZhciAkOSA9IDU3O1xuXG52YXIgJEEgPSA2NTtcbnZhciAkRSA9IDY5O1xudmFyICRaID0gOTA7XG5cbnZhciAkTEJSQUNLRVQgPSA5MTtcbnZhciAkQkFDS1NMQVNIID0gOTI7XG52YXIgJFJCUkFDS0VUID0gOTM7XG52YXIgJENBUkVUID0gOTQ7XG52YXIgJF8gPSA5NTtcblxudmFyICRhID0gOTc7XG52YXIgJGUgPSAxMDE7XG52YXIgJGYgPSAxMDI7XG52YXIgJG4gPSAxMTA7XG52YXIgJHIgPSAxMTQ7XG52YXIgJHQgPSAxMTY7XG52YXIgJHUgPSAxMTc7XG52YXIgJHYgPSAxMTg7XG52YXIgJHogPSAxMjI7XG5cbnZhciAkTEJSQUNFID0gMTIzO1xudmFyICRCQVIgPSAxMjQ7XG52YXIgJFJCUkFDRSA9IDEyNTtcbnZhciAkTkJTUCA9IDE2MDtcblxuZnVuY3Rpb24gaXNXaGl0ZXNwYWNlKGNvZGUpIHtcbiAgcmV0dXJuIGNvZGUgPj0gJFRBQiAmJiBjb2RlIDw9ICRTUEFDRSB8fCBjb2RlID09PSAkTkJTUDtcbn1cblxuZnVuY3Rpb24gaXNJZGVudGlmaWVyU3RhcnQoY29kZSkge1xuICByZXR1cm4gJGEgPD0gY29kZSAmJiBjb2RlIDw9ICR6IHx8ICRBIDw9IGNvZGUgJiYgY29kZSA8PSAkWiB8fCBjb2RlID09PSAkXyB8fCBjb2RlID09PSAkJDtcbn1cblxuZnVuY3Rpb24gaXNJZGVudGlmaWVyUGFydChjb2RlKSB7XG4gIHJldHVybiAkYSA8PSBjb2RlICYmIGNvZGUgPD0gJHogfHwgJEEgPD0gY29kZSAmJiBjb2RlIDw9ICRaIHx8ICQwIDw9IGNvZGUgJiYgY29kZSA8PSAkOSB8fCBjb2RlID09PSAkXyB8fCBjb2RlID09PSAkJDtcbn1cblxuZnVuY3Rpb24gaXNEaWdpdChjb2RlKSB7XG4gIHJldHVybiAkMCA8PSBjb2RlICYmIGNvZGUgPD0gJDk7XG59XG5cbmZ1bmN0aW9uIGlzRXhwb25lbnRTdGFydChjb2RlKSB7XG4gIHJldHVybiBjb2RlID09PSAkZSB8fCBjb2RlID09PSAkRTtcbn1cblxuZnVuY3Rpb24gaXNFeHBvbmVudFNpZ24oY29kZSkge1xuICByZXR1cm4gY29kZSA9PT0gJE1JTlVTIHx8IGNvZGUgPT09ICRQTFVTO1xufVxuXG5mdW5jdGlvbiB1bmVzY2FwZShjb2RlKSB7XG4gIHN3aXRjaCAoY29kZSkge1xuICAgIGNhc2UgJG46XG4gICAgICByZXR1cm4gJExGO1xuICAgIGNhc2UgJGY6XG4gICAgICByZXR1cm4gJEZGO1xuICAgIGNhc2UgJHI6XG4gICAgICByZXR1cm4gJENSO1xuICAgIGNhc2UgJHQ6XG4gICAgICByZXR1cm4gJFRBQjtcbiAgICBjYXNlICR2OlxuICAgICAgcmV0dXJuICRWVEFCO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gY29kZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhc3NlcnQoY29uZGl0aW9uLCBtZXNzYWdlKSB7XG4gIGlmICghY29uZGl0aW9uKSB7XG4gICAgdGhyb3cgbWVzc2FnZSB8fCAnQXNzZXJ0aW9uIGZhaWxlZCc7XG4gIH1cbn1cblxudmFyIEVPRiA9IG5ldyBUb2tlbigtMSwgbnVsbCk7XG5cbnZhciBQYXJzZXIgPSBleHBvcnRzLlBhcnNlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gUGFyc2VyKCkge1xuICAgIFxuXG4gICAgdGhpcy5jYWNoZSA9IHt9O1xuICAgIHRoaXMubGV4ZXIgPSBuZXcgTGV4ZXIoKTtcbiAgfVxuXG4gIFBhcnNlci5wcm90b3R5cGUucGFyc2UgPSBmdW5jdGlvbiBwYXJzZShpbnB1dCkge1xuICAgIGlucHV0ID0gaW5wdXQgfHwgJyc7XG5cbiAgICByZXR1cm4gdGhpcy5jYWNoZVtpbnB1dF0gfHwgKHRoaXMuY2FjaGVbaW5wdXRdID0gbmV3IFBhcnNlckltcGxlbWVudGF0aW9uKHRoaXMubGV4ZXIsIGlucHV0KS5wYXJzZUNoYWluKCkpO1xuICB9O1xuXG4gIHJldHVybiBQYXJzZXI7XG59KCk7XG5cbnZhciBQYXJzZXJJbXBsZW1lbnRhdGlvbiA9IGV4cG9ydHMuUGFyc2VySW1wbGVtZW50YXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFBhcnNlckltcGxlbWVudGF0aW9uKGxleGVyLCBpbnB1dCkge1xuICAgIFxuXG4gICAgdGhpcy5pbmRleCA9IDA7XG4gICAgdGhpcy5pbnB1dCA9IGlucHV0O1xuICAgIHRoaXMudG9rZW5zID0gbGV4ZXIubGV4KGlucHV0KTtcbiAgfVxuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5wYXJzZUNoYWluID0gZnVuY3Rpb24gcGFyc2VDaGFpbigpIHtcbiAgICB2YXIgaXNDaGFpbiA9IGZhbHNlO1xuICAgIHZhciBleHByZXNzaW9ucyA9IFtdO1xuXG4gICAgd2hpbGUgKHRoaXMub3B0aW9uYWwoJzsnKSkge1xuICAgICAgaXNDaGFpbiA9IHRydWU7XG4gICAgfVxuXG4gICAgd2hpbGUgKHRoaXMuaW5kZXggPCB0aGlzLnRva2Vucy5sZW5ndGgpIHtcbiAgICAgIGlmICh0aGlzLnBlZWsudGV4dCA9PT0gJyknIHx8IHRoaXMucGVlay50ZXh0ID09PSAnfScgfHwgdGhpcy5wZWVrLnRleHQgPT09ICddJykge1xuICAgICAgICB0aGlzLmVycm9yKCdVbmNvbnN1bWVkIHRva2VuICcgKyB0aGlzLnBlZWsudGV4dCk7XG4gICAgICB9XG5cbiAgICAgIHZhciBleHByID0gdGhpcy5wYXJzZUJpbmRpbmdCZWhhdmlvcigpO1xuICAgICAgZXhwcmVzc2lvbnMucHVzaChleHByKTtcblxuICAgICAgd2hpbGUgKHRoaXMub3B0aW9uYWwoJzsnKSkge1xuICAgICAgICBpc0NoYWluID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKGlzQ2hhaW4pIHtcbiAgICAgICAgdGhpcy5lcnJvcignTXVsdGlwbGUgZXhwcmVzc2lvbnMgYXJlIG5vdCBhbGxvd2VkLicpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBleHByZXNzaW9ucy5sZW5ndGggPT09IDEgPyBleHByZXNzaW9uc1swXSA6IG5ldyBDaGFpbihleHByZXNzaW9ucyk7XG4gIH07XG5cbiAgUGFyc2VySW1wbGVtZW50YXRpb24ucHJvdG90eXBlLnBhcnNlQmluZGluZ0JlaGF2aW9yID0gZnVuY3Rpb24gcGFyc2VCaW5kaW5nQmVoYXZpb3IoKSB7XG4gICAgdmFyIHJlc3VsdCA9IHRoaXMucGFyc2VWYWx1ZUNvbnZlcnRlcigpO1xuXG4gICAgd2hpbGUgKHRoaXMub3B0aW9uYWwoJyYnKSkge1xuICAgICAgdmFyIG5hbWUgPSB0aGlzLnBlZWsudGV4dDtcbiAgICAgIHZhciBhcmdzID0gW107XG5cbiAgICAgIHRoaXMuYWR2YW5jZSgpO1xuXG4gICAgICB3aGlsZSAodGhpcy5vcHRpb25hbCgnOicpKSB7XG4gICAgICAgIGFyZ3MucHVzaCh0aGlzLnBhcnNlRXhwcmVzc2lvbigpKTtcbiAgICAgIH1cblxuICAgICAgcmVzdWx0ID0gbmV3IEJpbmRpbmdCZWhhdmlvcihyZXN1bHQsIG5hbWUsIGFyZ3MpO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgUGFyc2VySW1wbGVtZW50YXRpb24ucHJvdG90eXBlLnBhcnNlVmFsdWVDb252ZXJ0ZXIgPSBmdW5jdGlvbiBwYXJzZVZhbHVlQ29udmVydGVyKCkge1xuICAgIHZhciByZXN1bHQgPSB0aGlzLnBhcnNlRXhwcmVzc2lvbigpO1xuXG4gICAgd2hpbGUgKHRoaXMub3B0aW9uYWwoJ3wnKSkge1xuICAgICAgdmFyIG5hbWUgPSB0aGlzLnBlZWsudGV4dDtcbiAgICAgIHZhciBhcmdzID0gW107XG5cbiAgICAgIHRoaXMuYWR2YW5jZSgpO1xuXG4gICAgICB3aGlsZSAodGhpcy5vcHRpb25hbCgnOicpKSB7XG4gICAgICAgIGFyZ3MucHVzaCh0aGlzLnBhcnNlRXhwcmVzc2lvbigpKTtcbiAgICAgIH1cblxuICAgICAgcmVzdWx0ID0gbmV3IFZhbHVlQ29udmVydGVyKHJlc3VsdCwgbmFtZSwgYXJncywgW3Jlc3VsdF0uY29uY2F0KGFyZ3MpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5wYXJzZUV4cHJlc3Npb24gPSBmdW5jdGlvbiBwYXJzZUV4cHJlc3Npb24oKSB7XG4gICAgdmFyIHN0YXJ0ID0gdGhpcy5wZWVrLmluZGV4O1xuICAgIHZhciByZXN1bHQgPSB0aGlzLnBhcnNlQ29uZGl0aW9uYWwoKTtcblxuICAgIHdoaWxlICh0aGlzLnBlZWsudGV4dCA9PT0gJz0nKSB7XG4gICAgICBpZiAoIXJlc3VsdC5pc0Fzc2lnbmFibGUpIHtcbiAgICAgICAgdmFyIGVuZCA9IHRoaXMuaW5kZXggPCB0aGlzLnRva2Vucy5sZW5ndGggPyB0aGlzLnBlZWsuaW5kZXggOiB0aGlzLmlucHV0Lmxlbmd0aDtcbiAgICAgICAgdmFyIF9leHByZXNzaW9uID0gdGhpcy5pbnB1dC5zdWJzdHJpbmcoc3RhcnQsIGVuZCk7XG5cbiAgICAgICAgdGhpcy5lcnJvcignRXhwcmVzc2lvbiAnICsgX2V4cHJlc3Npb24gKyAnIGlzIG5vdCBhc3NpZ25hYmxlJyk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuZXhwZWN0KCc9Jyk7XG4gICAgICByZXN1bHQgPSBuZXcgQXNzaWduKHJlc3VsdCwgdGhpcy5wYXJzZUNvbmRpdGlvbmFsKCkpO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgUGFyc2VySW1wbGVtZW50YXRpb24ucHJvdG90eXBlLnBhcnNlQ29uZGl0aW9uYWwgPSBmdW5jdGlvbiBwYXJzZUNvbmRpdGlvbmFsKCkge1xuICAgIHZhciBzdGFydCA9IHRoaXMucGVlay5pbmRleDtcbiAgICB2YXIgcmVzdWx0ID0gdGhpcy5wYXJzZUxvZ2ljYWxPcigpO1xuXG4gICAgaWYgKHRoaXMub3B0aW9uYWwoJz8nKSkge1xuICAgICAgdmFyIHllcyA9IHRoaXMucGFyc2VFeHByZXNzaW9uKCk7XG5cbiAgICAgIGlmICghdGhpcy5vcHRpb25hbCgnOicpKSB7XG4gICAgICAgIHZhciBlbmQgPSB0aGlzLmluZGV4IDwgdGhpcy50b2tlbnMubGVuZ3RoID8gdGhpcy5wZWVrLmluZGV4IDogdGhpcy5pbnB1dC5sZW5ndGg7XG4gICAgICAgIHZhciBfZXhwcmVzc2lvbjIgPSB0aGlzLmlucHV0LnN1YnN0cmluZyhzdGFydCwgZW5kKTtcblxuICAgICAgICB0aGlzLmVycm9yKCdDb25kaXRpb25hbCBleHByZXNzaW9uICcgKyBfZXhwcmVzc2lvbjIgKyAnIHJlcXVpcmVzIGFsbCAzIGV4cHJlc3Npb25zJyk7XG4gICAgICB9XG5cbiAgICAgIHZhciBubyA9IHRoaXMucGFyc2VFeHByZXNzaW9uKCk7XG4gICAgICByZXN1bHQgPSBuZXcgQ29uZGl0aW9uYWwocmVzdWx0LCB5ZXMsIG5vKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5wYXJzZUxvZ2ljYWxPciA9IGZ1bmN0aW9uIHBhcnNlTG9naWNhbE9yKCkge1xuICAgIHZhciByZXN1bHQgPSB0aGlzLnBhcnNlTG9naWNhbEFuZCgpO1xuXG4gICAgd2hpbGUgKHRoaXMub3B0aW9uYWwoJ3x8JykpIHtcbiAgICAgIHJlc3VsdCA9IG5ldyBCaW5hcnkoJ3x8JywgcmVzdWx0LCB0aGlzLnBhcnNlTG9naWNhbEFuZCgpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5wYXJzZUxvZ2ljYWxBbmQgPSBmdW5jdGlvbiBwYXJzZUxvZ2ljYWxBbmQoKSB7XG4gICAgdmFyIHJlc3VsdCA9IHRoaXMucGFyc2VFcXVhbGl0eSgpO1xuXG4gICAgd2hpbGUgKHRoaXMub3B0aW9uYWwoJyYmJykpIHtcbiAgICAgIHJlc3VsdCA9IG5ldyBCaW5hcnkoJyYmJywgcmVzdWx0LCB0aGlzLnBhcnNlRXF1YWxpdHkoKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBQYXJzZXJJbXBsZW1lbnRhdGlvbi5wcm90b3R5cGUucGFyc2VFcXVhbGl0eSA9IGZ1bmN0aW9uIHBhcnNlRXF1YWxpdHkoKSB7XG4gICAgdmFyIHJlc3VsdCA9IHRoaXMucGFyc2VSZWxhdGlvbmFsKCk7XG5cbiAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgaWYgKHRoaXMub3B0aW9uYWwoJz09JykpIHtcbiAgICAgICAgcmVzdWx0ID0gbmV3IEJpbmFyeSgnPT0nLCByZXN1bHQsIHRoaXMucGFyc2VSZWxhdGlvbmFsKCkpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbmFsKCchPScpKSB7XG4gICAgICAgIHJlc3VsdCA9IG5ldyBCaW5hcnkoJyE9JywgcmVzdWx0LCB0aGlzLnBhcnNlUmVsYXRpb25hbCgpKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5vcHRpb25hbCgnPT09JykpIHtcbiAgICAgICAgcmVzdWx0ID0gbmV3IEJpbmFyeSgnPT09JywgcmVzdWx0LCB0aGlzLnBhcnNlUmVsYXRpb25hbCgpKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5vcHRpb25hbCgnIT09JykpIHtcbiAgICAgICAgcmVzdWx0ID0gbmV3IEJpbmFyeSgnIT09JywgcmVzdWx0LCB0aGlzLnBhcnNlUmVsYXRpb25hbCgpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5wYXJzZVJlbGF0aW9uYWwgPSBmdW5jdGlvbiBwYXJzZVJlbGF0aW9uYWwoKSB7XG4gICAgdmFyIHJlc3VsdCA9IHRoaXMucGFyc2VBZGRpdGl2ZSgpO1xuXG4gICAgd2hpbGUgKHRydWUpIHtcbiAgICAgIGlmICh0aGlzLm9wdGlvbmFsKCc8JykpIHtcbiAgICAgICAgcmVzdWx0ID0gbmV3IEJpbmFyeSgnPCcsIHJlc3VsdCwgdGhpcy5wYXJzZUFkZGl0aXZlKCkpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbmFsKCc+JykpIHtcbiAgICAgICAgcmVzdWx0ID0gbmV3IEJpbmFyeSgnPicsIHJlc3VsdCwgdGhpcy5wYXJzZUFkZGl0aXZlKCkpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbmFsKCc8PScpKSB7XG4gICAgICAgIHJlc3VsdCA9IG5ldyBCaW5hcnkoJzw9JywgcmVzdWx0LCB0aGlzLnBhcnNlQWRkaXRpdmUoKSk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9uYWwoJz49JykpIHtcbiAgICAgICAgcmVzdWx0ID0gbmV3IEJpbmFyeSgnPj0nLCByZXN1bHQsIHRoaXMucGFyc2VBZGRpdGl2ZSgpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5wYXJzZUFkZGl0aXZlID0gZnVuY3Rpb24gcGFyc2VBZGRpdGl2ZSgpIHtcbiAgICB2YXIgcmVzdWx0ID0gdGhpcy5wYXJzZU11bHRpcGxpY2F0aXZlKCk7XG5cbiAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgaWYgKHRoaXMub3B0aW9uYWwoJysnKSkge1xuICAgICAgICByZXN1bHQgPSBuZXcgQmluYXJ5KCcrJywgcmVzdWx0LCB0aGlzLnBhcnNlTXVsdGlwbGljYXRpdmUoKSk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9uYWwoJy0nKSkge1xuICAgICAgICByZXN1bHQgPSBuZXcgQmluYXJ5KCctJywgcmVzdWx0LCB0aGlzLnBhcnNlTXVsdGlwbGljYXRpdmUoKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBQYXJzZXJJbXBsZW1lbnRhdGlvbi5wcm90b3R5cGUucGFyc2VNdWx0aXBsaWNhdGl2ZSA9IGZ1bmN0aW9uIHBhcnNlTXVsdGlwbGljYXRpdmUoKSB7XG4gICAgdmFyIHJlc3VsdCA9IHRoaXMucGFyc2VQcmVmaXgoKTtcblxuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICBpZiAodGhpcy5vcHRpb25hbCgnKicpKSB7XG4gICAgICAgIHJlc3VsdCA9IG5ldyBCaW5hcnkoJyonLCByZXN1bHQsIHRoaXMucGFyc2VQcmVmaXgoKSk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9uYWwoJyUnKSkge1xuICAgICAgICByZXN1bHQgPSBuZXcgQmluYXJ5KCclJywgcmVzdWx0LCB0aGlzLnBhcnNlUHJlZml4KCkpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbmFsKCcvJykpIHtcbiAgICAgICAgcmVzdWx0ID0gbmV3IEJpbmFyeSgnLycsIHJlc3VsdCwgdGhpcy5wYXJzZVByZWZpeCgpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5wYXJzZVByZWZpeCA9IGZ1bmN0aW9uIHBhcnNlUHJlZml4KCkge1xuICAgIGlmICh0aGlzLm9wdGlvbmFsKCcrJykpIHtcbiAgICAgIHJldHVybiB0aGlzLnBhcnNlUHJlZml4KCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbmFsKCctJykpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCaW5hcnkoJy0nLCBuZXcgTGl0ZXJhbFByaW1pdGl2ZSgwKSwgdGhpcy5wYXJzZVByZWZpeCgpKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5vcHRpb25hbCgnIScpKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJlZml4Tm90KCchJywgdGhpcy5wYXJzZVByZWZpeCgpKTtcbiAgICAgIH1cblxuICAgIHJldHVybiB0aGlzLnBhcnNlQWNjZXNzT3JDYWxsTWVtYmVyKCk7XG4gIH07XG5cbiAgUGFyc2VySW1wbGVtZW50YXRpb24ucHJvdG90eXBlLnBhcnNlQWNjZXNzT3JDYWxsTWVtYmVyID0gZnVuY3Rpb24gcGFyc2VBY2Nlc3NPckNhbGxNZW1iZXIoKSB7XG4gICAgdmFyIHJlc3VsdCA9IHRoaXMucGFyc2VQcmltYXJ5KCk7XG5cbiAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgaWYgKHRoaXMub3B0aW9uYWwoJy4nKSkge1xuICAgICAgICB2YXIgbmFtZSA9IHRoaXMucGVlay50ZXh0O1xuXG4gICAgICAgIHRoaXMuYWR2YW5jZSgpO1xuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbmFsKCcoJykpIHtcbiAgICAgICAgICB2YXIgYXJncyA9IHRoaXMucGFyc2VFeHByZXNzaW9uTGlzdCgnKScpO1xuICAgICAgICAgIHRoaXMuZXhwZWN0KCcpJyk7XG4gICAgICAgICAgaWYgKHJlc3VsdCBpbnN0YW5jZW9mIEFjY2Vzc1RoaXMpIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IG5ldyBDYWxsU2NvcGUobmFtZSwgYXJncywgcmVzdWx0LmFuY2VzdG9yKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0ID0gbmV3IENhbGxNZW1iZXIocmVzdWx0LCBuYW1lLCBhcmdzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKHJlc3VsdCBpbnN0YW5jZW9mIEFjY2Vzc1RoaXMpIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IG5ldyBBY2Nlc3NTY29wZShuYW1lLCByZXN1bHQuYW5jZXN0b3IpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQgPSBuZXcgQWNjZXNzTWVtYmVyKHJlc3VsdCwgbmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9uYWwoJ1snKSkge1xuICAgICAgICB2YXIga2V5ID0gdGhpcy5wYXJzZUV4cHJlc3Npb24oKTtcbiAgICAgICAgdGhpcy5leHBlY3QoJ10nKTtcbiAgICAgICAgcmVzdWx0ID0gbmV3IEFjY2Vzc0tleWVkKHJlc3VsdCwga2V5KTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5vcHRpb25hbCgnKCcpKSB7XG4gICAgICAgIHZhciBfYXJncyA9IHRoaXMucGFyc2VFeHByZXNzaW9uTGlzdCgnKScpO1xuICAgICAgICB0aGlzLmV4cGVjdCgnKScpO1xuICAgICAgICByZXN1bHQgPSBuZXcgQ2FsbEZ1bmN0aW9uKHJlc3VsdCwgX2FyZ3MpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgUGFyc2VySW1wbGVtZW50YXRpb24ucHJvdG90eXBlLnBhcnNlUHJpbWFyeSA9IGZ1bmN0aW9uIHBhcnNlUHJpbWFyeSgpIHtcbiAgICBpZiAodGhpcy5vcHRpb25hbCgnKCcpKSB7XG4gICAgICB2YXIgcmVzdWx0ID0gdGhpcy5wYXJzZUV4cHJlc3Npb24oKTtcbiAgICAgIHRoaXMuZXhwZWN0KCcpJyk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gZWxzZSBpZiAodGhpcy5vcHRpb25hbCgnbnVsbCcpKSB7XG4gICAgICByZXR1cm4gbmV3IExpdGVyYWxQcmltaXRpdmUobnVsbCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbmFsKCd1bmRlZmluZWQnKSkge1xuICAgICAgcmV0dXJuIG5ldyBMaXRlcmFsUHJpbWl0aXZlKHVuZGVmaW5lZCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbmFsKCd0cnVlJykpIHtcbiAgICAgIHJldHVybiBuZXcgTGl0ZXJhbFByaW1pdGl2ZSh0cnVlKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9uYWwoJ2ZhbHNlJykpIHtcbiAgICAgIHJldHVybiBuZXcgTGl0ZXJhbFByaW1pdGl2ZShmYWxzZSk7XG4gICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbmFsKCdbJykpIHtcbiAgICAgIHZhciBlbGVtZW50cyA9IHRoaXMucGFyc2VFeHByZXNzaW9uTGlzdCgnXScpO1xuICAgICAgdGhpcy5leHBlY3QoJ10nKTtcbiAgICAgIHJldHVybiBuZXcgTGl0ZXJhbEFycmF5KGVsZW1lbnRzKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMucGVlay50ZXh0ID09PSAneycpIHtcbiAgICAgIHJldHVybiB0aGlzLnBhcnNlT2JqZWN0KCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLnBlZWsua2V5ICE9PSBudWxsICYmIHRoaXMucGVlay5rZXkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIHRoaXMucGFyc2VBY2Nlc3NPckNhbGxTY29wZSgpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5wZWVrLnZhbHVlICE9PSBudWxsICYmIHRoaXMucGVlay52YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB2YXIgdmFsdWUgPSB0aGlzLnBlZWsudmFsdWU7XG4gICAgICB0aGlzLmFkdmFuY2UoKTtcbiAgICAgIHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFN0cmluZyB8fCB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnID8gbmV3IExpdGVyYWxTdHJpbmcodmFsdWUpIDogbmV3IExpdGVyYWxQcmltaXRpdmUodmFsdWUpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5pbmRleCA+PSB0aGlzLnRva2Vucy5sZW5ndGgpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVW5leHBlY3RlZCBlbmQgb2YgZXhwcmVzc2lvbjogJyArIHRoaXMuaW5wdXQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmVycm9yKCdVbmV4cGVjdGVkIHRva2VuICcgKyB0aGlzLnBlZWsudGV4dCk7XG4gICAgfVxuICB9O1xuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5wYXJzZUFjY2Vzc09yQ2FsbFNjb3BlID0gZnVuY3Rpb24gcGFyc2VBY2Nlc3NPckNhbGxTY29wZSgpIHtcbiAgICB2YXIgbmFtZSA9IHRoaXMucGVlay5rZXk7XG5cbiAgICB0aGlzLmFkdmFuY2UoKTtcblxuICAgIGlmIChuYW1lID09PSAnJHRoaXMnKSB7XG4gICAgICByZXR1cm4gbmV3IEFjY2Vzc1RoaXMoMCk7XG4gICAgfVxuXG4gICAgdmFyIGFuY2VzdG9yID0gMDtcbiAgICB3aGlsZSAobmFtZSA9PT0gJyRwYXJlbnQnKSB7XG4gICAgICBhbmNlc3RvcisrO1xuICAgICAgaWYgKHRoaXMub3B0aW9uYWwoJy4nKSkge1xuICAgICAgICBuYW1lID0gdGhpcy5wZWVrLmtleTtcbiAgICAgICAgdGhpcy5hZHZhbmNlKCk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMucGVlayA9PT0gRU9GIHx8IHRoaXMucGVlay50ZXh0ID09PSAnKCcgfHwgdGhpcy5wZWVrLnRleHQgPT09ICdbJyB8fCB0aGlzLnBlZWsudGV4dCA9PT0gJ30nKSB7XG4gICAgICAgIHJldHVybiBuZXcgQWNjZXNzVGhpcyhhbmNlc3Rvcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmVycm9yKCdVbmV4cGVjdGVkIHRva2VuICcgKyB0aGlzLnBlZWsudGV4dCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMub3B0aW9uYWwoJygnKSkge1xuICAgICAgdmFyIGFyZ3MgPSB0aGlzLnBhcnNlRXhwcmVzc2lvbkxpc3QoJyknKTtcbiAgICAgIHRoaXMuZXhwZWN0KCcpJyk7XG4gICAgICByZXR1cm4gbmV3IENhbGxTY29wZShuYW1lLCBhcmdzLCBhbmNlc3Rvcik7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBBY2Nlc3NTY29wZShuYW1lLCBhbmNlc3Rvcik7XG4gIH07XG5cbiAgUGFyc2VySW1wbGVtZW50YXRpb24ucHJvdG90eXBlLnBhcnNlT2JqZWN0ID0gZnVuY3Rpb24gcGFyc2VPYmplY3QoKSB7XG4gICAgdmFyIGtleXMgPSBbXTtcbiAgICB2YXIgdmFsdWVzID0gW107XG5cbiAgICB0aGlzLmV4cGVjdCgneycpO1xuXG4gICAgaWYgKHRoaXMucGVlay50ZXh0ICE9PSAnfScpIHtcbiAgICAgIGRvIHtcbiAgICAgICAgdmFyIHBlZWsgPSB0aGlzLnBlZWs7XG4gICAgICAgIHZhciB2YWx1ZSA9IHBlZWsudmFsdWU7XG4gICAgICAgIGtleXMucHVzaCh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnID8gdmFsdWUgOiBwZWVrLnRleHQpO1xuXG4gICAgICAgIHRoaXMuYWR2YW5jZSgpO1xuICAgICAgICBpZiAocGVlay5rZXkgJiYgKHRoaXMucGVlay50ZXh0ID09PSAnLCcgfHwgdGhpcy5wZWVrLnRleHQgPT09ICd9JykpIHtcbiAgICAgICAgICAtLXRoaXMuaW5kZXg7XG4gICAgICAgICAgdmFsdWVzLnB1c2godGhpcy5wYXJzZUFjY2Vzc09yQ2FsbFNjb3BlKCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuZXhwZWN0KCc6Jyk7XG4gICAgICAgICAgdmFsdWVzLnB1c2godGhpcy5wYXJzZUV4cHJlc3Npb24oKSk7XG4gICAgICAgIH1cbiAgICAgIH0gd2hpbGUgKHRoaXMub3B0aW9uYWwoJywnKSk7XG4gICAgfVxuXG4gICAgdGhpcy5leHBlY3QoJ30nKTtcblxuICAgIHJldHVybiBuZXcgTGl0ZXJhbE9iamVjdChrZXlzLCB2YWx1ZXMpO1xuICB9O1xuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5wYXJzZUV4cHJlc3Npb25MaXN0ID0gZnVuY3Rpb24gcGFyc2VFeHByZXNzaW9uTGlzdCh0ZXJtaW5hdG9yKSB7XG4gICAgdmFyIHJlc3VsdCA9IFtdO1xuXG4gICAgaWYgKHRoaXMucGVlay50ZXh0ICE9PSB0ZXJtaW5hdG9yKSB7XG4gICAgICBkbyB7XG4gICAgICAgIHJlc3VsdC5wdXNoKHRoaXMucGFyc2VFeHByZXNzaW9uKCkpO1xuICAgICAgfSB3aGlsZSAodGhpcy5vcHRpb25hbCgnLCcpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5vcHRpb25hbCA9IGZ1bmN0aW9uIG9wdGlvbmFsKHRleHQpIHtcbiAgICBpZiAodGhpcy5wZWVrLnRleHQgPT09IHRleHQpIHtcbiAgICAgIHRoaXMuYWR2YW5jZSgpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5leHBlY3QgPSBmdW5jdGlvbiBleHBlY3QodGV4dCkge1xuICAgIGlmICh0aGlzLnBlZWsudGV4dCA9PT0gdGV4dCkge1xuICAgICAgdGhpcy5hZHZhbmNlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZXJyb3IoJ01pc3NpbmcgZXhwZWN0ZWQgJyArIHRleHQpO1xuICAgIH1cbiAgfTtcblxuICBQYXJzZXJJbXBsZW1lbnRhdGlvbi5wcm90b3R5cGUuYWR2YW5jZSA9IGZ1bmN0aW9uIGFkdmFuY2UoKSB7XG4gICAgdGhpcy5pbmRleCsrO1xuICB9O1xuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIGVycm9yKG1lc3NhZ2UpIHtcbiAgICB2YXIgbG9jYXRpb24gPSB0aGlzLmluZGV4IDwgdGhpcy50b2tlbnMubGVuZ3RoID8gJ2F0IGNvbHVtbiAnICsgKHRoaXMudG9rZW5zW3RoaXMuaW5kZXhdLmluZGV4ICsgMSkgKyAnIGluJyA6ICdhdCB0aGUgZW5kIG9mIHRoZSBleHByZXNzaW9uJztcblxuICAgIHRocm93IG5ldyBFcnJvcignUGFyc2VyIEVycm9yOiAnICsgbWVzc2FnZSArICcgJyArIGxvY2F0aW9uICsgJyBbJyArIHRoaXMuaW5wdXQgKyAnXScpO1xuICB9O1xuXG4gIF9jcmVhdGVDbGFzcyhQYXJzZXJJbXBsZW1lbnRhdGlvbiwgW3tcbiAgICBrZXk6ICdwZWVrJyxcbiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgIHJldHVybiB0aGlzLmluZGV4IDwgdGhpcy50b2tlbnMubGVuZ3RoID8gdGhpcy50b2tlbnNbdGhpcy5pbmRleF0gOiBFT0Y7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIFBhcnNlckltcGxlbWVudGF0aW9uO1xufSgpO1xuXG52YXIgbWFwUHJvdG8gPSBNYXAucHJvdG90eXBlO1xuXG5mdW5jdGlvbiBfZ2V0TWFwT2JzZXJ2ZXIodGFza1F1ZXVlLCBtYXApIHtcbiAgcmV0dXJuIE1vZGlmeU1hcE9ic2VydmVyLmZvcih0YXNrUXVldWUsIG1hcCk7XG59XG5cbmV4cG9ydHMuZ2V0TWFwT2JzZXJ2ZXIgPSBfZ2V0TWFwT2JzZXJ2ZXI7XG5cbnZhciBNb2RpZnlNYXBPYnNlcnZlciA9IGZ1bmN0aW9uIChfTW9kaWZ5Q29sbGVjdGlvbk9ic2UyKSB7XG4gIF9pbmhlcml0cyhNb2RpZnlNYXBPYnNlcnZlciwgX01vZGlmeUNvbGxlY3Rpb25PYnNlMik7XG5cbiAgZnVuY3Rpb24gTW9kaWZ5TWFwT2JzZXJ2ZXIodGFza1F1ZXVlLCBtYXApIHtcbiAgICBcblxuICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfTW9kaWZ5Q29sbGVjdGlvbk9ic2UyLmNhbGwodGhpcywgdGFza1F1ZXVlLCBtYXApKTtcbiAgfVxuXG4gIE1vZGlmeU1hcE9ic2VydmVyLmZvciA9IGZ1bmN0aW9uIF9mb3IodGFza1F1ZXVlLCBtYXApIHtcbiAgICBpZiAoISgnX19tYXBfb2JzZXJ2ZXJfXycgaW4gbWFwKSkge1xuICAgICAgdmFyIG9ic2VydmVyID0gTW9kaWZ5TWFwT2JzZXJ2ZXIuY3JlYXRlKHRhc2tRdWV1ZSwgbWFwKTtcbiAgICAgIFJlZmxlY3QuZGVmaW5lUHJvcGVydHkobWFwLCAnX19tYXBfb2JzZXJ2ZXJfXycsIHsgdmFsdWU6IG9ic2VydmVyLCBlbnVtZXJhYmxlOiBmYWxzZSwgY29uZmlndXJhYmxlOiBmYWxzZSB9KTtcbiAgICB9XG4gICAgcmV0dXJuIG1hcC5fX21hcF9vYnNlcnZlcl9fO1xuICB9O1xuXG4gIE1vZGlmeU1hcE9ic2VydmVyLmNyZWF0ZSA9IGZ1bmN0aW9uIGNyZWF0ZSh0YXNrUXVldWUsIG1hcCkge1xuICAgIHZhciBvYnNlcnZlciA9IG5ldyBNb2RpZnlNYXBPYnNlcnZlcih0YXNrUXVldWUsIG1hcCk7XG5cbiAgICB2YXIgcHJvdG8gPSBtYXBQcm90bztcbiAgICBpZiAocHJvdG8uYWRkICE9PSBtYXAuYWRkIHx8IHByb3RvLmRlbGV0ZSAhPT0gbWFwLmRlbGV0ZSB8fCBwcm90by5jbGVhciAhPT0gbWFwLmNsZWFyKSB7XG4gICAgICBwcm90byA9IHtcbiAgICAgICAgYWRkOiBtYXAuYWRkLFxuICAgICAgICBkZWxldGU6IG1hcC5kZWxldGUsXG4gICAgICAgIGNsZWFyOiBtYXAuY2xlYXJcbiAgICAgIH07XG4gICAgfVxuXG4gICAgbWFwLnNldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBoYXNWYWx1ZSA9IG1hcC5oYXMoYXJndW1lbnRzWzBdKTtcbiAgICAgIHZhciB0eXBlID0gaGFzVmFsdWUgPyAndXBkYXRlJyA6ICdhZGQnO1xuICAgICAgdmFyIG9sZFZhbHVlID0gbWFwLmdldChhcmd1bWVudHNbMF0pO1xuICAgICAgdmFyIG1ldGhvZENhbGxSZXN1bHQgPSBwcm90by5zZXQuYXBwbHkobWFwLCBhcmd1bWVudHMpO1xuICAgICAgaWYgKCFoYXNWYWx1ZSB8fCBvbGRWYWx1ZSAhPT0gbWFwLmdldChhcmd1bWVudHNbMF0pKSB7XG4gICAgICAgIG9ic2VydmVyLmFkZENoYW5nZVJlY29yZCh7XG4gICAgICAgICAgdHlwZTogdHlwZSxcbiAgICAgICAgICBvYmplY3Q6IG1hcCxcbiAgICAgICAgICBrZXk6IGFyZ3VtZW50c1swXSxcbiAgICAgICAgICBvbGRWYWx1ZTogb2xkVmFsdWVcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbWV0aG9kQ2FsbFJlc3VsdDtcbiAgICB9O1xuXG4gICAgbWFwLmRlbGV0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBoYXNWYWx1ZSA9IG1hcC5oYXMoYXJndW1lbnRzWzBdKTtcbiAgICAgIHZhciBvbGRWYWx1ZSA9IG1hcC5nZXQoYXJndW1lbnRzWzBdKTtcbiAgICAgIHZhciBtZXRob2RDYWxsUmVzdWx0ID0gcHJvdG8uZGVsZXRlLmFwcGx5KG1hcCwgYXJndW1lbnRzKTtcbiAgICAgIGlmIChoYXNWYWx1ZSkge1xuICAgICAgICBvYnNlcnZlci5hZGRDaGFuZ2VSZWNvcmQoe1xuICAgICAgICAgIHR5cGU6ICdkZWxldGUnLFxuICAgICAgICAgIG9iamVjdDogbWFwLFxuICAgICAgICAgIGtleTogYXJndW1lbnRzWzBdLFxuICAgICAgICAgIG9sZFZhbHVlOiBvbGRWYWx1ZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBtZXRob2RDYWxsUmVzdWx0O1xuICAgIH07XG5cbiAgICBtYXAuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgbWV0aG9kQ2FsbFJlc3VsdCA9IHByb3RvLmNsZWFyLmFwcGx5KG1hcCwgYXJndW1lbnRzKTtcbiAgICAgIG9ic2VydmVyLmFkZENoYW5nZVJlY29yZCh7XG4gICAgICAgIHR5cGU6ICdjbGVhcicsXG4gICAgICAgIG9iamVjdDogbWFwXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBtZXRob2RDYWxsUmVzdWx0O1xuICAgIH07XG5cbiAgICByZXR1cm4gb2JzZXJ2ZXI7XG4gIH07XG5cbiAgcmV0dXJuIE1vZGlmeU1hcE9ic2VydmVyO1xufShNb2RpZnlDb2xsZWN0aW9uT2JzZXJ2ZXIpO1xuXG5mdW5jdGlvbiBmaW5kT3JpZ2luYWxFdmVudFRhcmdldChldmVudCkge1xuICByZXR1cm4gZXZlbnQucGF0aCAmJiBldmVudC5wYXRoWzBdIHx8IGV2ZW50LmRlZXBQYXRoICYmIGV2ZW50LmRlZXBQYXRoWzBdIHx8IGV2ZW50LnRhcmdldDtcbn1cblxuZnVuY3Rpb24gaGFuZGxlRGVsZWdhdGVkRXZlbnQoZXZlbnQpIHtcbiAgdmFyIHRhcmdldCA9IGZpbmRPcmlnaW5hbEV2ZW50VGFyZ2V0KGV2ZW50KTtcbiAgdmFyIGNhbGxiYWNrID0gdm9pZCAwO1xuXG4gIHdoaWxlICh0YXJnZXQgJiYgIWNhbGxiYWNrKSB7XG4gICAgaWYgKHRhcmdldC5kZWxlZ2F0ZWRDYWxsYmFja3MpIHtcbiAgICAgIGNhbGxiYWNrID0gdGFyZ2V0LmRlbGVnYXRlZENhbGxiYWNrc1tldmVudC50eXBlXTtcbiAgICB9XG5cbiAgICBpZiAoIWNhbGxiYWNrKSB7XG4gICAgICB0YXJnZXQgPSB0YXJnZXQucGFyZW50Tm9kZTtcbiAgICB9XG4gIH1cblxuICBpZiAoY2FsbGJhY2spIHtcbiAgICBjYWxsYmFjayhldmVudCk7XG4gIH1cbn1cblxudmFyIERlbGVnYXRlSGFuZGxlckVudHJ5ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBEZWxlZ2F0ZUhhbmRsZXJFbnRyeShldmVudE5hbWUpIHtcbiAgICBcblxuICAgIHRoaXMuZXZlbnROYW1lID0gZXZlbnROYW1lO1xuICAgIHRoaXMuY291bnQgPSAwO1xuICB9XG5cbiAgRGVsZWdhdGVIYW5kbGVyRW50cnkucHJvdG90eXBlLmluY3JlbWVudCA9IGZ1bmN0aW9uIGluY3JlbWVudCgpIHtcbiAgICB0aGlzLmNvdW50Kys7XG5cbiAgICBpZiAodGhpcy5jb3VudCA9PT0gMSkge1xuICAgICAgX2F1cmVsaWFQYWwuRE9NLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5ldmVudE5hbWUsIGhhbmRsZURlbGVnYXRlZEV2ZW50LCBmYWxzZSk7XG4gICAgfVxuICB9O1xuXG4gIERlbGVnYXRlSGFuZGxlckVudHJ5LnByb3RvdHlwZS5kZWNyZW1lbnQgPSBmdW5jdGlvbiBkZWNyZW1lbnQoKSB7XG4gICAgdGhpcy5jb3VudC0tO1xuXG4gICAgaWYgKHRoaXMuY291bnQgPT09IDApIHtcbiAgICAgIF9hdXJlbGlhUGFsLkRPTS5yZW1vdmVFdmVudExpc3RlbmVyKHRoaXMuZXZlbnROYW1lLCBoYW5kbGVEZWxlZ2F0ZWRFdmVudCk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBEZWxlZ2F0ZUhhbmRsZXJFbnRyeTtcbn0oKTtcblxudmFyIERlZmF1bHRFdmVudFN0cmF0ZWd5ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBEZWZhdWx0RXZlbnRTdHJhdGVneSgpIHtcbiAgICBcblxuICAgIHRoaXMuZGVsZWdhdGVkSGFuZGxlcnMgPSBbXTtcbiAgfVxuXG4gIERlZmF1bHRFdmVudFN0cmF0ZWd5LnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiBzdWJzY3JpYmUodGFyZ2V0LCB0YXJnZXRFdmVudCwgY2FsbGJhY2ssIGRlbGVnYXRlKSB7XG4gICAgdmFyIF90aGlzMjIgPSB0aGlzO1xuXG4gICAgaWYgKGRlbGVnYXRlKSB7XG4gICAgICB2YXIgX3JldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGRlbGVnYXRlZEhhbmRsZXJzID0gX3RoaXMyMi5kZWxlZ2F0ZWRIYW5kbGVycztcbiAgICAgICAgdmFyIGhhbmRsZXJFbnRyeSA9IGRlbGVnYXRlZEhhbmRsZXJzW3RhcmdldEV2ZW50XSB8fCAoZGVsZWdhdGVkSGFuZGxlcnNbdGFyZ2V0RXZlbnRdID0gbmV3IERlbGVnYXRlSGFuZGxlckVudHJ5KHRhcmdldEV2ZW50KSk7XG4gICAgICAgIHZhciBkZWxlZ2F0ZWRDYWxsYmFja3MgPSB0YXJnZXQuZGVsZWdhdGVkQ2FsbGJhY2tzIHx8ICh0YXJnZXQuZGVsZWdhdGVkQ2FsbGJhY2tzID0ge30pO1xuXG4gICAgICAgIGhhbmRsZXJFbnRyeS5pbmNyZW1lbnQoKTtcbiAgICAgICAgZGVsZWdhdGVkQ2FsbGJhY2tzW3RhcmdldEV2ZW50XSA9IGNhbGxiYWNrO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdjogZnVuY3Rpb24gdigpIHtcbiAgICAgICAgICAgIGhhbmRsZXJFbnRyeS5kZWNyZW1lbnQoKTtcbiAgICAgICAgICAgIGRlbGVnYXRlZENhbGxiYWNrc1t0YXJnZXRFdmVudF0gPSBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0oKTtcblxuICAgICAgaWYgKCh0eXBlb2YgX3JldCA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoX3JldCkpID09PSBcIm9iamVjdFwiKSByZXR1cm4gX3JldC52O1xuICAgIH1cblxuICAgIHRhcmdldC5hZGRFdmVudExpc3RlbmVyKHRhcmdldEV2ZW50LCBjYWxsYmFjaywgZmFsc2UpO1xuXG4gICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgIHRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKHRhcmdldEV2ZW50LCBjYWxsYmFjayk7XG4gICAgfTtcbiAgfTtcblxuICByZXR1cm4gRGVmYXVsdEV2ZW50U3RyYXRlZ3k7XG59KCk7XG5cbnZhciBFdmVudE1hbmFnZXIgPSBleHBvcnRzLkV2ZW50TWFuYWdlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gRXZlbnRNYW5hZ2VyKCkge1xuICAgIFxuXG4gICAgdGhpcy5lbGVtZW50SGFuZGxlckxvb2t1cCA9IHt9O1xuICAgIHRoaXMuZXZlbnRTdHJhdGVneUxvb2t1cCA9IHt9O1xuXG4gICAgdGhpcy5yZWdpc3RlckVsZW1lbnRDb25maWcoe1xuICAgICAgdGFnTmFtZTogJ2lucHV0JyxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgdmFsdWU6IFsnY2hhbmdlJywgJ2lucHV0J10sXG4gICAgICAgIGNoZWNrZWQ6IFsnY2hhbmdlJywgJ2lucHV0J10sXG4gICAgICAgIGZpbGVzOiBbJ2NoYW5nZScsICdpbnB1dCddXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLnJlZ2lzdGVyRWxlbWVudENvbmZpZyh7XG4gICAgICB0YWdOYW1lOiAndGV4dGFyZWEnLFxuICAgICAgcHJvcGVydGllczoge1xuICAgICAgICB2YWx1ZTogWydjaGFuZ2UnLCAnaW5wdXQnXVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5yZWdpc3RlckVsZW1lbnRDb25maWcoe1xuICAgICAgdGFnTmFtZTogJ3NlbGVjdCcsXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIHZhbHVlOiBbJ2NoYW5nZSddXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLnJlZ2lzdGVyRWxlbWVudENvbmZpZyh7XG4gICAgICB0YWdOYW1lOiAnY29udGVudCBlZGl0YWJsZScsXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIHZhbHVlOiBbJ2NoYW5nZScsICdpbnB1dCcsICdibHVyJywgJ2tleXVwJywgJ3Bhc3RlJ11cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMucmVnaXN0ZXJFbGVtZW50Q29uZmlnKHtcbiAgICAgIHRhZ05hbWU6ICdzY3JvbGxhYmxlIGVsZW1lbnQnLFxuICAgICAgcHJvcGVydGllczoge1xuICAgICAgICBzY3JvbGxUb3A6IFsnc2Nyb2xsJ10sXG4gICAgICAgIHNjcm9sbExlZnQ6IFsnc2Nyb2xsJ11cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuZGVmYXVsdEV2ZW50U3RyYXRlZ3kgPSBuZXcgRGVmYXVsdEV2ZW50U3RyYXRlZ3koKTtcbiAgfVxuXG4gIEV2ZW50TWFuYWdlci5wcm90b3R5cGUucmVnaXN0ZXJFbGVtZW50Q29uZmlnID0gZnVuY3Rpb24gcmVnaXN0ZXJFbGVtZW50Q29uZmlnKGNvbmZpZykge1xuICAgIHZhciB0YWdOYW1lID0gY29uZmlnLnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgICB2YXIgcHJvcGVydGllcyA9IGNvbmZpZy5wcm9wZXJ0aWVzO1xuICAgIHZhciBwcm9wZXJ0eU5hbWUgPSB2b2lkIDA7XG5cbiAgICB0aGlzLmVsZW1lbnRIYW5kbGVyTG9va3VwW3RhZ05hbWVdID0ge307XG5cbiAgICBmb3IgKHByb3BlcnR5TmFtZSBpbiBwcm9wZXJ0aWVzKSB7XG4gICAgICBpZiAocHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eU5hbWUpKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXJFbGVtZW50UHJvcGVydHlDb25maWcodGFnTmFtZSwgcHJvcGVydHlOYW1lLCBwcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV0pO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBFdmVudE1hbmFnZXIucHJvdG90eXBlLnJlZ2lzdGVyRWxlbWVudFByb3BlcnR5Q29uZmlnID0gZnVuY3Rpb24gcmVnaXN0ZXJFbGVtZW50UHJvcGVydHlDb25maWcodGFnTmFtZSwgcHJvcGVydHlOYW1lLCBldmVudHMpIHtcbiAgICB0aGlzLmVsZW1lbnRIYW5kbGVyTG9va3VwW3RhZ05hbWVdW3Byb3BlcnR5TmFtZV0gPSB0aGlzLmNyZWF0ZUVsZW1lbnRIYW5kbGVyKGV2ZW50cyk7XG4gIH07XG5cbiAgRXZlbnRNYW5hZ2VyLnByb3RvdHlwZS5jcmVhdGVFbGVtZW50SGFuZGxlciA9IGZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnRIYW5kbGVyKGV2ZW50cykge1xuICAgIHJldHVybiB7XG4gICAgICBzdWJzY3JpYmU6IGZ1bmN0aW9uIHN1YnNjcmliZSh0YXJnZXQsIGNhbGxiYWNrKSB7XG4gICAgICAgIGV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChjaGFuZ2VFdmVudCkge1xuICAgICAgICAgIHRhcmdldC5hZGRFdmVudExpc3RlbmVyKGNoYW5nZUV2ZW50LCBjYWxsYmFjaywgZmFsc2UpO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChjaGFuZ2VFdmVudCkge1xuICAgICAgICAgICAgdGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoY2hhbmdlRXZlbnQsIGNhbGxiYWNrKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9O1xuICB9O1xuXG4gIEV2ZW50TWFuYWdlci5wcm90b3R5cGUucmVnaXN0ZXJFbGVtZW50SGFuZGxlciA9IGZ1bmN0aW9uIHJlZ2lzdGVyRWxlbWVudEhhbmRsZXIodGFnTmFtZSwgaGFuZGxlcikge1xuICAgIHRoaXMuZWxlbWVudEhhbmRsZXJMb29rdXBbdGFnTmFtZS50b0xvd2VyQ2FzZSgpXSA9IGhhbmRsZXI7XG4gIH07XG5cbiAgRXZlbnRNYW5hZ2VyLnByb3RvdHlwZS5yZWdpc3RlckV2ZW50U3RyYXRlZ3kgPSBmdW5jdGlvbiByZWdpc3RlckV2ZW50U3RyYXRlZ3koZXZlbnROYW1lLCBzdHJhdGVneSkge1xuICAgIHRoaXMuZXZlbnRTdHJhdGVneUxvb2t1cFtldmVudE5hbWVdID0gc3RyYXRlZ3k7XG4gIH07XG5cbiAgRXZlbnRNYW5hZ2VyLnByb3RvdHlwZS5nZXRFbGVtZW50SGFuZGxlciA9IGZ1bmN0aW9uIGdldEVsZW1lbnRIYW5kbGVyKHRhcmdldCwgcHJvcGVydHlOYW1lKSB7XG4gICAgdmFyIHRhZ05hbWUgPSB2b2lkIDA7XG4gICAgdmFyIGxvb2t1cCA9IHRoaXMuZWxlbWVudEhhbmRsZXJMb29rdXA7XG5cbiAgICBpZiAodGFyZ2V0LnRhZ05hbWUpIHtcbiAgICAgIHRhZ05hbWUgPSB0YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICBpZiAobG9va3VwW3RhZ05hbWVdICYmIGxvb2t1cFt0YWdOYW1lXVtwcm9wZXJ0eU5hbWVdKSB7XG4gICAgICAgIHJldHVybiBsb29rdXBbdGFnTmFtZV1bcHJvcGVydHlOYW1lXTtcbiAgICAgIH1cblxuICAgICAgaWYgKHByb3BlcnR5TmFtZSA9PT0gJ3RleHRDb250ZW50JyB8fCBwcm9wZXJ0eU5hbWUgPT09ICdpbm5lckhUTUwnKSB7XG4gICAgICAgIHJldHVybiBsb29rdXBbJ2NvbnRlbnQgZWRpdGFibGUnXS52YWx1ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKHByb3BlcnR5TmFtZSA9PT0gJ3Njcm9sbFRvcCcgfHwgcHJvcGVydHlOYW1lID09PSAnc2Nyb2xsTGVmdCcpIHtcbiAgICAgICAgcmV0dXJuIGxvb2t1cFsnc2Nyb2xsYWJsZSBlbGVtZW50J11bcHJvcGVydHlOYW1lXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfTtcblxuICBFdmVudE1hbmFnZXIucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiBhZGRFdmVudExpc3RlbmVyKHRhcmdldCwgdGFyZ2V0RXZlbnQsIGNhbGxiYWNrLCBkZWxlZ2F0ZSkge1xuICAgIHJldHVybiAodGhpcy5ldmVudFN0cmF0ZWd5TG9va3VwW3RhcmdldEV2ZW50XSB8fCB0aGlzLmRlZmF1bHRFdmVudFN0cmF0ZWd5KS5zdWJzY3JpYmUodGFyZ2V0LCB0YXJnZXRFdmVudCwgY2FsbGJhY2ssIGRlbGVnYXRlKTtcbiAgfTtcblxuICByZXR1cm4gRXZlbnRNYW5hZ2VyO1xufSgpO1xuXG52YXIgRGlydHlDaGVja2VyID0gZXhwb3J0cy5EaXJ0eUNoZWNrZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIERpcnR5Q2hlY2tlcigpIHtcbiAgICBcblxuICAgIHRoaXMudHJhY2tlZCA9IFtdO1xuICAgIHRoaXMuY2hlY2tEZWxheSA9IDEyMDtcbiAgfVxuXG4gIERpcnR5Q2hlY2tlci5wcm90b3R5cGUuYWRkUHJvcGVydHkgPSBmdW5jdGlvbiBhZGRQcm9wZXJ0eShwcm9wZXJ0eSkge1xuICAgIHZhciB0cmFja2VkID0gdGhpcy50cmFja2VkO1xuXG4gICAgdHJhY2tlZC5wdXNoKHByb3BlcnR5KTtcblxuICAgIGlmICh0cmFja2VkLmxlbmd0aCA9PT0gMSkge1xuICAgICAgdGhpcy5zY2hlZHVsZURpcnR5Q2hlY2soKTtcbiAgICB9XG4gIH07XG5cbiAgRGlydHlDaGVja2VyLnByb3RvdHlwZS5yZW1vdmVQcm9wZXJ0eSA9IGZ1bmN0aW9uIHJlbW92ZVByb3BlcnR5KHByb3BlcnR5KSB7XG4gICAgdmFyIHRyYWNrZWQgPSB0aGlzLnRyYWNrZWQ7XG4gICAgdHJhY2tlZC5zcGxpY2UodHJhY2tlZC5pbmRleE9mKHByb3BlcnR5KSwgMSk7XG4gIH07XG5cbiAgRGlydHlDaGVja2VyLnByb3RvdHlwZS5zY2hlZHVsZURpcnR5Q2hlY2sgPSBmdW5jdGlvbiBzY2hlZHVsZURpcnR5Q2hlY2soKSB7XG4gICAgdmFyIF90aGlzMjMgPSB0aGlzO1xuXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gX3RoaXMyMy5jaGVjaygpO1xuICAgIH0sIHRoaXMuY2hlY2tEZWxheSk7XG4gIH07XG5cbiAgRGlydHlDaGVja2VyLnByb3RvdHlwZS5jaGVjayA9IGZ1bmN0aW9uIGNoZWNrKCkge1xuICAgIHZhciB0cmFja2VkID0gdGhpcy50cmFja2VkO1xuICAgIHZhciBpID0gdHJhY2tlZC5sZW5ndGg7XG5cbiAgICB3aGlsZSAoaS0tKSB7XG4gICAgICB2YXIgY3VycmVudCA9IHRyYWNrZWRbaV07XG5cbiAgICAgIGlmIChjdXJyZW50LmlzRGlydHkoKSkge1xuICAgICAgICBjdXJyZW50LmNhbGwoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodHJhY2tlZC5sZW5ndGgpIHtcbiAgICAgIHRoaXMuc2NoZWR1bGVEaXJ0eUNoZWNrKCk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBEaXJ0eUNoZWNrZXI7XG59KCk7XG5cbnZhciBEaXJ0eUNoZWNrUHJvcGVydHkgPSBleHBvcnRzLkRpcnR5Q2hlY2tQcm9wZXJ0eSA9IChfZGVjNSA9IHN1YnNjcmliZXJDb2xsZWN0aW9uKCksIF9kZWM1KF9jbGFzczUgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIERpcnR5Q2hlY2tQcm9wZXJ0eShkaXJ0eUNoZWNrZXIsIG9iaiwgcHJvcGVydHlOYW1lKSB7XG4gICAgXG5cbiAgICB0aGlzLmRpcnR5Q2hlY2tlciA9IGRpcnR5Q2hlY2tlcjtcbiAgICB0aGlzLm9iaiA9IG9iajtcbiAgICB0aGlzLnByb3BlcnR5TmFtZSA9IHByb3BlcnR5TmFtZTtcbiAgfVxuXG4gIERpcnR5Q2hlY2tQcm9wZXJ0eS5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiBnZXRWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5vYmpbdGhpcy5wcm9wZXJ0eU5hbWVdO1xuICB9O1xuXG4gIERpcnR5Q2hlY2tQcm9wZXJ0eS5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbiBzZXRWYWx1ZShuZXdWYWx1ZSkge1xuICAgIHRoaXMub2JqW3RoaXMucHJvcGVydHlOYW1lXSA9IG5ld1ZhbHVlO1xuICB9O1xuXG4gIERpcnR5Q2hlY2tQcm9wZXJ0eS5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uIGNhbGwoKSB7XG4gICAgdmFyIG9sZFZhbHVlID0gdGhpcy5vbGRWYWx1ZTtcbiAgICB2YXIgbmV3VmFsdWUgPSB0aGlzLmdldFZhbHVlKCk7XG5cbiAgICB0aGlzLmNhbGxTdWJzY3JpYmVycyhuZXdWYWx1ZSwgb2xkVmFsdWUpO1xuXG4gICAgdGhpcy5vbGRWYWx1ZSA9IG5ld1ZhbHVlO1xuICB9O1xuXG4gIERpcnR5Q2hlY2tQcm9wZXJ0eS5wcm90b3R5cGUuaXNEaXJ0eSA9IGZ1bmN0aW9uIGlzRGlydHkoKSB7XG4gICAgcmV0dXJuIHRoaXMub2xkVmFsdWUgIT09IHRoaXMub2JqW3RoaXMucHJvcGVydHlOYW1lXTtcbiAgfTtcblxuICBEaXJ0eUNoZWNrUHJvcGVydHkucHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uIHN1YnNjcmliZShjb250ZXh0LCBjYWxsYWJsZSkge1xuICAgIGlmICghdGhpcy5oYXNTdWJzY3JpYmVycygpKSB7XG4gICAgICB0aGlzLm9sZFZhbHVlID0gdGhpcy5nZXRWYWx1ZSgpO1xuICAgICAgdGhpcy5kaXJ0eUNoZWNrZXIuYWRkUHJvcGVydHkodGhpcyk7XG4gICAgfVxuICAgIHRoaXMuYWRkU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSk7XG4gIH07XG5cbiAgRGlydHlDaGVja1Byb3BlcnR5LnByb3RvdHlwZS51bnN1YnNjcmliZSA9IGZ1bmN0aW9uIHVuc3Vic2NyaWJlKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gICAgaWYgKHRoaXMucmVtb3ZlU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSkgJiYgIXRoaXMuaGFzU3Vic2NyaWJlcnMoKSkge1xuICAgICAgdGhpcy5kaXJ0eUNoZWNrZXIucmVtb3ZlUHJvcGVydHkodGhpcyk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBEaXJ0eUNoZWNrUHJvcGVydHk7XG59KCkpIHx8IF9jbGFzczUpO1xuXG5cbnZhciBsb2dnZXIgPSBMb2dNYW5hZ2VyLmdldExvZ2dlcigncHJvcGVydHktb2JzZXJ2YXRpb24nKTtcblxudmFyIHByb3BlcnR5QWNjZXNzb3IgPSBleHBvcnRzLnByb3BlcnR5QWNjZXNzb3IgPSB7XG4gIGdldFZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZShvYmosIHByb3BlcnR5TmFtZSkge1xuICAgIHJldHVybiBvYmpbcHJvcGVydHlOYW1lXTtcbiAgfSxcbiAgc2V0VmFsdWU6IGZ1bmN0aW9uIHNldFZhbHVlKHZhbHVlLCBvYmosIHByb3BlcnR5TmFtZSkge1xuICAgIG9ialtwcm9wZXJ0eU5hbWVdID0gdmFsdWU7XG4gIH1cbn07XG5cbnZhciBQcmltaXRpdmVPYnNlcnZlciA9IGV4cG9ydHMuUHJpbWl0aXZlT2JzZXJ2ZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFByaW1pdGl2ZU9ic2VydmVyKHByaW1pdGl2ZSwgcHJvcGVydHlOYW1lKSB7XG4gICAgXG5cbiAgICB0aGlzLmRvTm90Q2FjaGUgPSB0cnVlO1xuXG4gICAgdGhpcy5wcmltaXRpdmUgPSBwcmltaXRpdmU7XG4gICAgdGhpcy5wcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eU5hbWU7XG4gIH1cblxuICBQcmltaXRpdmVPYnNlcnZlci5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiBnZXRWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5wcmltaXRpdmVbdGhpcy5wcm9wZXJ0eU5hbWVdO1xuICB9O1xuXG4gIFByaW1pdGl2ZU9ic2VydmVyLnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uIHNldFZhbHVlKCkge1xuICAgIHZhciB0eXBlID0gX3R5cGVvZih0aGlzLnByaW1pdGl2ZSk7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgJyArIHRoaXMucHJvcGVydHlOYW1lICsgJyBwcm9wZXJ0eSBvZiBhICcgKyB0eXBlICsgJyAoJyArIHRoaXMucHJpbWl0aXZlICsgJykgY2Fubm90IGJlIGFzc2lnbmVkLicpO1xuICB9O1xuXG4gIFByaW1pdGl2ZU9ic2VydmVyLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiBzdWJzY3JpYmUoKSB7fTtcblxuICBQcmltaXRpdmVPYnNlcnZlci5wcm90b3R5cGUudW5zdWJzY3JpYmUgPSBmdW5jdGlvbiB1bnN1YnNjcmliZSgpIHt9O1xuXG4gIHJldHVybiBQcmltaXRpdmVPYnNlcnZlcjtcbn0oKTtcblxudmFyIFNldHRlck9ic2VydmVyID0gZXhwb3J0cy5TZXR0ZXJPYnNlcnZlciA9IChfZGVjNiA9IHN1YnNjcmliZXJDb2xsZWN0aW9uKCksIF9kZWM2KF9jbGFzczcgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFNldHRlck9ic2VydmVyKHRhc2tRdWV1ZSwgb2JqLCBwcm9wZXJ0eU5hbWUpIHtcbiAgICBcblxuICAgIHRoaXMudGFza1F1ZXVlID0gdGFza1F1ZXVlO1xuICAgIHRoaXMub2JqID0gb2JqO1xuICAgIHRoaXMucHJvcGVydHlOYW1lID0gcHJvcGVydHlOYW1lO1xuICAgIHRoaXMucXVldWVkID0gZmFsc2U7XG4gICAgdGhpcy5vYnNlcnZpbmcgPSBmYWxzZTtcbiAgfVxuXG4gIFNldHRlck9ic2VydmVyLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIGdldFZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLm9ialt0aGlzLnByb3BlcnR5TmFtZV07XG4gIH07XG5cbiAgU2V0dGVyT2JzZXJ2ZXIucHJvdG90eXBlLnNldFZhbHVlID0gZnVuY3Rpb24gc2V0VmFsdWUobmV3VmFsdWUpIHtcbiAgICB0aGlzLm9ialt0aGlzLnByb3BlcnR5TmFtZV0gPSBuZXdWYWx1ZTtcbiAgfTtcblxuICBTZXR0ZXJPYnNlcnZlci5wcm90b3R5cGUuZ2V0dGVyVmFsdWUgPSBmdW5jdGlvbiBnZXR0ZXJWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50VmFsdWU7XG4gIH07XG5cbiAgU2V0dGVyT2JzZXJ2ZXIucHJvdG90eXBlLnNldHRlclZhbHVlID0gZnVuY3Rpb24gc2V0dGVyVmFsdWUobmV3VmFsdWUpIHtcbiAgICB2YXIgb2xkVmFsdWUgPSB0aGlzLmN1cnJlbnRWYWx1ZTtcblxuICAgIGlmIChvbGRWYWx1ZSAhPT0gbmV3VmFsdWUpIHtcbiAgICAgIGlmICghdGhpcy5xdWV1ZWQpIHtcbiAgICAgICAgdGhpcy5vbGRWYWx1ZSA9IG9sZFZhbHVlO1xuICAgICAgICB0aGlzLnF1ZXVlZCA9IHRydWU7XG4gICAgICAgIHRoaXMudGFza1F1ZXVlLnF1ZXVlTWljcm9UYXNrKHRoaXMpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmN1cnJlbnRWYWx1ZSA9IG5ld1ZhbHVlO1xuICAgIH1cbiAgfTtcblxuICBTZXR0ZXJPYnNlcnZlci5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uIGNhbGwoKSB7XG4gICAgdmFyIG9sZFZhbHVlID0gdGhpcy5vbGRWYWx1ZTtcbiAgICB2YXIgbmV3VmFsdWUgPSB0aGlzLmN1cnJlbnRWYWx1ZTtcblxuICAgIHRoaXMucXVldWVkID0gZmFsc2U7XG5cbiAgICB0aGlzLmNhbGxTdWJzY3JpYmVycyhuZXdWYWx1ZSwgb2xkVmFsdWUpO1xuICB9O1xuXG4gIFNldHRlck9ic2VydmVyLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiBzdWJzY3JpYmUoY29udGV4dCwgY2FsbGFibGUpIHtcbiAgICBpZiAoIXRoaXMub2JzZXJ2aW5nKSB7XG4gICAgICB0aGlzLmNvbnZlcnRQcm9wZXJ0eSgpO1xuICAgIH1cbiAgICB0aGlzLmFkZFN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpO1xuICB9O1xuXG4gIFNldHRlck9ic2VydmVyLnByb3RvdHlwZS51bnN1YnNjcmliZSA9IGZ1bmN0aW9uIHVuc3Vic2NyaWJlKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gICAgdGhpcy5yZW1vdmVTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKTtcbiAgfTtcblxuICBTZXR0ZXJPYnNlcnZlci5wcm90b3R5cGUuY29udmVydFByb3BlcnR5ID0gZnVuY3Rpb24gY29udmVydFByb3BlcnR5KCkge1xuICAgIHRoaXMub2JzZXJ2aW5nID0gdHJ1ZTtcbiAgICB0aGlzLmN1cnJlbnRWYWx1ZSA9IHRoaXMub2JqW3RoaXMucHJvcGVydHlOYW1lXTtcbiAgICB0aGlzLnNldFZhbHVlID0gdGhpcy5zZXR0ZXJWYWx1ZTtcbiAgICB0aGlzLmdldFZhbHVlID0gdGhpcy5nZXR0ZXJWYWx1ZTtcblxuICAgIGlmICghUmVmbGVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLm9iaiwgdGhpcy5wcm9wZXJ0eU5hbWUsIHtcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIGVudW1lcmFibGU6IHRoaXMucHJvcGVydHlOYW1lIGluIHRoaXMub2JqID8gdGhpcy5vYmoucHJvcGVydHlJc0VudW1lcmFibGUodGhpcy5wcm9wZXJ0eU5hbWUpIDogdHJ1ZSxcbiAgICAgIGdldDogdGhpcy5nZXRWYWx1ZS5iaW5kKHRoaXMpLFxuICAgICAgc2V0OiB0aGlzLnNldFZhbHVlLmJpbmQodGhpcylcbiAgICB9KSkge1xuICAgICAgbG9nZ2VyLndhcm4oJ0Nhbm5vdCBvYnNlcnZlIHByb3BlcnR5IFxcJycgKyB0aGlzLnByb3BlcnR5TmFtZSArICdcXCcgb2Ygb2JqZWN0JywgdGhpcy5vYmopO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gU2V0dGVyT2JzZXJ2ZXI7XG59KCkpIHx8IF9jbGFzczcpO1xuXG52YXIgWExpbmtBdHRyaWJ1dGVPYnNlcnZlciA9IGV4cG9ydHMuWExpbmtBdHRyaWJ1dGVPYnNlcnZlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gWExpbmtBdHRyaWJ1dGVPYnNlcnZlcihlbGVtZW50LCBwcm9wZXJ0eU5hbWUsIGF0dHJpYnV0ZU5hbWUpIHtcbiAgICBcblxuICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgdGhpcy5wcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eU5hbWU7XG4gICAgdGhpcy5hdHRyaWJ1dGVOYW1lID0gYXR0cmlidXRlTmFtZTtcbiAgfVxuXG4gIFhMaW5rQXR0cmlidXRlT2JzZXJ2ZXIucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gZ2V0VmFsdWUoKSB7XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudC5nZXRBdHRyaWJ1dGVOUygnaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluaycsIHRoaXMuYXR0cmlidXRlTmFtZSk7XG4gIH07XG5cbiAgWExpbmtBdHRyaWJ1dGVPYnNlcnZlci5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbiBzZXRWYWx1ZShuZXdWYWx1ZSkge1xuICAgIHJldHVybiB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlTlMoJ2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsnLCB0aGlzLmF0dHJpYnV0ZU5hbWUsIG5ld1ZhbHVlKTtcbiAgfTtcblxuICBYTGlua0F0dHJpYnV0ZU9ic2VydmVyLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiBzdWJzY3JpYmUoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdPYnNlcnZhdGlvbiBvZiBhIFwiJyArIHRoaXMuZWxlbWVudC5ub2RlTmFtZSArICdcIiBlbGVtZW50XFwncyBcIicgKyB0aGlzLnByb3BlcnR5TmFtZSArICdcIiBwcm9wZXJ0eSBpcyBub3Qgc3VwcG9ydGVkLicpO1xuICB9O1xuXG4gIHJldHVybiBYTGlua0F0dHJpYnV0ZU9ic2VydmVyO1xufSgpO1xuXG52YXIgZGF0YUF0dHJpYnV0ZUFjY2Vzc29yID0gZXhwb3J0cy5kYXRhQXR0cmlidXRlQWNjZXNzb3IgPSB7XG4gIGdldFZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZShvYmosIHByb3BlcnR5TmFtZSkge1xuICAgIHJldHVybiBvYmouZ2V0QXR0cmlidXRlKHByb3BlcnR5TmFtZSk7XG4gIH0sXG4gIHNldFZhbHVlOiBmdW5jdGlvbiBzZXRWYWx1ZSh2YWx1ZSwgb2JqLCBwcm9wZXJ0eU5hbWUpIHtcbiAgICByZXR1cm4gb2JqLnNldEF0dHJpYnV0ZShwcm9wZXJ0eU5hbWUsIHZhbHVlKTtcbiAgfVxufTtcblxudmFyIERhdGFBdHRyaWJ1dGVPYnNlcnZlciA9IGV4cG9ydHMuRGF0YUF0dHJpYnV0ZU9ic2VydmVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBEYXRhQXR0cmlidXRlT2JzZXJ2ZXIoZWxlbWVudCwgcHJvcGVydHlOYW1lKSB7XG4gICAgXG5cbiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICAgIHRoaXMucHJvcGVydHlOYW1lID0gcHJvcGVydHlOYW1lO1xuICB9XG5cbiAgRGF0YUF0dHJpYnV0ZU9ic2VydmVyLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIGdldFZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLmVsZW1lbnQuZ2V0QXR0cmlidXRlKHRoaXMucHJvcGVydHlOYW1lKTtcbiAgfTtcblxuICBEYXRhQXR0cmlidXRlT2JzZXJ2ZXIucHJvdG90eXBlLnNldFZhbHVlID0gZnVuY3Rpb24gc2V0VmFsdWUobmV3VmFsdWUpIHtcbiAgICByZXR1cm4gdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSh0aGlzLnByb3BlcnR5TmFtZSwgbmV3VmFsdWUpO1xuICB9O1xuXG4gIERhdGFBdHRyaWJ1dGVPYnNlcnZlci5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gc3Vic2NyaWJlKCkge1xuICAgIHRocm93IG5ldyBFcnJvcignT2JzZXJ2YXRpb24gb2YgYSBcIicgKyB0aGlzLmVsZW1lbnQubm9kZU5hbWUgKyAnXCIgZWxlbWVudFxcJ3MgXCInICsgdGhpcy5wcm9wZXJ0eU5hbWUgKyAnXCIgcHJvcGVydHkgaXMgbm90IHN1cHBvcnRlZC4nKTtcbiAgfTtcblxuICByZXR1cm4gRGF0YUF0dHJpYnV0ZU9ic2VydmVyO1xufSgpO1xuXG52YXIgU3R5bGVPYnNlcnZlciA9IGV4cG9ydHMuU3R5bGVPYnNlcnZlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gU3R5bGVPYnNlcnZlcihlbGVtZW50LCBwcm9wZXJ0eU5hbWUpIHtcbiAgICBcblxuICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgdGhpcy5wcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eU5hbWU7XG5cbiAgICB0aGlzLnN0eWxlcyA9IG51bGw7XG4gICAgdGhpcy52ZXJzaW9uID0gMDtcbiAgfVxuXG4gIFN0eWxlT2JzZXJ2ZXIucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gZ2V0VmFsdWUoKSB7XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudC5zdHlsZS5jc3NUZXh0O1xuICB9O1xuXG4gIFN0eWxlT2JzZXJ2ZXIucHJvdG90eXBlLnNldFZhbHVlID0gZnVuY3Rpb24gc2V0VmFsdWUobmV3VmFsdWUpIHtcbiAgICB2YXIgc3R5bGVzID0gdGhpcy5zdHlsZXMgfHwge307XG4gICAgdmFyIHN0eWxlID0gdm9pZCAwO1xuICAgIHZhciB2ZXJzaW9uID0gdGhpcy52ZXJzaW9uO1xuXG4gICAgaWYgKG5ld1ZhbHVlICE9PSBudWxsICYmIG5ld1ZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGlmIChuZXdWYWx1ZSBpbnN0YW5jZW9mIE9iamVjdCkge1xuICAgICAgICBmb3IgKHN0eWxlIGluIG5ld1ZhbHVlKSB7XG4gICAgICAgICAgaWYgKG5ld1ZhbHVlLmhhc093blByb3BlcnR5KHN0eWxlKSkge1xuICAgICAgICAgICAgc3R5bGVzW3N0eWxlXSA9IHZlcnNpb247XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGVbc3R5bGVdID0gbmV3VmFsdWVbc3R5bGVdO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChuZXdWYWx1ZS5sZW5ndGgpIHtcbiAgICAgICAgdmFyIHBhaXJzID0gbmV3VmFsdWUuc3BsaXQoLyg/Ojt8Oig/IVxcLykpXFxzKi8pO1xuICAgICAgICBmb3IgKHZhciBfaTIyID0gMCwgbGVuZ3RoID0gcGFpcnMubGVuZ3RoOyBfaTIyIDwgbGVuZ3RoOyBfaTIyKyspIHtcbiAgICAgICAgICBzdHlsZSA9IHBhaXJzW19pMjJdLnRyaW0oKTtcbiAgICAgICAgICBpZiAoIXN0eWxlKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBzdHlsZXNbc3R5bGVdID0gdmVyc2lvbjtcblxuICAgICAgICAgIHRoaXMuZWxlbWVudC5zdHlsZVtzdHlsZV0gPSBwYWlyc1srK19pMjJdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5zdHlsZXMgPSBzdHlsZXM7XG4gICAgdGhpcy52ZXJzaW9uICs9IDE7XG5cbiAgICBpZiAodmVyc2lvbiA9PT0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZlcnNpb24gLT0gMTtcbiAgICBmb3IgKHN0eWxlIGluIHN0eWxlcykge1xuICAgICAgaWYgKCFzdHlsZXMuaGFzT3duUHJvcGVydHkoc3R5bGUpIHx8IHN0eWxlc1tzdHlsZV0gIT09IHZlcnNpb24pIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuZWxlbWVudC5zdHlsZVtzdHlsZV0gPSAnJztcbiAgICB9XG4gIH07XG5cbiAgU3R5bGVPYnNlcnZlci5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gc3Vic2NyaWJlKCkge1xuICAgIHRocm93IG5ldyBFcnJvcignT2JzZXJ2YXRpb24gb2YgYSBcIicgKyB0aGlzLmVsZW1lbnQubm9kZU5hbWUgKyAnXCIgZWxlbWVudFxcJ3MgXCInICsgdGhpcy5wcm9wZXJ0eU5hbWUgKyAnXCIgcHJvcGVydHkgaXMgbm90IHN1cHBvcnRlZC4nKTtcbiAgfTtcblxuICByZXR1cm4gU3R5bGVPYnNlcnZlcjtcbn0oKTtcblxudmFyIFZhbHVlQXR0cmlidXRlT2JzZXJ2ZXIgPSBleHBvcnRzLlZhbHVlQXR0cmlidXRlT2JzZXJ2ZXIgPSAoX2RlYzcgPSBzdWJzY3JpYmVyQ29sbGVjdGlvbigpLCBfZGVjNyhfY2xhc3M4ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBWYWx1ZUF0dHJpYnV0ZU9ic2VydmVyKGVsZW1lbnQsIHByb3BlcnR5TmFtZSwgaGFuZGxlcikge1xuICAgIFxuXG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICB0aGlzLnByb3BlcnR5TmFtZSA9IHByb3BlcnR5TmFtZTtcbiAgICB0aGlzLmhhbmRsZXIgPSBoYW5kbGVyO1xuICAgIGlmIChwcm9wZXJ0eU5hbWUgPT09ICdmaWxlcycpIHtcbiAgICAgIHRoaXMuc2V0VmFsdWUgPSBmdW5jdGlvbiAoKSB7fTtcbiAgICB9XG4gIH1cblxuICBWYWx1ZUF0dHJpYnV0ZU9ic2VydmVyLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIGdldFZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLmVsZW1lbnRbdGhpcy5wcm9wZXJ0eU5hbWVdO1xuICB9O1xuXG4gIFZhbHVlQXR0cmlidXRlT2JzZXJ2ZXIucHJvdG90eXBlLnNldFZhbHVlID0gZnVuY3Rpb24gc2V0VmFsdWUobmV3VmFsdWUpIHtcbiAgICBuZXdWYWx1ZSA9IG5ld1ZhbHVlID09PSB1bmRlZmluZWQgfHwgbmV3VmFsdWUgPT09IG51bGwgPyAnJyA6IG5ld1ZhbHVlO1xuICAgIGlmICh0aGlzLmVsZW1lbnRbdGhpcy5wcm9wZXJ0eU5hbWVdICE9PSBuZXdWYWx1ZSkge1xuICAgICAgdGhpcy5lbGVtZW50W3RoaXMucHJvcGVydHlOYW1lXSA9IG5ld1ZhbHVlO1xuICAgICAgdGhpcy5ub3RpZnkoKTtcbiAgICB9XG4gIH07XG5cbiAgVmFsdWVBdHRyaWJ1dGVPYnNlcnZlci5wcm90b3R5cGUubm90aWZ5ID0gZnVuY3Rpb24gbm90aWZ5KCkge1xuICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMub2xkVmFsdWU7XG4gICAgdmFyIG5ld1ZhbHVlID0gdGhpcy5nZXRWYWx1ZSgpO1xuXG4gICAgdGhpcy5jYWxsU3Vic2NyaWJlcnMobmV3VmFsdWUsIG9sZFZhbHVlKTtcblxuICAgIHRoaXMub2xkVmFsdWUgPSBuZXdWYWx1ZTtcbiAgfTtcblxuICBWYWx1ZUF0dHJpYnV0ZU9ic2VydmVyLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiBzdWJzY3JpYmUoY29udGV4dCwgY2FsbGFibGUpIHtcbiAgICBpZiAoIXRoaXMuaGFzU3Vic2NyaWJlcnMoKSkge1xuICAgICAgdGhpcy5vbGRWYWx1ZSA9IHRoaXMuZ2V0VmFsdWUoKTtcbiAgICAgIHRoaXMuZGlzcG9zZUhhbmRsZXIgPSB0aGlzLmhhbmRsZXIuc3Vic2NyaWJlKHRoaXMuZWxlbWVudCwgdGhpcy5ub3RpZnkuYmluZCh0aGlzKSk7XG4gICAgfVxuXG4gICAgdGhpcy5hZGRTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKTtcbiAgfTtcblxuICBWYWx1ZUF0dHJpYnV0ZU9ic2VydmVyLnByb3RvdHlwZS51bnN1YnNjcmliZSA9IGZ1bmN0aW9uIHVuc3Vic2NyaWJlKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gICAgaWYgKHRoaXMucmVtb3ZlU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSkgJiYgIXRoaXMuaGFzU3Vic2NyaWJlcnMoKSkge1xuICAgICAgdGhpcy5kaXNwb3NlSGFuZGxlcigpO1xuICAgICAgdGhpcy5kaXNwb3NlSGFuZGxlciA9IG51bGw7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBWYWx1ZUF0dHJpYnV0ZU9ic2VydmVyO1xufSgpKSB8fCBfY2xhc3M4KTtcblxuXG52YXIgY2hlY2tlZEFycmF5Q29udGV4dCA9ICdDaGVja2VkT2JzZXJ2ZXI6YXJyYXknO1xudmFyIGNoZWNrZWRWYWx1ZUNvbnRleHQgPSAnQ2hlY2tlZE9ic2VydmVyOnZhbHVlJztcblxudmFyIENoZWNrZWRPYnNlcnZlciA9IGV4cG9ydHMuQ2hlY2tlZE9ic2VydmVyID0gKF9kZWM4ID0gc3Vic2NyaWJlckNvbGxlY3Rpb24oKSwgX2RlYzgoX2NsYXNzOSA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQ2hlY2tlZE9ic2VydmVyKGVsZW1lbnQsIGhhbmRsZXIsIG9ic2VydmVyTG9jYXRvcikge1xuICAgIFxuXG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICB0aGlzLmhhbmRsZXIgPSBoYW5kbGVyO1xuICAgIHRoaXMub2JzZXJ2ZXJMb2NhdG9yID0gb2JzZXJ2ZXJMb2NhdG9yO1xuICB9XG5cbiAgQ2hlY2tlZE9ic2VydmVyLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIGdldFZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLnZhbHVlO1xuICB9O1xuXG4gIENoZWNrZWRPYnNlcnZlci5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbiBzZXRWYWx1ZShuZXdWYWx1ZSkge1xuICAgIGlmICh0aGlzLnZhbHVlID09PSBuZXdWYWx1ZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmFycmF5T2JzZXJ2ZXIpIHtcbiAgICAgIHRoaXMuYXJyYXlPYnNlcnZlci51bnN1YnNjcmliZShjaGVja2VkQXJyYXlDb250ZXh0LCB0aGlzKTtcbiAgICAgIHRoaXMuYXJyYXlPYnNlcnZlciA9IG51bGw7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZWxlbWVudC50eXBlID09PSAnY2hlY2tib3gnICYmIEFycmF5LmlzQXJyYXkobmV3VmFsdWUpKSB7XG4gICAgICB0aGlzLmFycmF5T2JzZXJ2ZXIgPSB0aGlzLm9ic2VydmVyTG9jYXRvci5nZXRBcnJheU9ic2VydmVyKG5ld1ZhbHVlKTtcbiAgICAgIHRoaXMuYXJyYXlPYnNlcnZlci5zdWJzY3JpYmUoY2hlY2tlZEFycmF5Q29udGV4dCwgdGhpcyk7XG4gICAgfVxuXG4gICAgdGhpcy5vbGRWYWx1ZSA9IHRoaXMudmFsdWU7XG4gICAgdGhpcy52YWx1ZSA9IG5ld1ZhbHVlO1xuICAgIHRoaXMuc3luY2hyb25pemVFbGVtZW50KCk7XG4gICAgdGhpcy5ub3RpZnkoKTtcblxuICAgIGlmICghdGhpcy5pbml0aWFsU3luYykge1xuICAgICAgdGhpcy5pbml0aWFsU3luYyA9IHRydWU7XG4gICAgICB0aGlzLm9ic2VydmVyTG9jYXRvci50YXNrUXVldWUucXVldWVNaWNyb1Rhc2sodGhpcyk7XG4gICAgfVxuICB9O1xuXG4gIENoZWNrZWRPYnNlcnZlci5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uIGNhbGwoY29udGV4dCwgc3BsaWNlcykge1xuICAgIHRoaXMuc3luY2hyb25pemVFbGVtZW50KCk7XG5cbiAgICBpZiAoIXRoaXMudmFsdWVPYnNlcnZlcikge1xuICAgICAgdGhpcy52YWx1ZU9ic2VydmVyID0gdGhpcy5lbGVtZW50Ll9fb2JzZXJ2ZXJzX18ubW9kZWwgfHwgdGhpcy5lbGVtZW50Ll9fb2JzZXJ2ZXJzX18udmFsdWU7XG4gICAgICBpZiAodGhpcy52YWx1ZU9ic2VydmVyKSB7XG4gICAgICAgIHRoaXMudmFsdWVPYnNlcnZlci5zdWJzY3JpYmUoY2hlY2tlZFZhbHVlQ29udGV4dCwgdGhpcyk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIENoZWNrZWRPYnNlcnZlci5wcm90b3R5cGUuc3luY2hyb25pemVFbGVtZW50ID0gZnVuY3Rpb24gc3luY2hyb25pemVFbGVtZW50KCkge1xuICAgIHZhciB2YWx1ZSA9IHRoaXMudmFsdWU7XG4gICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgdmFyIGVsZW1lbnRWYWx1ZSA9IGVsZW1lbnQuaGFzT3duUHJvcGVydHkoJ21vZGVsJykgPyBlbGVtZW50Lm1vZGVsIDogZWxlbWVudC52YWx1ZTtcbiAgICB2YXIgaXNSYWRpbyA9IGVsZW1lbnQudHlwZSA9PT0gJ3JhZGlvJztcbiAgICB2YXIgbWF0Y2hlciA9IGVsZW1lbnQubWF0Y2hlciB8fCBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgcmV0dXJuIGEgPT09IGI7XG4gICAgfTtcblxuICAgIGVsZW1lbnQuY2hlY2tlZCA9IGlzUmFkaW8gJiYgISFtYXRjaGVyKHZhbHVlLCBlbGVtZW50VmFsdWUpIHx8ICFpc1JhZGlvICYmIHZhbHVlID09PSB0cnVlIHx8ICFpc1JhZGlvICYmIEFycmF5LmlzQXJyYXkodmFsdWUpICYmIHZhbHVlLmZpbmRJbmRleChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgcmV0dXJuICEhbWF0Y2hlcihpdGVtLCBlbGVtZW50VmFsdWUpO1xuICAgIH0pICE9PSAtMTtcbiAgfTtcblxuICBDaGVja2VkT2JzZXJ2ZXIucHJvdG90eXBlLnN5bmNocm9uaXplVmFsdWUgPSBmdW5jdGlvbiBzeW5jaHJvbml6ZVZhbHVlKCkge1xuICAgIHZhciB2YWx1ZSA9IHRoaXMudmFsdWU7XG4gICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgdmFyIGVsZW1lbnRWYWx1ZSA9IGVsZW1lbnQuaGFzT3duUHJvcGVydHkoJ21vZGVsJykgPyBlbGVtZW50Lm1vZGVsIDogZWxlbWVudC52YWx1ZTtcbiAgICB2YXIgaW5kZXggPSB2b2lkIDA7XG4gICAgdmFyIG1hdGNoZXIgPSBlbGVtZW50Lm1hdGNoZXIgfHwgZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgIHJldHVybiBhID09PSBiO1xuICAgIH07XG5cbiAgICBpZiAoZWxlbWVudC50eXBlID09PSAnY2hlY2tib3gnKSB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgaW5kZXggPSB2YWx1ZS5maW5kSW5kZXgoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICByZXR1cm4gISFtYXRjaGVyKGl0ZW0sIGVsZW1lbnRWYWx1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoZWxlbWVudC5jaGVja2VkICYmIGluZGV4ID09PSAtMSkge1xuICAgICAgICAgIHZhbHVlLnB1c2goZWxlbWVudFZhbHVlKTtcbiAgICAgICAgfSBlbHNlIGlmICghZWxlbWVudC5jaGVja2VkICYmIGluZGV4ICE9PSAtMSkge1xuICAgICAgICAgIHZhbHVlLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhbHVlID0gZWxlbWVudC5jaGVja2VkO1xuICAgIH0gZWxzZSBpZiAoZWxlbWVudC5jaGVja2VkKSB7XG4gICAgICB2YWx1ZSA9IGVsZW1lbnRWYWx1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMub2xkVmFsdWUgPSB0aGlzLnZhbHVlO1xuICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICB0aGlzLm5vdGlmeSgpO1xuICB9O1xuXG4gIENoZWNrZWRPYnNlcnZlci5wcm90b3R5cGUubm90aWZ5ID0gZnVuY3Rpb24gbm90aWZ5KCkge1xuICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMub2xkVmFsdWU7XG4gICAgdmFyIG5ld1ZhbHVlID0gdGhpcy52YWx1ZTtcblxuICAgIHRoaXMuY2FsbFN1YnNjcmliZXJzKG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gIH07XG5cbiAgQ2hlY2tlZE9ic2VydmVyLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiBzdWJzY3JpYmUoY29udGV4dCwgY2FsbGFibGUpIHtcbiAgICBpZiAoIXRoaXMuaGFzU3Vic2NyaWJlcnMoKSkge1xuICAgICAgdGhpcy5kaXNwb3NlSGFuZGxlciA9IHRoaXMuaGFuZGxlci5zdWJzY3JpYmUodGhpcy5lbGVtZW50LCB0aGlzLnN5bmNocm9uaXplVmFsdWUuYmluZCh0aGlzLCBmYWxzZSkpO1xuICAgIH1cbiAgICB0aGlzLmFkZFN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpO1xuICB9O1xuXG4gIENoZWNrZWRPYnNlcnZlci5wcm90b3R5cGUudW5zdWJzY3JpYmUgPSBmdW5jdGlvbiB1bnN1YnNjcmliZShjb250ZXh0LCBjYWxsYWJsZSkge1xuICAgIGlmICh0aGlzLnJlbW92ZVN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpICYmICF0aGlzLmhhc1N1YnNjcmliZXJzKCkpIHtcbiAgICAgIHRoaXMuZGlzcG9zZUhhbmRsZXIoKTtcbiAgICAgIHRoaXMuZGlzcG9zZUhhbmRsZXIgPSBudWxsO1xuICAgIH1cbiAgfTtcblxuICBDaGVja2VkT2JzZXJ2ZXIucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uIHVuYmluZCgpIHtcbiAgICBpZiAodGhpcy5hcnJheU9ic2VydmVyKSB7XG4gICAgICB0aGlzLmFycmF5T2JzZXJ2ZXIudW5zdWJzY3JpYmUoY2hlY2tlZEFycmF5Q29udGV4dCwgdGhpcyk7XG4gICAgICB0aGlzLmFycmF5T2JzZXJ2ZXIgPSBudWxsO1xuICAgIH1cbiAgICBpZiAodGhpcy52YWx1ZU9ic2VydmVyKSB7XG4gICAgICB0aGlzLnZhbHVlT2JzZXJ2ZXIudW5zdWJzY3JpYmUoY2hlY2tlZFZhbHVlQ29udGV4dCwgdGhpcyk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBDaGVja2VkT2JzZXJ2ZXI7XG59KCkpIHx8IF9jbGFzczkpO1xuXG5cbnZhciBzZWxlY3RBcnJheUNvbnRleHQgPSAnU2VsZWN0VmFsdWVPYnNlcnZlcjphcnJheSc7XG5cbnZhciBTZWxlY3RWYWx1ZU9ic2VydmVyID0gZXhwb3J0cy5TZWxlY3RWYWx1ZU9ic2VydmVyID0gKF9kZWM5ID0gc3Vic2NyaWJlckNvbGxlY3Rpb24oKSwgX2RlYzkoX2NsYXNzMTAgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFNlbGVjdFZhbHVlT2JzZXJ2ZXIoZWxlbWVudCwgaGFuZGxlciwgb2JzZXJ2ZXJMb2NhdG9yKSB7XG4gICAgXG5cbiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICAgIHRoaXMuaGFuZGxlciA9IGhhbmRsZXI7XG4gICAgdGhpcy5vYnNlcnZlckxvY2F0b3IgPSBvYnNlcnZlckxvY2F0b3I7XG4gIH1cblxuICBTZWxlY3RWYWx1ZU9ic2VydmVyLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIGdldFZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLnZhbHVlO1xuICB9O1xuXG4gIFNlbGVjdFZhbHVlT2JzZXJ2ZXIucHJvdG90eXBlLnNldFZhbHVlID0gZnVuY3Rpb24gc2V0VmFsdWUobmV3VmFsdWUpIHtcbiAgICBpZiAobmV3VmFsdWUgIT09IG51bGwgJiYgbmV3VmFsdWUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLmVsZW1lbnQubXVsdGlwbGUgJiYgIUFycmF5LmlzQXJyYXkobmV3VmFsdWUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ09ubHkgbnVsbCBvciBBcnJheSBpbnN0YW5jZXMgY2FuIGJlIGJvdW5kIHRvIGEgbXVsdGktc2VsZWN0LicpO1xuICAgIH1cbiAgICBpZiAodGhpcy52YWx1ZSA9PT0gbmV3VmFsdWUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5hcnJheU9ic2VydmVyKSB7XG4gICAgICB0aGlzLmFycmF5T2JzZXJ2ZXIudW5zdWJzY3JpYmUoc2VsZWN0QXJyYXlDb250ZXh0LCB0aGlzKTtcbiAgICAgIHRoaXMuYXJyYXlPYnNlcnZlciA9IG51bGw7XG4gICAgfVxuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkobmV3VmFsdWUpKSB7XG4gICAgICB0aGlzLmFycmF5T2JzZXJ2ZXIgPSB0aGlzLm9ic2VydmVyTG9jYXRvci5nZXRBcnJheU9ic2VydmVyKG5ld1ZhbHVlKTtcbiAgICAgIHRoaXMuYXJyYXlPYnNlcnZlci5zdWJzY3JpYmUoc2VsZWN0QXJyYXlDb250ZXh0LCB0aGlzKTtcbiAgICB9XG5cbiAgICB0aGlzLm9sZFZhbHVlID0gdGhpcy52YWx1ZTtcbiAgICB0aGlzLnZhbHVlID0gbmV3VmFsdWU7XG4gICAgdGhpcy5zeW5jaHJvbml6ZU9wdGlvbnMoKTtcbiAgICB0aGlzLm5vdGlmeSgpO1xuXG4gICAgaWYgKCF0aGlzLmluaXRpYWxTeW5jKSB7XG4gICAgICB0aGlzLmluaXRpYWxTeW5jID0gdHJ1ZTtcbiAgICAgIHRoaXMub2JzZXJ2ZXJMb2NhdG9yLnRhc2tRdWV1ZS5xdWV1ZU1pY3JvVGFzayh0aGlzKTtcbiAgICB9XG4gIH07XG5cbiAgU2VsZWN0VmFsdWVPYnNlcnZlci5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uIGNhbGwoY29udGV4dCwgc3BsaWNlcykge1xuICAgIHRoaXMuc3luY2hyb25pemVPcHRpb25zKCk7XG4gIH07XG5cbiAgU2VsZWN0VmFsdWVPYnNlcnZlci5wcm90b3R5cGUuc3luY2hyb25pemVPcHRpb25zID0gZnVuY3Rpb24gc3luY2hyb25pemVPcHRpb25zKCkge1xuICAgIHZhciB2YWx1ZSA9IHRoaXMudmFsdWU7XG4gICAgdmFyIGNsZWFyID0gdm9pZCAwO1xuICAgIHZhciBpc0FycmF5ID0gdm9pZCAwO1xuXG4gICAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGNsZWFyID0gdHJ1ZTtcbiAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICBpc0FycmF5ID0gdHJ1ZTtcbiAgICB9XG5cbiAgICB2YXIgb3B0aW9ucyA9IHRoaXMuZWxlbWVudC5vcHRpb25zO1xuICAgIHZhciBpID0gb3B0aW9ucy5sZW5ndGg7XG4gICAgdmFyIG1hdGNoZXIgPSB0aGlzLmVsZW1lbnQubWF0Y2hlciB8fCBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgcmV0dXJuIGEgPT09IGI7XG4gICAgfTtcblxuICAgIHZhciBfbG9vcCA9IGZ1bmN0aW9uIF9sb29wKCkge1xuICAgICAgdmFyIG9wdGlvbiA9IG9wdGlvbnMuaXRlbShpKTtcbiAgICAgIGlmIChjbGVhcikge1xuICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuICdjb250aW51ZSc7XG4gICAgICB9XG4gICAgICB2YXIgb3B0aW9uVmFsdWUgPSBvcHRpb24uaGFzT3duUHJvcGVydHkoJ21vZGVsJykgPyBvcHRpb24ubW9kZWwgOiBvcHRpb24udmFsdWU7XG4gICAgICBpZiAoaXNBcnJheSkge1xuICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSB2YWx1ZS5maW5kSW5kZXgoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICByZXR1cm4gISFtYXRjaGVyKG9wdGlvblZhbHVlLCBpdGVtKTtcbiAgICAgICAgfSkgIT09IC0xO1xuICAgICAgICByZXR1cm4gJ2NvbnRpbnVlJztcbiAgICAgIH1cbiAgICAgIG9wdGlvbi5zZWxlY3RlZCA9ICEhbWF0Y2hlcihvcHRpb25WYWx1ZSwgdmFsdWUpO1xuICAgIH07XG5cbiAgICB3aGlsZSAoaS0tKSB7XG4gICAgICB2YXIgX3JldDIgPSBfbG9vcCgpO1xuXG4gICAgICBpZiAoX3JldDIgPT09ICdjb250aW51ZScpIGNvbnRpbnVlO1xuICAgIH1cbiAgfTtcblxuICBTZWxlY3RWYWx1ZU9ic2VydmVyLnByb3RvdHlwZS5zeW5jaHJvbml6ZVZhbHVlID0gZnVuY3Rpb24gc3luY2hyb25pemVWYWx1ZSgpIHtcbiAgICB2YXIgX3RoaXMyNCA9IHRoaXM7XG5cbiAgICB2YXIgb3B0aW9ucyA9IHRoaXMuZWxlbWVudC5vcHRpb25zO1xuICAgIHZhciBjb3VudCA9IDA7XG4gICAgdmFyIHZhbHVlID0gW107XG5cbiAgICBmb3IgKHZhciBfaTIzID0gMCwgaWkgPSBvcHRpb25zLmxlbmd0aDsgX2kyMyA8IGlpOyBfaTIzKyspIHtcbiAgICAgIHZhciBfb3B0aW9uID0gb3B0aW9ucy5pdGVtKF9pMjMpO1xuICAgICAgaWYgKCFfb3B0aW9uLnNlbGVjdGVkKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgdmFsdWUucHVzaChfb3B0aW9uLmhhc093blByb3BlcnR5KCdtb2RlbCcpID8gX29wdGlvbi5tb2RlbCA6IF9vcHRpb24udmFsdWUpO1xuICAgICAgY291bnQrKztcbiAgICB9XG5cbiAgICBpZiAodGhpcy5lbGVtZW50Lm11bHRpcGxlKSB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLnZhbHVlKSkge1xuICAgICAgICB2YXIgX3JldDMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIG1hdGNoZXIgPSBfdGhpczI0LmVsZW1lbnQubWF0Y2hlciB8fCBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgcmV0dXJuIGEgPT09IGI7XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIHZhciBpID0gMDtcblxuICAgICAgICAgIHZhciBfbG9vcDIgPSBmdW5jdGlvbiBfbG9vcDIoKSB7XG4gICAgICAgICAgICB2YXIgYSA9IF90aGlzMjQudmFsdWVbaV07XG4gICAgICAgICAgICBpZiAodmFsdWUuZmluZEluZGV4KGZ1bmN0aW9uIChiKSB7XG4gICAgICAgICAgICAgIHJldHVybiBtYXRjaGVyKGEsIGIpO1xuICAgICAgICAgICAgfSkgPT09IC0xKSB7XG4gICAgICAgICAgICAgIF90aGlzMjQudmFsdWUuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG5cbiAgICAgICAgICB3aGlsZSAoaSA8IF90aGlzMjQudmFsdWUubGVuZ3RoKSB7XG4gICAgICAgICAgICBfbG9vcDIoKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpID0gMDtcblxuICAgICAgICAgIHZhciBfbG9vcDMgPSBmdW5jdGlvbiBfbG9vcDMoKSB7XG4gICAgICAgICAgICB2YXIgYSA9IHZhbHVlW2ldO1xuICAgICAgICAgICAgaWYgKF90aGlzMjQudmFsdWUuZmluZEluZGV4KGZ1bmN0aW9uIChiKSB7XG4gICAgICAgICAgICAgIHJldHVybiBtYXRjaGVyKGEsIGIpO1xuICAgICAgICAgICAgfSkgPT09IC0xKSB7XG4gICAgICAgICAgICAgIF90aGlzMjQudmFsdWUucHVzaChhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGkrKztcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgd2hpbGUgKGkgPCB2YWx1ZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIF9sb29wMygpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdjogdm9pZCAwXG4gICAgICAgICAgfTtcbiAgICAgICAgfSgpO1xuXG4gICAgICAgIGlmICgodHlwZW9mIF9yZXQzID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihfcmV0MykpID09PSBcIm9iamVjdFwiKSByZXR1cm4gX3JldDMudjtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoY291bnQgPT09IDApIHtcbiAgICAgICAgICB2YWx1ZSA9IG51bGw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFsdWUgPSB2YWx1ZVswXTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgaWYgKHZhbHVlICE9PSB0aGlzLnZhbHVlKSB7XG4gICAgICB0aGlzLm9sZFZhbHVlID0gdGhpcy52YWx1ZTtcbiAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICAgIHRoaXMubm90aWZ5KCk7XG4gICAgfVxuICB9O1xuXG4gIFNlbGVjdFZhbHVlT2JzZXJ2ZXIucHJvdG90eXBlLm5vdGlmeSA9IGZ1bmN0aW9uIG5vdGlmeSgpIHtcbiAgICB2YXIgb2xkVmFsdWUgPSB0aGlzLm9sZFZhbHVlO1xuICAgIHZhciBuZXdWYWx1ZSA9IHRoaXMudmFsdWU7XG5cbiAgICB0aGlzLmNhbGxTdWJzY3JpYmVycyhuZXdWYWx1ZSwgb2xkVmFsdWUpO1xuICB9O1xuXG4gIFNlbGVjdFZhbHVlT2JzZXJ2ZXIucHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uIHN1YnNjcmliZShjb250ZXh0LCBjYWxsYWJsZSkge1xuICAgIGlmICghdGhpcy5oYXNTdWJzY3JpYmVycygpKSB7XG4gICAgICB0aGlzLmRpc3Bvc2VIYW5kbGVyID0gdGhpcy5oYW5kbGVyLnN1YnNjcmliZSh0aGlzLmVsZW1lbnQsIHRoaXMuc3luY2hyb25pemVWYWx1ZS5iaW5kKHRoaXMsIGZhbHNlKSk7XG4gICAgfVxuICAgIHRoaXMuYWRkU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSk7XG4gIH07XG5cbiAgU2VsZWN0VmFsdWVPYnNlcnZlci5wcm90b3R5cGUudW5zdWJzY3JpYmUgPSBmdW5jdGlvbiB1bnN1YnNjcmliZShjb250ZXh0LCBjYWxsYWJsZSkge1xuICAgIGlmICh0aGlzLnJlbW92ZVN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpICYmICF0aGlzLmhhc1N1YnNjcmliZXJzKCkpIHtcbiAgICAgIHRoaXMuZGlzcG9zZUhhbmRsZXIoKTtcbiAgICAgIHRoaXMuZGlzcG9zZUhhbmRsZXIgPSBudWxsO1xuICAgIH1cbiAgfTtcblxuICBTZWxlY3RWYWx1ZU9ic2VydmVyLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZCgpIHtcbiAgICB2YXIgX3RoaXMyNSA9IHRoaXM7XG5cbiAgICB0aGlzLmRvbU9ic2VydmVyID0gX2F1cmVsaWFQYWwuRE9NLmNyZWF0ZU11dGF0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24gKCkge1xuICAgICAgX3RoaXMyNS5zeW5jaHJvbml6ZU9wdGlvbnMoKTtcbiAgICAgIF90aGlzMjUuc3luY2hyb25pemVWYWx1ZSgpO1xuICAgIH0pO1xuICAgIHRoaXMuZG9tT2JzZXJ2ZXIub2JzZXJ2ZSh0aGlzLmVsZW1lbnQsIHsgY2hpbGRMaXN0OiB0cnVlLCBzdWJ0cmVlOiB0cnVlIH0pO1xuICB9O1xuXG4gIFNlbGVjdFZhbHVlT2JzZXJ2ZXIucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uIHVuYmluZCgpIHtcbiAgICB0aGlzLmRvbU9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICB0aGlzLmRvbU9ic2VydmVyID0gbnVsbDtcblxuICAgIGlmICh0aGlzLmFycmF5T2JzZXJ2ZXIpIHtcbiAgICAgIHRoaXMuYXJyYXlPYnNlcnZlci51bnN1YnNjcmliZShzZWxlY3RBcnJheUNvbnRleHQsIHRoaXMpO1xuICAgICAgdGhpcy5hcnJheU9ic2VydmVyID0gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIFNlbGVjdFZhbHVlT2JzZXJ2ZXI7XG59KCkpIHx8IF9jbGFzczEwKTtcblxudmFyIENsYXNzT2JzZXJ2ZXIgPSBleHBvcnRzLkNsYXNzT2JzZXJ2ZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIENsYXNzT2JzZXJ2ZXIoZWxlbWVudCkge1xuICAgIFxuXG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICB0aGlzLmRvTm90Q2FjaGUgPSB0cnVlO1xuICAgIHRoaXMudmFsdWUgPSAnJztcbiAgICB0aGlzLnZlcnNpb24gPSAwO1xuICB9XG5cbiAgQ2xhc3NPYnNlcnZlci5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiBnZXRWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy52YWx1ZTtcbiAgfTtcblxuICBDbGFzc09ic2VydmVyLnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uIHNldFZhbHVlKG5ld1ZhbHVlKSB7XG4gICAgdmFyIG5hbWVJbmRleCA9IHRoaXMubmFtZUluZGV4IHx8IHt9O1xuICAgIHZhciB2ZXJzaW9uID0gdGhpcy52ZXJzaW9uO1xuICAgIHZhciBuYW1lcyA9IHZvaWQgMDtcbiAgICB2YXIgbmFtZSA9IHZvaWQgMDtcblxuICAgIGlmIChuZXdWYWx1ZSAhPT0gbnVsbCAmJiBuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlLmxlbmd0aCkge1xuICAgICAgbmFtZXMgPSBuZXdWYWx1ZS5zcGxpdCgvXFxzKy8pO1xuICAgICAgZm9yICh2YXIgX2kyNCA9IDAsIGxlbmd0aCA9IG5hbWVzLmxlbmd0aDsgX2kyNCA8IGxlbmd0aDsgX2kyNCsrKSB7XG4gICAgICAgIG5hbWUgPSBuYW1lc1tfaTI0XTtcbiAgICAgICAgaWYgKG5hbWUgPT09ICcnKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgbmFtZUluZGV4W25hbWVdID0gdmVyc2lvbjtcbiAgICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQobmFtZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy52YWx1ZSA9IG5ld1ZhbHVlO1xuICAgIHRoaXMubmFtZUluZGV4ID0gbmFtZUluZGV4O1xuICAgIHRoaXMudmVyc2lvbiArPSAxO1xuXG4gICAgaWYgKHZlcnNpb24gPT09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2ZXJzaW9uIC09IDE7XG4gICAgZm9yIChuYW1lIGluIG5hbWVJbmRleCkge1xuICAgICAgaWYgKCFuYW1lSW5kZXguaGFzT3duUHJvcGVydHkobmFtZSkgfHwgbmFtZUluZGV4W25hbWVdICE9PSB2ZXJzaW9uKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUobmFtZSk7XG4gICAgfVxuICB9O1xuXG4gIENsYXNzT2JzZXJ2ZXIucHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uIHN1YnNjcmliZSgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ09ic2VydmF0aW9uIG9mIGEgXCInICsgdGhpcy5lbGVtZW50Lm5vZGVOYW1lICsgJ1wiIGVsZW1lbnRcXCdzIFwiY2xhc3NcIiBwcm9wZXJ0eSBpcyBub3Qgc3VwcG9ydGVkLicpO1xuICB9O1xuXG4gIHJldHVybiBDbGFzc09ic2VydmVyO1xufSgpO1xuXG5mdW5jdGlvbiBoYXNEZWNsYXJlZERlcGVuZGVuY2llcyhkZXNjcmlwdG9yKSB7XG4gIHJldHVybiAhIShkZXNjcmlwdG9yICYmIGRlc2NyaXB0b3IuZ2V0ICYmIGRlc2NyaXB0b3IuZ2V0LmRlcGVuZGVuY2llcyk7XG59XG5cbmZ1bmN0aW9uIGRlY2xhcmVQcm9wZXJ0eURlcGVuZGVuY2llcyhjdG9yLCBwcm9wZXJ0eU5hbWUsIGRlcGVuZGVuY2llcykge1xuICB2YXIgZGVzY3JpcHRvciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoY3Rvci5wcm90b3R5cGUsIHByb3BlcnR5TmFtZSk7XG4gIGRlc2NyaXB0b3IuZ2V0LmRlcGVuZGVuY2llcyA9IGRlcGVuZGVuY2llcztcbn1cblxuZnVuY3Rpb24gY29tcHV0ZWRGcm9tKCkge1xuICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgcmVzdCA9IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykge1xuICAgIHJlc3RbX2tleV0gPSBhcmd1bWVudHNbX2tleV07XG4gIH1cblxuICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5LCBkZXNjcmlwdG9yKSB7XG4gICAgZGVzY3JpcHRvci5nZXQuZGVwZW5kZW5jaWVzID0gcmVzdDtcbiAgICByZXR1cm4gZGVzY3JpcHRvcjtcbiAgfTtcbn1cblxudmFyIENvbXB1dGVkRXhwcmVzc2lvbiA9IGV4cG9ydHMuQ29tcHV0ZWRFeHByZXNzaW9uID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uMTkpIHtcbiAgX2luaGVyaXRzKENvbXB1dGVkRXhwcmVzc2lvbiwgX0V4cHJlc3Npb24xOSk7XG5cbiAgZnVuY3Rpb24gQ29tcHV0ZWRFeHByZXNzaW9uKG5hbWUsIGRlcGVuZGVuY2llcykge1xuICAgIFxuXG4gICAgdmFyIF90aGlzMjYgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfRXhwcmVzc2lvbjE5LmNhbGwodGhpcykpO1xuXG4gICAgX3RoaXMyNi5uYW1lID0gbmFtZTtcbiAgICBfdGhpczI2LmRlcGVuZGVuY2llcyA9IGRlcGVuZGVuY2llcztcbiAgICBfdGhpczI2LmlzQXNzaWduYWJsZSA9IHRydWU7XG4gICAgcmV0dXJuIF90aGlzMjY7XG4gIH1cblxuICBDb21wdXRlZEV4cHJlc3Npb24ucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHJldHVybiBzY29wZS5iaW5kaW5nQ29udGV4dFt0aGlzLm5hbWVdO1xuICB9O1xuXG4gIENvbXB1dGVkRXhwcmVzc2lvbi5wcm90b3R5cGUuYXNzaWduID0gZnVuY3Rpb24gYXNzaWduKHNjb3BlLCB2YWx1ZSkge1xuICAgIHNjb3BlLmJpbmRpbmdDb250ZXh0W3RoaXMubmFtZV0gPSB2YWx1ZTtcbiAgfTtcblxuICBDb21wdXRlZEV4cHJlc3Npb24ucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uIGFjY2VwdCh2aXNpdG9yKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdub3QgaW1wbGVtZW50ZWQnKTtcbiAgfTtcblxuICBDb21wdXRlZEV4cHJlc3Npb24ucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KGJpbmRpbmcsIHNjb3BlKSB7XG4gICAgdmFyIGRlcGVuZGVuY2llcyA9IHRoaXMuZGVwZW5kZW5jaWVzO1xuICAgIHZhciBpID0gZGVwZW5kZW5jaWVzLmxlbmd0aDtcbiAgICB3aGlsZSAoaS0tKSB7XG4gICAgICBkZXBlbmRlbmNpZXNbaV0uY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBDb21wdXRlZEV4cHJlc3Npb247XG59KEV4cHJlc3Npb24pO1xuXG5mdW5jdGlvbiBjcmVhdGVDb21wdXRlZE9ic2VydmVyKG9iaiwgcHJvcGVydHlOYW1lLCBkZXNjcmlwdG9yLCBvYnNlcnZlckxvY2F0b3IpIHtcbiAgdmFyIGRlcGVuZGVuY2llcyA9IGRlc2NyaXB0b3IuZ2V0LmRlcGVuZGVuY2llcztcbiAgaWYgKCEoZGVwZW5kZW5jaWVzIGluc3RhbmNlb2YgQ29tcHV0ZWRFeHByZXNzaW9uKSkge1xuICAgIHZhciBfaTI1ID0gZGVwZW5kZW5jaWVzLmxlbmd0aDtcbiAgICB3aGlsZSAoX2kyNS0tKSB7XG4gICAgICBkZXBlbmRlbmNpZXNbX2kyNV0gPSBvYnNlcnZlckxvY2F0b3IucGFyc2VyLnBhcnNlKGRlcGVuZGVuY2llc1tfaTI1XSk7XG4gICAgfVxuICAgIGRlcGVuZGVuY2llcyA9IGRlc2NyaXB0b3IuZ2V0LmRlcGVuZGVuY2llcyA9IG5ldyBDb21wdXRlZEV4cHJlc3Npb24ocHJvcGVydHlOYW1lLCBkZXBlbmRlbmNpZXMpO1xuICB9XG5cbiAgdmFyIHNjb3BlID0geyBiaW5kaW5nQ29udGV4dDogb2JqLCBvdmVycmlkZUNvbnRleHQ6IGNyZWF0ZU92ZXJyaWRlQ29udGV4dChvYmopIH07XG4gIHJldHVybiBuZXcgRXhwcmVzc2lvbk9ic2VydmVyKHNjb3BlLCBkZXBlbmRlbmNpZXMsIG9ic2VydmVyTG9jYXRvcik7XG59XG5cbnZhciBlbGVtZW50cyA9IGV4cG9ydHMuZWxlbWVudHMgPSB7XG4gIGE6IFsnY2xhc3MnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25mb2N1c2luJywgJ29uZm9jdXNvdXQnLCAnb25sb2FkJywgJ29ubW91c2Vkb3duJywgJ29ubW91c2Vtb3ZlJywgJ29ubW91c2VvdXQnLCAnb25tb3VzZW92ZXInLCAnb25tb3VzZXVwJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RhcmdldCcsICd0cmFuc2Zvcm0nLCAneGxpbms6YWN0dWF0ZScsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazpzaG93JywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gIGFsdEdseXBoOiBbJ2NsYXNzJywgJ2R4JywgJ2R5JywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnZm9ybWF0JywgJ2dseXBoUmVmJywgJ2lkJywgJ29uYWN0aXZhdGUnLCAnb25jbGljaycsICdvbmZvY3VzaW4nLCAnb25mb2N1c291dCcsICdvbmxvYWQnLCAnb25tb3VzZWRvd24nLCAnb25tb3VzZW1vdmUnLCAnb25tb3VzZW91dCcsICdvbm1vdXNlb3ZlcicsICdvbm1vdXNldXAnLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAncm90YXRlJywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3gnLCAneGxpbms6YWN0dWF0ZScsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazpzaG93JywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgYWx0R2x5cGhEZWY6IFsnaWQnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gIGFsdEdseXBoSXRlbTogWydpZCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgYW5pbWF0ZTogWydhY2N1bXVsYXRlJywgJ2FkZGl0aXZlJywgJ2F0dHJpYnV0ZU5hbWUnLCAnYXR0cmlidXRlVHlwZScsICdiZWdpbicsICdieScsICdjYWxjTW9kZScsICdkdXInLCAnZW5kJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnZmlsbCcsICdmcm9tJywgJ2lkJywgJ2tleVNwbGluZXMnLCAna2V5VGltZXMnLCAnbWF4JywgJ21pbicsICdvbmJlZ2luJywgJ29uZW5kJywgJ29ubG9hZCcsICdvbnJlcGVhdCcsICdyZXBlYXRDb3VudCcsICdyZXBlYXREdXInLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAncmVzdGFydCcsICdzeXN0ZW1MYW5ndWFnZScsICd0bycsICd2YWx1ZXMnLCAneGxpbms6YWN0dWF0ZScsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazpzaG93JywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gIGFuaW1hdGVDb2xvcjogWydhY2N1bXVsYXRlJywgJ2FkZGl0aXZlJywgJ2F0dHJpYnV0ZU5hbWUnLCAnYXR0cmlidXRlVHlwZScsICdiZWdpbicsICdieScsICdjYWxjTW9kZScsICdkdXInLCAnZW5kJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnZmlsbCcsICdmcm9tJywgJ2lkJywgJ2tleVNwbGluZXMnLCAna2V5VGltZXMnLCAnbWF4JywgJ21pbicsICdvbmJlZ2luJywgJ29uZW5kJywgJ29ubG9hZCcsICdvbnJlcGVhdCcsICdyZXBlYXRDb3VudCcsICdyZXBlYXREdXInLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAncmVzdGFydCcsICdzeXN0ZW1MYW5ndWFnZScsICd0bycsICd2YWx1ZXMnLCAneGxpbms6YWN0dWF0ZScsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazpzaG93JywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gIGFuaW1hdGVNb3Rpb246IFsnYWNjdW11bGF0ZScsICdhZGRpdGl2ZScsICdiZWdpbicsICdieScsICdjYWxjTW9kZScsICdkdXInLCAnZW5kJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnZmlsbCcsICdmcm9tJywgJ2lkJywgJ2tleVBvaW50cycsICdrZXlTcGxpbmVzJywgJ2tleVRpbWVzJywgJ21heCcsICdtaW4nLCAnb25iZWdpbicsICdvbmVuZCcsICdvbmxvYWQnLCAnb25yZXBlYXQnLCAnb3JpZ2luJywgJ3BhdGgnLCAncmVwZWF0Q291bnQnLCAncmVwZWF0RHVyJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3Jlc3RhcnQnLCAncm90YXRlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RvJywgJ3ZhbHVlcycsICd4bGluazphY3R1YXRlJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnNob3cnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgYW5pbWF0ZVRyYW5zZm9ybTogWydhY2N1bXVsYXRlJywgJ2FkZGl0aXZlJywgJ2F0dHJpYnV0ZU5hbWUnLCAnYXR0cmlidXRlVHlwZScsICdiZWdpbicsICdieScsICdjYWxjTW9kZScsICdkdXInLCAnZW5kJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnZmlsbCcsICdmcm9tJywgJ2lkJywgJ2tleVNwbGluZXMnLCAna2V5VGltZXMnLCAnbWF4JywgJ21pbicsICdvbmJlZ2luJywgJ29uZW5kJywgJ29ubG9hZCcsICdvbnJlcGVhdCcsICdyZXBlYXRDb3VudCcsICdyZXBlYXREdXInLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAncmVzdGFydCcsICdzeXN0ZW1MYW5ndWFnZScsICd0bycsICd0eXBlJywgJ3ZhbHVlcycsICd4bGluazphY3R1YXRlJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnNob3cnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgY2lyY2xlOiBbJ2NsYXNzJywgJ2N4JywgJ2N5JywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdyJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RyYW5zZm9ybScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgY2xpcFBhdGg6IFsnY2xhc3MnLCAnY2xpcFBhdGhVbml0cycsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2lkJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RyYW5zZm9ybScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgJ2NvbG9yLXByb2ZpbGUnOiBbJ2lkJywgJ2xvY2FsJywgJ25hbWUnLCAncmVuZGVyaW5nLWludGVudCcsICd4bGluazphY3R1YXRlJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnNob3cnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgY3Vyc29yOiBbJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAneCcsICd4bGluazphY3R1YXRlJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnNob3cnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICBkZWZzOiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd0cmFuc2Zvcm0nLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gIGRlc2M6IFsnY2xhc3MnLCAnaWQnLCAnc3R5bGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gIGVsbGlwc2U6IFsnY2xhc3MnLCAnY3gnLCAnY3knLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25mb2N1c2luJywgJ29uZm9jdXNvdXQnLCAnb25sb2FkJywgJ29ubW91c2Vkb3duJywgJ29ubW91c2Vtb3ZlJywgJ29ubW91c2VvdXQnLCAnb25tb3VzZW92ZXInLCAnb25tb3VzZXVwJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3J4JywgJ3J5JywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RyYW5zZm9ybScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgZmVCbGVuZDogWydjbGFzcycsICdoZWlnaHQnLCAnaWQnLCAnaW4nLCAnaW4yJywgJ21vZGUnLCAncmVzdWx0JywgJ3N0eWxlJywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgZmVDb2xvck1hdHJpeDogWydjbGFzcycsICdoZWlnaHQnLCAnaWQnLCAnaW4nLCAncmVzdWx0JywgJ3N0eWxlJywgJ3R5cGUnLCAndmFsdWVzJywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgZmVDb21wb25lbnRUcmFuc2ZlcjogWydjbGFzcycsICdoZWlnaHQnLCAnaWQnLCAnaW4nLCAncmVzdWx0JywgJ3N0eWxlJywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgZmVDb21wb3NpdGU6IFsnY2xhc3MnLCAnaGVpZ2h0JywgJ2lkJywgJ2luJywgJ2luMicsICdrMScsICdrMicsICdrMycsICdrNCcsICdvcGVyYXRvcicsICdyZXN1bHQnLCAnc3R5bGUnLCAnd2lkdGgnLCAneCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICBmZUNvbnZvbHZlTWF0cml4OiBbJ2JpYXMnLCAnY2xhc3MnLCAnZGl2aXNvcicsICdlZGdlTW9kZScsICdoZWlnaHQnLCAnaWQnLCAnaW4nLCAna2VybmVsTWF0cml4JywgJ2tlcm5lbFVuaXRMZW5ndGgnLCAnb3JkZXInLCAncHJlc2VydmVBbHBoYScsICdyZXN1bHQnLCAnc3R5bGUnLCAndGFyZ2V0WCcsICd0YXJnZXRZJywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgZmVEaWZmdXNlTGlnaHRpbmc6IFsnY2xhc3MnLCAnZGlmZnVzZUNvbnN0YW50JywgJ2hlaWdodCcsICdpZCcsICdpbicsICdrZXJuZWxVbml0TGVuZ3RoJywgJ3Jlc3VsdCcsICdzdHlsZScsICdzdXJmYWNlU2NhbGUnLCAnd2lkdGgnLCAneCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICBmZURpc3BsYWNlbWVudE1hcDogWydjbGFzcycsICdoZWlnaHQnLCAnaWQnLCAnaW4nLCAnaW4yJywgJ3Jlc3VsdCcsICdzY2FsZScsICdzdHlsZScsICd3aWR0aCcsICd4JywgJ3hDaGFubmVsU2VsZWN0b3InLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knLCAneUNoYW5uZWxTZWxlY3RvciddLFxuICBmZURpc3RhbnRMaWdodDogWydhemltdXRoJywgJ2VsZXZhdGlvbicsICdpZCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgZmVGbG9vZDogWydjbGFzcycsICdoZWlnaHQnLCAnaWQnLCAncmVzdWx0JywgJ3N0eWxlJywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgZmVGdW5jQTogWydhbXBsaXR1ZGUnLCAnZXhwb25lbnQnLCAnaWQnLCAnaW50ZXJjZXB0JywgJ29mZnNldCcsICdzbG9wZScsICd0YWJsZVZhbHVlcycsICd0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICBmZUZ1bmNCOiBbJ2FtcGxpdHVkZScsICdleHBvbmVudCcsICdpZCcsICdpbnRlcmNlcHQnLCAnb2Zmc2V0JywgJ3Nsb3BlJywgJ3RhYmxlVmFsdWVzJywgJ3R5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gIGZlRnVuY0c6IFsnYW1wbGl0dWRlJywgJ2V4cG9uZW50JywgJ2lkJywgJ2ludGVyY2VwdCcsICdvZmZzZXQnLCAnc2xvcGUnLCAndGFibGVWYWx1ZXMnLCAndHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgZmVGdW5jUjogWydhbXBsaXR1ZGUnLCAnZXhwb25lbnQnLCAnaWQnLCAnaW50ZXJjZXB0JywgJ29mZnNldCcsICdzbG9wZScsICd0YWJsZVZhbHVlcycsICd0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICBmZUdhdXNzaWFuQmx1cjogWydjbGFzcycsICdoZWlnaHQnLCAnaWQnLCAnaW4nLCAncmVzdWx0JywgJ3N0ZERldmlhdGlvbicsICdzdHlsZScsICd3aWR0aCcsICd4JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gIGZlSW1hZ2U6IFsnY2xhc3MnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdoZWlnaHQnLCAnaWQnLCAncHJlc2VydmVBc3BlY3RSYXRpbycsICdyZXN1bHQnLCAnc3R5bGUnLCAnd2lkdGgnLCAneCcsICd4bGluazphY3R1YXRlJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnNob3cnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICBmZU1lcmdlOiBbJ2NsYXNzJywgJ2hlaWdodCcsICdpZCcsICdyZXN1bHQnLCAnc3R5bGUnLCAnd2lkdGgnLCAneCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICBmZU1lcmdlTm9kZTogWydpZCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgZmVNb3JwaG9sb2d5OiBbJ2NsYXNzJywgJ2hlaWdodCcsICdpZCcsICdpbicsICdvcGVyYXRvcicsICdyYWRpdXMnLCAncmVzdWx0JywgJ3N0eWxlJywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgZmVPZmZzZXQ6IFsnY2xhc3MnLCAnZHgnLCAnZHknLCAnaGVpZ2h0JywgJ2lkJywgJ2luJywgJ3Jlc3VsdCcsICdzdHlsZScsICd3aWR0aCcsICd4JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gIGZlUG9pbnRMaWdodDogWydpZCcsICd4JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5JywgJ3onXSxcbiAgZmVTcGVjdWxhckxpZ2h0aW5nOiBbJ2NsYXNzJywgJ2hlaWdodCcsICdpZCcsICdpbicsICdrZXJuZWxVbml0TGVuZ3RoJywgJ3Jlc3VsdCcsICdzcGVjdWxhckNvbnN0YW50JywgJ3NwZWN1bGFyRXhwb25lbnQnLCAnc3R5bGUnLCAnc3VyZmFjZVNjYWxlJywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgZmVTcG90TGlnaHQ6IFsnaWQnLCAnbGltaXRpbmdDb25lQW5nbGUnLCAncG9pbnRzQXRYJywgJ3BvaW50c0F0WScsICdwb2ludHNBdFonLCAnc3BlY3VsYXJFeHBvbmVudCcsICd4JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5JywgJ3onXSxcbiAgZmVUaWxlOiBbJ2NsYXNzJywgJ2hlaWdodCcsICdpZCcsICdpbicsICdyZXN1bHQnLCAnc3R5bGUnLCAnd2lkdGgnLCAneCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICBmZVR1cmJ1bGVuY2U6IFsnYmFzZUZyZXF1ZW5jeScsICdjbGFzcycsICdoZWlnaHQnLCAnaWQnLCAnbnVtT2N0YXZlcycsICdyZXN1bHQnLCAnc2VlZCcsICdzdGl0Y2hUaWxlcycsICdzdHlsZScsICd0eXBlJywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgZmlsdGVyOiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnZmlsdGVyUmVzJywgJ2ZpbHRlclVuaXRzJywgJ2hlaWdodCcsICdpZCcsICdwcmltaXRpdmVVbml0cycsICdzdHlsZScsICd3aWR0aCcsICd4JywgJ3hsaW5rOmFjdHVhdGUnLCAneGxpbms6YXJjcm9sZScsICd4bGluazpocmVmJywgJ3hsaW5rOnJvbGUnLCAneGxpbms6c2hvdycsICd4bGluazp0aXRsZScsICd4bGluazp0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gIGZvbnQ6IFsnY2xhc3MnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdob3Jpei1hZHYteCcsICdob3Jpei1vcmlnaW4teCcsICdob3Jpei1vcmlnaW4teScsICdpZCcsICdzdHlsZScsICd2ZXJ0LWFkdi15JywgJ3ZlcnQtb3JpZ2luLXgnLCAndmVydC1vcmlnaW4teScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgJ2ZvbnQtZmFjZSc6IFsnYWNjZW50LWhlaWdodCcsICdhbHBoYWJldGljJywgJ2FzY2VudCcsICdiYm94JywgJ2NhcC1oZWlnaHQnLCAnZGVzY2VudCcsICdmb250LWZhbWlseScsICdmb250LXNpemUnLCAnZm9udC1zdHJldGNoJywgJ2ZvbnQtc3R5bGUnLCAnZm9udC12YXJpYW50JywgJ2ZvbnQtd2VpZ2h0JywgJ2hhbmdpbmcnLCAnaWQnLCAnaWRlb2dyYXBoaWMnLCAnbWF0aGVtYXRpY2FsJywgJ292ZXJsaW5lLXBvc2l0aW9uJywgJ292ZXJsaW5lLXRoaWNrbmVzcycsICdwYW5vc2UtMScsICdzbG9wZScsICdzdGVtaCcsICdzdGVtdicsICdzdHJpa2V0aHJvdWdoLXBvc2l0aW9uJywgJ3N0cmlrZXRocm91Z2gtdGhpY2tuZXNzJywgJ3VuZGVybGluZS1wb3NpdGlvbicsICd1bmRlcmxpbmUtdGhpY2tuZXNzJywgJ3VuaWNvZGUtcmFuZ2UnLCAndW5pdHMtcGVyLWVtJywgJ3YtYWxwaGFiZXRpYycsICd2LWhhbmdpbmcnLCAndi1pZGVvZ3JhcGhpYycsICd2LW1hdGhlbWF0aWNhbCcsICd3aWR0aHMnLCAneC1oZWlnaHQnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICdmb250LWZhY2UtZm9ybWF0JzogWydpZCcsICdzdHJpbmcnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICdmb250LWZhY2UtbmFtZSc6IFsnaWQnLCAnbmFtZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgJ2ZvbnQtZmFjZS1zcmMnOiBbJ2lkJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAnZm9udC1mYWNlLXVyaSc6IFsnaWQnLCAneGxpbms6YWN0dWF0ZScsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazpzaG93JywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gIGZvcmVpZ25PYmplY3Q6IFsnY2xhc3MnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdoZWlnaHQnLCAnaWQnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd0cmFuc2Zvcm0nLCAnd2lkdGgnLCAneCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICBnOiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd0cmFuc2Zvcm0nLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gIGdseXBoOiBbJ2FyYWJpYy1mb3JtJywgJ2NsYXNzJywgJ2QnLCAnZ2x5cGgtbmFtZScsICdob3Jpei1hZHYteCcsICdpZCcsICdsYW5nJywgJ29yaWVudGF0aW9uJywgJ3N0eWxlJywgJ3VuaWNvZGUnLCAndmVydC1hZHYteScsICd2ZXJ0LW9yaWdpbi14JywgJ3ZlcnQtb3JpZ2luLXknLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gIGdseXBoUmVmOiBbJ2NsYXNzJywgJ2R4JywgJ2R5JywgJ2Zvcm1hdCcsICdnbHlwaFJlZicsICdpZCcsICdzdHlsZScsICd4JywgJ3hsaW5rOmFjdHVhdGUnLCAneGxpbms6YXJjcm9sZScsICd4bGluazpocmVmJywgJ3hsaW5rOnJvbGUnLCAneGxpbms6c2hvdycsICd4bGluazp0aXRsZScsICd4bGluazp0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gIGhrZXJuOiBbJ2cxJywgJ2cyJywgJ2lkJywgJ2snLCAndTEnLCAndTInLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gIGltYWdlOiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaGVpZ2h0JywgJ2lkJywgJ29uYWN0aXZhdGUnLCAnb25jbGljaycsICdvbmZvY3VzaW4nLCAnb25mb2N1c291dCcsICdvbmxvYWQnLCAnb25tb3VzZWRvd24nLCAnb25tb3VzZW1vdmUnLCAnb25tb3VzZW91dCcsICdvbm1vdXNlb3ZlcicsICdvbm1vdXNldXAnLCAncHJlc2VydmVBc3BlY3RSYXRpbycsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd0cmFuc2Zvcm0nLCAnd2lkdGgnLCAneCcsICd4bGluazphY3R1YXRlJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnNob3cnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICBsaW5lOiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd0cmFuc2Zvcm0nLCAneDEnLCAneDInLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3kxJywgJ3kyJ10sXG4gIGxpbmVhckdyYWRpZW50OiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnZ3JhZGllbnRUcmFuc2Zvcm0nLCAnZ3JhZGllbnRVbml0cycsICdpZCcsICdzcHJlYWRNZXRob2QnLCAnc3R5bGUnLCAneDEnLCAneDInLCAneGxpbms6YXJjcm9sZScsICd4bGluazpocmVmJywgJ3hsaW5rOnJvbGUnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneTEnLCAneTInXSxcbiAgbWFya2VyOiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAnbWFya2VySGVpZ2h0JywgJ21hcmtlclVuaXRzJywgJ21hcmtlcldpZHRoJywgJ29yaWVudCcsICdwcmVzZXJ2ZUFzcGVjdFJhdGlvJywgJ3JlZlgnLCAncmVmWScsICdzdHlsZScsICd2aWV3Qm94JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICBtYXNrOiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaGVpZ2h0JywgJ2lkJywgJ21hc2tDb250ZW50VW5pdHMnLCAnbWFza1VuaXRzJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgbWV0YWRhdGE6IFsnaWQnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICdtaXNzaW5nLWdseXBoJzogWydjbGFzcycsICdkJywgJ2hvcml6LWFkdi14JywgJ2lkJywgJ3N0eWxlJywgJ3ZlcnQtYWR2LXknLCAndmVydC1vcmlnaW4teCcsICd2ZXJ0LW9yaWdpbi15JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICBtcGF0aDogWydleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2lkJywgJ3hsaW5rOmFjdHVhdGUnLCAneGxpbms6YXJjcm9sZScsICd4bGluazpocmVmJywgJ3hsaW5rOnJvbGUnLCAneGxpbms6c2hvdycsICd4bGluazp0aXRsZScsICd4bGluazp0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICBwYXRoOiBbJ2NsYXNzJywgJ2QnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25mb2N1c2luJywgJ29uZm9jdXNvdXQnLCAnb25sb2FkJywgJ29ubW91c2Vkb3duJywgJ29ubW91c2Vtb3ZlJywgJ29ubW91c2VvdXQnLCAnb25tb3VzZW92ZXInLCAnb25tb3VzZXVwJywgJ3BhdGhMZW5ndGgnLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAnc3R5bGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndHJhbnNmb3JtJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICBwYXR0ZXJuOiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaGVpZ2h0JywgJ2lkJywgJ3BhdHRlcm5Db250ZW50VW5pdHMnLCAncGF0dGVyblRyYW5zZm9ybScsICdwYXR0ZXJuVW5pdHMnLCAncHJlc2VydmVBc3BlY3RSYXRpbycsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd2aWV3Qm94JywgJ3dpZHRoJywgJ3gnLCAneGxpbms6YWN0dWF0ZScsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazpzaG93JywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgcG9seWdvbjogWydjbGFzcycsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2lkJywgJ29uYWN0aXZhdGUnLCAnb25jbGljaycsICdvbmZvY3VzaW4nLCAnb25mb2N1c291dCcsICdvbmxvYWQnLCAnb25tb3VzZWRvd24nLCAnb25tb3VzZW1vdmUnLCAnb25tb3VzZW91dCcsICdvbm1vdXNlb3ZlcicsICdvbm1vdXNldXAnLCAncG9pbnRzJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RyYW5zZm9ybScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgcG9seWxpbmU6IFsnY2xhc3MnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25mb2N1c2luJywgJ29uZm9jdXNvdXQnLCAnb25sb2FkJywgJ29ubW91c2Vkb3duJywgJ29ubW91c2Vtb3ZlJywgJ29ubW91c2VvdXQnLCAnb25tb3VzZW92ZXInLCAnb25tb3VzZXVwJywgJ3BvaW50cycsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd0cmFuc2Zvcm0nLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gIHJhZGlhbEdyYWRpZW50OiBbJ2NsYXNzJywgJ2N4JywgJ2N5JywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnZngnLCAnZnknLCAnZ3JhZGllbnRUcmFuc2Zvcm0nLCAnZ3JhZGllbnRVbml0cycsICdpZCcsICdyJywgJ3NwcmVhZE1ldGhvZCcsICdzdHlsZScsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazp0aXRsZScsICd4bGluazp0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICByZWN0OiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaGVpZ2h0JywgJ2lkJywgJ29uYWN0aXZhdGUnLCAnb25jbGljaycsICdvbmZvY3VzaW4nLCAnb25mb2N1c291dCcsICdvbmxvYWQnLCAnb25tb3VzZWRvd24nLCAnb25tb3VzZW1vdmUnLCAnb25tb3VzZW91dCcsICdvbm1vdXNlb3ZlcicsICdvbm1vdXNldXAnLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAncngnLCAncnknLCAnc3R5bGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndHJhbnNmb3JtJywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgc2NyaXB0OiBbJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAndHlwZScsICd4bGluazphY3R1YXRlJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnNob3cnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgc2V0OiBbJ2F0dHJpYnV0ZU5hbWUnLCAnYXR0cmlidXRlVHlwZScsICdiZWdpbicsICdkdXInLCAnZW5kJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnZmlsbCcsICdpZCcsICdtYXgnLCAnbWluJywgJ29uYmVnaW4nLCAnb25lbmQnLCAnb25sb2FkJywgJ29ucmVwZWF0JywgJ3JlcGVhdENvdW50JywgJ3JlcGVhdER1cicsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdyZXN0YXJ0JywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RvJywgJ3hsaW5rOmFjdHVhdGUnLCAneGxpbms6YXJjcm9sZScsICd4bGluazpocmVmJywgJ3hsaW5rOnJvbGUnLCAneGxpbms6c2hvdycsICd4bGluazp0aXRsZScsICd4bGluazp0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICBzdG9wOiBbJ2NsYXNzJywgJ2lkJywgJ29mZnNldCcsICdzdHlsZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgc3R5bGU6IFsnaWQnLCAnbWVkaWEnLCAndGl0bGUnLCAndHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgc3ZnOiBbJ2Jhc2VQcm9maWxlJywgJ2NsYXNzJywgJ2NvbnRlbnRTY3JpcHRUeXBlJywgJ2NvbnRlbnRTdHlsZVR5cGUnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdoZWlnaHQnLCAnaWQnLCAnb25hYm9ydCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25lcnJvcicsICdvbmZvY3VzaW4nLCAnb25mb2N1c291dCcsICdvbmxvYWQnLCAnb25tb3VzZWRvd24nLCAnb25tb3VzZW1vdmUnLCAnb25tb3VzZW91dCcsICdvbm1vdXNlb3ZlcicsICdvbm1vdXNldXAnLCAnb25yZXNpemUnLCAnb25zY3JvbGwnLCAnb251bmxvYWQnLCAnb256b29tJywgJ3ByZXNlcnZlQXNwZWN0UmF0aW8nLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAnc3R5bGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndmVyc2lvbicsICd2aWV3Qm94JywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knLCAnem9vbUFuZFBhbiddLFxuICBzd2l0Y2g6IFsnY2xhc3MnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25mb2N1c2luJywgJ29uZm9jdXNvdXQnLCAnb25sb2FkJywgJ29ubW91c2Vkb3duJywgJ29ubW91c2Vtb3ZlJywgJ29ubW91c2VvdXQnLCAnb25tb3VzZW92ZXInLCAnb25tb3VzZXVwJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RyYW5zZm9ybScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgc3ltYm9sOiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdwcmVzZXJ2ZUFzcGVjdFJhdGlvJywgJ3N0eWxlJywgJ3ZpZXdCb3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gIHRleHQ6IFsnY2xhc3MnLCAnZHgnLCAnZHknLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICdsZW5ndGhBZGp1c3QnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdyb3RhdGUnLCAnc3R5bGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndGV4dExlbmd0aCcsICd0cmFuc2Zvcm0nLCAneCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICB0ZXh0UGF0aDogWydjbGFzcycsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2lkJywgJ2xlbmd0aEFkanVzdCcsICdtZXRob2QnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdzcGFjaW5nJywgJ3N0YXJ0T2Zmc2V0JywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RleHRMZW5ndGgnLCAneGxpbms6YXJjcm9sZScsICd4bGluazpocmVmJywgJ3hsaW5rOnJvbGUnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgdGl0bGU6IFsnY2xhc3MnLCAnaWQnLCAnc3R5bGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gIHRyZWY6IFsnY2xhc3MnLCAnZHgnLCAnZHknLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICdsZW5ndGhBZGp1c3QnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdyb3RhdGUnLCAnc3R5bGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndGV4dExlbmd0aCcsICd4JywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgdHNwYW46IFsnY2xhc3MnLCAnZHgnLCAnZHknLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICdsZW5ndGhBZGp1c3QnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdyb3RhdGUnLCAnc3R5bGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndGV4dExlbmd0aCcsICd4JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gIHVzZTogWydjbGFzcycsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2hlaWdodCcsICdpZCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25mb2N1c2luJywgJ29uZm9jdXNvdXQnLCAnb25sb2FkJywgJ29ubW91c2Vkb3duJywgJ29ubW91c2Vtb3ZlJywgJ29ubW91c2VvdXQnLCAnb25tb3VzZW92ZXInLCAnb25tb3VzZXVwJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RyYW5zZm9ybScsICd3aWR0aCcsICd4JywgJ3hsaW5rOmFjdHVhdGUnLCAneGxpbms6YXJjcm9sZScsICd4bGluazpocmVmJywgJ3hsaW5rOnJvbGUnLCAneGxpbms6c2hvdycsICd4bGluazp0aXRsZScsICd4bGluazp0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gIHZpZXc6IFsnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICdwcmVzZXJ2ZUFzcGVjdFJhdGlvJywgJ3ZpZXdCb3gnLCAndmlld1RhcmdldCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAnem9vbUFuZFBhbiddLFxuICB2a2VybjogWydnMScsICdnMicsICdpZCcsICdrJywgJ3UxJywgJ3UyJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddXG59O1xudmFyIHByZXNlbnRhdGlvbkVsZW1lbnRzID0gZXhwb3J0cy5wcmVzZW50YXRpb25FbGVtZW50cyA9IHtcbiAgJ2EnOiB0cnVlLFxuICAnYWx0R2x5cGgnOiB0cnVlLFxuICAnYW5pbWF0ZSc6IHRydWUsXG4gICdhbmltYXRlQ29sb3InOiB0cnVlLFxuICAnY2lyY2xlJzogdHJ1ZSxcbiAgJ2NsaXBQYXRoJzogdHJ1ZSxcbiAgJ2RlZnMnOiB0cnVlLFxuICAnZWxsaXBzZSc6IHRydWUsXG4gICdmZUJsZW5kJzogdHJ1ZSxcbiAgJ2ZlQ29sb3JNYXRyaXgnOiB0cnVlLFxuICAnZmVDb21wb25lbnRUcmFuc2Zlcic6IHRydWUsXG4gICdmZUNvbXBvc2l0ZSc6IHRydWUsXG4gICdmZUNvbnZvbHZlTWF0cml4JzogdHJ1ZSxcbiAgJ2ZlRGlmZnVzZUxpZ2h0aW5nJzogdHJ1ZSxcbiAgJ2ZlRGlzcGxhY2VtZW50TWFwJzogdHJ1ZSxcbiAgJ2ZlRmxvb2QnOiB0cnVlLFxuICAnZmVHYXVzc2lhbkJsdXInOiB0cnVlLFxuICAnZmVJbWFnZSc6IHRydWUsXG4gICdmZU1lcmdlJzogdHJ1ZSxcbiAgJ2ZlTW9ycGhvbG9neSc6IHRydWUsXG4gICdmZU9mZnNldCc6IHRydWUsXG4gICdmZVNwZWN1bGFyTGlnaHRpbmcnOiB0cnVlLFxuICAnZmVUaWxlJzogdHJ1ZSxcbiAgJ2ZlVHVyYnVsZW5jZSc6IHRydWUsXG4gICdmaWx0ZXInOiB0cnVlLFxuICAnZm9udCc6IHRydWUsXG4gICdmb3JlaWduT2JqZWN0JzogdHJ1ZSxcbiAgJ2cnOiB0cnVlLFxuICAnZ2x5cGgnOiB0cnVlLFxuICAnZ2x5cGhSZWYnOiB0cnVlLFxuICAnaW1hZ2UnOiB0cnVlLFxuICAnbGluZSc6IHRydWUsXG4gICdsaW5lYXJHcmFkaWVudCc6IHRydWUsXG4gICdtYXJrZXInOiB0cnVlLFxuICAnbWFzayc6IHRydWUsXG4gICdtaXNzaW5nLWdseXBoJzogdHJ1ZSxcbiAgJ3BhdGgnOiB0cnVlLFxuICAncGF0dGVybic6IHRydWUsXG4gICdwb2x5Z29uJzogdHJ1ZSxcbiAgJ3BvbHlsaW5lJzogdHJ1ZSxcbiAgJ3JhZGlhbEdyYWRpZW50JzogdHJ1ZSxcbiAgJ3JlY3QnOiB0cnVlLFxuICAnc3RvcCc6IHRydWUsXG4gICdzdmcnOiB0cnVlLFxuICAnc3dpdGNoJzogdHJ1ZSxcbiAgJ3N5bWJvbCc6IHRydWUsXG4gICd0ZXh0JzogdHJ1ZSxcbiAgJ3RleHRQYXRoJzogdHJ1ZSxcbiAgJ3RyZWYnOiB0cnVlLFxuICAndHNwYW4nOiB0cnVlLFxuICAndXNlJzogdHJ1ZVxufTtcblxudmFyIHByZXNlbnRhdGlvbkF0dHJpYnV0ZXMgPSBleHBvcnRzLnByZXNlbnRhdGlvbkF0dHJpYnV0ZXMgPSB7XG4gICdhbGlnbm1lbnQtYmFzZWxpbmUnOiB0cnVlLFxuICAnYmFzZWxpbmUtc2hpZnQnOiB0cnVlLFxuICAnY2xpcC1wYXRoJzogdHJ1ZSxcbiAgJ2NsaXAtcnVsZSc6IHRydWUsXG4gICdjbGlwJzogdHJ1ZSxcbiAgJ2NvbG9yLWludGVycG9sYXRpb24tZmlsdGVycyc6IHRydWUsXG4gICdjb2xvci1pbnRlcnBvbGF0aW9uJzogdHJ1ZSxcbiAgJ2NvbG9yLXByb2ZpbGUnOiB0cnVlLFxuICAnY29sb3ItcmVuZGVyaW5nJzogdHJ1ZSxcbiAgJ2NvbG9yJzogdHJ1ZSxcbiAgJ2N1cnNvcic6IHRydWUsXG4gICdkaXJlY3Rpb24nOiB0cnVlLFxuICAnZGlzcGxheSc6IHRydWUsXG4gICdkb21pbmFudC1iYXNlbGluZSc6IHRydWUsXG4gICdlbmFibGUtYmFja2dyb3VuZCc6IHRydWUsXG4gICdmaWxsLW9wYWNpdHknOiB0cnVlLFxuICAnZmlsbC1ydWxlJzogdHJ1ZSxcbiAgJ2ZpbGwnOiB0cnVlLFxuICAnZmlsdGVyJzogdHJ1ZSxcbiAgJ2Zsb29kLWNvbG9yJzogdHJ1ZSxcbiAgJ2Zsb29kLW9wYWNpdHknOiB0cnVlLFxuICAnZm9udC1mYW1pbHknOiB0cnVlLFxuICAnZm9udC1zaXplLWFkanVzdCc6IHRydWUsXG4gICdmb250LXNpemUnOiB0cnVlLFxuICAnZm9udC1zdHJldGNoJzogdHJ1ZSxcbiAgJ2ZvbnQtc3R5bGUnOiB0cnVlLFxuICAnZm9udC12YXJpYW50JzogdHJ1ZSxcbiAgJ2ZvbnQtd2VpZ2h0JzogdHJ1ZSxcbiAgJ2dseXBoLW9yaWVudGF0aW9uLWhvcml6b250YWwnOiB0cnVlLFxuICAnZ2x5cGgtb3JpZW50YXRpb24tdmVydGljYWwnOiB0cnVlLFxuICAnaW1hZ2UtcmVuZGVyaW5nJzogdHJ1ZSxcbiAgJ2tlcm5pbmcnOiB0cnVlLFxuICAnbGV0dGVyLXNwYWNpbmcnOiB0cnVlLFxuICAnbGlnaHRpbmctY29sb3InOiB0cnVlLFxuICAnbWFya2VyLWVuZCc6IHRydWUsXG4gICdtYXJrZXItbWlkJzogdHJ1ZSxcbiAgJ21hcmtlci1zdGFydCc6IHRydWUsXG4gICdtYXNrJzogdHJ1ZSxcbiAgJ29wYWNpdHknOiB0cnVlLFxuICAnb3ZlcmZsb3cnOiB0cnVlLFxuICAncG9pbnRlci1ldmVudHMnOiB0cnVlLFxuICAnc2hhcGUtcmVuZGVyaW5nJzogdHJ1ZSxcbiAgJ3N0b3AtY29sb3InOiB0cnVlLFxuICAnc3RvcC1vcGFjaXR5JzogdHJ1ZSxcbiAgJ3N0cm9rZS1kYXNoYXJyYXknOiB0cnVlLFxuICAnc3Ryb2tlLWRhc2hvZmZzZXQnOiB0cnVlLFxuICAnc3Ryb2tlLWxpbmVjYXAnOiB0cnVlLFxuICAnc3Ryb2tlLWxpbmVqb2luJzogdHJ1ZSxcbiAgJ3N0cm9rZS1taXRlcmxpbWl0JzogdHJ1ZSxcbiAgJ3N0cm9rZS1vcGFjaXR5JzogdHJ1ZSxcbiAgJ3N0cm9rZS13aWR0aCc6IHRydWUsXG4gICdzdHJva2UnOiB0cnVlLFxuICAndGV4dC1hbmNob3InOiB0cnVlLFxuICAndGV4dC1kZWNvcmF0aW9uJzogdHJ1ZSxcbiAgJ3RleHQtcmVuZGVyaW5nJzogdHJ1ZSxcbiAgJ3VuaWNvZGUtYmlkaSc6IHRydWUsXG4gICd2aXNpYmlsaXR5JzogdHJ1ZSxcbiAgJ3dvcmQtc3BhY2luZyc6IHRydWUsXG4gICd3cml0aW5nLW1vZGUnOiB0cnVlXG59O1xuXG5mdW5jdGlvbiBjcmVhdGVFbGVtZW50KGh0bWwpIHtcbiAgdmFyIGRpdiA9IF9hdXJlbGlhUGFsLkRPTS5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgZGl2LmlubmVySFRNTCA9IGh0bWw7XG4gIHJldHVybiBkaXYuZmlyc3RDaGlsZDtcbn1cblxudmFyIFNWR0FuYWx5emVyID0gZXhwb3J0cy5TVkdBbmFseXplciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gU1ZHQW5hbHl6ZXIoKSB7XG4gICAgXG5cbiAgICBpZiAoY3JlYXRlRWxlbWVudCgnPHN2Zz48YWx0R2x5cGggLz48L3N2Zz4nKS5maXJzdEVsZW1lbnRDaGlsZC5ub2RlTmFtZSA9PT0gJ2FsdGdseXBoJyAmJiBlbGVtZW50cy5hbHRHbHlwaCkge1xuICAgICAgZWxlbWVudHMuYWx0Z2x5cGggPSBlbGVtZW50cy5hbHRHbHlwaDtcbiAgICAgIGRlbGV0ZSBlbGVtZW50cy5hbHRHbHlwaDtcbiAgICAgIGVsZW1lbnRzLmFsdGdseXBoZGVmID0gZWxlbWVudHMuYWx0R2x5cGhEZWY7XG4gICAgICBkZWxldGUgZWxlbWVudHMuYWx0R2x5cGhEZWY7XG4gICAgICBlbGVtZW50cy5hbHRnbHlwaGl0ZW0gPSBlbGVtZW50cy5hbHRHbHlwaEl0ZW07XG4gICAgICBkZWxldGUgZWxlbWVudHMuYWx0R2x5cGhJdGVtO1xuICAgICAgZWxlbWVudHMuZ2x5cGhyZWYgPSBlbGVtZW50cy5nbHlwaFJlZjtcbiAgICAgIGRlbGV0ZSBlbGVtZW50cy5nbHlwaFJlZjtcbiAgICB9XG4gIH1cblxuICBTVkdBbmFseXplci5wcm90b3R5cGUuaXNTdGFuZGFyZFN2Z0F0dHJpYnV0ZSA9IGZ1bmN0aW9uIGlzU3RhbmRhcmRTdmdBdHRyaWJ1dGUobm9kZU5hbWUsIGF0dHJpYnV0ZU5hbWUpIHtcbiAgICByZXR1cm4gcHJlc2VudGF0aW9uRWxlbWVudHNbbm9kZU5hbWVdICYmIHByZXNlbnRhdGlvbkF0dHJpYnV0ZXNbYXR0cmlidXRlTmFtZV0gfHwgZWxlbWVudHNbbm9kZU5hbWVdICYmIGVsZW1lbnRzW25vZGVOYW1lXS5pbmRleE9mKGF0dHJpYnV0ZU5hbWUpICE9PSAtMTtcbiAgfTtcblxuICByZXR1cm4gU1ZHQW5hbHl6ZXI7XG59KCk7XG5cbnZhciBPYnNlcnZlckxvY2F0b3IgPSBleHBvcnRzLk9ic2VydmVyTG9jYXRvciA9IChfdGVtcCA9IF9jbGFzczExID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBPYnNlcnZlckxvY2F0b3IodGFza1F1ZXVlLCBldmVudE1hbmFnZXIsIGRpcnR5Q2hlY2tlciwgc3ZnQW5hbHl6ZXIsIHBhcnNlcikge1xuICAgIFxuXG4gICAgdGhpcy50YXNrUXVldWUgPSB0YXNrUXVldWU7XG4gICAgdGhpcy5ldmVudE1hbmFnZXIgPSBldmVudE1hbmFnZXI7XG4gICAgdGhpcy5kaXJ0eUNoZWNrZXIgPSBkaXJ0eUNoZWNrZXI7XG4gICAgdGhpcy5zdmdBbmFseXplciA9IHN2Z0FuYWx5emVyO1xuICAgIHRoaXMucGFyc2VyID0gcGFyc2VyO1xuICAgIHRoaXMuYWRhcHRlcnMgPSBbXTtcbiAgICB0aGlzLmxvZ2dlciA9IExvZ01hbmFnZXIuZ2V0TG9nZ2VyKCdvYnNlcnZlci1sb2NhdG9yJyk7XG4gIH1cblxuICBPYnNlcnZlckxvY2F0b3IucHJvdG90eXBlLmdldE9ic2VydmVyID0gZnVuY3Rpb24gZ2V0T2JzZXJ2ZXIob2JqLCBwcm9wZXJ0eU5hbWUpIHtcbiAgICB2YXIgb2JzZXJ2ZXJzTG9va3VwID0gb2JqLl9fb2JzZXJ2ZXJzX187XG4gICAgdmFyIG9ic2VydmVyID0gdm9pZCAwO1xuXG4gICAgaWYgKG9ic2VydmVyc0xvb2t1cCAmJiBwcm9wZXJ0eU5hbWUgaW4gb2JzZXJ2ZXJzTG9va3VwKSB7XG4gICAgICByZXR1cm4gb2JzZXJ2ZXJzTG9va3VwW3Byb3BlcnR5TmFtZV07XG4gICAgfVxuXG4gICAgb2JzZXJ2ZXIgPSB0aGlzLmNyZWF0ZVByb3BlcnR5T2JzZXJ2ZXIob2JqLCBwcm9wZXJ0eU5hbWUpO1xuXG4gICAgaWYgKCFvYnNlcnZlci5kb05vdENhY2hlKSB7XG4gICAgICBpZiAob2JzZXJ2ZXJzTG9va3VwID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgb2JzZXJ2ZXJzTG9va3VwID0gdGhpcy5nZXRPckNyZWF0ZU9ic2VydmVyc0xvb2t1cChvYmopO1xuICAgICAgfVxuXG4gICAgICBvYnNlcnZlcnNMb29rdXBbcHJvcGVydHlOYW1lXSA9IG9ic2VydmVyO1xuICAgIH1cblxuICAgIHJldHVybiBvYnNlcnZlcjtcbiAgfTtcblxuICBPYnNlcnZlckxvY2F0b3IucHJvdG90eXBlLmdldE9yQ3JlYXRlT2JzZXJ2ZXJzTG9va3VwID0gZnVuY3Rpb24gZ2V0T3JDcmVhdGVPYnNlcnZlcnNMb29rdXAob2JqKSB7XG4gICAgcmV0dXJuIG9iai5fX29ic2VydmVyc19fIHx8IHRoaXMuY3JlYXRlT2JzZXJ2ZXJzTG9va3VwKG9iaik7XG4gIH07XG5cbiAgT2JzZXJ2ZXJMb2NhdG9yLnByb3RvdHlwZS5jcmVhdGVPYnNlcnZlcnNMb29rdXAgPSBmdW5jdGlvbiBjcmVhdGVPYnNlcnZlcnNMb29rdXAob2JqKSB7XG4gICAgdmFyIHZhbHVlID0ge307XG5cbiAgICBpZiAoIVJlZmxlY3QuZGVmaW5lUHJvcGVydHkob2JqLCAnX19vYnNlcnZlcnNfXycsIHtcbiAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgY29uZmlndXJhYmxlOiBmYWxzZSxcbiAgICAgIHdyaXRhYmxlOiBmYWxzZSxcbiAgICAgIHZhbHVlOiB2YWx1ZVxuICAgIH0pKSB7XG4gICAgICB0aGlzLmxvZ2dlci53YXJuKCdDYW5ub3QgYWRkIG9ic2VydmVycyB0byBvYmplY3QnLCBvYmopO1xuICAgIH1cblxuICAgIHJldHVybiB2YWx1ZTtcbiAgfTtcblxuICBPYnNlcnZlckxvY2F0b3IucHJvdG90eXBlLmFkZEFkYXB0ZXIgPSBmdW5jdGlvbiBhZGRBZGFwdGVyKGFkYXB0ZXIpIHtcbiAgICB0aGlzLmFkYXB0ZXJzLnB1c2goYWRhcHRlcik7XG4gIH07XG5cbiAgT2JzZXJ2ZXJMb2NhdG9yLnByb3RvdHlwZS5nZXRBZGFwdGVyT2JzZXJ2ZXIgPSBmdW5jdGlvbiBnZXRBZGFwdGVyT2JzZXJ2ZXIob2JqLCBwcm9wZXJ0eU5hbWUsIGRlc2NyaXB0b3IpIHtcbiAgICBmb3IgKHZhciBfaTI2ID0gMCwgaWkgPSB0aGlzLmFkYXB0ZXJzLmxlbmd0aDsgX2kyNiA8IGlpOyBfaTI2KyspIHtcbiAgICAgIHZhciBhZGFwdGVyID0gdGhpcy5hZGFwdGVyc1tfaTI2XTtcbiAgICAgIHZhciBvYnNlcnZlciA9IGFkYXB0ZXIuZ2V0T2JzZXJ2ZXIob2JqLCBwcm9wZXJ0eU5hbWUsIGRlc2NyaXB0b3IpO1xuICAgICAgaWYgKG9ic2VydmVyKSB7XG4gICAgICAgIHJldHVybiBvYnNlcnZlcjtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH07XG5cbiAgT2JzZXJ2ZXJMb2NhdG9yLnByb3RvdHlwZS5jcmVhdGVQcm9wZXJ0eU9ic2VydmVyID0gZnVuY3Rpb24gY3JlYXRlUHJvcGVydHlPYnNlcnZlcihvYmosIHByb3BlcnR5TmFtZSkge1xuICAgIHZhciBkZXNjcmlwdG9yID0gdm9pZCAwO1xuICAgIHZhciBoYW5kbGVyID0gdm9pZCAwO1xuICAgIHZhciB4bGlua1Jlc3VsdCA9IHZvaWQgMDtcblxuICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIE9iamVjdCkpIHtcbiAgICAgIHJldHVybiBuZXcgUHJpbWl0aXZlT2JzZXJ2ZXIob2JqLCBwcm9wZXJ0eU5hbWUpO1xuICAgIH1cblxuICAgIGlmIChvYmogaW5zdGFuY2VvZiBfYXVyZWxpYVBhbC5ET00uRWxlbWVudCkge1xuICAgICAgaWYgKHByb3BlcnR5TmFtZSA9PT0gJ2NsYXNzJykge1xuICAgICAgICByZXR1cm4gbmV3IENsYXNzT2JzZXJ2ZXIob2JqKTtcbiAgICAgIH1cbiAgICAgIGlmIChwcm9wZXJ0eU5hbWUgPT09ICdzdHlsZScgfHwgcHJvcGVydHlOYW1lID09PSAnY3NzJykge1xuICAgICAgICByZXR1cm4gbmV3IFN0eWxlT2JzZXJ2ZXIob2JqLCBwcm9wZXJ0eU5hbWUpO1xuICAgICAgfVxuICAgICAgaGFuZGxlciA9IHRoaXMuZXZlbnRNYW5hZ2VyLmdldEVsZW1lbnRIYW5kbGVyKG9iaiwgcHJvcGVydHlOYW1lKTtcbiAgICAgIGlmIChwcm9wZXJ0eU5hbWUgPT09ICd2YWx1ZScgJiYgb2JqLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ3NlbGVjdCcpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RWYWx1ZU9ic2VydmVyKG9iaiwgaGFuZGxlciwgdGhpcyk7XG4gICAgICB9XG4gICAgICBpZiAocHJvcGVydHlOYW1lID09PSAnY2hlY2tlZCcgJiYgb2JqLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2lucHV0Jykge1xuICAgICAgICByZXR1cm4gbmV3IENoZWNrZWRPYnNlcnZlcihvYmosIGhhbmRsZXIsIHRoaXMpO1xuICAgICAgfVxuICAgICAgaWYgKGhhbmRsZXIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBWYWx1ZUF0dHJpYnV0ZU9ic2VydmVyKG9iaiwgcHJvcGVydHlOYW1lLCBoYW5kbGVyKTtcbiAgICAgIH1cbiAgICAgIHhsaW5rUmVzdWx0ID0gL154bGluazooLispJC8uZXhlYyhwcm9wZXJ0eU5hbWUpO1xuICAgICAgaWYgKHhsaW5rUmVzdWx0KSB7XG4gICAgICAgIHJldHVybiBuZXcgWExpbmtBdHRyaWJ1dGVPYnNlcnZlcihvYmosIHByb3BlcnR5TmFtZSwgeGxpbmtSZXN1bHRbMV0pO1xuICAgICAgfVxuICAgICAgaWYgKC9eXFx3Kzp8XmRhdGEtfF5hcmlhLS8udGVzdChwcm9wZXJ0eU5hbWUpIHx8IG9iaiBpbnN0YW5jZW9mIF9hdXJlbGlhUGFsLkRPTS5TVkdFbGVtZW50ICYmIHRoaXMuc3ZnQW5hbHl6ZXIuaXNTdGFuZGFyZFN2Z0F0dHJpYnV0ZShvYmoubm9kZU5hbWUsIHByb3BlcnR5TmFtZSkpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhQXR0cmlidXRlT2JzZXJ2ZXIob2JqLCBwcm9wZXJ0eU5hbWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGRlc2NyaXB0b3IgPSBPYmplY3QuZ2V0UHJvcGVydHlEZXNjcmlwdG9yKG9iaiwgcHJvcGVydHlOYW1lKTtcblxuICAgIGlmIChoYXNEZWNsYXJlZERlcGVuZGVuY2llcyhkZXNjcmlwdG9yKSkge1xuICAgICAgcmV0dXJuIGNyZWF0ZUNvbXB1dGVkT2JzZXJ2ZXIob2JqLCBwcm9wZXJ0eU5hbWUsIGRlc2NyaXB0b3IsIHRoaXMpO1xuICAgIH1cblxuICAgIGlmIChkZXNjcmlwdG9yKSB7XG4gICAgICB2YXIgZXhpc3RpbmdHZXR0ZXJPclNldHRlciA9IGRlc2NyaXB0b3IuZ2V0IHx8IGRlc2NyaXB0b3Iuc2V0O1xuICAgICAgaWYgKGV4aXN0aW5nR2V0dGVyT3JTZXR0ZXIpIHtcbiAgICAgICAgaWYgKGV4aXN0aW5nR2V0dGVyT3JTZXR0ZXIuZ2V0T2JzZXJ2ZXIpIHtcbiAgICAgICAgICByZXR1cm4gZXhpc3RpbmdHZXR0ZXJPclNldHRlci5nZXRPYnNlcnZlcihvYmopO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGFkYXB0ZXJPYnNlcnZlciA9IHRoaXMuZ2V0QWRhcHRlck9ic2VydmVyKG9iaiwgcHJvcGVydHlOYW1lLCBkZXNjcmlwdG9yKTtcbiAgICAgICAgaWYgKGFkYXB0ZXJPYnNlcnZlcikge1xuICAgICAgICAgIHJldHVybiBhZGFwdGVyT2JzZXJ2ZXI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBEaXJ0eUNoZWNrUHJvcGVydHkodGhpcy5kaXJ0eUNoZWNrZXIsIG9iaiwgcHJvcGVydHlOYW1lKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAob2JqIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIGlmIChwcm9wZXJ0eU5hbWUgPT09ICdsZW5ndGgnKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEFycmF5T2JzZXJ2ZXIob2JqKS5nZXRMZW5ndGhPYnNlcnZlcigpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV3IERpcnR5Q2hlY2tQcm9wZXJ0eSh0aGlzLmRpcnR5Q2hlY2tlciwgb2JqLCBwcm9wZXJ0eU5hbWUpO1xuICAgIH0gZWxzZSBpZiAob2JqIGluc3RhbmNlb2YgTWFwKSB7XG4gICAgICBpZiAocHJvcGVydHlOYW1lID09PSAnc2l6ZScpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TWFwT2JzZXJ2ZXIob2JqKS5nZXRMZW5ndGhPYnNlcnZlcigpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV3IERpcnR5Q2hlY2tQcm9wZXJ0eSh0aGlzLmRpcnR5Q2hlY2tlciwgb2JqLCBwcm9wZXJ0eU5hbWUpO1xuICAgIH0gZWxzZSBpZiAob2JqIGluc3RhbmNlb2YgU2V0KSB7XG4gICAgICBpZiAocHJvcGVydHlOYW1lID09PSAnc2l6ZScpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U2V0T2JzZXJ2ZXIob2JqKS5nZXRMZW5ndGhPYnNlcnZlcigpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV3IERpcnR5Q2hlY2tQcm9wZXJ0eSh0aGlzLmRpcnR5Q2hlY2tlciwgb2JqLCBwcm9wZXJ0eU5hbWUpO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgU2V0dGVyT2JzZXJ2ZXIodGhpcy50YXNrUXVldWUsIG9iaiwgcHJvcGVydHlOYW1lKTtcbiAgfTtcblxuICBPYnNlcnZlckxvY2F0b3IucHJvdG90eXBlLmdldEFjY2Vzc29yID0gZnVuY3Rpb24gZ2V0QWNjZXNzb3Iob2JqLCBwcm9wZXJ0eU5hbWUpIHtcbiAgICBpZiAob2JqIGluc3RhbmNlb2YgX2F1cmVsaWFQYWwuRE9NLkVsZW1lbnQpIHtcbiAgICAgIGlmIChwcm9wZXJ0eU5hbWUgPT09ICdjbGFzcycgfHwgcHJvcGVydHlOYW1lID09PSAnc3R5bGUnIHx8IHByb3BlcnR5TmFtZSA9PT0gJ2NzcycgfHwgcHJvcGVydHlOYW1lID09PSAndmFsdWUnICYmIChvYmoudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnaW5wdXQnIHx8IG9iai50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdzZWxlY3QnKSB8fCBwcm9wZXJ0eU5hbWUgPT09ICdjaGVja2VkJyAmJiBvYmoudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnaW5wdXQnIHx8IHByb3BlcnR5TmFtZSA9PT0gJ21vZGVsJyAmJiBvYmoudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnaW5wdXQnIHx8IC9eeGxpbms6LiskLy5leGVjKHByb3BlcnR5TmFtZSkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0T2JzZXJ2ZXIob2JqLCBwcm9wZXJ0eU5hbWUpO1xuICAgICAgfVxuICAgICAgaWYgKC9eXFx3Kzp8XmRhdGEtfF5hcmlhLS8udGVzdChwcm9wZXJ0eU5hbWUpIHx8IG9iaiBpbnN0YW5jZW9mIF9hdXJlbGlhUGFsLkRPTS5TVkdFbGVtZW50ICYmIHRoaXMuc3ZnQW5hbHl6ZXIuaXNTdGFuZGFyZFN2Z0F0dHJpYnV0ZShvYmoubm9kZU5hbWUsIHByb3BlcnR5TmFtZSkpIHtcbiAgICAgICAgcmV0dXJuIGRhdGFBdHRyaWJ1dGVBY2Nlc3NvcjtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHByb3BlcnR5QWNjZXNzb3I7XG4gIH07XG5cbiAgT2JzZXJ2ZXJMb2NhdG9yLnByb3RvdHlwZS5nZXRBcnJheU9ic2VydmVyID0gZnVuY3Rpb24gZ2V0QXJyYXlPYnNlcnZlcihhcnJheSkge1xuICAgIHJldHVybiBfZ2V0QXJyYXlPYnNlcnZlcih0aGlzLnRhc2tRdWV1ZSwgYXJyYXkpO1xuICB9O1xuXG4gIE9ic2VydmVyTG9jYXRvci5wcm90b3R5cGUuZ2V0TWFwT2JzZXJ2ZXIgPSBmdW5jdGlvbiBnZXRNYXBPYnNlcnZlcihtYXApIHtcbiAgICByZXR1cm4gX2dldE1hcE9ic2VydmVyKHRoaXMudGFza1F1ZXVlLCBtYXApO1xuICB9O1xuXG4gIE9ic2VydmVyTG9jYXRvci5wcm90b3R5cGUuZ2V0U2V0T2JzZXJ2ZXIgPSBmdW5jdGlvbiBnZXRTZXRPYnNlcnZlcihzZXQpIHtcbiAgICByZXR1cm4gX2dldFNldE9ic2VydmVyKHRoaXMudGFza1F1ZXVlLCBzZXQpO1xuICB9O1xuXG4gIHJldHVybiBPYnNlcnZlckxvY2F0b3I7XG59KCksIF9jbGFzczExLmluamVjdCA9IFtfYXVyZWxpYVRhc2tRdWV1ZS5UYXNrUXVldWUsIEV2ZW50TWFuYWdlciwgRGlydHlDaGVja2VyLCBTVkdBbmFseXplciwgUGFyc2VyXSwgX3RlbXApO1xuXG52YXIgT2JqZWN0T2JzZXJ2YXRpb25BZGFwdGVyID0gZXhwb3J0cy5PYmplY3RPYnNlcnZhdGlvbkFkYXB0ZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIE9iamVjdE9ic2VydmF0aW9uQWRhcHRlcigpIHtcbiAgICBcbiAgfVxuXG4gIE9iamVjdE9ic2VydmF0aW9uQWRhcHRlci5wcm90b3R5cGUuZ2V0T2JzZXJ2ZXIgPSBmdW5jdGlvbiBnZXRPYnNlcnZlcihvYmplY3QsIHByb3BlcnR5TmFtZSwgZGVzY3JpcHRvcikge1xuICAgIHRocm93IG5ldyBFcnJvcignQmluZGluZ0FkYXB0ZXJzIG11c3QgaW1wbGVtZW50IGdldE9ic2VydmVyKG9iamVjdCwgcHJvcGVydHlOYW1lKS4nKTtcbiAgfTtcblxuICByZXR1cm4gT2JqZWN0T2JzZXJ2YXRpb25BZGFwdGVyO1xufSgpO1xuXG52YXIgQmluZGluZ0V4cHJlc3Npb24gPSBleHBvcnRzLkJpbmRpbmdFeHByZXNzaW9uID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBCaW5kaW5nRXhwcmVzc2lvbihvYnNlcnZlckxvY2F0b3IsIHRhcmdldFByb3BlcnR5LCBzb3VyY2VFeHByZXNzaW9uLCBtb2RlLCBsb29rdXBGdW5jdGlvbnMsIGF0dHJpYnV0ZSkge1xuICAgIFxuXG4gICAgdGhpcy5vYnNlcnZlckxvY2F0b3IgPSBvYnNlcnZlckxvY2F0b3I7XG4gICAgdGhpcy50YXJnZXRQcm9wZXJ0eSA9IHRhcmdldFByb3BlcnR5O1xuICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbiA9IHNvdXJjZUV4cHJlc3Npb247XG4gICAgdGhpcy5tb2RlID0gbW9kZTtcbiAgICB0aGlzLmxvb2t1cEZ1bmN0aW9ucyA9IGxvb2t1cEZ1bmN0aW9ucztcbiAgICB0aGlzLmF0dHJpYnV0ZSA9IGF0dHJpYnV0ZTtcbiAgICB0aGlzLmRpc2NyZXRlID0gZmFsc2U7XG4gIH1cblxuICBCaW5kaW5nRXhwcmVzc2lvbi5wcm90b3R5cGUuY3JlYXRlQmluZGluZyA9IGZ1bmN0aW9uIGNyZWF0ZUJpbmRpbmcodGFyZ2V0KSB7XG4gICAgcmV0dXJuIG5ldyBCaW5kaW5nKHRoaXMub2JzZXJ2ZXJMb2NhdG9yLCB0aGlzLnNvdXJjZUV4cHJlc3Npb24sIHRhcmdldCwgdGhpcy50YXJnZXRQcm9wZXJ0eSwgdGhpcy5tb2RlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgcmV0dXJuIEJpbmRpbmdFeHByZXNzaW9uO1xufSgpO1xuXG52YXIgdGFyZ2V0Q29udGV4dCA9ICdCaW5kaW5nOnRhcmdldCc7XG5cbnZhciBCaW5kaW5nID0gZXhwb3J0cy5CaW5kaW5nID0gKF9kZWMxMCA9IGNvbm5lY3RhYmxlKCksIF9kZWMxMChfY2xhc3MxMiA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQmluZGluZyhvYnNlcnZlckxvY2F0b3IsIHNvdXJjZUV4cHJlc3Npb24sIHRhcmdldCwgdGFyZ2V0UHJvcGVydHksIG1vZGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIFxuXG4gICAgdGhpcy5vYnNlcnZlckxvY2F0b3IgPSBvYnNlcnZlckxvY2F0b3I7XG4gICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uID0gc291cmNlRXhwcmVzc2lvbjtcbiAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcbiAgICB0aGlzLnRhcmdldFByb3BlcnR5ID0gdGFyZ2V0UHJvcGVydHk7XG4gICAgdGhpcy5tb2RlID0gbW9kZTtcbiAgICB0aGlzLmxvb2t1cEZ1bmN0aW9ucyA9IGxvb2t1cEZ1bmN0aW9ucztcbiAgfVxuXG4gIEJpbmRpbmcucHJvdG90eXBlLnVwZGF0ZVRhcmdldCA9IGZ1bmN0aW9uIHVwZGF0ZVRhcmdldCh2YWx1ZSkge1xuICAgIHRoaXMudGFyZ2V0T2JzZXJ2ZXIuc2V0VmFsdWUodmFsdWUsIHRoaXMudGFyZ2V0LCB0aGlzLnRhcmdldFByb3BlcnR5KTtcbiAgfTtcblxuICBCaW5kaW5nLnByb3RvdHlwZS51cGRhdGVTb3VyY2UgPSBmdW5jdGlvbiB1cGRhdGVTb3VyY2UodmFsdWUpIHtcbiAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24uYXNzaWduKHRoaXMuc291cmNlLCB2YWx1ZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICB9O1xuXG4gIEJpbmRpbmcucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiBjYWxsKGNvbnRleHQsIG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgIGlmICghdGhpcy5pc0JvdW5kKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChjb250ZXh0ID09PSBzb3VyY2VDb250ZXh0KSB7XG4gICAgICBvbGRWYWx1ZSA9IHRoaXMudGFyZ2V0T2JzZXJ2ZXIuZ2V0VmFsdWUodGhpcy50YXJnZXQsIHRoaXMudGFyZ2V0UHJvcGVydHkpO1xuICAgICAgbmV3VmFsdWUgPSB0aGlzLnNvdXJjZUV4cHJlc3Npb24uZXZhbHVhdGUodGhpcy5zb3VyY2UsIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcbiAgICAgIGlmIChuZXdWYWx1ZSAhPT0gb2xkVmFsdWUpIHtcbiAgICAgICAgdGhpcy51cGRhdGVUYXJnZXQobmV3VmFsdWUpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMubW9kZSAhPT0gYmluZGluZ01vZGUub25lVGltZSkge1xuICAgICAgICB0aGlzLl92ZXJzaW9uKys7XG4gICAgICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi5jb25uZWN0KHRoaXMsIHRoaXMuc291cmNlKTtcbiAgICAgICAgdGhpcy51bm9ic2VydmUoZmFsc2UpO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY29udGV4dCA9PT0gdGFyZ2V0Q29udGV4dCkge1xuICAgICAgaWYgKG5ld1ZhbHVlICE9PSB0aGlzLnNvdXJjZUV4cHJlc3Npb24uZXZhbHVhdGUodGhpcy5zb3VyY2UsIHRoaXMubG9va3VwRnVuY3Rpb25zKSkge1xuICAgICAgICB0aGlzLnVwZGF0ZVNvdXJjZShuZXdWYWx1ZSk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcignVW5leHBlY3RlZCBjYWxsIGNvbnRleHQgJyArIGNvbnRleHQpO1xuICB9O1xuXG4gIEJpbmRpbmcucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiBiaW5kKHNvdXJjZSkge1xuICAgIGlmICh0aGlzLmlzQm91bmQpIHtcbiAgICAgIGlmICh0aGlzLnNvdXJjZSA9PT0gc291cmNlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMudW5iaW5kKCk7XG4gICAgfVxuICAgIHRoaXMuaXNCb3VuZCA9IHRydWU7XG4gICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cbiAgICBpZiAodGhpcy5zb3VyY2VFeHByZXNzaW9uLmJpbmQpIHtcbiAgICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi5iaW5kKHRoaXMsIHNvdXJjZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICAgIH1cblxuICAgIHZhciBtb2RlID0gdGhpcy5tb2RlO1xuICAgIGlmICghdGhpcy50YXJnZXRPYnNlcnZlcikge1xuICAgICAgdmFyIG1ldGhvZCA9IG1vZGUgPT09IGJpbmRpbmdNb2RlLnR3b1dheSA/ICdnZXRPYnNlcnZlcicgOiAnZ2V0QWNjZXNzb3InO1xuICAgICAgdGhpcy50YXJnZXRPYnNlcnZlciA9IHRoaXMub2JzZXJ2ZXJMb2NhdG9yW21ldGhvZF0odGhpcy50YXJnZXQsIHRoaXMudGFyZ2V0UHJvcGVydHkpO1xuICAgIH1cblxuICAgIGlmICgnYmluZCcgaW4gdGhpcy50YXJnZXRPYnNlcnZlcikge1xuICAgICAgdGhpcy50YXJnZXRPYnNlcnZlci5iaW5kKCk7XG4gICAgfVxuICAgIHZhciB2YWx1ZSA9IHRoaXMuc291cmNlRXhwcmVzc2lvbi5ldmFsdWF0ZShzb3VyY2UsIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcbiAgICB0aGlzLnVwZGF0ZVRhcmdldCh2YWx1ZSk7XG5cbiAgICBpZiAobW9kZSA9PT0gYmluZGluZ01vZGUub25lV2F5KSB7XG4gICAgICBlbnF1ZXVlQmluZGluZ0Nvbm5lY3QodGhpcyk7XG4gICAgfSBlbHNlIGlmIChtb2RlID09PSBiaW5kaW5nTW9kZS50d29XYXkpIHtcbiAgICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi5jb25uZWN0KHRoaXMsIHNvdXJjZSk7XG4gICAgICB0aGlzLnRhcmdldE9ic2VydmVyLnN1YnNjcmliZSh0YXJnZXRDb250ZXh0LCB0aGlzKTtcbiAgICB9XG4gIH07XG5cbiAgQmluZGluZy5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gdW5iaW5kKCkge1xuICAgIGlmICghdGhpcy5pc0JvdW5kKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuaXNCb3VuZCA9IGZhbHNlO1xuICAgIGlmICh0aGlzLnNvdXJjZUV4cHJlc3Npb24udW5iaW5kKSB7XG4gICAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24udW5iaW5kKHRoaXMsIHRoaXMuc291cmNlKTtcbiAgICB9XG4gICAgdGhpcy5zb3VyY2UgPSBudWxsO1xuICAgIGlmICgndW5iaW5kJyBpbiB0aGlzLnRhcmdldE9ic2VydmVyKSB7XG4gICAgICB0aGlzLnRhcmdldE9ic2VydmVyLnVuYmluZCgpO1xuICAgIH1cbiAgICBpZiAodGhpcy50YXJnZXRPYnNlcnZlci51bnN1YnNjcmliZSkge1xuICAgICAgdGhpcy50YXJnZXRPYnNlcnZlci51bnN1YnNjcmliZSh0YXJnZXRDb250ZXh0LCB0aGlzKTtcbiAgICB9XG4gICAgdGhpcy51bm9ic2VydmUodHJ1ZSk7XG4gIH07XG5cbiAgQmluZGluZy5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uIGNvbm5lY3QoZXZhbHVhdGUpIHtcbiAgICBpZiAoIXRoaXMuaXNCb3VuZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoZXZhbHVhdGUpIHtcbiAgICAgIHZhciB2YWx1ZSA9IHRoaXMuc291cmNlRXhwcmVzc2lvbi5ldmFsdWF0ZSh0aGlzLnNvdXJjZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICAgICAgdGhpcy51cGRhdGVUYXJnZXQodmFsdWUpO1xuICAgIH1cbiAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24uY29ubmVjdCh0aGlzLCB0aGlzLnNvdXJjZSk7XG4gIH07XG5cbiAgcmV0dXJuIEJpbmRpbmc7XG59KCkpIHx8IF9jbGFzczEyKTtcblxudmFyIENhbGxFeHByZXNzaW9uID0gZXhwb3J0cy5DYWxsRXhwcmVzc2lvbiA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQ2FsbEV4cHJlc3Npb24ob2JzZXJ2ZXJMb2NhdG9yLCB0YXJnZXRQcm9wZXJ0eSwgc291cmNlRXhwcmVzc2lvbiwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgXG5cbiAgICB0aGlzLm9ic2VydmVyTG9jYXRvciA9IG9ic2VydmVyTG9jYXRvcjtcbiAgICB0aGlzLnRhcmdldFByb3BlcnR5ID0gdGFyZ2V0UHJvcGVydHk7XG4gICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uID0gc291cmNlRXhwcmVzc2lvbjtcbiAgICB0aGlzLmxvb2t1cEZ1bmN0aW9ucyA9IGxvb2t1cEZ1bmN0aW9ucztcbiAgfVxuXG4gIENhbGxFeHByZXNzaW9uLnByb3RvdHlwZS5jcmVhdGVCaW5kaW5nID0gZnVuY3Rpb24gY3JlYXRlQmluZGluZyh0YXJnZXQpIHtcbiAgICByZXR1cm4gbmV3IENhbGwodGhpcy5vYnNlcnZlckxvY2F0b3IsIHRoaXMuc291cmNlRXhwcmVzc2lvbiwgdGFyZ2V0LCB0aGlzLnRhcmdldFByb3BlcnR5LCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgcmV0dXJuIENhbGxFeHByZXNzaW9uO1xufSgpO1xuXG52YXIgQ2FsbCA9IGV4cG9ydHMuQ2FsbCA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQ2FsbChvYnNlcnZlckxvY2F0b3IsIHNvdXJjZUV4cHJlc3Npb24sIHRhcmdldCwgdGFyZ2V0UHJvcGVydHksIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIFxuXG4gICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uID0gc291cmNlRXhwcmVzc2lvbjtcbiAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcbiAgICB0aGlzLnRhcmdldFByb3BlcnR5ID0gb2JzZXJ2ZXJMb2NhdG9yLmdldE9ic2VydmVyKHRhcmdldCwgdGFyZ2V0UHJvcGVydHkpO1xuICAgIHRoaXMubG9va3VwRnVuY3Rpb25zID0gbG9va3VwRnVuY3Rpb25zO1xuICB9XG5cbiAgQ2FsbC5wcm90b3R5cGUuY2FsbFNvdXJjZSA9IGZ1bmN0aW9uIGNhbGxTb3VyY2UoJGV2ZW50KSB7XG4gICAgdmFyIG92ZXJyaWRlQ29udGV4dCA9IHRoaXMuc291cmNlLm92ZXJyaWRlQ29udGV4dDtcbiAgICBPYmplY3QuYXNzaWduKG92ZXJyaWRlQ29udGV4dCwgJGV2ZW50KTtcbiAgICBvdmVycmlkZUNvbnRleHQuJGV2ZW50ID0gJGV2ZW50O1xuICAgIHZhciBtdXN0RXZhbHVhdGUgPSB0cnVlO1xuICAgIHZhciByZXN1bHQgPSB0aGlzLnNvdXJjZUV4cHJlc3Npb24uZXZhbHVhdGUodGhpcy5zb3VyY2UsIHRoaXMubG9va3VwRnVuY3Rpb25zLCBtdXN0RXZhbHVhdGUpO1xuICAgIGRlbGV0ZSBvdmVycmlkZUNvbnRleHQuJGV2ZW50O1xuICAgIGZvciAodmFyIHByb3AgaW4gJGV2ZW50KSB7XG4gICAgICBkZWxldGUgb3ZlcnJpZGVDb250ZXh0W3Byb3BdO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIENhbGwucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiBiaW5kKHNvdXJjZSkge1xuICAgIHZhciBfdGhpczI3ID0gdGhpcztcblxuICAgIGlmICh0aGlzLmlzQm91bmQpIHtcbiAgICAgIGlmICh0aGlzLnNvdXJjZSA9PT0gc291cmNlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMudW5iaW5kKCk7XG4gICAgfVxuICAgIHRoaXMuaXNCb3VuZCA9IHRydWU7XG4gICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cbiAgICBpZiAodGhpcy5zb3VyY2VFeHByZXNzaW9uLmJpbmQpIHtcbiAgICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi5iaW5kKHRoaXMsIHNvdXJjZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICAgIH1cbiAgICB0aGlzLnRhcmdldFByb3BlcnR5LnNldFZhbHVlKGZ1bmN0aW9uICgkZXZlbnQpIHtcbiAgICAgIHJldHVybiBfdGhpczI3LmNhbGxTb3VyY2UoJGV2ZW50KTtcbiAgICB9KTtcbiAgfTtcblxuICBDYWxsLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiB1bmJpbmQoKSB7XG4gICAgaWYgKCF0aGlzLmlzQm91bmQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5pc0JvdW5kID0gZmFsc2U7XG4gICAgaWYgKHRoaXMuc291cmNlRXhwcmVzc2lvbi51bmJpbmQpIHtcbiAgICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi51bmJpbmQodGhpcywgdGhpcy5zb3VyY2UpO1xuICAgIH1cbiAgICB0aGlzLnNvdXJjZSA9IG51bGw7XG4gICAgdGhpcy50YXJnZXRQcm9wZXJ0eS5zZXRWYWx1ZShudWxsKTtcbiAgfTtcblxuICByZXR1cm4gQ2FsbDtcbn0oKTtcblxudmFyIFZhbHVlQ29udmVydGVyUmVzb3VyY2UgPSBleHBvcnRzLlZhbHVlQ29udmVydGVyUmVzb3VyY2UgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFZhbHVlQ29udmVydGVyUmVzb3VyY2UobmFtZSkge1xuICAgIFxuXG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgfVxuXG4gIFZhbHVlQ29udmVydGVyUmVzb3VyY2UuY29udmVudGlvbiA9IGZ1bmN0aW9uIGNvbnZlbnRpb24obmFtZSkge1xuICAgIGlmIChuYW1lLmVuZHNXaXRoKCdWYWx1ZUNvbnZlcnRlcicpKSB7XG4gICAgICByZXR1cm4gbmV3IFZhbHVlQ29udmVydGVyUmVzb3VyY2UoY2FtZWxDYXNlKG5hbWUuc3Vic3RyaW5nKDAsIG5hbWUubGVuZ3RoIC0gMTQpKSk7XG4gICAgfVxuICB9O1xuXG4gIFZhbHVlQ29udmVydGVyUmVzb3VyY2UucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiBpbml0aWFsaXplKGNvbnRhaW5lciwgdGFyZ2V0KSB7XG4gICAgdGhpcy5pbnN0YW5jZSA9IGNvbnRhaW5lci5nZXQodGFyZ2V0KTtcbiAgfTtcblxuICBWYWx1ZUNvbnZlcnRlclJlc291cmNlLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIHJlZ2lzdGVyKHJlZ2lzdHJ5LCBuYW1lKSB7XG4gICAgcmVnaXN0cnkucmVnaXN0ZXJWYWx1ZUNvbnZlcnRlcihuYW1lIHx8IHRoaXMubmFtZSwgdGhpcy5pbnN0YW5jZSk7XG4gIH07XG5cbiAgVmFsdWVDb252ZXJ0ZXJSZXNvdXJjZS5wcm90b3R5cGUubG9hZCA9IGZ1bmN0aW9uIGxvYWQoY29udGFpbmVyLCB0YXJnZXQpIHt9O1xuXG4gIHJldHVybiBWYWx1ZUNvbnZlcnRlclJlc291cmNlO1xufSgpO1xuXG5mdW5jdGlvbiB2YWx1ZUNvbnZlcnRlcihuYW1lT3JUYXJnZXQpIHtcbiAgaWYgKG5hbWVPclRhcmdldCA9PT0gdW5kZWZpbmVkIHx8IHR5cGVvZiBuYW1lT3JUYXJnZXQgPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICAgIF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEuZGVmaW5lKF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEucmVzb3VyY2UsIG5ldyBWYWx1ZUNvbnZlcnRlclJlc291cmNlKG5hbWVPclRhcmdldCksIHRhcmdldCk7XG4gICAgfTtcbiAgfVxuXG4gIF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEuZGVmaW5lKF9hdXJlbGlhTWV0YWRhdGEubWV0YWRhdGEucmVzb3VyY2UsIG5ldyBWYWx1ZUNvbnZlcnRlclJlc291cmNlKCksIG5hbWVPclRhcmdldCk7XG59XG5cbnZhciBCaW5kaW5nQmVoYXZpb3JSZXNvdXJjZSA9IGV4cG9ydHMuQmluZGluZ0JlaGF2aW9yUmVzb3VyY2UgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEJpbmRpbmdCZWhhdmlvclJlc291cmNlKG5hbWUpIHtcbiAgICBcblxuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gIH1cblxuICBCaW5kaW5nQmVoYXZpb3JSZXNvdXJjZS5jb252ZW50aW9uID0gZnVuY3Rpb24gY29udmVudGlvbihuYW1lKSB7XG4gICAgaWYgKG5hbWUuZW5kc1dpdGgoJ0JpbmRpbmdCZWhhdmlvcicpKSB7XG4gICAgICByZXR1cm4gbmV3IEJpbmRpbmdCZWhhdmlvclJlc291cmNlKGNhbWVsQ2FzZShuYW1lLnN1YnN0cmluZygwLCBuYW1lLmxlbmd0aCAtIDE1KSkpO1xuICAgIH1cbiAgfTtcblxuICBCaW5kaW5nQmVoYXZpb3JSZXNvdXJjZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIGluaXRpYWxpemUoY29udGFpbmVyLCB0YXJnZXQpIHtcbiAgICB0aGlzLmluc3RhbmNlID0gY29udGFpbmVyLmdldCh0YXJnZXQpO1xuICB9O1xuXG4gIEJpbmRpbmdCZWhhdmlvclJlc291cmNlLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIHJlZ2lzdGVyKHJlZ2lzdHJ5LCBuYW1lKSB7XG4gICAgcmVnaXN0cnkucmVnaXN0ZXJCaW5kaW5nQmVoYXZpb3IobmFtZSB8fCB0aGlzLm5hbWUsIHRoaXMuaW5zdGFuY2UpO1xuICB9O1xuXG4gIEJpbmRpbmdCZWhhdmlvclJlc291cmNlLnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24gbG9hZChjb250YWluZXIsIHRhcmdldCkge307XG5cbiAgcmV0dXJuIEJpbmRpbmdCZWhhdmlvclJlc291cmNlO1xufSgpO1xuXG5mdW5jdGlvbiBiaW5kaW5nQmVoYXZpb3IobmFtZU9yVGFyZ2V0KSB7XG4gIGlmIChuYW1lT3JUYXJnZXQgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2YgbmFtZU9yVGFyZ2V0ID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgICBfYXVyZWxpYU1ldGFkYXRhLm1ldGFkYXRhLmRlZmluZShfYXVyZWxpYU1ldGFkYXRhLm1ldGFkYXRhLnJlc291cmNlLCBuZXcgQmluZGluZ0JlaGF2aW9yUmVzb3VyY2UobmFtZU9yVGFyZ2V0KSwgdGFyZ2V0KTtcbiAgICB9O1xuICB9XG5cbiAgX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5kZWZpbmUoX2F1cmVsaWFNZXRhZGF0YS5tZXRhZGF0YS5yZXNvdXJjZSwgbmV3IEJpbmRpbmdCZWhhdmlvclJlc291cmNlKCksIG5hbWVPclRhcmdldCk7XG59XG5cbnZhciBMaXN0ZW5lckV4cHJlc3Npb24gPSBleHBvcnRzLkxpc3RlbmVyRXhwcmVzc2lvbiA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gTGlzdGVuZXJFeHByZXNzaW9uKGV2ZW50TWFuYWdlciwgdGFyZ2V0RXZlbnQsIHNvdXJjZUV4cHJlc3Npb24sIGRlbGVnYXRlLCBwcmV2ZW50RGVmYXVsdCwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgXG5cbiAgICB0aGlzLmV2ZW50TWFuYWdlciA9IGV2ZW50TWFuYWdlcjtcbiAgICB0aGlzLnRhcmdldEV2ZW50ID0gdGFyZ2V0RXZlbnQ7XG4gICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uID0gc291cmNlRXhwcmVzc2lvbjtcbiAgICB0aGlzLmRlbGVnYXRlID0gZGVsZWdhdGU7XG4gICAgdGhpcy5kaXNjcmV0ZSA9IHRydWU7XG4gICAgdGhpcy5wcmV2ZW50RGVmYXVsdCA9IHByZXZlbnREZWZhdWx0O1xuICAgIHRoaXMubG9va3VwRnVuY3Rpb25zID0gbG9va3VwRnVuY3Rpb25zO1xuICB9XG5cbiAgTGlzdGVuZXJFeHByZXNzaW9uLnByb3RvdHlwZS5jcmVhdGVCaW5kaW5nID0gZnVuY3Rpb24gY3JlYXRlQmluZGluZyh0YXJnZXQpIHtcbiAgICByZXR1cm4gbmV3IExpc3RlbmVyKHRoaXMuZXZlbnRNYW5hZ2VyLCB0aGlzLnRhcmdldEV2ZW50LCB0aGlzLmRlbGVnYXRlLCB0aGlzLnNvdXJjZUV4cHJlc3Npb24sIHRhcmdldCwgdGhpcy5wcmV2ZW50RGVmYXVsdCwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICB9O1xuXG4gIHJldHVybiBMaXN0ZW5lckV4cHJlc3Npb247XG59KCk7XG5cbnZhciBMaXN0ZW5lciA9IGV4cG9ydHMuTGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIExpc3RlbmVyKGV2ZW50TWFuYWdlciwgdGFyZ2V0RXZlbnQsIGRlbGVnYXRlLCBzb3VyY2VFeHByZXNzaW9uLCB0YXJnZXQsIHByZXZlbnREZWZhdWx0LCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICBcblxuICAgIHRoaXMuZXZlbnRNYW5hZ2VyID0gZXZlbnRNYW5hZ2VyO1xuICAgIHRoaXMudGFyZ2V0RXZlbnQgPSB0YXJnZXRFdmVudDtcbiAgICB0aGlzLmRlbGVnYXRlID0gZGVsZWdhdGU7XG4gICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uID0gc291cmNlRXhwcmVzc2lvbjtcbiAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcbiAgICB0aGlzLnByZXZlbnREZWZhdWx0ID0gcHJldmVudERlZmF1bHQ7XG4gICAgdGhpcy5sb29rdXBGdW5jdGlvbnMgPSBsb29rdXBGdW5jdGlvbnM7XG4gIH1cblxuICBMaXN0ZW5lci5wcm90b3R5cGUuY2FsbFNvdXJjZSA9IGZ1bmN0aW9uIGNhbGxTb3VyY2UoZXZlbnQpIHtcbiAgICB2YXIgb3ZlcnJpZGVDb250ZXh0ID0gdGhpcy5zb3VyY2Uub3ZlcnJpZGVDb250ZXh0O1xuICAgIG92ZXJyaWRlQ29udGV4dC4kZXZlbnQgPSBldmVudDtcbiAgICB2YXIgbXVzdEV2YWx1YXRlID0gdHJ1ZTtcbiAgICB2YXIgcmVzdWx0ID0gdGhpcy5zb3VyY2VFeHByZXNzaW9uLmV2YWx1YXRlKHRoaXMuc291cmNlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucywgbXVzdEV2YWx1YXRlKTtcbiAgICBkZWxldGUgb3ZlcnJpZGVDb250ZXh0LiRldmVudDtcbiAgICBpZiAocmVzdWx0ICE9PSB0cnVlICYmIHRoaXMucHJldmVudERlZmF1bHQpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgTGlzdGVuZXIucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiBiaW5kKHNvdXJjZSkge1xuICAgIHZhciBfdGhpczI4ID0gdGhpcztcblxuICAgIGlmICh0aGlzLmlzQm91bmQpIHtcbiAgICAgIGlmICh0aGlzLnNvdXJjZSA9PT0gc291cmNlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMudW5iaW5kKCk7XG4gICAgfVxuICAgIHRoaXMuaXNCb3VuZCA9IHRydWU7XG4gICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cbiAgICBpZiAodGhpcy5zb3VyY2VFeHByZXNzaW9uLmJpbmQpIHtcbiAgICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi5iaW5kKHRoaXMsIHNvdXJjZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICAgIH1cbiAgICB0aGlzLl9kaXNwb3NlTGlzdGVuZXIgPSB0aGlzLmV2ZW50TWFuYWdlci5hZGRFdmVudExpc3RlbmVyKHRoaXMudGFyZ2V0LCB0aGlzLnRhcmdldEV2ZW50LCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIHJldHVybiBfdGhpczI4LmNhbGxTb3VyY2UoZXZlbnQpO1xuICAgIH0sIHRoaXMuZGVsZWdhdGUpO1xuICB9O1xuXG4gIExpc3RlbmVyLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiB1bmJpbmQoKSB7XG4gICAgaWYgKCF0aGlzLmlzQm91bmQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5pc0JvdW5kID0gZmFsc2U7XG4gICAgaWYgKHRoaXMuc291cmNlRXhwcmVzc2lvbi51bmJpbmQpIHtcbiAgICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi51bmJpbmQodGhpcywgdGhpcy5zb3VyY2UpO1xuICAgIH1cbiAgICB0aGlzLnNvdXJjZSA9IG51bGw7XG4gICAgdGhpcy5fZGlzcG9zZUxpc3RlbmVyKCk7XG4gICAgdGhpcy5fZGlzcG9zZUxpc3RlbmVyID0gbnVsbDtcbiAgfTtcblxuICByZXR1cm4gTGlzdGVuZXI7XG59KCk7XG5cbmZ1bmN0aW9uIGdldEFVKGVsZW1lbnQpIHtcbiAgdmFyIGF1ID0gZWxlbWVudC5hdTtcblxuICBpZiAoYXUgPT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IG5ldyBFcnJvcignTm8gQXVyZWxpYSBBUElzIGFyZSBkZWZpbmVkIGZvciB0aGUgZWxlbWVudDogXCInICsgZWxlbWVudC50YWdOYW1lICsgJ1wiLicpO1xuICB9XG5cbiAgcmV0dXJuIGF1O1xufVxuXG52YXIgTmFtZUV4cHJlc3Npb24gPSBleHBvcnRzLk5hbWVFeHByZXNzaW9uID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBOYW1lRXhwcmVzc2lvbihzb3VyY2VFeHByZXNzaW9uLCBhcGlOYW1lLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICBcblxuICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbiA9IHNvdXJjZUV4cHJlc3Npb247XG4gICAgdGhpcy5hcGlOYW1lID0gYXBpTmFtZTtcbiAgICB0aGlzLmxvb2t1cEZ1bmN0aW9ucyA9IGxvb2t1cEZ1bmN0aW9ucztcbiAgICB0aGlzLmRpc2NyZXRlID0gdHJ1ZTtcbiAgfVxuXG4gIE5hbWVFeHByZXNzaW9uLnByb3RvdHlwZS5jcmVhdGVCaW5kaW5nID0gZnVuY3Rpb24gY3JlYXRlQmluZGluZyh0YXJnZXQpIHtcbiAgICByZXR1cm4gbmV3IE5hbWVCaW5kZXIodGhpcy5zb3VyY2VFeHByZXNzaW9uLCBOYW1lRXhwcmVzc2lvbi5sb2NhdGVBUEkodGFyZ2V0LCB0aGlzLmFwaU5hbWUpLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgTmFtZUV4cHJlc3Npb24ubG9jYXRlQVBJID0gZnVuY3Rpb24gbG9jYXRlQVBJKGVsZW1lbnQsIGFwaU5hbWUpIHtcbiAgICBzd2l0Y2ggKGFwaU5hbWUpIHtcbiAgICAgIGNhc2UgJ2VsZW1lbnQnOlxuICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgIGNhc2UgJ2NvbnRyb2xsZXInOlxuICAgICAgICByZXR1cm4gZ2V0QVUoZWxlbWVudCkuY29udHJvbGxlcjtcbiAgICAgIGNhc2UgJ3ZpZXctbW9kZWwnOlxuICAgICAgICByZXR1cm4gZ2V0QVUoZWxlbWVudCkuY29udHJvbGxlci52aWV3TW9kZWw7XG4gICAgICBjYXNlICd2aWV3JzpcbiAgICAgICAgcmV0dXJuIGdldEFVKGVsZW1lbnQpLmNvbnRyb2xsZXIudmlldztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHZhciB0YXJnZXQgPSBnZXRBVShlbGVtZW50KVthcGlOYW1lXTtcblxuICAgICAgICBpZiAodGFyZ2V0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0F0dGVtcHRlZCB0byByZWZlcmVuY2UgXCInICsgYXBpTmFtZSArICdcIiwgYnV0IGl0IHdhcyBub3QgZm91bmQgYW1vbmdzdCB0aGUgdGFyZ2V0XFwncyBBUEkuJyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGFyZ2V0LnZpZXdNb2RlbDtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIE5hbWVFeHByZXNzaW9uO1xufSgpO1xuXG52YXIgTmFtZUJpbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gTmFtZUJpbmRlcihzb3VyY2VFeHByZXNzaW9uLCB0YXJnZXQsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIFxuXG4gICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uID0gc291cmNlRXhwcmVzc2lvbjtcbiAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcbiAgICB0aGlzLmxvb2t1cEZ1bmN0aW9ucyA9IGxvb2t1cEZ1bmN0aW9ucztcbiAgfVxuXG4gIE5hbWVCaW5kZXIucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiBiaW5kKHNvdXJjZSkge1xuICAgIGlmICh0aGlzLmlzQm91bmQpIHtcbiAgICAgIGlmICh0aGlzLnNvdXJjZSA9PT0gc291cmNlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMudW5iaW5kKCk7XG4gICAgfVxuICAgIHRoaXMuaXNCb3VuZCA9IHRydWU7XG4gICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgaWYgKHRoaXMuc291cmNlRXhwcmVzc2lvbi5iaW5kKSB7XG4gICAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24uYmluZCh0aGlzLCBzb3VyY2UsIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcbiAgICB9XG4gICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uLmFzc2lnbih0aGlzLnNvdXJjZSwgdGhpcy50YXJnZXQsIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcbiAgfTtcblxuICBOYW1lQmluZGVyLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiB1bmJpbmQoKSB7XG4gICAgaWYgKCF0aGlzLmlzQm91bmQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5pc0JvdW5kID0gZmFsc2U7XG4gICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uLmFzc2lnbih0aGlzLnNvdXJjZSwgbnVsbCwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICAgIGlmICh0aGlzLnNvdXJjZUV4cHJlc3Npb24udW5iaW5kKSB7XG4gICAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24udW5iaW5kKHRoaXMsIHRoaXMuc291cmNlKTtcbiAgICB9XG4gICAgdGhpcy5zb3VyY2UgPSBudWxsO1xuICB9O1xuXG4gIHJldHVybiBOYW1lQmluZGVyO1xufSgpO1xuXG52YXIgTG9va3VwRnVuY3Rpb25zID0ge1xuICBiaW5kaW5nQmVoYXZpb3JzOiBmdW5jdGlvbiBiaW5kaW5nQmVoYXZpb3JzKG5hbWUpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfSxcbiAgdmFsdWVDb252ZXJ0ZXJzOiBmdW5jdGlvbiB2YWx1ZUNvbnZlcnRlcnMobmFtZSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59O1xuXG52YXIgQmluZGluZ0VuZ2luZSA9IGV4cG9ydHMuQmluZGluZ0VuZ2luZSA9IChfdGVtcDIgPSBfY2xhc3MxMyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQmluZGluZ0VuZ2luZShvYnNlcnZlckxvY2F0b3IsIHBhcnNlcikge1xuICAgIFxuXG4gICAgdGhpcy5vYnNlcnZlckxvY2F0b3IgPSBvYnNlcnZlckxvY2F0b3I7XG4gICAgdGhpcy5wYXJzZXIgPSBwYXJzZXI7XG4gIH1cblxuICBCaW5kaW5nRW5naW5lLnByb3RvdHlwZS5jcmVhdGVCaW5kaW5nRXhwcmVzc2lvbiA9IGZ1bmN0aW9uIGNyZWF0ZUJpbmRpbmdFeHByZXNzaW9uKHRhcmdldFByb3BlcnR5LCBzb3VyY2VFeHByZXNzaW9uKSB7XG4gICAgdmFyIG1vZGUgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDIgfHwgYXJndW1lbnRzWzJdID09PSB1bmRlZmluZWQgPyBiaW5kaW5nTW9kZS5vbmVXYXkgOiBhcmd1bWVudHNbMl07XG4gICAgdmFyIGxvb2t1cEZ1bmN0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMyB8fCBhcmd1bWVudHNbM10gPT09IHVuZGVmaW5lZCA/IExvb2t1cEZ1bmN0aW9ucyA6IGFyZ3VtZW50c1szXTtcblxuICAgIHJldHVybiBuZXcgQmluZGluZ0V4cHJlc3Npb24odGhpcy5vYnNlcnZlckxvY2F0b3IsIHRhcmdldFByb3BlcnR5LCB0aGlzLnBhcnNlci5wYXJzZShzb3VyY2VFeHByZXNzaW9uKSwgbW9kZSwgbG9va3VwRnVuY3Rpb25zKTtcbiAgfTtcblxuICBCaW5kaW5nRW5naW5lLnByb3RvdHlwZS5wcm9wZXJ0eU9ic2VydmVyID0gZnVuY3Rpb24gcHJvcGVydHlPYnNlcnZlcihvYmosIHByb3BlcnR5TmFtZSkge1xuICAgIHZhciBfdGhpczI5ID0gdGhpcztcblxuICAgIHJldHVybiB7XG4gICAgICBzdWJzY3JpYmU6IGZ1bmN0aW9uIHN1YnNjcmliZShjYWxsYmFjaykge1xuICAgICAgICB2YXIgb2JzZXJ2ZXIgPSBfdGhpczI5Lm9ic2VydmVyTG9jYXRvci5nZXRPYnNlcnZlcihvYmosIHByb3BlcnR5TmFtZSk7XG4gICAgICAgIG9ic2VydmVyLnN1YnNjcmliZShjYWxsYmFjayk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZGlzcG9zZTogZnVuY3Rpb24gZGlzcG9zZSgpIHtcbiAgICAgICAgICAgIHJldHVybiBvYnNlcnZlci51bnN1YnNjcmliZShjYWxsYmFjayk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH07XG4gIH07XG5cbiAgQmluZGluZ0VuZ2luZS5wcm90b3R5cGUuY29sbGVjdGlvbk9ic2VydmVyID0gZnVuY3Rpb24gY29sbGVjdGlvbk9ic2VydmVyKGNvbGxlY3Rpb24pIHtcbiAgICB2YXIgX3RoaXMzMCA9IHRoaXM7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3Vic2NyaWJlOiBmdW5jdGlvbiBzdWJzY3JpYmUoY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIG9ic2VydmVyID0gdm9pZCAwO1xuICAgICAgICBpZiAoY29sbGVjdGlvbiBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgb2JzZXJ2ZXIgPSBfdGhpczMwLm9ic2VydmVyTG9jYXRvci5nZXRBcnJheU9ic2VydmVyKGNvbGxlY3Rpb24pO1xuICAgICAgICB9IGVsc2UgaWYgKGNvbGxlY3Rpb24gaW5zdGFuY2VvZiBNYXApIHtcbiAgICAgICAgICBvYnNlcnZlciA9IF90aGlzMzAub2JzZXJ2ZXJMb2NhdG9yLmdldE1hcE9ic2VydmVyKGNvbGxlY3Rpb24pO1xuICAgICAgICB9IGVsc2UgaWYgKGNvbGxlY3Rpb24gaW5zdGFuY2VvZiBTZXQpIHtcbiAgICAgICAgICBvYnNlcnZlciA9IF90aGlzMzAub2JzZXJ2ZXJMb2NhdG9yLmdldFNldE9ic2VydmVyKGNvbGxlY3Rpb24pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignY29sbGVjdGlvbiBtdXN0IGJlIGFuIGluc3RhbmNlIG9mIEFycmF5LCBNYXAgb3IgU2V0LicpO1xuICAgICAgICB9XG4gICAgICAgIG9ic2VydmVyLnN1YnNjcmliZShjYWxsYmFjayk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZGlzcG9zZTogZnVuY3Rpb24gZGlzcG9zZSgpIHtcbiAgICAgICAgICAgIHJldHVybiBvYnNlcnZlci51bnN1YnNjcmliZShjYWxsYmFjayk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH07XG4gIH07XG5cbiAgQmluZGluZ0VuZ2luZS5wcm90b3R5cGUuZXhwcmVzc2lvbk9ic2VydmVyID0gZnVuY3Rpb24gZXhwcmVzc2lvbk9ic2VydmVyKGJpbmRpbmdDb250ZXh0LCBleHByZXNzaW9uKSB7XG4gICAgdmFyIHNjb3BlID0geyBiaW5kaW5nQ29udGV4dDogYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dDogY3JlYXRlT3ZlcnJpZGVDb250ZXh0KGJpbmRpbmdDb250ZXh0KSB9O1xuICAgIHJldHVybiBuZXcgRXhwcmVzc2lvbk9ic2VydmVyKHNjb3BlLCB0aGlzLnBhcnNlci5wYXJzZShleHByZXNzaW9uKSwgdGhpcy5vYnNlcnZlckxvY2F0b3IsIExvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgQmluZGluZ0VuZ2luZS5wcm90b3R5cGUucGFyc2VFeHByZXNzaW9uID0gZnVuY3Rpb24gcGFyc2VFeHByZXNzaW9uKGV4cHJlc3Npb24pIHtcbiAgICByZXR1cm4gdGhpcy5wYXJzZXIucGFyc2UoZXhwcmVzc2lvbik7XG4gIH07XG5cbiAgQmluZGluZ0VuZ2luZS5wcm90b3R5cGUucmVnaXN0ZXJBZGFwdGVyID0gZnVuY3Rpb24gcmVnaXN0ZXJBZGFwdGVyKGFkYXB0ZXIpIHtcbiAgICB0aGlzLm9ic2VydmVyTG9jYXRvci5hZGRBZGFwdGVyKGFkYXB0ZXIpO1xuICB9O1xuXG4gIHJldHVybiBCaW5kaW5nRW5naW5lO1xufSgpLCBfY2xhc3MxMy5pbmplY3QgPSBbT2JzZXJ2ZXJMb2NhdG9yLCBQYXJzZXJdLCBfdGVtcDIpO1xuXG5cbnZhciBzZXRQcm90byA9IFNldC5wcm90b3R5cGU7XG5cbmZ1bmN0aW9uIF9nZXRTZXRPYnNlcnZlcih0YXNrUXVldWUsIHNldCkge1xuICByZXR1cm4gTW9kaWZ5U2V0T2JzZXJ2ZXIuZm9yKHRhc2tRdWV1ZSwgc2V0KTtcbn1cblxuZXhwb3J0cy5nZXRTZXRPYnNlcnZlciA9IF9nZXRTZXRPYnNlcnZlcjtcblxudmFyIE1vZGlmeVNldE9ic2VydmVyID0gZnVuY3Rpb24gKF9Nb2RpZnlDb2xsZWN0aW9uT2JzZTMpIHtcbiAgX2luaGVyaXRzKE1vZGlmeVNldE9ic2VydmVyLCBfTW9kaWZ5Q29sbGVjdGlvbk9ic2UzKTtcblxuICBmdW5jdGlvbiBNb2RpZnlTZXRPYnNlcnZlcih0YXNrUXVldWUsIHNldCkge1xuICAgIFxuXG4gICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9Nb2RpZnlDb2xsZWN0aW9uT2JzZTMuY2FsbCh0aGlzLCB0YXNrUXVldWUsIHNldCkpO1xuICB9XG5cbiAgTW9kaWZ5U2V0T2JzZXJ2ZXIuZm9yID0gZnVuY3Rpb24gX2Zvcih0YXNrUXVldWUsIHNldCkge1xuICAgIGlmICghKCdfX3NldF9vYnNlcnZlcl9fJyBpbiBzZXQpKSB7XG4gICAgICB2YXIgb2JzZXJ2ZXIgPSBNb2RpZnlTZXRPYnNlcnZlci5jcmVhdGUodGFza1F1ZXVlLCBzZXQpO1xuICAgICAgUmVmbGVjdC5kZWZpbmVQcm9wZXJ0eShzZXQsICdfX3NldF9vYnNlcnZlcl9fJywgeyB2YWx1ZTogb2JzZXJ2ZXIsIGVudW1lcmFibGU6IGZhbHNlLCBjb25maWd1cmFibGU6IGZhbHNlIH0pO1xuICAgIH1cbiAgICByZXR1cm4gc2V0Ll9fc2V0X29ic2VydmVyX187XG4gIH07XG5cbiAgTW9kaWZ5U2V0T2JzZXJ2ZXIuY3JlYXRlID0gZnVuY3Rpb24gY3JlYXRlKHRhc2tRdWV1ZSwgc2V0KSB7XG4gICAgdmFyIG9ic2VydmVyID0gbmV3IE1vZGlmeVNldE9ic2VydmVyKHRhc2tRdWV1ZSwgc2V0KTtcblxuICAgIHZhciBwcm90byA9IHNldFByb3RvO1xuICAgIGlmIChwcm90by5hZGQgIT09IHNldC5hZGQgfHwgcHJvdG8uZGVsZXRlICE9PSBzZXQuZGVsZXRlIHx8IHByb3RvLmNsZWFyICE9PSBzZXQuY2xlYXIpIHtcbiAgICAgIHByb3RvID0ge1xuICAgICAgICBhZGQ6IHNldC5hZGQsXG4gICAgICAgIGRlbGV0ZTogc2V0LmRlbGV0ZSxcbiAgICAgICAgY2xlYXI6IHNldC5jbGVhclxuICAgICAgfTtcbiAgICB9XG5cbiAgICBzZXQuYWRkID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHR5cGUgPSAnYWRkJztcbiAgICAgIHZhciBvbGRTaXplID0gc2V0LnNpemU7XG4gICAgICB2YXIgbWV0aG9kQ2FsbFJlc3VsdCA9IHByb3RvLmFkZC5hcHBseShzZXQsIGFyZ3VtZW50cyk7XG4gICAgICB2YXIgaGFzVmFsdWUgPSBzZXQuc2l6ZSA9PT0gb2xkU2l6ZTtcbiAgICAgIGlmICghaGFzVmFsdWUpIHtcbiAgICAgICAgb2JzZXJ2ZXIuYWRkQ2hhbmdlUmVjb3JkKHtcbiAgICAgICAgICB0eXBlOiB0eXBlLFxuICAgICAgICAgIG9iamVjdDogc2V0LFxuICAgICAgICAgIHZhbHVlOiBBcnJheS5mcm9tKHNldCkucG9wKClcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbWV0aG9kQ2FsbFJlc3VsdDtcbiAgICB9O1xuXG4gICAgc2V0LmRlbGV0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBoYXNWYWx1ZSA9IHNldC5oYXMoYXJndW1lbnRzWzBdKTtcbiAgICAgIHZhciBtZXRob2RDYWxsUmVzdWx0ID0gcHJvdG8uZGVsZXRlLmFwcGx5KHNldCwgYXJndW1lbnRzKTtcbiAgICAgIGlmIChoYXNWYWx1ZSkge1xuICAgICAgICBvYnNlcnZlci5hZGRDaGFuZ2VSZWNvcmQoe1xuICAgICAgICAgIHR5cGU6ICdkZWxldGUnLFxuICAgICAgICAgIG9iamVjdDogc2V0LFxuICAgICAgICAgIHZhbHVlOiBhcmd1bWVudHNbMF1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbWV0aG9kQ2FsbFJlc3VsdDtcbiAgICB9O1xuXG4gICAgc2V0LmNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIG1ldGhvZENhbGxSZXN1bHQgPSBwcm90by5jbGVhci5hcHBseShzZXQsIGFyZ3VtZW50cyk7XG4gICAgICBvYnNlcnZlci5hZGRDaGFuZ2VSZWNvcmQoe1xuICAgICAgICB0eXBlOiAnY2xlYXInLFxuICAgICAgICBvYmplY3Q6IHNldFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gbWV0aG9kQ2FsbFJlc3VsdDtcbiAgICB9O1xuXG4gICAgcmV0dXJuIG9ic2VydmVyO1xuICB9O1xuXG4gIHJldHVybiBNb2RpZnlTZXRPYnNlcnZlcjtcbn0oTW9kaWZ5Q29sbGVjdGlvbk9ic2VydmVyKTtcblxuZnVuY3Rpb24gb2JzZXJ2YWJsZSh0YXJnZXRPckNvbmZpZywga2V5LCBkZXNjcmlwdG9yKSB7XG4gIGZ1bmN0aW9uIGRlY28odGFyZ2V0LCBrZXksIGRlc2NyaXB0b3IsIGNvbmZpZykge1xuICAgIGlmIChrZXkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnByb3RvdHlwZTtcbiAgICAgIGtleSA9IHR5cGVvZiBjb25maWcgPT09ICdzdHJpbmcnID8gY29uZmlnIDogY29uZmlnLm5hbWU7XG4gICAgfVxuXG4gICAgdmFyIGlubmVyUHJvcGVydHlOYW1lID0gJ18nICsga2V5O1xuXG4gICAgdmFyIGNhbGxiYWNrTmFtZSA9IGNvbmZpZyAmJiBjb25maWcuY2hhbmdlSGFuZGxlciB8fCBrZXkgKyAnQ2hhbmdlZCc7XG5cbiAgICBpZiAoZGVzY3JpcHRvcikge1xuICAgICAgaWYgKHR5cGVvZiBkZXNjcmlwdG9yLmluaXRpYWxpemVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHRhcmdldFtpbm5lclByb3BlcnR5TmFtZV0gPSBkZXNjcmlwdG9yLmluaXRpYWxpemVyKCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGRlc2NyaXB0b3IgPSB7fTtcbiAgICB9XG5cbiAgICBkZWxldGUgZGVzY3JpcHRvci53cml0YWJsZTtcbiAgICBkZWxldGUgZGVzY3JpcHRvci5pbml0aWFsaXplcjtcblxuICAgIGRlc2NyaXB0b3IuZ2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXNbaW5uZXJQcm9wZXJ0eU5hbWVdO1xuICAgIH07XG4gICAgZGVzY3JpcHRvci5zZXQgPSBmdW5jdGlvbiAobmV3VmFsdWUpIHtcbiAgICAgIHZhciBvbGRWYWx1ZSA9IHRoaXNbaW5uZXJQcm9wZXJ0eU5hbWVdO1xuICAgICAgdGhpc1tpbm5lclByb3BlcnR5TmFtZV0gPSBuZXdWYWx1ZTtcbiAgICAgIGlmICh0aGlzW2NhbGxiYWNrTmFtZV0pIHtcbiAgICAgICAgdGhpc1tjYWxsYmFja05hbWVdKG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGRlc2NyaXB0b3IuZ2V0LmRlcGVuZGVuY2llcyA9IFtpbm5lclByb3BlcnR5TmFtZV07XG5cbiAgICBSZWZsZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBkZXNjcmlwdG9yKTtcbiAgfVxuXG4gIGlmIChrZXkgPT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAodCwgaywgZCkge1xuICAgICAgcmV0dXJuIGRlY28odCwgaywgZCwgdGFyZ2V0T3JDb25maWcpO1xuICAgIH07XG4gIH1cbiAgcmV0dXJuIGRlY28odGFyZ2V0T3JDb25maWcsIGtleSwgZGVzY3JpcHRvcik7XG59XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtYmluZGluZy9kaXN0L2NvbW1vbmpzL2F1cmVsaWEtYmluZGluZy5qc1xuLy8gbW9kdWxlIGlkID0gNFxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLk9yaWdpbiA9IGV4cG9ydHMubWV0YWRhdGEgPSB1bmRlZmluZWQ7XG5cbnZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07XG5cbmV4cG9ydHMuZGVjb3JhdG9ycyA9IGRlY29yYXRvcnM7XG5leHBvcnRzLmRlcHJlY2F0ZWQgPSBkZXByZWNhdGVkO1xuZXhwb3J0cy5taXhpbiA9IG1peGluO1xuZXhwb3J0cy5wcm90b2NvbCA9IHByb3RvY29sO1xuXG52YXIgX2F1cmVsaWFQYWwgPSByZXF1aXJlKCdhdXJlbGlhLXBhbCcpO1xuXG5cblxudmFyIG1ldGFkYXRhID0gZXhwb3J0cy5tZXRhZGF0YSA9IHtcbiAgcmVzb3VyY2U6ICdhdXJlbGlhOnJlc291cmNlJyxcbiAgcGFyYW1UeXBlczogJ2Rlc2lnbjpwYXJhbXR5cGVzJyxcbiAgcHJvcGVydHlUeXBlOiAnZGVzaWduOnR5cGUnLFxuICBwcm9wZXJ0aWVzOiAnZGVzaWduOnByb3BlcnRpZXMnLFxuICBnZXQ6IGZ1bmN0aW9uIGdldChtZXRhZGF0YUtleSwgdGFyZ2V0LCB0YXJnZXRLZXkpIHtcbiAgICBpZiAoIXRhcmdldCkge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgdmFyIHJlc3VsdCA9IG1ldGFkYXRhLmdldE93bihtZXRhZGF0YUtleSwgdGFyZ2V0LCB0YXJnZXRLZXkpO1xuICAgIHJldHVybiByZXN1bHQgPT09IHVuZGVmaW5lZCA/IG1ldGFkYXRhLmdldChtZXRhZGF0YUtleSwgT2JqZWN0LmdldFByb3RvdHlwZU9mKHRhcmdldCksIHRhcmdldEtleSkgOiByZXN1bHQ7XG4gIH0sXG4gIGdldE93bjogZnVuY3Rpb24gZ2V0T3duKG1ldGFkYXRhS2V5LCB0YXJnZXQsIHRhcmdldEtleSkge1xuICAgIGlmICghdGFyZ2V0KSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbiAgICByZXR1cm4gUmVmbGVjdC5nZXRPd25NZXRhZGF0YShtZXRhZGF0YUtleSwgdGFyZ2V0LCB0YXJnZXRLZXkpO1xuICB9LFxuICBkZWZpbmU6IGZ1bmN0aW9uIGRlZmluZShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSwgdGFyZ2V0LCB0YXJnZXRLZXkpIHtcbiAgICBSZWZsZWN0LmRlZmluZU1ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlLCB0YXJnZXQsIHRhcmdldEtleSk7XG4gIH0sXG4gIGdldE9yQ3JlYXRlT3duOiBmdW5jdGlvbiBnZXRPckNyZWF0ZU93bihtZXRhZGF0YUtleSwgVHlwZSwgdGFyZ2V0LCB0YXJnZXRLZXkpIHtcbiAgICB2YXIgcmVzdWx0ID0gbWV0YWRhdGEuZ2V0T3duKG1ldGFkYXRhS2V5LCB0YXJnZXQsIHRhcmdldEtleSk7XG5cbiAgICBpZiAocmVzdWx0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJlc3VsdCA9IG5ldyBUeXBlKCk7XG4gICAgICBSZWZsZWN0LmRlZmluZU1ldGFkYXRhKG1ldGFkYXRhS2V5LCByZXN1bHQsIHRhcmdldCwgdGFyZ2V0S2V5KTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG59O1xuXG52YXIgb3JpZ2luU3RvcmFnZSA9IG5ldyBNYXAoKTtcbnZhciB1bmtub3duT3JpZ2luID0gT2JqZWN0LmZyZWV6ZSh7IG1vZHVsZUlkOiB1bmRlZmluZWQsIG1vZHVsZU1lbWJlcjogdW5kZWZpbmVkIH0pO1xuXG52YXIgT3JpZ2luID0gZXhwb3J0cy5PcmlnaW4gPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIE9yaWdpbihtb2R1bGVJZCwgbW9kdWxlTWVtYmVyKSB7XG4gICAgXG5cbiAgICB0aGlzLm1vZHVsZUlkID0gbW9kdWxlSWQ7XG4gICAgdGhpcy5tb2R1bGVNZW1iZXIgPSBtb2R1bGVNZW1iZXI7XG4gIH1cblxuICBPcmlnaW4uZ2V0ID0gZnVuY3Rpb24gZ2V0KGZuKSB7XG4gICAgdmFyIG9yaWdpbiA9IG9yaWdpblN0b3JhZ2UuZ2V0KGZuKTtcblxuICAgIGlmIChvcmlnaW4gPT09IHVuZGVmaW5lZCkge1xuICAgICAgX2F1cmVsaWFQYWwuUExBVEZPUk0uZWFjaE1vZHVsZShmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICBmb3IgKHZhciBuYW1lIGluIHZhbHVlKSB7XG4gICAgICAgICAgdmFyIGV4cCA9IHZhbHVlW25hbWVdO1xuICAgICAgICAgIGlmIChleHAgPT09IGZuKSB7XG4gICAgICAgICAgICBvcmlnaW5TdG9yYWdlLnNldChmbiwgb3JpZ2luID0gbmV3IE9yaWdpbihrZXksIG5hbWUpKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh2YWx1ZSA9PT0gZm4pIHtcbiAgICAgICAgICBvcmlnaW5TdG9yYWdlLnNldChmbiwgb3JpZ2luID0gbmV3IE9yaWdpbihrZXksICdkZWZhdWx0JykpO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG9yaWdpbiB8fCB1bmtub3duT3JpZ2luO1xuICB9O1xuXG4gIE9yaWdpbi5zZXQgPSBmdW5jdGlvbiBzZXQoZm4sIG9yaWdpbikge1xuICAgIG9yaWdpblN0b3JhZ2Uuc2V0KGZuLCBvcmlnaW4pO1xuICB9O1xuXG4gIHJldHVybiBPcmlnaW47XG59KCk7XG5cbmZ1bmN0aW9uIGRlY29yYXRvcnMoKSB7XG4gIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCByZXN0ID0gQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7XG4gICAgcmVzdFtfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgfVxuXG4gIHZhciBhcHBsaWNhdG9yID0gZnVuY3Rpb24gYXBwbGljYXRvcih0YXJnZXQsIGtleSwgZGVzY3JpcHRvcikge1xuICAgIHZhciBpID0gcmVzdC5sZW5ndGg7XG5cbiAgICBpZiAoa2V5KSB7XG4gICAgICBkZXNjcmlwdG9yID0gZGVzY3JpcHRvciB8fCB7XG4gICAgICAgIHZhbHVlOiB0YXJnZXRba2V5XSxcbiAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgICAgfTtcblxuICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICBkZXNjcmlwdG9yID0gcmVzdFtpXSh0YXJnZXQsIGtleSwgZGVzY3JpcHRvcikgfHwgZGVzY3JpcHRvcjtcbiAgICAgIH1cblxuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBkZXNjcmlwdG9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICB0YXJnZXQgPSByZXN0W2ldKHRhcmdldCkgfHwgdGFyZ2V0O1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0YXJnZXQ7XG4gIH07XG5cbiAgYXBwbGljYXRvci5vbiA9IGFwcGxpY2F0b3I7XG4gIHJldHVybiBhcHBsaWNhdG9yO1xufVxuXG5mdW5jdGlvbiBkZXByZWNhdGVkKG9wdGlvbnNPclRhcmdldCwgbWF5YmVLZXksIG1heWJlRGVzY3JpcHRvcikge1xuICBmdW5jdGlvbiBkZWNvcmF0b3IodGFyZ2V0LCBrZXksIGRlc2NyaXB0b3IpIHtcbiAgICB2YXIgbWV0aG9kU2lnbmF0dXJlID0gdGFyZ2V0LmNvbnN0cnVjdG9yLm5hbWUgKyAnIycgKyBrZXk7XG4gICAgdmFyIG9wdGlvbnMgPSBtYXliZUtleSA/IHt9IDogb3B0aW9uc09yVGFyZ2V0IHx8IHt9O1xuICAgIHZhciBtZXNzYWdlID0gJ0RFUFJFQ0FUSU9OIC0gJyArIG1ldGhvZFNpZ25hdHVyZTtcblxuICAgIGlmICh0eXBlb2YgZGVzY3JpcHRvci52YWx1ZSAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKCdPbmx5IG1ldGhvZHMgY2FuIGJlIG1hcmtlZCBhcyBkZXByZWNhdGVkLicpO1xuICAgIH1cblxuICAgIGlmIChvcHRpb25zLm1lc3NhZ2UpIHtcbiAgICAgIG1lc3NhZ2UgKz0gJyAtICcgKyBvcHRpb25zLm1lc3NhZ2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIF9leHRlbmRzKHt9LCBkZXNjcmlwdG9yLCB7XG4gICAgICB2YWx1ZTogZnVuY3Rpb24gZGVwcmVjYXRpb25XcmFwcGVyKCkge1xuICAgICAgICBpZiAob3B0aW9ucy5lcnJvcikge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4obWVzc2FnZSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZGVzY3JpcHRvci52YWx1ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIG1heWJlS2V5ID8gZGVjb3JhdG9yKG9wdGlvbnNPclRhcmdldCwgbWF5YmVLZXksIG1heWJlRGVzY3JpcHRvcikgOiBkZWNvcmF0b3I7XG59XG5cbmZ1bmN0aW9uIG1peGluKGJlaGF2aW9yKSB7XG4gIHZhciBpbnN0YW5jZUtleXMgPSBPYmplY3Qua2V5cyhiZWhhdmlvcik7XG5cbiAgZnVuY3Rpb24gX21peGluKHBvc3NpYmxlKSB7XG4gICAgdmFyIGRlY29yYXRvciA9IGZ1bmN0aW9uIGRlY29yYXRvcih0YXJnZXQpIHtcbiAgICAgIHZhciByZXNvbHZlZFRhcmdldCA9IHR5cGVvZiB0YXJnZXQgPT09ICdmdW5jdGlvbicgPyB0YXJnZXQucHJvdG90eXBlIDogdGFyZ2V0O1xuXG4gICAgICB2YXIgaSA9IGluc3RhbmNlS2V5cy5sZW5ndGg7XG4gICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgIHZhciBwcm9wZXJ0eSA9IGluc3RhbmNlS2V5c1tpXTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHJlc29sdmVkVGFyZ2V0LCBwcm9wZXJ0eSwge1xuICAgICAgICAgIHZhbHVlOiBiZWhhdmlvcltwcm9wZXJ0eV0sXG4gICAgICAgICAgd3JpdGFibGU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHJldHVybiBwb3NzaWJsZSA/IGRlY29yYXRvcihwb3NzaWJsZSkgOiBkZWNvcmF0b3I7XG4gIH1cblxuICByZXR1cm4gX21peGluO1xufVxuXG5mdW5jdGlvbiBhbHdheXNWYWxpZCgpIHtcbiAgcmV0dXJuIHRydWU7XG59XG5mdW5jdGlvbiBub0NvbXBvc2UoKSB7fVxuXG5mdW5jdGlvbiBlbnN1cmVQcm90b2NvbE9wdGlvbnMob3B0aW9ucykge1xuICBpZiAob3B0aW9ucyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgb3B0aW9ucyA9IHt9O1xuICB9IGVsc2UgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnZnVuY3Rpb24nKSB7XG4gICAgb3B0aW9ucyA9IHtcbiAgICAgIHZhbGlkYXRlOiBvcHRpb25zXG4gICAgfTtcbiAgfVxuXG4gIGlmICghb3B0aW9ucy52YWxpZGF0ZSkge1xuICAgIG9wdGlvbnMudmFsaWRhdGUgPSBhbHdheXNWYWxpZDtcbiAgfVxuXG4gIGlmICghb3B0aW9ucy5jb21wb3NlKSB7XG4gICAgb3B0aW9ucy5jb21wb3NlID0gbm9Db21wb3NlO1xuICB9XG5cbiAgcmV0dXJuIG9wdGlvbnM7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVByb3RvY29sVmFsaWRhdG9yKHZhbGlkYXRlKSB7XG4gIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgdmFyIHJlc3VsdCA9IHZhbGlkYXRlKHRhcmdldCk7XG4gICAgcmV0dXJuIHJlc3VsdCA9PT0gdHJ1ZTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlUHJvdG9jb2xBc3NlcnRlcihuYW1lLCB2YWxpZGF0ZSkge1xuICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCkge1xuICAgIHZhciByZXN1bHQgPSB2YWxpZGF0ZSh0YXJnZXQpO1xuICAgIGlmIChyZXN1bHQgIT09IHRydWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihyZXN1bHQgfHwgbmFtZSArICcgd2FzIG5vdCBjb3JyZWN0bHkgaW1wbGVtZW50ZWQuJyk7XG4gICAgfVxuICB9O1xufVxuXG5mdW5jdGlvbiBwcm90b2NvbChuYW1lLCBvcHRpb25zKSB7XG4gIG9wdGlvbnMgPSBlbnN1cmVQcm90b2NvbE9wdGlvbnMob3B0aW9ucyk7XG5cbiAgdmFyIHJlc3VsdCA9IGZ1bmN0aW9uIHJlc3VsdCh0YXJnZXQpIHtcbiAgICB2YXIgcmVzb2x2ZWRUYXJnZXQgPSB0eXBlb2YgdGFyZ2V0ID09PSAnZnVuY3Rpb24nID8gdGFyZ2V0LnByb3RvdHlwZSA6IHRhcmdldDtcblxuICAgIG9wdGlvbnMuY29tcG9zZShyZXNvbHZlZFRhcmdldCk7XG4gICAgcmVzdWx0LmFzc2VydChyZXNvbHZlZFRhcmdldCk7XG5cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocmVzb2x2ZWRUYXJnZXQsICdwcm90b2NvbDonICsgbmFtZSwge1xuICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICBjb25maWd1cmFibGU6IGZhbHNlLFxuICAgICAgd3JpdGFibGU6IGZhbHNlLFxuICAgICAgdmFsdWU6IHRydWVcbiAgICB9KTtcbiAgfTtcblxuICByZXN1bHQudmFsaWRhdGUgPSBjcmVhdGVQcm90b2NvbFZhbGlkYXRvcihvcHRpb25zLnZhbGlkYXRlKTtcbiAgcmVzdWx0LmFzc2VydCA9IGNyZWF0ZVByb3RvY29sQXNzZXJ0ZXIobmFtZSwgb3B0aW9ucy52YWxpZGF0ZSk7XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxucHJvdG9jb2wuY3JlYXRlID0gZnVuY3Rpb24gKG5hbWUsIG9wdGlvbnMpIHtcbiAgb3B0aW9ucyA9IGVuc3VyZVByb3RvY29sT3B0aW9ucyhvcHRpb25zKTtcbiAgdmFyIGhpZGRlbiA9ICdwcm90b2NvbDonICsgbmFtZTtcbiAgdmFyIHJlc3VsdCA9IGZ1bmN0aW9uIHJlc3VsdCh0YXJnZXQpIHtcbiAgICB2YXIgZGVjb3JhdG9yID0gcHJvdG9jb2wobmFtZSwgb3B0aW9ucyk7XG4gICAgcmV0dXJuIHRhcmdldCA/IGRlY29yYXRvcih0YXJnZXQpIDogZGVjb3JhdG9yO1xuICB9O1xuXG4gIHJlc3VsdC5kZWNvcmF0ZXMgPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgcmV0dXJuIG9ialtoaWRkZW5dID09PSB0cnVlO1xuICB9O1xuICByZXN1bHQudmFsaWRhdGUgPSBjcmVhdGVQcm90b2NvbFZhbGlkYXRvcihvcHRpb25zLnZhbGlkYXRlKTtcbiAgcmVzdWx0LmFzc2VydCA9IGNyZWF0ZVByb3RvY29sQXNzZXJ0ZXIobmFtZSwgb3B0aW9ucy52YWxpZGF0ZSk7XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtbWV0YWRhdGEvZGlzdC9jb21tb25qcy9hdXJlbGlhLW1ldGFkYXRhLmpzXG4vLyBtb2R1bGUgaWQgPSA2XG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuZ2V0TG9nZ2VyID0gZ2V0TG9nZ2VyO1xuZXhwb3J0cy5hZGRBcHBlbmRlciA9IGFkZEFwcGVuZGVyO1xuZXhwb3J0cy5zZXRMZXZlbCA9IHNldExldmVsO1xuXG5cblxudmFyIGxvZ0xldmVsID0gZXhwb3J0cy5sb2dMZXZlbCA9IHtcbiAgbm9uZTogMCxcbiAgZXJyb3I6IDEsXG4gIHdhcm46IDIsXG4gIGluZm86IDMsXG4gIGRlYnVnOiA0XG59O1xuXG52YXIgbG9nZ2VycyA9IHt9O1xudmFyIGN1cnJlbnRMZXZlbCA9IGxvZ0xldmVsLm5vbmU7XG52YXIgYXBwZW5kZXJzID0gW107XG52YXIgc2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7XG52YXIgbG9nZ2VyQ29uc3RydWN0aW9uS2V5ID0ge307XG5cbmZ1bmN0aW9uIGxvZyhsb2dnZXIsIGxldmVsLCBhcmdzKSB7XG4gIHZhciBpID0gYXBwZW5kZXJzLmxlbmd0aDtcbiAgdmFyIGN1cnJlbnQgPSB2b2lkIDA7XG5cbiAgYXJncyA9IHNsaWNlLmNhbGwoYXJncyk7XG4gIGFyZ3MudW5zaGlmdChsb2dnZXIpO1xuXG4gIHdoaWxlIChpLS0pIHtcbiAgICBjdXJyZW50ID0gYXBwZW5kZXJzW2ldO1xuICAgIGN1cnJlbnRbbGV2ZWxdLmFwcGx5KGN1cnJlbnQsIGFyZ3MpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGRlYnVnKCkge1xuICBpZiAoY3VycmVudExldmVsIDwgNCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxvZyh0aGlzLCAnZGVidWcnLCBhcmd1bWVudHMpO1xufVxuXG5mdW5jdGlvbiBpbmZvKCkge1xuICBpZiAoY3VycmVudExldmVsIDwgMykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxvZyh0aGlzLCAnaW5mbycsIGFyZ3VtZW50cyk7XG59XG5cbmZ1bmN0aW9uIHdhcm4oKSB7XG4gIGlmIChjdXJyZW50TGV2ZWwgPCAyKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbG9nKHRoaXMsICd3YXJuJywgYXJndW1lbnRzKTtcbn1cblxuZnVuY3Rpb24gZXJyb3IoKSB7XG4gIGlmIChjdXJyZW50TGV2ZWwgPCAxKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbG9nKHRoaXMsICdlcnJvcicsIGFyZ3VtZW50cyk7XG59XG5cbmZ1bmN0aW9uIGNvbm5lY3RMb2dnZXIobG9nZ2VyKSB7XG4gIGxvZ2dlci5kZWJ1ZyA9IGRlYnVnO1xuICBsb2dnZXIuaW5mbyA9IGluZm87XG4gIGxvZ2dlci53YXJuID0gd2FybjtcbiAgbG9nZ2VyLmVycm9yID0gZXJyb3I7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUxvZ2dlcihpZCkge1xuICB2YXIgbG9nZ2VyID0gbmV3IExvZ2dlcihpZCwgbG9nZ2VyQ29uc3RydWN0aW9uS2V5KTtcblxuICBpZiAoYXBwZW5kZXJzLmxlbmd0aCkge1xuICAgIGNvbm5lY3RMb2dnZXIobG9nZ2VyKTtcbiAgfVxuXG4gIHJldHVybiBsb2dnZXI7XG59XG5cbmZ1bmN0aW9uIGdldExvZ2dlcihpZCkge1xuICByZXR1cm4gbG9nZ2Vyc1tpZF0gfHwgKGxvZ2dlcnNbaWRdID0gY3JlYXRlTG9nZ2VyKGlkKSk7XG59XG5cbmZ1bmN0aW9uIGFkZEFwcGVuZGVyKGFwcGVuZGVyKSB7XG4gIGFwcGVuZGVycy5wdXNoKGFwcGVuZGVyKTtcblxuICBpZiAoYXBwZW5kZXJzLmxlbmd0aCA9PT0gMSkge1xuICAgIGZvciAodmFyIGtleSBpbiBsb2dnZXJzKSB7XG4gICAgICBjb25uZWN0TG9nZ2VyKGxvZ2dlcnNba2V5XSk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHNldExldmVsKGxldmVsKSB7XG4gIGN1cnJlbnRMZXZlbCA9IGxldmVsO1xufVxuXG52YXIgTG9nZ2VyID0gZXhwb3J0cy5Mb2dnZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIExvZ2dlcihpZCwga2V5KSB7XG4gICAgXG5cbiAgICBpZiAoa2V5ICE9PSBsb2dnZXJDb25zdHJ1Y3Rpb25LZXkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGluc3RhbnRpYXRlIFwiTG9nZ2VyXCIuIFVzZSBcImdldExvZ2dlclwiIGluc3RlYWQuJyk7XG4gICAgfVxuXG4gICAgdGhpcy5pZCA9IGlkO1xuICB9XG5cbiAgTG9nZ2VyLnByb3RvdHlwZS5kZWJ1ZyA9IGZ1bmN0aW9uIGRlYnVnKG1lc3NhZ2UpIHt9O1xuXG4gIExvZ2dlci5wcm90b3R5cGUuaW5mbyA9IGZ1bmN0aW9uIGluZm8obWVzc2FnZSkge307XG5cbiAgTG9nZ2VyLnByb3RvdHlwZS53YXJuID0gZnVuY3Rpb24gd2FybihtZXNzYWdlKSB7fTtcblxuICBMb2dnZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gZXJyb3IobWVzc2FnZSkge307XG5cbiAgcmV0dXJuIExvZ2dlcjtcbn0oKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS1sb2dnaW5nL2Rpc3QvY29tbW9uanMvYXVyZWxpYS1sb2dnaW5nLmpzXG4vLyBtb2R1bGUgaWQgPSA3XG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcblxudmFyIF90eXBlb2YgPSB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gXCJzeW1ib2xcIiA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sID8gXCJzeW1ib2xcIiA6IHR5cGVvZiBvYmo7IH07XG5cbmV4cG9ydHMucmVsYXRpdmVUb0ZpbGUgPSByZWxhdGl2ZVRvRmlsZTtcbmV4cG9ydHMuam9pbiA9IGpvaW47XG5leHBvcnRzLmJ1aWxkUXVlcnlTdHJpbmcgPSBidWlsZFF1ZXJ5U3RyaW5nO1xuZXhwb3J0cy5wYXJzZVF1ZXJ5U3RyaW5nID0gcGFyc2VRdWVyeVN0cmluZztcblxuZnVuY3Rpb24gdHJpbURvdHMoYXJ5KSB7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgYXJ5Lmxlbmd0aDsgKytpKSB7XG4gICAgdmFyIHBhcnQgPSBhcnlbaV07XG4gICAgaWYgKHBhcnQgPT09ICcuJykge1xuICAgICAgYXJ5LnNwbGljZShpLCAxKTtcbiAgICAgIGkgLT0gMTtcbiAgICB9IGVsc2UgaWYgKHBhcnQgPT09ICcuLicpIHtcbiAgICAgIGlmIChpID09PSAwIHx8IGkgPT09IDEgJiYgYXJ5WzJdID09PSAnLi4nIHx8IGFyeVtpIC0gMV0gPT09ICcuLicpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9IGVsc2UgaWYgKGkgPiAwKSB7XG4gICAgICAgIGFyeS5zcGxpY2UoaSAtIDEsIDIpO1xuICAgICAgICBpIC09IDI7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHJlbGF0aXZlVG9GaWxlKG5hbWUsIGZpbGUpIHtcbiAgdmFyIGZpbGVQYXJ0cyA9IGZpbGUgJiYgZmlsZS5zcGxpdCgnLycpO1xuICB2YXIgbmFtZVBhcnRzID0gbmFtZS50cmltKCkuc3BsaXQoJy8nKTtcblxuICBpZiAobmFtZVBhcnRzWzBdLmNoYXJBdCgwKSA9PT0gJy4nICYmIGZpbGVQYXJ0cykge1xuICAgIHZhciBub3JtYWxpemVkQmFzZVBhcnRzID0gZmlsZVBhcnRzLnNsaWNlKDAsIGZpbGVQYXJ0cy5sZW5ndGggLSAxKTtcbiAgICBuYW1lUGFydHMudW5zaGlmdC5hcHBseShuYW1lUGFydHMsIG5vcm1hbGl6ZWRCYXNlUGFydHMpO1xuICB9XG5cbiAgdHJpbURvdHMobmFtZVBhcnRzKTtcblxuICByZXR1cm4gbmFtZVBhcnRzLmpvaW4oJy8nKTtcbn1cblxuZnVuY3Rpb24gam9pbihwYXRoMSwgcGF0aDIpIHtcbiAgaWYgKCFwYXRoMSkge1xuICAgIHJldHVybiBwYXRoMjtcbiAgfVxuXG4gIGlmICghcGF0aDIpIHtcbiAgICByZXR1cm4gcGF0aDE7XG4gIH1cblxuICB2YXIgc2NoZW1lTWF0Y2ggPSBwYXRoMS5tYXRjaCgvXihbXi9dKj86KVxcLy8pO1xuICB2YXIgc2NoZW1lID0gc2NoZW1lTWF0Y2ggJiYgc2NoZW1lTWF0Y2gubGVuZ3RoID4gMCA/IHNjaGVtZU1hdGNoWzFdIDogJyc7XG4gIHBhdGgxID0gcGF0aDEuc3Vic3RyKHNjaGVtZS5sZW5ndGgpO1xuXG4gIHZhciB1cmxQcmVmaXggPSB2b2lkIDA7XG4gIGlmIChwYXRoMS5pbmRleE9mKCcvLy8nKSA9PT0gMCAmJiBzY2hlbWUgPT09ICdmaWxlOicpIHtcbiAgICB1cmxQcmVmaXggPSAnLy8vJztcbiAgfSBlbHNlIGlmIChwYXRoMS5pbmRleE9mKCcvLycpID09PSAwKSB7XG4gICAgdXJsUHJlZml4ID0gJy8vJztcbiAgfSBlbHNlIGlmIChwYXRoMS5pbmRleE9mKCcvJykgPT09IDApIHtcbiAgICB1cmxQcmVmaXggPSAnLyc7XG4gIH0gZWxzZSB7XG4gICAgdXJsUHJlZml4ID0gJyc7XG4gIH1cblxuICB2YXIgdHJhaWxpbmdTbGFzaCA9IHBhdGgyLnNsaWNlKC0xKSA9PT0gJy8nID8gJy8nIDogJyc7XG5cbiAgdmFyIHVybDEgPSBwYXRoMS5zcGxpdCgnLycpO1xuICB2YXIgdXJsMiA9IHBhdGgyLnNwbGl0KCcvJyk7XG4gIHZhciB1cmwzID0gW107XG5cbiAgZm9yICh2YXIgaSA9IDAsIGlpID0gdXJsMS5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgaWYgKHVybDFbaV0gPT09ICcuLicpIHtcbiAgICAgIHVybDMucG9wKCk7XG4gICAgfSBlbHNlIGlmICh1cmwxW2ldID09PSAnLicgfHwgdXJsMVtpXSA9PT0gJycpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB1cmwzLnB1c2godXJsMVtpXSk7XG4gICAgfVxuICB9XG5cbiAgZm9yICh2YXIgX2kgPSAwLCBfaWkgPSB1cmwyLmxlbmd0aDsgX2kgPCBfaWk7ICsrX2kpIHtcbiAgICBpZiAodXJsMltfaV0gPT09ICcuLicpIHtcbiAgICAgIHVybDMucG9wKCk7XG4gICAgfSBlbHNlIGlmICh1cmwyW19pXSA9PT0gJy4nIHx8IHVybDJbX2ldID09PSAnJykge1xuICAgICAgY29udGludWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHVybDMucHVzaCh1cmwyW19pXSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHNjaGVtZSArIHVybFByZWZpeCArIHVybDMuam9pbignLycpICsgdHJhaWxpbmdTbGFzaDtcbn1cblxudmFyIGVuY29kZSA9IGVuY29kZVVSSUNvbXBvbmVudDtcbnZhciBlbmNvZGVLZXkgPSBmdW5jdGlvbiBlbmNvZGVLZXkoaykge1xuICByZXR1cm4gZW5jb2RlKGspLnJlcGxhY2UoJyUyNCcsICckJyk7XG59O1xuXG5mdW5jdGlvbiBidWlsZFBhcmFtKGtleSwgdmFsdWUpIHtcbiAgdmFyIHJlc3VsdCA9IFtdO1xuICBpZiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbiAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgZm9yICh2YXIgaSA9IDAsIGwgPSB2YWx1ZS5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgIHZhciBhcnJheUtleSA9IGtleSArICdbJyArIChfdHlwZW9mKHZhbHVlW2ldKSA9PT0gJ29iamVjdCcgJiYgdmFsdWVbaV0gIT09IG51bGwgPyBpIDogJycpICsgJ10nO1xuICAgICAgcmVzdWx0ID0gcmVzdWx0LmNvbmNhdChidWlsZFBhcmFtKGFycmF5S2V5LCB2YWx1ZVtpXSkpO1xuICAgIH1cbiAgfSBlbHNlIGlmICgodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZih2YWx1ZSkpID09PSAnb2JqZWN0Jykge1xuICAgIGZvciAodmFyIHByb3BlcnR5TmFtZSBpbiB2YWx1ZSkge1xuICAgICAgcmVzdWx0ID0gcmVzdWx0LmNvbmNhdChidWlsZFBhcmFtKGtleSArICdbJyArIHByb3BlcnR5TmFtZSArICddJywgdmFsdWVbcHJvcGVydHlOYW1lXSkpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICByZXN1bHQucHVzaChlbmNvZGVLZXkoa2V5KSArICc9JyArIGVuY29kZSh2YWx1ZSkpO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkUXVlcnlTdHJpbmcocGFyYW1zKSB7XG4gIHZhciBwYWlycyA9IFtdO1xuICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKHBhcmFtcyB8fCB7fSkuc29ydCgpO1xuICBmb3IgKHZhciBpID0gMCwgbGVuID0ga2V5cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgIHZhciBrZXkgPSBrZXlzW2ldO1xuICAgIHBhaXJzID0gcGFpcnMuY29uY2F0KGJ1aWxkUGFyYW0oa2V5LCBwYXJhbXNba2V5XSkpO1xuICB9XG5cbiAgaWYgKHBhaXJzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiAnJztcbiAgfVxuXG4gIHJldHVybiBwYWlycy5qb2luKCcmJyk7XG59XG5cbmZ1bmN0aW9uIHByb2Nlc3NTY2FsYXJQYXJhbShleGlzdGVkUGFyYW0sIHZhbHVlLCBpc1ByaW1pdGl2ZSkge1xuICBpZiAoQXJyYXkuaXNBcnJheShleGlzdGVkUGFyYW0pKSB7XG4gICAgZXhpc3RlZFBhcmFtLnB1c2godmFsdWUpO1xuICAgIHJldHVybiBleGlzdGVkUGFyYW07XG4gIH1cbiAgaWYgKGV4aXN0ZWRQYXJhbSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIGlzUHJpbWl0aXZlID8gdmFsdWUgOiBbZXhpc3RlZFBhcmFtLCB2YWx1ZV07XG4gIH1cblxuICByZXR1cm4gdmFsdWU7XG59XG5cbmZ1bmN0aW9uIHBhcnNlQ29tcGxleFBhcmFtKHF1ZXJ5UGFyYW1zLCBrZXlzLCB2YWx1ZSkge1xuICB2YXIgY3VycmVudFBhcmFtcyA9IHF1ZXJ5UGFyYW1zO1xuICB2YXIga2V5c0xhc3RJbmRleCA9IGtleXMubGVuZ3RoIC0gMTtcbiAgZm9yICh2YXIgaiA9IDA7IGogPD0ga2V5c0xhc3RJbmRleDsgaisrKSB7XG4gICAgdmFyIGtleSA9IGtleXNbal0gPT09ICcnID8gY3VycmVudFBhcmFtcy5sZW5ndGggOiBrZXlzW2pdO1xuICAgIGlmIChqIDwga2V5c0xhc3RJbmRleCkge1xuICAgICAgY3VycmVudFBhcmFtcyA9IGN1cnJlbnRQYXJhbXNba2V5XSA9IGN1cnJlbnRQYXJhbXNba2V5XSB8fCAoaXNOYU4oa2V5c1tqICsgMV0pID8ge30gOiBbXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGN1cnJlbnRQYXJhbXMgPSBjdXJyZW50UGFyYW1zW2tleV0gPSB2YWx1ZTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gcGFyc2VRdWVyeVN0cmluZyhxdWVyeVN0cmluZykge1xuICB2YXIgcXVlcnlQYXJhbXMgPSB7fTtcbiAgaWYgKCFxdWVyeVN0cmluZyB8fCB0eXBlb2YgcXVlcnlTdHJpbmcgIT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIHF1ZXJ5UGFyYW1zO1xuICB9XG5cbiAgdmFyIHF1ZXJ5ID0gcXVlcnlTdHJpbmc7XG4gIGlmIChxdWVyeS5jaGFyQXQoMCkgPT09ICc/Jykge1xuICAgIHF1ZXJ5ID0gcXVlcnkuc3Vic3RyKDEpO1xuICB9XG5cbiAgdmFyIHBhaXJzID0gcXVlcnkucmVwbGFjZSgvXFwrL2csICcgJykuc3BsaXQoJyYnKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYWlycy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBwYWlyID0gcGFpcnNbaV0uc3BsaXQoJz0nKTtcbiAgICB2YXIga2V5ID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhaXJbMF0pO1xuICAgIHZhciBpc1ByaW1pdGl2ZSA9IGZhbHNlO1xuICAgIGlmICgha2V5KSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICB2YXIga2V5cyA9IGtleS5zcGxpdCgnXVsnKTtcbiAgICB2YXIga2V5c0xhc3RJbmRleCA9IGtleXMubGVuZ3RoIC0gMTtcblxuICAgIGlmICgvXFxbLy50ZXN0KGtleXNbMF0pICYmIC9cXF0kLy50ZXN0KGtleXNba2V5c0xhc3RJbmRleF0pKSB7XG4gICAgICBrZXlzW2tleXNMYXN0SW5kZXhdID0ga2V5c1trZXlzTGFzdEluZGV4XS5yZXBsYWNlKC9cXF0kLywgJycpO1xuICAgICAga2V5cyA9IGtleXMuc2hpZnQoKS5zcGxpdCgnWycpLmNvbmNhdChrZXlzKTtcbiAgICAgIGtleXNMYXN0SW5kZXggPSBrZXlzLmxlbmd0aCAtIDE7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlzUHJpbWl0aXZlID0gdHJ1ZTtcbiAgICAgIGtleXNMYXN0SW5kZXggPSAwO1xuICAgIH1cblxuICAgIGlmIChwYWlyLmxlbmd0aCA+PSAyKSB7XG4gICAgICB2YXIgdmFsdWUgPSBwYWlyWzFdID8gZGVjb2RlVVJJQ29tcG9uZW50KHBhaXJbMV0pIDogJyc7XG4gICAgICBpZiAoa2V5c0xhc3RJbmRleCkge1xuICAgICAgICBwYXJzZUNvbXBsZXhQYXJhbShxdWVyeVBhcmFtcywga2V5cywgdmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcXVlcnlQYXJhbXNba2V5XSA9IHByb2Nlc3NTY2FsYXJQYXJhbShxdWVyeVBhcmFtc1trZXldLCB2YWx1ZSwgaXNQcmltaXRpdmUpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBxdWVyeVBhcmFtc1trZXldID0gdHJ1ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHF1ZXJ5UGFyYW1zO1xufVxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLXBhdGgvZGlzdC9jb21tb25qcy9hdXJlbGlhLXBhdGguanNcbi8vIG1vZHVsZSBpZCA9IDhcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5BcHBSb3V0ZXIgPSBleHBvcnRzLlBpcGVsaW5lUHJvdmlkZXIgPSBleHBvcnRzLkxvYWRSb3V0ZVN0ZXAgPSBleHBvcnRzLlJvdXRlTG9hZGVyID0gZXhwb3J0cy5BY3RpdmF0ZU5leHRTdGVwID0gZXhwb3J0cy5EZWFjdGl2YXRlUHJldmlvdXNTdGVwID0gZXhwb3J0cy5DYW5BY3RpdmF0ZU5leHRTdGVwID0gZXhwb3J0cy5DYW5EZWFjdGl2YXRlUHJldmlvdXNTdGVwID0gZXhwb3J0cy5Sb3V0ZXIgPSBleHBvcnRzLkJ1aWxkTmF2aWdhdGlvblBsYW5TdGVwID0gZXhwb3J0cy5hY3RpdmF0aW9uU3RyYXRlZ3kgPSBleHBvcnRzLlJvdXRlckNvbmZpZ3VyYXRpb24gPSBleHBvcnRzLlJlZGlyZWN0VG9Sb3V0ZSA9IGV4cG9ydHMuUmVkaXJlY3QgPSBleHBvcnRzLk5hdk1vZGVsID0gZXhwb3J0cy5OYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24gPSBleHBvcnRzLkNvbW1pdENoYW5nZXNTdGVwID0gZXhwb3J0cy5QaXBlbGluZSA9IGV4cG9ydHMucGlwZWxpbmVTdGF0dXMgPSB1bmRlZmluZWQ7XG5cbnZhciBfdHlwZW9mID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09IFwic3ltYm9sXCIgPyBmdW5jdGlvbiAob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9IDogZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCA/IFwic3ltYm9sXCIgOiB0eXBlb2Ygb2JqOyB9O1xuXG52YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpO1xuXG5leHBvcnRzLl9ub3JtYWxpemVBYnNvbHV0ZVBhdGggPSBfbm9ybWFsaXplQWJzb2x1dGVQYXRoO1xuZXhwb3J0cy5fY3JlYXRlUm9vdGVkUGF0aCA9IF9jcmVhdGVSb290ZWRQYXRoO1xuZXhwb3J0cy5fcmVzb2x2ZVVybCA9IF9yZXNvbHZlVXJsO1xuZXhwb3J0cy5pc05hdmlnYXRpb25Db21tYW5kID0gaXNOYXZpZ2F0aW9uQ29tbWFuZDtcbmV4cG9ydHMuX2J1aWxkTmF2aWdhdGlvblBsYW4gPSBfYnVpbGROYXZpZ2F0aW9uUGxhbjtcblxudmFyIF9hdXJlbGlhTG9nZ2luZyA9IHJlcXVpcmUoJ2F1cmVsaWEtbG9nZ2luZycpO1xuXG52YXIgTG9nTWFuYWdlciA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKF9hdXJlbGlhTG9nZ2luZyk7XG5cbnZhciBfYXVyZWxpYVJvdXRlUmVjb2duaXplciA9IHJlcXVpcmUoJ2F1cmVsaWEtcm91dGUtcmVjb2duaXplcicpO1xuXG52YXIgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uID0gcmVxdWlyZSgnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbicpO1xuXG52YXIgX2F1cmVsaWFIaXN0b3J5ID0gcmVxdWlyZSgnYXVyZWxpYS1oaXN0b3J5Jyk7XG5cbnZhciBfYXVyZWxpYUV2ZW50QWdncmVnYXRvciA9IHJlcXVpcmUoJ2F1cmVsaWEtZXZlbnQtYWdncmVnYXRvcicpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgeyByZXR1cm4gb2JqOyB9IGVsc2UgeyB2YXIgbmV3T2JqID0ge307IGlmIChvYmogIT0gbnVsbCkgeyBmb3IgKHZhciBrZXkgaW4gb2JqKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSBuZXdPYmpba2V5XSA9IG9ialtrZXldOyB9IH0gbmV3T2JqLmRlZmF1bHQgPSBvYmo7IHJldHVybiBuZXdPYmo7IH0gfVxuXG5mdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmICghc2VsZikgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoXCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWRcIik7IH0gcmV0dXJuIGNhbGwgJiYgKHR5cGVvZiBjYWxsID09PSBcIm9iamVjdFwiIHx8IHR5cGVvZiBjYWxsID09PSBcImZ1bmN0aW9uXCIpID8gY2FsbCA6IHNlbGY7IH1cblxuZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gXCJmdW5jdGlvblwiICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgXCIgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9XG5cblxuXG5mdW5jdGlvbiBfbm9ybWFsaXplQWJzb2x1dGVQYXRoKHBhdGgsIGhhc1B1c2hTdGF0ZSkge1xuICB2YXIgYWJzb2x1dGUgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDIgfHwgYXJndW1lbnRzWzJdID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IGFyZ3VtZW50c1syXTtcblxuICBpZiAoIWhhc1B1c2hTdGF0ZSAmJiBwYXRoWzBdICE9PSAnIycpIHtcbiAgICBwYXRoID0gJyMnICsgcGF0aDtcbiAgfVxuXG4gIGlmIChoYXNQdXNoU3RhdGUgJiYgYWJzb2x1dGUpIHtcbiAgICBwYXRoID0gcGF0aC5zdWJzdHJpbmcoMSwgcGF0aC5sZW5ndGgpO1xuICB9XG5cbiAgcmV0dXJuIHBhdGg7XG59XG5cbmZ1bmN0aW9uIF9jcmVhdGVSb290ZWRQYXRoKGZyYWdtZW50LCBiYXNlVXJsLCBoYXNQdXNoU3RhdGUsIGFic29sdXRlKSB7XG4gIGlmIChpc0Fic29sdXRlVXJsLnRlc3QoZnJhZ21lbnQpKSB7XG4gICAgcmV0dXJuIGZyYWdtZW50O1xuICB9XG5cbiAgdmFyIHBhdGggPSAnJztcblxuICBpZiAoYmFzZVVybC5sZW5ndGggJiYgYmFzZVVybFswXSAhPT0gJy8nKSB7XG4gICAgcGF0aCArPSAnLyc7XG4gIH1cblxuICBwYXRoICs9IGJhc2VVcmw7XG5cbiAgaWYgKCghcGF0aC5sZW5ndGggfHwgcGF0aFtwYXRoLmxlbmd0aCAtIDFdICE9PSAnLycpICYmIGZyYWdtZW50WzBdICE9PSAnLycpIHtcbiAgICBwYXRoICs9ICcvJztcbiAgfVxuXG4gIGlmIChwYXRoLmxlbmd0aCAmJiBwYXRoW3BhdGgubGVuZ3RoIC0gMV0gPT09ICcvJyAmJiBmcmFnbWVudFswXSA9PT0gJy8nKSB7XG4gICAgcGF0aCA9IHBhdGguc3Vic3RyaW5nKDAsIHBhdGgubGVuZ3RoIC0gMSk7XG4gIH1cblxuICByZXR1cm4gX25vcm1hbGl6ZUFic29sdXRlUGF0aChwYXRoICsgZnJhZ21lbnQsIGhhc1B1c2hTdGF0ZSwgYWJzb2x1dGUpO1xufVxuXG5mdW5jdGlvbiBfcmVzb2x2ZVVybChmcmFnbWVudCwgYmFzZVVybCwgaGFzUHVzaFN0YXRlKSB7XG4gIGlmIChpc1Jvb3RlZFBhdGgudGVzdChmcmFnbWVudCkpIHtcbiAgICByZXR1cm4gX25vcm1hbGl6ZUFic29sdXRlUGF0aChmcmFnbWVudCwgaGFzUHVzaFN0YXRlKTtcbiAgfVxuXG4gIHJldHVybiBfY3JlYXRlUm9vdGVkUGF0aChmcmFnbWVudCwgYmFzZVVybCwgaGFzUHVzaFN0YXRlKTtcbn1cblxudmFyIGlzUm9vdGVkUGF0aCA9IC9eIz9cXC8vO1xudmFyIGlzQWJzb2x1dGVVcmwgPSAvXihbYS16XVthLXowLTkrXFwtLl0qOik/XFwvXFwvL2k7XG5cbnZhciBwaXBlbGluZVN0YXR1cyA9IGV4cG9ydHMucGlwZWxpbmVTdGF0dXMgPSB7XG4gIGNvbXBsZXRlZDogJ2NvbXBsZXRlZCcsXG4gIGNhbmNlbGVkOiAnY2FuY2VsZWQnLFxuICByZWplY3RlZDogJ3JlamVjdGVkJyxcbiAgcnVubmluZzogJ3J1bm5pbmcnXG59O1xuXG52YXIgUGlwZWxpbmUgPSBleHBvcnRzLlBpcGVsaW5lID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBQaXBlbGluZSgpIHtcbiAgICBcblxuICAgIHRoaXMuc3RlcHMgPSBbXTtcbiAgfVxuXG4gIFBpcGVsaW5lLnByb3RvdHlwZS5hZGRTdGVwID0gZnVuY3Rpb24gYWRkU3RlcChzdGVwKSB7XG4gICAgdmFyIHJ1biA9IHZvaWQgMDtcblxuICAgIGlmICh0eXBlb2Ygc3RlcCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgcnVuID0gc3RlcDtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBzdGVwLmdldFN0ZXBzID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICB2YXIgc3RlcHMgPSBzdGVwLmdldFN0ZXBzKCk7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHN0ZXBzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICB0aGlzLmFkZFN0ZXAoc3RlcHNbaV0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9IGVsc2Uge1xuICAgICAgcnVuID0gc3RlcC5ydW4uYmluZChzdGVwKTtcbiAgICB9XG5cbiAgICB0aGlzLnN0ZXBzLnB1c2gocnVuKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIFBpcGVsaW5lLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiBydW4oaW5zdHJ1Y3Rpb24pIHtcbiAgICB2YXIgaW5kZXggPSAtMTtcbiAgICB2YXIgc3RlcHMgPSB0aGlzLnN0ZXBzO1xuXG4gICAgZnVuY3Rpb24gbmV4dCgpIHtcbiAgICAgIGluZGV4Kys7XG5cbiAgICAgIGlmIChpbmRleCA8IHN0ZXBzLmxlbmd0aCkge1xuICAgICAgICB2YXIgY3VycmVudFN0ZXAgPSBzdGVwc1tpbmRleF07XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICByZXR1cm4gY3VycmVudFN0ZXAoaW5zdHJ1Y3Rpb24sIG5leHQpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgcmV0dXJuIG5leHQucmVqZWN0KGUpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gbmV4dC5jb21wbGV0ZSgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIG5leHQuY29tcGxldGUgPSBjcmVhdGVDb21wbGV0aW9uSGFuZGxlcihuZXh0LCBwaXBlbGluZVN0YXR1cy5jb21wbGV0ZWQpO1xuICAgIG5leHQuY2FuY2VsID0gY3JlYXRlQ29tcGxldGlvbkhhbmRsZXIobmV4dCwgcGlwZWxpbmVTdGF0dXMuY2FuY2VsZWQpO1xuICAgIG5leHQucmVqZWN0ID0gY3JlYXRlQ29tcGxldGlvbkhhbmRsZXIobmV4dCwgcGlwZWxpbmVTdGF0dXMucmVqZWN0ZWQpO1xuXG4gICAgcmV0dXJuIG5leHQoKTtcbiAgfTtcblxuICByZXR1cm4gUGlwZWxpbmU7XG59KCk7XG5cbmZ1bmN0aW9uIGNyZWF0ZUNvbXBsZXRpb25IYW5kbGVyKG5leHQsIHN0YXR1cykge1xuICByZXR1cm4gZnVuY3Rpb24gKG91dHB1dCkge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoeyBzdGF0dXM6IHN0YXR1cywgb3V0cHV0OiBvdXRwdXQsIGNvbXBsZXRlZDogc3RhdHVzID09PSBwaXBlbGluZVN0YXR1cy5jb21wbGV0ZWQgfSk7XG4gIH07XG59XG5cbnZhciBDb21taXRDaGFuZ2VzU3RlcCA9IGV4cG9ydHMuQ29tbWl0Q2hhbmdlc1N0ZXAgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIENvbW1pdENoYW5nZXNTdGVwKCkge1xuICAgIFxuICB9XG5cbiAgQ29tbWl0Q2hhbmdlc1N0ZXAucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uIHJ1bihuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24sIG5leHQpIHtcbiAgICByZXR1cm4gbmF2aWdhdGlvbkluc3RydWN0aW9uLl9jb21taXRDaGFuZ2VzKHRydWUpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgbmF2aWdhdGlvbkluc3RydWN0aW9uLl91cGRhdGVUaXRsZSgpO1xuICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICB9KTtcbiAgfTtcblxuICByZXR1cm4gQ29tbWl0Q2hhbmdlc1N0ZXA7XG59KCk7XG5cbnZhciBOYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24gPSBleHBvcnRzLk5hdmlnYXRpb25JbnN0cnVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gTmF2aWdhdGlvbkluc3RydWN0aW9uKGluaXQpIHtcbiAgICBcblxuICAgIHRoaXMucGxhbiA9IG51bGw7XG4gICAgdGhpcy5vcHRpb25zID0ge307XG5cbiAgICBPYmplY3QuYXNzaWduKHRoaXMsIGluaXQpO1xuXG4gICAgdGhpcy5wYXJhbXMgPSB0aGlzLnBhcmFtcyB8fCB7fTtcbiAgICB0aGlzLnZpZXdQb3J0SW5zdHJ1Y3Rpb25zID0ge307XG5cbiAgICB2YXIgYW5jZXN0b3JQYXJhbXMgPSBbXTtcbiAgICB2YXIgY3VycmVudCA9IHRoaXM7XG4gICAgZG8ge1xuICAgICAgdmFyIGN1cnJlbnRQYXJhbXMgPSBPYmplY3QuYXNzaWduKHt9LCBjdXJyZW50LnBhcmFtcyk7XG4gICAgICBpZiAoY3VycmVudC5jb25maWcgJiYgY3VycmVudC5jb25maWcuaGFzQ2hpbGRSb3V0ZXIpIHtcbiAgICAgICAgZGVsZXRlIGN1cnJlbnRQYXJhbXNbY3VycmVudC5nZXRXaWxkQ2FyZE5hbWUoKV07XG4gICAgICB9XG5cbiAgICAgIGFuY2VzdG9yUGFyYW1zLnVuc2hpZnQoY3VycmVudFBhcmFtcyk7XG4gICAgICBjdXJyZW50ID0gY3VycmVudC5wYXJlbnRJbnN0cnVjdGlvbjtcbiAgICB9IHdoaWxlIChjdXJyZW50KTtcblxuICAgIHZhciBhbGxQYXJhbXMgPSBPYmplY3QuYXNzaWduLmFwcGx5KE9iamVjdCwgW3t9LCB0aGlzLnF1ZXJ5UGFyYW1zXS5jb25jYXQoYW5jZXN0b3JQYXJhbXMpKTtcbiAgICB0aGlzLmxpZmVjeWNsZUFyZ3MgPSBbYWxsUGFyYW1zLCB0aGlzLmNvbmZpZywgdGhpc107XG4gIH1cblxuICBOYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24ucHJvdG90eXBlLmdldEFsbEluc3RydWN0aW9ucyA9IGZ1bmN0aW9uIGdldEFsbEluc3RydWN0aW9ucygpIHtcbiAgICB2YXIgaW5zdHJ1Y3Rpb25zID0gW3RoaXNdO1xuICAgIGZvciAodmFyIGtleSBpbiB0aGlzLnZpZXdQb3J0SW5zdHJ1Y3Rpb25zKSB7XG4gICAgICB2YXIgY2hpbGRJbnN0cnVjdGlvbiA9IHRoaXMudmlld1BvcnRJbnN0cnVjdGlvbnNba2V5XS5jaGlsZE5hdmlnYXRpb25JbnN0cnVjdGlvbjtcbiAgICAgIGlmIChjaGlsZEluc3RydWN0aW9uKSB7XG4gICAgICAgIGluc3RydWN0aW9ucy5wdXNoLmFwcGx5KGluc3RydWN0aW9ucywgY2hpbGRJbnN0cnVjdGlvbi5nZXRBbGxJbnN0cnVjdGlvbnMoKSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGluc3RydWN0aW9ucztcbiAgfTtcblxuICBOYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24ucHJvdG90eXBlLmdldEFsbFByZXZpb3VzSW5zdHJ1Y3Rpb25zID0gZnVuY3Rpb24gZ2V0QWxsUHJldmlvdXNJbnN0cnVjdGlvbnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0QWxsSW5zdHJ1Y3Rpb25zKCkubWFwKGZ1bmN0aW9uIChjKSB7XG4gICAgICByZXR1cm4gYy5wcmV2aW91c0luc3RydWN0aW9uO1xuICAgIH0pLmZpbHRlcihmdW5jdGlvbiAoYykge1xuICAgICAgcmV0dXJuIGM7XG4gICAgfSk7XG4gIH07XG5cbiAgTmF2aWdhdGlvbkluc3RydWN0aW9uLnByb3RvdHlwZS5hZGRWaWV3UG9ydEluc3RydWN0aW9uID0gZnVuY3Rpb24gYWRkVmlld1BvcnRJbnN0cnVjdGlvbih2aWV3UG9ydE5hbWUsIHN0cmF0ZWd5LCBtb2R1bGVJZCwgY29tcG9uZW50KSB7XG4gICAgdmFyIHZpZXdwb3J0SW5zdHJ1Y3Rpb24gPSB0aGlzLnZpZXdQb3J0SW5zdHJ1Y3Rpb25zW3ZpZXdQb3J0TmFtZV0gPSB7XG4gICAgICBuYW1lOiB2aWV3UG9ydE5hbWUsXG4gICAgICBzdHJhdGVneTogc3RyYXRlZ3ksXG4gICAgICBtb2R1bGVJZDogbW9kdWxlSWQsXG4gICAgICBjb21wb25lbnQ6IGNvbXBvbmVudCxcbiAgICAgIGNoaWxkUm91dGVyOiBjb21wb25lbnQuY2hpbGRSb3V0ZXIsXG4gICAgICBsaWZlY3ljbGVBcmdzOiB0aGlzLmxpZmVjeWNsZUFyZ3Muc2xpY2UoKVxuICAgIH07XG5cbiAgICByZXR1cm4gdmlld3BvcnRJbnN0cnVjdGlvbjtcbiAgfTtcblxuICBOYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24ucHJvdG90eXBlLmdldFdpbGRDYXJkTmFtZSA9IGZ1bmN0aW9uIGdldFdpbGRDYXJkTmFtZSgpIHtcbiAgICB2YXIgd2lsZGNhcmRJbmRleCA9IHRoaXMuY29uZmlnLnJvdXRlLmxhc3RJbmRleE9mKCcqJyk7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLnJvdXRlLnN1YnN0cih3aWxkY2FyZEluZGV4ICsgMSk7XG4gIH07XG5cbiAgTmF2aWdhdGlvbkluc3RydWN0aW9uLnByb3RvdHlwZS5nZXRXaWxkY2FyZFBhdGggPSBmdW5jdGlvbiBnZXRXaWxkY2FyZFBhdGgoKSB7XG4gICAgdmFyIHdpbGRjYXJkTmFtZSA9IHRoaXMuZ2V0V2lsZENhcmROYW1lKCk7XG4gICAgdmFyIHBhdGggPSB0aGlzLnBhcmFtc1t3aWxkY2FyZE5hbWVdIHx8ICcnO1xuXG4gICAgaWYgKHRoaXMucXVlcnlTdHJpbmcpIHtcbiAgICAgIHBhdGggKz0gJz8nICsgdGhpcy5xdWVyeVN0cmluZztcbiAgICB9XG5cbiAgICByZXR1cm4gcGF0aDtcbiAgfTtcblxuICBOYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24ucHJvdG90eXBlLmdldEJhc2VVcmwgPSBmdW5jdGlvbiBnZXRCYXNlVXJsKCkge1xuICAgIGlmICghdGhpcy5wYXJhbXMpIHtcbiAgICAgIHJldHVybiB0aGlzLmZyYWdtZW50O1xuICAgIH1cblxuICAgIHZhciB3aWxkY2FyZE5hbWUgPSB0aGlzLmdldFdpbGRDYXJkTmFtZSgpO1xuICAgIHZhciBwYXRoID0gdGhpcy5wYXJhbXNbd2lsZGNhcmROYW1lXSB8fCAnJztcblxuICAgIGlmICghcGF0aCkge1xuICAgICAgcmV0dXJuIHRoaXMuZnJhZ21lbnQ7XG4gICAgfVxuXG4gICAgcGF0aCA9IGVuY29kZVVSSShwYXRoKTtcbiAgICByZXR1cm4gdGhpcy5mcmFnbWVudC5zdWJzdHIoMCwgdGhpcy5mcmFnbWVudC5sYXN0SW5kZXhPZihwYXRoKSk7XG4gIH07XG5cbiAgTmF2aWdhdGlvbkluc3RydWN0aW9uLnByb3RvdHlwZS5fY29tbWl0Q2hhbmdlcyA9IGZ1bmN0aW9uIF9jb21taXRDaGFuZ2VzKHdhaXRUb1N3YXApIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgdmFyIHJvdXRlciA9IHRoaXMucm91dGVyO1xuICAgIHJvdXRlci5jdXJyZW50SW5zdHJ1Y3Rpb24gPSB0aGlzO1xuXG4gICAgaWYgKHRoaXMucHJldmlvdXNJbnN0cnVjdGlvbikge1xuICAgICAgdGhpcy5wcmV2aW91c0luc3RydWN0aW9uLmNvbmZpZy5uYXZNb2RlbC5pc0FjdGl2ZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIHRoaXMuY29uZmlnLm5hdk1vZGVsLmlzQWN0aXZlID0gdHJ1ZTtcblxuICAgIHJvdXRlci5fcmVmcmVzaEJhc2VVcmwoKTtcbiAgICByb3V0ZXIucmVmcmVzaE5hdmlnYXRpb24oKTtcblxuICAgIHZhciBsb2FkcyA9IFtdO1xuICAgIHZhciBkZWxheVN3YXBzID0gW107XG5cbiAgICB2YXIgX2xvb3AgPSBmdW5jdGlvbiBfbG9vcCh2aWV3UG9ydE5hbWUpIHtcbiAgICAgIHZhciB2aWV3UG9ydEluc3RydWN0aW9uID0gX3RoaXMudmlld1BvcnRJbnN0cnVjdGlvbnNbdmlld1BvcnROYW1lXTtcbiAgICAgIHZhciB2aWV3UG9ydCA9IHJvdXRlci52aWV3UG9ydHNbdmlld1BvcnROYW1lXTtcblxuICAgICAgaWYgKCF2aWV3UG9ydCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZXJlIHdhcyBubyByb3V0ZXItdmlldyBmb3VuZCBpbiB0aGUgdmlldyBmb3IgJyArIHZpZXdQb3J0SW5zdHJ1Y3Rpb24ubW9kdWxlSWQgKyAnLicpO1xuICAgICAgfVxuXG4gICAgICBpZiAodmlld1BvcnRJbnN0cnVjdGlvbi5zdHJhdGVneSA9PT0gYWN0aXZhdGlvblN0cmF0ZWd5LnJlcGxhY2UpIHtcbiAgICAgICAgaWYgKHdhaXRUb1N3YXApIHtcbiAgICAgICAgICBkZWxheVN3YXBzLnB1c2goeyB2aWV3UG9ydDogdmlld1BvcnQsIHZpZXdQb3J0SW5zdHJ1Y3Rpb246IHZpZXdQb3J0SW5zdHJ1Y3Rpb24gfSk7XG4gICAgICAgIH1cblxuICAgICAgICBsb2Fkcy5wdXNoKHZpZXdQb3J0LnByb2Nlc3Modmlld1BvcnRJbnN0cnVjdGlvbiwgd2FpdFRvU3dhcCkudGhlbihmdW5jdGlvbiAoeCkge1xuICAgICAgICAgIGlmICh2aWV3UG9ydEluc3RydWN0aW9uLmNoaWxkTmF2aWdhdGlvbkluc3RydWN0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gdmlld1BvcnRJbnN0cnVjdGlvbi5jaGlsZE5hdmlnYXRpb25JbnN0cnVjdGlvbi5fY29tbWl0Q2hhbmdlcygpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH0pKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh2aWV3UG9ydEluc3RydWN0aW9uLmNoaWxkTmF2aWdhdGlvbkluc3RydWN0aW9uKSB7XG4gICAgICAgICAgbG9hZHMucHVzaCh2aWV3UG9ydEluc3RydWN0aW9uLmNoaWxkTmF2aWdhdGlvbkluc3RydWN0aW9uLl9jb21taXRDaGFuZ2VzKHdhaXRUb1N3YXApKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICBmb3IgKHZhciB2aWV3UG9ydE5hbWUgaW4gdGhpcy52aWV3UG9ydEluc3RydWN0aW9ucykge1xuICAgICAgX2xvb3Aodmlld1BvcnROYW1lKTtcbiAgICB9XG5cbiAgICByZXR1cm4gUHJvbWlzZS5hbGwobG9hZHMpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgZGVsYXlTd2Fwcy5mb3JFYWNoKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIHJldHVybiB4LnZpZXdQb3J0LnN3YXAoeC52aWV3UG9ydEluc3RydWN0aW9uKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gcHJ1bmUoX3RoaXMpO1xuICAgIH0pO1xuICB9O1xuXG4gIE5hdmlnYXRpb25JbnN0cnVjdGlvbi5wcm90b3R5cGUuX3VwZGF0ZVRpdGxlID0gZnVuY3Rpb24gX3VwZGF0ZVRpdGxlKCkge1xuICAgIHZhciB0aXRsZSA9IHRoaXMuX2J1aWxkVGl0bGUoKTtcbiAgICBpZiAodGl0bGUpIHtcbiAgICAgIHRoaXMucm91dGVyLmhpc3Rvcnkuc2V0VGl0bGUodGl0bGUpO1xuICAgIH1cbiAgfTtcblxuICBOYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24ucHJvdG90eXBlLl9idWlsZFRpdGxlID0gZnVuY3Rpb24gX2J1aWxkVGl0bGUoKSB7XG4gICAgdmFyIHNlcGFyYXRvciA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMCB8fCBhcmd1bWVudHNbMF0gPT09IHVuZGVmaW5lZCA/ICcgfCAnIDogYXJndW1lbnRzWzBdO1xuXG4gICAgdmFyIHRpdGxlID0gdGhpcy5jb25maWcubmF2TW9kZWwudGl0bGUgfHwgJyc7XG4gICAgdmFyIGNoaWxkVGl0bGVzID0gW107XG5cbiAgICBmb3IgKHZhciB2aWV3UG9ydE5hbWUgaW4gdGhpcy52aWV3UG9ydEluc3RydWN0aW9ucykge1xuICAgICAgdmFyIF92aWV3UG9ydEluc3RydWN0aW9uID0gdGhpcy52aWV3UG9ydEluc3RydWN0aW9uc1t2aWV3UG9ydE5hbWVdO1xuXG4gICAgICBpZiAoX3ZpZXdQb3J0SW5zdHJ1Y3Rpb24uY2hpbGROYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24pIHtcbiAgICAgICAgdmFyIGNoaWxkVGl0bGUgPSBfdmlld1BvcnRJbnN0cnVjdGlvbi5jaGlsZE5hdmlnYXRpb25JbnN0cnVjdGlvbi5fYnVpbGRUaXRsZShzZXBhcmF0b3IpO1xuICAgICAgICBpZiAoY2hpbGRUaXRsZSkge1xuICAgICAgICAgIGNoaWxkVGl0bGVzLnB1c2goY2hpbGRUaXRsZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoY2hpbGRUaXRsZXMubGVuZ3RoKSB7XG4gICAgICB0aXRsZSA9IGNoaWxkVGl0bGVzLmpvaW4oc2VwYXJhdG9yKSArICh0aXRsZSA/IHNlcGFyYXRvciA6ICcnKSArIHRpdGxlO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnJvdXRlci50aXRsZSkge1xuICAgICAgdGl0bGUgKz0gKHRpdGxlID8gc2VwYXJhdG9yIDogJycpICsgdGhpcy5yb3V0ZXIudGl0bGU7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRpdGxlO1xuICB9O1xuXG4gIHJldHVybiBOYXZpZ2F0aW9uSW5zdHJ1Y3Rpb247XG59KCk7XG5cbmZ1bmN0aW9uIHBydW5lKGluc3RydWN0aW9uKSB7XG4gIGluc3RydWN0aW9uLnByZXZpb3VzSW5zdHJ1Y3Rpb24gPSBudWxsO1xuICBpbnN0cnVjdGlvbi5wbGFuID0gbnVsbDtcbn1cblxudmFyIE5hdk1vZGVsID0gZXhwb3J0cy5OYXZNb2RlbCA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gTmF2TW9kZWwocm91dGVyLCByZWxhdGl2ZUhyZWYpIHtcbiAgICBcblxuICAgIHRoaXMuaXNBY3RpdmUgPSBmYWxzZTtcbiAgICB0aGlzLnRpdGxlID0gbnVsbDtcbiAgICB0aGlzLmhyZWYgPSBudWxsO1xuICAgIHRoaXMucmVsYXRpdmVIcmVmID0gbnVsbDtcbiAgICB0aGlzLnNldHRpbmdzID0ge307XG4gICAgdGhpcy5jb25maWcgPSBudWxsO1xuXG4gICAgdGhpcy5yb3V0ZXIgPSByb3V0ZXI7XG4gICAgdGhpcy5yZWxhdGl2ZUhyZWYgPSByZWxhdGl2ZUhyZWY7XG4gIH1cblxuICBOYXZNb2RlbC5wcm90b3R5cGUuc2V0VGl0bGUgPSBmdW5jdGlvbiBzZXRUaXRsZSh0aXRsZSkge1xuICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcblxuICAgIGlmICh0aGlzLmlzQWN0aXZlKSB7XG4gICAgICB0aGlzLnJvdXRlci51cGRhdGVUaXRsZSgpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gTmF2TW9kZWw7XG59KCk7XG5cbmZ1bmN0aW9uIGlzTmF2aWdhdGlvbkNvbW1hbmQob2JqKSB7XG4gIHJldHVybiBvYmogJiYgdHlwZW9mIG9iai5uYXZpZ2F0ZSA9PT0gJ2Z1bmN0aW9uJztcbn1cblxudmFyIFJlZGlyZWN0ID0gZXhwb3J0cy5SZWRpcmVjdCA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gUmVkaXJlY3QodXJsKSB7XG4gICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDEgfHwgYXJndW1lbnRzWzFdID09PSB1bmRlZmluZWQgPyB7fSA6IGFyZ3VtZW50c1sxXTtcblxuICAgIFxuXG4gICAgdGhpcy51cmwgPSB1cmw7XG4gICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IHRyaWdnZXI6IHRydWUsIHJlcGxhY2U6IHRydWUgfSwgb3B0aW9ucyk7XG4gICAgdGhpcy5zaG91bGRDb250aW51ZVByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgfVxuXG4gIFJlZGlyZWN0LnByb3RvdHlwZS5zZXRSb3V0ZXIgPSBmdW5jdGlvbiBzZXRSb3V0ZXIocm91dGVyKSB7XG4gICAgdGhpcy5yb3V0ZXIgPSByb3V0ZXI7XG4gIH07XG5cbiAgUmVkaXJlY3QucHJvdG90eXBlLm5hdmlnYXRlID0gZnVuY3Rpb24gbmF2aWdhdGUoYXBwUm91dGVyKSB7XG4gICAgdmFyIG5hdmlnYXRpbmdSb3V0ZXIgPSB0aGlzLm9wdGlvbnMudXNlQXBwUm91dGVyID8gYXBwUm91dGVyIDogdGhpcy5yb3V0ZXIgfHwgYXBwUm91dGVyO1xuICAgIG5hdmlnYXRpbmdSb3V0ZXIubmF2aWdhdGUodGhpcy51cmwsIHRoaXMub3B0aW9ucyk7XG4gIH07XG5cbiAgcmV0dXJuIFJlZGlyZWN0O1xufSgpO1xuXG52YXIgUmVkaXJlY3RUb1JvdXRlID0gZXhwb3J0cy5SZWRpcmVjdFRvUm91dGUgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFJlZGlyZWN0VG9Sb3V0ZShyb3V0ZSkge1xuICAgIHZhciBwYXJhbXMgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDEgfHwgYXJndW1lbnRzWzFdID09PSB1bmRlZmluZWQgPyB7fSA6IGFyZ3VtZW50c1sxXTtcbiAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMiB8fCBhcmd1bWVudHNbMl0gPT09IHVuZGVmaW5lZCA/IHt9IDogYXJndW1lbnRzWzJdO1xuXG4gICAgXG5cbiAgICB0aGlzLnJvdXRlID0gcm91dGU7XG4gICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7XG4gICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IHRyaWdnZXI6IHRydWUsIHJlcGxhY2U6IHRydWUgfSwgb3B0aW9ucyk7XG4gICAgdGhpcy5zaG91bGRDb250aW51ZVByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgfVxuXG4gIFJlZGlyZWN0VG9Sb3V0ZS5wcm90b3R5cGUuc2V0Um91dGVyID0gZnVuY3Rpb24gc2V0Um91dGVyKHJvdXRlcikge1xuICAgIHRoaXMucm91dGVyID0gcm91dGVyO1xuICB9O1xuXG4gIFJlZGlyZWN0VG9Sb3V0ZS5wcm90b3R5cGUubmF2aWdhdGUgPSBmdW5jdGlvbiBuYXZpZ2F0ZShhcHBSb3V0ZXIpIHtcbiAgICB2YXIgbmF2aWdhdGluZ1JvdXRlciA9IHRoaXMub3B0aW9ucy51c2VBcHBSb3V0ZXIgPyBhcHBSb3V0ZXIgOiB0aGlzLnJvdXRlciB8fCBhcHBSb3V0ZXI7XG4gICAgbmF2aWdhdGluZ1JvdXRlci5uYXZpZ2F0ZVRvUm91dGUodGhpcy5yb3V0ZSwgdGhpcy5wYXJhbXMsIHRoaXMub3B0aW9ucyk7XG4gIH07XG5cbiAgcmV0dXJuIFJlZGlyZWN0VG9Sb3V0ZTtcbn0oKTtcblxudmFyIFJvdXRlckNvbmZpZ3VyYXRpb24gPSBleHBvcnRzLlJvdXRlckNvbmZpZ3VyYXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFJvdXRlckNvbmZpZ3VyYXRpb24oKSB7XG4gICAgXG5cbiAgICB0aGlzLmluc3RydWN0aW9ucyA9IFtdO1xuICAgIHRoaXMub3B0aW9ucyA9IHt9O1xuICAgIHRoaXMucGlwZWxpbmVTdGVwcyA9IFtdO1xuICB9XG5cbiAgUm91dGVyQ29uZmlndXJhdGlvbi5wcm90b3R5cGUuYWRkUGlwZWxpbmVTdGVwID0gZnVuY3Rpb24gYWRkUGlwZWxpbmVTdGVwKG5hbWUsIHN0ZXApIHtcbiAgICB0aGlzLnBpcGVsaW5lU3RlcHMucHVzaCh7IG5hbWU6IG5hbWUsIHN0ZXA6IHN0ZXAgfSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgUm91dGVyQ29uZmlndXJhdGlvbi5wcm90b3R5cGUuYWRkQXV0aG9yaXplU3RlcCA9IGZ1bmN0aW9uIGFkZEF1dGhvcml6ZVN0ZXAoc3RlcCkge1xuICAgIHJldHVybiB0aGlzLmFkZFBpcGVsaW5lU3RlcCgnYXV0aG9yaXplJywgc3RlcCk7XG4gIH07XG5cbiAgUm91dGVyQ29uZmlndXJhdGlvbi5wcm90b3R5cGUuYWRkUHJlQWN0aXZhdGVTdGVwID0gZnVuY3Rpb24gYWRkUHJlQWN0aXZhdGVTdGVwKHN0ZXApIHtcbiAgICByZXR1cm4gdGhpcy5hZGRQaXBlbGluZVN0ZXAoJ3ByZUFjdGl2YXRlJywgc3RlcCk7XG4gIH07XG5cbiAgUm91dGVyQ29uZmlndXJhdGlvbi5wcm90b3R5cGUuYWRkUHJlUmVuZGVyU3RlcCA9IGZ1bmN0aW9uIGFkZFByZVJlbmRlclN0ZXAoc3RlcCkge1xuICAgIHJldHVybiB0aGlzLmFkZFBpcGVsaW5lU3RlcCgncHJlUmVuZGVyJywgc3RlcCk7XG4gIH07XG5cbiAgUm91dGVyQ29uZmlndXJhdGlvbi5wcm90b3R5cGUuYWRkUG9zdFJlbmRlclN0ZXAgPSBmdW5jdGlvbiBhZGRQb3N0UmVuZGVyU3RlcChzdGVwKSB7XG4gICAgcmV0dXJuIHRoaXMuYWRkUGlwZWxpbmVTdGVwKCdwb3N0UmVuZGVyJywgc3RlcCk7XG4gIH07XG5cbiAgUm91dGVyQ29uZmlndXJhdGlvbi5wcm90b3R5cGUubWFwID0gZnVuY3Rpb24gbWFwKHJvdXRlKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkocm91dGUpKSB7XG4gICAgICByb3V0ZS5mb3JFYWNoKHRoaXMubWFwLmJpbmQodGhpcykpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMubWFwUm91dGUocm91dGUpO1xuICB9O1xuXG4gIFJvdXRlckNvbmZpZ3VyYXRpb24ucHJvdG90eXBlLm1hcFJvdXRlID0gZnVuY3Rpb24gbWFwUm91dGUoY29uZmlnKSB7XG4gICAgdGhpcy5pbnN0cnVjdGlvbnMucHVzaChmdW5jdGlvbiAocm91dGVyKSB7XG4gICAgICB2YXIgcm91dGVDb25maWdzID0gW107XG5cbiAgICAgIGlmIChBcnJheS5pc0FycmF5KGNvbmZpZy5yb3V0ZSkpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gY29uZmlnLnJvdXRlLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgICB2YXIgY3VycmVudCA9IE9iamVjdC5hc3NpZ24oe30sIGNvbmZpZyk7XG4gICAgICAgICAgY3VycmVudC5yb3V0ZSA9IGNvbmZpZy5yb3V0ZVtpXTtcbiAgICAgICAgICByb3V0ZUNvbmZpZ3MucHVzaChjdXJyZW50KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcm91dGVDb25maWdzLnB1c2goT2JqZWN0LmFzc2lnbih7fSwgY29uZmlnKSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBuYXZNb2RlbCA9IHZvaWQgMDtcbiAgICAgIGZvciAodmFyIF9pID0gMCwgX2lpID0gcm91dGVDb25maWdzLmxlbmd0aDsgX2kgPCBfaWk7ICsrX2kpIHtcbiAgICAgICAgdmFyIHJvdXRlQ29uZmlnID0gcm91dGVDb25maWdzW19pXTtcbiAgICAgICAgcm91dGVDb25maWcuc2V0dGluZ3MgPSByb3V0ZUNvbmZpZy5zZXR0aW5ncyB8fCB7fTtcbiAgICAgICAgaWYgKCFuYXZNb2RlbCkge1xuICAgICAgICAgIG5hdk1vZGVsID0gcm91dGVyLmNyZWF0ZU5hdk1vZGVsKHJvdXRlQ29uZmlnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJvdXRlci5hZGRSb3V0ZShyb3V0ZUNvbmZpZywgbmF2TW9kZWwpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgUm91dGVyQ29uZmlndXJhdGlvbi5wcm90b3R5cGUubWFwVW5rbm93blJvdXRlcyA9IGZ1bmN0aW9uIG1hcFVua25vd25Sb3V0ZXMoY29uZmlnKSB7XG4gICAgdGhpcy51bmtub3duUm91dGVDb25maWcgPSBjb25maWc7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgUm91dGVyQ29uZmlndXJhdGlvbi5wcm90b3R5cGUuZXhwb3J0VG9Sb3V0ZXIgPSBmdW5jdGlvbiBleHBvcnRUb1JvdXRlcihyb3V0ZXIpIHtcbiAgICB2YXIgaW5zdHJ1Y3Rpb25zID0gdGhpcy5pbnN0cnVjdGlvbnM7XG4gICAgZm9yICh2YXIgaSA9IDAsIGlpID0gaW5zdHJ1Y3Rpb25zLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgIGluc3RydWN0aW9uc1tpXShyb3V0ZXIpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnRpdGxlKSB7XG4gICAgICByb3V0ZXIudGl0bGUgPSB0aGlzLnRpdGxlO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnVua25vd25Sb3V0ZUNvbmZpZykge1xuICAgICAgcm91dGVyLmhhbmRsZVVua25vd25Sb3V0ZXModGhpcy51bmtub3duUm91dGVDb25maWcpO1xuICAgIH1cblxuICAgIHJvdXRlci5vcHRpb25zID0gdGhpcy5vcHRpb25zO1xuXG4gICAgdmFyIHBpcGVsaW5lU3RlcHMgPSB0aGlzLnBpcGVsaW5lU3RlcHM7XG4gICAgaWYgKHBpcGVsaW5lU3RlcHMubGVuZ3RoKSB7XG4gICAgICBpZiAoIXJvdXRlci5pc1Jvb3QpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQaXBlbGluZSBzdGVwcyBjYW4gb25seSBiZSBhZGRlZCB0byB0aGUgcm9vdCByb3V0ZXInKTtcbiAgICAgIH1cblxuICAgICAgdmFyIHBpcGVsaW5lUHJvdmlkZXIgPSByb3V0ZXIucGlwZWxpbmVQcm92aWRlcjtcbiAgICAgIGZvciAodmFyIF9pMiA9IDAsIF9paTIgPSBwaXBlbGluZVN0ZXBzLmxlbmd0aDsgX2kyIDwgX2lpMjsgKytfaTIpIHtcbiAgICAgICAgdmFyIF9waXBlbGluZVN0ZXBzJF9pID0gcGlwZWxpbmVTdGVwc1tfaTJdO1xuICAgICAgICB2YXIgX25hbWUgPSBfcGlwZWxpbmVTdGVwcyRfaS5uYW1lO1xuICAgICAgICB2YXIgc3RlcCA9IF9waXBlbGluZVN0ZXBzJF9pLnN0ZXA7XG5cbiAgICAgICAgcGlwZWxpbmVQcm92aWRlci5hZGRTdGVwKF9uYW1lLCBzdGVwKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIFJvdXRlckNvbmZpZ3VyYXRpb247XG59KCk7XG5cbnZhciBhY3RpdmF0aW9uU3RyYXRlZ3kgPSBleHBvcnRzLmFjdGl2YXRpb25TdHJhdGVneSA9IHtcbiAgbm9DaGFuZ2U6ICduby1jaGFuZ2UnLFxuICBpbnZva2VMaWZlY3ljbGU6ICdpbnZva2UtbGlmZWN5Y2xlJyxcbiAgcmVwbGFjZTogJ3JlcGxhY2UnXG59O1xuXG52YXIgQnVpbGROYXZpZ2F0aW9uUGxhblN0ZXAgPSBleHBvcnRzLkJ1aWxkTmF2aWdhdGlvblBsYW5TdGVwID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBCdWlsZE5hdmlnYXRpb25QbGFuU3RlcCgpIHtcbiAgICBcbiAgfVxuXG4gIEJ1aWxkTmF2aWdhdGlvblBsYW5TdGVwLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiBydW4obmF2aWdhdGlvbkluc3RydWN0aW9uLCBuZXh0KSB7XG4gICAgcmV0dXJuIF9idWlsZE5hdmlnYXRpb25QbGFuKG5hdmlnYXRpb25JbnN0cnVjdGlvbikudGhlbihmdW5jdGlvbiAocGxhbikge1xuICAgICAgbmF2aWdhdGlvbkluc3RydWN0aW9uLnBsYW4gPSBwbGFuO1xuICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICB9KS5jYXRjaChuZXh0LmNhbmNlbCk7XG4gIH07XG5cbiAgcmV0dXJuIEJ1aWxkTmF2aWdhdGlvblBsYW5TdGVwO1xufSgpO1xuXG5mdW5jdGlvbiBfYnVpbGROYXZpZ2F0aW9uUGxhbihpbnN0cnVjdGlvbiwgZm9yY2VMaWZlY3ljbGVNaW5pbXVtKSB7XG4gIHZhciBwcmV2ID0gaW5zdHJ1Y3Rpb24ucHJldmlvdXNJbnN0cnVjdGlvbjtcbiAgdmFyIGNvbmZpZyA9IGluc3RydWN0aW9uLmNvbmZpZztcbiAgdmFyIHBsYW4gPSB7fTtcblxuICBpZiAoJ3JlZGlyZWN0JyBpbiBjb25maWcpIHtcbiAgICB2YXIgcmVkaXJlY3RMb2NhdGlvbiA9IF9yZXNvbHZlVXJsKGNvbmZpZy5yZWRpcmVjdCwgZ2V0SW5zdHJ1Y3Rpb25CYXNlVXJsKGluc3RydWN0aW9uKSk7XG4gICAgaWYgKGluc3RydWN0aW9uLnF1ZXJ5U3RyaW5nKSB7XG4gICAgICByZWRpcmVjdExvY2F0aW9uICs9ICc/JyArIGluc3RydWN0aW9uLnF1ZXJ5U3RyaW5nO1xuICAgIH1cblxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgUmVkaXJlY3QocmVkaXJlY3RMb2NhdGlvbikpO1xuICB9XG5cbiAgaWYgKHByZXYpIHtcbiAgICB2YXIgbmV3UGFyYW1zID0gaGFzRGlmZmVyZW50UGFyYW1ldGVyVmFsdWVzKHByZXYsIGluc3RydWN0aW9uKTtcbiAgICB2YXIgcGVuZGluZyA9IFtdO1xuXG4gICAgdmFyIF9sb29wMiA9IGZ1bmN0aW9uIF9sb29wMih2aWV3UG9ydE5hbWUpIHtcbiAgICAgIHZhciBwcmV2Vmlld1BvcnRJbnN0cnVjdGlvbiA9IHByZXYudmlld1BvcnRJbnN0cnVjdGlvbnNbdmlld1BvcnROYW1lXTtcbiAgICAgIHZhciBuZXh0Vmlld1BvcnRDb25maWcgPSBjb25maWcudmlld1BvcnRzW3ZpZXdQb3J0TmFtZV07XG5cbiAgICAgIGlmICghbmV4dFZpZXdQb3J0Q29uZmlnKSB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgUm91dGUgQ29uZmlnOiBDb25maWd1cmF0aW9uIGZvciB2aWV3UG9ydCBcIicgKyB2aWV3UG9ydE5hbWUgKyAnXCIgd2FzIG5vdCBmb3VuZCBmb3Igcm91dGU6IFwiJyArIGluc3RydWN0aW9uLmNvbmZpZy5yb3V0ZSArICcuXCInKTtcblxuICAgICAgdmFyIHZpZXdQb3J0UGxhbiA9IHBsYW5bdmlld1BvcnROYW1lXSA9IHtcbiAgICAgICAgbmFtZTogdmlld1BvcnROYW1lLFxuICAgICAgICBjb25maWc6IG5leHRWaWV3UG9ydENvbmZpZyxcbiAgICAgICAgcHJldkNvbXBvbmVudDogcHJldlZpZXdQb3J0SW5zdHJ1Y3Rpb24uY29tcG9uZW50LFxuICAgICAgICBwcmV2TW9kdWxlSWQ6IHByZXZWaWV3UG9ydEluc3RydWN0aW9uLm1vZHVsZUlkXG4gICAgICB9O1xuXG4gICAgICBpZiAocHJldlZpZXdQb3J0SW5zdHJ1Y3Rpb24ubW9kdWxlSWQgIT09IG5leHRWaWV3UG9ydENvbmZpZy5tb2R1bGVJZCkge1xuICAgICAgICB2aWV3UG9ydFBsYW4uc3RyYXRlZ3kgPSBhY3RpdmF0aW9uU3RyYXRlZ3kucmVwbGFjZTtcbiAgICAgIH0gZWxzZSBpZiAoJ2RldGVybWluZUFjdGl2YXRpb25TdHJhdGVneScgaW4gcHJldlZpZXdQb3J0SW5zdHJ1Y3Rpb24uY29tcG9uZW50LnZpZXdNb2RlbCkge1xuICAgICAgICB2YXIgX3ByZXZWaWV3UG9ydEluc3RydWN0O1xuXG4gICAgICAgIHZpZXdQb3J0UGxhbi5zdHJhdGVneSA9IChfcHJldlZpZXdQb3J0SW5zdHJ1Y3QgPSBwcmV2Vmlld1BvcnRJbnN0cnVjdGlvbi5jb21wb25lbnQudmlld01vZGVsKS5kZXRlcm1pbmVBY3RpdmF0aW9uU3RyYXRlZ3kuYXBwbHkoX3ByZXZWaWV3UG9ydEluc3RydWN0LCBpbnN0cnVjdGlvbi5saWZlY3ljbGVBcmdzKTtcbiAgICAgIH0gZWxzZSBpZiAoY29uZmlnLmFjdGl2YXRpb25TdHJhdGVneSkge1xuICAgICAgICB2aWV3UG9ydFBsYW4uc3RyYXRlZ3kgPSBjb25maWcuYWN0aXZhdGlvblN0cmF0ZWd5O1xuICAgICAgfSBlbHNlIGlmIChuZXdQYXJhbXMgfHwgZm9yY2VMaWZlY3ljbGVNaW5pbXVtKSB7XG4gICAgICAgIHZpZXdQb3J0UGxhbi5zdHJhdGVneSA9IGFjdGl2YXRpb25TdHJhdGVneS5pbnZva2VMaWZlY3ljbGU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2aWV3UG9ydFBsYW4uc3RyYXRlZ3kgPSBhY3RpdmF0aW9uU3RyYXRlZ3kubm9DaGFuZ2U7XG4gICAgICB9XG5cbiAgICAgIGlmICh2aWV3UG9ydFBsYW4uc3RyYXRlZ3kgIT09IGFjdGl2YXRpb25TdHJhdGVneS5yZXBsYWNlICYmIHByZXZWaWV3UG9ydEluc3RydWN0aW9uLmNoaWxkUm91dGVyKSB7XG4gICAgICAgIHZhciBwYXRoID0gaW5zdHJ1Y3Rpb24uZ2V0V2lsZGNhcmRQYXRoKCk7XG4gICAgICAgIHZhciB0YXNrID0gcHJldlZpZXdQb3J0SW5zdHJ1Y3Rpb24uY2hpbGRSb3V0ZXIuX2NyZWF0ZU5hdmlnYXRpb25JbnN0cnVjdGlvbihwYXRoLCBpbnN0cnVjdGlvbikudGhlbihmdW5jdGlvbiAoY2hpbGRJbnN0cnVjdGlvbikge1xuICAgICAgICAgIHZpZXdQb3J0UGxhbi5jaGlsZE5hdmlnYXRpb25JbnN0cnVjdGlvbiA9IGNoaWxkSW5zdHJ1Y3Rpb247XG5cbiAgICAgICAgICByZXR1cm4gX2J1aWxkTmF2aWdhdGlvblBsYW4oY2hpbGRJbnN0cnVjdGlvbiwgdmlld1BvcnRQbGFuLnN0cmF0ZWd5ID09PSBhY3RpdmF0aW9uU3RyYXRlZ3kuaW52b2tlTGlmZWN5Y2xlKS50aGVuKGZ1bmN0aW9uIChjaGlsZFBsYW4pIHtcbiAgICAgICAgICAgIGNoaWxkSW5zdHJ1Y3Rpb24ucGxhbiA9IGNoaWxkUGxhbjtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcGVuZGluZy5wdXNoKHRhc2spO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBmb3IgKHZhciB2aWV3UG9ydE5hbWUgaW4gcHJldi52aWV3UG9ydEluc3RydWN0aW9ucykge1xuICAgICAgX2xvb3AyKHZpZXdQb3J0TmFtZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKHBlbmRpbmcpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHBsYW47XG4gICAgfSk7XG4gIH1cblxuICBmb3IgKHZhciBfdmlld1BvcnROYW1lIGluIGNvbmZpZy52aWV3UG9ydHMpIHtcbiAgICBwbGFuW192aWV3UG9ydE5hbWVdID0ge1xuICAgICAgbmFtZTogX3ZpZXdQb3J0TmFtZSxcbiAgICAgIHN0cmF0ZWd5OiBhY3RpdmF0aW9uU3RyYXRlZ3kucmVwbGFjZSxcbiAgICAgIGNvbmZpZzogaW5zdHJ1Y3Rpb24uY29uZmlnLnZpZXdQb3J0c1tfdmlld1BvcnROYW1lXVxuICAgIH07XG4gIH1cblxuICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHBsYW4pO1xufVxuXG5mdW5jdGlvbiBoYXNEaWZmZXJlbnRQYXJhbWV0ZXJWYWx1ZXMocHJldiwgbmV4dCkge1xuICB2YXIgcHJldlBhcmFtcyA9IHByZXYucGFyYW1zO1xuICB2YXIgbmV4dFBhcmFtcyA9IG5leHQucGFyYW1zO1xuICB2YXIgbmV4dFdpbGRDYXJkTmFtZSA9IG5leHQuY29uZmlnLmhhc0NoaWxkUm91dGVyID8gbmV4dC5nZXRXaWxkQ2FyZE5hbWUoKSA6IG51bGw7XG5cbiAgZm9yICh2YXIga2V5IGluIG5leHRQYXJhbXMpIHtcbiAgICBpZiAoa2V5ID09PSBuZXh0V2lsZENhcmROYW1lKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBpZiAocHJldlBhcmFtc1trZXldICE9PSBuZXh0UGFyYW1zW2tleV0pIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIGZvciAodmFyIF9rZXkgaW4gcHJldlBhcmFtcykge1xuICAgIGlmIChfa2V5ID09PSBuZXh0V2lsZENhcmROYW1lKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBpZiAocHJldlBhcmFtc1tfa2V5XSAhPT0gbmV4dFBhcmFtc1tfa2V5XSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgaWYgKCFuZXh0Lm9wdGlvbnMuY29tcGFyZVF1ZXJ5UGFyYW1zKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgdmFyIHByZXZRdWVyeVBhcmFtcyA9IHByZXYucXVlcnlQYXJhbXM7XG4gIHZhciBuZXh0UXVlcnlQYXJhbXMgPSBuZXh0LnF1ZXJ5UGFyYW1zO1xuICBmb3IgKHZhciBfa2V5MiBpbiBuZXh0UXVlcnlQYXJhbXMpIHtcbiAgICBpZiAocHJldlF1ZXJ5UGFyYW1zW19rZXkyXSAhPT0gbmV4dFF1ZXJ5UGFyYW1zW19rZXkyXSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgZm9yICh2YXIgX2tleTMgaW4gcHJldlF1ZXJ5UGFyYW1zKSB7XG4gICAgaWYgKHByZXZRdWVyeVBhcmFtc1tfa2V5M10gIT09IG5leHRRdWVyeVBhcmFtc1tfa2V5M10pIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gZ2V0SW5zdHJ1Y3Rpb25CYXNlVXJsKGluc3RydWN0aW9uKSB7XG4gIHZhciBpbnN0cnVjdGlvbkJhc2VVcmxQYXJ0cyA9IFtdO1xuICBpbnN0cnVjdGlvbiA9IGluc3RydWN0aW9uLnBhcmVudEluc3RydWN0aW9uO1xuXG4gIHdoaWxlIChpbnN0cnVjdGlvbikge1xuICAgIGluc3RydWN0aW9uQmFzZVVybFBhcnRzLnVuc2hpZnQoaW5zdHJ1Y3Rpb24uZ2V0QmFzZVVybCgpKTtcbiAgICBpbnN0cnVjdGlvbiA9IGluc3RydWN0aW9uLnBhcmVudEluc3RydWN0aW9uO1xuICB9XG5cbiAgaW5zdHJ1Y3Rpb25CYXNlVXJsUGFydHMudW5zaGlmdCgnLycpO1xuICByZXR1cm4gaW5zdHJ1Y3Rpb25CYXNlVXJsUGFydHMuam9pbignJyk7XG59XG5cbnZhciBSb3V0ZXIgPSBleHBvcnRzLlJvdXRlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gUm91dGVyKGNvbnRhaW5lciwgaGlzdG9yeSkge1xuICAgIFxuXG4gICAgdGhpcy5wYXJlbnQgPSBudWxsO1xuICAgIHRoaXMub3B0aW9ucyA9IHt9O1xuXG4gICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgdGhpcy5oaXN0b3J5ID0gaGlzdG9yeTtcbiAgICB0aGlzLnJlc2V0KCk7XG4gIH1cblxuICBSb3V0ZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICB0aGlzLnZpZXdQb3J0cyA9IHt9O1xuICAgIHRoaXMucm91dGVzID0gW107XG4gICAgdGhpcy5iYXNlVXJsID0gJyc7XG4gICAgdGhpcy5pc0NvbmZpZ3VyZWQgPSBmYWxzZTtcbiAgICB0aGlzLmlzTmF2aWdhdGluZyA9IGZhbHNlO1xuICAgIHRoaXMubmF2aWdhdGlvbiA9IFtdO1xuICAgIHRoaXMuY3VycmVudEluc3RydWN0aW9uID0gbnVsbDtcbiAgICB0aGlzLl9mYWxsYmFja09yZGVyID0gMTAwO1xuICAgIHRoaXMuX3JlY29nbml6ZXIgPSBuZXcgX2F1cmVsaWFSb3V0ZVJlY29nbml6ZXIuUm91dGVSZWNvZ25pemVyKCk7XG4gICAgdGhpcy5fY2hpbGRSZWNvZ25pemVyID0gbmV3IF9hdXJlbGlhUm91dGVSZWNvZ25pemVyLlJvdXRlUmVjb2duaXplcigpO1xuICAgIHRoaXMuX2NvbmZpZ3VyZWRQcm9taXNlID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcbiAgICAgIF90aGlzMi5fcmVzb2x2ZUNvbmZpZ3VyZWRQcm9taXNlID0gcmVzb2x2ZTtcbiAgICB9KTtcbiAgfTtcblxuICBSb3V0ZXIucHJvdG90eXBlLnJlZ2lzdGVyVmlld1BvcnQgPSBmdW5jdGlvbiByZWdpc3RlclZpZXdQb3J0KHZpZXdQb3J0LCBuYW1lKSB7XG4gICAgbmFtZSA9IG5hbWUgfHwgJ2RlZmF1bHQnO1xuICAgIHRoaXMudmlld1BvcnRzW25hbWVdID0gdmlld1BvcnQ7XG4gIH07XG5cbiAgUm91dGVyLnByb3RvdHlwZS5lbnN1cmVDb25maWd1cmVkID0gZnVuY3Rpb24gZW5zdXJlQ29uZmlndXJlZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fY29uZmlndXJlZFByb21pc2U7XG4gIH07XG5cbiAgUm91dGVyLnByb3RvdHlwZS5jb25maWd1cmUgPSBmdW5jdGlvbiBjb25maWd1cmUoY2FsbGJhY2tPckNvbmZpZykge1xuICAgIHZhciBfdGhpczMgPSB0aGlzO1xuXG4gICAgdGhpcy5pc0NvbmZpZ3VyZWQgPSB0cnVlO1xuXG4gICAgdmFyIHJlc3VsdCA9IGNhbGxiYWNrT3JDb25maWc7XG4gICAgdmFyIGNvbmZpZyA9IHZvaWQgMDtcbiAgICBpZiAodHlwZW9mIGNhbGxiYWNrT3JDb25maWcgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGNvbmZpZyA9IG5ldyBSb3V0ZXJDb25maWd1cmF0aW9uKCk7XG4gICAgICByZXN1bHQgPSBjYWxsYmFja09yQ29uZmlnKGNvbmZpZyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXN1bHQpLnRoZW4oZnVuY3Rpb24gKGMpIHtcbiAgICAgIGlmIChjICYmIGMuZXhwb3J0VG9Sb3V0ZXIpIHtcbiAgICAgICAgY29uZmlnID0gYztcbiAgICAgIH1cblxuICAgICAgY29uZmlnLmV4cG9ydFRvUm91dGVyKF90aGlzMyk7XG4gICAgICBfdGhpczMuaXNDb25maWd1cmVkID0gdHJ1ZTtcbiAgICAgIF90aGlzMy5fcmVzb2x2ZUNvbmZpZ3VyZWRQcm9taXNlKCk7XG4gICAgfSk7XG4gIH07XG5cbiAgUm91dGVyLnByb3RvdHlwZS5uYXZpZ2F0ZSA9IGZ1bmN0aW9uIG5hdmlnYXRlKGZyYWdtZW50LCBvcHRpb25zKSB7XG4gICAgaWYgKCF0aGlzLmlzQ29uZmlndXJlZCAmJiB0aGlzLnBhcmVudCkge1xuICAgICAgcmV0dXJuIHRoaXMucGFyZW50Lm5hdmlnYXRlKGZyYWdtZW50LCBvcHRpb25zKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5oaXN0b3J5Lm5hdmlnYXRlKF9yZXNvbHZlVXJsKGZyYWdtZW50LCB0aGlzLmJhc2VVcmwsIHRoaXMuaGlzdG9yeS5faGFzUHVzaFN0YXRlKSwgb3B0aW9ucyk7XG4gIH07XG5cbiAgUm91dGVyLnByb3RvdHlwZS5uYXZpZ2F0ZVRvUm91dGUgPSBmdW5jdGlvbiBuYXZpZ2F0ZVRvUm91dGUocm91dGUsIHBhcmFtcywgb3B0aW9ucykge1xuICAgIHZhciBwYXRoID0gdGhpcy5nZW5lcmF0ZShyb3V0ZSwgcGFyYW1zKTtcbiAgICByZXR1cm4gdGhpcy5uYXZpZ2F0ZShwYXRoLCBvcHRpb25zKTtcbiAgfTtcblxuICBSb3V0ZXIucHJvdG90eXBlLm5hdmlnYXRlQmFjayA9IGZ1bmN0aW9uIG5hdmlnYXRlQmFjaygpIHtcbiAgICB0aGlzLmhpc3RvcnkubmF2aWdhdGVCYWNrKCk7XG4gIH07XG5cbiAgUm91dGVyLnByb3RvdHlwZS5jcmVhdGVDaGlsZCA9IGZ1bmN0aW9uIGNyZWF0ZUNoaWxkKGNvbnRhaW5lcikge1xuICAgIHZhciBjaGlsZFJvdXRlciA9IG5ldyBSb3V0ZXIoY29udGFpbmVyIHx8IHRoaXMuY29udGFpbmVyLmNyZWF0ZUNoaWxkKCksIHRoaXMuaGlzdG9yeSk7XG4gICAgY2hpbGRSb3V0ZXIucGFyZW50ID0gdGhpcztcbiAgICByZXR1cm4gY2hpbGRSb3V0ZXI7XG4gIH07XG5cbiAgUm91dGVyLnByb3RvdHlwZS5nZW5lcmF0ZSA9IGZ1bmN0aW9uIGdlbmVyYXRlKG5hbWUsIHBhcmFtcykge1xuICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA8PSAyIHx8IGFyZ3VtZW50c1syXSA9PT0gdW5kZWZpbmVkID8ge30gOiBhcmd1bWVudHNbMl07XG5cbiAgICB2YXIgaGFzUm91dGUgPSB0aGlzLl9yZWNvZ25pemVyLmhhc1JvdXRlKG5hbWUpO1xuICAgIGlmICgoIXRoaXMuaXNDb25maWd1cmVkIHx8ICFoYXNSb3V0ZSkgJiYgdGhpcy5wYXJlbnQpIHtcbiAgICAgIHJldHVybiB0aGlzLnBhcmVudC5nZW5lcmF0ZShuYW1lLCBwYXJhbXMpO1xuICAgIH1cblxuICAgIGlmICghaGFzUm91dGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQSByb3V0ZSB3aXRoIG5hbWUgXFwnJyArIG5hbWUgKyAnXFwnIGNvdWxkIG5vdCBiZSBmb3VuZC4gQ2hlY2sgdGhhdCBgbmFtZTogXFwnJyArIG5hbWUgKyAnXFwnYCB3YXMgc3BlY2lmaWVkIGluIHRoZSByb3V0ZVxcJ3MgY29uZmlnLicpO1xuICAgIH1cblxuICAgIHZhciBwYXRoID0gdGhpcy5fcmVjb2duaXplci5nZW5lcmF0ZShuYW1lLCBwYXJhbXMpO1xuICAgIHZhciByb290ZWRQYXRoID0gX2NyZWF0ZVJvb3RlZFBhdGgocGF0aCwgdGhpcy5iYXNlVXJsLCB0aGlzLmhpc3RvcnkuX2hhc1B1c2hTdGF0ZSwgb3B0aW9ucy5hYnNvbHV0ZSk7XG4gICAgcmV0dXJuIG9wdGlvbnMuYWJzb2x1dGUgPyAnJyArIHRoaXMuaGlzdG9yeS5nZXRBYnNvbHV0ZVJvb3QoKSArIHJvb3RlZFBhdGggOiByb290ZWRQYXRoO1xuICB9O1xuXG4gIFJvdXRlci5wcm90b3R5cGUuY3JlYXRlTmF2TW9kZWwgPSBmdW5jdGlvbiBjcmVhdGVOYXZNb2RlbChjb25maWcpIHtcbiAgICB2YXIgbmF2TW9kZWwgPSBuZXcgTmF2TW9kZWwodGhpcywgJ2hyZWYnIGluIGNvbmZpZyA/IGNvbmZpZy5ocmVmIDogY29uZmlnLnJvdXRlKTtcbiAgICBuYXZNb2RlbC50aXRsZSA9IGNvbmZpZy50aXRsZTtcbiAgICBuYXZNb2RlbC5vcmRlciA9IGNvbmZpZy5uYXY7XG4gICAgbmF2TW9kZWwuaHJlZiA9IGNvbmZpZy5ocmVmO1xuICAgIG5hdk1vZGVsLnNldHRpbmdzID0gY29uZmlnLnNldHRpbmdzO1xuICAgIG5hdk1vZGVsLmNvbmZpZyA9IGNvbmZpZztcblxuICAgIHJldHVybiBuYXZNb2RlbDtcbiAgfTtcblxuICBSb3V0ZXIucHJvdG90eXBlLmFkZFJvdXRlID0gZnVuY3Rpb24gYWRkUm91dGUoY29uZmlnLCBuYXZNb2RlbCkge1xuICAgIHZhbGlkYXRlUm91dGVDb25maWcoY29uZmlnKTtcblxuICAgIGlmICghKCd2aWV3UG9ydHMnIGluIGNvbmZpZykgJiYgIWNvbmZpZy5uYXZpZ2F0aW9uU3RyYXRlZ3kpIHtcbiAgICAgIGNvbmZpZy52aWV3UG9ydHMgPSB7XG4gICAgICAgICdkZWZhdWx0Jzoge1xuICAgICAgICAgIG1vZHVsZUlkOiBjb25maWcubW9kdWxlSWQsXG4gICAgICAgICAgdmlldzogY29uZmlnLnZpZXdcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAoIW5hdk1vZGVsKSB7XG4gICAgICBuYXZNb2RlbCA9IHRoaXMuY3JlYXRlTmF2TW9kZWwoY29uZmlnKTtcbiAgICB9XG5cbiAgICB0aGlzLnJvdXRlcy5wdXNoKGNvbmZpZyk7XG5cbiAgICB2YXIgcGF0aCA9IGNvbmZpZy5yb3V0ZTtcbiAgICBpZiAocGF0aC5jaGFyQXQoMCkgPT09ICcvJykge1xuICAgICAgcGF0aCA9IHBhdGguc3Vic3RyKDEpO1xuICAgIH1cbiAgICB2YXIgY2FzZVNlbnNpdGl2ZSA9IGNvbmZpZy5jYXNlU2Vuc2l0aXZlID09PSB0cnVlO1xuICAgIHZhciBzdGF0ZSA9IHRoaXMuX3JlY29nbml6ZXIuYWRkKHsgcGF0aDogcGF0aCwgaGFuZGxlcjogY29uZmlnLCBjYXNlU2Vuc2l0aXZlOiBjYXNlU2Vuc2l0aXZlIH0pO1xuXG4gICAgaWYgKHBhdGgpIHtcbiAgICAgIHZhciBfc2V0dGluZ3MgPSBjb25maWcuc2V0dGluZ3M7XG4gICAgICBkZWxldGUgY29uZmlnLnNldHRpbmdzO1xuICAgICAgdmFyIHdpdGhDaGlsZCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY29uZmlnKSk7XG4gICAgICBjb25maWcuc2V0dGluZ3MgPSBfc2V0dGluZ3M7XG4gICAgICB3aXRoQ2hpbGQucm91dGUgPSBwYXRoICsgJy8qY2hpbGRSb3V0ZSc7XG4gICAgICB3aXRoQ2hpbGQuaGFzQ2hpbGRSb3V0ZXIgPSB0cnVlO1xuICAgICAgdGhpcy5fY2hpbGRSZWNvZ25pemVyLmFkZCh7XG4gICAgICAgIHBhdGg6IHdpdGhDaGlsZC5yb3V0ZSxcbiAgICAgICAgaGFuZGxlcjogd2l0aENoaWxkLFxuICAgICAgICBjYXNlU2Vuc2l0aXZlOiBjYXNlU2Vuc2l0aXZlXG4gICAgICB9KTtcblxuICAgICAgd2l0aENoaWxkLm5hdk1vZGVsID0gbmF2TW9kZWw7XG4gICAgICB3aXRoQ2hpbGQuc2V0dGluZ3MgPSBjb25maWcuc2V0dGluZ3M7XG4gICAgfVxuXG4gICAgY29uZmlnLm5hdk1vZGVsID0gbmF2TW9kZWw7XG5cbiAgICBpZiAoKG5hdk1vZGVsLm9yZGVyIHx8IG5hdk1vZGVsLm9yZGVyID09PSAwKSAmJiB0aGlzLm5hdmlnYXRpb24uaW5kZXhPZihuYXZNb2RlbCkgPT09IC0xKSB7XG4gICAgICBpZiAoIW5hdk1vZGVsLmhyZWYgJiYgbmF2TW9kZWwuaHJlZiAhPT0gJycgJiYgKHN0YXRlLnR5cGVzLmR5bmFtaWNzIHx8IHN0YXRlLnR5cGVzLnN0YXJzKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcm91dGUgY29uZmlnOiBkeW5hbWljIHJvdXRlcyBtdXN0IHNwZWNpZnkgYW4gaHJlZiB0byBiZSBpbmNsdWRlZCBpbiB0aGUgbmF2aWdhdGlvbiBtb2RlbC4nKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGVvZiBuYXZNb2RlbC5vcmRlciAhPT0gJ251bWJlcicpIHtcbiAgICAgICAgbmF2TW9kZWwub3JkZXIgPSArK3RoaXMuX2ZhbGxiYWNrT3JkZXI7XG4gICAgICB9XG5cbiAgICAgIHRoaXMubmF2aWdhdGlvbi5wdXNoKG5hdk1vZGVsKTtcbiAgICAgIHRoaXMubmF2aWdhdGlvbiA9IHRoaXMubmF2aWdhdGlvbi5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgIHJldHVybiBhLm9yZGVyIC0gYi5vcmRlcjtcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICBSb3V0ZXIucHJvdG90eXBlLmhhc1JvdXRlID0gZnVuY3Rpb24gaGFzUm91dGUobmFtZSkge1xuICAgIHJldHVybiAhISh0aGlzLl9yZWNvZ25pemVyLmhhc1JvdXRlKG5hbWUpIHx8IHRoaXMucGFyZW50ICYmIHRoaXMucGFyZW50Lmhhc1JvdXRlKG5hbWUpKTtcbiAgfTtcblxuICBSb3V0ZXIucHJvdG90eXBlLmhhc093blJvdXRlID0gZnVuY3Rpb24gaGFzT3duUm91dGUobmFtZSkge1xuICAgIHJldHVybiB0aGlzLl9yZWNvZ25pemVyLmhhc1JvdXRlKG5hbWUpO1xuICB9O1xuXG4gIFJvdXRlci5wcm90b3R5cGUuaGFuZGxlVW5rbm93blJvdXRlcyA9IGZ1bmN0aW9uIGhhbmRsZVVua25vd25Sb3V0ZXMoY29uZmlnKSB7XG4gICAgdmFyIF90aGlzNCA9IHRoaXM7XG5cbiAgICBpZiAoIWNvbmZpZykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHVua25vd24gcm91dGUgaGFuZGxlcicpO1xuICAgIH1cblxuICAgIHRoaXMuY2F0Y2hBbGxIYW5kbGVyID0gZnVuY3Rpb24gKGluc3RydWN0aW9uKSB7XG4gICAgICByZXR1cm4gX3RoaXM0Ll9jcmVhdGVSb3V0ZUNvbmZpZyhjb25maWcsIGluc3RydWN0aW9uKS50aGVuKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgIGluc3RydWN0aW9uLmNvbmZpZyA9IGM7XG4gICAgICAgIHJldHVybiBpbnN0cnVjdGlvbjtcbiAgICAgIH0pO1xuICAgIH07XG4gIH07XG5cbiAgUm91dGVyLnByb3RvdHlwZS51cGRhdGVUaXRsZSA9IGZ1bmN0aW9uIHVwZGF0ZVRpdGxlKCkge1xuICAgIGlmICh0aGlzLnBhcmVudCkge1xuICAgICAgcmV0dXJuIHRoaXMucGFyZW50LnVwZGF0ZVRpdGxlKCk7XG4gICAgfVxuXG4gICAgdGhpcy5jdXJyZW50SW5zdHJ1Y3Rpb24uX3VwZGF0ZVRpdGxlKCk7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfTtcblxuICBSb3V0ZXIucHJvdG90eXBlLnJlZnJlc2hOYXZpZ2F0aW9uID0gZnVuY3Rpb24gcmVmcmVzaE5hdmlnYXRpb24oKSB7XG4gICAgdmFyIG5hdiA9IHRoaXMubmF2aWdhdGlvbjtcblxuICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBuYXYubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBjdXJyZW50ID0gbmF2W2ldO1xuICAgICAgaWYgKCFjdXJyZW50LmNvbmZpZy5ocmVmKSB7XG4gICAgICAgIGN1cnJlbnQuaHJlZiA9IF9jcmVhdGVSb290ZWRQYXRoKGN1cnJlbnQucmVsYXRpdmVIcmVmLCB0aGlzLmJhc2VVcmwsIHRoaXMuaGlzdG9yeS5faGFzUHVzaFN0YXRlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGN1cnJlbnQuaHJlZiA9IF9ub3JtYWxpemVBYnNvbHV0ZVBhdGgoY3VycmVudC5jb25maWcuaHJlZiwgdGhpcy5oaXN0b3J5Ll9oYXNQdXNoU3RhdGUpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBSb3V0ZXIucHJvdG90eXBlLl9yZWZyZXNoQmFzZVVybCA9IGZ1bmN0aW9uIF9yZWZyZXNoQmFzZVVybCgpIHtcbiAgICBpZiAodGhpcy5wYXJlbnQpIHtcbiAgICAgIHZhciBiYXNlVXJsID0gdGhpcy5wYXJlbnQuY3VycmVudEluc3RydWN0aW9uLmdldEJhc2VVcmwoKTtcbiAgICAgIHRoaXMuYmFzZVVybCA9IHRoaXMucGFyZW50LmJhc2VVcmwgKyBiYXNlVXJsO1xuICAgIH1cbiAgfTtcblxuICBSb3V0ZXIucHJvdG90eXBlLl9jcmVhdGVOYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24gPSBmdW5jdGlvbiBfY3JlYXRlTmF2aWdhdGlvbkluc3RydWN0aW9uKCkge1xuICAgIHZhciB1cmwgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDAgfHwgYXJndW1lbnRzWzBdID09PSB1bmRlZmluZWQgPyAnJyA6IGFyZ3VtZW50c1swXTtcbiAgICB2YXIgcGFyZW50SW5zdHJ1Y3Rpb24gPSBhcmd1bWVudHMubGVuZ3RoIDw9IDEgfHwgYXJndW1lbnRzWzFdID09PSB1bmRlZmluZWQgPyBudWxsIDogYXJndW1lbnRzWzFdO1xuXG4gICAgdmFyIGZyYWdtZW50ID0gdXJsO1xuICAgIHZhciBxdWVyeVN0cmluZyA9ICcnO1xuXG4gICAgdmFyIHF1ZXJ5SW5kZXggPSB1cmwuaW5kZXhPZignPycpO1xuICAgIGlmIChxdWVyeUluZGV4ICE9PSAtMSkge1xuICAgICAgZnJhZ21lbnQgPSB1cmwuc3Vic3RyKDAsIHF1ZXJ5SW5kZXgpO1xuICAgICAgcXVlcnlTdHJpbmcgPSB1cmwuc3Vic3RyKHF1ZXJ5SW5kZXggKyAxKTtcbiAgICB9XG5cbiAgICB2YXIgcmVzdWx0cyA9IHRoaXMuX3JlY29nbml6ZXIucmVjb2duaXplKHVybCk7XG4gICAgaWYgKCFyZXN1bHRzIHx8ICFyZXN1bHRzLmxlbmd0aCkge1xuICAgICAgcmVzdWx0cyA9IHRoaXMuX2NoaWxkUmVjb2duaXplci5yZWNvZ25pemUodXJsKTtcbiAgICB9XG5cbiAgICB2YXIgaW5zdHJ1Y3Rpb25Jbml0ID0ge1xuICAgICAgZnJhZ21lbnQ6IGZyYWdtZW50LFxuICAgICAgcXVlcnlTdHJpbmc6IHF1ZXJ5U3RyaW5nLFxuICAgICAgY29uZmlnOiBudWxsLFxuICAgICAgcGFyZW50SW5zdHJ1Y3Rpb246IHBhcmVudEluc3RydWN0aW9uLFxuICAgICAgcHJldmlvdXNJbnN0cnVjdGlvbjogdGhpcy5jdXJyZW50SW5zdHJ1Y3Rpb24sXG4gICAgICByb3V0ZXI6IHRoaXMsXG4gICAgICBvcHRpb25zOiB7XG4gICAgICAgIGNvbXBhcmVRdWVyeVBhcmFtczogdGhpcy5vcHRpb25zLmNvbXBhcmVRdWVyeVBhcmFtc1xuICAgICAgfVxuICAgIH07XG5cbiAgICBpZiAocmVzdWx0cyAmJiByZXN1bHRzLmxlbmd0aCkge1xuICAgICAgdmFyIGZpcnN0ID0gcmVzdWx0c1swXTtcbiAgICAgIHZhciBfaW5zdHJ1Y3Rpb24gPSBuZXcgTmF2aWdhdGlvbkluc3RydWN0aW9uKE9iamVjdC5hc3NpZ24oe30sIGluc3RydWN0aW9uSW5pdCwge1xuICAgICAgICBwYXJhbXM6IGZpcnN0LnBhcmFtcyxcbiAgICAgICAgcXVlcnlQYXJhbXM6IGZpcnN0LnF1ZXJ5UGFyYW1zIHx8IHJlc3VsdHMucXVlcnlQYXJhbXMsXG4gICAgICAgIGNvbmZpZzogZmlyc3QuY29uZmlnIHx8IGZpcnN0LmhhbmRsZXJcbiAgICAgIH0pKTtcblxuICAgICAgaWYgKHR5cGVvZiBmaXJzdC5oYW5kbGVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHJldHVybiBldmFsdWF0ZU5hdmlnYXRpb25TdHJhdGVneShfaW5zdHJ1Y3Rpb24sIGZpcnN0LmhhbmRsZXIsIGZpcnN0KTtcbiAgICAgIH0gZWxzZSBpZiAoZmlyc3QuaGFuZGxlciAmJiAnbmF2aWdhdGlvblN0cmF0ZWd5JyBpbiBmaXJzdC5oYW5kbGVyKSB7XG4gICAgICAgIHJldHVybiBldmFsdWF0ZU5hdmlnYXRpb25TdHJhdGVneShfaW5zdHJ1Y3Rpb24sIGZpcnN0LmhhbmRsZXIubmF2aWdhdGlvblN0cmF0ZWd5LCBmaXJzdC5oYW5kbGVyKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShfaW5zdHJ1Y3Rpb24pO1xuICAgIH0gZWxzZSBpZiAodGhpcy5jYXRjaEFsbEhhbmRsZXIpIHtcbiAgICAgIHZhciBfaW5zdHJ1Y3Rpb24yID0gbmV3IE5hdmlnYXRpb25JbnN0cnVjdGlvbihPYmplY3QuYXNzaWduKHt9LCBpbnN0cnVjdGlvbkluaXQsIHtcbiAgICAgICAgcGFyYW1zOiB7IHBhdGg6IGZyYWdtZW50IH0sXG4gICAgICAgIHF1ZXJ5UGFyYW1zOiByZXN1bHRzICYmIHJlc3VsdHMucXVlcnlQYXJhbXMsXG4gICAgICAgIGNvbmZpZzogbnVsbCB9KSk7XG5cbiAgICAgIHJldHVybiBldmFsdWF0ZU5hdmlnYXRpb25TdHJhdGVneShfaW5zdHJ1Y3Rpb24yLCB0aGlzLmNhdGNoQWxsSGFuZGxlcik7XG4gICAgfVxuXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcignUm91dGUgbm90IGZvdW5kOiAnICsgdXJsKSk7XG4gIH07XG5cbiAgUm91dGVyLnByb3RvdHlwZS5fY3JlYXRlUm91dGVDb25maWcgPSBmdW5jdGlvbiBfY3JlYXRlUm91dGVDb25maWcoY29uZmlnLCBpbnN0cnVjdGlvbikge1xuICAgIHZhciBfdGhpczUgPSB0aGlzO1xuXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShjb25maWcpLnRoZW4oZnVuY3Rpb24gKGMpIHtcbiAgICAgIGlmICh0eXBlb2YgYyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmV0dXJuIHsgbW9kdWxlSWQ6IGMgfTtcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgcmV0dXJuIGMoaW5zdHJ1Y3Rpb24pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gYztcbiAgICB9KS50aGVuKGZ1bmN0aW9uIChjKSB7XG4gICAgICByZXR1cm4gdHlwZW9mIGMgPT09ICdzdHJpbmcnID8geyBtb2R1bGVJZDogYyB9IDogYztcbiAgICB9KS50aGVuKGZ1bmN0aW9uIChjKSB7XG4gICAgICBjLnJvdXRlID0gaW5zdHJ1Y3Rpb24ucGFyYW1zLnBhdGg7XG4gICAgICB2YWxpZGF0ZVJvdXRlQ29uZmlnKGMpO1xuXG4gICAgICBpZiAoIWMubmF2TW9kZWwpIHtcbiAgICAgICAgYy5uYXZNb2RlbCA9IF90aGlzNS5jcmVhdGVOYXZNb2RlbChjKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGM7XG4gICAgfSk7XG4gIH07XG5cbiAgX2NyZWF0ZUNsYXNzKFJvdXRlciwgW3tcbiAgICBrZXk6ICdpc1Jvb3QnLFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgcmV0dXJuICF0aGlzLnBhcmVudDtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gUm91dGVyO1xufSgpO1xuXG5mdW5jdGlvbiB2YWxpZGF0ZVJvdXRlQ29uZmlnKGNvbmZpZykge1xuICBpZiAoKHR5cGVvZiBjb25maWcgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGNvbmZpZykpICE9PSAnb2JqZWN0Jykge1xuICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBSb3V0ZSBDb25maWcnKTtcbiAgfVxuXG4gIGlmICh0eXBlb2YgY29uZmlnLnJvdXRlICE9PSAnc3RyaW5nJykge1xuICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBSb3V0ZSBDb25maWc6IFlvdSBtdXN0IHNwZWNpZnkgYSByb3V0ZSBwYXR0ZXJuLicpO1xuICB9XG5cbiAgaWYgKCEoJ3JlZGlyZWN0JyBpbiBjb25maWcgfHwgY29uZmlnLm1vZHVsZUlkIHx8IGNvbmZpZy5uYXZpZ2F0aW9uU3RyYXRlZ3kgfHwgY29uZmlnLnZpZXdQb3J0cykpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgUm91dGUgQ29uZmlnOiBZb3UgbXVzdCBzcGVjaWZ5IGEgbW9kdWxlSWQsIHJlZGlyZWN0LCBuYXZpZ2F0aW9uU3RyYXRlZ3ksIG9yIHZpZXdQb3J0cy4nKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBldmFsdWF0ZU5hdmlnYXRpb25TdHJhdGVneShpbnN0cnVjdGlvbiwgZXZhbHVhdG9yLCBjb250ZXh0KSB7XG4gIHJldHVybiBQcm9taXNlLnJlc29sdmUoZXZhbHVhdG9yLmNhbGwoY29udGV4dCwgaW5zdHJ1Y3Rpb24pKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoISgndmlld1BvcnRzJyBpbiBpbnN0cnVjdGlvbi5jb25maWcpKSB7XG4gICAgICBpbnN0cnVjdGlvbi5jb25maWcudmlld1BvcnRzID0ge1xuICAgICAgICAnZGVmYXVsdCc6IHtcbiAgICAgICAgICBtb2R1bGVJZDogaW5zdHJ1Y3Rpb24uY29uZmlnLm1vZHVsZUlkXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIGluc3RydWN0aW9uO1xuICB9KTtcbn1cblxudmFyIENhbkRlYWN0aXZhdGVQcmV2aW91c1N0ZXAgPSBleHBvcnRzLkNhbkRlYWN0aXZhdGVQcmV2aW91c1N0ZXAgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIENhbkRlYWN0aXZhdGVQcmV2aW91c1N0ZXAoKSB7XG4gICAgXG4gIH1cblxuICBDYW5EZWFjdGl2YXRlUHJldmlvdXNTdGVwLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiBydW4obmF2aWdhdGlvbkluc3RydWN0aW9uLCBuZXh0KSB7XG4gICAgcmV0dXJuIHByb2Nlc3NEZWFjdGl2YXRhYmxlKG5hdmlnYXRpb25JbnN0cnVjdGlvbi5wbGFuLCAnY2FuRGVhY3RpdmF0ZScsIG5leHQpO1xuICB9O1xuXG4gIHJldHVybiBDYW5EZWFjdGl2YXRlUHJldmlvdXNTdGVwO1xufSgpO1xuXG52YXIgQ2FuQWN0aXZhdGVOZXh0U3RlcCA9IGV4cG9ydHMuQ2FuQWN0aXZhdGVOZXh0U3RlcCA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQ2FuQWN0aXZhdGVOZXh0U3RlcCgpIHtcbiAgICBcbiAgfVxuXG4gIENhbkFjdGl2YXRlTmV4dFN0ZXAucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uIHJ1bihuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24sIG5leHQpIHtcbiAgICByZXR1cm4gcHJvY2Vzc0FjdGl2YXRhYmxlKG5hdmlnYXRpb25JbnN0cnVjdGlvbiwgJ2NhbkFjdGl2YXRlJywgbmV4dCk7XG4gIH07XG5cbiAgcmV0dXJuIENhbkFjdGl2YXRlTmV4dFN0ZXA7XG59KCk7XG5cbnZhciBEZWFjdGl2YXRlUHJldmlvdXNTdGVwID0gZXhwb3J0cy5EZWFjdGl2YXRlUHJldmlvdXNTdGVwID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBEZWFjdGl2YXRlUHJldmlvdXNTdGVwKCkge1xuICAgIFxuICB9XG5cbiAgRGVhY3RpdmF0ZVByZXZpb3VzU3RlcC5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gcnVuKG5hdmlnYXRpb25JbnN0cnVjdGlvbiwgbmV4dCkge1xuICAgIHJldHVybiBwcm9jZXNzRGVhY3RpdmF0YWJsZShuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24ucGxhbiwgJ2RlYWN0aXZhdGUnLCBuZXh0LCB0cnVlKTtcbiAgfTtcblxuICByZXR1cm4gRGVhY3RpdmF0ZVByZXZpb3VzU3RlcDtcbn0oKTtcblxudmFyIEFjdGl2YXRlTmV4dFN0ZXAgPSBleHBvcnRzLkFjdGl2YXRlTmV4dFN0ZXAgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEFjdGl2YXRlTmV4dFN0ZXAoKSB7XG4gICAgXG4gIH1cblxuICBBY3RpdmF0ZU5leHRTdGVwLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiBydW4obmF2aWdhdGlvbkluc3RydWN0aW9uLCBuZXh0KSB7XG4gICAgcmV0dXJuIHByb2Nlc3NBY3RpdmF0YWJsZShuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24sICdhY3RpdmF0ZScsIG5leHQsIHRydWUpO1xuICB9O1xuXG4gIHJldHVybiBBY3RpdmF0ZU5leHRTdGVwO1xufSgpO1xuXG5mdW5jdGlvbiBwcm9jZXNzRGVhY3RpdmF0YWJsZShwbGFuLCBjYWxsYmFja05hbWUsIG5leHQsIGlnbm9yZVJlc3VsdCkge1xuICB2YXIgaW5mb3MgPSBmaW5kRGVhY3RpdmF0YWJsZShwbGFuLCBjYWxsYmFja05hbWUpO1xuICB2YXIgaSA9IGluZm9zLmxlbmd0aDtcblxuICBmdW5jdGlvbiBpbnNwZWN0KHZhbCkge1xuICAgIGlmIChpZ25vcmVSZXN1bHQgfHwgc2hvdWxkQ29udGludWUodmFsKSkge1xuICAgICAgcmV0dXJuIGl0ZXJhdGUoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV4dC5jYW5jZWwodmFsKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGl0ZXJhdGUoKSB7XG4gICAgaWYgKGktLSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgdmFyIHZpZXdNb2RlbCA9IGluZm9zW2ldO1xuICAgICAgICB2YXIgX3Jlc3VsdCA9IHZpZXdNb2RlbFtjYWxsYmFja05hbWVdKCk7XG4gICAgICAgIHJldHVybiBwcm9jZXNzUG90ZW50aWFsKF9yZXN1bHQsIGluc3BlY3QsIG5leHQuY2FuY2VsKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiBuZXh0LmNhbmNlbChlcnJvcik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG5leHQoKTtcbiAgfVxuXG4gIHJldHVybiBpdGVyYXRlKCk7XG59XG5cbmZ1bmN0aW9uIGZpbmREZWFjdGl2YXRhYmxlKHBsYW4sIGNhbGxiYWNrTmFtZSkge1xuICB2YXIgbGlzdCA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMiB8fCBhcmd1bWVudHNbMl0gPT09IHVuZGVmaW5lZCA/IFtdIDogYXJndW1lbnRzWzJdO1xuXG4gIGZvciAodmFyIHZpZXdQb3J0TmFtZSBpbiBwbGFuKSB7XG4gICAgdmFyIF92aWV3UG9ydFBsYW4gPSBwbGFuW3ZpZXdQb3J0TmFtZV07XG4gICAgdmFyIHByZXZDb21wb25lbnQgPSBfdmlld1BvcnRQbGFuLnByZXZDb21wb25lbnQ7XG5cbiAgICBpZiAoKF92aWV3UG9ydFBsYW4uc3RyYXRlZ3kgPT09IGFjdGl2YXRpb25TdHJhdGVneS5pbnZva2VMaWZlY3ljbGUgfHwgX3ZpZXdQb3J0UGxhbi5zdHJhdGVneSA9PT0gYWN0aXZhdGlvblN0cmF0ZWd5LnJlcGxhY2UpICYmIHByZXZDb21wb25lbnQpIHtcbiAgICAgIHZhciB2aWV3TW9kZWwgPSBwcmV2Q29tcG9uZW50LnZpZXdNb2RlbDtcblxuICAgICAgaWYgKGNhbGxiYWNrTmFtZSBpbiB2aWV3TW9kZWwpIHtcbiAgICAgICAgbGlzdC5wdXNoKHZpZXdNb2RlbCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKF92aWV3UG9ydFBsYW4uY2hpbGROYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24pIHtcbiAgICAgIGZpbmREZWFjdGl2YXRhYmxlKF92aWV3UG9ydFBsYW4uY2hpbGROYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24ucGxhbiwgY2FsbGJhY2tOYW1lLCBsaXN0KTtcbiAgICB9IGVsc2UgaWYgKHByZXZDb21wb25lbnQpIHtcbiAgICAgIGFkZFByZXZpb3VzRGVhY3RpdmF0YWJsZShwcmV2Q29tcG9uZW50LCBjYWxsYmFja05hbWUsIGxpc3QpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBsaXN0O1xufVxuXG5mdW5jdGlvbiBhZGRQcmV2aW91c0RlYWN0aXZhdGFibGUoY29tcG9uZW50LCBjYWxsYmFja05hbWUsIGxpc3QpIHtcbiAgdmFyIGNoaWxkUm91dGVyID0gY29tcG9uZW50LmNoaWxkUm91dGVyO1xuXG4gIGlmIChjaGlsZFJvdXRlciAmJiBjaGlsZFJvdXRlci5jdXJyZW50SW5zdHJ1Y3Rpb24pIHtcbiAgICB2YXIgdmlld1BvcnRJbnN0cnVjdGlvbnMgPSBjaGlsZFJvdXRlci5jdXJyZW50SW5zdHJ1Y3Rpb24udmlld1BvcnRJbnN0cnVjdGlvbnM7XG5cbiAgICBmb3IgKHZhciB2aWV3UG9ydE5hbWUgaW4gdmlld1BvcnRJbnN0cnVjdGlvbnMpIHtcbiAgICAgIHZhciBfdmlld1BvcnRJbnN0cnVjdGlvbjIgPSB2aWV3UG9ydEluc3RydWN0aW9uc1t2aWV3UG9ydE5hbWVdO1xuICAgICAgdmFyIHByZXZDb21wb25lbnQgPSBfdmlld1BvcnRJbnN0cnVjdGlvbjIuY29tcG9uZW50O1xuICAgICAgdmFyIHByZXZWaWV3TW9kZWwgPSBwcmV2Q29tcG9uZW50LnZpZXdNb2RlbDtcblxuICAgICAgaWYgKGNhbGxiYWNrTmFtZSBpbiBwcmV2Vmlld01vZGVsKSB7XG4gICAgICAgIGxpc3QucHVzaChwcmV2Vmlld01vZGVsKTtcbiAgICAgIH1cblxuICAgICAgYWRkUHJldmlvdXNEZWFjdGl2YXRhYmxlKHByZXZDb21wb25lbnQsIGNhbGxiYWNrTmFtZSwgbGlzdCk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHByb2Nlc3NBY3RpdmF0YWJsZShuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24sIGNhbGxiYWNrTmFtZSwgbmV4dCwgaWdub3JlUmVzdWx0KSB7XG4gIHZhciBpbmZvcyA9IGZpbmRBY3RpdmF0YWJsZShuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24sIGNhbGxiYWNrTmFtZSk7XG4gIHZhciBsZW5ndGggPSBpbmZvcy5sZW5ndGg7XG4gIHZhciBpID0gLTE7XG5cbiAgZnVuY3Rpb24gaW5zcGVjdCh2YWwsIHJvdXRlcikge1xuICAgIGlmIChpZ25vcmVSZXN1bHQgfHwgc2hvdWxkQ29udGludWUodmFsLCByb3V0ZXIpKSB7XG4gICAgICByZXR1cm4gaXRlcmF0ZSgpO1xuICAgIH1cblxuICAgIHJldHVybiBuZXh0LmNhbmNlbCh2YWwpO1xuICB9XG5cbiAgZnVuY3Rpb24gaXRlcmF0ZSgpIHtcbiAgICBpKys7XG5cbiAgICBpZiAoaSA8IGxlbmd0aCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgdmFyIF9yZXQzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHZhciBfY3VycmVudCR2aWV3TW9kZWw7XG5cbiAgICAgICAgICB2YXIgY3VycmVudCA9IGluZm9zW2ldO1xuICAgICAgICAgIHZhciByZXN1bHQgPSAoX2N1cnJlbnQkdmlld01vZGVsID0gY3VycmVudC52aWV3TW9kZWwpW2NhbGxiYWNrTmFtZV0uYXBwbHkoX2N1cnJlbnQkdmlld01vZGVsLCBjdXJyZW50LmxpZmVjeWNsZUFyZ3MpO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2OiBwcm9jZXNzUG90ZW50aWFsKHJlc3VsdCwgZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgICAgICByZXR1cm4gaW5zcGVjdCh2YWwsIGN1cnJlbnQucm91dGVyKTtcbiAgICAgICAgICAgIH0sIG5leHQuY2FuY2VsKVxuICAgICAgICAgIH07XG4gICAgICAgIH0oKTtcblxuICAgICAgICBpZiAoKHR5cGVvZiBfcmV0MyA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoX3JldDMpKSA9PT0gXCJvYmplY3RcIikgcmV0dXJuIF9yZXQzLnY7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4gbmV4dC5jYW5jZWwoZXJyb3IpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBuZXh0KCk7XG4gIH1cblxuICByZXR1cm4gaXRlcmF0ZSgpO1xufVxuXG5mdW5jdGlvbiBmaW5kQWN0aXZhdGFibGUobmF2aWdhdGlvbkluc3RydWN0aW9uLCBjYWxsYmFja05hbWUpIHtcbiAgdmFyIGxpc3QgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDIgfHwgYXJndW1lbnRzWzJdID09PSB1bmRlZmluZWQgPyBbXSA6IGFyZ3VtZW50c1syXTtcbiAgdmFyIHJvdXRlciA9IGFyZ3VtZW50c1szXTtcblxuICB2YXIgcGxhbiA9IG5hdmlnYXRpb25JbnN0cnVjdGlvbi5wbGFuO1xuXG4gIE9iamVjdC5rZXlzKHBsYW4pLmZpbHRlcihmdW5jdGlvbiAodmlld1BvcnROYW1lKSB7XG4gICAgdmFyIHZpZXdQb3J0UGxhbiA9IHBsYW5bdmlld1BvcnROYW1lXTtcbiAgICB2YXIgdmlld1BvcnRJbnN0cnVjdGlvbiA9IG5hdmlnYXRpb25JbnN0cnVjdGlvbi52aWV3UG9ydEluc3RydWN0aW9uc1t2aWV3UG9ydE5hbWVdO1xuICAgIHZhciB2aWV3TW9kZWwgPSB2aWV3UG9ydEluc3RydWN0aW9uLmNvbXBvbmVudC52aWV3TW9kZWw7XG5cbiAgICBpZiAoKHZpZXdQb3J0UGxhbi5zdHJhdGVneSA9PT0gYWN0aXZhdGlvblN0cmF0ZWd5Lmludm9rZUxpZmVjeWNsZSB8fCB2aWV3UG9ydFBsYW4uc3RyYXRlZ3kgPT09IGFjdGl2YXRpb25TdHJhdGVneS5yZXBsYWNlKSAmJiBjYWxsYmFja05hbWUgaW4gdmlld01vZGVsKSB7XG4gICAgICBsaXN0LnB1c2goe1xuICAgICAgICB2aWV3TW9kZWw6IHZpZXdNb2RlbCxcbiAgICAgICAgbGlmZWN5Y2xlQXJnczogdmlld1BvcnRJbnN0cnVjdGlvbi5saWZlY3ljbGVBcmdzLFxuICAgICAgICByb3V0ZXI6IHJvdXRlclxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKHZpZXdQb3J0UGxhbi5jaGlsZE5hdmlnYXRpb25JbnN0cnVjdGlvbikge1xuICAgICAgZmluZEFjdGl2YXRhYmxlKHZpZXdQb3J0UGxhbi5jaGlsZE5hdmlnYXRpb25JbnN0cnVjdGlvbiwgY2FsbGJhY2tOYW1lLCBsaXN0LCB2aWV3UG9ydEluc3RydWN0aW9uLmNvbXBvbmVudC5jaGlsZFJvdXRlciB8fCByb3V0ZXIpO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIGxpc3Q7XG59XG5cbmZ1bmN0aW9uIHNob3VsZENvbnRpbnVlKG91dHB1dCwgcm91dGVyKSB7XG4gIGlmIChvdXRwdXQgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGlmIChpc05hdmlnYXRpb25Db21tYW5kKG91dHB1dCkpIHtcbiAgICBpZiAodHlwZW9mIG91dHB1dC5zZXRSb3V0ZXIgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIG91dHB1dC5zZXRSb3V0ZXIocm91dGVyKTtcbiAgICB9XG5cbiAgICByZXR1cm4gISFvdXRwdXQuc2hvdWxkQ29udGludWVQcm9jZXNzaW5nO1xuICB9XG5cbiAgaWYgKG91dHB1dCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICByZXR1cm4gb3V0cHV0O1xufVxuXG52YXIgU2FmZVN1YnNjcmlwdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gU2FmZVN1YnNjcmlwdGlvbihzdWJzY3JpcHRpb25GdW5jKSB7XG4gICAgXG5cbiAgICB0aGlzLl9zdWJzY3JpYmVkID0gdHJ1ZTtcbiAgICB0aGlzLl9zdWJzY3JpcHRpb24gPSBzdWJzY3JpcHRpb25GdW5jKHRoaXMpO1xuXG4gICAgaWYgKCF0aGlzLl9zdWJzY3JpYmVkKSB0aGlzLnVuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBTYWZlU3Vic2NyaXB0aW9uLnByb3RvdHlwZS51bnN1YnNjcmliZSA9IGZ1bmN0aW9uIHVuc3Vic2NyaWJlKCkge1xuICAgIGlmICh0aGlzLl9zdWJzY3JpYmVkICYmIHRoaXMuX3N1YnNjcmlwdGlvbikgdGhpcy5fc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG5cbiAgICB0aGlzLl9zdWJzY3JpYmVkID0gZmFsc2U7XG4gIH07XG5cbiAgX2NyZWF0ZUNsYXNzKFNhZmVTdWJzY3JpcHRpb24sIFt7XG4gICAga2V5OiAnc3Vic2NyaWJlZCcsXG4gICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fc3Vic2NyaWJlZDtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gU2FmZVN1YnNjcmlwdGlvbjtcbn0oKTtcblxuZnVuY3Rpb24gcHJvY2Vzc1BvdGVudGlhbChvYmosIHJlc29sdmUsIHJlamVjdCkge1xuICBpZiAob2JqICYmIHR5cGVvZiBvYmoudGhlbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUob2JqKS50aGVuKHJlc29sdmUpLmNhdGNoKHJlamVjdCk7XG4gIH1cblxuICBpZiAob2JqICYmIHR5cGVvZiBvYmouc3Vic2NyaWJlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgdmFyIF9yZXQ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIG9icyA9IG9iajtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHY6IG5ldyBTYWZlU3Vic2NyaXB0aW9uKGZ1bmN0aW9uIChzdWIpIHtcbiAgICAgICAgICByZXR1cm4gb2JzLnN1YnNjcmliZSh7XG4gICAgICAgICAgICBuZXh0OiBmdW5jdGlvbiBuZXh0KCkge1xuICAgICAgICAgICAgICBpZiAoc3ViLnN1YnNjcmliZWQpIHtcbiAgICAgICAgICAgICAgICBzdWIudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gZXJyb3IoX2Vycm9yKSB7XG4gICAgICAgICAgICAgIGlmIChzdWIuc3Vic2NyaWJlZCkge1xuICAgICAgICAgICAgICAgIHN1Yi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgICAgIHJlamVjdChfZXJyb3IpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uIGNvbXBsZXRlKCkge1xuICAgICAgICAgICAgICBpZiAoc3ViLnN1YnNjcmliZWQpIHtcbiAgICAgICAgICAgICAgICBzdWIudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSlcbiAgICAgIH07XG4gICAgfSgpO1xuXG4gICAgaWYgKCh0eXBlb2YgX3JldDQgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKF9yZXQ0KSkgPT09IFwib2JqZWN0XCIpIHJldHVybiBfcmV0NC52O1xuICB9XG5cbiAgdHJ5IHtcbiAgICByZXR1cm4gcmVzb2x2ZShvYmopO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiByZWplY3QoZXJyb3IpO1xuICB9XG59XG5cbnZhciBSb3V0ZUxvYWRlciA9IGV4cG9ydHMuUm91dGVMb2FkZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFJvdXRlTG9hZGVyKCkge1xuICAgIFxuICB9XG5cbiAgUm91dGVMb2FkZXIucHJvdG90eXBlLmxvYWRSb3V0ZSA9IGZ1bmN0aW9uIGxvYWRSb3V0ZShyb3V0ZXIsIGNvbmZpZywgbmF2aWdhdGlvbkluc3RydWN0aW9uKSB7XG4gICAgdGhyb3cgRXJyb3IoJ1JvdXRlIGxvYWRlcnMgbXVzdCBpbXBsZW1lbnQgXCJsb2FkUm91dGUocm91dGVyLCBjb25maWcsIG5hdmlnYXRpb25JbnN0cnVjdGlvbilcIi4nKTtcbiAgfTtcblxuICByZXR1cm4gUm91dGVMb2FkZXI7XG59KCk7XG5cbnZhciBMb2FkUm91dGVTdGVwID0gZXhwb3J0cy5Mb2FkUm91dGVTdGVwID0gZnVuY3Rpb24gKCkge1xuICBMb2FkUm91dGVTdGVwLmluamVjdCA9IGZ1bmN0aW9uIGluamVjdCgpIHtcbiAgICByZXR1cm4gW1JvdXRlTG9hZGVyXTtcbiAgfTtcblxuICBmdW5jdGlvbiBMb2FkUm91dGVTdGVwKHJvdXRlTG9hZGVyKSB7XG4gICAgXG5cbiAgICB0aGlzLnJvdXRlTG9hZGVyID0gcm91dGVMb2FkZXI7XG4gIH1cblxuICBMb2FkUm91dGVTdGVwLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiBydW4obmF2aWdhdGlvbkluc3RydWN0aW9uLCBuZXh0KSB7XG4gICAgcmV0dXJuIGxvYWROZXdSb3V0ZSh0aGlzLnJvdXRlTG9hZGVyLCBuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24pLnRoZW4obmV4dCkuY2F0Y2gobmV4dC5jYW5jZWwpO1xuICB9O1xuXG4gIHJldHVybiBMb2FkUm91dGVTdGVwO1xufSgpO1xuXG5mdW5jdGlvbiBsb2FkTmV3Um91dGUocm91dGVMb2FkZXIsIG5hdmlnYXRpb25JbnN0cnVjdGlvbikge1xuICB2YXIgdG9Mb2FkID0gZGV0ZXJtaW5lV2hhdFRvTG9hZChuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24pO1xuICB2YXIgbG9hZFByb21pc2VzID0gdG9Mb2FkLm1hcChmdW5jdGlvbiAoY3VycmVudCkge1xuICAgIHJldHVybiBsb2FkUm91dGUocm91dGVMb2FkZXIsIGN1cnJlbnQubmF2aWdhdGlvbkluc3RydWN0aW9uLCBjdXJyZW50LnZpZXdQb3J0UGxhbik7XG4gIH0pO1xuXG4gIHJldHVybiBQcm9taXNlLmFsbChsb2FkUHJvbWlzZXMpO1xufVxuXG5mdW5jdGlvbiBkZXRlcm1pbmVXaGF0VG9Mb2FkKG5hdmlnYXRpb25JbnN0cnVjdGlvbikge1xuICB2YXIgdG9Mb2FkID0gYXJndW1lbnRzLmxlbmd0aCA8PSAxIHx8IGFyZ3VtZW50c1sxXSA9PT0gdW5kZWZpbmVkID8gW10gOiBhcmd1bWVudHNbMV07XG5cbiAgdmFyIHBsYW4gPSBuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24ucGxhbjtcblxuICBmb3IgKHZhciB2aWV3UG9ydE5hbWUgaW4gcGxhbikge1xuICAgIHZhciBfdmlld1BvcnRQbGFuMiA9IHBsYW5bdmlld1BvcnROYW1lXTtcblxuICAgIGlmIChfdmlld1BvcnRQbGFuMi5zdHJhdGVneSA9PT0gYWN0aXZhdGlvblN0cmF0ZWd5LnJlcGxhY2UpIHtcbiAgICAgIHRvTG9hZC5wdXNoKHsgdmlld1BvcnRQbGFuOiBfdmlld1BvcnRQbGFuMiwgbmF2aWdhdGlvbkluc3RydWN0aW9uOiBuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24gfSk7XG5cbiAgICAgIGlmIChfdmlld1BvcnRQbGFuMi5jaGlsZE5hdmlnYXRpb25JbnN0cnVjdGlvbikge1xuICAgICAgICBkZXRlcm1pbmVXaGF0VG9Mb2FkKF92aWV3UG9ydFBsYW4yLmNoaWxkTmF2aWdhdGlvbkluc3RydWN0aW9uLCB0b0xvYWQpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgX3ZpZXdQb3J0SW5zdHJ1Y3Rpb24zID0gbmF2aWdhdGlvbkluc3RydWN0aW9uLmFkZFZpZXdQb3J0SW5zdHJ1Y3Rpb24odmlld1BvcnROYW1lLCBfdmlld1BvcnRQbGFuMi5zdHJhdGVneSwgX3ZpZXdQb3J0UGxhbjIucHJldk1vZHVsZUlkLCBfdmlld1BvcnRQbGFuMi5wcmV2Q29tcG9uZW50KTtcblxuICAgICAgaWYgKF92aWV3UG9ydFBsYW4yLmNoaWxkTmF2aWdhdGlvbkluc3RydWN0aW9uKSB7XG4gICAgICAgIF92aWV3UG9ydEluc3RydWN0aW9uMy5jaGlsZE5hdmlnYXRpb25JbnN0cnVjdGlvbiA9IF92aWV3UG9ydFBsYW4yLmNoaWxkTmF2aWdhdGlvbkluc3RydWN0aW9uO1xuICAgICAgICBkZXRlcm1pbmVXaGF0VG9Mb2FkKF92aWV3UG9ydFBsYW4yLmNoaWxkTmF2aWdhdGlvbkluc3RydWN0aW9uLCB0b0xvYWQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0b0xvYWQ7XG59XG5cbmZ1bmN0aW9uIGxvYWRSb3V0ZShyb3V0ZUxvYWRlciwgbmF2aWdhdGlvbkluc3RydWN0aW9uLCB2aWV3UG9ydFBsYW4pIHtcbiAgdmFyIG1vZHVsZUlkID0gdmlld1BvcnRQbGFuLmNvbmZpZy5tb2R1bGVJZDtcblxuICByZXR1cm4gbG9hZENvbXBvbmVudChyb3V0ZUxvYWRlciwgbmF2aWdhdGlvbkluc3RydWN0aW9uLCB2aWV3UG9ydFBsYW4uY29uZmlnKS50aGVuKGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICB2YXIgdmlld1BvcnRJbnN0cnVjdGlvbiA9IG5hdmlnYXRpb25JbnN0cnVjdGlvbi5hZGRWaWV3UG9ydEluc3RydWN0aW9uKHZpZXdQb3J0UGxhbi5uYW1lLCB2aWV3UG9ydFBsYW4uc3RyYXRlZ3ksIG1vZHVsZUlkLCBjb21wb25lbnQpO1xuXG4gICAgdmFyIGNoaWxkUm91dGVyID0gY29tcG9uZW50LmNoaWxkUm91dGVyO1xuICAgIGlmIChjaGlsZFJvdXRlcikge1xuICAgICAgdmFyIHBhdGggPSBuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24uZ2V0V2lsZGNhcmRQYXRoKCk7XG5cbiAgICAgIHJldHVybiBjaGlsZFJvdXRlci5fY3JlYXRlTmF2aWdhdGlvbkluc3RydWN0aW9uKHBhdGgsIG5hdmlnYXRpb25JbnN0cnVjdGlvbikudGhlbihmdW5jdGlvbiAoY2hpbGRJbnN0cnVjdGlvbikge1xuICAgICAgICB2aWV3UG9ydFBsYW4uY2hpbGROYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24gPSBjaGlsZEluc3RydWN0aW9uO1xuXG4gICAgICAgIHJldHVybiBfYnVpbGROYXZpZ2F0aW9uUGxhbihjaGlsZEluc3RydWN0aW9uKS50aGVuKGZ1bmN0aW9uIChjaGlsZFBsYW4pIHtcbiAgICAgICAgICBjaGlsZEluc3RydWN0aW9uLnBsYW4gPSBjaGlsZFBsYW47XG4gICAgICAgICAgdmlld1BvcnRJbnN0cnVjdGlvbi5jaGlsZE5hdmlnYXRpb25JbnN0cnVjdGlvbiA9IGNoaWxkSW5zdHJ1Y3Rpb247XG5cbiAgICAgICAgICByZXR1cm4gbG9hZE5ld1JvdXRlKHJvdXRlTG9hZGVyLCBjaGlsZEluc3RydWN0aW9uKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gbG9hZENvbXBvbmVudChyb3V0ZUxvYWRlciwgbmF2aWdhdGlvbkluc3RydWN0aW9uLCBjb25maWcpIHtcbiAgdmFyIHJvdXRlciA9IG5hdmlnYXRpb25JbnN0cnVjdGlvbi5yb3V0ZXI7XG4gIHZhciBsaWZlY3ljbGVBcmdzID0gbmF2aWdhdGlvbkluc3RydWN0aW9uLmxpZmVjeWNsZUFyZ3M7XG5cbiAgcmV0dXJuIHJvdXRlTG9hZGVyLmxvYWRSb3V0ZShyb3V0ZXIsIGNvbmZpZywgbmF2aWdhdGlvbkluc3RydWN0aW9uKS50aGVuKGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICB2YXIgdmlld01vZGVsID0gY29tcG9uZW50LnZpZXdNb2RlbDtcbiAgICB2YXIgY2hpbGRDb250YWluZXIgPSBjb21wb25lbnQuY2hpbGRDb250YWluZXI7XG5cbiAgICBjb21wb25lbnQucm91dGVyID0gcm91dGVyO1xuICAgIGNvbXBvbmVudC5jb25maWcgPSBjb25maWc7XG5cbiAgICBpZiAoJ2NvbmZpZ3VyZVJvdXRlcicgaW4gdmlld01vZGVsKSB7XG4gICAgICB2YXIgX3JldDUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjaGlsZFJvdXRlciA9IGNoaWxkQ29udGFpbmVyLmdldENoaWxkUm91dGVyKCk7XG4gICAgICAgIGNvbXBvbmVudC5jaGlsZFJvdXRlciA9IGNoaWxkUm91dGVyO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdjogY2hpbGRSb3V0ZXIuY29uZmlndXJlKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICByZXR1cm4gdmlld01vZGVsLmNvbmZpZ3VyZVJvdXRlci5hcHBseSh2aWV3TW9kZWwsIFtjLCBjaGlsZFJvdXRlcl0uY29uY2F0KGxpZmVjeWNsZUFyZ3MpKTtcbiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQ7XG4gICAgICAgICAgfSlcbiAgICAgICAgfTtcbiAgICAgIH0oKTtcblxuICAgICAgaWYgKCh0eXBlb2YgX3JldDUgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKF9yZXQ1KSkgPT09IFwib2JqZWN0XCIpIHJldHVybiBfcmV0NS52O1xuICAgIH1cblxuICAgIHJldHVybiBjb21wb25lbnQ7XG4gIH0pO1xufVxuXG52YXIgUGlwZWxpbmVTbG90ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBQaXBlbGluZVNsb3QoY29udGFpbmVyLCBuYW1lLCBhbGlhcykge1xuICAgIFxuXG4gICAgdGhpcy5zdGVwcyA9IFtdO1xuXG4gICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgdGhpcy5zbG90TmFtZSA9IG5hbWU7XG4gICAgdGhpcy5zbG90QWxpYXMgPSBhbGlhcztcbiAgfVxuXG4gIFBpcGVsaW5lU2xvdC5wcm90b3R5cGUuZ2V0U3RlcHMgPSBmdW5jdGlvbiBnZXRTdGVwcygpIHtcbiAgICB2YXIgX3RoaXM2ID0gdGhpcztcblxuICAgIHJldHVybiB0aGlzLnN0ZXBzLm1hcChmdW5jdGlvbiAoeCkge1xuICAgICAgcmV0dXJuIF90aGlzNi5jb250YWluZXIuZ2V0KHgpO1xuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiBQaXBlbGluZVNsb3Q7XG59KCk7XG5cbnZhciBQaXBlbGluZVByb3ZpZGVyID0gZXhwb3J0cy5QaXBlbGluZVByb3ZpZGVyID0gZnVuY3Rpb24gKCkge1xuICBQaXBlbGluZVByb3ZpZGVyLmluamVjdCA9IGZ1bmN0aW9uIGluamVjdCgpIHtcbiAgICByZXR1cm4gW19hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbi5Db250YWluZXJdO1xuICB9O1xuXG4gIGZ1bmN0aW9uIFBpcGVsaW5lUHJvdmlkZXIoY29udGFpbmVyKSB7XG4gICAgXG5cbiAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICB0aGlzLnN0ZXBzID0gW0J1aWxkTmF2aWdhdGlvblBsYW5TdGVwLCBDYW5EZWFjdGl2YXRlUHJldmlvdXNTdGVwLCBMb2FkUm91dGVTdGVwLCB0aGlzLl9jcmVhdGVQaXBlbGluZVNsb3QoJ2F1dGhvcml6ZScpLCBDYW5BY3RpdmF0ZU5leHRTdGVwLCB0aGlzLl9jcmVhdGVQaXBlbGluZVNsb3QoJ3ByZUFjdGl2YXRlJywgJ21vZGVsYmluZCcpLCBEZWFjdGl2YXRlUHJldmlvdXNTdGVwLCBBY3RpdmF0ZU5leHRTdGVwLCB0aGlzLl9jcmVhdGVQaXBlbGluZVNsb3QoJ3ByZVJlbmRlcicsICdwcmVjb21taXQnKSwgQ29tbWl0Q2hhbmdlc1N0ZXAsIHRoaXMuX2NyZWF0ZVBpcGVsaW5lU2xvdCgncG9zdFJlbmRlcicsICdwb3N0Y29tcGxldGUnKV07XG4gIH1cblxuICBQaXBlbGluZVByb3ZpZGVyLnByb3RvdHlwZS5jcmVhdGVQaXBlbGluZSA9IGZ1bmN0aW9uIGNyZWF0ZVBpcGVsaW5lKCkge1xuICAgIHZhciBfdGhpczcgPSB0aGlzO1xuXG4gICAgdmFyIHBpcGVsaW5lID0gbmV3IFBpcGVsaW5lKCk7XG4gICAgdGhpcy5zdGVwcy5mb3JFYWNoKGZ1bmN0aW9uIChzdGVwKSB7XG4gICAgICByZXR1cm4gcGlwZWxpbmUuYWRkU3RlcChfdGhpczcuY29udGFpbmVyLmdldChzdGVwKSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHBpcGVsaW5lO1xuICB9O1xuXG4gIFBpcGVsaW5lUHJvdmlkZXIucHJvdG90eXBlLl9maW5kU3RlcCA9IGZ1bmN0aW9uIF9maW5kU3RlcChuYW1lKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RlcHMuZmluZChmdW5jdGlvbiAoeCkge1xuICAgICAgcmV0dXJuIHguc2xvdE5hbWUgPT09IG5hbWUgfHwgeC5zbG90QWxpYXMgPT09IG5hbWU7XG4gICAgfSk7XG4gIH07XG5cbiAgUGlwZWxpbmVQcm92aWRlci5wcm90b3R5cGUuYWRkU3RlcCA9IGZ1bmN0aW9uIGFkZFN0ZXAobmFtZSwgc3RlcCkge1xuICAgIHZhciBmb3VuZCA9IHRoaXMuX2ZpbmRTdGVwKG5hbWUpO1xuICAgIGlmIChmb3VuZCkge1xuICAgICAgaWYgKCFmb3VuZC5zdGVwcy5pbmNsdWRlcyhzdGVwKSkge1xuICAgICAgICBmb3VuZC5zdGVwcy5wdXNoKHN0ZXApO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcGlwZWxpbmUgc2xvdCBuYW1lOiAnICsgbmFtZSArICcuJyk7XG4gICAgfVxuICB9O1xuXG4gIFBpcGVsaW5lUHJvdmlkZXIucHJvdG90eXBlLnJlbW92ZVN0ZXAgPSBmdW5jdGlvbiByZW1vdmVTdGVwKG5hbWUsIHN0ZXApIHtcbiAgICB2YXIgc2xvdCA9IHRoaXMuX2ZpbmRTdGVwKG5hbWUpO1xuICAgIGlmIChzbG90KSB7XG4gICAgICBzbG90LnN0ZXBzLnNwbGljZShzbG90LnN0ZXBzLmluZGV4T2Yoc3RlcCksIDEpO1xuICAgIH1cbiAgfTtcblxuICBQaXBlbGluZVByb3ZpZGVyLnByb3RvdHlwZS5fY2xlYXJTdGVwcyA9IGZ1bmN0aW9uIF9jbGVhclN0ZXBzKCkge1xuICAgIHZhciBuYW1lID0gYXJndW1lbnRzLmxlbmd0aCA8PSAwIHx8IGFyZ3VtZW50c1swXSA9PT0gdW5kZWZpbmVkID8gJycgOiBhcmd1bWVudHNbMF07XG5cbiAgICB2YXIgc2xvdCA9IHRoaXMuX2ZpbmRTdGVwKG5hbWUpO1xuICAgIGlmIChzbG90KSB7XG4gICAgICBzbG90LnN0ZXBzID0gW107XG4gICAgfVxuICB9O1xuXG4gIFBpcGVsaW5lUHJvdmlkZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgdGhpcy5fY2xlYXJTdGVwcygnYXV0aG9yaXplJyk7XG4gICAgdGhpcy5fY2xlYXJTdGVwcygncHJlQWN0aXZhdGUnKTtcbiAgICB0aGlzLl9jbGVhclN0ZXBzKCdwcmVSZW5kZXInKTtcbiAgICB0aGlzLl9jbGVhclN0ZXBzKCdwb3N0UmVuZGVyJyk7XG4gIH07XG5cbiAgUGlwZWxpbmVQcm92aWRlci5wcm90b3R5cGUuX2NyZWF0ZVBpcGVsaW5lU2xvdCA9IGZ1bmN0aW9uIF9jcmVhdGVQaXBlbGluZVNsb3QobmFtZSwgYWxpYXMpIHtcbiAgICByZXR1cm4gbmV3IFBpcGVsaW5lU2xvdCh0aGlzLmNvbnRhaW5lciwgbmFtZSwgYWxpYXMpO1xuICB9O1xuXG4gIHJldHVybiBQaXBlbGluZVByb3ZpZGVyO1xufSgpO1xuXG52YXIgbG9nZ2VyID0gTG9nTWFuYWdlci5nZXRMb2dnZXIoJ2FwcC1yb3V0ZXInKTtcblxudmFyIEFwcFJvdXRlciA9IGV4cG9ydHMuQXBwUm91dGVyID0gZnVuY3Rpb24gKF9Sb3V0ZXIpIHtcbiAgX2luaGVyaXRzKEFwcFJvdXRlciwgX1JvdXRlcik7XG5cbiAgQXBwUm91dGVyLmluamVjdCA9IGZ1bmN0aW9uIGluamVjdCgpIHtcbiAgICByZXR1cm4gW19hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbi5Db250YWluZXIsIF9hdXJlbGlhSGlzdG9yeS5IaXN0b3J5LCBQaXBlbGluZVByb3ZpZGVyLCBfYXVyZWxpYUV2ZW50QWdncmVnYXRvci5FdmVudEFnZ3JlZ2F0b3JdO1xuICB9O1xuXG4gIGZ1bmN0aW9uIEFwcFJvdXRlcihjb250YWluZXIsIGhpc3RvcnksIHBpcGVsaW5lUHJvdmlkZXIsIGV2ZW50cykge1xuICAgIFxuXG4gICAgdmFyIF90aGlzOCA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9Sb3V0ZXIuY2FsbCh0aGlzLCBjb250YWluZXIsIGhpc3RvcnkpKTtcblxuICAgIF90aGlzOC5waXBlbGluZVByb3ZpZGVyID0gcGlwZWxpbmVQcm92aWRlcjtcbiAgICBfdGhpczguZXZlbnRzID0gZXZlbnRzO1xuICAgIHJldHVybiBfdGhpczg7XG4gIH1cblxuICBBcHBSb3V0ZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgX1JvdXRlci5wcm90b3R5cGUucmVzZXQuY2FsbCh0aGlzKTtcbiAgICB0aGlzLm1heEluc3RydWN0aW9uQ291bnQgPSAxMDtcbiAgICBpZiAoIXRoaXMuX3F1ZXVlKSB7XG4gICAgICB0aGlzLl9xdWV1ZSA9IFtdO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9xdWV1ZS5sZW5ndGggPSAwO1xuICAgIH1cbiAgfTtcblxuICBBcHBSb3V0ZXIucHJvdG90eXBlLmxvYWRVcmwgPSBmdW5jdGlvbiBsb2FkVXJsKHVybCkge1xuICAgIHZhciBfdGhpczkgPSB0aGlzO1xuXG4gICAgcmV0dXJuIHRoaXMuX2NyZWF0ZU5hdmlnYXRpb25JbnN0cnVjdGlvbih1cmwpLnRoZW4oZnVuY3Rpb24gKGluc3RydWN0aW9uKSB7XG4gICAgICByZXR1cm4gX3RoaXM5Ll9xdWV1ZUluc3RydWN0aW9uKGluc3RydWN0aW9uKTtcbiAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihlcnJvcik7XG4gICAgICByZXN0b3JlUHJldmlvdXNMb2NhdGlvbihfdGhpczkpO1xuICAgIH0pO1xuICB9O1xuXG4gIEFwcFJvdXRlci5wcm90b3R5cGUucmVnaXN0ZXJWaWV3UG9ydCA9IGZ1bmN0aW9uIHJlZ2lzdGVyVmlld1BvcnQodmlld1BvcnQsIG5hbWUpIHtcbiAgICB2YXIgX3RoaXMxMCA9IHRoaXM7XG5cbiAgICBfUm91dGVyLnByb3RvdHlwZS5yZWdpc3RlclZpZXdQb3J0LmNhbGwodGhpcywgdmlld1BvcnQsIG5hbWUpO1xuXG4gICAgaWYgKCF0aGlzLmlzQWN0aXZlKSB7XG4gICAgICB2YXIgX3JldDYgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB2aWV3TW9kZWwgPSBfdGhpczEwLl9maW5kVmlld01vZGVsKHZpZXdQb3J0KTtcbiAgICAgICAgaWYgKCdjb25maWd1cmVSb3V0ZXInIGluIHZpZXdNb2RlbCkge1xuICAgICAgICAgIGlmICghX3RoaXMxMC5pc0NvbmZpZ3VyZWQpIHtcbiAgICAgICAgICAgIHZhciBfcmV0NyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgdmFyIHJlc29sdmVDb25maWd1cmVkUHJvbWlzZSA9IF90aGlzMTAuX3Jlc29sdmVDb25maWd1cmVkUHJvbWlzZTtcbiAgICAgICAgICAgICAgX3RoaXMxMC5fcmVzb2x2ZUNvbmZpZ3VyZWRQcm9taXNlID0gZnVuY3Rpb24gKCkge307XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdjoge1xuICAgICAgICAgICAgICAgICAgdjogX3RoaXMxMC5jb25maWd1cmUoZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlld01vZGVsLmNvbmZpZ3VyZVJvdXRlcihjb25maWcsIF90aGlzMTApO1xuICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzMTAuYWN0aXZhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZUNvbmZpZ3VyZWRQcm9taXNlKCk7XG4gICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0oKTtcblxuICAgICAgICAgICAgaWYgKCh0eXBlb2YgX3JldDcgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKF9yZXQ3KSkgPT09IFwib2JqZWN0XCIpIHJldHVybiBfcmV0Ny52O1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBfdGhpczEwLmFjdGl2YXRlKCk7XG4gICAgICAgIH1cbiAgICAgIH0oKTtcblxuICAgICAgaWYgKCh0eXBlb2YgX3JldDYgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKF9yZXQ2KSkgPT09IFwib2JqZWN0XCIpIHJldHVybiBfcmV0Ni52O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9kZXF1ZXVlSW5zdHJ1Y3Rpb24oKTtcbiAgICB9XG5cbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gIH07XG5cbiAgQXBwUm91dGVyLnByb3RvdHlwZS5hY3RpdmF0ZSA9IGZ1bmN0aW9uIGFjdGl2YXRlKG9wdGlvbnMpIHtcbiAgICBpZiAodGhpcy5pc0FjdGl2ZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuaXNBY3RpdmUgPSB0cnVlO1xuICAgIHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyByb3V0ZUhhbmRsZXI6IHRoaXMubG9hZFVybC5iaW5kKHRoaXMpIH0sIHRoaXMub3B0aW9ucywgb3B0aW9ucyk7XG4gICAgdGhpcy5oaXN0b3J5LmFjdGl2YXRlKHRoaXMub3B0aW9ucyk7XG4gICAgdGhpcy5fZGVxdWV1ZUluc3RydWN0aW9uKCk7XG4gIH07XG5cbiAgQXBwUm91dGVyLnByb3RvdHlwZS5kZWFjdGl2YXRlID0gZnVuY3Rpb24gZGVhY3RpdmF0ZSgpIHtcbiAgICB0aGlzLmlzQWN0aXZlID0gZmFsc2U7XG4gICAgdGhpcy5oaXN0b3J5LmRlYWN0aXZhdGUoKTtcbiAgfTtcblxuICBBcHBSb3V0ZXIucHJvdG90eXBlLl9xdWV1ZUluc3RydWN0aW9uID0gZnVuY3Rpb24gX3F1ZXVlSW5zdHJ1Y3Rpb24oaW5zdHJ1Y3Rpb24pIHtcbiAgICB2YXIgX3RoaXMxMSA9IHRoaXM7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcbiAgICAgIGluc3RydWN0aW9uLnJlc29sdmUgPSByZXNvbHZlO1xuICAgICAgX3RoaXMxMS5fcXVldWUudW5zaGlmdChpbnN0cnVjdGlvbik7XG4gICAgICBfdGhpczExLl9kZXF1ZXVlSW5zdHJ1Y3Rpb24oKTtcbiAgICB9KTtcbiAgfTtcblxuICBBcHBSb3V0ZXIucHJvdG90eXBlLl9kZXF1ZXVlSW5zdHJ1Y3Rpb24gPSBmdW5jdGlvbiBfZGVxdWV1ZUluc3RydWN0aW9uKCkge1xuICAgIHZhciBfdGhpczEyID0gdGhpcztcblxuICAgIHZhciBpbnN0cnVjdGlvbkNvdW50ID0gYXJndW1lbnRzLmxlbmd0aCA8PSAwIHx8IGFyZ3VtZW50c1swXSA9PT0gdW5kZWZpbmVkID8gMCA6IGFyZ3VtZW50c1swXTtcblxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChfdGhpczEyLmlzTmF2aWdhdGluZyAmJiAhaW5zdHJ1Y3Rpb25Db3VudCkge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuXG4gICAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBfdGhpczEyLl9xdWV1ZS5zaGlmdCgpO1xuICAgICAgX3RoaXMxMi5fcXVldWUubGVuZ3RoID0gMDtcblxuICAgICAgaWYgKCFpbnN0cnVjdGlvbikge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuXG4gICAgICBfdGhpczEyLmlzTmF2aWdhdGluZyA9IHRydWU7XG4gICAgICBpbnN0cnVjdGlvbi5wcmV2aW91c0luc3RydWN0aW9uID0gX3RoaXMxMi5jdXJyZW50SW5zdHJ1Y3Rpb247XG5cbiAgICAgIGlmICghaW5zdHJ1Y3Rpb25Db3VudCkge1xuICAgICAgICBfdGhpczEyLmV2ZW50cy5wdWJsaXNoKCdyb3V0ZXI6bmF2aWdhdGlvbjpwcm9jZXNzaW5nJywgeyBpbnN0cnVjdGlvbjogaW5zdHJ1Y3Rpb24gfSk7XG4gICAgICB9IGVsc2UgaWYgKGluc3RydWN0aW9uQ291bnQgPT09IF90aGlzMTIubWF4SW5zdHJ1Y3Rpb25Db3VudCAtIDEpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKGluc3RydWN0aW9uQ291bnQgKyAxICsgJyBuYXZpZ2F0aW9uIGluc3RydWN0aW9ucyBoYXZlIGJlZW4gYXR0ZW1wdGVkIHdpdGhvdXQgc3VjY2Vzcy4gUmVzdG9yaW5nIGxhc3Qga25vd24gZ29vZCBsb2NhdGlvbi4nKTtcbiAgICAgICAgcmVzdG9yZVByZXZpb3VzTG9jYXRpb24oX3RoaXMxMik7XG4gICAgICAgIHJldHVybiBfdGhpczEyLl9kZXF1ZXVlSW5zdHJ1Y3Rpb24oaW5zdHJ1Y3Rpb25Db3VudCArIDEpO1xuICAgICAgfSBlbHNlIGlmIChpbnN0cnVjdGlvbkNvdW50ID4gX3RoaXMxMi5tYXhJbnN0cnVjdGlvbkNvdW50KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTWF4aW11bSBuYXZpZ2F0aW9uIGF0dGVtcHRzIGV4Y2VlZGVkLiBHaXZpbmcgdXAuJyk7XG4gICAgICB9XG5cbiAgICAgIHZhciBwaXBlbGluZSA9IF90aGlzMTIucGlwZWxpbmVQcm92aWRlci5jcmVhdGVQaXBlbGluZSgpO1xuXG4gICAgICByZXR1cm4gcGlwZWxpbmUucnVuKGluc3RydWN0aW9uKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgcmV0dXJuIHByb2Nlc3NSZXN1bHQoaW5zdHJ1Y3Rpb24sIHJlc3VsdCwgaW5zdHJ1Y3Rpb25Db3VudCwgX3RoaXMxMik7XG4gICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHsgb3V0cHV0OiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoZXJyb3IpIH07XG4gICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgcmV0dXJuIHJlc29sdmVJbnN0cnVjdGlvbihpbnN0cnVjdGlvbiwgcmVzdWx0LCAhIWluc3RydWN0aW9uQ291bnQsIF90aGlzMTIpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG5cbiAgQXBwUm91dGVyLnByb3RvdHlwZS5fZmluZFZpZXdNb2RlbCA9IGZ1bmN0aW9uIF9maW5kVmlld01vZGVsKHZpZXdQb3J0KSB7XG4gICAgaWYgKHRoaXMuY29udGFpbmVyLnZpZXdNb2RlbCkge1xuICAgICAgcmV0dXJuIHRoaXMuY29udGFpbmVyLnZpZXdNb2RlbDtcbiAgICB9XG5cbiAgICBpZiAodmlld1BvcnQuY29udGFpbmVyKSB7XG4gICAgICB2YXIgY29udGFpbmVyID0gdmlld1BvcnQuY29udGFpbmVyO1xuXG4gICAgICB3aGlsZSAoY29udGFpbmVyKSB7XG4gICAgICAgIGlmIChjb250YWluZXIudmlld01vZGVsKSB7XG4gICAgICAgICAgdGhpcy5jb250YWluZXIudmlld01vZGVsID0gY29udGFpbmVyLnZpZXdNb2RlbDtcbiAgICAgICAgICByZXR1cm4gY29udGFpbmVyLnZpZXdNb2RlbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnRhaW5lciA9IGNvbnRhaW5lci5wYXJlbnQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfTtcblxuICByZXR1cm4gQXBwUm91dGVyO1xufShSb3V0ZXIpO1xuXG5mdW5jdGlvbiBwcm9jZXNzUmVzdWx0KGluc3RydWN0aW9uLCByZXN1bHQsIGluc3RydWN0aW9uQ291bnQsIHJvdXRlcikge1xuICBpZiAoIShyZXN1bHQgJiYgJ2NvbXBsZXRlZCcgaW4gcmVzdWx0ICYmICdvdXRwdXQnIGluIHJlc3VsdCkpIHtcbiAgICByZXN1bHQgPSByZXN1bHQgfHwge307XG4gICAgcmVzdWx0Lm91dHB1dCA9IG5ldyBFcnJvcignRXhwZWN0ZWQgcm91dGVyIHBpcGVsaW5lIHRvIHJldHVybiBhIG5hdmlnYXRpb24gcmVzdWx0LCBidXQgZ290IFsnICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0KSArICddIGluc3RlYWQuJyk7XG4gIH1cblxuICB2YXIgZmluYWxSZXN1bHQgPSBudWxsO1xuICBpZiAoaXNOYXZpZ2F0aW9uQ29tbWFuZChyZXN1bHQub3V0cHV0KSkge1xuICAgIHJlc3VsdC5vdXRwdXQubmF2aWdhdGUocm91dGVyKTtcbiAgfSBlbHNlIHtcbiAgICBmaW5hbFJlc3VsdCA9IHJlc3VsdDtcblxuICAgIGlmICghcmVzdWx0LmNvbXBsZXRlZCkge1xuICAgICAgaWYgKHJlc3VsdC5vdXRwdXQgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICBsb2dnZXIuZXJyb3IocmVzdWx0Lm91dHB1dCk7XG4gICAgICB9XG5cbiAgICAgIHJlc3RvcmVQcmV2aW91c0xvY2F0aW9uKHJvdXRlcik7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJvdXRlci5fZGVxdWV1ZUluc3RydWN0aW9uKGluc3RydWN0aW9uQ291bnQgKyAxKS50aGVuKGZ1bmN0aW9uIChpbm5lclJlc3VsdCkge1xuICAgIHJldHVybiBmaW5hbFJlc3VsdCB8fCBpbm5lclJlc3VsdCB8fCByZXN1bHQ7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiByZXNvbHZlSW5zdHJ1Y3Rpb24oaW5zdHJ1Y3Rpb24sIHJlc3VsdCwgaXNJbm5lckluc3RydWN0aW9uLCByb3V0ZXIpIHtcbiAgaW5zdHJ1Y3Rpb24ucmVzb2x2ZShyZXN1bHQpO1xuXG4gIGlmICghaXNJbm5lckluc3RydWN0aW9uKSB7XG4gICAgcm91dGVyLmlzTmF2aWdhdGluZyA9IGZhbHNlO1xuICAgIHZhciBldmVudEFyZ3MgPSB7IGluc3RydWN0aW9uOiBpbnN0cnVjdGlvbiwgcmVzdWx0OiByZXN1bHQgfTtcbiAgICB2YXIgZXZlbnROYW1lID0gdm9pZCAwO1xuXG4gICAgaWYgKHJlc3VsdC5vdXRwdXQgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgZXZlbnROYW1lID0gJ2Vycm9yJztcbiAgICB9IGVsc2UgaWYgKCFyZXN1bHQuY29tcGxldGVkKSB7XG4gICAgICBldmVudE5hbWUgPSAnY2FuY2VsZWQnO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgX3F1ZXJ5U3RyaW5nID0gaW5zdHJ1Y3Rpb24ucXVlcnlTdHJpbmcgPyAnPycgKyBpbnN0cnVjdGlvbi5xdWVyeVN0cmluZyA6ICcnO1xuICAgICAgcm91dGVyLmhpc3RvcnkucHJldmlvdXNMb2NhdGlvbiA9IGluc3RydWN0aW9uLmZyYWdtZW50ICsgX3F1ZXJ5U3RyaW5nO1xuICAgICAgZXZlbnROYW1lID0gJ3N1Y2Nlc3MnO1xuICAgIH1cblxuICAgIHJvdXRlci5ldmVudHMucHVibGlzaCgncm91dGVyOm5hdmlnYXRpb246JyArIGV2ZW50TmFtZSwgZXZlbnRBcmdzKTtcbiAgICByb3V0ZXIuZXZlbnRzLnB1Ymxpc2goJ3JvdXRlcjpuYXZpZ2F0aW9uOmNvbXBsZXRlJywgZXZlbnRBcmdzKTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIHJlc3RvcmVQcmV2aW91c0xvY2F0aW9uKHJvdXRlcikge1xuICB2YXIgcHJldmlvdXNMb2NhdGlvbiA9IHJvdXRlci5oaXN0b3J5LnByZXZpb3VzTG9jYXRpb247XG4gIGlmIChwcmV2aW91c0xvY2F0aW9uKSB7XG4gICAgcm91dGVyLm5hdmlnYXRlKHJvdXRlci5oaXN0b3J5LnByZXZpb3VzTG9jYXRpb24sIHsgdHJpZ2dlcjogZmFsc2UsIHJlcGxhY2U6IHRydWUgfSk7XG4gIH0gZWxzZSB7XG4gICAgbG9nZ2VyLmVycm9yKCdSb3V0ZXIgbmF2aWdhdGlvbiBmYWlsZWQsIGFuZCBubyBwcmV2aW91cyBsb2NhdGlvbiBjb3VsZCBiZSByZXN0b3JlZC4nKTtcbiAgfVxufVxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLXJvdXRlci9kaXN0L2NvbW1vbmpzL2F1cmVsaWEtcm91dGVyLmpzXG4vLyBtb2R1bGUgaWQgPSA5XG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuQmFzZUNvbmZpZyA9IHVuZGVmaW5lZDtcblxudmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTtcblxudmFyIF9hdXRoVXRpbGl0aWVzID0gcmVxdWlyZSgnLi9hdXRoLXV0aWxpdGllcycpO1xuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7IH0gfVxuXG52YXIgQmFzZUNvbmZpZyA9IGV4cG9ydHMuQmFzZUNvbmZpZyA9IGZ1bmN0aW9uICgpIHtcbiAgQmFzZUNvbmZpZy5wcm90b3R5cGUuY29uZmlndXJlID0gZnVuY3Rpb24gY29uZmlndXJlKGluY29taW5nQ29uZmlnKSB7XG4gICAgKDAsIF9hdXRoVXRpbGl0aWVzLm1lcmdlKSh0aGlzLl9jdXJyZW50LCBpbmNvbWluZ0NvbmZpZyk7XG4gIH07XG5cbiAgX2NyZWF0ZUNsYXNzKEJhc2VDb25maWcsIFt7XG4gICAga2V5OiAnY3VycmVudCcsXG4gICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fY3VycmVudDtcbiAgICB9XG4gIH1dKTtcblxuICBmdW5jdGlvbiBCYXNlQ29uZmlnKCkge1xuICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBCYXNlQ29uZmlnKTtcblxuICAgIHRoaXMuX2N1cnJlbnQgPSB7XG4gICAgICBodHRwSW50ZXJjZXB0b3I6IHRydWUsXG4gICAgICBsb2dpbk9uU2lnbnVwOiB0cnVlLFxuICAgICAgYmFzZVVybDogJy8nLFxuICAgICAgbG9naW5SZWRpcmVjdDogJyMvJyxcbiAgICAgIGxvZ291dFJlZGlyZWN0OiAnIy8nLFxuICAgICAgc2lnbnVwUmVkaXJlY3Q6ICcjL2xvZ2luJyxcbiAgICAgIGxvZ2luVXJsOiAnL2F1dGgvbG9naW4nLFxuICAgICAgc2lnbnVwVXJsOiAnL2F1dGgvc2lnbnVwJyxcbiAgICAgIHByb2ZpbGVVcmw6ICcvYXV0aC9tZScsXG4gICAgICBsb2dpblJvdXRlOiAnL2xvZ2luJyxcbiAgICAgIHNpZ251cFJvdXRlOiAnL3NpZ251cCcsXG4gICAgICB0b2tlblJvb3Q6IGZhbHNlLFxuICAgICAgdG9rZW5OYW1lOiAndG9rZW4nLFxuICAgICAgaWRUb2tlbk5hbWU6ICdpZF90b2tlbicsXG4gICAgICB0b2tlblByZWZpeDogJ2F1cmVsaWEnLFxuICAgICAgcmVzcG9uc2VUb2tlblByb3A6ICdhY2Nlc3NfdG9rZW4nLFxuICAgICAgcmVzcG9uc2VJZFRva2VuUHJvcDogJ2lkX3Rva2VuJyxcbiAgICAgIHVubGlua1VybDogJy9hdXRoL3VubGluay8nLFxuICAgICAgdW5saW5rTWV0aG9kOiAnZ2V0JyxcbiAgICAgIGF1dGhIZWFkZXI6ICdBdXRob3JpemF0aW9uJyxcbiAgICAgIGF1dGhUb2tlbjogJ0JlYXJlcicsXG4gICAgICB3aXRoQ3JlZGVudGlhbHM6IHRydWUsXG4gICAgICBwbGF0Zm9ybTogJ2Jyb3dzZXInLFxuICAgICAgc3RvcmFnZTogJ2xvY2FsU3RvcmFnZScsXG4gICAgICBwcm92aWRlcnM6IHtcbiAgICAgICAgaWRlbnRTcnY6IHtcbiAgICAgICAgICBuYW1lOiAnaWRlbnRTcnYnLFxuICAgICAgICAgIHVybDogJy9hdXRoL2lkZW50U3J2JyxcblxuICAgICAgICAgIHJlZGlyZWN0VXJpOiB3aW5kb3cubG9jYXRpb24ub3JpZ2luIHx8IHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyB3aW5kb3cubG9jYXRpb24uaG9zdCxcbiAgICAgICAgICBzY29wZTogWydwcm9maWxlJywgJ29wZW5pZCddLFxuICAgICAgICAgIHJlc3BvbnNlVHlwZTogJ2NvZGUnLFxuICAgICAgICAgIHNjb3BlUHJlZml4OiAnJyxcbiAgICAgICAgICBzY29wZURlbGltaXRlcjogJyAnLFxuICAgICAgICAgIHJlcXVpcmVkVXJsUGFyYW1zOiBbJ3Njb3BlJywgJ25vbmNlJ10sXG4gICAgICAgICAgb3B0aW9uYWxVcmxQYXJhbXM6IFsnZGlzcGxheScsICdzdGF0ZSddLFxuICAgICAgICAgIHN0YXRlOiBmdW5jdGlvbiBzdGF0ZSgpIHtcbiAgICAgICAgICAgIHZhciByYW5kID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIpO1xuICAgICAgICAgICAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudChyYW5kKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRpc3BsYXk6ICdwb3B1cCcsXG4gICAgICAgICAgdHlwZTogJzIuMCcsXG4gICAgICAgICAgY2xpZW50SWQ6ICdqc0NsaWVudCcsXG4gICAgICAgICAgbm9uY2U6IGZ1bmN0aW9uIG5vbmNlKCkge1xuICAgICAgICAgICAgdmFyIHZhbCA9ICgoRGF0ZS5ub3coKSArIE1hdGgucmFuZG9tKCkpICogTWF0aC5yYW5kb20oKSkudG9TdHJpbmcoKS5yZXBsYWNlKCcuJywgJycpO1xuICAgICAgICAgICAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudCh2YWwpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcG9wdXBPcHRpb25zOiB7IHdpZHRoOiA0NTIsIGhlaWdodDogNjMzIH1cbiAgICAgICAgfSxcbiAgICAgICAgZ29vZ2xlOiB7XG4gICAgICAgICAgbmFtZTogJ2dvb2dsZScsXG4gICAgICAgICAgdXJsOiAnL2F1dGgvZ29vZ2xlJyxcbiAgICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6ICdodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCcsXG4gICAgICAgICAgcmVkaXJlY3RVcmk6IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gfHwgd2luZG93LmxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIHdpbmRvdy5sb2NhdGlvbi5ob3N0LFxuICAgICAgICAgIHNjb3BlOiBbJ3Byb2ZpbGUnLCAnZW1haWwnXSxcbiAgICAgICAgICBzY29wZVByZWZpeDogJ29wZW5pZCcsXG4gICAgICAgICAgc2NvcGVEZWxpbWl0ZXI6ICcgJyxcbiAgICAgICAgICByZXF1aXJlZFVybFBhcmFtczogWydzY29wZSddLFxuICAgICAgICAgIG9wdGlvbmFsVXJsUGFyYW1zOiBbJ2Rpc3BsYXknLCAnc3RhdGUnXSxcbiAgICAgICAgICBkaXNwbGF5OiAncG9wdXAnLFxuICAgICAgICAgIHR5cGU6ICcyLjAnLFxuICAgICAgICAgIHN0YXRlOiBmdW5jdGlvbiBzdGF0ZSgpIHtcbiAgICAgICAgICAgIHZhciByYW5kID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIpO1xuICAgICAgICAgICAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudChyYW5kKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBvcHVwT3B0aW9uczoge1xuICAgICAgICAgICAgd2lkdGg6IDQ1MixcbiAgICAgICAgICAgIGhlaWdodDogNjMzXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBmYWNlYm9vazoge1xuICAgICAgICAgIG5hbWU6ICdmYWNlYm9vaycsXG4gICAgICAgICAgdXJsOiAnL2F1dGgvZmFjZWJvb2snLFxuICAgICAgICAgIGF1dGhvcml6YXRpb25FbmRwb2ludDogJ2h0dHBzOi8vd3d3LmZhY2Vib29rLmNvbS92Mi4zL2RpYWxvZy9vYXV0aCcsXG4gICAgICAgICAgcmVkaXJlY3RVcmk6IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gKyAnLycgfHwgd2luZG93LmxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIHdpbmRvdy5sb2NhdGlvbi5ob3N0ICsgJy8nLFxuICAgICAgICAgIHNjb3BlOiBbJ2VtYWlsJ10sXG4gICAgICAgICAgc2NvcGVEZWxpbWl0ZXI6ICcsJyxcbiAgICAgICAgICBub25jZTogZnVuY3Rpb24gbm9uY2UoKSB7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5yYW5kb20oKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJlcXVpcmVkVXJsUGFyYW1zOiBbJ25vbmNlJywgJ2Rpc3BsYXknLCAnc2NvcGUnXSxcbiAgICAgICAgICBkaXNwbGF5OiAncG9wdXAnLFxuICAgICAgICAgIHR5cGU6ICcyLjAnLFxuICAgICAgICAgIHBvcHVwT3B0aW9uczoge1xuICAgICAgICAgICAgd2lkdGg6IDU4MCxcbiAgICAgICAgICAgIGhlaWdodDogNDAwXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBsaW5rZWRpbjoge1xuICAgICAgICAgIG5hbWU6ICdsaW5rZWRpbicsXG4gICAgICAgICAgdXJsOiAnL2F1dGgvbGlua2VkaW4nLFxuICAgICAgICAgIGF1dGhvcml6YXRpb25FbmRwb2ludDogJ2h0dHBzOi8vd3d3LmxpbmtlZGluLmNvbS91YXMvb2F1dGgyL2F1dGhvcml6YXRpb24nLFxuICAgICAgICAgIHJlZGlyZWN0VXJpOiB3aW5kb3cubG9jYXRpb24ub3JpZ2luIHx8IHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyB3aW5kb3cubG9jYXRpb24uaG9zdCxcbiAgICAgICAgICByZXF1aXJlZFVybFBhcmFtczogWydzdGF0ZSddLFxuICAgICAgICAgIHNjb3BlOiBbJ3JfZW1haWxhZGRyZXNzJ10sXG4gICAgICAgICAgc2NvcGVEZWxpbWl0ZXI6ICcgJyxcbiAgICAgICAgICBzdGF0ZTogJ1NUQVRFJyxcbiAgICAgICAgICB0eXBlOiAnMi4wJyxcbiAgICAgICAgICBwb3B1cE9wdGlvbnM6IHtcbiAgICAgICAgICAgIHdpZHRoOiA1MjcsXG4gICAgICAgICAgICBoZWlnaHQ6IDU4MlxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZ2l0aHViOiB7XG4gICAgICAgICAgbmFtZTogJ2dpdGh1YicsXG4gICAgICAgICAgdXJsOiAnL2F1dGgvZ2l0aHViJyxcbiAgICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6ICdodHRwczovL2dpdGh1Yi5jb20vbG9naW4vb2F1dGgvYXV0aG9yaXplJyxcbiAgICAgICAgICByZWRpcmVjdFVyaTogd2luZG93LmxvY2F0aW9uLm9yaWdpbiB8fCB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgd2luZG93LmxvY2F0aW9uLmhvc3QsXG4gICAgICAgICAgb3B0aW9uYWxVcmxQYXJhbXM6IFsnc2NvcGUnXSxcbiAgICAgICAgICBzY29wZTogWyd1c2VyOmVtYWlsJ10sXG4gICAgICAgICAgc2NvcGVEZWxpbWl0ZXI6ICcgJyxcbiAgICAgICAgICB0eXBlOiAnMi4wJyxcbiAgICAgICAgICBwb3B1cE9wdGlvbnM6IHtcbiAgICAgICAgICAgIHdpZHRoOiAxMDIwLFxuICAgICAgICAgICAgaGVpZ2h0OiA2MThcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHlhaG9vOiB7XG4gICAgICAgICAgbmFtZTogJ3lhaG9vJyxcbiAgICAgICAgICB1cmw6ICcvYXV0aC95YWhvbycsXG4gICAgICAgICAgYXV0aG9yaXphdGlvbkVuZHBvaW50OiAnaHR0cHM6Ly9hcGkubG9naW4ueWFob28uY29tL29hdXRoMi9yZXF1ZXN0X2F1dGgnLFxuICAgICAgICAgIHJlZGlyZWN0VXJpOiB3aW5kb3cubG9jYXRpb24ub3JpZ2luIHx8IHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyB3aW5kb3cubG9jYXRpb24uaG9zdCxcbiAgICAgICAgICBzY29wZTogW10sXG4gICAgICAgICAgc2NvcGVEZWxpbWl0ZXI6ICcsJyxcbiAgICAgICAgICB0eXBlOiAnMi4wJyxcbiAgICAgICAgICBwb3B1cE9wdGlvbnM6IHtcbiAgICAgICAgICAgIHdpZHRoOiA1NTksXG4gICAgICAgICAgICBoZWlnaHQ6IDUxOVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgdHdpdHRlcjoge1xuICAgICAgICAgIG5hbWU6ICd0d2l0dGVyJyxcbiAgICAgICAgICB1cmw6ICcvYXV0aC90d2l0dGVyJyxcbiAgICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6ICdodHRwczovL2FwaS50d2l0dGVyLmNvbS9vYXV0aC9hdXRoZW50aWNhdGUnLFxuICAgICAgICAgIHR5cGU6ICcxLjAnLFxuICAgICAgICAgIHBvcHVwT3B0aW9uczoge1xuICAgICAgICAgICAgd2lkdGg6IDQ5NSxcbiAgICAgICAgICAgIGhlaWdodDogNjQ1XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBsaXZlOiB7XG4gICAgICAgICAgbmFtZTogJ2xpdmUnLFxuICAgICAgICAgIHVybDogJy9hdXRoL2xpdmUnLFxuICAgICAgICAgIGF1dGhvcml6YXRpb25FbmRwb2ludDogJ2h0dHBzOi8vbG9naW4ubGl2ZS5jb20vb2F1dGgyMF9hdXRob3JpemUuc3JmJyxcbiAgICAgICAgICByZWRpcmVjdFVyaTogd2luZG93LmxvY2F0aW9uLm9yaWdpbiB8fCB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgd2luZG93LmxvY2F0aW9uLmhvc3QsXG4gICAgICAgICAgc2NvcGU6IFsnd2wuZW1haWxzJ10sXG4gICAgICAgICAgc2NvcGVEZWxpbWl0ZXI6ICcgJyxcbiAgICAgICAgICByZXF1aXJlZFVybFBhcmFtczogWydkaXNwbGF5JywgJ3Njb3BlJ10sXG4gICAgICAgICAgZGlzcGxheTogJ3BvcHVwJyxcbiAgICAgICAgICB0eXBlOiAnMi4wJyxcbiAgICAgICAgICBwb3B1cE9wdGlvbnM6IHtcbiAgICAgICAgICAgIHdpZHRoOiA1MDAsXG4gICAgICAgICAgICBoZWlnaHQ6IDU2MFxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW5zdGFncmFtOiB7XG4gICAgICAgICAgbmFtZTogJ2luc3RhZ3JhbScsXG4gICAgICAgICAgdXJsOiAnL2F1dGgvaW5zdGFncmFtJyxcbiAgICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6ICdodHRwczovL2FwaS5pbnN0YWdyYW0uY29tL29hdXRoL2F1dGhvcml6ZScsXG4gICAgICAgICAgcmVkaXJlY3RVcmk6IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gfHwgd2luZG93LmxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIHdpbmRvdy5sb2NhdGlvbi5ob3N0LFxuICAgICAgICAgIHJlcXVpcmVkVXJsUGFyYW1zOiBbJ3Njb3BlJ10sXG4gICAgICAgICAgc2NvcGU6IFsnYmFzaWMnXSxcbiAgICAgICAgICBzY29wZURlbGltaXRlcjogJysnLFxuICAgICAgICAgIGRpc3BsYXk6ICdwb3B1cCcsXG4gICAgICAgICAgdHlwZTogJzIuMCcsXG4gICAgICAgICAgcG9wdXBPcHRpb25zOiB7XG4gICAgICAgICAgICB3aWR0aDogNTUwLFxuICAgICAgICAgICAgaGVpZ2h0OiAzNjlcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgcmV0dXJuIEJhc2VDb25maWc7XG59KCk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtYXV0aC9kaXN0L2NvbW1vbmpzL2Jhc2UtY29uZmlnLmpzXG4vLyBtb2R1bGUgaWQgPSAxMFxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLlRhc2tRdWV1ZSA9IHVuZGVmaW5lZDtcblxudmFyIF9hdXJlbGlhUGFsID0gcmVxdWlyZSgnYXVyZWxpYS1wYWwnKTtcblxuXG5cbnZhciBoYXNTZXRJbW1lZGlhdGUgPSB0eXBlb2Ygc2V0SW1tZWRpYXRlID09PSAnZnVuY3Rpb24nO1xuXG5mdW5jdGlvbiBtYWtlUmVxdWVzdEZsdXNoRnJvbU11dGF0aW9uT2JzZXJ2ZXIoZmx1c2gpIHtcbiAgdmFyIHRvZ2dsZSA9IDE7XG4gIHZhciBvYnNlcnZlciA9IF9hdXJlbGlhUGFsLkRPTS5jcmVhdGVNdXRhdGlvbk9ic2VydmVyKGZsdXNoKTtcbiAgdmFyIG5vZGUgPSBfYXVyZWxpYVBhbC5ET00uY3JlYXRlVGV4dE5vZGUoJycpO1xuICBvYnNlcnZlci5vYnNlcnZlKG5vZGUsIHsgY2hhcmFjdGVyRGF0YTogdHJ1ZSB9KTtcbiAgcmV0dXJuIGZ1bmN0aW9uIHJlcXVlc3RGbHVzaCgpIHtcbiAgICB0b2dnbGUgPSAtdG9nZ2xlO1xuICAgIG5vZGUuZGF0YSA9IHRvZ2dsZTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gbWFrZVJlcXVlc3RGbHVzaEZyb21UaW1lcihmbHVzaCkge1xuICByZXR1cm4gZnVuY3Rpb24gcmVxdWVzdEZsdXNoKCkge1xuICAgIHZhciB0aW1lb3V0SGFuZGxlID0gc2V0VGltZW91dChoYW5kbGVGbHVzaFRpbWVyLCAwKTtcblxuICAgIHZhciBpbnRlcnZhbEhhbmRsZSA9IHNldEludGVydmFsKGhhbmRsZUZsdXNoVGltZXIsIDUwKTtcbiAgICBmdW5jdGlvbiBoYW5kbGVGbHVzaFRpbWVyKCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRIYW5kbGUpO1xuICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbEhhbmRsZSk7XG4gICAgICBmbHVzaCgpO1xuICAgIH1cbiAgfTtcbn1cblxuZnVuY3Rpb24gb25FcnJvcihlcnJvciwgdGFzaykge1xuICBpZiAoJ29uRXJyb3InIGluIHRhc2spIHtcbiAgICB0YXNrLm9uRXJyb3IoZXJyb3IpO1xuICB9IGVsc2UgaWYgKGhhc1NldEltbWVkaWF0ZSkge1xuICAgIHNldEltbWVkaWF0ZShmdW5jdGlvbiAoKSB7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH0sIDApO1xuICB9XG59XG5cbnZhciBUYXNrUXVldWUgPSBleHBvcnRzLlRhc2tRdWV1ZSA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gVGFza1F1ZXVlKCkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICBcblxuICAgIHRoaXMubWljcm9UYXNrUXVldWUgPSBbXTtcbiAgICB0aGlzLm1pY3JvVGFza1F1ZXVlQ2FwYWNpdHkgPSAxMDI0O1xuICAgIHRoaXMudGFza1F1ZXVlID0gW107XG5cbiAgICBpZiAoX2F1cmVsaWFQYWwuRkVBVFVSRS5tdXRhdGlvbk9ic2VydmVyKSB7XG4gICAgICB0aGlzLnJlcXVlc3RGbHVzaE1pY3JvVGFza1F1ZXVlID0gbWFrZVJlcXVlc3RGbHVzaEZyb21NdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzLmZsdXNoTWljcm9UYXNrUXVldWUoKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlcXVlc3RGbHVzaE1pY3JvVGFza1F1ZXVlID0gbWFrZVJlcXVlc3RGbHVzaEZyb21UaW1lcihmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpcy5mbHVzaE1pY3JvVGFza1F1ZXVlKCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB0aGlzLnJlcXVlc3RGbHVzaFRhc2tRdWV1ZSA9IG1ha2VSZXF1ZXN0Rmx1c2hGcm9tVGltZXIoZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIF90aGlzLmZsdXNoVGFza1F1ZXVlKCk7XG4gICAgfSk7XG4gIH1cblxuICBUYXNrUXVldWUucHJvdG90eXBlLnF1ZXVlTWljcm9UYXNrID0gZnVuY3Rpb24gcXVldWVNaWNyb1Rhc2sodGFzaykge1xuICAgIGlmICh0aGlzLm1pY3JvVGFza1F1ZXVlLmxlbmd0aCA8IDEpIHtcbiAgICAgIHRoaXMucmVxdWVzdEZsdXNoTWljcm9UYXNrUXVldWUoKTtcbiAgICB9XG5cbiAgICB0aGlzLm1pY3JvVGFza1F1ZXVlLnB1c2godGFzayk7XG4gIH07XG5cbiAgVGFza1F1ZXVlLnByb3RvdHlwZS5xdWV1ZVRhc2sgPSBmdW5jdGlvbiBxdWV1ZVRhc2sodGFzaykge1xuICAgIGlmICh0aGlzLnRhc2tRdWV1ZS5sZW5ndGggPCAxKSB7XG4gICAgICB0aGlzLnJlcXVlc3RGbHVzaFRhc2tRdWV1ZSgpO1xuICAgIH1cblxuICAgIHRoaXMudGFza1F1ZXVlLnB1c2godGFzayk7XG4gIH07XG5cbiAgVGFza1F1ZXVlLnByb3RvdHlwZS5mbHVzaFRhc2tRdWV1ZSA9IGZ1bmN0aW9uIGZsdXNoVGFza1F1ZXVlKCkge1xuICAgIHZhciBxdWV1ZSA9IHRoaXMudGFza1F1ZXVlO1xuICAgIHZhciBpbmRleCA9IDA7XG4gICAgdmFyIHRhc2sgPSB2b2lkIDA7XG5cbiAgICB0aGlzLnRhc2tRdWV1ZSA9IFtdO1xuXG4gICAgdHJ5IHtcbiAgICAgIHdoaWxlIChpbmRleCA8IHF1ZXVlLmxlbmd0aCkge1xuICAgICAgICB0YXNrID0gcXVldWVbaW5kZXhdO1xuICAgICAgICB0YXNrLmNhbGwoKTtcbiAgICAgICAgaW5kZXgrKztcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgb25FcnJvcihlcnJvciwgdGFzayk7XG4gICAgfVxuICB9O1xuXG4gIFRhc2tRdWV1ZS5wcm90b3R5cGUuZmx1c2hNaWNyb1Rhc2tRdWV1ZSA9IGZ1bmN0aW9uIGZsdXNoTWljcm9UYXNrUXVldWUoKSB7XG4gICAgdmFyIHF1ZXVlID0gdGhpcy5taWNyb1Rhc2tRdWV1ZTtcbiAgICB2YXIgY2FwYWNpdHkgPSB0aGlzLm1pY3JvVGFza1F1ZXVlQ2FwYWNpdHk7XG4gICAgdmFyIGluZGV4ID0gMDtcbiAgICB2YXIgdGFzayA9IHZvaWQgMDtcblxuICAgIHRyeSB7XG4gICAgICB3aGlsZSAoaW5kZXggPCBxdWV1ZS5sZW5ndGgpIHtcbiAgICAgICAgdGFzayA9IHF1ZXVlW2luZGV4XTtcbiAgICAgICAgdGFzay5jYWxsKCk7XG4gICAgICAgIGluZGV4Kys7XG5cbiAgICAgICAgaWYgKGluZGV4ID4gY2FwYWNpdHkpIHtcbiAgICAgICAgICBmb3IgKHZhciBzY2FuID0gMCwgbmV3TGVuZ3RoID0gcXVldWUubGVuZ3RoIC0gaW5kZXg7IHNjYW4gPCBuZXdMZW5ndGg7IHNjYW4rKykge1xuICAgICAgICAgICAgcXVldWVbc2Nhbl0gPSBxdWV1ZVtzY2FuICsgaW5kZXhdO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHF1ZXVlLmxlbmd0aCAtPSBpbmRleDtcbiAgICAgICAgICBpbmRleCA9IDA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgb25FcnJvcihlcnJvciwgdGFzayk7XG4gICAgfVxuXG4gICAgcXVldWUubGVuZ3RoID0gMDtcbiAgfTtcblxuICByZXR1cm4gVGFza1F1ZXVlO1xufSgpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLXRhc2stcXVldWUvZGlzdC9jb21tb25qcy9hdXJlbGlhLXRhc2stcXVldWUuanNcbi8vIG1vZHVsZSBpZCA9IDExXG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcblxudmFyIF90eXBlb2YgPSB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gXCJzeW1ib2xcIiA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sID8gXCJzeW1ib2xcIiA6IHR5cGVvZiBvYmo7IH07XG5cbmV4cG9ydHMuc3RhdHVzID0gc3RhdHVzO1xuZXhwb3J0cy5pc0RlZmluZWQgPSBpc0RlZmluZWQ7XG5leHBvcnRzLmNhbWVsQ2FzZSA9IGNhbWVsQ2FzZTtcbmV4cG9ydHMucGFyc2VRdWVyeVN0cmluZyA9IHBhcnNlUXVlcnlTdHJpbmc7XG5leHBvcnRzLmlzU3RyaW5nID0gaXNTdHJpbmc7XG5leHBvcnRzLmlzT2JqZWN0ID0gaXNPYmplY3Q7XG5leHBvcnRzLmlzRnVuY3Rpb24gPSBpc0Z1bmN0aW9uO1xuZXhwb3J0cy5qb2luVXJsID0gam9pblVybDtcbmV4cG9ydHMuaXNCbGFua09iamVjdCA9IGlzQmxhbmtPYmplY3Q7XG5leHBvcnRzLmlzQXJyYXlMaWtlID0gaXNBcnJheUxpa2U7XG5leHBvcnRzLmlzV2luZG93ID0gaXNXaW5kb3c7XG5leHBvcnRzLmV4dGVuZCA9IGV4dGVuZDtcbmV4cG9ydHMubWVyZ2UgPSBtZXJnZTtcbmV4cG9ydHMuZm9yRWFjaCA9IGZvckVhY2g7XG52YXIgc2xpY2UgPSBbXS5zbGljZTtcblxuZnVuY3Rpb24gc2V0SGFzaEtleShvYmosIGgpIHtcbiAgaWYgKGgpIHtcbiAgICBvYmouJCRoYXNoS2V5ID0gaDtcbiAgfSBlbHNlIHtcbiAgICBkZWxldGUgb2JqLiQkaGFzaEtleTtcbiAgfVxufVxuXG5mdW5jdGlvbiBiYXNlRXh0ZW5kKGRzdCwgb2JqcywgZGVlcCkge1xuICB2YXIgaCA9IGRzdC4kJGhhc2hLZXk7XG5cbiAgZm9yICh2YXIgaSA9IDAsIGlpID0gb2Jqcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgdmFyIG9iaiA9IG9ianNbaV07XG4gICAgaWYgKCFpc09iamVjdChvYmopICYmICFpc0Z1bmN0aW9uKG9iaikpIGNvbnRpbnVlO1xuICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqKTtcbiAgICBmb3IgKHZhciBqID0gMCwgamogPSBrZXlzLmxlbmd0aDsgaiA8IGpqOyBqKyspIHtcbiAgICAgIHZhciBrZXkgPSBrZXlzW2pdO1xuICAgICAgdmFyIHNyYyA9IG9ialtrZXldO1xuXG4gICAgICBpZiAoZGVlcCAmJiBpc09iamVjdChzcmMpKSB7XG4gICAgICAgIGlmICghaXNPYmplY3QoZHN0W2tleV0pKSBkc3Rba2V5XSA9IEFycmF5LmlzQXJyYXkoc3JjKSA/IFtdIDoge307XG4gICAgICAgIGJhc2VFeHRlbmQoZHN0W2tleV0sIFtzcmNdLCB0cnVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRzdFtrZXldID0gc3JjO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHNldEhhc2hLZXkoZHN0LCBoKTtcbiAgcmV0dXJuIGRzdDtcbn1cblxuZnVuY3Rpb24gc3RhdHVzKHJlc3BvbnNlKSB7XG4gIGlmIChyZXNwb25zZS5zdGF0dXMgPj0gMjAwICYmIHJlc3BvbnNlLnN0YXR1cyA8IDQwMCkge1xuICAgIHJldHVybiByZXNwb25zZS5qc29uKCkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9KTtcbiAgfVxuXG4gIHRocm93IHJlc3BvbnNlO1xufVxuXG5mdW5jdGlvbiBpc0RlZmluZWQodmFsdWUpIHtcbiAgcmV0dXJuIHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCc7XG59XG5cbmZ1bmN0aW9uIGNhbWVsQ2FzZShuYW1lKSB7XG4gIHJldHVybiBuYW1lLnJlcGxhY2UoLyhbXFw6XFwtXFxfXSsoLikpL2csIGZ1bmN0aW9uIChfLCBzZXBhcmF0b3IsIGxldHRlciwgb2Zmc2V0KSB7XG4gICAgcmV0dXJuIG9mZnNldCA/IGxldHRlci50b1VwcGVyQ2FzZSgpIDogbGV0dGVyO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gcGFyc2VRdWVyeVN0cmluZyhrZXlWYWx1ZSkge1xuICB2YXIga2V5ID0gdm9pZCAwO1xuICB2YXIgdmFsdWUgPSB2b2lkIDA7XG4gIHZhciBvYmogPSB7fTtcblxuICBmb3JFYWNoKChrZXlWYWx1ZSB8fCAnJykuc3BsaXQoJyYnKSwgZnVuY3Rpb24gKGt2KSB7XG4gICAgaWYgKGt2KSB7XG4gICAgICB2YWx1ZSA9IGt2LnNwbGl0KCc9Jyk7XG4gICAgICBrZXkgPSBkZWNvZGVVUklDb21wb25lbnQodmFsdWVbMF0pO1xuICAgICAgb2JqW2tleV0gPSBpc0RlZmluZWQodmFsdWVbMV0pID8gZGVjb2RlVVJJQ29tcG9uZW50KHZhbHVlWzFdKSA6IHRydWU7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gb2JqO1xufVxuXG5mdW5jdGlvbiBpc1N0cmluZyh2YWx1ZSkge1xuICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJztcbn1cblxuZnVuY3Rpb24gaXNPYmplY3QodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlICE9PSBudWxsICYmICh0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKHZhbHVlKSkgPT09ICdvYmplY3QnO1xufVxuXG5mdW5jdGlvbiBpc0Z1bmN0aW9uKHZhbHVlKSB7XG4gIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbic7XG59XG5cbmZ1bmN0aW9uIGpvaW5VcmwoYmFzZVVybCwgdXJsKSB7XG4gIGlmICgvXig/OlthLXpdKzopP1xcL1xcLy9pLnRlc3QodXJsKSkge1xuICAgIHJldHVybiB1cmw7XG4gIH1cblxuICB2YXIgam9pbmVkID0gW2Jhc2VVcmwsIHVybF0uam9pbignLycpO1xuICB2YXIgbm9ybWFsaXplID0gZnVuY3Rpb24gbm9ybWFsaXplKHN0cikge1xuICAgIHJldHVybiBzdHIucmVwbGFjZSgvW1xcL10rL2csICcvJykucmVwbGFjZSgvXFwvXFw/L2csICc/JykucmVwbGFjZSgvXFwvXFwjL2csICcjJykucmVwbGFjZSgvXFw6XFwvL2csICc6Ly8nKTtcbiAgfTtcblxuICByZXR1cm4gbm9ybWFsaXplKGpvaW5lZCk7XG59XG5cbmZ1bmN0aW9uIGlzQmxhbmtPYmplY3QodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlICE9PSBudWxsICYmICh0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKHZhbHVlKSkgPT09ICdvYmplY3QnICYmICFPYmplY3QuZ2V0UHJvdG90eXBlT2YodmFsdWUpO1xufVxuXG5mdW5jdGlvbiBpc0FycmF5TGlrZShvYmopIHtcbiAgaWYgKG9iaiA9PT0gbnVsbCB8fCBpc1dpbmRvdyhvYmopKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbmZ1bmN0aW9uIGlzV2luZG93KG9iaikge1xuICByZXR1cm4gb2JqICYmIG9iai53aW5kb3cgPT09IG9iajtcbn1cblxuZnVuY3Rpb24gZXh0ZW5kKGRzdCkge1xuICByZXR1cm4gYmFzZUV4dGVuZChkc3QsIHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSwgZmFsc2UpO1xufVxuXG5mdW5jdGlvbiBtZXJnZShkc3QpIHtcbiAgcmV0dXJuIGJhc2VFeHRlbmQoZHN0LCBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSksIHRydWUpO1xufVxuXG5mdW5jdGlvbiBmb3JFYWNoKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHtcbiAgdmFyIGtleSA9IHZvaWQgMDtcbiAgdmFyIGxlbmd0aCA9IHZvaWQgMDtcbiAgaWYgKG9iaikge1xuICAgIGlmIChpc0Z1bmN0aW9uKG9iaikpIHtcbiAgICAgIGZvciAoa2V5IGluIG9iaikge1xuICAgICAgICBpZiAoa2V5ICE9PSAncHJvdG90eXBlJyAmJiBrZXkgIT09ICdsZW5ndGgnICYmIGtleSAhPT0gJ25hbWUnICYmICghb2JqLmhhc093blByb3BlcnR5IHx8IG9iai5oYXNPd25Qcm9wZXJ0eShrZXkpKSkge1xuICAgICAgICAgIGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgb2JqW2tleV0sIGtleSwgb2JqKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopIHx8IGlzQXJyYXlMaWtlKG9iaikpIHtcbiAgICAgIHZhciBpc1ByaW1pdGl2ZSA9ICh0eXBlb2Ygb2JqID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihvYmopKSAhPT0gJ29iamVjdCc7XG4gICAgICBmb3IgKGtleSA9IDAsIGxlbmd0aCA9IG9iai5sZW5ndGg7IGtleSA8IGxlbmd0aDsga2V5KyspIHtcbiAgICAgICAgaWYgKGlzUHJpbWl0aXZlIHx8IGtleSBpbiBvYmopIHtcbiAgICAgICAgICBpdGVyYXRvci5jYWxsKGNvbnRleHQsIG9ialtrZXldLCBrZXksIG9iaik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKG9iai5mb3JFYWNoICYmIG9iai5mb3JFYWNoICE9PSBmb3JFYWNoKSB7XG4gICAgICBvYmouZm9yRWFjaChpdGVyYXRvciwgY29udGV4dCwgb2JqKTtcbiAgICB9IGVsc2UgaWYgKGlzQmxhbmtPYmplY3Qob2JqKSkge1xuICAgICAgZm9yIChrZXkgaW4gb2JqKSB7XG4gICAgICAgIGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgb2JqW2tleV0sIGtleSwgb2JqKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBvYmouaGFzT3duUHJvcGVydHkgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGZvciAoa2V5IGluIG9iaikge1xuICAgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICBpdGVyYXRvci5jYWxsKGNvbnRleHQsIG9ialtrZXldLCBrZXksIG9iaik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgZm9yIChrZXkgaW4gb2JqKSB7XG4gICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkge1xuICAgICAgICAgIGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgb2JqW2tleV0sIGtleSwgb2JqKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gb2JqO1xufVxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLWF1dGgvZGlzdC9jb21tb25qcy9hdXRoLXV0aWxpdGllcy5qc1xuLy8gbW9kdWxlIGlkID0gMTJcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy51cGRhdGVPdmVycmlkZUNvbnRleHRzID0gdXBkYXRlT3ZlcnJpZGVDb250ZXh0cztcbmV4cG9ydHMuY3JlYXRlRnVsbE92ZXJyaWRlQ29udGV4dCA9IGNyZWF0ZUZ1bGxPdmVycmlkZUNvbnRleHQ7XG5leHBvcnRzLnVwZGF0ZU92ZXJyaWRlQ29udGV4dCA9IHVwZGF0ZU92ZXJyaWRlQ29udGV4dDtcbmV4cG9ydHMuZ2V0SXRlbXNTb3VyY2VFeHByZXNzaW9uID0gZ2V0SXRlbXNTb3VyY2VFeHByZXNzaW9uO1xuZXhwb3J0cy51bndyYXBFeHByZXNzaW9uID0gdW53cmFwRXhwcmVzc2lvbjtcbmV4cG9ydHMuaXNPbmVUaW1lID0gaXNPbmVUaW1lO1xuZXhwb3J0cy51cGRhdGVPbmVUaW1lQmluZGluZyA9IHVwZGF0ZU9uZVRpbWVCaW5kaW5nO1xuZXhwb3J0cy5pbmRleE9mID0gaW5kZXhPZjtcblxudmFyIF9hdXJlbGlhQmluZGluZyA9IHJlcXVpcmUoJ2F1cmVsaWEtYmluZGluZycpO1xuXG52YXIgb25lVGltZSA9IF9hdXJlbGlhQmluZGluZy5iaW5kaW5nTW9kZS5vbmVUaW1lO1xuXG5mdW5jdGlvbiB1cGRhdGVPdmVycmlkZUNvbnRleHRzKHZpZXdzLCBzdGFydEluZGV4KSB7XG4gIHZhciBsZW5ndGggPSB2aWV3cy5sZW5ndGg7XG5cbiAgaWYgKHN0YXJ0SW5kZXggPiAwKSB7XG4gICAgc3RhcnRJbmRleCA9IHN0YXJ0SW5kZXggLSAxO1xuICB9XG5cbiAgZm9yICg7IHN0YXJ0SW5kZXggPCBsZW5ndGg7ICsrc3RhcnRJbmRleCkge1xuICAgIHVwZGF0ZU92ZXJyaWRlQ29udGV4dCh2aWV3c1tzdGFydEluZGV4XS5vdmVycmlkZUNvbnRleHQsIHN0YXJ0SW5kZXgsIGxlbmd0aCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gY3JlYXRlRnVsbE92ZXJyaWRlQ29udGV4dChyZXBlYXQsIGRhdGEsIGluZGV4LCBsZW5ndGgsIGtleSkge1xuICB2YXIgYmluZGluZ0NvbnRleHQgPSB7fTtcbiAgdmFyIG92ZXJyaWRlQ29udGV4dCA9ICgwLCBfYXVyZWxpYUJpbmRpbmcuY3JlYXRlT3ZlcnJpZGVDb250ZXh0KShiaW5kaW5nQ29udGV4dCwgcmVwZWF0LnNjb3BlLm92ZXJyaWRlQ29udGV4dCk7XG5cbiAgaWYgKHR5cGVvZiBrZXkgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgYmluZGluZ0NvbnRleHRbcmVwZWF0LmtleV0gPSBrZXk7XG4gICAgYmluZGluZ0NvbnRleHRbcmVwZWF0LnZhbHVlXSA9IGRhdGE7XG4gIH0gZWxzZSB7XG4gICAgYmluZGluZ0NvbnRleHRbcmVwZWF0LmxvY2FsXSA9IGRhdGE7XG4gIH1cbiAgdXBkYXRlT3ZlcnJpZGVDb250ZXh0KG92ZXJyaWRlQ29udGV4dCwgaW5kZXgsIGxlbmd0aCk7XG4gIHJldHVybiBvdmVycmlkZUNvbnRleHQ7XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZU92ZXJyaWRlQ29udGV4dChvdmVycmlkZUNvbnRleHQsIGluZGV4LCBsZW5ndGgpIHtcbiAgdmFyIGZpcnN0ID0gaW5kZXggPT09IDA7XG4gIHZhciBsYXN0ID0gaW5kZXggPT09IGxlbmd0aCAtIDE7XG4gIHZhciBldmVuID0gaW5kZXggJSAyID09PSAwO1xuXG4gIG92ZXJyaWRlQ29udGV4dC4kaW5kZXggPSBpbmRleDtcbiAgb3ZlcnJpZGVDb250ZXh0LiRmaXJzdCA9IGZpcnN0O1xuICBvdmVycmlkZUNvbnRleHQuJGxhc3QgPSBsYXN0O1xuICBvdmVycmlkZUNvbnRleHQuJG1pZGRsZSA9ICEoZmlyc3QgfHwgbGFzdCk7XG4gIG92ZXJyaWRlQ29udGV4dC4kb2RkID0gIWV2ZW47XG4gIG92ZXJyaWRlQ29udGV4dC4kZXZlbiA9IGV2ZW47XG59XG5cbmZ1bmN0aW9uIGdldEl0ZW1zU291cmNlRXhwcmVzc2lvbihpbnN0cnVjdGlvbiwgYXR0ck5hbWUpIHtcbiAgcmV0dXJuIGluc3RydWN0aW9uLmJlaGF2aW9ySW5zdHJ1Y3Rpb25zLmZpbHRlcihmdW5jdGlvbiAoYmkpIHtcbiAgICByZXR1cm4gYmkub3JpZ2luYWxBdHRyTmFtZSA9PT0gYXR0ck5hbWU7XG4gIH0pWzBdLmF0dHJpYnV0ZXMuaXRlbXMuc291cmNlRXhwcmVzc2lvbjtcbn1cblxuZnVuY3Rpb24gdW53cmFwRXhwcmVzc2lvbihleHByZXNzaW9uKSB7XG4gIHZhciB1bndyYXBwZWQgPSBmYWxzZTtcbiAgd2hpbGUgKGV4cHJlc3Npb24gaW5zdGFuY2VvZiBfYXVyZWxpYUJpbmRpbmcuQmluZGluZ0JlaGF2aW9yKSB7XG4gICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24uZXhwcmVzc2lvbjtcbiAgfVxuICB3aGlsZSAoZXhwcmVzc2lvbiBpbnN0YW5jZW9mIF9hdXJlbGlhQmluZGluZy5WYWx1ZUNvbnZlcnRlcikge1xuICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uLmV4cHJlc3Npb247XG4gICAgdW53cmFwcGVkID0gdHJ1ZTtcbiAgfVxuICByZXR1cm4gdW53cmFwcGVkID8gZXhwcmVzc2lvbiA6IG51bGw7XG59XG5cbmZ1bmN0aW9uIGlzT25lVGltZShleHByZXNzaW9uKSB7XG4gIHdoaWxlIChleHByZXNzaW9uIGluc3RhbmNlb2YgX2F1cmVsaWFCaW5kaW5nLkJpbmRpbmdCZWhhdmlvcikge1xuICAgIGlmIChleHByZXNzaW9uLm5hbWUgPT09ICdvbmVUaW1lJykge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uLmV4cHJlc3Npb247XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiB1cGRhdGVPbmVUaW1lQmluZGluZyhiaW5kaW5nKSB7XG4gIGlmIChiaW5kaW5nLmNhbGwgJiYgYmluZGluZy5tb2RlID09PSBvbmVUaW1lKSB7XG4gICAgYmluZGluZy5jYWxsKF9hdXJlbGlhQmluZGluZy5zb3VyY2VDb250ZXh0KTtcbiAgfSBlbHNlIGlmIChiaW5kaW5nLnVwZGF0ZU9uZVRpbWVCaW5kaW5ncykge1xuICAgIGJpbmRpbmcudXBkYXRlT25lVGltZUJpbmRpbmdzKCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gaW5kZXhPZihhcnJheSwgaXRlbSwgbWF0Y2hlciwgc3RhcnRJbmRleCkge1xuICBpZiAoIW1hdGNoZXIpIHtcbiAgICByZXR1cm4gYXJyYXkuaW5kZXhPZihpdGVtKTtcbiAgfVxuICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoO1xuICBmb3IgKHZhciBpbmRleCA9IHN0YXJ0SW5kZXggfHwgMDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KyspIHtcbiAgICBpZiAobWF0Y2hlcihhcnJheVtpbmRleF0sIGl0ZW0pKSB7XG4gICAgICByZXR1cm4gaW5kZXg7XG4gICAgfVxuICB9XG4gIHJldHVybiAtMTtcbn1cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L2NvbW1vbmpzL3JlcGVhdC11dGlsaXRpZXMuanNcbi8vIG1vZHVsZSBpZCA9IDEzXG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuTG9hZGVyID0gZXhwb3J0cy5UZW1wbGF0ZVJlZ2lzdHJ5RW50cnkgPSBleHBvcnRzLlRlbXBsYXRlRGVwZW5kZW5jeSA9IHVuZGVmaW5lZDtcblxudmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTtcblxudmFyIF9hdXJlbGlhUGF0aCA9IHJlcXVpcmUoJ2F1cmVsaWEtcGF0aCcpO1xuXG52YXIgX2F1cmVsaWFNZXRhZGF0YSA9IHJlcXVpcmUoJ2F1cmVsaWEtbWV0YWRhdGEnKTtcblxuXG5cbnZhciBUZW1wbGF0ZURlcGVuZGVuY3kgPSBleHBvcnRzLlRlbXBsYXRlRGVwZW5kZW5jeSA9IGZ1bmN0aW9uIFRlbXBsYXRlRGVwZW5kZW5jeShzcmMsIG5hbWUpIHtcbiAgXG5cbiAgdGhpcy5zcmMgPSBzcmM7XG4gIHRoaXMubmFtZSA9IG5hbWU7XG59O1xuXG52YXIgVGVtcGxhdGVSZWdpc3RyeUVudHJ5ID0gZXhwb3J0cy5UZW1wbGF0ZVJlZ2lzdHJ5RW50cnkgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFRlbXBsYXRlUmVnaXN0cnlFbnRyeShhZGRyZXNzKSB7XG4gICAgXG5cbiAgICB0aGlzLnRlbXBsYXRlSXNMb2FkZWQgPSBmYWxzZTtcbiAgICB0aGlzLmZhY3RvcnlJc1JlYWR5ID0gZmFsc2U7XG4gICAgdGhpcy5yZXNvdXJjZXMgPSBudWxsO1xuICAgIHRoaXMuZGVwZW5kZW5jaWVzID0gbnVsbDtcblxuICAgIHRoaXMuYWRkcmVzcyA9IGFkZHJlc3M7XG4gICAgdGhpcy5vblJlYWR5ID0gbnVsbDtcbiAgICB0aGlzLl90ZW1wbGF0ZSA9IG51bGw7XG4gICAgdGhpcy5fZmFjdG9yeSA9IG51bGw7XG4gIH1cblxuICBUZW1wbGF0ZVJlZ2lzdHJ5RW50cnkucHJvdG90eXBlLmFkZERlcGVuZGVuY3kgPSBmdW5jdGlvbiBhZGREZXBlbmRlbmN5KHNyYywgbmFtZSkge1xuICAgIHZhciBmaW5hbFNyYyA9IHR5cGVvZiBzcmMgPT09ICdzdHJpbmcnID8gKDAsIF9hdXJlbGlhUGF0aC5yZWxhdGl2ZVRvRmlsZSkoc3JjLCB0aGlzLmFkZHJlc3MpIDogX2F1cmVsaWFNZXRhZGF0YS5PcmlnaW4uZ2V0KHNyYykubW9kdWxlSWQ7XG5cbiAgICB0aGlzLmRlcGVuZGVuY2llcy5wdXNoKG5ldyBUZW1wbGF0ZURlcGVuZGVuY3koZmluYWxTcmMsIG5hbWUpKTtcbiAgfTtcblxuICBfY3JlYXRlQ2xhc3MoVGVtcGxhdGVSZWdpc3RyeUVudHJ5LCBbe1xuICAgIGtleTogJ3RlbXBsYXRlJyxcbiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgIHJldHVybiB0aGlzLl90ZW1wbGF0ZTtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbHVlKSB7XG4gICAgICB2YXIgYWRkcmVzcyA9IHRoaXMuYWRkcmVzcztcbiAgICAgIHZhciByZXF1aXJlcyA9IHZvaWQgMDtcbiAgICAgIHZhciBjdXJyZW50ID0gdm9pZCAwO1xuICAgICAgdmFyIHNyYyA9IHZvaWQgMDtcbiAgICAgIHZhciBkZXBlbmRlbmNpZXMgPSB2b2lkIDA7XG5cbiAgICAgIHRoaXMuX3RlbXBsYXRlID0gdmFsdWU7XG4gICAgICB0aGlzLnRlbXBsYXRlSXNMb2FkZWQgPSB0cnVlO1xuXG4gICAgICByZXF1aXJlcyA9IHZhbHVlLmNvbnRlbnQucXVlcnlTZWxlY3RvckFsbCgncmVxdWlyZScpO1xuICAgICAgZGVwZW5kZW5jaWVzID0gdGhpcy5kZXBlbmRlbmNpZXMgPSBuZXcgQXJyYXkocmVxdWlyZXMubGVuZ3RoKTtcblxuICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gcmVxdWlyZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgICBjdXJyZW50ID0gcmVxdWlyZXNbaV07XG4gICAgICAgIHNyYyA9IGN1cnJlbnQuZ2V0QXR0cmlidXRlKCdmcm9tJyk7XG5cbiAgICAgICAgaWYgKCFzcmMpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJzxyZXF1aXJlPiBlbGVtZW50IGluICcgKyBhZGRyZXNzICsgJyBoYXMgbm8gXCJmcm9tXCIgYXR0cmlidXRlLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgZGVwZW5kZW5jaWVzW2ldID0gbmV3IFRlbXBsYXRlRGVwZW5kZW5jeSgoMCwgX2F1cmVsaWFQYXRoLnJlbGF0aXZlVG9GaWxlKShzcmMsIGFkZHJlc3MpLCBjdXJyZW50LmdldEF0dHJpYnV0ZSgnYXMnKSk7XG5cbiAgICAgICAgaWYgKGN1cnJlbnQucGFyZW50Tm9kZSkge1xuICAgICAgICAgIGN1cnJlbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChjdXJyZW50KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ2ZhY3RvcnknLFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2ZhY3Rvcnk7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uIHNldCh2YWx1ZSkge1xuICAgICAgdGhpcy5fZmFjdG9yeSA9IHZhbHVlO1xuICAgICAgdGhpcy5mYWN0b3J5SXNSZWFkeSA9IHRydWU7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIFRlbXBsYXRlUmVnaXN0cnlFbnRyeTtcbn0oKTtcblxudmFyIExvYWRlciA9IGV4cG9ydHMuTG9hZGVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBMb2FkZXIoKSB7XG4gICAgXG5cbiAgICB0aGlzLnRlbXBsYXRlUmVnaXN0cnkgPSB7fTtcbiAgfVxuXG4gIExvYWRlci5wcm90b3R5cGUubWFwID0gZnVuY3Rpb24gbWFwKGlkLCBzb3VyY2UpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0xvYWRlcnMgbXVzdCBpbXBsZW1lbnQgbWFwKGlkLCBzb3VyY2UpLicpO1xuICB9O1xuXG4gIExvYWRlci5wcm90b3R5cGUubm9ybWFsaXplU3luYyA9IGZ1bmN0aW9uIG5vcm1hbGl6ZVN5bmMobW9kdWxlSWQsIHJlbGF0aXZlVG8pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0xvYWRlcnMgbXVzdCBpbXBsZW1lbnQgbm9ybWFsaXplU3luYyhtb2R1bGVJZCwgcmVsYXRpdmVUbykuJyk7XG4gIH07XG5cbiAgTG9hZGVyLnByb3RvdHlwZS5ub3JtYWxpemUgPSBmdW5jdGlvbiBub3JtYWxpemUobW9kdWxlSWQsIHJlbGF0aXZlVG8pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0xvYWRlcnMgbXVzdCBpbXBsZW1lbnQgbm9ybWFsaXplKG1vZHVsZUlkOiBzdHJpbmcsIHJlbGF0aXZlVG86IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPi4nKTtcbiAgfTtcblxuICBMb2FkZXIucHJvdG90eXBlLmxvYWRNb2R1bGUgPSBmdW5jdGlvbiBsb2FkTW9kdWxlKGlkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdMb2FkZXJzIG11c3QgaW1wbGVtZW50IGxvYWRNb2R1bGUoaWQpLicpO1xuICB9O1xuXG4gIExvYWRlci5wcm90b3R5cGUubG9hZEFsbE1vZHVsZXMgPSBmdW5jdGlvbiBsb2FkQWxsTW9kdWxlcyhpZHMpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0xvYWRlciBtdXN0IGltcGxlbWVudCBsb2FkQWxsTW9kdWxlcyhpZHMpLicpO1xuICB9O1xuXG4gIExvYWRlci5wcm90b3R5cGUubG9hZFRlbXBsYXRlID0gZnVuY3Rpb24gbG9hZFRlbXBsYXRlKHVybCkge1xuICAgIHRocm93IG5ldyBFcnJvcignTG9hZGVyIG11c3QgaW1wbGVtZW50IGxvYWRUZW1wbGF0ZSh1cmwpLicpO1xuICB9O1xuXG4gIExvYWRlci5wcm90b3R5cGUubG9hZFRleHQgPSBmdW5jdGlvbiBsb2FkVGV4dCh1cmwpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0xvYWRlciBtdXN0IGltcGxlbWVudCBsb2FkVGV4dCh1cmwpLicpO1xuICB9O1xuXG4gIExvYWRlci5wcm90b3R5cGUuYXBwbHlQbHVnaW5Ub1VybCA9IGZ1bmN0aW9uIGFwcGx5UGx1Z2luVG9VcmwodXJsLCBwbHVnaW5OYW1lKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdMb2FkZXIgbXVzdCBpbXBsZW1lbnQgYXBwbHlQbHVnaW5Ub1VybCh1cmwsIHBsdWdpbk5hbWUpLicpO1xuICB9O1xuXG4gIExvYWRlci5wcm90b3R5cGUuYWRkUGx1Z2luID0gZnVuY3Rpb24gYWRkUGx1Z2luKHBsdWdpbk5hbWUsIGltcGxlbWVudGF0aW9uKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdMb2FkZXIgbXVzdCBpbXBsZW1lbnQgYWRkUGx1Z2luKHBsdWdpbk5hbWUsIGltcGxlbWVudGF0aW9uKS4nKTtcbiAgfTtcblxuICBMb2FkZXIucHJvdG90eXBlLmdldE9yQ3JlYXRlVGVtcGxhdGVSZWdpc3RyeUVudHJ5ID0gZnVuY3Rpb24gZ2V0T3JDcmVhdGVUZW1wbGF0ZVJlZ2lzdHJ5RW50cnkoYWRkcmVzcykge1xuICAgIHJldHVybiB0aGlzLnRlbXBsYXRlUmVnaXN0cnlbYWRkcmVzc10gfHwgKHRoaXMudGVtcGxhdGVSZWdpc3RyeVthZGRyZXNzXSA9IG5ldyBUZW1wbGF0ZVJlZ2lzdHJ5RW50cnkoYWRkcmVzcykpO1xuICB9O1xuXG4gIHJldHVybiBMb2FkZXI7XG59KCk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtbG9hZGVyL2Rpc3QvY29tbW9uanMvYXVyZWxpYS1sb2FkZXIuanNcbi8vIG1vZHVsZSBpZCA9IDE0XG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcblxudmFyIF90eXBlb2YgPSB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gXCJzeW1ib2xcIiA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sID8gXCJzeW1ib2xcIiA6IHR5cGVvZiBvYmo7IH07XG5cbmV4cG9ydHMuanNvbiA9IGpzb247XG5cblxuXG5mdW5jdGlvbiBqc29uKGJvZHkpIHtcbiAgcmV0dXJuIG5ldyBCbG9iKFtKU09OLnN0cmluZ2lmeShib2R5KV0sIHsgdHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nIH0pO1xufVxuXG52YXIgSHR0cENsaWVudENvbmZpZ3VyYXRpb24gPSBleHBvcnRzLkh0dHBDbGllbnRDb25maWd1cmF0aW9uID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBIdHRwQ2xpZW50Q29uZmlndXJhdGlvbigpIHtcbiAgICBcblxuICAgIHRoaXMuYmFzZVVybCA9ICcnO1xuICAgIHRoaXMuZGVmYXVsdHMgPSB7fTtcbiAgICB0aGlzLmludGVyY2VwdG9ycyA9IFtdO1xuICB9XG5cbiAgSHR0cENsaWVudENvbmZpZ3VyYXRpb24ucHJvdG90eXBlLndpdGhCYXNlVXJsID0gZnVuY3Rpb24gd2l0aEJhc2VVcmwoYmFzZVVybCkge1xuICAgIHRoaXMuYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgSHR0cENsaWVudENvbmZpZ3VyYXRpb24ucHJvdG90eXBlLndpdGhEZWZhdWx0cyA9IGZ1bmN0aW9uIHdpdGhEZWZhdWx0cyhkZWZhdWx0cykge1xuICAgIHRoaXMuZGVmYXVsdHMgPSBkZWZhdWx0cztcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBIdHRwQ2xpZW50Q29uZmlndXJhdGlvbi5wcm90b3R5cGUud2l0aEludGVyY2VwdG9yID0gZnVuY3Rpb24gd2l0aEludGVyY2VwdG9yKGludGVyY2VwdG9yKSB7XG4gICAgdGhpcy5pbnRlcmNlcHRvcnMucHVzaChpbnRlcmNlcHRvcik7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgSHR0cENsaWVudENvbmZpZ3VyYXRpb24ucHJvdG90eXBlLnVzZVN0YW5kYXJkQ29uZmlndXJhdGlvbiA9IGZ1bmN0aW9uIHVzZVN0YW5kYXJkQ29uZmlndXJhdGlvbigpIHtcbiAgICB2YXIgc3RhbmRhcmRDb25maWcgPSB7IGNyZWRlbnRpYWxzOiAnc2FtZS1vcmlnaW4nIH07XG4gICAgT2JqZWN0LmFzc2lnbih0aGlzLmRlZmF1bHRzLCBzdGFuZGFyZENvbmZpZywgdGhpcy5kZWZhdWx0cyk7XG4gICAgcmV0dXJuIHRoaXMucmVqZWN0RXJyb3JSZXNwb25zZXMoKTtcbiAgfTtcblxuICBIdHRwQ2xpZW50Q29uZmlndXJhdGlvbi5wcm90b3R5cGUucmVqZWN0RXJyb3JSZXNwb25zZXMgPSBmdW5jdGlvbiByZWplY3RFcnJvclJlc3BvbnNlcygpIHtcbiAgICByZXR1cm4gdGhpcy53aXRoSW50ZXJjZXB0b3IoeyByZXNwb25zZTogcmVqZWN0T25FcnJvciB9KTtcbiAgfTtcblxuICByZXR1cm4gSHR0cENsaWVudENvbmZpZ3VyYXRpb247XG59KCk7XG5cbmZ1bmN0aW9uIHJlamVjdE9uRXJyb3IocmVzcG9uc2UpIHtcbiAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgIHRocm93IHJlc3BvbnNlO1xuICB9XG5cbiAgcmV0dXJuIHJlc3BvbnNlO1xufVxuXG52YXIgSHR0cENsaWVudCA9IGV4cG9ydHMuSHR0cENsaWVudCA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gSHR0cENsaWVudCgpIHtcbiAgICBcblxuICAgIHRoaXMuYWN0aXZlUmVxdWVzdENvdW50ID0gMDtcbiAgICB0aGlzLmlzUmVxdWVzdGluZyA9IGZhbHNlO1xuICAgIHRoaXMuaXNDb25maWd1cmVkID0gZmFsc2U7XG4gICAgdGhpcy5iYXNlVXJsID0gJyc7XG4gICAgdGhpcy5kZWZhdWx0cyA9IG51bGw7XG4gICAgdGhpcy5pbnRlcmNlcHRvcnMgPSBbXTtcblxuICAgIGlmICh0eXBlb2YgZmV0Y2ggPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0h0dHBDbGllbnQgcmVxdWlyZXMgYSBGZXRjaCBBUEkgaW1wbGVtZW50YXRpb24sIGJ1dCB0aGUgY3VycmVudCBlbnZpcm9ubWVudCBkb2VzblxcJ3Qgc3VwcG9ydCBpdC4gWW91IG1heSBuZWVkIHRvIGxvYWQgYSBwb2x5ZmlsbCBzdWNoIGFzIGh0dHBzOi8vZ2l0aHViLmNvbS9naXRodWIvZmV0Y2guJyk7XG4gICAgfVxuICB9XG5cbiAgSHR0cENsaWVudC5wcm90b3R5cGUuY29uZmlndXJlID0gZnVuY3Rpb24gY29uZmlndXJlKGNvbmZpZykge1xuICAgIHZhciBfaW50ZXJjZXB0b3JzO1xuXG4gICAgdmFyIG5vcm1hbGl6ZWRDb25maWcgPSB2b2lkIDA7XG5cbiAgICBpZiAoKHR5cGVvZiBjb25maWcgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGNvbmZpZykpID09PSAnb2JqZWN0Jykge1xuICAgICAgbm9ybWFsaXplZENvbmZpZyA9IHsgZGVmYXVsdHM6IGNvbmZpZyB9O1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgbm9ybWFsaXplZENvbmZpZyA9IG5ldyBIdHRwQ2xpZW50Q29uZmlndXJhdGlvbigpO1xuICAgICAgdmFyIGMgPSBjb25maWcobm9ybWFsaXplZENvbmZpZyk7XG4gICAgICBpZiAoSHR0cENsaWVudENvbmZpZ3VyYXRpb24ucHJvdG90eXBlLmlzUHJvdG90eXBlT2YoYykpIHtcbiAgICAgICAgbm9ybWFsaXplZENvbmZpZyA9IGM7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZCBjb25maWcnKTtcbiAgICB9XG5cbiAgICB2YXIgZGVmYXVsdHMgPSBub3JtYWxpemVkQ29uZmlnLmRlZmF1bHRzO1xuICAgIGlmIChkZWZhdWx0cyAmJiBIZWFkZXJzLnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKGRlZmF1bHRzLmhlYWRlcnMpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RlZmF1bHQgaGVhZGVycyBtdXN0IGJlIGEgcGxhaW4gb2JqZWN0LicpO1xuICAgIH1cblxuICAgIHRoaXMuYmFzZVVybCA9IG5vcm1hbGl6ZWRDb25maWcuYmFzZVVybDtcbiAgICB0aGlzLmRlZmF1bHRzID0gZGVmYXVsdHM7XG4gICAgKF9pbnRlcmNlcHRvcnMgPSB0aGlzLmludGVyY2VwdG9ycykucHVzaC5hcHBseShfaW50ZXJjZXB0b3JzLCBub3JtYWxpemVkQ29uZmlnLmludGVyY2VwdG9ycyB8fCBbXSk7XG4gICAgdGhpcy5pc0NvbmZpZ3VyZWQgPSB0cnVlO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgSHR0cENsaWVudC5wcm90b3R5cGUuZmV0Y2ggPSBmdW5jdGlvbiAoX2ZldGNoKSB7XG4gICAgZnVuY3Rpb24gZmV0Y2goX3gsIF94Mikge1xuICAgICAgcmV0dXJuIF9mZXRjaC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH1cblxuICAgIGZldGNoLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIF9mZXRjaC50b1N0cmluZygpO1xuICAgIH07XG5cbiAgICByZXR1cm4gZmV0Y2g7XG4gIH0oZnVuY3Rpb24gKGlucHV0LCBpbml0KSB7XG4gICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgIHRyYWNrUmVxdWVzdFN0YXJ0LmNhbGwodGhpcyk7XG5cbiAgICB2YXIgcmVxdWVzdCA9IFByb21pc2UucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIGJ1aWxkUmVxdWVzdC5jYWxsKF90aGlzLCBpbnB1dCwgaW5pdCwgX3RoaXMuZGVmYXVsdHMpO1xuICAgIH0pO1xuICAgIHZhciBwcm9taXNlID0gcHJvY2Vzc1JlcXVlc3QocmVxdWVzdCwgdGhpcy5pbnRlcmNlcHRvcnMpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgdmFyIHJlc3BvbnNlID0gbnVsbDtcblxuICAgICAgaWYgKFJlc3BvbnNlLnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKHJlc3VsdCkpIHtcbiAgICAgICAgcmVzcG9uc2UgPSByZXN1bHQ7XG4gICAgICB9IGVsc2UgaWYgKFJlcXVlc3QucHJvdG90eXBlLmlzUHJvdG90eXBlT2YocmVzdWx0KSkge1xuICAgICAgICByZXF1ZXN0ID0gUHJvbWlzZS5yZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgIHJlc3BvbnNlID0gZmV0Y2gocmVzdWx0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQW4gaW52YWxpZCByZXN1bHQgd2FzIHJldHVybmVkIGJ5IHRoZSBpbnRlcmNlcHRvciBjaGFpbi4gRXhwZWN0ZWQgYSBSZXF1ZXN0IG9yIFJlc3BvbnNlIGluc3RhbmNlLCBidXQgZ290IFsnICsgcmVzdWx0ICsgJ10nKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlcXVlc3QudGhlbihmdW5jdGlvbiAoX3JlcXVlc3QpIHtcbiAgICAgICAgcmV0dXJuIHByb2Nlc3NSZXNwb25zZShyZXNwb25zZSwgX3RoaXMuaW50ZXJjZXB0b3JzLCBfcmVxdWVzdCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHJldHVybiB0cmFja1JlcXVlc3RFbmRXaXRoLmNhbGwodGhpcywgcHJvbWlzZSk7XG4gIH0pO1xuXG4gIHJldHVybiBIdHRwQ2xpZW50O1xufSgpO1xuXG52YXIgYWJzb2x1dGVVcmxSZWdleHAgPSAvXihbYS16XVthLXowLTkrXFwtLl0qOik/XFwvXFwvL2k7XG5cbmZ1bmN0aW9uIHRyYWNrUmVxdWVzdFN0YXJ0KCkge1xuICB0aGlzLmlzUmVxdWVzdGluZyA9ICEhICsrdGhpcy5hY3RpdmVSZXF1ZXN0Q291bnQ7XG59XG5cbmZ1bmN0aW9uIHRyYWNrUmVxdWVzdEVuZCgpIHtcbiAgdGhpcy5pc1JlcXVlc3RpbmcgPSAhISAtLXRoaXMuYWN0aXZlUmVxdWVzdENvdW50O1xufVxuXG5mdW5jdGlvbiB0cmFja1JlcXVlc3RFbmRXaXRoKHByb21pc2UpIHtcbiAgdmFyIGhhbmRsZSA9IHRyYWNrUmVxdWVzdEVuZC5iaW5kKHRoaXMpO1xuICBwcm9taXNlLnRoZW4oaGFuZGxlLCBoYW5kbGUpO1xuICByZXR1cm4gcHJvbWlzZTtcbn1cblxuZnVuY3Rpb24gcGFyc2VIZWFkZXJWYWx1ZXMoaGVhZGVycykge1xuICB2YXIgcGFyc2VkSGVhZGVycyA9IHt9O1xuICBmb3IgKHZhciBuYW1lIGluIGhlYWRlcnMgfHwge30pIHtcbiAgICBpZiAoaGVhZGVycy5oYXNPd25Qcm9wZXJ0eShuYW1lKSkge1xuICAgICAgcGFyc2VkSGVhZGVyc1tuYW1lXSA9IHR5cGVvZiBoZWFkZXJzW25hbWVdID09PSAnZnVuY3Rpb24nID8gaGVhZGVyc1tuYW1lXSgpIDogaGVhZGVyc1tuYW1lXTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHBhcnNlZEhlYWRlcnM7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkUmVxdWVzdChpbnB1dCwgaW5pdCkge1xuICB2YXIgZGVmYXVsdHMgPSB0aGlzLmRlZmF1bHRzIHx8IHt9O1xuICB2YXIgcmVxdWVzdCA9IHZvaWQgMDtcbiAgdmFyIGJvZHkgPSB2b2lkIDA7XG4gIHZhciByZXF1ZXN0Q29udGVudFR5cGUgPSB2b2lkIDA7XG5cbiAgdmFyIHBhcnNlZERlZmF1bHRIZWFkZXJzID0gcGFyc2VIZWFkZXJWYWx1ZXMoZGVmYXVsdHMuaGVhZGVycyk7XG4gIGlmIChSZXF1ZXN0LnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKGlucHV0KSkge1xuICAgIHJlcXVlc3QgPSBpbnB1dDtcbiAgICByZXF1ZXN0Q29udGVudFR5cGUgPSBuZXcgSGVhZGVycyhyZXF1ZXN0LmhlYWRlcnMpLmdldCgnQ29udGVudC1UeXBlJyk7XG4gIH0gZWxzZSB7XG4gICAgaW5pdCB8fCAoaW5pdCA9IHt9KTtcbiAgICBib2R5ID0gaW5pdC5ib2R5O1xuICAgIHZhciBib2R5T2JqID0gYm9keSA/IHsgYm9keTogYm9keSB9IDogbnVsbDtcbiAgICB2YXIgcmVxdWVzdEluaXQgPSBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0cywgeyBoZWFkZXJzOiB7fSB9LCBpbml0LCBib2R5T2JqKTtcbiAgICByZXF1ZXN0Q29udGVudFR5cGUgPSBuZXcgSGVhZGVycyhyZXF1ZXN0SW5pdC5oZWFkZXJzKS5nZXQoJ0NvbnRlbnQtVHlwZScpO1xuICAgIHJlcXVlc3QgPSBuZXcgUmVxdWVzdChnZXRSZXF1ZXN0VXJsKHRoaXMuYmFzZVVybCwgaW5wdXQpLCByZXF1ZXN0SW5pdCk7XG4gIH1cbiAgaWYgKCFyZXF1ZXN0Q29udGVudFR5cGUgJiYgbmV3IEhlYWRlcnMocGFyc2VkRGVmYXVsdEhlYWRlcnMpLmhhcygnY29udGVudC10eXBlJykpIHtcbiAgICByZXF1ZXN0LmhlYWRlcnMuc2V0KCdDb250ZW50LVR5cGUnLCBuZXcgSGVhZGVycyhwYXJzZWREZWZhdWx0SGVhZGVycykuZ2V0KCdjb250ZW50LXR5cGUnKSk7XG4gIH1cbiAgc2V0RGVmYXVsdEhlYWRlcnMocmVxdWVzdC5oZWFkZXJzLCBwYXJzZWREZWZhdWx0SGVhZGVycyk7XG4gIGlmIChib2R5ICYmIEJsb2IucHJvdG90eXBlLmlzUHJvdG90eXBlT2YoYm9keSkgJiYgYm9keS50eXBlKSB7XG4gICAgcmVxdWVzdC5oZWFkZXJzLnNldCgnQ29udGVudC1UeXBlJywgYm9keS50eXBlKTtcbiAgfVxuICByZXR1cm4gcmVxdWVzdDtcbn1cblxuZnVuY3Rpb24gZ2V0UmVxdWVzdFVybChiYXNlVXJsLCB1cmwpIHtcbiAgaWYgKGFic29sdXRlVXJsUmVnZXhwLnRlc3QodXJsKSkge1xuICAgIHJldHVybiB1cmw7XG4gIH1cblxuICByZXR1cm4gKGJhc2VVcmwgfHwgJycpICsgdXJsO1xufVxuXG5mdW5jdGlvbiBzZXREZWZhdWx0SGVhZGVycyhoZWFkZXJzLCBkZWZhdWx0SGVhZGVycykge1xuICBmb3IgKHZhciBuYW1lIGluIGRlZmF1bHRIZWFkZXJzIHx8IHt9KSB7XG4gICAgaWYgKGRlZmF1bHRIZWFkZXJzLmhhc093blByb3BlcnR5KG5hbWUpICYmICFoZWFkZXJzLmhhcyhuYW1lKSkge1xuICAgICAgaGVhZGVycy5zZXQobmFtZSwgZGVmYXVsdEhlYWRlcnNbbmFtZV0pO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBwcm9jZXNzUmVxdWVzdChyZXF1ZXN0LCBpbnRlcmNlcHRvcnMpIHtcbiAgcmV0dXJuIGFwcGx5SW50ZXJjZXB0b3JzKHJlcXVlc3QsIGludGVyY2VwdG9ycywgJ3JlcXVlc3QnLCAncmVxdWVzdEVycm9yJyk7XG59XG5cbmZ1bmN0aW9uIHByb2Nlc3NSZXNwb25zZShyZXNwb25zZSwgaW50ZXJjZXB0b3JzLCByZXF1ZXN0KSB7XG4gIHJldHVybiBhcHBseUludGVyY2VwdG9ycyhyZXNwb25zZSwgaW50ZXJjZXB0b3JzLCAncmVzcG9uc2UnLCAncmVzcG9uc2VFcnJvcicsIHJlcXVlc3QpO1xufVxuXG5mdW5jdGlvbiBhcHBseUludGVyY2VwdG9ycyhpbnB1dCwgaW50ZXJjZXB0b3JzLCBzdWNjZXNzTmFtZSwgZXJyb3JOYW1lKSB7XG4gIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBpbnRlcmNlcHRvckFyZ3MgPSBBcnJheShfbGVuID4gNCA/IF9sZW4gLSA0IDogMCksIF9rZXkgPSA0OyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7XG4gICAgaW50ZXJjZXB0b3JBcmdzW19rZXkgLSA0XSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgfVxuXG4gIHJldHVybiAoaW50ZXJjZXB0b3JzIHx8IFtdKS5yZWR1Y2UoZnVuY3Rpb24gKGNoYWluLCBpbnRlcmNlcHRvcikge1xuICAgIHZhciBzdWNjZXNzSGFuZGxlciA9IGludGVyY2VwdG9yW3N1Y2Nlc3NOYW1lXTtcbiAgICB2YXIgZXJyb3JIYW5kbGVyID0gaW50ZXJjZXB0b3JbZXJyb3JOYW1lXTtcblxuICAgIHJldHVybiBjaGFpbi50aGVuKHN1Y2Nlc3NIYW5kbGVyICYmIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgcmV0dXJuIHN1Y2Nlc3NIYW5kbGVyLmNhbGwuYXBwbHkoc3VjY2Vzc0hhbmRsZXIsIFtpbnRlcmNlcHRvciwgdmFsdWVdLmNvbmNhdChpbnRlcmNlcHRvckFyZ3MpKTtcbiAgICB9IHx8IGlkZW50aXR5LCBlcnJvckhhbmRsZXIgJiYgZnVuY3Rpb24gKHJlYXNvbikge1xuICAgICAgcmV0dXJuIGVycm9ySGFuZGxlci5jYWxsLmFwcGx5KGVycm9ySGFuZGxlciwgW2ludGVyY2VwdG9yLCByZWFzb25dLmNvbmNhdChpbnRlcmNlcHRvckFyZ3MpKTtcbiAgICB9IHx8IHRocm93ZXIpO1xuICB9LCBQcm9taXNlLnJlc29sdmUoaW5wdXQpKTtcbn1cblxuZnVuY3Rpb24gaWRlbnRpdHkoeCkge1xuICByZXR1cm4geDtcbn1cblxuZnVuY3Rpb24gdGhyb3dlcih4KSB7XG4gIHRocm93IHg7XG59XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtZmV0Y2gtY2xpZW50L2Rpc3QvY29tbW9uanMvYXVyZWxpYS1mZXRjaC1jbGllbnQuanNcbi8vIG1vZHVsZSBpZCA9IDE1XG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuRmV0Y2hDb25maWcgPSBleHBvcnRzLkJhc2VDb25maWcgPSBleHBvcnRzLkF1dGhvcml6ZVN0ZXAgPSBleHBvcnRzLkF1dGhTZXJ2aWNlID0gZXhwb3J0cy5BdXRoRmlsdGVyVmFsdWVDb252ZXJ0ZXIgPSB1bmRlZmluZWQ7XG5leHBvcnRzLmNvbmZpZ3VyZSA9IGNvbmZpZ3VyZTtcblxudmFyIF9hdXRoU2VydmljZSA9IHJlcXVpcmUoJy4vYXV0aC1zZXJ2aWNlJyk7XG5cbnZhciBfYXV0aG9yaXplU3RlcCA9IHJlcXVpcmUoJy4vYXV0aG9yaXplLXN0ZXAnKTtcblxudmFyIF9hdXRoRmV0Y2hDb25maWcgPSByZXF1aXJlKCcuL2F1dGgtZmV0Y2gtY29uZmlnJyk7XG5cbnZhciBfYmFzZUNvbmZpZyA9IHJlcXVpcmUoJy4vYmFzZS1jb25maWcnKTtcblxudmFyIF9hdXRoRmlsdGVyID0gcmVxdWlyZSgnLi9hdXRoLWZpbHRlcicpO1xuXG5mdW5jdGlvbiBjb25maWd1cmUoYXVyZWxpYSwgY29uZmlnQ2FsbGJhY2spIHtcbiAgYXVyZWxpYS5nbG9iYWxSZXNvdXJjZXMoJy4vYXV0aC1maWx0ZXInKTtcblxuICB2YXIgYmFzZUNvbmZpZyA9IGF1cmVsaWEuY29udGFpbmVyLmdldChfYmFzZUNvbmZpZy5CYXNlQ29uZmlnKTtcbiAgaWYgKGNvbmZpZ0NhbGxiYWNrICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIGNvbmZpZ0NhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgY29uZmlnQ2FsbGJhY2soYmFzZUNvbmZpZyk7XG4gIH1cbn1cblxuZXhwb3J0cy5BdXRoRmlsdGVyVmFsdWVDb252ZXJ0ZXIgPSBfYXV0aEZpbHRlci5BdXRoRmlsdGVyVmFsdWVDb252ZXJ0ZXI7XG5leHBvcnRzLkF1dGhTZXJ2aWNlID0gX2F1dGhTZXJ2aWNlLkF1dGhTZXJ2aWNlO1xuZXhwb3J0cy5BdXRob3JpemVTdGVwID0gX2F1dGhvcml6ZVN0ZXAuQXV0aG9yaXplU3RlcDtcbmV4cG9ydHMuQmFzZUNvbmZpZyA9IF9iYXNlQ29uZmlnLkJhc2VDb25maWc7XG5leHBvcnRzLkZldGNoQ29uZmlnID0gX2F1dGhGZXRjaENvbmZpZy5GZXRjaENvbmZpZztcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS1hdXRoL2Rpc3QvY29tbW9uanMvYXVyZWxpYS1hdXRoLmpzXG4vLyBtb2R1bGUgaWQgPSAxNlxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLkV2ZW50QWdncmVnYXRvciA9IHVuZGVmaW5lZDtcbmV4cG9ydHMuaW5jbHVkZUV2ZW50c0luID0gaW5jbHVkZUV2ZW50c0luO1xuZXhwb3J0cy5jb25maWd1cmUgPSBjb25maWd1cmU7XG5cbnZhciBfYXVyZWxpYUxvZ2dpbmcgPSByZXF1aXJlKCdhdXJlbGlhLWxvZ2dpbmcnKTtcblxudmFyIExvZ01hbmFnZXIgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChfYXVyZWxpYUxvZ2dpbmcpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgeyByZXR1cm4gb2JqOyB9IGVsc2UgeyB2YXIgbmV3T2JqID0ge307IGlmIChvYmogIT0gbnVsbCkgeyBmb3IgKHZhciBrZXkgaW4gb2JqKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSBuZXdPYmpba2V5XSA9IG9ialtrZXldOyB9IH0gbmV3T2JqLmRlZmF1bHQgPSBvYmo7IHJldHVybiBuZXdPYmo7IH0gfVxuXG5cblxudmFyIGxvZ2dlciA9IExvZ01hbmFnZXIuZ2V0TG9nZ2VyKCdldmVudC1hZ2dyZWdhdG9yJyk7XG5cbnZhciBIYW5kbGVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBIYW5kbGVyKG1lc3NhZ2VUeXBlLCBjYWxsYmFjaykge1xuICAgIFxuXG4gICAgdGhpcy5tZXNzYWdlVHlwZSA9IG1lc3NhZ2VUeXBlO1xuICAgIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgfVxuXG4gIEhhbmRsZXIucHJvdG90eXBlLmhhbmRsZSA9IGZ1bmN0aW9uIGhhbmRsZShtZXNzYWdlKSB7XG4gICAgaWYgKG1lc3NhZ2UgaW5zdGFuY2VvZiB0aGlzLm1lc3NhZ2VUeXBlKSB7XG4gICAgICB0aGlzLmNhbGxiYWNrLmNhbGwobnVsbCwgbWVzc2FnZSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBIYW5kbGVyO1xufSgpO1xuXG52YXIgRXZlbnRBZ2dyZWdhdG9yID0gZXhwb3J0cy5FdmVudEFnZ3JlZ2F0b3IgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEV2ZW50QWdncmVnYXRvcigpIHtcbiAgICBcblxuICAgIHRoaXMuZXZlbnRMb29rdXAgPSB7fTtcbiAgICB0aGlzLm1lc3NhZ2VIYW5kbGVycyA9IFtdO1xuICB9XG5cbiAgRXZlbnRBZ2dyZWdhdG9yLnByb3RvdHlwZS5wdWJsaXNoID0gZnVuY3Rpb24gcHVibGlzaChldmVudCwgZGF0YSkge1xuICAgIHZhciBzdWJzY3JpYmVycyA9IHZvaWQgMDtcbiAgICB2YXIgaSA9IHZvaWQgMDtcblxuICAgIGlmICghZXZlbnQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRXZlbnQgd2FzIGludmFsaWQuJyk7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBldmVudCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHN1YnNjcmliZXJzID0gdGhpcy5ldmVudExvb2t1cFtldmVudF07XG4gICAgICBpZiAoc3Vic2NyaWJlcnMpIHtcbiAgICAgICAgc3Vic2NyaWJlcnMgPSBzdWJzY3JpYmVycy5zbGljZSgpO1xuICAgICAgICBpID0gc3Vic2NyaWJlcnMubGVuZ3RoO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgICAgc3Vic2NyaWJlcnNbaV0oZGF0YSwgZXZlbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIGxvZ2dlci5lcnJvcihlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBzdWJzY3JpYmVycyA9IHRoaXMubWVzc2FnZUhhbmRsZXJzLnNsaWNlKCk7XG4gICAgICBpID0gc3Vic2NyaWJlcnMubGVuZ3RoO1xuXG4gICAgICB0cnkge1xuICAgICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgICAgc3Vic2NyaWJlcnNbaV0uaGFuZGxlKGV2ZW50KTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoZSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIEV2ZW50QWdncmVnYXRvci5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gc3Vic2NyaWJlKGV2ZW50LCBjYWxsYmFjaykge1xuICAgIHZhciBoYW5kbGVyID0gdm9pZCAwO1xuICAgIHZhciBzdWJzY3JpYmVycyA9IHZvaWQgMDtcblxuICAgIGlmICghZXZlbnQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRXZlbnQgY2hhbm5lbC90eXBlIHdhcyBpbnZhbGlkLicpO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgZXZlbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICBoYW5kbGVyID0gY2FsbGJhY2s7XG4gICAgICBzdWJzY3JpYmVycyA9IHRoaXMuZXZlbnRMb29rdXBbZXZlbnRdIHx8ICh0aGlzLmV2ZW50TG9va3VwW2V2ZW50XSA9IFtdKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaGFuZGxlciA9IG5ldyBIYW5kbGVyKGV2ZW50LCBjYWxsYmFjayk7XG4gICAgICBzdWJzY3JpYmVycyA9IHRoaXMubWVzc2FnZUhhbmRsZXJzO1xuICAgIH1cblxuICAgIHN1YnNjcmliZXJzLnB1c2goaGFuZGxlcik7XG5cbiAgICByZXR1cm4ge1xuICAgICAgZGlzcG9zZTogZnVuY3Rpb24gZGlzcG9zZSgpIHtcbiAgICAgICAgdmFyIGlkeCA9IHN1YnNjcmliZXJzLmluZGV4T2YoaGFuZGxlcik7XG4gICAgICAgIGlmIChpZHggIT09IC0xKSB7XG4gICAgICAgICAgc3Vic2NyaWJlcnMuc3BsaWNlKGlkeCwgMSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICB9O1xuXG4gIEV2ZW50QWdncmVnYXRvci5wcm90b3R5cGUuc3Vic2NyaWJlT25jZSA9IGZ1bmN0aW9uIHN1YnNjcmliZU9uY2UoZXZlbnQsIGNhbGxiYWNrKSB7XG4gICAgdmFyIHN1YiA9IHRoaXMuc3Vic2NyaWJlKGV2ZW50LCBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgc3ViLmRpc3Bvc2UoKTtcbiAgICAgIHJldHVybiBjYWxsYmFjayhhLCBiKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBzdWI7XG4gIH07XG5cbiAgcmV0dXJuIEV2ZW50QWdncmVnYXRvcjtcbn0oKTtcblxuZnVuY3Rpb24gaW5jbHVkZUV2ZW50c0luKG9iaikge1xuICB2YXIgZWEgPSBuZXcgRXZlbnRBZ2dyZWdhdG9yKCk7XG5cbiAgb2JqLnN1YnNjcmliZU9uY2UgPSBmdW5jdGlvbiAoZXZlbnQsIGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIGVhLnN1YnNjcmliZU9uY2UoZXZlbnQsIGNhbGxiYWNrKTtcbiAgfTtcblxuICBvYmouc3Vic2NyaWJlID0gZnVuY3Rpb24gKGV2ZW50LCBjYWxsYmFjaykge1xuICAgIHJldHVybiBlYS5zdWJzY3JpYmUoZXZlbnQsIGNhbGxiYWNrKTtcbiAgfTtcblxuICBvYmoucHVibGlzaCA9IGZ1bmN0aW9uIChldmVudCwgZGF0YSkge1xuICAgIGVhLnB1Ymxpc2goZXZlbnQsIGRhdGEpO1xuICB9O1xuXG4gIHJldHVybiBlYTtcbn1cblxuZnVuY3Rpb24gY29uZmlndXJlKGNvbmZpZykge1xuICBjb25maWcuaW5zdGFuY2UoRXZlbnRBZ2dyZWdhdG9yLCBpbmNsdWRlRXZlbnRzSW4oY29uZmlnLmF1cmVsaWEpKTtcbn1cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS1ldmVudC1hZ2dyZWdhdG9yL2Rpc3QvY29tbW9uanMvYXVyZWxpYS1ldmVudC1hZ2dyZWdhdG9yLmpzXG4vLyBtb2R1bGUgaWQgPSAxN1xuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLkF1dGhlbnRpY2F0aW9uID0gdW5kZWZpbmVkO1xuXG52YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpO1xuXG52YXIgX2RlYywgX2NsYXNzO1xuXG52YXIgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uID0gcmVxdWlyZSgnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbicpO1xuXG52YXIgX2Jhc2VDb25maWcgPSByZXF1aXJlKCcuL2Jhc2UtY29uZmlnJyk7XG5cbnZhciBfc3RvcmFnZSA9IHJlcXVpcmUoJy4vc3RvcmFnZScpO1xuXG52YXIgX2F1dGhVdGlsaXRpZXMgPSByZXF1aXJlKCcuL2F1dGgtdXRpbGl0aWVzJyk7XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbnZhciBBdXRoZW50aWNhdGlvbiA9IGV4cG9ydHMuQXV0aGVudGljYXRpb24gPSAoX2RlYyA9ICgwLCBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24uaW5qZWN0KShfc3RvcmFnZS5TdG9yYWdlLCBfYmFzZUNvbmZpZy5CYXNlQ29uZmlnKSwgX2RlYyhfY2xhc3MgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEF1dGhlbnRpY2F0aW9uKHN0b3JhZ2UsIGNvbmZpZykge1xuICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBBdXRoZW50aWNhdGlvbik7XG5cbiAgICB0aGlzLnN0b3JhZ2UgPSBzdG9yYWdlO1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnLmN1cnJlbnQ7XG4gICAgdGhpcy50b2tlbk5hbWUgPSB0aGlzLmNvbmZpZy50b2tlblByZWZpeCA/IHRoaXMuY29uZmlnLnRva2VuUHJlZml4ICsgJ18nICsgdGhpcy5jb25maWcudG9rZW5OYW1lIDogdGhpcy5jb25maWcudG9rZW5OYW1lO1xuICAgIHRoaXMuaWRUb2tlbk5hbWUgPSB0aGlzLmNvbmZpZy50b2tlblByZWZpeCA/IHRoaXMuY29uZmlnLnRva2VuUHJlZml4ICsgJ18nICsgdGhpcy5jb25maWcuaWRUb2tlbk5hbWUgOiB0aGlzLmNvbmZpZy5pZFRva2VuTmFtZTtcbiAgfVxuXG4gIEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5nZXRMb2dpblJvdXRlID0gZnVuY3Rpb24gZ2V0TG9naW5Sb3V0ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5jb25maWcubG9naW5Sb3V0ZTtcbiAgfTtcblxuICBBdXRoZW50aWNhdGlvbi5wcm90b3R5cGUuZ2V0TG9naW5SZWRpcmVjdCA9IGZ1bmN0aW9uIGdldExvZ2luUmVkaXJlY3QoKSB7XG4gICAgcmV0dXJuIHRoaXMuaW5pdGlhbFVybCB8fCB0aGlzLmNvbmZpZy5sb2dpblJlZGlyZWN0O1xuICB9O1xuXG4gIEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5nZXRMb2dpblVybCA9IGZ1bmN0aW9uIGdldExvZ2luVXJsKCkge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZy5iYXNlVXJsID8gKDAsIF9hdXRoVXRpbGl0aWVzLmpvaW5VcmwpKHRoaXMuY29uZmlnLmJhc2VVcmwsIHRoaXMuY29uZmlnLmxvZ2luVXJsKSA6IHRoaXMuY29uZmlnLmxvZ2luVXJsO1xuICB9O1xuXG4gIEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5nZXRTaWdudXBVcmwgPSBmdW5jdGlvbiBnZXRTaWdudXBVcmwoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmJhc2VVcmwgPyAoMCwgX2F1dGhVdGlsaXRpZXMuam9pblVybCkodGhpcy5jb25maWcuYmFzZVVybCwgdGhpcy5jb25maWcuc2lnbnVwVXJsKSA6IHRoaXMuY29uZmlnLnNpZ251cFVybDtcbiAgfTtcblxuICBBdXRoZW50aWNhdGlvbi5wcm90b3R5cGUuZ2V0UHJvZmlsZVVybCA9IGZ1bmN0aW9uIGdldFByb2ZpbGVVcmwoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmJhc2VVcmwgPyAoMCwgX2F1dGhVdGlsaXRpZXMuam9pblVybCkodGhpcy5jb25maWcuYmFzZVVybCwgdGhpcy5jb25maWcucHJvZmlsZVVybCkgOiB0aGlzLmNvbmZpZy5wcm9maWxlVXJsO1xuICB9O1xuXG4gIEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5nZXRUb2tlbiA9IGZ1bmN0aW9uIGdldFRva2VuKCkge1xuICAgIHJldHVybiB0aGlzLnN0b3JhZ2UuZ2V0KHRoaXMudG9rZW5OYW1lKTtcbiAgfTtcblxuICBBdXRoZW50aWNhdGlvbi5wcm90b3R5cGUuZ2V0UGF5bG9hZCA9IGZ1bmN0aW9uIGdldFBheWxvYWQoKSB7XG4gICAgdmFyIHRva2VuID0gdGhpcy5zdG9yYWdlLmdldCh0aGlzLnRva2VuTmFtZSk7XG4gICAgcmV0dXJuIHRoaXMuZGVjb21wb3NlVG9rZW4odG9rZW4pO1xuICB9O1xuXG4gIEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5kZWNvbXBvc2VUb2tlbiA9IGZ1bmN0aW9uIGRlY29tcG9zZVRva2VuKHRva2VuKSB7XG4gICAgaWYgKHRva2VuICYmIHRva2VuLnNwbGl0KCcuJykubGVuZ3RoID09PSAzKSB7XG4gICAgICB2YXIgYmFzZTY0VXJsID0gdG9rZW4uc3BsaXQoJy4nKVsxXTtcbiAgICAgIHZhciBiYXNlNjQgPSBiYXNlNjRVcmwucmVwbGFjZSgvLS9nLCAnKycpLnJlcGxhY2UoL18vZywgJy8nKTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoZGVjb2RlVVJJQ29tcG9uZW50KGVzY2FwZSh3aW5kb3cuYXRvYihiYXNlNjQpKSkpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5zZXRJbml0aWFsVXJsID0gZnVuY3Rpb24gc2V0SW5pdGlhbFVybCh1cmwpIHtcbiAgICB0aGlzLmluaXRpYWxVcmwgPSB1cmw7XG4gIH07XG5cbiAgQXV0aGVudGljYXRpb24ucHJvdG90eXBlLnNldFRva2VuID0gZnVuY3Rpb24gc2V0VG9rZW4ocmVzcG9uc2UsIHJlZGlyZWN0KSB7XG4gICAgdmFyIGFjY2Vzc1Rva2VuID0gcmVzcG9uc2UgJiYgcmVzcG9uc2VbdGhpcy5jb25maWcucmVzcG9uc2VUb2tlblByb3BdO1xuICAgIHZhciB0b2tlblRvU3RvcmUgPSB2b2lkIDA7XG5cbiAgICBpZiAoYWNjZXNzVG9rZW4pIHtcbiAgICAgIGlmICgoMCwgX2F1dGhVdGlsaXRpZXMuaXNPYmplY3QpKGFjY2Vzc1Rva2VuKSAmJiAoMCwgX2F1dGhVdGlsaXRpZXMuaXNPYmplY3QpKGFjY2Vzc1Rva2VuLmRhdGEpKSB7XG4gICAgICAgIHJlc3BvbnNlID0gYWNjZXNzVG9rZW47XG4gICAgICB9IGVsc2UgaWYgKCgwLCBfYXV0aFV0aWxpdGllcy5pc1N0cmluZykoYWNjZXNzVG9rZW4pKSB7XG4gICAgICAgIHRva2VuVG9TdG9yZSA9IGFjY2Vzc1Rva2VuO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghdG9rZW5Ub1N0b3JlICYmIHJlc3BvbnNlKSB7XG4gICAgICB0b2tlblRvU3RvcmUgPSB0aGlzLmNvbmZpZy50b2tlblJvb3QgJiYgcmVzcG9uc2VbdGhpcy5jb25maWcudG9rZW5Sb290XSA/IHJlc3BvbnNlW3RoaXMuY29uZmlnLnRva2VuUm9vdF1bdGhpcy5jb25maWcudG9rZW5OYW1lXSA6IHJlc3BvbnNlW3RoaXMuY29uZmlnLnRva2VuTmFtZV07XG4gICAgfVxuXG4gICAgaWYgKHRva2VuVG9TdG9yZSkge1xuICAgICAgdGhpcy5zdG9yYWdlLnNldCh0aGlzLnRva2VuTmFtZSwgdG9rZW5Ub1N0b3JlKTtcbiAgICB9XG5cbiAgICB2YXIgaWRUb2tlbiA9IHJlc3BvbnNlICYmIHJlc3BvbnNlW3RoaXMuY29uZmlnLnJlc3BvbnNlSWRUb2tlblByb3BdO1xuXG4gICAgaWYgKGlkVG9rZW4pIHtcbiAgICAgIHRoaXMuc3RvcmFnZS5zZXQodGhpcy5pZFRva2VuTmFtZSwgaWRUb2tlbik7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY29uZmlnLmxvZ2luUmVkaXJlY3QgJiYgIXJlZGlyZWN0KSB7XG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHRoaXMuZ2V0TG9naW5SZWRpcmVjdCgpO1xuICAgIH0gZWxzZSBpZiAocmVkaXJlY3QgJiYgKDAsIF9hdXRoVXRpbGl0aWVzLmlzU3RyaW5nKShyZWRpcmVjdCkpIHtcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gd2luZG93LmVuY29kZVVSSShyZWRpcmVjdCk7XG4gICAgfVxuICB9O1xuXG4gIEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5yZW1vdmVUb2tlbiA9IGZ1bmN0aW9uIHJlbW92ZVRva2VuKCkge1xuICAgIHRoaXMuc3RvcmFnZS5yZW1vdmUodGhpcy50b2tlbk5hbWUpO1xuICB9O1xuXG4gIEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5pc0F1dGhlbnRpY2F0ZWQgPSBmdW5jdGlvbiBpc0F1dGhlbnRpY2F0ZWQoKSB7XG4gICAgdmFyIHRva2VuID0gdGhpcy5zdG9yYWdlLmdldCh0aGlzLnRva2VuTmFtZSk7XG5cbiAgICBpZiAoIXRva2VuKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKHRva2VuLnNwbGl0KCcuJykubGVuZ3RoICE9PSAzKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICB2YXIgZXhwID0gdm9pZCAwO1xuICAgIHRyeSB7XG4gICAgICB2YXIgYmFzZTY0VXJsID0gdG9rZW4uc3BsaXQoJy4nKVsxXTtcbiAgICAgIHZhciBiYXNlNjQgPSBiYXNlNjRVcmwucmVwbGFjZSgvLS9nLCAnKycpLnJlcGxhY2UoL18vZywgJy8nKTtcbiAgICAgIGV4cCA9IEpTT04ucGFyc2Uod2luZG93LmF0b2IoYmFzZTY0KSkuZXhwO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKGV4cCkge1xuICAgICAgcmV0dXJuIE1hdGgucm91bmQobmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwKSA8PSBleHA7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH07XG5cbiAgQXV0aGVudGljYXRpb24ucHJvdG90eXBlLmxvZ291dCA9IGZ1bmN0aW9uIGxvZ291dChyZWRpcmVjdCkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcbiAgICAgIF90aGlzLnN0b3JhZ2UucmVtb3ZlKF90aGlzLnRva2VuTmFtZSk7XG5cbiAgICAgIGlmIChfdGhpcy5jb25maWcubG9nb3V0UmVkaXJlY3QgJiYgIXJlZGlyZWN0KSB7XG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gX3RoaXMuY29uZmlnLmxvZ291dFJlZGlyZWN0O1xuICAgICAgfSBlbHNlIGlmICgoMCwgX2F1dGhVdGlsaXRpZXMuaXNTdHJpbmcpKHJlZGlyZWN0KSkge1xuICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHJlZGlyZWN0O1xuICAgICAgfVxuXG4gICAgICByZXNvbHZlKCk7XG4gICAgfSk7XG4gIH07XG5cbiAgX2NyZWF0ZUNsYXNzKEF1dGhlbnRpY2F0aW9uLCBbe1xuICAgIGtleTogJ3Rva2VuSW50ZXJjZXB0b3InLFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgdmFyIGNvbmZpZyA9IHRoaXMuY29uZmlnO1xuICAgICAgdmFyIHN0b3JhZ2UgPSB0aGlzLnN0b3JhZ2U7XG4gICAgICB2YXIgYXV0aCA9IHRoaXM7XG4gICAgICByZXR1cm4ge1xuICAgICAgICByZXF1ZXN0OiBmdW5jdGlvbiByZXF1ZXN0KF9yZXF1ZXN0KSB7XG4gICAgICAgICAgaWYgKGF1dGguaXNBdXRoZW50aWNhdGVkKCkgJiYgY29uZmlnLmh0dHBJbnRlcmNlcHRvcikge1xuICAgICAgICAgICAgdmFyIHRva2VuTmFtZSA9IGNvbmZpZy50b2tlblByZWZpeCA/IGNvbmZpZy50b2tlblByZWZpeCArICdfJyArIGNvbmZpZy50b2tlbk5hbWUgOiBjb25maWcudG9rZW5OYW1lO1xuICAgICAgICAgICAgdmFyIHRva2VuID0gc3RvcmFnZS5nZXQodG9rZW5OYW1lKTtcblxuICAgICAgICAgICAgaWYgKGNvbmZpZy5hdXRoSGVhZGVyICYmIGNvbmZpZy5hdXRoVG9rZW4pIHtcbiAgICAgICAgICAgICAgdG9rZW4gPSBjb25maWcuYXV0aFRva2VuICsgJyAnICsgdG9rZW47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIF9yZXF1ZXN0LmhlYWRlcnMuc2V0KGNvbmZpZy5hdXRoSGVhZGVyLCB0b2tlbik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBfcmVxdWVzdDtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gQXV0aGVudGljYXRpb247XG59KCkpIHx8IF9jbGFzcyk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtYXV0aC9kaXN0L2NvbW1vbmpzL2F1dGhlbnRpY2F0aW9uLmpzXG4vLyBtb2R1bGUgaWQgPSAyMFxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLmJvb3RzdHJhcCA9IGJvb3RzdHJhcDtcblxucmVxdWlyZSgnYXVyZWxpYS1wb2x5ZmlsbHMnKTtcblxudmFyIF9hdXJlbGlhUGFsQnJvd3NlciA9IHJlcXVpcmUoJ2F1cmVsaWEtcGFsLWJyb3dzZXInKTtcblxudmFyIF9hdXJlbGlhTG9hZGVyV2VicGFjayA9IHJlcXVpcmUoJ2F1cmVsaWEtbG9hZGVyLXdlYnBhY2snKTtcblxudmFyIGJvb3RzdHJhcFF1ZXVlID0gW107XG52YXIgc2hhcmVkTG9hZGVyID0gbnVsbDtcbnZhciBBdXJlbGlhID0gbnVsbDtcblxuZnVuY3Rpb24gb25Cb290c3RyYXAoY2FsbGJhY2spIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICBpZiAoc2hhcmVkTG9hZGVyKSB7XG4gICAgICByZXNvbHZlKGNhbGxiYWNrKHNoYXJlZExvYWRlcikpO1xuICAgIH0gZWxzZSB7XG4gICAgICBib290c3RyYXBRdWV1ZS5wdXNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICByZXNvbHZlKGNhbGxiYWNrKHNoYXJlZExvYWRlcikpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiByZWFkeShnbG9iYWwpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICBpZiAoZ2xvYmFsLmRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdjb21wbGV0ZScpIHtcbiAgICAgIHJlc29sdmUoZ2xvYmFsLmRvY3VtZW50KTtcbiAgICB9IGVsc2Uge1xuICAgICAgZ2xvYmFsLmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBjb21wbGV0ZWQpO1xuICAgICAgZ2xvYmFsLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBjb21wbGV0ZWQpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNvbXBsZXRlZCgpIHtcbiAgICAgIGdsb2JhbC5kb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgY29tcGxldGVkKTtcbiAgICAgIGdsb2JhbC5yZW1vdmVFdmVudExpc3RlbmVyKCdsb2FkJywgY29tcGxldGVkKTtcbiAgICAgIHJlc29sdmUoZ2xvYmFsLmRvY3VtZW50KTtcbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVBcHAobG9hZGVyLCBhcHBIb3N0KSB7XG4gIHJldHVybiBjb25maWcobG9hZGVyLCBhcHBIb3N0LCBhcHBIb3N0LmdldEF0dHJpYnV0ZSgnYXVyZWxpYS1hcHAnKSk7XG59XG5cbmZ1bmN0aW9uIGNvbmZpZyhsb2FkZXIsIGFwcEhvc3QsIGNvbmZpZ01vZHVsZUlkKSB7XG4gIHZhciBhdXJlbGlhID0gbmV3IEF1cmVsaWEobG9hZGVyKTtcbiAgYXVyZWxpYS5ob3N0ID0gYXBwSG9zdDtcblxuICBpZiAoY29uZmlnTW9kdWxlSWQpIHtcbiAgICByZXR1cm4gbG9hZGVyLmxvYWRNb2R1bGUoY29uZmlnTW9kdWxlSWQpLnRoZW4oZnVuY3Rpb24gKGN1c3RvbUNvbmZpZykge1xuICAgICAgcmV0dXJuIGN1c3RvbUNvbmZpZy5jb25maWd1cmUoYXVyZWxpYSk7XG4gICAgfSk7XG4gIH1cblxuICBhdXJlbGlhLnVzZS5zdGFuZGFyZENvbmZpZ3VyYXRpb24oKS5kZXZlbG9wbWVudExvZ2dpbmcoKTtcblxuICByZXR1cm4gYXVyZWxpYS5zdGFydCgpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBhdXJlbGlhLnNldFJvb3QoKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHJ1bigpIHtcbiAgcmV0dXJuIHJlYWR5KHdpbmRvdykudGhlbihmdW5jdGlvbiAoZG9jKSB7XG4gICAgKDAsIF9hdXJlbGlhUGFsQnJvd3Nlci5pbml0aWFsaXplKSgpO1xuXG4gICAgdmFyIGFwcEhvc3QgPSBkb2MucXVlcnlTZWxlY3RvckFsbCgnW2F1cmVsaWEtYXBwXScpO1xuICAgIHZhciBsb2FkZXIgPSBuZXcgX2F1cmVsaWFMb2FkZXJXZWJwYWNrLldlYnBhY2tMb2FkZXIoKTtcbiAgICBsb2FkZXIubG9hZE1vZHVsZSgnYXVyZWxpYS1mcmFtZXdvcmsnKS50aGVuKGZ1bmN0aW9uIChtKSB7XG4gICAgICBBdXJlbGlhID0gbS5BdXJlbGlhO1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gYXBwSG9zdC5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgIGhhbmRsZUFwcChsb2FkZXIsIGFwcEhvc3RbaV0pLmNhdGNoKGNvbnNvbGUuZXJyb3IuYmluZChjb25zb2xlKSk7XG4gICAgICB9XG5cbiAgICAgIHNoYXJlZExvYWRlciA9IGxvYWRlcjtcbiAgICAgIGZvciAodmFyIF9pID0gMCwgX2lpID0gYm9vdHN0cmFwUXVldWUubGVuZ3RoOyBfaSA8IF9paTsgKytfaSkge1xuICAgICAgICBib290c3RyYXBRdWV1ZVtfaV0oKTtcbiAgICAgIH1cbiAgICAgIGJvb3RzdHJhcFF1ZXVlID0gbnVsbDtcbiAgICB9KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGJvb3RzdHJhcChjb25maWd1cmUpIHtcbiAgcmV0dXJuIG9uQm9vdHN0cmFwKGZ1bmN0aW9uIChsb2FkZXIpIHtcbiAgICB2YXIgYXVyZWxpYSA9IG5ldyBBdXJlbGlhKGxvYWRlcik7XG4gICAgcmV0dXJuIGNvbmZpZ3VyZShhdXJlbGlhKTtcbiAgfSk7XG59XG5cbnJ1bigpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLWJvb3RzdHJhcHBlci13ZWJwYWNrL2Rpc3QvY29tbW9uanMvYXVyZWxpYS1ib290c3RyYXBwZXItd2VicGFjay5qc1xuLy8gbW9kdWxlIGlkID0gMjNcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5Mb2dNYW5hZ2VyID0gZXhwb3J0cy5GcmFtZXdvcmtDb25maWd1cmF0aW9uID0gZXhwb3J0cy5BdXJlbGlhID0gdW5kZWZpbmVkO1xuXG52YXIgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uID0gcmVxdWlyZSgnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbicpO1xuXG5PYmplY3Qua2V5cyhfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24pLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICBpZiAoa2V5ID09PSBcImRlZmF1bHRcIiB8fCBrZXkgPT09IFwiX19lc01vZHVsZVwiKSByZXR1cm47XG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHtcbiAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgcmV0dXJuIF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbltrZXldO1xuICAgIH1cbiAgfSk7XG59KTtcblxudmFyIF9hdXJlbGlhQmluZGluZyA9IHJlcXVpcmUoJ2F1cmVsaWEtYmluZGluZycpO1xuXG5PYmplY3Qua2V5cyhfYXVyZWxpYUJpbmRpbmcpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICBpZiAoa2V5ID09PSBcImRlZmF1bHRcIiB8fCBrZXkgPT09IFwiX19lc01vZHVsZVwiKSByZXR1cm47XG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHtcbiAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgcmV0dXJuIF9hdXJlbGlhQmluZGluZ1trZXldO1xuICAgIH1cbiAgfSk7XG59KTtcblxudmFyIF9hdXJlbGlhTWV0YWRhdGEgPSByZXF1aXJlKCdhdXJlbGlhLW1ldGFkYXRhJyk7XG5cbk9iamVjdC5rZXlzKF9hdXJlbGlhTWV0YWRhdGEpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICBpZiAoa2V5ID09PSBcImRlZmF1bHRcIiB8fCBrZXkgPT09IFwiX19lc01vZHVsZVwiKSByZXR1cm47XG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHtcbiAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgcmV0dXJuIF9hdXJlbGlhTWV0YWRhdGFba2V5XTtcbiAgICB9XG4gIH0pO1xufSk7XG5cbnZhciBfYXVyZWxpYVRlbXBsYXRpbmcgPSByZXF1aXJlKCdhdXJlbGlhLXRlbXBsYXRpbmcnKTtcblxuT2JqZWN0LmtleXMoX2F1cmVsaWFUZW1wbGF0aW5nKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgaWYgKGtleSA9PT0gXCJkZWZhdWx0XCIgfHwga2V5ID09PSBcIl9fZXNNb2R1bGVcIikgcmV0dXJuO1xuICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7XG4gICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgIHJldHVybiBfYXVyZWxpYVRlbXBsYXRpbmdba2V5XTtcbiAgICB9XG4gIH0pO1xufSk7XG5cbnZhciBfYXVyZWxpYUxvYWRlciA9IHJlcXVpcmUoJ2F1cmVsaWEtbG9hZGVyJyk7XG5cbk9iamVjdC5rZXlzKF9hdXJlbGlhTG9hZGVyKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgaWYgKGtleSA9PT0gXCJkZWZhdWx0XCIgfHwga2V5ID09PSBcIl9fZXNNb2R1bGVcIikgcmV0dXJuO1xuICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7XG4gICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgIHJldHVybiBfYXVyZWxpYUxvYWRlcltrZXldO1xuICAgIH1cbiAgfSk7XG59KTtcblxudmFyIF9hdXJlbGlhVGFza1F1ZXVlID0gcmVxdWlyZSgnYXVyZWxpYS10YXNrLXF1ZXVlJyk7XG5cbk9iamVjdC5rZXlzKF9hdXJlbGlhVGFza1F1ZXVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgaWYgKGtleSA9PT0gXCJkZWZhdWx0XCIgfHwga2V5ID09PSBcIl9fZXNNb2R1bGVcIikgcmV0dXJuO1xuICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7XG4gICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgIHJldHVybiBfYXVyZWxpYVRhc2tRdWV1ZVtrZXldO1xuICAgIH1cbiAgfSk7XG59KTtcblxudmFyIF9hdXJlbGlhUGF0aCA9IHJlcXVpcmUoJ2F1cmVsaWEtcGF0aCcpO1xuXG5PYmplY3Qua2V5cyhfYXVyZWxpYVBhdGgpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICBpZiAoa2V5ID09PSBcImRlZmF1bHRcIiB8fCBrZXkgPT09IFwiX19lc01vZHVsZVwiKSByZXR1cm47XG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHtcbiAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgcmV0dXJuIF9hdXJlbGlhUGF0aFtrZXldO1xuICAgIH1cbiAgfSk7XG59KTtcblxudmFyIF9hdXJlbGlhUGFsID0gcmVxdWlyZSgnYXVyZWxpYS1wYWwnKTtcblxuT2JqZWN0LmtleXMoX2F1cmVsaWFQYWwpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICBpZiAoa2V5ID09PSBcImRlZmF1bHRcIiB8fCBrZXkgPT09IFwiX19lc01vZHVsZVwiKSByZXR1cm47XG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHtcbiAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgcmV0dXJuIF9hdXJlbGlhUGFsW2tleV07XG4gICAgfVxuICB9KTtcbn0pO1xuXG52YXIgX2F1cmVsaWFMb2dnaW5nID0gcmVxdWlyZSgnYXVyZWxpYS1sb2dnaW5nJyk7XG5cbnZhciBUaGVMb2dNYW5hZ2VyID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQoX2F1cmVsaWFMb2dnaW5nKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7IGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsgcmV0dXJuIG9iajsgfSBlbHNlIHsgdmFyIG5ld09iaiA9IHt9OyBpZiAob2JqICE9IG51bGwpIHsgZm9yICh2YXIga2V5IGluIG9iaikgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsgfSB9IG5ld09iai5kZWZhdWx0ID0gb2JqOyByZXR1cm4gbmV3T2JqOyB9IH1cblxuXG5cbmZ1bmN0aW9uIHByZXZlbnRBY3Rpb25sZXNzRm9ybVN1Ym1pdCgpIHtcbiAgX2F1cmVsaWFQYWwuRE9NLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGZ1bmN0aW9uIChldnQpIHtcbiAgICB2YXIgdGFyZ2V0ID0gZXZ0LnRhcmdldDtcbiAgICB2YXIgYWN0aW9uID0gdGFyZ2V0LmFjdGlvbjtcblxuICAgIGlmICh0YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnZm9ybScgJiYgIWFjdGlvbikge1xuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuICB9KTtcbn1cblxudmFyIEF1cmVsaWEgPSBleHBvcnRzLkF1cmVsaWEgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEF1cmVsaWEobG9hZGVyLCBjb250YWluZXIsIHJlc291cmNlcykge1xuXG5cbiAgICB0aGlzLmxvYWRlciA9IGxvYWRlciB8fCBuZXcgX2F1cmVsaWFQYWwuUExBVEZPUk0uTG9hZGVyKCk7XG4gICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXIgfHwgbmV3IF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbi5Db250YWluZXIoKS5tYWtlR2xvYmFsKCk7XG4gICAgdGhpcy5yZXNvdXJjZXMgPSByZXNvdXJjZXMgfHwgbmV3IF9hdXJlbGlhVGVtcGxhdGluZy5WaWV3UmVzb3VyY2VzKCk7XG4gICAgdGhpcy51c2UgPSBuZXcgRnJhbWV3b3JrQ29uZmlndXJhdGlvbih0aGlzKTtcbiAgICB0aGlzLmxvZ2dlciA9IFRoZUxvZ01hbmFnZXIuZ2V0TG9nZ2VyKCdhdXJlbGlhJyk7XG4gICAgdGhpcy5ob3N0Q29uZmlndXJlZCA9IGZhbHNlO1xuICAgIHRoaXMuaG9zdCA9IG51bGw7XG5cbiAgICB0aGlzLnVzZS5pbnN0YW5jZShBdXJlbGlhLCB0aGlzKTtcbiAgICB0aGlzLnVzZS5pbnN0YW5jZShfYXVyZWxpYUxvYWRlci5Mb2FkZXIsIHRoaXMubG9hZGVyKTtcbiAgICB0aGlzLnVzZS5pbnN0YW5jZShfYXVyZWxpYVRlbXBsYXRpbmcuVmlld1Jlc291cmNlcywgdGhpcy5yZXNvdXJjZXMpO1xuICB9XG5cbiAgQXVyZWxpYS5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbiBzdGFydCgpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgaWYgKHRoaXMuc3RhcnRlZCkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzKTtcbiAgICB9XG5cbiAgICB0aGlzLnN0YXJ0ZWQgPSB0cnVlO1xuICAgIHRoaXMubG9nZ2VyLmluZm8oJ0F1cmVsaWEgU3RhcnRpbmcnKTtcblxuICAgIHJldHVybiB0aGlzLnVzZS5hcHBseSgpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgcHJldmVudEFjdGlvbmxlc3NGb3JtU3VibWl0KCk7XG5cbiAgICAgIGlmICghX3RoaXMuY29udGFpbmVyLmhhc1Jlc29sdmVyKF9hdXJlbGlhVGVtcGxhdGluZy5CaW5kaW5nTGFuZ3VhZ2UpKSB7XG4gICAgICAgIHZhciBtZXNzYWdlID0gJ1lvdSBtdXN0IGNvbmZpZ3VyZSBBdXJlbGlhIHdpdGggYSBCaW5kaW5nTGFuZ3VhZ2UgaW1wbGVtZW50YXRpb24uJztcbiAgICAgICAgX3RoaXMubG9nZ2VyLmVycm9yKG1lc3NhZ2UpO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7XG4gICAgICB9XG5cbiAgICAgIF90aGlzLmxvZ2dlci5pbmZvKCdBdXJlbGlhIFN0YXJ0ZWQnKTtcbiAgICAgIHZhciBldnQgPSBfYXVyZWxpYVBhbC5ET00uY3JlYXRlQ3VzdG9tRXZlbnQoJ2F1cmVsaWEtc3RhcnRlZCcsIHsgYnViYmxlczogdHJ1ZSwgY2FuY2VsYWJsZTogdHJ1ZSB9KTtcbiAgICAgIF9hdXJlbGlhUGFsLkRPTS5kaXNwYXRjaEV2ZW50KGV2dCk7XG4gICAgICByZXR1cm4gX3RoaXM7XG4gICAgfSk7XG4gIH07XG5cbiAgQXVyZWxpYS5wcm90b3R5cGUuZW5oYW5jZSA9IGZ1bmN0aW9uIGVuaGFuY2UoKSB7XG4gICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICB2YXIgYmluZGluZ0NvbnRleHQgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDAgfHwgYXJndW1lbnRzWzBdID09PSB1bmRlZmluZWQgPyB7fSA6IGFyZ3VtZW50c1swXTtcbiAgICB2YXIgYXBwbGljYXRpb25Ib3N0ID0gYXJndW1lbnRzLmxlbmd0aCA8PSAxIHx8IGFyZ3VtZW50c1sxXSA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IGFyZ3VtZW50c1sxXTtcblxuICAgIHRoaXMuX2NvbmZpZ3VyZUhvc3QoYXBwbGljYXRpb25Ib3N0IHx8IF9hdXJlbGlhUGFsLkRPTS5xdWVyeVNlbGVjdG9yQWxsKCdib2R5JylbMF0pO1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gICAgICB2YXIgZW5naW5lID0gX3RoaXMyLmNvbnRhaW5lci5nZXQoX2F1cmVsaWFUZW1wbGF0aW5nLlRlbXBsYXRpbmdFbmdpbmUpO1xuICAgICAgX3RoaXMyLnJvb3QgPSBlbmdpbmUuZW5oYW5jZSh7IGNvbnRhaW5lcjogX3RoaXMyLmNvbnRhaW5lciwgZWxlbWVudDogX3RoaXMyLmhvc3QsIHJlc291cmNlczogX3RoaXMyLnJlc291cmNlcywgYmluZGluZ0NvbnRleHQ6IGJpbmRpbmdDb250ZXh0IH0pO1xuICAgICAgX3RoaXMyLnJvb3QuYXR0YWNoZWQoKTtcbiAgICAgIF90aGlzMi5fb25BdXJlbGlhQ29tcG9zZWQoKTtcbiAgICAgIHJldHVybiBfdGhpczI7XG4gICAgfSk7XG4gIH07XG5cbiAgQXVyZWxpYS5wcm90b3R5cGUuc2V0Um9vdCA9IGZ1bmN0aW9uIHNldFJvb3QoKSB7XG4gICAgdmFyIF90aGlzMyA9IHRoaXM7XG5cbiAgICB2YXIgcm9vdCA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMCB8fCBhcmd1bWVudHNbMF0gPT09IHVuZGVmaW5lZCA/IG51bGwgOiBhcmd1bWVudHNbMF07XG4gICAgdmFyIGFwcGxpY2F0aW9uSG9zdCA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMSB8fCBhcmd1bWVudHNbMV0gPT09IHVuZGVmaW5lZCA/IG51bGwgOiBhcmd1bWVudHNbMV07XG5cbiAgICB2YXIgaW5zdHJ1Y3Rpb24gPSB7fTtcblxuICAgIGlmICh0aGlzLnJvb3QgJiYgdGhpcy5yb290LnZpZXdNb2RlbCAmJiB0aGlzLnJvb3Qudmlld01vZGVsLnJvdXRlcikge1xuICAgICAgdGhpcy5yb290LnZpZXdNb2RlbC5yb3V0ZXIuZGVhY3RpdmF0ZSgpO1xuICAgICAgdGhpcy5yb290LnZpZXdNb2RlbC5yb3V0ZXIucmVzZXQoKTtcbiAgICB9XG5cbiAgICB0aGlzLl9jb25maWd1cmVIb3N0KGFwcGxpY2F0aW9uSG9zdCk7XG5cbiAgICB2YXIgZW5naW5lID0gdGhpcy5jb250YWluZXIuZ2V0KF9hdXJlbGlhVGVtcGxhdGluZy5UZW1wbGF0aW5nRW5naW5lKTtcbiAgICB2YXIgdHJhbnNhY3Rpb24gPSB0aGlzLmNvbnRhaW5lci5nZXQoX2F1cmVsaWFUZW1wbGF0aW5nLkNvbXBvc2l0aW9uVHJhbnNhY3Rpb24pO1xuICAgIGRlbGV0ZSB0cmFuc2FjdGlvbi5pbml0aWFsQ29tcG9zaXRpb247XG5cbiAgICBpZiAoIXJvb3QpIHtcbiAgICAgIGlmICh0aGlzLmNvbmZpZ01vZHVsZUlkKSB7XG4gICAgICAgIHJvb3QgPSAoMCwgX2F1cmVsaWFQYXRoLnJlbGF0aXZlVG9GaWxlKSgnLi9hcHAnLCB0aGlzLmNvbmZpZ01vZHVsZUlkKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJvb3QgPSAnYXBwJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpbnN0cnVjdGlvbi52aWV3TW9kZWwgPSByb290O1xuICAgIGluc3RydWN0aW9uLmNvbnRhaW5lciA9IGluc3RydWN0aW9uLmNoaWxkQ29udGFpbmVyID0gdGhpcy5jb250YWluZXI7XG4gICAgaW5zdHJ1Y3Rpb24udmlld1Nsb3QgPSB0aGlzLmhvc3RTbG90O1xuICAgIGluc3RydWN0aW9uLmhvc3QgPSB0aGlzLmhvc3Q7XG5cbiAgICByZXR1cm4gZW5naW5lLmNvbXBvc2UoaW5zdHJ1Y3Rpb24pLnRoZW4oZnVuY3Rpb24gKHIpIHtcbiAgICAgIF90aGlzMy5yb290ID0gcjtcbiAgICAgIGluc3RydWN0aW9uLnZpZXdTbG90LmF0dGFjaGVkKCk7XG4gICAgICBfdGhpczMuX29uQXVyZWxpYUNvbXBvc2VkKCk7XG4gICAgICByZXR1cm4gX3RoaXMzO1xuICAgIH0pO1xuICB9O1xuXG4gIEF1cmVsaWEucHJvdG90eXBlLl9jb25maWd1cmVIb3N0ID0gZnVuY3Rpb24gX2NvbmZpZ3VyZUhvc3QoYXBwbGljYXRpb25Ib3N0KSB7XG4gICAgaWYgKHRoaXMuaG9zdENvbmZpZ3VyZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgYXBwbGljYXRpb25Ib3N0ID0gYXBwbGljYXRpb25Ib3N0IHx8IHRoaXMuaG9zdDtcblxuICAgIGlmICghYXBwbGljYXRpb25Ib3N0IHx8IHR5cGVvZiBhcHBsaWNhdGlvbkhvc3QgPT09ICdzdHJpbmcnKSB7XG4gICAgICB0aGlzLmhvc3QgPSBfYXVyZWxpYVBhbC5ET00uZ2V0RWxlbWVudEJ5SWQoYXBwbGljYXRpb25Ib3N0IHx8ICdhcHBsaWNhdGlvbkhvc3QnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5ob3N0ID0gYXBwbGljYXRpb25Ib3N0O1xuICAgIH1cblxuICAgIGlmICghdGhpcy5ob3N0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGFwcGxpY2F0aW9uSG9zdCB3YXMgc3BlY2lmaWVkLicpO1xuICAgIH1cblxuICAgIHRoaXMuaG9zdENvbmZpZ3VyZWQgPSB0cnVlO1xuICAgIHRoaXMuaG9zdC5hdXJlbGlhID0gdGhpcztcbiAgICB0aGlzLmhvc3RTbG90ID0gbmV3IF9hdXJlbGlhVGVtcGxhdGluZy5WaWV3U2xvdCh0aGlzLmhvc3QsIHRydWUpO1xuICAgIHRoaXMuaG9zdFNsb3QudHJhbnNmb3JtQ2hpbGROb2Rlc0ludG9WaWV3KCk7XG4gICAgdGhpcy5jb250YWluZXIucmVnaXN0ZXJJbnN0YW5jZShfYXVyZWxpYVBhbC5ET00uYm91bmRhcnksIHRoaXMuaG9zdCk7XG4gIH07XG5cbiAgQXVyZWxpYS5wcm90b3R5cGUuX29uQXVyZWxpYUNvbXBvc2VkID0gZnVuY3Rpb24gX29uQXVyZWxpYUNvbXBvc2VkKCkge1xuICAgIHZhciBldnQgPSBfYXVyZWxpYVBhbC5ET00uY3JlYXRlQ3VzdG9tRXZlbnQoJ2F1cmVsaWEtY29tcG9zZWQnLCB7IGJ1YmJsZXM6IHRydWUsIGNhbmNlbGFibGU6IHRydWUgfSk7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gX2F1cmVsaWFQYWwuRE9NLmRpc3BhdGNoRXZlbnQoZXZ0KTtcbiAgICB9LCAxKTtcbiAgfTtcblxuICByZXR1cm4gQXVyZWxpYTtcbn0oKTtcblxudmFyIGxvZ2dlciA9IFRoZUxvZ01hbmFnZXIuZ2V0TG9nZ2VyKCdhdXJlbGlhJyk7XG52YXIgZXh0UGF0dGVybiA9IC9cXC5bXi8uXSskLztcblxuZnVuY3Rpb24gcnVuVGFza3MoY29uZmlnLCB0YXNrcykge1xuICB2YXIgY3VycmVudCA9IHZvaWQgMDtcbiAgdmFyIG5leHQgPSBmdW5jdGlvbiBuZXh0KCkge1xuICAgIGlmIChjdXJyZW50ID0gdGFza3Muc2hpZnQoKSkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShjdXJyZW50KGNvbmZpZykpLnRoZW4obmV4dCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICB9O1xuXG4gIHJldHVybiBuZXh0KCk7XG59XG5cbmZ1bmN0aW9uIGxvYWRQbHVnaW4oY29uZmlnLCBsb2FkZXIsIGluZm8pIHtcbiAgbG9nZ2VyLmRlYnVnKCdMb2FkaW5nIHBsdWdpbiAnICsgaW5mby5tb2R1bGVJZCArICcuJyk7XG4gIGNvbmZpZy5yZXNvdXJjZXNSZWxhdGl2ZVRvID0gaW5mby5yZXNvdXJjZXNSZWxhdGl2ZVRvO1xuXG4gIHZhciBpZCA9IGluZm8ubW9kdWxlSWQ7XG5cbiAgaWYgKGluZm8ucmVzb3VyY2VzUmVsYXRpdmVUby5sZW5ndGggPiAxKSB7XG4gICAgcmV0dXJuIGxvYWRlci5ub3JtYWxpemUoaW5mby5tb2R1bGVJZCwgaW5mby5yZXNvdXJjZXNSZWxhdGl2ZVRvWzFdKS50aGVuKGZ1bmN0aW9uIChub3JtYWxpemVkSWQpIHtcbiAgICAgIHJldHVybiBfbG9hZFBsdWdpbihub3JtYWxpemVkSWQpO1xuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIF9sb2FkUGx1Z2luKGlkKTtcblxuICBmdW5jdGlvbiBfbG9hZFBsdWdpbihtb2R1bGVJZCkge1xuICAgIHJldHVybiBsb2FkZXIubG9hZE1vZHVsZShtb2R1bGVJZCkudGhlbihmdW5jdGlvbiAobSkge1xuICAgICAgaWYgKCdjb25maWd1cmUnIGluIG0pIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShtLmNvbmZpZ3VyZShjb25maWcsIGluZm8uY29uZmlnIHx8IHt9KSkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgY29uZmlnLnJlc291cmNlc1JlbGF0aXZlVG8gPSBudWxsO1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnQ29uZmlndXJlZCBwbHVnaW4gJyArIGluZm8ubW9kdWxlSWQgKyAnLicpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uZmlnLnJlc291cmNlc1JlbGF0aXZlVG8gPSBudWxsO1xuICAgICAgbG9nZ2VyLmRlYnVnKCdMb2FkZWQgcGx1Z2luICcgKyBpbmZvLm1vZHVsZUlkICsgJy4nKTtcbiAgICB9KTtcbiAgfVxufVxuXG5mdW5jdGlvbiBsb2FkUmVzb3VyY2VzKGF1cmVsaWEsIHJlc291cmNlc1RvTG9hZCwgYXBwUmVzb3VyY2VzKSB7XG4gIHZhciB2aWV3RW5naW5lID0gYXVyZWxpYS5jb250YWluZXIuZ2V0KF9hdXJlbGlhVGVtcGxhdGluZy5WaWV3RW5naW5lKTtcblxuICByZXR1cm4gUHJvbWlzZS5hbGwoT2JqZWN0LmtleXMocmVzb3VyY2VzVG9Mb2FkKS5tYXAoZnVuY3Rpb24gKG4pIHtcbiAgICByZXR1cm4gX25vcm1hbGl6ZShyZXNvdXJjZXNUb0xvYWRbbl0pO1xuICB9KSkudGhlbihmdW5jdGlvbiAobG9hZHMpIHtcbiAgICB2YXIgbmFtZXMgPSBbXTtcbiAgICB2YXIgaW1wb3J0SWRzID0gW107XG5cbiAgICBsb2Fkcy5mb3JFYWNoKGZ1bmN0aW9uIChsKSB7XG4gICAgICBuYW1lcy5wdXNoKHVuZGVmaW5lZCk7XG4gICAgICBpbXBvcnRJZHMucHVzaChsLmltcG9ydElkKTtcbiAgICB9KTtcblxuICAgIHJldHVybiB2aWV3RW5naW5lLmltcG9ydFZpZXdSZXNvdXJjZXMoaW1wb3J0SWRzLCBuYW1lcywgYXBwUmVzb3VyY2VzKTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gX25vcm1hbGl6ZShsb2FkKSB7XG4gICAgdmFyIG1vZHVsZUlkID0gbG9hZC5tb2R1bGVJZDtcbiAgICB2YXIgZXh0ID0gZ2V0RXh0KG1vZHVsZUlkKTtcblxuICAgIGlmIChpc090aGVyUmVzb3VyY2UobW9kdWxlSWQpKSB7XG4gICAgICBtb2R1bGVJZCA9IHJlbW92ZUV4dChtb2R1bGVJZCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGF1cmVsaWEubG9hZGVyLm5vcm1hbGl6ZShtb2R1bGVJZCwgbG9hZC5yZWxhdGl2ZVRvKS50aGVuKGZ1bmN0aW9uIChub3JtYWxpemVkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBuYW1lOiBsb2FkLm1vZHVsZUlkLFxuICAgICAgICBpbXBvcnRJZDogaXNPdGhlclJlc291cmNlKGxvYWQubW9kdWxlSWQpID8gYWRkT3JpZ2luYWxFeHQobm9ybWFsaXplZCwgZXh0KSA6IG5vcm1hbGl6ZWRcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBpc090aGVyUmVzb3VyY2UobmFtZSkge1xuICAgIHZhciBleHQgPSBnZXRFeHQobmFtZSk7XG4gICAgaWYgKCFleHQpIHJldHVybiBmYWxzZTtcbiAgICBpZiAoZXh0ID09PSAnJykgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChleHQgPT09ICcuanMnIHx8IGV4dCA9PT0gJy50cycpIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbW92ZUV4dChuYW1lKSB7XG4gICAgcmV0dXJuIG5hbWUucmVwbGFjZShleHRQYXR0ZXJuLCAnJyk7XG4gIH1cblxuICBmdW5jdGlvbiBhZGRPcmlnaW5hbEV4dChub3JtYWxpemVkLCBleHQpIHtcbiAgICByZXR1cm4gcmVtb3ZlRXh0KG5vcm1hbGl6ZWQpICsgJy4nICsgZXh0O1xuICB9XG59XG5cbmZ1bmN0aW9uIGdldEV4dChuYW1lKSB7XG4gIHZhciBtYXRjaCA9IG5hbWUubWF0Y2goZXh0UGF0dGVybik7XG4gIGlmIChtYXRjaCAmJiBtYXRjaC5sZW5ndGggPiAwKSB7XG4gICAgcmV0dXJuIG1hdGNoWzBdLnNwbGl0KCcuJylbMV07XG4gIH1cbn1cblxuZnVuY3Rpb24gYXNzZXJ0UHJvY2Vzc2VkKHBsdWdpbnMpIHtcbiAgaWYgKHBsdWdpbnMucHJvY2Vzc2VkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIGNvbmZpZyBpbnN0YW5jZSBoYXMgYWxyZWFkeSBiZWVuIGFwcGxpZWQuIFRvIGxvYWQgbW9yZSBwbHVnaW5zIG9yIGdsb2JhbCByZXNvdXJjZXMsIGNyZWF0ZSBhIG5ldyBGcmFtZXdvcmtDb25maWd1cmF0aW9uIGluc3RhbmNlLicpO1xuICB9XG59XG5cbnZhciBGcmFtZXdvcmtDb25maWd1cmF0aW9uID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBGcmFtZXdvcmtDb25maWd1cmF0aW9uKGF1cmVsaWEpIHtcbiAgICB2YXIgX3RoaXM0ID0gdGhpcztcblxuXG5cbiAgICB0aGlzLmF1cmVsaWEgPSBhdXJlbGlhO1xuICAgIHRoaXMuY29udGFpbmVyID0gYXVyZWxpYS5jb250YWluZXI7XG4gICAgdGhpcy5pbmZvID0gW107XG4gICAgdGhpcy5wcm9jZXNzZWQgPSBmYWxzZTtcbiAgICB0aGlzLnByZVRhc2tzID0gW107XG4gICAgdGhpcy5wb3N0VGFza3MgPSBbXTtcbiAgICB0aGlzLnJlc291cmNlc1RvTG9hZCA9IHt9O1xuICAgIHRoaXMucHJlVGFzayhmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gYXVyZWxpYS5sb2FkZXIubm9ybWFsaXplKCdhdXJlbGlhLWJvb3RzdHJhcHBlcicpLnRoZW4oZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzNC5ib290c3RyYXBwZXJOYW1lID0gbmFtZTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIHRoaXMucG9zdFRhc2soZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIGxvYWRSZXNvdXJjZXMoYXVyZWxpYSwgX3RoaXM0LnJlc291cmNlc1RvTG9hZCwgYXVyZWxpYS5yZXNvdXJjZXMpO1xuICAgIH0pO1xuICB9XG5cbiAgRnJhbWV3b3JrQ29uZmlndXJhdGlvbi5wcm90b3R5cGUuaW5zdGFuY2UgPSBmdW5jdGlvbiBpbnN0YW5jZSh0eXBlLCBfaW5zdGFuY2UpIHtcbiAgICB0aGlzLmNvbnRhaW5lci5yZWdpc3Rlckluc3RhbmNlKHR5cGUsIF9pbnN0YW5jZSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgRnJhbWV3b3JrQ29uZmlndXJhdGlvbi5wcm90b3R5cGUuc2luZ2xldG9uID0gZnVuY3Rpb24gc2luZ2xldG9uKHR5cGUsIGltcGxlbWVudGF0aW9uKSB7XG4gICAgdGhpcy5jb250YWluZXIucmVnaXN0ZXJTaW5nbGV0b24odHlwZSwgaW1wbGVtZW50YXRpb24pO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEZyYW1ld29ya0NvbmZpZ3VyYXRpb24ucHJvdG90eXBlLnRyYW5zaWVudCA9IGZ1bmN0aW9uIHRyYW5zaWVudCh0eXBlLCBpbXBsZW1lbnRhdGlvbikge1xuICAgIHRoaXMuY29udGFpbmVyLnJlZ2lzdGVyVHJhbnNpZW50KHR5cGUsIGltcGxlbWVudGF0aW9uKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBGcmFtZXdvcmtDb25maWd1cmF0aW9uLnByb3RvdHlwZS5wcmVUYXNrID0gZnVuY3Rpb24gcHJlVGFzayh0YXNrKSB7XG4gICAgYXNzZXJ0UHJvY2Vzc2VkKHRoaXMpO1xuICAgIHRoaXMucHJlVGFza3MucHVzaCh0YXNrKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBGcmFtZXdvcmtDb25maWd1cmF0aW9uLnByb3RvdHlwZS5wb3N0VGFzayA9IGZ1bmN0aW9uIHBvc3RUYXNrKHRhc2spIHtcbiAgICBhc3NlcnRQcm9jZXNzZWQodGhpcyk7XG4gICAgdGhpcy5wb3N0VGFza3MucHVzaCh0YXNrKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBGcmFtZXdvcmtDb25maWd1cmF0aW9uLnByb3RvdHlwZS5mZWF0dXJlID0gZnVuY3Rpb24gZmVhdHVyZShwbHVnaW4sIGNvbmZpZykge1xuICAgIGlmIChnZXRFeHQocGx1Z2luKSkge1xuICAgICAgcmV0dXJuIHRoaXMucGx1Z2luKHsgbW9kdWxlSWQ6IHBsdWdpbiwgcmVzb3VyY2VzUmVsYXRpdmVUbzogW3BsdWdpbiwgJyddLCBjb25maWc6IGNvbmZpZyB8fCB7fSB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5wbHVnaW4oeyBtb2R1bGVJZDogcGx1Z2luICsgJy9pbmRleCcsIHJlc291cmNlc1JlbGF0aXZlVG86IFtwbHVnaW4sICcnXSwgY29uZmlnOiBjb25maWcgfHwge30gfSk7XG4gIH07XG5cbiAgRnJhbWV3b3JrQ29uZmlndXJhdGlvbi5wcm90b3R5cGUuZ2xvYmFsUmVzb3VyY2VzID0gZnVuY3Rpb24gZ2xvYmFsUmVzb3VyY2VzKHJlc291cmNlcykge1xuICAgIGFzc2VydFByb2Nlc3NlZCh0aGlzKTtcblxuICAgIHZhciB0b0FkZCA9IEFycmF5LmlzQXJyYXkocmVzb3VyY2VzKSA/IHJlc291cmNlcyA6IGFyZ3VtZW50cztcbiAgICB2YXIgcmVzb3VyY2UgPSB2b2lkIDA7XG4gICAgdmFyIHBhdGggPSB2b2lkIDA7XG4gICAgdmFyIHJlc291cmNlc1JlbGF0aXZlVG8gPSB0aGlzLnJlc291cmNlc1JlbGF0aXZlVG8gfHwgWycnLCAnJ107XG5cbiAgICBmb3IgKHZhciBpID0gMCwgaWkgPSB0b0FkZC5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICByZXNvdXJjZSA9IHRvQWRkW2ldO1xuICAgICAgaWYgKHR5cGVvZiByZXNvdXJjZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHJlc291cmNlIHBhdGggWycgKyByZXNvdXJjZSArICddLiBSZXNvdXJjZXMgbXVzdCBiZSBzcGVjaWZpZWQgYXMgcmVsYXRpdmUgbW9kdWxlIElEcy4nKTtcbiAgICAgIH1cblxuICAgICAgdmFyIHBhcmVudCA9IHJlc291cmNlc1JlbGF0aXZlVG9bMF07XG4gICAgICB2YXIgZ3JhbmRQYXJlbnQgPSByZXNvdXJjZXNSZWxhdGl2ZVRvWzFdO1xuICAgICAgdmFyIG5hbWUgPSByZXNvdXJjZTtcblxuICAgICAgaWYgKChyZXNvdXJjZS5zdGFydHNXaXRoKCcuLycpIHx8IHJlc291cmNlLnN0YXJ0c1dpdGgoJy4uLycpKSAmJiBwYXJlbnQgIT09ICcnKSB7XG4gICAgICAgIG5hbWUgPSAoMCwgX2F1cmVsaWFQYXRoLmpvaW4pKHBhcmVudCwgcmVzb3VyY2UpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnJlc291cmNlc1RvTG9hZFtuYW1lXSA9IHsgbW9kdWxlSWQ6IG5hbWUsIHJlbGF0aXZlVG86IGdyYW5kUGFyZW50IH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgRnJhbWV3b3JrQ29uZmlndXJhdGlvbi5wcm90b3R5cGUuZ2xvYmFsTmFtZSA9IGZ1bmN0aW9uIGdsb2JhbE5hbWUocmVzb3VyY2VQYXRoLCBuZXdOYW1lKSB7XG4gICAgYXNzZXJ0UHJvY2Vzc2VkKHRoaXMpO1xuICAgIHRoaXMucmVzb3VyY2VzVG9Mb2FkW3Jlc291cmNlUGF0aF0gPSB7IG1vZHVsZUlkOiBuZXdOYW1lLCByZWxhdGl2ZVRvOiAnJyB9O1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEZyYW1ld29ya0NvbmZpZ3VyYXRpb24ucHJvdG90eXBlLnBsdWdpbiA9IGZ1bmN0aW9uIHBsdWdpbihfcGx1Z2luLCBjb25maWcpIHtcbiAgICBhc3NlcnRQcm9jZXNzZWQodGhpcyk7XG5cbiAgICBpZiAodHlwZW9mIF9wbHVnaW4gPT09ICdzdHJpbmcnKSB7XG4gICAgICByZXR1cm4gdGhpcy5wbHVnaW4oeyBtb2R1bGVJZDogX3BsdWdpbiwgcmVzb3VyY2VzUmVsYXRpdmVUbzogW19wbHVnaW4sICcnXSwgY29uZmlnOiBjb25maWcgfHwge30gfSk7XG4gICAgfVxuXG4gICAgdGhpcy5pbmZvLnB1c2goX3BsdWdpbik7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgRnJhbWV3b3JrQ29uZmlndXJhdGlvbi5wcm90b3R5cGUuX2FkZE5vcm1hbGl6ZWRQbHVnaW4gPSBmdW5jdGlvbiBfYWRkTm9ybWFsaXplZFBsdWdpbihuYW1lLCBjb25maWcpIHtcbiAgICB2YXIgX3RoaXM1ID0gdGhpcztcblxuICAgIHZhciBwbHVnaW4gPSB7IG1vZHVsZUlkOiBuYW1lLCByZXNvdXJjZXNSZWxhdGl2ZVRvOiBbbmFtZSwgJyddLCBjb25maWc6IGNvbmZpZyB8fCB7fSB9O1xuICAgIHRoaXMucGx1Z2luKHBsdWdpbik7XG5cbiAgICB0aGlzLnByZVRhc2soZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHJlbGF0aXZlVG8gPSBbbmFtZSwgX3RoaXM1LmJvb3RzdHJhcHBlck5hbWVdO1xuICAgICAgcGx1Z2luLm1vZHVsZUlkID0gbmFtZTtcbiAgICAgIHBsdWdpbi5yZXNvdXJjZXNSZWxhdGl2ZVRvID0gcmVsYXRpdmVUbztcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEZyYW1ld29ya0NvbmZpZ3VyYXRpb24ucHJvdG90eXBlLmRlZmF1bHRCaW5kaW5nTGFuZ3VhZ2UgPSBmdW5jdGlvbiBkZWZhdWx0QmluZGluZ0xhbmd1YWdlKCkge1xuICAgIHJldHVybiB0aGlzLl9hZGROb3JtYWxpemVkUGx1Z2luKCdhdXJlbGlhLXRlbXBsYXRpbmctYmluZGluZycpO1xuICB9O1xuXG4gIEZyYW1ld29ya0NvbmZpZ3VyYXRpb24ucHJvdG90eXBlLnJvdXRlciA9IGZ1bmN0aW9uIHJvdXRlcigpIHtcbiAgICByZXR1cm4gdGhpcy5fYWRkTm9ybWFsaXplZFBsdWdpbignYXVyZWxpYS10ZW1wbGF0aW5nLXJvdXRlcicpO1xuICB9O1xuXG4gIEZyYW1ld29ya0NvbmZpZ3VyYXRpb24ucHJvdG90eXBlLmhpc3RvcnkgPSBmdW5jdGlvbiBoaXN0b3J5KCkge1xuICAgIHJldHVybiB0aGlzLl9hZGROb3JtYWxpemVkUGx1Z2luKCdhdXJlbGlhLWhpc3RvcnktYnJvd3NlcicpO1xuICB9O1xuXG4gIEZyYW1ld29ya0NvbmZpZ3VyYXRpb24ucHJvdG90eXBlLmRlZmF1bHRSZXNvdXJjZXMgPSBmdW5jdGlvbiBkZWZhdWx0UmVzb3VyY2VzKCkge1xuICAgIHJldHVybiB0aGlzLl9hZGROb3JtYWxpemVkUGx1Z2luKCdhdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzJyk7XG4gIH07XG5cbiAgRnJhbWV3b3JrQ29uZmlndXJhdGlvbi5wcm90b3R5cGUuZXZlbnRBZ2dyZWdhdG9yID0gZnVuY3Rpb24gZXZlbnRBZ2dyZWdhdG9yKCkge1xuICAgIHJldHVybiB0aGlzLl9hZGROb3JtYWxpemVkUGx1Z2luKCdhdXJlbGlhLWV2ZW50LWFnZ3JlZ2F0b3InKTtcbiAgfTtcblxuICBGcmFtZXdvcmtDb25maWd1cmF0aW9uLnByb3RvdHlwZS5iYXNpY0NvbmZpZ3VyYXRpb24gPSBmdW5jdGlvbiBiYXNpY0NvbmZpZ3VyYXRpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZGVmYXVsdEJpbmRpbmdMYW5ndWFnZSgpLmRlZmF1bHRSZXNvdXJjZXMoKS5ldmVudEFnZ3JlZ2F0b3IoKTtcbiAgfTtcblxuICBGcmFtZXdvcmtDb25maWd1cmF0aW9uLnByb3RvdHlwZS5zdGFuZGFyZENvbmZpZ3VyYXRpb24gPSBmdW5jdGlvbiBzdGFuZGFyZENvbmZpZ3VyYXRpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuYmFzaWNDb25maWd1cmF0aW9uKCkuaGlzdG9yeSgpLnJvdXRlcigpO1xuICB9O1xuXG4gIEZyYW1ld29ya0NvbmZpZ3VyYXRpb24ucHJvdG90eXBlLmRldmVsb3BtZW50TG9nZ2luZyA9IGZ1bmN0aW9uIGRldmVsb3BtZW50TG9nZ2luZygpIHtcbiAgICB2YXIgX3RoaXM2ID0gdGhpcztcblxuICAgIHRoaXMucHJlVGFzayhmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gX3RoaXM2LmF1cmVsaWEubG9hZGVyLm5vcm1hbGl6ZSgnYXVyZWxpYS1sb2dnaW5nLWNvbnNvbGUnLCBfdGhpczYuYm9vdHN0cmFwcGVyTmFtZSkudGhlbihmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICByZXR1cm4gX3RoaXM2LmF1cmVsaWEubG9hZGVyLmxvYWRNb2R1bGUobmFtZSkudGhlbihmdW5jdGlvbiAobSkge1xuICAgICAgICAgIFRoZUxvZ01hbmFnZXIuYWRkQXBwZW5kZXIobmV3IG0uQ29uc29sZUFwcGVuZGVyKCkpO1xuICAgICAgICAgIFRoZUxvZ01hbmFnZXIuc2V0TGV2ZWwoVGhlTG9nTWFuYWdlci5sb2dMZXZlbC5kZWJ1Zyk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBGcmFtZXdvcmtDb25maWd1cmF0aW9uLnByb3RvdHlwZS5hcHBseSA9IGZ1bmN0aW9uIGFwcGx5KCkge1xuICAgIHZhciBfdGhpczcgPSB0aGlzO1xuXG4gICAgaWYgKHRoaXMucHJvY2Vzc2VkKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJ1blRhc2tzKHRoaXMsIHRoaXMucHJlVGFza3MpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGxvYWRlciA9IF90aGlzNy5hdXJlbGlhLmxvYWRlcjtcbiAgICAgIHZhciBpbmZvID0gX3RoaXM3LmluZm87XG4gICAgICB2YXIgY3VycmVudCA9IHZvaWQgMDtcblxuICAgICAgdmFyIG5leHQgPSBmdW5jdGlvbiBuZXh0KCkge1xuICAgICAgICBpZiAoY3VycmVudCA9IGluZm8uc2hpZnQoKSkge1xuICAgICAgICAgIHJldHVybiBsb2FkUGx1Z2luKF90aGlzNywgbG9hZGVyLCBjdXJyZW50KS50aGVuKG5leHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgX3RoaXM3LnByb2Nlc3NlZCA9IHRydWU7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBuZXh0KCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBydW5UYXNrcyhfdGhpczcsIF90aGlzNy5wb3N0VGFza3MpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG5cbiAgcmV0dXJuIEZyYW1ld29ya0NvbmZpZ3VyYXRpb247XG59KCk7XG5cbmV4cG9ydHMuRnJhbWV3b3JrQ29uZmlndXJhdGlvbiA9IEZyYW1ld29ya0NvbmZpZ3VyYXRpb247XG52YXIgTG9nTWFuYWdlciA9IGV4cG9ydHMuTG9nTWFuYWdlciA9IFRoZUxvZ01hbmFnZXI7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS1mcmFtZXdvcmsvZGlzdC9jb21tb25qcy9hdXJlbGlhLWZyYW1ld29yay5qc1xuLy8gbW9kdWxlIGlkID0gMjRcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuXG5cblxuZnVuY3Rpb24gbWkobmFtZSkge1xuICB0aHJvdyBuZXcgRXJyb3IoJ0hpc3RvcnkgbXVzdCBpbXBsZW1lbnQgJyArIG5hbWUgKyAnKCkuJyk7XG59XG5cbnZhciBIaXN0b3J5ID0gZXhwb3J0cy5IaXN0b3J5ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBIaXN0b3J5KCkge1xuICAgIFxuICB9XG5cbiAgSGlzdG9yeS5wcm90b3R5cGUuYWN0aXZhdGUgPSBmdW5jdGlvbiBhY3RpdmF0ZShvcHRpb25zKSB7XG4gICAgbWkoJ2FjdGl2YXRlJyk7XG4gIH07XG5cbiAgSGlzdG9yeS5wcm90b3R5cGUuZGVhY3RpdmF0ZSA9IGZ1bmN0aW9uIGRlYWN0aXZhdGUoKSB7XG4gICAgbWkoJ2RlYWN0aXZhdGUnKTtcbiAgfTtcblxuICBIaXN0b3J5LnByb3RvdHlwZS5nZXRBYnNvbHV0ZVJvb3QgPSBmdW5jdGlvbiBnZXRBYnNvbHV0ZVJvb3QoKSB7XG4gICAgbWkoJ2dldEFic29sdXRlUm9vdCcpO1xuICB9O1xuXG4gIEhpc3RvcnkucHJvdG90eXBlLm5hdmlnYXRlID0gZnVuY3Rpb24gbmF2aWdhdGUoZnJhZ21lbnQsIG9wdGlvbnMpIHtcbiAgICBtaSgnbmF2aWdhdGUnKTtcbiAgfTtcblxuICBIaXN0b3J5LnByb3RvdHlwZS5uYXZpZ2F0ZUJhY2sgPSBmdW5jdGlvbiBuYXZpZ2F0ZUJhY2soKSB7XG4gICAgbWkoJ25hdmlnYXRlQmFjaycpO1xuICB9O1xuXG4gIEhpc3RvcnkucHJvdG90eXBlLnNldFRpdGxlID0gZnVuY3Rpb24gc2V0VGl0bGUodGl0bGUpIHtcbiAgICBtaSgnc2V0VGl0bGUnKTtcbiAgfTtcblxuICByZXR1cm4gSGlzdG9yeTtcbn0oKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS1oaXN0b3J5L2Rpc3QvY29tbW9uanMvYXVyZWxpYS1oaXN0b3J5LmpzXG4vLyBtb2R1bGUgaWQgPSAyNVxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLldlYnBhY2tMb2FkZXIgPSBleHBvcnRzLlRleHRUZW1wbGF0ZUxvYWRlciA9IHVuZGVmaW5lZDtcblxudmFyIF9hdXJlbGlhTWV0YWRhdGEgPSByZXF1aXJlKCdhdXJlbGlhLW1ldGFkYXRhJyk7XG5cbnZhciBfYXVyZWxpYUxvYWRlciA9IHJlcXVpcmUoJ2F1cmVsaWEtbG9hZGVyJyk7XG5cbnZhciBfYXVyZWxpYVBhbCA9IHJlcXVpcmUoJ2F1cmVsaWEtcGFsJyk7XG5cbmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKCFzZWxmKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcihcInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZFwiKTsgfSByZXR1cm4gY2FsbCAmJiAodHlwZW9mIGNhbGwgPT09IFwib2JqZWN0XCIgfHwgdHlwZW9mIGNhbGwgPT09IFwiZnVuY3Rpb25cIikgPyBjYWxsIDogc2VsZjsgfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSBcImZ1bmN0aW9uXCIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCBcIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH1cblxuXG5cbnZhciBUZXh0VGVtcGxhdGVMb2FkZXIgPSBleHBvcnRzLlRleHRUZW1wbGF0ZUxvYWRlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gVGV4dFRlbXBsYXRlTG9hZGVyKCkge1xuICAgIFxuICB9XG5cbiAgVGV4dFRlbXBsYXRlTG9hZGVyLnByb3RvdHlwZS5sb2FkVGVtcGxhdGUgPSBmdW5jdGlvbiBsb2FkVGVtcGxhdGUobG9hZGVyLCBlbnRyeSkge1xuICAgIHJldHVybiBsb2FkZXIubG9hZFRleHQoZW50cnkuYWRkcmVzcykudGhlbihmdW5jdGlvbiAodGV4dCkge1xuICAgICAgZW50cnkudGVtcGxhdGUgPSBfYXVyZWxpYVBhbC5ET00uY3JlYXRlVGVtcGxhdGVGcm9tTWFya3VwKHRleHQpO1xuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiBUZXh0VGVtcGxhdGVMb2FkZXI7XG59KCk7XG5cbmZ1bmN0aW9uIGVuc3VyZU9yaWdpbk9uRXhwb3J0cyhleGVjdXRlZCwgbmFtZSkge1xuICB2YXIgdGFyZ2V0ID0gZXhlY3V0ZWQ7XG4gIHZhciBrZXkgPSB2b2lkIDA7XG4gIHZhciBleHBvcnRlZFZhbHVlID0gdm9pZCAwO1xuXG4gIGlmICh0YXJnZXQuX191c2VEZWZhdWx0KSB7XG4gICAgdGFyZ2V0ID0gdGFyZ2V0LmRlZmF1bHQ7XG4gIH1cblxuICBfYXVyZWxpYU1ldGFkYXRhLk9yaWdpbi5zZXQodGFyZ2V0LCBuZXcgX2F1cmVsaWFNZXRhZGF0YS5PcmlnaW4obmFtZSwgJ2RlZmF1bHQnKSk7XG5cbiAgZm9yIChrZXkgaW4gdGFyZ2V0KSB7XG4gICAgZXhwb3J0ZWRWYWx1ZSA9IHRhcmdldFtrZXldO1xuXG4gICAgaWYgKHR5cGVvZiBleHBvcnRlZFZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBfYXVyZWxpYU1ldGFkYXRhLk9yaWdpbi5zZXQoZXhwb3J0ZWRWYWx1ZSwgbmV3IF9hdXJlbGlhTWV0YWRhdGEuT3JpZ2luKG5hbWUsIGtleSkpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBleGVjdXRlZDtcbn1cblxudmFyIFdlYnBhY2tMb2FkZXIgPSBleHBvcnRzLldlYnBhY2tMb2FkZXIgPSBmdW5jdGlvbiAoX0xvYWRlcikge1xuICBfaW5oZXJpdHMoV2VicGFja0xvYWRlciwgX0xvYWRlcik7XG5cbiAgZnVuY3Rpb24gV2VicGFja0xvYWRlcigpIHtcbiAgICBcblxuICAgIHZhciBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9Mb2FkZXIuY2FsbCh0aGlzKSk7XG5cbiAgICBfdGhpcy5tb2R1bGVSZWdpc3RyeSA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgX3RoaXMubG9hZGVyUGx1Z2lucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgX3RoaXMudXNlVGVtcGxhdGVMb2FkZXIobmV3IFRleHRUZW1wbGF0ZUxvYWRlcigpKTtcblxuICAgIHZhciB0aGF0ID0gX3RoaXM7XG5cbiAgICBfdGhpcy5hZGRQbHVnaW4oJ3RlbXBsYXRlLXJlZ2lzdHJ5LWVudHJ5Jywge1xuICAgICAgJ2ZldGNoJzogZnVuY3Rpb24gZmV0Y2goYWRkcmVzcykge1xuICAgICAgICB2YXIgZW50cnkgPSB0aGF0LmdldE9yQ3JlYXRlVGVtcGxhdGVSZWdpc3RyeUVudHJ5KGFkZHJlc3MpO1xuICAgICAgICByZXR1cm4gZW50cnkudGVtcGxhdGVJc0xvYWRlZCA/IGVudHJ5IDogdGhhdC50ZW1wbGF0ZUxvYWRlci5sb2FkVGVtcGxhdGUodGhhdCwgZW50cnkpLnRoZW4oZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICByZXR1cm4gZW50cnk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgX2F1cmVsaWFQYWwuUExBVEZPUk0uZWFjaE1vZHVsZSA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgdmFyIHJlZ2lzdHJ5ID0gX3RoaXMubW9kdWxlUmVnaXN0cnk7XG5cbiAgICAgIGZvciAodmFyIGtleSBpbiByZWdpc3RyeSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGlmIChjYWxsYmFjayhrZXksIHJlZ2lzdHJ5W2tleV0pKSByZXR1cm47XG4gICAgICAgIH0gY2F0Y2ggKGUpIHt9XG4gICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gX3RoaXM7XG4gIH1cblxuICBXZWJwYWNrTG9hZGVyLnByb3RvdHlwZS5faW1wb3J0ID0gZnVuY3Rpb24gX2ltcG9ydChtb2R1bGVJZCkge1xuICAgIHZhciBfdGhpczIgPSB0aGlzO1xuXG4gICAgdmFyIG1vZHVsZUlkUGFydHMgPSBtb2R1bGVJZC5zcGxpdCgnIScpO1xuICAgIHZhciBwYXRoID0gbW9kdWxlSWRQYXJ0cy5zcGxpY2UobW9kdWxlSWRQYXJ0cy5sZW5ndGggLSAxLCAxKVswXTtcbiAgICB2YXIgbG9hZGVyUGx1Z2luID0gbW9kdWxlSWRQYXJ0cy5sZW5ndGggPT09IDEgPyBtb2R1bGVJZFBhcnRzWzBdIDogbnVsbDtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAobG9hZGVyUGx1Z2luKSB7XG4gICAgICAgICAgcmVzb2x2ZShfdGhpczIubG9hZGVyUGx1Z2luc1tsb2FkZXJQbHVnaW5dLmZldGNoKHBhdGgpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXF1aXJlLmVuc3VyZShbXSwgZnVuY3Rpb24gKHJlcXVpcmUpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSByZXF1aXJlKCdhdXJlbGlhLWxvYWRlci1jb250ZXh0LycgKyBwYXRoKTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcmVzdWx0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgIHJlc3VsdChmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUocmVzKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSwgJ2FwcCcpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJlamVjdChlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICBXZWJwYWNrTG9hZGVyLnByb3RvdHlwZS5tYXAgPSBmdW5jdGlvbiBtYXAoaWQsIHNvdXJjZSkge307XG5cbiAgV2VicGFja0xvYWRlci5wcm90b3R5cGUubm9ybWFsaXplU3luYyA9IGZ1bmN0aW9uIG5vcm1hbGl6ZVN5bmMobW9kdWxlSWQsIHJlbGF0aXZlVG8pIHtcbiAgICByZXR1cm4gbW9kdWxlSWQ7XG4gIH07XG5cbiAgV2VicGFja0xvYWRlci5wcm90b3R5cGUubm9ybWFsaXplID0gZnVuY3Rpb24gbm9ybWFsaXplKG1vZHVsZUlkLCByZWxhdGl2ZVRvKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShtb2R1bGVJZCk7XG4gIH07XG5cbiAgV2VicGFja0xvYWRlci5wcm90b3R5cGUudXNlVGVtcGxhdGVMb2FkZXIgPSBmdW5jdGlvbiB1c2VUZW1wbGF0ZUxvYWRlcih0ZW1wbGF0ZUxvYWRlcikge1xuICAgIHRoaXMudGVtcGxhdGVMb2FkZXIgPSB0ZW1wbGF0ZUxvYWRlcjtcbiAgfTtcblxuICBXZWJwYWNrTG9hZGVyLnByb3RvdHlwZS5sb2FkQWxsTW9kdWxlcyA9IGZ1bmN0aW9uIGxvYWRBbGxNb2R1bGVzKGlkcykge1xuICAgIHZhciBsb2FkcyA9IFtdO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIGlpID0gaWRzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgIGxvYWRzLnB1c2godGhpcy5sb2FkTW9kdWxlKGlkc1tpXSkpO1xuICAgIH1cblxuICAgIHJldHVybiBQcm9taXNlLmFsbChsb2Fkcyk7XG4gIH07XG5cbiAgV2VicGFja0xvYWRlci5wcm90b3R5cGUubG9hZE1vZHVsZSA9IGZ1bmN0aW9uIGxvYWRNb2R1bGUoaWQpIHtcbiAgICB2YXIgX3RoaXMzID0gdGhpcztcblxuICAgIHZhciBleGlzdGluZyA9IHRoaXMubW9kdWxlUmVnaXN0cnlbaWRdO1xuICAgIGlmIChleGlzdGluZykge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShleGlzdGluZyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIF90aGlzMy5faW1wb3J0KGlkKS50aGVuKGZ1bmN0aW9uIChtKSB7XG4gICAgICAgICAgX3RoaXMzLm1vZHVsZVJlZ2lzdHJ5W2lkXSA9IG07XG4gICAgICAgICAgcmVzb2x2ZShlbnN1cmVPcmlnaW5PbkV4cG9ydHMobSwgaWQpKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJlamVjdChlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICBXZWJwYWNrTG9hZGVyLnByb3RvdHlwZS5sb2FkVGVtcGxhdGUgPSBmdW5jdGlvbiBsb2FkVGVtcGxhdGUodXJsKSB7XG4gICAgcmV0dXJuIHRoaXMuX2ltcG9ydCh0aGlzLmFwcGx5UGx1Z2luVG9VcmwodXJsLCAndGVtcGxhdGUtcmVnaXN0cnktZW50cnknKSk7XG4gIH07XG5cbiAgV2VicGFja0xvYWRlci5wcm90b3R5cGUubG9hZFRleHQgPSBmdW5jdGlvbiBsb2FkVGV4dCh1cmwpIHtcbiAgICByZXR1cm4gdGhpcy5faW1wb3J0KHVybCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICBpZiAocmVzdWx0IGluc3RhbmNlb2YgQXJyYXkgJiYgcmVzdWx0WzBdIGluc3RhbmNlb2YgQXJyYXkgJiYgcmVzdWx0Lmhhc093blByb3BlcnR5KCd0b1N0cmluZycpKSB7XG4gICAgICAgIHJldHVybiByZXN1bHQudG9TdHJpbmcoKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9KTtcbiAgfTtcblxuICBXZWJwYWNrTG9hZGVyLnByb3RvdHlwZS5hcHBseVBsdWdpblRvVXJsID0gZnVuY3Rpb24gYXBwbHlQbHVnaW5Ub1VybCh1cmwsIHBsdWdpbk5hbWUpIHtcbiAgICByZXR1cm4gcGx1Z2luTmFtZSArICchJyArIHVybDtcbiAgfTtcblxuICBXZWJwYWNrTG9hZGVyLnByb3RvdHlwZS5hZGRQbHVnaW4gPSBmdW5jdGlvbiBhZGRQbHVnaW4ocGx1Z2luTmFtZSwgaW1wbGVtZW50YXRpb24pIHtcbiAgICB0aGlzLmxvYWRlclBsdWdpbnNbcGx1Z2luTmFtZV0gPSBpbXBsZW1lbnRhdGlvbjtcbiAgfTtcblxuICByZXR1cm4gV2VicGFja0xvYWRlcjtcbn0oX2F1cmVsaWFMb2FkZXIuTG9hZGVyKTtcblxuX2F1cmVsaWFQYWwuUExBVEZPUk0uTG9hZGVyID0gV2VicGFja0xvYWRlcjtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS1sb2FkZXItd2VicGFjay9kaXN0L2NvbW1vbmpzL2F1cmVsaWEtbG9hZGVyLXdlYnBhY2suanNcbi8vIG1vZHVsZSBpZCA9IDI2XG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuUm91dGVSZWNvZ25pemVyID0gZXhwb3J0cy5FcHNpbG9uU2VnbWVudCA9IGV4cG9ydHMuU3RhclNlZ21lbnQgPSBleHBvcnRzLkR5bmFtaWNTZWdtZW50ID0gZXhwb3J0cy5TdGF0aWNTZWdtZW50ID0gZXhwb3J0cy5TdGF0ZSA9IHVuZGVmaW5lZDtcblxudmFyIF9hdXJlbGlhUGF0aCA9IHJlcXVpcmUoJ2F1cmVsaWEtcGF0aCcpO1xuXG5cblxudmFyIFN0YXRlID0gZXhwb3J0cy5TdGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gU3RhdGUoY2hhclNwZWMpIHtcbiAgICBcblxuICAgIHRoaXMuY2hhclNwZWMgPSBjaGFyU3BlYztcbiAgICB0aGlzLm5leHRTdGF0ZXMgPSBbXTtcbiAgfVxuXG4gIFN0YXRlLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiBnZXQoY2hhclNwZWMpIHtcbiAgICBmb3IgKHZhciBfaXRlcmF0b3IgPSB0aGlzLm5leHRTdGF0ZXMsIF9pc0FycmF5ID0gQXJyYXkuaXNBcnJheShfaXRlcmF0b3IpLCBfaSA9IDAsIF9pdGVyYXRvciA9IF9pc0FycmF5ID8gX2l0ZXJhdG9yIDogX2l0ZXJhdG9yW1N5bWJvbC5pdGVyYXRvcl0oKTs7KSB7XG4gICAgICB2YXIgX3JlZjtcblxuICAgICAgaWYgKF9pc0FycmF5KSB7XG4gICAgICAgIGlmIChfaSA+PSBfaXRlcmF0b3IubGVuZ3RoKSBicmVhaztcbiAgICAgICAgX3JlZiA9IF9pdGVyYXRvcltfaSsrXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9pID0gX2l0ZXJhdG9yLm5leHQoKTtcbiAgICAgICAgaWYgKF9pLmRvbmUpIGJyZWFrO1xuICAgICAgICBfcmVmID0gX2kudmFsdWU7XG4gICAgICB9XG5cbiAgICAgIHZhciBjaGlsZCA9IF9yZWY7XG5cbiAgICAgIHZhciBpc0VxdWFsID0gY2hpbGQuY2hhclNwZWMudmFsaWRDaGFycyA9PT0gY2hhclNwZWMudmFsaWRDaGFycyAmJiBjaGlsZC5jaGFyU3BlYy5pbnZhbGlkQ2hhcnMgPT09IGNoYXJTcGVjLmludmFsaWRDaGFycztcblxuICAgICAgaWYgKGlzRXF1YWwpIHtcbiAgICAgICAgcmV0dXJuIGNoaWxkO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH07XG5cbiAgU3RhdGUucHJvdG90eXBlLnB1dCA9IGZ1bmN0aW9uIHB1dChjaGFyU3BlYykge1xuICAgIHZhciBzdGF0ZSA9IHRoaXMuZ2V0KGNoYXJTcGVjKTtcblxuICAgIGlmIChzdGF0ZSkge1xuICAgICAgcmV0dXJuIHN0YXRlO1xuICAgIH1cblxuICAgIHN0YXRlID0gbmV3IFN0YXRlKGNoYXJTcGVjKTtcblxuICAgIHRoaXMubmV4dFN0YXRlcy5wdXNoKHN0YXRlKTtcblxuICAgIGlmIChjaGFyU3BlYy5yZXBlYXQpIHtcbiAgICAgIHN0YXRlLm5leHRTdGF0ZXMucHVzaChzdGF0ZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0YXRlO1xuICB9O1xuXG4gIFN0YXRlLnByb3RvdHlwZS5tYXRjaCA9IGZ1bmN0aW9uIG1hdGNoKGNoKSB7XG4gICAgdmFyIG5leHRTdGF0ZXMgPSB0aGlzLm5leHRTdGF0ZXM7XG4gICAgdmFyIHJlc3VsdHMgPSBbXTtcblxuICAgIGZvciAodmFyIGkgPSAwLCBsID0gbmV4dFN0YXRlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgIHZhciBjaGlsZCA9IG5leHRTdGF0ZXNbaV07XG4gICAgICB2YXIgY2hhclNwZWMgPSBjaGlsZC5jaGFyU3BlYztcblxuICAgICAgaWYgKGNoYXJTcGVjLnZhbGlkQ2hhcnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAoY2hhclNwZWMudmFsaWRDaGFycy5pbmRleE9mKGNoKSAhPT0gLTEpIHtcbiAgICAgICAgICByZXN1bHRzLnB1c2goY2hpbGQpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGNoYXJTcGVjLmludmFsaWRDaGFycyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlmIChjaGFyU3BlYy5pbnZhbGlkQ2hhcnMuaW5kZXhPZihjaCkgPT09IC0xKSB7XG4gICAgICAgICAgcmVzdWx0cy5wdXNoKGNoaWxkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHRzO1xuICB9O1xuXG4gIHJldHVybiBTdGF0ZTtcbn0oKTtcblxudmFyIHNwZWNpYWxzID0gWycvJywgJy4nLCAnKicsICcrJywgJz8nLCAnfCcsICcoJywgJyknLCAnWycsICddJywgJ3snLCAnfScsICdcXFxcJ107XG5cbnZhciBlc2NhcGVSZWdleCA9IG5ldyBSZWdFeHAoJyhcXFxcJyArIHNwZWNpYWxzLmpvaW4oJ3xcXFxcJykgKyAnKScsICdnJyk7XG5cbnZhciBTdGF0aWNTZWdtZW50ID0gZXhwb3J0cy5TdGF0aWNTZWdtZW50ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBTdGF0aWNTZWdtZW50KHN0cmluZywgY2FzZVNlbnNpdGl2ZSkge1xuICAgIFxuXG4gICAgdGhpcy5zdHJpbmcgPSBzdHJpbmc7XG4gICAgdGhpcy5jYXNlU2Vuc2l0aXZlID0gY2FzZVNlbnNpdGl2ZTtcbiAgfVxuXG4gIFN0YXRpY1NlZ21lbnQucHJvdG90eXBlLmVhY2hDaGFyID0gZnVuY3Rpb24gZWFjaENoYXIoY2FsbGJhY2spIHtcbiAgICB2YXIgcyA9IHRoaXMuc3RyaW5nO1xuICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgdmFyIGNoID0gc1tpXTtcbiAgICAgIGNhbGxiYWNrKHsgdmFsaWRDaGFyczogdGhpcy5jYXNlU2Vuc2l0aXZlID8gY2ggOiBjaC50b1VwcGVyQ2FzZSgpICsgY2gudG9Mb3dlckNhc2UoKSB9KTtcbiAgICB9XG4gIH07XG5cbiAgU3RhdGljU2VnbWVudC5wcm90b3R5cGUucmVnZXggPSBmdW5jdGlvbiByZWdleCgpIHtcbiAgICByZXR1cm4gdGhpcy5zdHJpbmcucmVwbGFjZShlc2NhcGVSZWdleCwgJ1xcXFwkMScpO1xuICB9O1xuXG4gIFN0YXRpY1NlZ21lbnQucHJvdG90eXBlLmdlbmVyYXRlID0gZnVuY3Rpb24gZ2VuZXJhdGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaW5nO1xuICB9O1xuXG4gIHJldHVybiBTdGF0aWNTZWdtZW50O1xufSgpO1xuXG52YXIgRHluYW1pY1NlZ21lbnQgPSBleHBvcnRzLkR5bmFtaWNTZWdtZW50ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBEeW5hbWljU2VnbWVudChuYW1lKSB7XG4gICAgXG5cbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICB9XG5cbiAgRHluYW1pY1NlZ21lbnQucHJvdG90eXBlLmVhY2hDaGFyID0gZnVuY3Rpb24gZWFjaENoYXIoY2FsbGJhY2spIHtcbiAgICBjYWxsYmFjayh7IGludmFsaWRDaGFyczogJy8nLCByZXBlYXQ6IHRydWUgfSk7XG4gIH07XG5cbiAgRHluYW1pY1NlZ21lbnQucHJvdG90eXBlLnJlZ2V4ID0gZnVuY3Rpb24gcmVnZXgoKSB7XG4gICAgcmV0dXJuICcoW14vXSspJztcbiAgfTtcblxuICBEeW5hbWljU2VnbWVudC5wcm90b3R5cGUuZ2VuZXJhdGUgPSBmdW5jdGlvbiBnZW5lcmF0ZShwYXJhbXMsIGNvbnN1bWVkKSB7XG4gICAgY29uc3VtZWRbdGhpcy5uYW1lXSA9IHRydWU7XG4gICAgcmV0dXJuIHBhcmFtc1t0aGlzLm5hbWVdO1xuICB9O1xuXG4gIHJldHVybiBEeW5hbWljU2VnbWVudDtcbn0oKTtcblxudmFyIFN0YXJTZWdtZW50ID0gZXhwb3J0cy5TdGFyU2VnbWVudCA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gU3RhclNlZ21lbnQobmFtZSkge1xuICAgIFxuXG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgfVxuXG4gIFN0YXJTZWdtZW50LnByb3RvdHlwZS5lYWNoQ2hhciA9IGZ1bmN0aW9uIGVhY2hDaGFyKGNhbGxiYWNrKSB7XG4gICAgY2FsbGJhY2soeyBpbnZhbGlkQ2hhcnM6ICcnLCByZXBlYXQ6IHRydWUgfSk7XG4gIH07XG5cbiAgU3RhclNlZ21lbnQucHJvdG90eXBlLnJlZ2V4ID0gZnVuY3Rpb24gcmVnZXgoKSB7XG4gICAgcmV0dXJuICcoLispJztcbiAgfTtcblxuICBTdGFyU2VnbWVudC5wcm90b3R5cGUuZ2VuZXJhdGUgPSBmdW5jdGlvbiBnZW5lcmF0ZShwYXJhbXMsIGNvbnN1bWVkKSB7XG4gICAgY29uc3VtZWRbdGhpcy5uYW1lXSA9IHRydWU7XG4gICAgcmV0dXJuIHBhcmFtc1t0aGlzLm5hbWVdO1xuICB9O1xuXG4gIHJldHVybiBTdGFyU2VnbWVudDtcbn0oKTtcblxudmFyIEVwc2lsb25TZWdtZW50ID0gZXhwb3J0cy5FcHNpbG9uU2VnbWVudCA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gRXBzaWxvblNlZ21lbnQoKSB7XG4gICAgXG4gIH1cblxuICBFcHNpbG9uU2VnbWVudC5wcm90b3R5cGUuZWFjaENoYXIgPSBmdW5jdGlvbiBlYWNoQ2hhcigpIHt9O1xuXG4gIEVwc2lsb25TZWdtZW50LnByb3RvdHlwZS5yZWdleCA9IGZ1bmN0aW9uIHJlZ2V4KCkge1xuICAgIHJldHVybiAnJztcbiAgfTtcblxuICBFcHNpbG9uU2VnbWVudC5wcm90b3R5cGUuZ2VuZXJhdGUgPSBmdW5jdGlvbiBnZW5lcmF0ZSgpIHtcbiAgICByZXR1cm4gJyc7XG4gIH07XG5cbiAgcmV0dXJuIEVwc2lsb25TZWdtZW50O1xufSgpO1xuXG52YXIgUm91dGVSZWNvZ25pemVyID0gZXhwb3J0cy5Sb3V0ZVJlY29nbml6ZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFJvdXRlUmVjb2duaXplcigpIHtcbiAgICBcblxuICAgIHRoaXMucm9vdFN0YXRlID0gbmV3IFN0YXRlKCk7XG4gICAgdGhpcy5uYW1lcyA9IHt9O1xuICB9XG5cbiAgUm91dGVSZWNvZ25pemVyLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiBhZGQocm91dGUpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkocm91dGUpKSB7XG4gICAgICByb3V0ZS5mb3JFYWNoKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgIHJldHVybiBfdGhpcy5hZGQocik7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgdmFyIGN1cnJlbnRTdGF0ZSA9IHRoaXMucm9vdFN0YXRlO1xuICAgIHZhciByZWdleCA9ICdeJztcbiAgICB2YXIgdHlwZXMgPSB7IHN0YXRpY3M6IDAsIGR5bmFtaWNzOiAwLCBzdGFyczogMCB9O1xuICAgIHZhciBuYW1lcyA9IFtdO1xuICAgIHZhciByb3V0ZU5hbWUgPSByb3V0ZS5oYW5kbGVyLm5hbWU7XG4gICAgdmFyIGlzRW1wdHkgPSB0cnVlO1xuICAgIHZhciBzZWdtZW50cyA9IHBhcnNlKHJvdXRlLnBhdGgsIG5hbWVzLCB0eXBlcywgcm91dGUuY2FzZVNlbnNpdGl2ZSk7XG5cbiAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBzZWdtZW50cy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7XG4gICAgICB2YXIgc2VnbWVudCA9IHNlZ21lbnRzW2ldO1xuICAgICAgaWYgKHNlZ21lbnQgaW5zdGFuY2VvZiBFcHNpbG9uU2VnbWVudCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgaXNFbXB0eSA9IGZhbHNlO1xuXG4gICAgICBjdXJyZW50U3RhdGUgPSBjdXJyZW50U3RhdGUucHV0KHsgdmFsaWRDaGFyczogJy8nIH0pO1xuICAgICAgcmVnZXggKz0gJy8nO1xuXG4gICAgICBjdXJyZW50U3RhdGUgPSBhZGRTZWdtZW50KGN1cnJlbnRTdGF0ZSwgc2VnbWVudCk7XG4gICAgICByZWdleCArPSBzZWdtZW50LnJlZ2V4KCk7XG4gICAgfVxuXG4gICAgaWYgKGlzRW1wdHkpIHtcbiAgICAgIGN1cnJlbnRTdGF0ZSA9IGN1cnJlbnRTdGF0ZS5wdXQoeyB2YWxpZENoYXJzOiAnLycgfSk7XG4gICAgICByZWdleCArPSAnLyc7XG4gICAgfVxuXG4gICAgdmFyIGhhbmRsZXJzID0gW3sgaGFuZGxlcjogcm91dGUuaGFuZGxlciwgbmFtZXM6IG5hbWVzIH1dO1xuXG4gICAgaWYgKHJvdXRlTmFtZSkge1xuICAgICAgdmFyIHJvdXRlTmFtZXMgPSBBcnJheS5pc0FycmF5KHJvdXRlTmFtZSkgPyByb3V0ZU5hbWUgOiBbcm91dGVOYW1lXTtcbiAgICAgIGZvciAodmFyIF9pMiA9IDA7IF9pMiA8IHJvdXRlTmFtZXMubGVuZ3RoOyBfaTIrKykge1xuICAgICAgICB0aGlzLm5hbWVzW3JvdXRlTmFtZXNbX2kyXV0gPSB7XG4gICAgICAgICAgc2VnbWVudHM6IHNlZ21lbnRzLFxuICAgICAgICAgIGhhbmRsZXJzOiBoYW5kbGVyc1xuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIGN1cnJlbnRTdGF0ZS5oYW5kbGVycyA9IGhhbmRsZXJzO1xuICAgIGN1cnJlbnRTdGF0ZS5yZWdleCA9IG5ldyBSZWdFeHAocmVnZXggKyAnJCcsIHJvdXRlLmNhc2VTZW5zaXRpdmUgPyAnJyA6ICdpJyk7XG4gICAgY3VycmVudFN0YXRlLnR5cGVzID0gdHlwZXM7XG5cbiAgICByZXR1cm4gY3VycmVudFN0YXRlO1xuICB9O1xuXG4gIFJvdXRlUmVjb2duaXplci5wcm90b3R5cGUuaGFuZGxlcnNGb3IgPSBmdW5jdGlvbiBoYW5kbGVyc0ZvcihuYW1lKSB7XG4gICAgdmFyIHJvdXRlID0gdGhpcy5uYW1lc1tuYW1lXTtcbiAgICBpZiAoIXJvdXRlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZXJlIGlzIG5vIHJvdXRlIG5hbWVkICcgKyBuYW1lKTtcbiAgICB9XG5cbiAgICByZXR1cm4gW10uY29uY2F0KHJvdXRlLmhhbmRsZXJzKTtcbiAgfTtcblxuICBSb3V0ZVJlY29nbml6ZXIucHJvdG90eXBlLmhhc1JvdXRlID0gZnVuY3Rpb24gaGFzUm91dGUobmFtZSkge1xuICAgIHJldHVybiAhIXRoaXMubmFtZXNbbmFtZV07XG4gIH07XG5cbiAgUm91dGVSZWNvZ25pemVyLnByb3RvdHlwZS5nZW5lcmF0ZSA9IGZ1bmN0aW9uIGdlbmVyYXRlKG5hbWUsIHBhcmFtcykge1xuICAgIHZhciByb3V0ZSA9IHRoaXMubmFtZXNbbmFtZV07XG4gICAgaWYgKCFyb3V0ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGVyZSBpcyBubyByb3V0ZSBuYW1lZCAnICsgbmFtZSk7XG4gICAgfVxuXG4gICAgdmFyIGhhbmRsZXIgPSByb3V0ZS5oYW5kbGVyc1swXS5oYW5kbGVyO1xuICAgIGlmIChoYW5kbGVyLmhyZWYpIHtcbiAgICAgIHJldHVybiBoYW5kbGVyLmhyZWY7XG4gICAgfVxuXG4gICAgdmFyIHJvdXRlUGFyYW1zID0gT2JqZWN0LmFzc2lnbih7fSwgcGFyYW1zKTtcbiAgICB2YXIgc2VnbWVudHMgPSByb3V0ZS5zZWdtZW50cztcbiAgICB2YXIgY29uc3VtZWQgPSB7fTtcbiAgICB2YXIgb3V0cHV0ID0gJyc7XG5cbiAgICBmb3IgKHZhciBpID0gMCwgbCA9IHNlZ21lbnRzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgdmFyIHNlZ21lbnQgPSBzZWdtZW50c1tpXTtcblxuICAgICAgaWYgKHNlZ21lbnQgaW5zdGFuY2VvZiBFcHNpbG9uU2VnbWVudCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgb3V0cHV0ICs9ICcvJztcbiAgICAgIHZhciBzZWdtZW50VmFsdWUgPSBzZWdtZW50LmdlbmVyYXRlKHJvdXRlUGFyYW1zLCBjb25zdW1lZCk7XG4gICAgICBpZiAoc2VnbWVudFZhbHVlID09PSBudWxsIHx8IHNlZ21lbnRWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQSB2YWx1ZSBpcyByZXF1aXJlZCBmb3Igcm91dGUgcGFyYW1ldGVyIFxcJycgKyBzZWdtZW50Lm5hbWUgKyAnXFwnIGluIHJvdXRlIFxcJycgKyBuYW1lICsgJ1xcJy4nKTtcbiAgICAgIH1cblxuICAgICAgb3V0cHV0ICs9IHNlZ21lbnRWYWx1ZTtcbiAgICB9XG5cbiAgICBpZiAob3V0cHV0LmNoYXJBdCgwKSAhPT0gJy8nKSB7XG4gICAgICBvdXRwdXQgPSAnLycgKyBvdXRwdXQ7XG4gICAgfVxuXG4gICAgZm9yICh2YXIgcGFyYW0gaW4gY29uc3VtZWQpIHtcbiAgICAgIGRlbGV0ZSByb3V0ZVBhcmFtc1twYXJhbV07XG4gICAgfVxuXG4gICAgdmFyIHF1ZXJ5U3RyaW5nID0gKDAsIF9hdXJlbGlhUGF0aC5idWlsZFF1ZXJ5U3RyaW5nKShyb3V0ZVBhcmFtcyk7XG4gICAgb3V0cHV0ICs9IHF1ZXJ5U3RyaW5nID8gJz8nICsgcXVlcnlTdHJpbmcgOiAnJztcblxuICAgIHJldHVybiBvdXRwdXQ7XG4gIH07XG5cbiAgUm91dGVSZWNvZ25pemVyLnByb3RvdHlwZS5yZWNvZ25pemUgPSBmdW5jdGlvbiByZWNvZ25pemUocGF0aCkge1xuICAgIHZhciBzdGF0ZXMgPSBbdGhpcy5yb290U3RhdGVdO1xuICAgIHZhciBxdWVyeVBhcmFtcyA9IHt9O1xuICAgIHZhciBpc1NsYXNoRHJvcHBlZCA9IGZhbHNlO1xuICAgIHZhciBub3JtYWxpemVkUGF0aCA9IHBhdGg7XG5cbiAgICB2YXIgcXVlcnlTdGFydCA9IG5vcm1hbGl6ZWRQYXRoLmluZGV4T2YoJz8nKTtcbiAgICBpZiAocXVlcnlTdGFydCAhPT0gLTEpIHtcbiAgICAgIHZhciBxdWVyeVN0cmluZyA9IG5vcm1hbGl6ZWRQYXRoLnN1YnN0cihxdWVyeVN0YXJ0ICsgMSwgbm9ybWFsaXplZFBhdGgubGVuZ3RoKTtcbiAgICAgIG5vcm1hbGl6ZWRQYXRoID0gbm9ybWFsaXplZFBhdGguc3Vic3RyKDAsIHF1ZXJ5U3RhcnQpO1xuICAgICAgcXVlcnlQYXJhbXMgPSAoMCwgX2F1cmVsaWFQYXRoLnBhcnNlUXVlcnlTdHJpbmcpKHF1ZXJ5U3RyaW5nKTtcbiAgICB9XG5cbiAgICBub3JtYWxpemVkUGF0aCA9IGRlY29kZVVSSShub3JtYWxpemVkUGF0aCk7XG5cbiAgICBpZiAobm9ybWFsaXplZFBhdGguY2hhckF0KDApICE9PSAnLycpIHtcbiAgICAgIG5vcm1hbGl6ZWRQYXRoID0gJy8nICsgbm9ybWFsaXplZFBhdGg7XG4gICAgfVxuXG4gICAgdmFyIHBhdGhMZW4gPSBub3JtYWxpemVkUGF0aC5sZW5ndGg7XG4gICAgaWYgKHBhdGhMZW4gPiAxICYmIG5vcm1hbGl6ZWRQYXRoLmNoYXJBdChwYXRoTGVuIC0gMSkgPT09ICcvJykge1xuICAgICAgbm9ybWFsaXplZFBhdGggPSBub3JtYWxpemVkUGF0aC5zdWJzdHIoMCwgcGF0aExlbiAtIDEpO1xuICAgICAgaXNTbGFzaERyb3BwZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIGZvciAodmFyIGkgPSAwLCBsID0gbm9ybWFsaXplZFBhdGgubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICBzdGF0ZXMgPSByZWNvZ25pemVDaGFyKHN0YXRlcywgbm9ybWFsaXplZFBhdGguY2hhckF0KGkpKTtcbiAgICAgIGlmICghc3RhdGVzLmxlbmd0aCkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgc29sdXRpb25zID0gW107XG4gICAgZm9yICh2YXIgX2kzID0gMCwgX2wgPSBzdGF0ZXMubGVuZ3RoOyBfaTMgPCBfbDsgX2kzKyspIHtcbiAgICAgIGlmIChzdGF0ZXNbX2kzXS5oYW5kbGVycykge1xuICAgICAgICBzb2x1dGlvbnMucHVzaChzdGF0ZXNbX2kzXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgc3RhdGVzID0gc29ydFNvbHV0aW9ucyhzb2x1dGlvbnMpO1xuXG4gICAgdmFyIHN0YXRlID0gc29sdXRpb25zWzBdO1xuICAgIGlmIChzdGF0ZSAmJiBzdGF0ZS5oYW5kbGVycykge1xuICAgICAgaWYgKGlzU2xhc2hEcm9wcGVkICYmIHN0YXRlLnJlZ2V4LnNvdXJjZS5zbGljZSgtNSkgPT09ICcoLispJCcpIHtcbiAgICAgICAgbm9ybWFsaXplZFBhdGggPSBub3JtYWxpemVkUGF0aCArICcvJztcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZpbmRIYW5kbGVyKHN0YXRlLCBub3JtYWxpemVkUGF0aCwgcXVlcnlQYXJhbXMpO1xuICAgIH1cblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH07XG5cbiAgcmV0dXJuIFJvdXRlUmVjb2duaXplcjtcbn0oKTtcblxudmFyIFJlY29nbml6ZVJlc3VsdHMgPSBmdW5jdGlvbiBSZWNvZ25pemVSZXN1bHRzKHF1ZXJ5UGFyYW1zKSB7XG4gIFxuXG4gIHRoaXMuc3BsaWNlID0gQXJyYXkucHJvdG90eXBlLnNwbGljZTtcbiAgdGhpcy5zbGljZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZTtcbiAgdGhpcy5wdXNoID0gQXJyYXkucHJvdG90eXBlLnB1c2g7XG4gIHRoaXMubGVuZ3RoID0gMDtcbiAgdGhpcy5xdWVyeVBhcmFtcyA9IHF1ZXJ5UGFyYW1zIHx8IHt9O1xufTtcblxuZnVuY3Rpb24gcGFyc2Uocm91dGUsIG5hbWVzLCB0eXBlcywgY2FzZVNlbnNpdGl2ZSkge1xuICB2YXIgbm9ybWFsaXplZFJvdXRlID0gcm91dGU7XG4gIGlmIChyb3V0ZS5jaGFyQXQoMCkgPT09ICcvJykge1xuICAgIG5vcm1hbGl6ZWRSb3V0ZSA9IHJvdXRlLnN1YnN0cigxKTtcbiAgfVxuXG4gIHZhciByZXN1bHRzID0gW107XG5cbiAgdmFyIHNwbGl0Um91dGUgPSBub3JtYWxpemVkUm91dGUuc3BsaXQoJy8nKTtcbiAgZm9yICh2YXIgaSA9IDAsIGlpID0gc3BsaXRSb3V0ZS5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgdmFyIHNlZ21lbnQgPSBzcGxpdFJvdXRlW2ldO1xuICAgIHZhciBtYXRjaCA9IHNlZ21lbnQubWF0Y2goL146KFteXFwvXSspJC8pO1xuICAgIGlmIChtYXRjaCkge1xuICAgICAgcmVzdWx0cy5wdXNoKG5ldyBEeW5hbWljU2VnbWVudChtYXRjaFsxXSkpO1xuICAgICAgbmFtZXMucHVzaChtYXRjaFsxXSk7XG4gICAgICB0eXBlcy5keW5hbWljcysrO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgbWF0Y2ggPSBzZWdtZW50Lm1hdGNoKC9eXFwqKFteXFwvXSspJC8pO1xuICAgIGlmIChtYXRjaCkge1xuICAgICAgcmVzdWx0cy5wdXNoKG5ldyBTdGFyU2VnbWVudChtYXRjaFsxXSkpO1xuICAgICAgbmFtZXMucHVzaChtYXRjaFsxXSk7XG4gICAgICB0eXBlcy5zdGFycysrO1xuICAgIH0gZWxzZSBpZiAoc2VnbWVudCA9PT0gJycpIHtcbiAgICAgIHJlc3VsdHMucHVzaChuZXcgRXBzaWxvblNlZ21lbnQoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc3VsdHMucHVzaChuZXcgU3RhdGljU2VnbWVudChzZWdtZW50LCBjYXNlU2Vuc2l0aXZlKSk7XG4gICAgICB0eXBlcy5zdGF0aWNzKys7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJlc3VsdHM7XG59XG5cbmZ1bmN0aW9uIHNvcnRTb2x1dGlvbnMoc3RhdGVzKSB7XG4gIHJldHVybiBzdGF0ZXMuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgIGlmIChhLnR5cGVzLnN0YXJzICE9PSBiLnR5cGVzLnN0YXJzKSB7XG4gICAgICByZXR1cm4gYS50eXBlcy5zdGFycyAtIGIudHlwZXMuc3RhcnM7XG4gICAgfVxuXG4gICAgaWYgKGEudHlwZXMuc3RhcnMpIHtcbiAgICAgIGlmIChhLnR5cGVzLnN0YXRpY3MgIT09IGIudHlwZXMuc3RhdGljcykge1xuICAgICAgICByZXR1cm4gYi50eXBlcy5zdGF0aWNzIC0gYS50eXBlcy5zdGF0aWNzO1xuICAgICAgfVxuICAgICAgaWYgKGEudHlwZXMuZHluYW1pY3MgIT09IGIudHlwZXMuZHluYW1pY3MpIHtcbiAgICAgICAgcmV0dXJuIGIudHlwZXMuZHluYW1pY3MgLSBhLnR5cGVzLmR5bmFtaWNzO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChhLnR5cGVzLmR5bmFtaWNzICE9PSBiLnR5cGVzLmR5bmFtaWNzKSB7XG4gICAgICByZXR1cm4gYS50eXBlcy5keW5hbWljcyAtIGIudHlwZXMuZHluYW1pY3M7XG4gICAgfVxuXG4gICAgaWYgKGEudHlwZXMuc3RhdGljcyAhPT0gYi50eXBlcy5zdGF0aWNzKSB7XG4gICAgICByZXR1cm4gYi50eXBlcy5zdGF0aWNzIC0gYS50eXBlcy5zdGF0aWNzO1xuICAgIH1cblxuICAgIHJldHVybiAwO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gcmVjb2duaXplQ2hhcihzdGF0ZXMsIGNoKSB7XG4gIHZhciBuZXh0U3RhdGVzID0gW107XG5cbiAgZm9yICh2YXIgaSA9IDAsIGwgPSBzdGF0ZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgdmFyIHN0YXRlID0gc3RhdGVzW2ldO1xuICAgIG5leHRTdGF0ZXMucHVzaC5hcHBseShuZXh0U3RhdGVzLCBzdGF0ZS5tYXRjaChjaCkpO1xuICB9XG5cbiAgcmV0dXJuIG5leHRTdGF0ZXM7XG59XG5cbmZ1bmN0aW9uIGZpbmRIYW5kbGVyKHN0YXRlLCBwYXRoLCBxdWVyeVBhcmFtcykge1xuICB2YXIgaGFuZGxlcnMgPSBzdGF0ZS5oYW5kbGVycztcbiAgdmFyIHJlZ2V4ID0gc3RhdGUucmVnZXg7XG4gIHZhciBjYXB0dXJlcyA9IHBhdGgubWF0Y2gocmVnZXgpO1xuICB2YXIgY3VycmVudENhcHR1cmUgPSAxO1xuICB2YXIgcmVzdWx0ID0gbmV3IFJlY29nbml6ZVJlc3VsdHMocXVlcnlQYXJhbXMpO1xuXG4gIGZvciAodmFyIGkgPSAwLCBsID0gaGFuZGxlcnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgdmFyIF9oYW5kbGVyID0gaGFuZGxlcnNbaV07XG4gICAgdmFyIF9uYW1lcyA9IF9oYW5kbGVyLm5hbWVzO1xuICAgIHZhciBfcGFyYW1zID0ge307XG5cbiAgICBmb3IgKHZhciBqID0gMCwgbSA9IF9uYW1lcy5sZW5ndGg7IGogPCBtOyBqKyspIHtcbiAgICAgIF9wYXJhbXNbX25hbWVzW2pdXSA9IGNhcHR1cmVzW2N1cnJlbnRDYXB0dXJlKytdO1xuICAgIH1cblxuICAgIHJlc3VsdC5wdXNoKHsgaGFuZGxlcjogX2hhbmRsZXIuaGFuZGxlciwgcGFyYW1zOiBfcGFyYW1zLCBpc0R5bmFtaWM6ICEhX25hbWVzLmxlbmd0aCB9KTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIGFkZFNlZ21lbnQoY3VycmVudFN0YXRlLCBzZWdtZW50KSB7XG4gIHZhciBzdGF0ZSA9IGN1cnJlbnRTdGF0ZTtcbiAgc2VnbWVudC5lYWNoQ2hhcihmdW5jdGlvbiAoY2gpIHtcbiAgICBzdGF0ZSA9IHN0YXRlLnB1dChjaCk7XG4gIH0pO1xuXG4gIHJldHVybiBzdGF0ZTtcbn1cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS1yb3V0ZS1yZWNvZ25pemVyL2Rpc3QvY29tbW9uanMvYXVyZWxpYS1yb3V0ZS1yZWNvZ25pemVyLmpzXG4vLyBtb2R1bGUgaWQgPSAyN1xuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCJcInVzZSBzdHJpY3RcIjtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxudmFyIEF1dGhGaWx0ZXJWYWx1ZUNvbnZlcnRlciA9IGV4cG9ydHMuQXV0aEZpbHRlclZhbHVlQ29udmVydGVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBBdXRoRmlsdGVyVmFsdWVDb252ZXJ0ZXIoKSB7XG4gICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEF1dGhGaWx0ZXJWYWx1ZUNvbnZlcnRlcik7XG4gIH1cblxuICBBdXRoRmlsdGVyVmFsdWVDb252ZXJ0ZXIucHJvdG90eXBlLnRvVmlldyA9IGZ1bmN0aW9uIHRvVmlldyhyb3V0ZXMsIGlzQXV0aGVudGljYXRlZCkge1xuICAgIHJldHVybiByb3V0ZXMuZmlsdGVyKGZ1bmN0aW9uIChyKSB7XG4gICAgICByZXR1cm4gci5jb25maWcuYXV0aCA9PT0gdW5kZWZpbmVkIHx8IHIuY29uZmlnLmF1dGggPT09IGlzQXV0aGVudGljYXRlZDtcbiAgICB9KTtcbiAgfTtcblxuICByZXR1cm4gQXV0aEZpbHRlclZhbHVlQ29udmVydGVyO1xufSgpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLWF1dGgvZGlzdC9jb21tb25qcy9hdXRoLWZpbHRlci5qc1xuLy8gbW9kdWxlIGlkID0gMjhcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5TdG9yYWdlID0gdW5kZWZpbmVkO1xuXG52YXIgX2RlYywgX2NsYXNzO1xuXG52YXIgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uID0gcmVxdWlyZSgnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbicpO1xuXG52YXIgX2Jhc2VDb25maWcgPSByZXF1aXJlKCcuL2Jhc2UtY29uZmlnJyk7XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbnZhciBTdG9yYWdlID0gZXhwb3J0cy5TdG9yYWdlID0gKF9kZWMgPSAoMCwgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uLmluamVjdCkoX2Jhc2VDb25maWcuQmFzZUNvbmZpZyksIF9kZWMoX2NsYXNzID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBTdG9yYWdlKGNvbmZpZykge1xuICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTdG9yYWdlKTtcblxuICAgIHRoaXMuY29uZmlnID0gY29uZmlnLmN1cnJlbnQ7XG4gICAgdGhpcy5zdG9yYWdlID0gdGhpcy5fZ2V0U3RvcmFnZSh0aGlzLmNvbmZpZy5zdG9yYWdlKTtcbiAgfVxuXG4gIFN0b3JhZ2UucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIGdldChrZXkpIHtcbiAgICByZXR1cm4gdGhpcy5zdG9yYWdlLmdldEl0ZW0oa2V5KTtcbiAgfTtcblxuICBTdG9yYWdlLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiBzZXQoa2V5LCB2YWx1ZSkge1xuICAgIHJldHVybiB0aGlzLnN0b3JhZ2Uuc2V0SXRlbShrZXksIHZhbHVlKTtcbiAgfTtcblxuICBTdG9yYWdlLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiByZW1vdmUoa2V5KSB7XG4gICAgcmV0dXJuIHRoaXMuc3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XG4gIH07XG5cbiAgU3RvcmFnZS5wcm90b3R5cGUuX2dldFN0b3JhZ2UgPSBmdW5jdGlvbiBfZ2V0U3RvcmFnZSh0eXBlKSB7XG4gICAgaWYgKHR5cGUgPT09ICdsb2NhbFN0b3JhZ2UnKSB7XG4gICAgICBpZiAoJ2xvY2FsU3RvcmFnZScgaW4gd2luZG93ICYmIHdpbmRvdy5sb2NhbFN0b3JhZ2UgIT09IG51bGwpIHJldHVybiBsb2NhbFN0b3JhZ2U7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0xvY2FsIFN0b3JhZ2UgaXMgZGlzYWJsZWQgb3IgdW5hdmFpbGFibGUuJyk7XG4gICAgfSBlbHNlIGlmICh0eXBlID09PSAnc2Vzc2lvblN0b3JhZ2UnKSB7XG4gICAgICBpZiAoJ3Nlc3Npb25TdG9yYWdlJyBpbiB3aW5kb3cgJiYgd2luZG93LnNlc3Npb25TdG9yYWdlICE9PSBudWxsKSByZXR1cm4gc2Vzc2lvblN0b3JhZ2U7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Nlc3Npb24gU3RvcmFnZSBpcyBkaXNhYmxlZCBvciB1bmF2YWlsYWJsZS4nKTtcbiAgICB9XG5cbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgc3RvcmFnZSB0eXBlIHNwZWNpZmllZDogJyArIHR5cGUpO1xuICB9O1xuXG4gIHJldHVybiBTdG9yYWdlO1xufSgpKSB8fCBfY2xhc3MpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLWF1dGgvZGlzdC9jb21tb25qcy9zdG9yYWdlLmpzXG4vLyBtb2R1bGUgaWQgPSAyOVxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLmF1cmVsaWFIaWRlQ2xhc3NOYW1lID0gdW5kZWZpbmVkO1xuZXhwb3J0cy5pbmplY3RBdXJlbGlhSGlkZVN0eWxlQXRIZWFkID0gaW5qZWN0QXVyZWxpYUhpZGVTdHlsZUF0SGVhZDtcbmV4cG9ydHMuaW5qZWN0QXVyZWxpYUhpZGVTdHlsZUF0Qm91bmRhcnkgPSBpbmplY3RBdXJlbGlhSGlkZVN0eWxlQXRCb3VuZGFyeTtcblxudmFyIF9hdXJlbGlhUGFsID0gcmVxdWlyZSgnYXVyZWxpYS1wYWwnKTtcblxudmFyIGF1cmVsaWFIaWRlQ2xhc3NOYW1lID0gZXhwb3J0cy5hdXJlbGlhSGlkZUNsYXNzTmFtZSA9ICdhdXJlbGlhLWhpZGUnO1xuXG52YXIgYXVyZWxpYUhpZGVDbGFzcyA9ICcuJyArIGF1cmVsaWFIaWRlQ2xhc3NOYW1lICsgJyB7IGRpc3BsYXk6bm9uZSAhaW1wb3J0YW50OyB9JztcblxuZnVuY3Rpb24gaW5qZWN0QXVyZWxpYUhpZGVTdHlsZUF0SGVhZCgpIHtcbiAgX2F1cmVsaWFQYWwuRE9NLmluamVjdFN0eWxlcyhhdXJlbGlhSGlkZUNsYXNzKTtcbn1cblxuZnVuY3Rpb24gaW5qZWN0QXVyZWxpYUhpZGVTdHlsZUF0Qm91bmRhcnkoZG9tQm91bmRhcnkpIHtcbiAgaWYgKF9hdXJlbGlhUGFsLkZFQVRVUkUuc2hhZG93RE9NICYmIGRvbUJvdW5kYXJ5ICYmICFkb21Cb3VuZGFyeS5oYXNBdXJlbGlhSGlkZVN0eWxlKSB7XG4gICAgZG9tQm91bmRhcnkuaGFzQXVyZWxpYUhpZGVTdHlsZSA9IHRydWU7XG4gICAgX2F1cmVsaWFQYWwuRE9NLmluamVjdFN0eWxlcyhhdXJlbGlhSGlkZUNsYXNzLCBkb21Cb3VuZGFyeSk7XG4gIH1cbn1cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L2NvbW1vbmpzL2F1cmVsaWEtaGlkZS1zdHlsZS5qc1xuLy8gbW9kdWxlIGlkID0gMzBcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5Ud29XYXlCaW5kaW5nQmVoYXZpb3IgPSBleHBvcnRzLk9uZVdheUJpbmRpbmdCZWhhdmlvciA9IGV4cG9ydHMuT25lVGltZUJpbmRpbmdCZWhhdmlvciA9IHVuZGVmaW5lZDtcblxudmFyIF9kZWMsIF9jbGFzcywgX2RlYzIsIF9jbGFzczIsIF9kZWMzLCBfY2xhc3MzO1xuXG52YXIgX2F1cmVsaWFCaW5kaW5nID0gcmVxdWlyZSgnYXVyZWxpYS1iaW5kaW5nJyk7XG5cbnZhciBfYXVyZWxpYU1ldGFkYXRhID0gcmVxdWlyZSgnYXVyZWxpYS1tZXRhZGF0YScpO1xuXG5cblxudmFyIG1vZGVCaW5kaW5nQmVoYXZpb3IgPSB7XG4gIGJpbmQ6IGZ1bmN0aW9uIGJpbmQoYmluZGluZywgc291cmNlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICBiaW5kaW5nLm9yaWdpbmFsTW9kZSA9IGJpbmRpbmcubW9kZTtcbiAgICBiaW5kaW5nLm1vZGUgPSB0aGlzLm1vZGU7XG4gIH0sXG4gIHVuYmluZDogZnVuY3Rpb24gdW5iaW5kKGJpbmRpbmcsIHNvdXJjZSkge1xuICAgIGJpbmRpbmcubW9kZSA9IGJpbmRpbmcub3JpZ2luYWxNb2RlO1xuICAgIGJpbmRpbmcub3JpZ2luYWxNb2RlID0gbnVsbDtcbiAgfVxufTtcblxudmFyIE9uZVRpbWVCaW5kaW5nQmVoYXZpb3IgPSBleHBvcnRzLk9uZVRpbWVCaW5kaW5nQmVoYXZpb3IgPSAoX2RlYyA9ICgwLCBfYXVyZWxpYU1ldGFkYXRhLm1peGluKShtb2RlQmluZGluZ0JlaGF2aW9yKSwgX2RlYyhfY2xhc3MgPSBmdW5jdGlvbiBPbmVUaW1lQmluZGluZ0JlaGF2aW9yKCkge1xuICBcblxuICB0aGlzLm1vZGUgPSBfYXVyZWxpYUJpbmRpbmcuYmluZGluZ01vZGUub25lVGltZTtcbn0pIHx8IF9jbGFzcyk7XG52YXIgT25lV2F5QmluZGluZ0JlaGF2aW9yID0gZXhwb3J0cy5PbmVXYXlCaW5kaW5nQmVoYXZpb3IgPSAoX2RlYzIgPSAoMCwgX2F1cmVsaWFNZXRhZGF0YS5taXhpbikobW9kZUJpbmRpbmdCZWhhdmlvciksIF9kZWMyKF9jbGFzczIgPSBmdW5jdGlvbiBPbmVXYXlCaW5kaW5nQmVoYXZpb3IoKSB7XG4gIFxuXG4gIHRoaXMubW9kZSA9IF9hdXJlbGlhQmluZGluZy5iaW5kaW5nTW9kZS5vbmVXYXk7XG59KSB8fCBfY2xhc3MyKTtcbnZhciBUd29XYXlCaW5kaW5nQmVoYXZpb3IgPSBleHBvcnRzLlR3b1dheUJpbmRpbmdCZWhhdmlvciA9IChfZGVjMyA9ICgwLCBfYXVyZWxpYU1ldGFkYXRhLm1peGluKShtb2RlQmluZGluZ0JlaGF2aW9yKSwgX2RlYzMoX2NsYXNzMyA9IGZ1bmN0aW9uIFR3b1dheUJpbmRpbmdCZWhhdmlvcigpIHtcbiAgXG5cbiAgdGhpcy5tb2RlID0gX2F1cmVsaWFCaW5kaW5nLmJpbmRpbmdNb2RlLnR3b1dheTtcbn0pIHx8IF9jbGFzczMpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzL2Rpc3QvY29tbW9uanMvYmluZGluZy1tb2RlLWJlaGF2aW9ycy5qc1xuLy8gbW9kdWxlIGlkID0gMzFcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5Db21wb3NlID0gdW5kZWZpbmVkO1xuXG52YXIgX2RlYywgX2RlYzIsIF9jbGFzcywgX2Rlc2MsIF92YWx1ZSwgX2NsYXNzMiwgX2Rlc2NyaXB0b3IsIF9kZXNjcmlwdG9yMiwgX2Rlc2NyaXB0b3IzO1xuXG52YXIgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uID0gcmVxdWlyZSgnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbicpO1xuXG52YXIgX2F1cmVsaWFUYXNrUXVldWUgPSByZXF1aXJlKCdhdXJlbGlhLXRhc2stcXVldWUnKTtcblxudmFyIF9hdXJlbGlhVGVtcGxhdGluZyA9IHJlcXVpcmUoJ2F1cmVsaWEtdGVtcGxhdGluZycpO1xuXG52YXIgX2F1cmVsaWFQYWwgPSByZXF1aXJlKCdhdXJlbGlhLXBhbCcpO1xuXG5mdW5jdGlvbiBfaW5pdERlZmluZVByb3AodGFyZ2V0LCBwcm9wZXJ0eSwgZGVzY3JpcHRvciwgY29udGV4dCkge1xuICBpZiAoIWRlc2NyaXB0b3IpIHJldHVybjtcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgcHJvcGVydHksIHtcbiAgICBlbnVtZXJhYmxlOiBkZXNjcmlwdG9yLmVudW1lcmFibGUsXG4gICAgY29uZmlndXJhYmxlOiBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSxcbiAgICB3cml0YWJsZTogZGVzY3JpcHRvci53cml0YWJsZSxcbiAgICB2YWx1ZTogZGVzY3JpcHRvci5pbml0aWFsaXplciA/IGRlc2NyaXB0b3IuaW5pdGlhbGl6ZXIuY2FsbChjb250ZXh0KSA6IHZvaWQgMFxuICB9KTtcbn1cblxuXG5cbmZ1bmN0aW9uIF9hcHBseURlY29yYXRlZERlc2NyaXB0b3IodGFyZ2V0LCBwcm9wZXJ0eSwgZGVjb3JhdG9ycywgZGVzY3JpcHRvciwgY29udGV4dCkge1xuICB2YXIgZGVzYyA9IHt9O1xuICBPYmplY3RbJ2tlJyArICd5cyddKGRlc2NyaXB0b3IpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgIGRlc2Nba2V5XSA9IGRlc2NyaXB0b3Jba2V5XTtcbiAgfSk7XG4gIGRlc2MuZW51bWVyYWJsZSA9ICEhZGVzYy5lbnVtZXJhYmxlO1xuICBkZXNjLmNvbmZpZ3VyYWJsZSA9ICEhZGVzYy5jb25maWd1cmFibGU7XG5cbiAgaWYgKCd2YWx1ZScgaW4gZGVzYyB8fCBkZXNjLmluaXRpYWxpemVyKSB7XG4gICAgZGVzYy53cml0YWJsZSA9IHRydWU7XG4gIH1cblxuICBkZXNjID0gZGVjb3JhdG9ycy5zbGljZSgpLnJldmVyc2UoKS5yZWR1Y2UoZnVuY3Rpb24gKGRlc2MsIGRlY29yYXRvcikge1xuICAgIHJldHVybiBkZWNvcmF0b3IodGFyZ2V0LCBwcm9wZXJ0eSwgZGVzYykgfHwgZGVzYztcbiAgfSwgZGVzYyk7XG5cbiAgaWYgKGNvbnRleHQgJiYgZGVzYy5pbml0aWFsaXplciAhPT0gdm9pZCAwKSB7XG4gICAgZGVzYy52YWx1ZSA9IGRlc2MuaW5pdGlhbGl6ZXIgPyBkZXNjLmluaXRpYWxpemVyLmNhbGwoY29udGV4dCkgOiB2b2lkIDA7XG4gICAgZGVzYy5pbml0aWFsaXplciA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIGlmIChkZXNjLmluaXRpYWxpemVyID09PSB2b2lkIDApIHtcbiAgICBPYmplY3RbJ2RlZmluZScgKyAnUHJvcGVydHknXSh0YXJnZXQsIHByb3BlcnR5LCBkZXNjKTtcbiAgICBkZXNjID0gbnVsbDtcbiAgfVxuXG4gIHJldHVybiBkZXNjO1xufVxuXG5mdW5jdGlvbiBfaW5pdGlhbGl6ZXJXYXJuaW5nSGVscGVyKGRlc2NyaXB0b3IsIGNvbnRleHQpIHtcbiAgdGhyb3cgbmV3IEVycm9yKCdEZWNvcmF0aW5nIGNsYXNzIHByb3BlcnR5IGZhaWxlZC4gUGxlYXNlIGVuc3VyZSB0aGF0IHRyYW5zZm9ybS1jbGFzcy1wcm9wZXJ0aWVzIGlzIGVuYWJsZWQuJyk7XG59XG5cbnZhciBDb21wb3NlID0gZXhwb3J0cy5Db21wb3NlID0gKF9kZWMgPSAoMCwgX2F1cmVsaWFUZW1wbGF0aW5nLmN1c3RvbUVsZW1lbnQpKCdjb21wb3NlJyksIF9kZWMyID0gKDAsIF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbi5pbmplY3QpKF9hdXJlbGlhUGFsLkRPTS5FbGVtZW50LCBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24uQ29udGFpbmVyLCBfYXVyZWxpYVRlbXBsYXRpbmcuQ29tcG9zaXRpb25FbmdpbmUsIF9hdXJlbGlhVGVtcGxhdGluZy5WaWV3U2xvdCwgX2F1cmVsaWFUZW1wbGF0aW5nLlZpZXdSZXNvdXJjZXMsIF9hdXJlbGlhVGFza1F1ZXVlLlRhc2tRdWV1ZSksIF9kZWMoX2NsYXNzID0gKDAsIF9hdXJlbGlhVGVtcGxhdGluZy5ub1ZpZXcpKF9jbGFzcyA9IF9kZWMyKF9jbGFzcyA9IChfY2xhc3MyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBDb21wb3NlKGVsZW1lbnQsIGNvbnRhaW5lciwgY29tcG9zaXRpb25FbmdpbmUsIHZpZXdTbG90LCB2aWV3UmVzb3VyY2VzLCB0YXNrUXVldWUpIHtcbiAgICBcblxuICAgIF9pbml0RGVmaW5lUHJvcCh0aGlzLCAnbW9kZWwnLCBfZGVzY3JpcHRvciwgdGhpcyk7XG5cbiAgICBfaW5pdERlZmluZVByb3AodGhpcywgJ3ZpZXcnLCBfZGVzY3JpcHRvcjIsIHRoaXMpO1xuXG4gICAgX2luaXREZWZpbmVQcm9wKHRoaXMsICd2aWV3TW9kZWwnLCBfZGVzY3JpcHRvcjMsIHRoaXMpO1xuXG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICB0aGlzLmNvbXBvc2l0aW9uRW5naW5lID0gY29tcG9zaXRpb25FbmdpbmU7XG4gICAgdGhpcy52aWV3U2xvdCA9IHZpZXdTbG90O1xuICAgIHRoaXMudmlld1Jlc291cmNlcyA9IHZpZXdSZXNvdXJjZXM7XG4gICAgdGhpcy50YXNrUXVldWUgPSB0YXNrUXVldWU7XG4gICAgdGhpcy5jdXJyZW50Q29udHJvbGxlciA9IG51bGw7XG4gICAgdGhpcy5jdXJyZW50Vmlld01vZGVsID0gbnVsbDtcbiAgfVxuXG4gIENvbXBvc2UucHJvdG90eXBlLmNyZWF0ZWQgPSBmdW5jdGlvbiBjcmVhdGVkKG93bmluZ1ZpZXcpIHtcbiAgICB0aGlzLm93bmluZ1ZpZXcgPSBvd25pbmdWaWV3O1xuICB9O1xuXG4gIENvbXBvc2UucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiBiaW5kKGJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpIHtcbiAgICB0aGlzLmJpbmRpbmdDb250ZXh0ID0gYmluZGluZ0NvbnRleHQ7XG4gICAgdGhpcy5vdmVycmlkZUNvbnRleHQgPSBvdmVycmlkZUNvbnRleHQ7XG4gICAgcHJvY2Vzc0luc3RydWN0aW9uKHRoaXMsIGNyZWF0ZUluc3RydWN0aW9uKHRoaXMsIHtcbiAgICAgIHZpZXc6IHRoaXMudmlldyxcbiAgICAgIHZpZXdNb2RlbDogdGhpcy52aWV3TW9kZWwsXG4gICAgICBtb2RlbDogdGhpcy5tb2RlbFxuICAgIH0pKTtcbiAgfTtcblxuICBDb21wb3NlLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiB1bmJpbmQoYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCkge1xuICAgIHRoaXMuYmluZGluZ0NvbnRleHQgPSBudWxsO1xuICAgIHRoaXMub3ZlcnJpZGVDb250ZXh0ID0gbnVsbDtcbiAgICB2YXIgcmV0dXJuVG9DYWNoZSA9IHRydWU7XG4gICAgdmFyIHNraXBBbmltYXRpb24gPSB0cnVlO1xuICAgIHRoaXMudmlld1Nsb3QucmVtb3ZlQWxsKHJldHVyblRvQ2FjaGUsIHNraXBBbmltYXRpb24pO1xuICB9O1xuXG4gIENvbXBvc2UucHJvdG90eXBlLm1vZGVsQ2hhbmdlZCA9IGZ1bmN0aW9uIG1vZGVsQ2hhbmdlZChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgaWYgKHRoaXMuY3VycmVudEluc3RydWN0aW9uKSB7XG4gICAgICB0aGlzLmN1cnJlbnRJbnN0cnVjdGlvbi5tb2RlbCA9IG5ld1ZhbHVlO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMudGFza1F1ZXVlLnF1ZXVlTWljcm9UYXNrKGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChfdGhpcy5jdXJyZW50SW5zdHJ1Y3Rpb24pIHtcbiAgICAgICAgX3RoaXMuY3VycmVudEluc3RydWN0aW9uLm1vZGVsID0gbmV3VmFsdWU7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdmFyIHZtID0gX3RoaXMuY3VycmVudFZpZXdNb2RlbDtcblxuICAgICAgaWYgKHZtICYmIHR5cGVvZiB2bS5hY3RpdmF0ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB2bS5hY3RpdmF0ZShuZXdWYWx1ZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG5cbiAgQ29tcG9zZS5wcm90b3R5cGUudmlld0NoYW5nZWQgPSBmdW5jdGlvbiB2aWV3Q2hhbmdlZChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgIHZhciBpbnN0cnVjdGlvbiA9IGNyZWF0ZUluc3RydWN0aW9uKHRoaXMsIHtcbiAgICAgIHZpZXc6IG5ld1ZhbHVlLFxuICAgICAgdmlld01vZGVsOiB0aGlzLmN1cnJlbnRWaWV3TW9kZWwgfHwgdGhpcy52aWV3TW9kZWwsXG4gICAgICBtb2RlbDogdGhpcy5tb2RlbFxuICAgIH0pO1xuXG4gICAgaWYgKHRoaXMuY3VycmVudEluc3RydWN0aW9uKSB7XG4gICAgICB0aGlzLmN1cnJlbnRJbnN0cnVjdGlvbiA9IGluc3RydWN0aW9uO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuY3VycmVudEluc3RydWN0aW9uID0gaW5zdHJ1Y3Rpb247XG4gICAgdGhpcy50YXNrUXVldWUucXVldWVNaWNyb1Rhc2soZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHByb2Nlc3NJbnN0cnVjdGlvbihfdGhpczIsIF90aGlzMi5jdXJyZW50SW5zdHJ1Y3Rpb24pO1xuICAgIH0pO1xuICB9O1xuXG4gIENvbXBvc2UucHJvdG90eXBlLnZpZXdNb2RlbENoYW5nZWQgPSBmdW5jdGlvbiB2aWV3TW9kZWxDaGFuZ2VkKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgIHZhciBfdGhpczMgPSB0aGlzO1xuXG4gICAgdmFyIGluc3RydWN0aW9uID0gY3JlYXRlSW5zdHJ1Y3Rpb24odGhpcywge1xuICAgICAgdmlld01vZGVsOiBuZXdWYWx1ZSxcbiAgICAgIHZpZXc6IHRoaXMudmlldyxcbiAgICAgIG1vZGVsOiB0aGlzLm1vZGVsXG4gICAgfSk7XG5cbiAgICBpZiAodGhpcy5jdXJyZW50SW5zdHJ1Y3Rpb24pIHtcbiAgICAgIHRoaXMuY3VycmVudEluc3RydWN0aW9uID0gaW5zdHJ1Y3Rpb247XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5jdXJyZW50SW5zdHJ1Y3Rpb24gPSBpbnN0cnVjdGlvbjtcbiAgICB0aGlzLnRhc2tRdWV1ZS5xdWV1ZU1pY3JvVGFzayhmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gcHJvY2Vzc0luc3RydWN0aW9uKF90aGlzMywgX3RoaXMzLmN1cnJlbnRJbnN0cnVjdGlvbik7XG4gICAgfSk7XG4gIH07XG5cbiAgcmV0dXJuIENvbXBvc2U7XG59KCksIChfZGVzY3JpcHRvciA9IF9hcHBseURlY29yYXRlZERlc2NyaXB0b3IoX2NsYXNzMi5wcm90b3R5cGUsICdtb2RlbCcsIFtfYXVyZWxpYVRlbXBsYXRpbmcuYmluZGFibGVdLCB7XG4gIGVudW1lcmFibGU6IHRydWUsXG4gIGluaXRpYWxpemVyOiBudWxsXG59KSwgX2Rlc2NyaXB0b3IyID0gX2FwcGx5RGVjb3JhdGVkRGVzY3JpcHRvcihfY2xhc3MyLnByb3RvdHlwZSwgJ3ZpZXcnLCBbX2F1cmVsaWFUZW1wbGF0aW5nLmJpbmRhYmxlXSwge1xuICBlbnVtZXJhYmxlOiB0cnVlLFxuICBpbml0aWFsaXplcjogbnVsbFxufSksIF9kZXNjcmlwdG9yMyA9IF9hcHBseURlY29yYXRlZERlc2NyaXB0b3IoX2NsYXNzMi5wcm90b3R5cGUsICd2aWV3TW9kZWwnLCBbX2F1cmVsaWFUZW1wbGF0aW5nLmJpbmRhYmxlXSwge1xuICBlbnVtZXJhYmxlOiB0cnVlLFxuICBpbml0aWFsaXplcjogbnVsbFxufSkpLCBfY2xhc3MyKSkgfHwgX2NsYXNzKSB8fCBfY2xhc3MpIHx8IF9jbGFzcyk7XG5cblxuZnVuY3Rpb24gY3JlYXRlSW5zdHJ1Y3Rpb24oY29tcG9zZXIsIGluc3RydWN0aW9uKSB7XG4gIHJldHVybiBPYmplY3QuYXNzaWduKGluc3RydWN0aW9uLCB7XG4gICAgYmluZGluZ0NvbnRleHQ6IGNvbXBvc2VyLmJpbmRpbmdDb250ZXh0LFxuICAgIG92ZXJyaWRlQ29udGV4dDogY29tcG9zZXIub3ZlcnJpZGVDb250ZXh0LFxuICAgIG93bmluZ1ZpZXc6IGNvbXBvc2VyLm93bmluZ1ZpZXcsXG4gICAgY29udGFpbmVyOiBjb21wb3Nlci5jb250YWluZXIsXG4gICAgdmlld1Nsb3Q6IGNvbXBvc2VyLnZpZXdTbG90LFxuICAgIHZpZXdSZXNvdXJjZXM6IGNvbXBvc2VyLnZpZXdSZXNvdXJjZXMsXG4gICAgY3VycmVudENvbnRyb2xsZXI6IGNvbXBvc2VyLmN1cnJlbnRDb250cm9sbGVyLFxuICAgIGhvc3Q6IGNvbXBvc2VyLmVsZW1lbnRcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHByb2Nlc3NJbnN0cnVjdGlvbihjb21wb3NlciwgaW5zdHJ1Y3Rpb24pIHtcbiAgY29tcG9zZXIuY3VycmVudEluc3RydWN0aW9uID0gbnVsbDtcbiAgY29tcG9zZXIuY29tcG9zaXRpb25FbmdpbmUuY29tcG9zZShpbnN0cnVjdGlvbikudGhlbihmdW5jdGlvbiAoY29udHJvbGxlcikge1xuICAgIGNvbXBvc2VyLmN1cnJlbnRDb250cm9sbGVyID0gY29udHJvbGxlcjtcbiAgICBjb21wb3Nlci5jdXJyZW50Vmlld01vZGVsID0gY29udHJvbGxlciA/IGNvbnRyb2xsZXIudmlld01vZGVsIDogbnVsbDtcbiAgfSk7XG59XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9jb21wb3NlLmpzXG4vLyBtb2R1bGUgaWQgPSAzMlxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLkRlYm91bmNlQmluZGluZ0JlaGF2aW9yID0gdW5kZWZpbmVkO1xuXG52YXIgX2F1cmVsaWFCaW5kaW5nID0gcmVxdWlyZSgnYXVyZWxpYS1iaW5kaW5nJyk7XG5cblxuXG5mdW5jdGlvbiBkZWJvdW5jZShuZXdWYWx1ZSkge1xuICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gIHZhciBzdGF0ZSA9IHRoaXMuZGVib3VuY2VTdGF0ZTtcbiAgaWYgKHN0YXRlLmltbWVkaWF0ZSkge1xuICAgIHN0YXRlLmltbWVkaWF0ZSA9IGZhbHNlO1xuICAgIHRoaXMuZGVib3VuY2VkTWV0aG9kKG5ld1ZhbHVlKTtcbiAgICByZXR1cm47XG4gIH1cbiAgY2xlYXJUaW1lb3V0KHN0YXRlLnRpbWVvdXRJZCk7XG4gIHN0YXRlLnRpbWVvdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBfdGhpcy5kZWJvdW5jZWRNZXRob2QobmV3VmFsdWUpO1xuICB9LCBzdGF0ZS5kZWxheSk7XG59XG5cbnZhciBEZWJvdW5jZUJpbmRpbmdCZWhhdmlvciA9IGV4cG9ydHMuRGVib3VuY2VCaW5kaW5nQmVoYXZpb3IgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIERlYm91bmNlQmluZGluZ0JlaGF2aW9yKCkge1xuICAgIFxuICB9XG5cbiAgRGVib3VuY2VCaW5kaW5nQmVoYXZpb3IucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiBiaW5kKGJpbmRpbmcsIHNvdXJjZSkge1xuICAgIHZhciBkZWxheSA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMiB8fCBhcmd1bWVudHNbMl0gPT09IHVuZGVmaW5lZCA/IDIwMCA6IGFyZ3VtZW50c1syXTtcblxuICAgIHZhciBtZXRob2RUb0RlYm91bmNlID0gJ3VwZGF0ZVRhcmdldCc7XG4gICAgaWYgKGJpbmRpbmcuY2FsbFNvdXJjZSkge1xuICAgICAgbWV0aG9kVG9EZWJvdW5jZSA9ICdjYWxsU291cmNlJztcbiAgICB9IGVsc2UgaWYgKGJpbmRpbmcudXBkYXRlU291cmNlICYmIGJpbmRpbmcubW9kZSA9PT0gX2F1cmVsaWFCaW5kaW5nLmJpbmRpbmdNb2RlLnR3b1dheSkge1xuICAgICAgICBtZXRob2RUb0RlYm91bmNlID0gJ3VwZGF0ZVNvdXJjZSc7XG4gICAgICB9XG5cbiAgICBiaW5kaW5nLmRlYm91bmNlZE1ldGhvZCA9IGJpbmRpbmdbbWV0aG9kVG9EZWJvdW5jZV07XG4gICAgYmluZGluZy5kZWJvdW5jZWRNZXRob2Qub3JpZ2luYWxOYW1lID0gbWV0aG9kVG9EZWJvdW5jZTtcblxuICAgIGJpbmRpbmdbbWV0aG9kVG9EZWJvdW5jZV0gPSBkZWJvdW5jZTtcblxuICAgIGJpbmRpbmcuZGVib3VuY2VTdGF0ZSA9IHtcbiAgICAgIGRlbGF5OiBkZWxheSxcbiAgICAgIHRpbWVvdXRJZDogbnVsbCxcbiAgICAgIGltbWVkaWF0ZTogbWV0aG9kVG9EZWJvdW5jZSA9PT0gJ3VwZGF0ZVRhcmdldCcgfTtcbiAgfTtcblxuICBEZWJvdW5jZUJpbmRpbmdCZWhhdmlvci5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gdW5iaW5kKGJpbmRpbmcsIHNvdXJjZSkge1xuICAgIHZhciBtZXRob2RUb1Jlc3RvcmUgPSBiaW5kaW5nLmRlYm91bmNlZE1ldGhvZC5vcmlnaW5hbE5hbWU7XG4gICAgYmluZGluZ1ttZXRob2RUb1Jlc3RvcmVdID0gYmluZGluZy5kZWJvdW5jZWRNZXRob2Q7XG4gICAgYmluZGluZy5kZWJvdW5jZWRNZXRob2QgPSBudWxsO1xuICAgIGNsZWFyVGltZW91dChiaW5kaW5nLmRlYm91bmNlU3RhdGUudGltZW91dElkKTtcbiAgICBiaW5kaW5nLmRlYm91bmNlU3RhdGUgPSBudWxsO1xuICB9O1xuXG4gIHJldHVybiBEZWJvdW5jZUJpbmRpbmdCZWhhdmlvcjtcbn0oKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L2NvbW1vbmpzL2RlYm91bmNlLWJpbmRpbmctYmVoYXZpb3IuanNcbi8vIG1vZHVsZSBpZCA9IDMzXG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuRm9jdXMgPSB1bmRlZmluZWQ7XG5cbnZhciBfZGVjLCBfZGVjMiwgX2NsYXNzO1xuXG52YXIgX2F1cmVsaWFUZW1wbGF0aW5nID0gcmVxdWlyZSgnYXVyZWxpYS10ZW1wbGF0aW5nJyk7XG5cbnZhciBfYXVyZWxpYUJpbmRpbmcgPSByZXF1aXJlKCdhdXJlbGlhLWJpbmRpbmcnKTtcblxudmFyIF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbiA9IHJlcXVpcmUoJ2F1cmVsaWEtZGVwZW5kZW5jeS1pbmplY3Rpb24nKTtcblxudmFyIF9hdXJlbGlhVGFza1F1ZXVlID0gcmVxdWlyZSgnYXVyZWxpYS10YXNrLXF1ZXVlJyk7XG5cbnZhciBfYXVyZWxpYVBhbCA9IHJlcXVpcmUoJ2F1cmVsaWEtcGFsJyk7XG5cblxuXG52YXIgRm9jdXMgPSBleHBvcnRzLkZvY3VzID0gKF9kZWMgPSAoMCwgX2F1cmVsaWFUZW1wbGF0aW5nLmN1c3RvbUF0dHJpYnV0ZSkoJ2ZvY3VzJywgX2F1cmVsaWFCaW5kaW5nLmJpbmRpbmdNb2RlLnR3b1dheSksIF9kZWMyID0gKDAsIF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbi5pbmplY3QpKF9hdXJlbGlhUGFsLkRPTS5FbGVtZW50LCBfYXVyZWxpYVRhc2tRdWV1ZS5UYXNrUXVldWUpLCBfZGVjKF9jbGFzcyA9IF9kZWMyKF9jbGFzcyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gRm9jdXMoZWxlbWVudCwgdGFza1F1ZXVlKSB7XG4gICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgIFxuXG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICB0aGlzLnRhc2tRdWV1ZSA9IHRhc2tRdWV1ZTtcbiAgICB0aGlzLmlzQXR0YWNoZWQgPSBmYWxzZTtcbiAgICB0aGlzLm5lZWRzQXBwbHkgPSBmYWxzZTtcblxuICAgIHRoaXMuZm9jdXNMaXN0ZW5lciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICBfdGhpcy52YWx1ZSA9IHRydWU7XG4gICAgfTtcbiAgICB0aGlzLmJsdXJMaXN0ZW5lciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoX2F1cmVsaWFQYWwuRE9NLmFjdGl2ZUVsZW1lbnQgIT09IF90aGlzLmVsZW1lbnQpIHtcbiAgICAgICAgX3RoaXMudmFsdWUgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgRm9jdXMucHJvdG90eXBlLnZhbHVlQ2hhbmdlZCA9IGZ1bmN0aW9uIHZhbHVlQ2hhbmdlZChuZXdWYWx1ZSkge1xuICAgIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcbiAgICAgIHRoaXMuX2FwcGx5KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubmVlZHNBcHBseSA9IHRydWU7XG4gICAgfVxuICB9O1xuXG4gIEZvY3VzLnByb3RvdHlwZS5fYXBwbHkgPSBmdW5jdGlvbiBfYXBwbHkoKSB7XG4gICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICBpZiAodGhpcy52YWx1ZSkge1xuICAgICAgdGhpcy50YXNrUXVldWUucXVldWVNaWNyb1Rhc2soZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoX3RoaXMyLnZhbHVlKSB7XG4gICAgICAgICAgX3RoaXMyLmVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZWxlbWVudC5ibHVyKCk7XG4gICAgfVxuICB9O1xuXG4gIEZvY3VzLnByb3RvdHlwZS5hdHRhY2hlZCA9IGZ1bmN0aW9uIGF0dGFjaGVkKCkge1xuICAgIHRoaXMuaXNBdHRhY2hlZCA9IHRydWU7XG4gICAgaWYgKHRoaXMubmVlZHNBcHBseSkge1xuICAgICAgdGhpcy5uZWVkc0FwcGx5ID0gZmFsc2U7XG4gICAgICB0aGlzLl9hcHBseSgpO1xuICAgIH1cbiAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLmZvY3VzTGlzdGVuZXIpO1xuICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgdGhpcy5ibHVyTGlzdGVuZXIpO1xuICB9O1xuXG4gIEZvY3VzLnByb3RvdHlwZS5kZXRhY2hlZCA9IGZ1bmN0aW9uIGRldGFjaGVkKCkge1xuICAgIHRoaXMuaXNBdHRhY2hlZCA9IGZhbHNlO1xuICAgIHRoaXMuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMuZm9jdXNMaXN0ZW5lcik7XG4gICAgdGhpcy5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2JsdXInLCB0aGlzLmJsdXJMaXN0ZW5lcik7XG4gIH07XG5cbiAgcmV0dXJuIEZvY3VzO1xufSgpKSB8fCBfY2xhc3MpIHx8IF9jbGFzcyk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9mb2N1cy5qc1xuLy8gbW9kdWxlIGlkID0gMzRcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5IaWRlID0gdW5kZWZpbmVkO1xuXG52YXIgX2RlYywgX2RlYzIsIF9jbGFzcztcblxudmFyIF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbiA9IHJlcXVpcmUoJ2F1cmVsaWEtZGVwZW5kZW5jeS1pbmplY3Rpb24nKTtcblxudmFyIF9hdXJlbGlhVGVtcGxhdGluZyA9IHJlcXVpcmUoJ2F1cmVsaWEtdGVtcGxhdGluZycpO1xuXG52YXIgX2F1cmVsaWFQYWwgPSByZXF1aXJlKCdhdXJlbGlhLXBhbCcpO1xuXG52YXIgX2F1cmVsaWFIaWRlU3R5bGUgPSByZXF1aXJlKCcuL2F1cmVsaWEtaGlkZS1zdHlsZScpO1xuXG5cblxudmFyIEhpZGUgPSBleHBvcnRzLkhpZGUgPSAoX2RlYyA9ICgwLCBfYXVyZWxpYVRlbXBsYXRpbmcuY3VzdG9tQXR0cmlidXRlKSgnaGlkZScpLCBfZGVjMiA9ICgwLCBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24uaW5qZWN0KShfYXVyZWxpYVBhbC5ET00uRWxlbWVudCwgX2F1cmVsaWFUZW1wbGF0aW5nLkFuaW1hdG9yLCBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24uT3B0aW9uYWwub2YoX2F1cmVsaWFQYWwuRE9NLmJvdW5kYXJ5LCB0cnVlKSksIF9kZWMoX2NsYXNzID0gX2RlYzIoX2NsYXNzID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBIaWRlKGVsZW1lbnQsIGFuaW1hdG9yLCBkb21Cb3VuZGFyeSkge1xuICAgIFxuXG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICB0aGlzLmFuaW1hdG9yID0gYW5pbWF0b3I7XG4gICAgdGhpcy5kb21Cb3VuZGFyeSA9IGRvbUJvdW5kYXJ5O1xuICB9XG5cbiAgSGlkZS5wcm90b3R5cGUuY3JlYXRlZCA9IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7XG4gICAgKDAsIF9hdXJlbGlhSGlkZVN0eWxlLmluamVjdEF1cmVsaWFIaWRlU3R5bGVBdEJvdW5kYXJ5KSh0aGlzLmRvbUJvdW5kYXJ5KTtcbiAgfTtcblxuICBIaWRlLnByb3RvdHlwZS52YWx1ZUNoYW5nZWQgPSBmdW5jdGlvbiB2YWx1ZUNoYW5nZWQobmV3VmFsdWUpIHtcbiAgICBpZiAobmV3VmFsdWUpIHtcbiAgICAgIHRoaXMuYW5pbWF0b3IuYWRkQ2xhc3ModGhpcy5lbGVtZW50LCBfYXVyZWxpYUhpZGVTdHlsZS5hdXJlbGlhSGlkZUNsYXNzTmFtZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYW5pbWF0b3IucmVtb3ZlQ2xhc3ModGhpcy5lbGVtZW50LCBfYXVyZWxpYUhpZGVTdHlsZS5hdXJlbGlhSGlkZUNsYXNzTmFtZSk7XG4gICAgfVxuICB9O1xuXG4gIEhpZGUucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiBiaW5kKGJpbmRpbmdDb250ZXh0KSB7XG4gICAgdGhpcy52YWx1ZUNoYW5nZWQodGhpcy52YWx1ZSk7XG4gIH07XG5cbiAgcmV0dXJuIEhpZGU7XG59KCkpIHx8IF9jbGFzcykgfHwgX2NsYXNzKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L2NvbW1vbmpzL2hpZGUuanNcbi8vIG1vZHVsZSBpZCA9IDM1XG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuSWYgPSB1bmRlZmluZWQ7XG5cbnZhciBfZGVjLCBfZGVjMiwgX2NsYXNzO1xuXG52YXIgX2F1cmVsaWFUZW1wbGF0aW5nID0gcmVxdWlyZSgnYXVyZWxpYS10ZW1wbGF0aW5nJyk7XG5cbnZhciBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24gPSByZXF1aXJlKCdhdXJlbGlhLWRlcGVuZGVuY3ktaW5qZWN0aW9uJyk7XG5cblxuXG52YXIgSWYgPSBleHBvcnRzLklmID0gKF9kZWMgPSAoMCwgX2F1cmVsaWFUZW1wbGF0aW5nLmN1c3RvbUF0dHJpYnV0ZSkoJ2lmJyksIF9kZWMyID0gKDAsIF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbi5pbmplY3QpKF9hdXJlbGlhVGVtcGxhdGluZy5Cb3VuZFZpZXdGYWN0b3J5LCBfYXVyZWxpYVRlbXBsYXRpbmcuVmlld1Nsb3QpLCBfZGVjKF9jbGFzcyA9ICgwLCBfYXVyZWxpYVRlbXBsYXRpbmcudGVtcGxhdGVDb250cm9sbGVyKShfY2xhc3MgPSBfZGVjMihfY2xhc3MgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIElmKHZpZXdGYWN0b3J5LCB2aWV3U2xvdCkge1xuICAgIFxuXG4gICAgdGhpcy52aWV3RmFjdG9yeSA9IHZpZXdGYWN0b3J5O1xuICAgIHRoaXMudmlld1Nsb3QgPSB2aWV3U2xvdDtcbiAgICB0aGlzLnNob3dpbmcgPSBmYWxzZTtcbiAgICB0aGlzLnZpZXcgPSBudWxsO1xuICAgIHRoaXMuYmluZGluZ0NvbnRleHQgPSBudWxsO1xuICAgIHRoaXMub3ZlcnJpZGVDb250ZXh0ID0gbnVsbDtcbiAgfVxuXG4gIElmLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KSB7XG4gICAgdGhpcy5iaW5kaW5nQ29udGV4dCA9IGJpbmRpbmdDb250ZXh0O1xuICAgIHRoaXMub3ZlcnJpZGVDb250ZXh0ID0gb3ZlcnJpZGVDb250ZXh0O1xuICAgIHRoaXMudmFsdWVDaGFuZ2VkKHRoaXMudmFsdWUpO1xuICB9O1xuXG4gIElmLnByb3RvdHlwZS52YWx1ZUNoYW5nZWQgPSBmdW5jdGlvbiB2YWx1ZUNoYW5nZWQobmV3VmFsdWUpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgaWYgKHRoaXMuX19xdWV1ZWRDaGFuZ2VzKSB7XG4gICAgICB0aGlzLl9fcXVldWVkQ2hhbmdlcy5wdXNoKG5ld1ZhbHVlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgbWF5YmVQcm9taXNlID0gdGhpcy5fcnVuVmFsdWVDaGFuZ2VkKG5ld1ZhbHVlKTtcbiAgICBpZiAobWF5YmVQcm9taXNlIGluc3RhbmNlb2YgUHJvbWlzZSkge1xuICAgICAgKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHF1ZXVlZENoYW5nZXMgPSBfdGhpcy5fX3F1ZXVlZENoYW5nZXMgPSBbXTtcblxuICAgICAgICB2YXIgcnVuUXVldWVkQ2hhbmdlcyA9IGZ1bmN0aW9uIHJ1blF1ZXVlZENoYW5nZXMoKSB7XG4gICAgICAgICAgaWYgKCFxdWV1ZWRDaGFuZ2VzLmxlbmd0aCkge1xuICAgICAgICAgICAgX3RoaXMuX19xdWV1ZWRDaGFuZ2VzID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHZhciBuZXh0UHJvbWlzZSA9IF90aGlzLl9ydW5WYWx1ZUNoYW5nZWQocXVldWVkQ2hhbmdlcy5zaGlmdCgpKSB8fCBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgICBuZXh0UHJvbWlzZS50aGVuKHJ1blF1ZXVlZENoYW5nZXMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIG1heWJlUHJvbWlzZS50aGVuKHJ1blF1ZXVlZENoYW5nZXMpO1xuICAgICAgfSkoKTtcbiAgICB9XG4gIH07XG5cbiAgSWYucHJvdG90eXBlLl9ydW5WYWx1ZUNoYW5nZWQgPSBmdW5jdGlvbiBfcnVuVmFsdWVDaGFuZ2VkKG5ld1ZhbHVlKSB7XG4gICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICBpZiAoIW5ld1ZhbHVlKSB7XG4gICAgICB2YXIgdmlld09yUHJvbWlzZSA9IHZvaWQgMDtcbiAgICAgIGlmICh0aGlzLnZpZXcgIT09IG51bGwgJiYgdGhpcy5zaG93aW5nKSB7XG4gICAgICAgIHZpZXdPclByb21pc2UgPSB0aGlzLnZpZXdTbG90LnJlbW92ZSh0aGlzLnZpZXcpO1xuICAgICAgICBpZiAodmlld09yUHJvbWlzZSBpbnN0YW5jZW9mIFByb21pc2UpIHtcbiAgICAgICAgICB2aWV3T3JQcm9taXNlLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzMi52aWV3LnVuYmluZCgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMudmlldy51bmJpbmQoKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLnNob3dpbmcgPSBmYWxzZTtcbiAgICAgIHJldHVybiB2aWV3T3JQcm9taXNlO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnZpZXcgPT09IG51bGwpIHtcbiAgICAgIHRoaXMudmlldyA9IHRoaXMudmlld0ZhY3RvcnkuY3JlYXRlKCk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLnZpZXcuaXNCb3VuZCkge1xuICAgICAgdGhpcy52aWV3LmJpbmQodGhpcy5iaW5kaW5nQ29udGV4dCwgdGhpcy5vdmVycmlkZUNvbnRleHQpO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5zaG93aW5nKSB7XG4gICAgICB0aGlzLnNob3dpbmcgPSB0cnVlO1xuICAgICAgcmV0dXJuIHRoaXMudmlld1Nsb3QuYWRkKHRoaXMudmlldyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfTtcblxuICBJZi5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gdW5iaW5kKCkge1xuICAgIGlmICh0aGlzLnZpZXcgPT09IG51bGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLnZpZXcudW5iaW5kKCk7XG5cbiAgICBpZiAoIXRoaXMudmlld0ZhY3RvcnkuaXNDYWNoaW5nKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc2hvd2luZykge1xuICAgICAgdGhpcy5zaG93aW5nID0gZmFsc2U7XG4gICAgICB0aGlzLnZpZXdTbG90LnJlbW92ZSh0aGlzLnZpZXcsIHRydWUsIHRydWUpO1xuICAgIH1cbiAgICB0aGlzLnZpZXcucmV0dXJuVG9DYWNoZSgpO1xuICAgIHRoaXMudmlldyA9IG51bGw7XG4gIH07XG5cbiAgcmV0dXJuIElmO1xufSgpKSB8fCBfY2xhc3MpIHx8IF9jbGFzcykgfHwgX2NsYXNzKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L2NvbW1vbmpzL2lmLmpzXG4vLyBtb2R1bGUgaWQgPSAzNlxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLlJlcGVhdCA9IHVuZGVmaW5lZDtcblxudmFyIF9kZWMsIF9kZWMyLCBfY2xhc3MsIF9kZXNjLCBfdmFsdWUsIF9jbGFzczIsIF9kZXNjcmlwdG9yLCBfZGVzY3JpcHRvcjIsIF9kZXNjcmlwdG9yMywgX2Rlc2NyaXB0b3I0O1xuXG52YXIgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uID0gcmVxdWlyZSgnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbicpO1xuXG52YXIgX2F1cmVsaWFCaW5kaW5nID0gcmVxdWlyZSgnYXVyZWxpYS1iaW5kaW5nJyk7XG5cbnZhciBfYXVyZWxpYVRlbXBsYXRpbmcgPSByZXF1aXJlKCdhdXJlbGlhLXRlbXBsYXRpbmcnKTtcblxudmFyIF9yZXBlYXRTdHJhdGVneUxvY2F0b3IgPSByZXF1aXJlKCcuL3JlcGVhdC1zdHJhdGVneS1sb2NhdG9yJyk7XG5cbnZhciBfcmVwZWF0VXRpbGl0aWVzID0gcmVxdWlyZSgnLi9yZXBlYXQtdXRpbGl0aWVzJyk7XG5cbnZhciBfYW5hbHl6ZVZpZXdGYWN0b3J5ID0gcmVxdWlyZSgnLi9hbmFseXplLXZpZXctZmFjdG9yeScpO1xuXG52YXIgX2Fic3RyYWN0UmVwZWF0ZXIgPSByZXF1aXJlKCcuL2Fic3RyYWN0LXJlcGVhdGVyJyk7XG5cbmZ1bmN0aW9uIF9pbml0RGVmaW5lUHJvcCh0YXJnZXQsIHByb3BlcnR5LCBkZXNjcmlwdG9yLCBjb250ZXh0KSB7XG4gIGlmICghZGVzY3JpcHRvcikgcmV0dXJuO1xuICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBwcm9wZXJ0eSwge1xuICAgIGVudW1lcmFibGU6IGRlc2NyaXB0b3IuZW51bWVyYWJsZSxcbiAgICBjb25maWd1cmFibGU6IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlLFxuICAgIHdyaXRhYmxlOiBkZXNjcmlwdG9yLndyaXRhYmxlLFxuICAgIHZhbHVlOiBkZXNjcmlwdG9yLmluaXRpYWxpemVyID8gZGVzY3JpcHRvci5pbml0aWFsaXplci5jYWxsKGNvbnRleHQpIDogdm9pZCAwXG4gIH0pO1xufVxuXG5cblxuZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoIXNlbGYpIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKFwidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkXCIpOyB9IHJldHVybiBjYWxsICYmICh0eXBlb2YgY2FsbCA9PT0gXCJvYmplY3RcIiB8fCB0eXBlb2YgY2FsbCA9PT0gXCJmdW5jdGlvblwiKSA/IGNhbGwgOiBzZWxmOyB9XG5cbmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09IFwiZnVuY3Rpb25cIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90IFwiICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfVxuXG5mdW5jdGlvbiBfYXBwbHlEZWNvcmF0ZWREZXNjcmlwdG9yKHRhcmdldCwgcHJvcGVydHksIGRlY29yYXRvcnMsIGRlc2NyaXB0b3IsIGNvbnRleHQpIHtcbiAgdmFyIGRlc2MgPSB7fTtcbiAgT2JqZWN0WydrZScgKyAneXMnXShkZXNjcmlwdG9yKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICBkZXNjW2tleV0gPSBkZXNjcmlwdG9yW2tleV07XG4gIH0pO1xuICBkZXNjLmVudW1lcmFibGUgPSAhIWRlc2MuZW51bWVyYWJsZTtcbiAgZGVzYy5jb25maWd1cmFibGUgPSAhIWRlc2MuY29uZmlndXJhYmxlO1xuXG4gIGlmICgndmFsdWUnIGluIGRlc2MgfHwgZGVzYy5pbml0aWFsaXplcikge1xuICAgIGRlc2Mud3JpdGFibGUgPSB0cnVlO1xuICB9XG5cbiAgZGVzYyA9IGRlY29yYXRvcnMuc2xpY2UoKS5yZXZlcnNlKCkucmVkdWNlKGZ1bmN0aW9uIChkZXNjLCBkZWNvcmF0b3IpIHtcbiAgICByZXR1cm4gZGVjb3JhdG9yKHRhcmdldCwgcHJvcGVydHksIGRlc2MpIHx8IGRlc2M7XG4gIH0sIGRlc2MpO1xuXG4gIGlmIChjb250ZXh0ICYmIGRlc2MuaW5pdGlhbGl6ZXIgIT09IHZvaWQgMCkge1xuICAgIGRlc2MudmFsdWUgPSBkZXNjLmluaXRpYWxpemVyID8gZGVzYy5pbml0aWFsaXplci5jYWxsKGNvbnRleHQpIDogdm9pZCAwO1xuICAgIGRlc2MuaW5pdGlhbGl6ZXIgPSB1bmRlZmluZWQ7XG4gIH1cblxuICBpZiAoZGVzYy5pbml0aWFsaXplciA9PT0gdm9pZCAwKSB7XG4gICAgT2JqZWN0WydkZWZpbmUnICsgJ1Byb3BlcnR5J10odGFyZ2V0LCBwcm9wZXJ0eSwgZGVzYyk7XG4gICAgZGVzYyA9IG51bGw7XG4gIH1cblxuICByZXR1cm4gZGVzYztcbn1cblxuZnVuY3Rpb24gX2luaXRpYWxpemVyV2FybmluZ0hlbHBlcihkZXNjcmlwdG9yLCBjb250ZXh0KSB7XG4gIHRocm93IG5ldyBFcnJvcignRGVjb3JhdGluZyBjbGFzcyBwcm9wZXJ0eSBmYWlsZWQuIFBsZWFzZSBlbnN1cmUgdGhhdCB0cmFuc2Zvcm0tY2xhc3MtcHJvcGVydGllcyBpcyBlbmFibGVkLicpO1xufVxuXG52YXIgUmVwZWF0ID0gZXhwb3J0cy5SZXBlYXQgPSAoX2RlYyA9ICgwLCBfYXVyZWxpYVRlbXBsYXRpbmcuY3VzdG9tQXR0cmlidXRlKSgncmVwZWF0JyksIF9kZWMyID0gKDAsIF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbi5pbmplY3QpKF9hdXJlbGlhVGVtcGxhdGluZy5Cb3VuZFZpZXdGYWN0b3J5LCBfYXVyZWxpYVRlbXBsYXRpbmcuVGFyZ2V0SW5zdHJ1Y3Rpb24sIF9hdXJlbGlhVGVtcGxhdGluZy5WaWV3U2xvdCwgX2F1cmVsaWFUZW1wbGF0aW5nLlZpZXdSZXNvdXJjZXMsIF9hdXJlbGlhQmluZGluZy5PYnNlcnZlckxvY2F0b3IsIF9yZXBlYXRTdHJhdGVneUxvY2F0b3IuUmVwZWF0U3RyYXRlZ3lMb2NhdG9yKSwgX2RlYyhfY2xhc3MgPSAoMCwgX2F1cmVsaWFUZW1wbGF0aW5nLnRlbXBsYXRlQ29udHJvbGxlcikoX2NsYXNzID0gX2RlYzIoX2NsYXNzID0gKF9jbGFzczIgPSBmdW5jdGlvbiAoX0Fic3RyYWN0UmVwZWF0ZXIpIHtcbiAgX2luaGVyaXRzKFJlcGVhdCwgX0Fic3RyYWN0UmVwZWF0ZXIpO1xuXG4gIGZ1bmN0aW9uIFJlcGVhdCh2aWV3RmFjdG9yeSwgaW5zdHJ1Y3Rpb24sIHZpZXdTbG90LCB2aWV3UmVzb3VyY2VzLCBvYnNlcnZlckxvY2F0b3IsIHN0cmF0ZWd5TG9jYXRvcikge1xuICAgIFxuXG4gICAgdmFyIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX0Fic3RyYWN0UmVwZWF0ZXIuY2FsbCh0aGlzLCB7XG4gICAgICBsb2NhbDogJ2l0ZW0nLFxuICAgICAgdmlld3NSZXF1aXJlTGlmZWN5Y2xlOiAoMCwgX2FuYWx5emVWaWV3RmFjdG9yeS52aWV3c1JlcXVpcmVMaWZlY3ljbGUpKHZpZXdGYWN0b3J5KVxuICAgIH0pKTtcblxuICAgIF9pbml0RGVmaW5lUHJvcChfdGhpcywgJ2l0ZW1zJywgX2Rlc2NyaXB0b3IsIF90aGlzKTtcblxuICAgIF9pbml0RGVmaW5lUHJvcChfdGhpcywgJ2xvY2FsJywgX2Rlc2NyaXB0b3IyLCBfdGhpcyk7XG5cbiAgICBfaW5pdERlZmluZVByb3AoX3RoaXMsICdrZXknLCBfZGVzY3JpcHRvcjMsIF90aGlzKTtcblxuICAgIF9pbml0RGVmaW5lUHJvcChfdGhpcywgJ3ZhbHVlJywgX2Rlc2NyaXB0b3I0LCBfdGhpcyk7XG5cbiAgICBfdGhpcy52aWV3RmFjdG9yeSA9IHZpZXdGYWN0b3J5O1xuICAgIF90aGlzLmluc3RydWN0aW9uID0gaW5zdHJ1Y3Rpb247XG4gICAgX3RoaXMudmlld1Nsb3QgPSB2aWV3U2xvdDtcbiAgICBfdGhpcy5sb29rdXBGdW5jdGlvbnMgPSB2aWV3UmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucztcbiAgICBfdGhpcy5vYnNlcnZlckxvY2F0b3IgPSBvYnNlcnZlckxvY2F0b3I7XG4gICAgX3RoaXMua2V5ID0gJ2tleSc7XG4gICAgX3RoaXMudmFsdWUgPSAndmFsdWUnO1xuICAgIF90aGlzLnN0cmF0ZWd5TG9jYXRvciA9IHN0cmF0ZWd5TG9jYXRvcjtcbiAgICBfdGhpcy5pZ25vcmVNdXRhdGlvbiA9IGZhbHNlO1xuICAgIF90aGlzLnNvdXJjZUV4cHJlc3Npb24gPSAoMCwgX3JlcGVhdFV0aWxpdGllcy5nZXRJdGVtc1NvdXJjZUV4cHJlc3Npb24pKF90aGlzLmluc3RydWN0aW9uLCAncmVwZWF0LmZvcicpO1xuICAgIF90aGlzLmlzT25lVGltZSA9ICgwLCBfcmVwZWF0VXRpbGl0aWVzLmlzT25lVGltZSkoX3RoaXMuc291cmNlRXhwcmVzc2lvbik7XG4gICAgX3RoaXMudmlld3NSZXF1aXJlTGlmZWN5Y2xlID0gKDAsIF9hbmFseXplVmlld0ZhY3Rvcnkudmlld3NSZXF1aXJlTGlmZWN5Y2xlKSh2aWV3RmFjdG9yeSk7XG4gICAgcmV0dXJuIF90aGlzO1xuICB9XG5cbiAgUmVwZWF0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gY2FsbChjb250ZXh0LCBjaGFuZ2VzKSB7XG4gICAgdGhpc1tjb250ZXh0XSh0aGlzLml0ZW1zLCBjaGFuZ2VzKTtcbiAgfTtcblxuICBSZXBlYXQucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiBiaW5kKGJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpIHtcbiAgICB0aGlzLnNjb3BlID0geyBiaW5kaW5nQ29udGV4dDogYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dDogb3ZlcnJpZGVDb250ZXh0IH07XG4gICAgdGhpcy5tYXRjaGVyQmluZGluZyA9IHRoaXMuX2NhcHR1cmVBbmRSZW1vdmVNYXRjaGVyQmluZGluZygpO1xuICAgIHRoaXMuaXRlbXNDaGFuZ2VkKCk7XG4gIH07XG5cbiAgUmVwZWF0LnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiB1bmJpbmQoKSB7XG4gICAgdGhpcy5zY29wZSA9IG51bGw7XG4gICAgdGhpcy5pdGVtcyA9IG51bGw7XG4gICAgdGhpcy5tYXRjaGVyQmluZGluZyA9IG51bGw7XG4gICAgdGhpcy52aWV3U2xvdC5yZW1vdmVBbGwodHJ1ZSk7XG4gICAgdGhpcy5fdW5zdWJzY3JpYmVDb2xsZWN0aW9uKCk7XG4gIH07XG5cbiAgUmVwZWF0LnByb3RvdHlwZS5fdW5zdWJzY3JpYmVDb2xsZWN0aW9uID0gZnVuY3Rpb24gX3Vuc3Vic2NyaWJlQ29sbGVjdGlvbigpIHtcbiAgICBpZiAodGhpcy5jb2xsZWN0aW9uT2JzZXJ2ZXIpIHtcbiAgICAgIHRoaXMuY29sbGVjdGlvbk9ic2VydmVyLnVuc3Vic2NyaWJlKHRoaXMuY2FsbENvbnRleHQsIHRoaXMpO1xuICAgICAgdGhpcy5jb2xsZWN0aW9uT2JzZXJ2ZXIgPSBudWxsO1xuICAgICAgdGhpcy5jYWxsQ29udGV4dCA9IG51bGw7XG4gICAgfVxuICB9O1xuXG4gIFJlcGVhdC5wcm90b3R5cGUuaXRlbXNDaGFuZ2VkID0gZnVuY3Rpb24gaXRlbXNDaGFuZ2VkKCkge1xuICAgIHRoaXMuX3Vuc3Vic2NyaWJlQ29sbGVjdGlvbigpO1xuXG4gICAgaWYgKCF0aGlzLnNjb3BlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIGl0ZW1zID0gdGhpcy5pdGVtcztcbiAgICB0aGlzLnN0cmF0ZWd5ID0gdGhpcy5zdHJhdGVneUxvY2F0b3IuZ2V0U3RyYXRlZ3koaXRlbXMpO1xuICAgIGlmICghdGhpcy5zdHJhdGVneSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdWYWx1ZSBmb3IgXFwnJyArIHRoaXMuc291cmNlRXhwcmVzc2lvbiArICdcXCcgaXMgbm9uLXJlcGVhdGFibGUnKTtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMuaXNPbmVUaW1lICYmICF0aGlzLl9vYnNlcnZlSW5uZXJDb2xsZWN0aW9uKCkpIHtcbiAgICAgIHRoaXMuX29ic2VydmVDb2xsZWN0aW9uKCk7XG4gICAgfVxuICAgIHRoaXMuc3RyYXRlZ3kuaW5zdGFuY2VDaGFuZ2VkKHRoaXMsIGl0ZW1zKTtcbiAgfTtcblxuICBSZXBlYXQucHJvdG90eXBlLl9nZXRJbm5lckNvbGxlY3Rpb24gPSBmdW5jdGlvbiBfZ2V0SW5uZXJDb2xsZWN0aW9uKCkge1xuICAgIHZhciBleHByZXNzaW9uID0gKDAsIF9yZXBlYXRVdGlsaXRpZXMudW53cmFwRXhwcmVzc2lvbikodGhpcy5zb3VyY2VFeHByZXNzaW9uKTtcbiAgICBpZiAoIWV4cHJlc3Npb24pIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gZXhwcmVzc2lvbi5ldmFsdWF0ZSh0aGlzLnNjb3BlLCBudWxsKTtcbiAgfTtcblxuICBSZXBlYXQucHJvdG90eXBlLmhhbmRsZUNvbGxlY3Rpb25NdXRhdGVkID0gZnVuY3Rpb24gaGFuZGxlQ29sbGVjdGlvbk11dGF0ZWQoY29sbGVjdGlvbiwgY2hhbmdlcykge1xuICAgIGlmICghdGhpcy5jb2xsZWN0aW9uT2JzZXJ2ZXIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5zdHJhdGVneS5pbnN0YW5jZU11dGF0ZWQodGhpcywgY29sbGVjdGlvbiwgY2hhbmdlcyk7XG4gIH07XG5cbiAgUmVwZWF0LnByb3RvdHlwZS5oYW5kbGVJbm5lckNvbGxlY3Rpb25NdXRhdGVkID0gZnVuY3Rpb24gaGFuZGxlSW5uZXJDb2xsZWN0aW9uTXV0YXRlZChjb2xsZWN0aW9uLCBjaGFuZ2VzKSB7XG4gICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICBpZiAoIXRoaXMuY29sbGVjdGlvbk9ic2VydmVyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaWdub3JlTXV0YXRpb24pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5pZ25vcmVNdXRhdGlvbiA9IHRydWU7XG4gICAgdmFyIG5ld0l0ZW1zID0gdGhpcy5zb3VyY2VFeHByZXNzaW9uLmV2YWx1YXRlKHRoaXMuc2NvcGUsIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcbiAgICB0aGlzLm9ic2VydmVyTG9jYXRvci50YXNrUXVldWUucXVldWVNaWNyb1Rhc2soZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIF90aGlzMi5pZ25vcmVNdXRhdGlvbiA9IGZhbHNlO1xuICAgIH0pO1xuXG4gICAgaWYgKG5ld0l0ZW1zID09PSB0aGlzLml0ZW1zKSB7XG4gICAgICB0aGlzLml0ZW1zQ2hhbmdlZCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLml0ZW1zID0gbmV3SXRlbXM7XG4gICAgfVxuICB9O1xuXG4gIFJlcGVhdC5wcm90b3R5cGUuX29ic2VydmVJbm5lckNvbGxlY3Rpb24gPSBmdW5jdGlvbiBfb2JzZXJ2ZUlubmVyQ29sbGVjdGlvbigpIHtcbiAgICB2YXIgaXRlbXMgPSB0aGlzLl9nZXRJbm5lckNvbGxlY3Rpb24oKTtcbiAgICB2YXIgc3RyYXRlZ3kgPSB0aGlzLnN0cmF0ZWd5TG9jYXRvci5nZXRTdHJhdGVneShpdGVtcyk7XG4gICAgaWYgKCFzdHJhdGVneSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLmNvbGxlY3Rpb25PYnNlcnZlciA9IHN0cmF0ZWd5LmdldENvbGxlY3Rpb25PYnNlcnZlcih0aGlzLm9ic2VydmVyTG9jYXRvciwgaXRlbXMpO1xuICAgIGlmICghdGhpcy5jb2xsZWN0aW9uT2JzZXJ2ZXIpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5jYWxsQ29udGV4dCA9ICdoYW5kbGVJbm5lckNvbGxlY3Rpb25NdXRhdGVkJztcbiAgICB0aGlzLmNvbGxlY3Rpb25PYnNlcnZlci5zdWJzY3JpYmUodGhpcy5jYWxsQ29udGV4dCwgdGhpcyk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH07XG5cbiAgUmVwZWF0LnByb3RvdHlwZS5fb2JzZXJ2ZUNvbGxlY3Rpb24gPSBmdW5jdGlvbiBfb2JzZXJ2ZUNvbGxlY3Rpb24oKSB7XG4gICAgdmFyIGl0ZW1zID0gdGhpcy5pdGVtcztcbiAgICB0aGlzLmNvbGxlY3Rpb25PYnNlcnZlciA9IHRoaXMuc3RyYXRlZ3kuZ2V0Q29sbGVjdGlvbk9ic2VydmVyKHRoaXMub2JzZXJ2ZXJMb2NhdG9yLCBpdGVtcyk7XG4gICAgaWYgKHRoaXMuY29sbGVjdGlvbk9ic2VydmVyKSB7XG4gICAgICB0aGlzLmNhbGxDb250ZXh0ID0gJ2hhbmRsZUNvbGxlY3Rpb25NdXRhdGVkJztcbiAgICAgIHRoaXMuY29sbGVjdGlvbk9ic2VydmVyLnN1YnNjcmliZSh0aGlzLmNhbGxDb250ZXh0LCB0aGlzKTtcbiAgICB9XG4gIH07XG5cbiAgUmVwZWF0LnByb3RvdHlwZS5fY2FwdHVyZUFuZFJlbW92ZU1hdGNoZXJCaW5kaW5nID0gZnVuY3Rpb24gX2NhcHR1cmVBbmRSZW1vdmVNYXRjaGVyQmluZGluZygpIHtcbiAgICBpZiAodGhpcy52aWV3RmFjdG9yeS52aWV3RmFjdG9yeSkge1xuICAgICAgdmFyIGluc3RydWN0aW9ucyA9IHRoaXMudmlld0ZhY3Rvcnkudmlld0ZhY3RvcnkuaW5zdHJ1Y3Rpb25zO1xuICAgICAgdmFyIGluc3RydWN0aW9uSWRzID0gT2JqZWN0LmtleXMoaW5zdHJ1Y3Rpb25zKTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5zdHJ1Y3Rpb25JZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGV4cHJlc3Npb25zID0gaW5zdHJ1Y3Rpb25zW2luc3RydWN0aW9uSWRzW2ldXS5leHByZXNzaW9ucztcbiAgICAgICAgaWYgKGV4cHJlc3Npb25zKSB7XG4gICAgICAgICAgZm9yICh2YXIgaWkgPSAwOyBpIDwgZXhwcmVzc2lvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChleHByZXNzaW9uc1tpaV0udGFyZ2V0UHJvcGVydHkgPT09ICdtYXRjaGVyJykge1xuICAgICAgICAgICAgICB2YXIgbWF0Y2hlckJpbmRpbmcgPSBleHByZXNzaW9uc1tpaV07XG4gICAgICAgICAgICAgIGV4cHJlc3Npb25zLnNwbGljZShpaSwgMSk7XG4gICAgICAgICAgICAgIHJldHVybiBtYXRjaGVyQmluZGluZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9O1xuXG4gIFJlcGVhdC5wcm90b3R5cGUudmlld0NvdW50ID0gZnVuY3Rpb24gdmlld0NvdW50KCkge1xuICAgIHJldHVybiB0aGlzLnZpZXdTbG90LmNoaWxkcmVuLmxlbmd0aDtcbiAgfTtcblxuICBSZXBlYXQucHJvdG90eXBlLnZpZXdzID0gZnVuY3Rpb24gdmlld3MoKSB7XG4gICAgcmV0dXJuIHRoaXMudmlld1Nsb3QuY2hpbGRyZW47XG4gIH07XG5cbiAgUmVwZWF0LnByb3RvdHlwZS52aWV3ID0gZnVuY3Rpb24gdmlldyhpbmRleCkge1xuICAgIHJldHVybiB0aGlzLnZpZXdTbG90LmNoaWxkcmVuW2luZGV4XTtcbiAgfTtcblxuICBSZXBlYXQucHJvdG90eXBlLm1hdGNoZXIgPSBmdW5jdGlvbiBtYXRjaGVyKCkge1xuICAgIHJldHVybiB0aGlzLm1hdGNoZXJCaW5kaW5nID8gdGhpcy5tYXRjaGVyQmluZGluZy5zb3VyY2VFeHByZXNzaW9uLmV2YWx1YXRlKHRoaXMuc2NvcGUsIHRoaXMubWF0Y2hlckJpbmRpbmcubG9va3VwRnVuY3Rpb25zKSA6IG51bGw7XG4gIH07XG5cbiAgUmVwZWF0LnByb3RvdHlwZS5hZGRWaWV3ID0gZnVuY3Rpb24gYWRkVmlldyhiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KSB7XG4gICAgdmFyIHZpZXcgPSB0aGlzLnZpZXdGYWN0b3J5LmNyZWF0ZSgpO1xuICAgIHZpZXcuYmluZChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KTtcbiAgICB0aGlzLnZpZXdTbG90LmFkZCh2aWV3KTtcbiAgfTtcblxuICBSZXBlYXQucHJvdG90eXBlLmluc2VydFZpZXcgPSBmdW5jdGlvbiBpbnNlcnRWaWV3KGluZGV4LCBiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KSB7XG4gICAgdmFyIHZpZXcgPSB0aGlzLnZpZXdGYWN0b3J5LmNyZWF0ZSgpO1xuICAgIHZpZXcuYmluZChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KTtcbiAgICB0aGlzLnZpZXdTbG90Lmluc2VydChpbmRleCwgdmlldyk7XG4gIH07XG5cbiAgUmVwZWF0LnByb3RvdHlwZS5tb3ZlVmlldyA9IGZ1bmN0aW9uIG1vdmVWaWV3KHNvdXJjZUluZGV4LCB0YXJnZXRJbmRleCkge1xuICAgIHRoaXMudmlld1Nsb3QubW92ZShzb3VyY2VJbmRleCwgdGFyZ2V0SW5kZXgpO1xuICB9O1xuXG4gIFJlcGVhdC5wcm90b3R5cGUucmVtb3ZlQWxsVmlld3MgPSBmdW5jdGlvbiByZW1vdmVBbGxWaWV3cyhyZXR1cm5Ub0NhY2hlLCBza2lwQW5pbWF0aW9uKSB7XG4gICAgcmV0dXJuIHRoaXMudmlld1Nsb3QucmVtb3ZlQWxsKHJldHVyblRvQ2FjaGUsIHNraXBBbmltYXRpb24pO1xuICB9O1xuXG4gIFJlcGVhdC5wcm90b3R5cGUucmVtb3ZlVmlld3MgPSBmdW5jdGlvbiByZW1vdmVWaWV3cyh2aWV3c1RvUmVtb3ZlLCByZXR1cm5Ub0NhY2hlLCBza2lwQW5pbWF0aW9uKSB7XG4gICAgcmV0dXJuIHRoaXMudmlld1Nsb3QucmVtb3ZlTWFueSh2aWV3c1RvUmVtb3ZlLCByZXR1cm5Ub0NhY2hlLCBza2lwQW5pbWF0aW9uKTtcbiAgfTtcblxuICBSZXBlYXQucHJvdG90eXBlLnJlbW92ZVZpZXcgPSBmdW5jdGlvbiByZW1vdmVWaWV3KGluZGV4LCByZXR1cm5Ub0NhY2hlLCBza2lwQW5pbWF0aW9uKSB7XG4gICAgcmV0dXJuIHRoaXMudmlld1Nsb3QucmVtb3ZlQXQoaW5kZXgsIHJldHVyblRvQ2FjaGUsIHNraXBBbmltYXRpb24pO1xuICB9O1xuXG4gIFJlcGVhdC5wcm90b3R5cGUudXBkYXRlQmluZGluZ3MgPSBmdW5jdGlvbiB1cGRhdGVCaW5kaW5ncyh2aWV3KSB7XG4gICAgdmFyIGogPSB2aWV3LmJpbmRpbmdzLmxlbmd0aDtcbiAgICB3aGlsZSAoai0tKSB7XG4gICAgICAoMCwgX3JlcGVhdFV0aWxpdGllcy51cGRhdGVPbmVUaW1lQmluZGluZykodmlldy5iaW5kaW5nc1tqXSk7XG4gICAgfVxuICAgIGogPSB2aWV3LmNvbnRyb2xsZXJzLmxlbmd0aDtcbiAgICB3aGlsZSAoai0tKSB7XG4gICAgICB2YXIgayA9IHZpZXcuY29udHJvbGxlcnNbal0uYm91bmRQcm9wZXJ0aWVzLmxlbmd0aDtcbiAgICAgIHdoaWxlIChrLS0pIHtcbiAgICAgICAgdmFyIGJpbmRpbmcgPSB2aWV3LmNvbnRyb2xsZXJzW2pdLmJvdW5kUHJvcGVydGllc1trXS5iaW5kaW5nO1xuICAgICAgICAoMCwgX3JlcGVhdFV0aWxpdGllcy51cGRhdGVPbmVUaW1lQmluZGluZykoYmluZGluZyk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBSZXBlYXQ7XG59KF9hYnN0cmFjdFJlcGVhdGVyLkFic3RyYWN0UmVwZWF0ZXIpLCAoX2Rlc2NyaXB0b3IgPSBfYXBwbHlEZWNvcmF0ZWREZXNjcmlwdG9yKF9jbGFzczIucHJvdG90eXBlLCAnaXRlbXMnLCBbX2F1cmVsaWFUZW1wbGF0aW5nLmJpbmRhYmxlXSwge1xuICBlbnVtZXJhYmxlOiB0cnVlLFxuICBpbml0aWFsaXplcjogbnVsbFxufSksIF9kZXNjcmlwdG9yMiA9IF9hcHBseURlY29yYXRlZERlc2NyaXB0b3IoX2NsYXNzMi5wcm90b3R5cGUsICdsb2NhbCcsIFtfYXVyZWxpYVRlbXBsYXRpbmcuYmluZGFibGVdLCB7XG4gIGVudW1lcmFibGU6IHRydWUsXG4gIGluaXRpYWxpemVyOiBudWxsXG59KSwgX2Rlc2NyaXB0b3IzID0gX2FwcGx5RGVjb3JhdGVkRGVzY3JpcHRvcihfY2xhc3MyLnByb3RvdHlwZSwgJ2tleScsIFtfYXVyZWxpYVRlbXBsYXRpbmcuYmluZGFibGVdLCB7XG4gIGVudW1lcmFibGU6IHRydWUsXG4gIGluaXRpYWxpemVyOiBudWxsXG59KSwgX2Rlc2NyaXB0b3I0ID0gX2FwcGx5RGVjb3JhdGVkRGVzY3JpcHRvcihfY2xhc3MyLnByb3RvdHlwZSwgJ3ZhbHVlJywgW19hdXJlbGlhVGVtcGxhdGluZy5iaW5kYWJsZV0sIHtcbiAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgaW5pdGlhbGl6ZXI6IG51bGxcbn0pKSwgX2NsYXNzMikpIHx8IF9jbGFzcykgfHwgX2NsYXNzKSB8fCBfY2xhc3MpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzL2Rpc3QvY29tbW9uanMvcmVwZWF0LmpzXG4vLyBtb2R1bGUgaWQgPSAzN1xuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLlJlcGxhY2VhYmxlID0gdW5kZWZpbmVkO1xuXG52YXIgX2RlYywgX2RlYzIsIF9jbGFzcztcblxudmFyIF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbiA9IHJlcXVpcmUoJ2F1cmVsaWEtZGVwZW5kZW5jeS1pbmplY3Rpb24nKTtcblxudmFyIF9hdXJlbGlhVGVtcGxhdGluZyA9IHJlcXVpcmUoJ2F1cmVsaWEtdGVtcGxhdGluZycpO1xuXG5cblxudmFyIFJlcGxhY2VhYmxlID0gZXhwb3J0cy5SZXBsYWNlYWJsZSA9IChfZGVjID0gKDAsIF9hdXJlbGlhVGVtcGxhdGluZy5jdXN0b21BdHRyaWJ1dGUpKCdyZXBsYWNlYWJsZScpLCBfZGVjMiA9ICgwLCBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24uaW5qZWN0KShfYXVyZWxpYVRlbXBsYXRpbmcuQm91bmRWaWV3RmFjdG9yeSwgX2F1cmVsaWFUZW1wbGF0aW5nLlZpZXdTbG90KSwgX2RlYyhfY2xhc3MgPSAoMCwgX2F1cmVsaWFUZW1wbGF0aW5nLnRlbXBsYXRlQ29udHJvbGxlcikoX2NsYXNzID0gX2RlYzIoX2NsYXNzID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBSZXBsYWNlYWJsZSh2aWV3RmFjdG9yeSwgdmlld1Nsb3QpIHtcbiAgICBcblxuICAgIHRoaXMudmlld0ZhY3RvcnkgPSB2aWV3RmFjdG9yeTtcbiAgICB0aGlzLnZpZXdTbG90ID0gdmlld1Nsb3Q7XG4gICAgdGhpcy52aWV3ID0gbnVsbDtcbiAgfVxuXG4gIFJlcGxhY2VhYmxlLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KSB7XG4gICAgaWYgKHRoaXMudmlldyA9PT0gbnVsbCkge1xuICAgICAgdGhpcy52aWV3ID0gdGhpcy52aWV3RmFjdG9yeS5jcmVhdGUoKTtcbiAgICAgIHRoaXMudmlld1Nsb3QuYWRkKHRoaXMudmlldyk7XG4gICAgfVxuXG4gICAgdGhpcy52aWV3LmJpbmQoYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCk7XG4gIH07XG5cbiAgUmVwbGFjZWFibGUucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uIHVuYmluZCgpIHtcbiAgICB0aGlzLnZpZXcudW5iaW5kKCk7XG4gIH07XG5cbiAgcmV0dXJuIFJlcGxhY2VhYmxlO1xufSgpKSB8fCBfY2xhc3MpIHx8IF9jbGFzcykgfHwgX2NsYXNzKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L2NvbW1vbmpzL3JlcGxhY2VhYmxlLmpzXG4vLyBtb2R1bGUgaWQgPSAzOFxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLlNhbml0aXplSFRNTFZhbHVlQ29udmVydGVyID0gdW5kZWZpbmVkO1xuXG52YXIgX2RlYywgX2RlYzIsIF9jbGFzcztcblxudmFyIF9hdXJlbGlhQmluZGluZyA9IHJlcXVpcmUoJ2F1cmVsaWEtYmluZGluZycpO1xuXG52YXIgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uID0gcmVxdWlyZSgnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbicpO1xuXG52YXIgX2h0bWxTYW5pdGl6ZXIgPSByZXF1aXJlKCcuL2h0bWwtc2FuaXRpemVyJyk7XG5cblxuXG52YXIgU2FuaXRpemVIVE1MVmFsdWVDb252ZXJ0ZXIgPSBleHBvcnRzLlNhbml0aXplSFRNTFZhbHVlQ29udmVydGVyID0gKF9kZWMgPSAoMCwgX2F1cmVsaWFCaW5kaW5nLnZhbHVlQ29udmVydGVyKSgnc2FuaXRpemVIVE1MJyksIF9kZWMyID0gKDAsIF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbi5pbmplY3QpKF9odG1sU2FuaXRpemVyLkhUTUxTYW5pdGl6ZXIpLCBfZGVjKF9jbGFzcyA9IF9kZWMyKF9jbGFzcyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gU2FuaXRpemVIVE1MVmFsdWVDb252ZXJ0ZXIoc2FuaXRpemVyKSB7XG4gICAgXG5cbiAgICB0aGlzLnNhbml0aXplciA9IHNhbml0aXplcjtcbiAgfVxuXG4gIFNhbml0aXplSFRNTFZhbHVlQ29udmVydGVyLnByb3RvdHlwZS50b1ZpZXcgPSBmdW5jdGlvbiB0b1ZpZXcodW50cnVzdGVkTWFya3VwKSB7XG4gICAgaWYgKHVudHJ1c3RlZE1hcmt1cCA9PT0gbnVsbCB8fCB1bnRydXN0ZWRNYXJrdXAgPT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuc2FuaXRpemVyLnNhbml0aXplKHVudHJ1c3RlZE1hcmt1cCk7XG4gIH07XG5cbiAgcmV0dXJuIFNhbml0aXplSFRNTFZhbHVlQ29udmVydGVyO1xufSgpKSB8fCBfY2xhc3MpIHx8IF9jbGFzcyk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9zYW5pdGl6ZS1odG1sLmpzXG4vLyBtb2R1bGUgaWQgPSAzOVxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLlNob3cgPSB1bmRlZmluZWQ7XG5cbnZhciBfZGVjLCBfZGVjMiwgX2NsYXNzO1xuXG52YXIgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uID0gcmVxdWlyZSgnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbicpO1xuXG52YXIgX2F1cmVsaWFUZW1wbGF0aW5nID0gcmVxdWlyZSgnYXVyZWxpYS10ZW1wbGF0aW5nJyk7XG5cbnZhciBfYXVyZWxpYVBhbCA9IHJlcXVpcmUoJ2F1cmVsaWEtcGFsJyk7XG5cbnZhciBfYXVyZWxpYUhpZGVTdHlsZSA9IHJlcXVpcmUoJy4vYXVyZWxpYS1oaWRlLXN0eWxlJyk7XG5cblxuXG52YXIgU2hvdyA9IGV4cG9ydHMuU2hvdyA9IChfZGVjID0gKDAsIF9hdXJlbGlhVGVtcGxhdGluZy5jdXN0b21BdHRyaWJ1dGUpKCdzaG93JyksIF9kZWMyID0gKDAsIF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbi5pbmplY3QpKF9hdXJlbGlhUGFsLkRPTS5FbGVtZW50LCBfYXVyZWxpYVRlbXBsYXRpbmcuQW5pbWF0b3IsIF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbi5PcHRpb25hbC5vZihfYXVyZWxpYVBhbC5ET00uYm91bmRhcnksIHRydWUpKSwgX2RlYyhfY2xhc3MgPSBfZGVjMihfY2xhc3MgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFNob3coZWxlbWVudCwgYW5pbWF0b3IsIGRvbUJvdW5kYXJ5KSB7XG4gICAgXG5cbiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICAgIHRoaXMuYW5pbWF0b3IgPSBhbmltYXRvcjtcbiAgICB0aGlzLmRvbUJvdW5kYXJ5ID0gZG9tQm91bmRhcnk7XG4gIH1cblxuICBTaG93LnByb3RvdHlwZS5jcmVhdGVkID0gZnVuY3Rpb24gY3JlYXRlZCgpIHtcbiAgICAoMCwgX2F1cmVsaWFIaWRlU3R5bGUuaW5qZWN0QXVyZWxpYUhpZGVTdHlsZUF0Qm91bmRhcnkpKHRoaXMuZG9tQm91bmRhcnkpO1xuICB9O1xuXG4gIFNob3cucHJvdG90eXBlLnZhbHVlQ2hhbmdlZCA9IGZ1bmN0aW9uIHZhbHVlQ2hhbmdlZChuZXdWYWx1ZSkge1xuICAgIGlmIChuZXdWYWx1ZSkge1xuICAgICAgdGhpcy5hbmltYXRvci5yZW1vdmVDbGFzcyh0aGlzLmVsZW1lbnQsIF9hdXJlbGlhSGlkZVN0eWxlLmF1cmVsaWFIaWRlQ2xhc3NOYW1lKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5hbmltYXRvci5hZGRDbGFzcyh0aGlzLmVsZW1lbnQsIF9hdXJlbGlhSGlkZVN0eWxlLmF1cmVsaWFIaWRlQ2xhc3NOYW1lKTtcbiAgICB9XG4gIH07XG5cbiAgU2hvdy5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIGJpbmQoYmluZGluZ0NvbnRleHQpIHtcbiAgICB0aGlzLnZhbHVlQ2hhbmdlZCh0aGlzLnZhbHVlKTtcbiAgfTtcblxuICByZXR1cm4gU2hvdztcbn0oKSkgfHwgX2NsYXNzKSB8fCBfY2xhc3MpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzL2Rpc3QvY29tbW9uanMvc2hvdy5qc1xuLy8gbW9kdWxlIGlkID0gNDBcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5TaWduYWxCaW5kaW5nQmVoYXZpb3IgPSB1bmRlZmluZWQ7XG5cbnZhciBfYmluZGluZ1NpZ25hbGVyID0gcmVxdWlyZSgnLi9iaW5kaW5nLXNpZ25hbGVyJyk7XG5cblxuXG52YXIgU2lnbmFsQmluZGluZ0JlaGF2aW9yID0gZXhwb3J0cy5TaWduYWxCaW5kaW5nQmVoYXZpb3IgPSBmdW5jdGlvbiAoKSB7XG4gIFNpZ25hbEJpbmRpbmdCZWhhdmlvci5pbmplY3QgPSBmdW5jdGlvbiBpbmplY3QoKSB7XG4gICAgcmV0dXJuIFtfYmluZGluZ1NpZ25hbGVyLkJpbmRpbmdTaWduYWxlcl07XG4gIH07XG5cbiAgZnVuY3Rpb24gU2lnbmFsQmluZGluZ0JlaGF2aW9yKGJpbmRpbmdTaWduYWxlcikge1xuICAgIFxuXG4gICAgdGhpcy5zaWduYWxzID0gYmluZGluZ1NpZ25hbGVyLnNpZ25hbHM7XG4gIH1cblxuICBTaWduYWxCaW5kaW5nQmVoYXZpb3IucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiBiaW5kKGJpbmRpbmcsIHNvdXJjZSkge1xuICAgIGlmICghYmluZGluZy51cGRhdGVUYXJnZXQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignT25seSBwcm9wZXJ0eSBiaW5kaW5ncyBhbmQgc3RyaW5nIGludGVycG9sYXRpb24gYmluZGluZ3MgY2FuIGJlIHNpZ25hbGVkLiAgVHJpZ2dlciwgZGVsZWdhdGUgYW5kIGNhbGwgYmluZGluZ3MgY2Fubm90IGJlIHNpZ25hbGVkLicpO1xuICAgIH1cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMykge1xuICAgICAgdmFyIG5hbWUgPSBhcmd1bWVudHNbMl07XG4gICAgICB2YXIgYmluZGluZ3MgPSB0aGlzLnNpZ25hbHNbbmFtZV0gfHwgKHRoaXMuc2lnbmFsc1tuYW1lXSA9IFtdKTtcbiAgICAgIGJpbmRpbmdzLnB1c2goYmluZGluZyk7XG4gICAgICBiaW5kaW5nLnNpZ25hbE5hbWUgPSBuYW1lO1xuICAgIH0gZWxzZSBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDMpIHtcbiAgICAgIHZhciBuYW1lcyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMik7XG4gICAgICB2YXIgaSA9IG5hbWVzLmxlbmd0aDtcbiAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgdmFyIF9uYW1lID0gbmFtZXNbaV07XG4gICAgICAgIHZhciBfYmluZGluZ3MgPSB0aGlzLnNpZ25hbHNbX25hbWVdIHx8ICh0aGlzLnNpZ25hbHNbX25hbWVdID0gW10pO1xuICAgICAgICBfYmluZGluZ3MucHVzaChiaW5kaW5nKTtcbiAgICAgIH1cbiAgICAgIGJpbmRpbmcuc2lnbmFsTmFtZSA9IG5hbWVzO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NpZ25hbCBuYW1lIGlzIHJlcXVpcmVkLicpO1xuICAgIH1cbiAgfTtcblxuICBTaWduYWxCaW5kaW5nQmVoYXZpb3IucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uIHVuYmluZChiaW5kaW5nLCBzb3VyY2UpIHtcbiAgICB2YXIgbmFtZSA9IGJpbmRpbmcuc2lnbmFsTmFtZTtcbiAgICBiaW5kaW5nLnNpZ25hbE5hbWUgPSBudWxsO1xuICAgIGlmIChBcnJheS5pc0FycmF5KG5hbWUpKSB7XG4gICAgICB2YXIgbmFtZXMgPSBuYW1lO1xuICAgICAgdmFyIGkgPSBuYW1lcy5sZW5ndGg7XG4gICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgIHZhciBuID0gbmFtZXNbaV07XG4gICAgICAgIHZhciBiaW5kaW5ncyA9IHRoaXMuc2lnbmFsc1tuXTtcbiAgICAgICAgYmluZGluZ3Muc3BsaWNlKGJpbmRpbmdzLmluZGV4T2YoYmluZGluZyksIDEpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgX2JpbmRpbmdzMiA9IHRoaXMuc2lnbmFsc1tuYW1lXTtcbiAgICAgIF9iaW5kaW5nczIuc3BsaWNlKF9iaW5kaW5nczIuaW5kZXhPZihiaW5kaW5nKSwgMSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBTaWduYWxCaW5kaW5nQmVoYXZpb3I7XG59KCk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9zaWduYWwtYmluZGluZy1iZWhhdmlvci5qc1xuLy8gbW9kdWxlIGlkID0gNDFcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5UaHJvdHRsZUJpbmRpbmdCZWhhdmlvciA9IHVuZGVmaW5lZDtcblxudmFyIF9hdXJlbGlhQmluZGluZyA9IHJlcXVpcmUoJ2F1cmVsaWEtYmluZGluZycpO1xuXG5cblxuZnVuY3Rpb24gdGhyb3R0bGUobmV3VmFsdWUpIHtcbiAgdmFyIF90aGlzID0gdGhpcztcblxuICB2YXIgc3RhdGUgPSB0aGlzLnRocm90dGxlU3RhdGU7XG4gIHZhciBlbGFwc2VkID0gK25ldyBEYXRlKCkgLSBzdGF0ZS5sYXN0O1xuICBpZiAoZWxhcHNlZCA+PSBzdGF0ZS5kZWxheSkge1xuICAgIGNsZWFyVGltZW91dChzdGF0ZS50aW1lb3V0SWQpO1xuICAgIHN0YXRlLnRpbWVvdXRJZCA9IG51bGw7XG4gICAgc3RhdGUubGFzdCA9ICtuZXcgRGF0ZSgpO1xuICAgIHRoaXMudGhyb3R0bGVkTWV0aG9kKG5ld1ZhbHVlKTtcbiAgICByZXR1cm47XG4gIH1cbiAgc3RhdGUubmV3VmFsdWUgPSBuZXdWYWx1ZTtcbiAgaWYgKHN0YXRlLnRpbWVvdXRJZCA9PT0gbnVsbCkge1xuICAgIHN0YXRlLnRpbWVvdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgc3RhdGUudGltZW91dElkID0gbnVsbDtcbiAgICAgIHN0YXRlLmxhc3QgPSArbmV3IERhdGUoKTtcbiAgICAgIF90aGlzLnRocm90dGxlZE1ldGhvZChzdGF0ZS5uZXdWYWx1ZSk7XG4gICAgfSwgc3RhdGUuZGVsYXkgLSBlbGFwc2VkKTtcbiAgfVxufVxuXG52YXIgVGhyb3R0bGVCaW5kaW5nQmVoYXZpb3IgPSBleHBvcnRzLlRocm90dGxlQmluZGluZ0JlaGF2aW9yID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBUaHJvdHRsZUJpbmRpbmdCZWhhdmlvcigpIHtcbiAgICBcbiAgfVxuXG4gIFRocm90dGxlQmluZGluZ0JlaGF2aW9yLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZChiaW5kaW5nLCBzb3VyY2UpIHtcbiAgICB2YXIgZGVsYXkgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDIgfHwgYXJndW1lbnRzWzJdID09PSB1bmRlZmluZWQgPyAyMDAgOiBhcmd1bWVudHNbMl07XG5cbiAgICB2YXIgbWV0aG9kVG9UaHJvdHRsZSA9ICd1cGRhdGVUYXJnZXQnO1xuICAgIGlmIChiaW5kaW5nLmNhbGxTb3VyY2UpIHtcbiAgICAgIG1ldGhvZFRvVGhyb3R0bGUgPSAnY2FsbFNvdXJjZSc7XG4gICAgfSBlbHNlIGlmIChiaW5kaW5nLnVwZGF0ZVNvdXJjZSAmJiBiaW5kaW5nLm1vZGUgPT09IF9hdXJlbGlhQmluZGluZy5iaW5kaW5nTW9kZS50d29XYXkpIHtcbiAgICAgICAgbWV0aG9kVG9UaHJvdHRsZSA9ICd1cGRhdGVTb3VyY2UnO1xuICAgICAgfVxuXG4gICAgYmluZGluZy50aHJvdHRsZWRNZXRob2QgPSBiaW5kaW5nW21ldGhvZFRvVGhyb3R0bGVdO1xuICAgIGJpbmRpbmcudGhyb3R0bGVkTWV0aG9kLm9yaWdpbmFsTmFtZSA9IG1ldGhvZFRvVGhyb3R0bGU7XG5cbiAgICBiaW5kaW5nW21ldGhvZFRvVGhyb3R0bGVdID0gdGhyb3R0bGU7XG5cbiAgICBiaW5kaW5nLnRocm90dGxlU3RhdGUgPSB7XG4gICAgICBkZWxheTogZGVsYXksXG4gICAgICBsYXN0OiAwLFxuICAgICAgdGltZW91dElkOiBudWxsXG4gICAgfTtcbiAgfTtcblxuICBUaHJvdHRsZUJpbmRpbmdCZWhhdmlvci5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gdW5iaW5kKGJpbmRpbmcsIHNvdXJjZSkge1xuICAgIHZhciBtZXRob2RUb1Jlc3RvcmUgPSBiaW5kaW5nLnRocm90dGxlZE1ldGhvZC5vcmlnaW5hbE5hbWU7XG4gICAgYmluZGluZ1ttZXRob2RUb1Jlc3RvcmVdID0gYmluZGluZy50aHJvdHRsZWRNZXRob2Q7XG4gICAgYmluZGluZy50aHJvdHRsZWRNZXRob2QgPSBudWxsO1xuICAgIGNsZWFyVGltZW91dChiaW5kaW5nLnRocm90dGxlU3RhdGUudGltZW91dElkKTtcbiAgICBiaW5kaW5nLnRocm90dGxlU3RhdGUgPSBudWxsO1xuICB9O1xuXG4gIHJldHVybiBUaHJvdHRsZUJpbmRpbmdCZWhhdmlvcjtcbn0oKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L2NvbW1vbmpzL3Rocm90dGxlLWJpbmRpbmctYmVoYXZpb3IuanNcbi8vIG1vZHVsZSBpZCA9IDQyXG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuVXBkYXRlVHJpZ2dlckJpbmRpbmdCZWhhdmlvciA9IHVuZGVmaW5lZDtcblxudmFyIF9jbGFzcywgX3RlbXA7XG5cbnZhciBfYXVyZWxpYUJpbmRpbmcgPSByZXF1aXJlKCdhdXJlbGlhLWJpbmRpbmcnKTtcblxuXG5cbnZhciBldmVudE5hbWVzUmVxdWlyZWQgPSAnVGhlIHVwZGF0ZVRyaWdnZXIgYmluZGluZyBiZWhhdmlvciByZXF1aXJlcyBhdCBsZWFzdCBvbmUgZXZlbnQgbmFtZSBhcmd1bWVudDogZWcgPGlucHV0IHZhbHVlLmJpbmQ9XCJmaXJzdE5hbWUgJiB1cGRhdGVUcmlnZ2VyOlxcJ2JsdXJcXCdcIj4nO1xudmFyIG5vdEFwcGxpY2FibGVNZXNzYWdlID0gJ1RoZSB1cGRhdGVUcmlnZ2VyIGJpbmRpbmcgYmVoYXZpb3IgY2FuIG9ubHkgYmUgYXBwbGllZCB0byB0d28td2F5IGJpbmRpbmdzIG9uIGlucHV0L3NlbGVjdCBlbGVtZW50cy4nO1xuXG52YXIgVXBkYXRlVHJpZ2dlckJpbmRpbmdCZWhhdmlvciA9IGV4cG9ydHMuVXBkYXRlVHJpZ2dlckJpbmRpbmdCZWhhdmlvciA9IChfdGVtcCA9IF9jbGFzcyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gVXBkYXRlVHJpZ2dlckJpbmRpbmdCZWhhdmlvcihldmVudE1hbmFnZXIpIHtcbiAgICBcblxuICAgIHRoaXMuZXZlbnRNYW5hZ2VyID0gZXZlbnRNYW5hZ2VyO1xuICB9XG5cbiAgVXBkYXRlVHJpZ2dlckJpbmRpbmdCZWhhdmlvci5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIGJpbmQoYmluZGluZywgc291cmNlKSB7XG4gICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGV2ZW50cyA9IEFycmF5KF9sZW4gPiAyID8gX2xlbiAtIDIgOiAwKSwgX2tleSA9IDI7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICAgIGV2ZW50c1tfa2V5IC0gMl0gPSBhcmd1bWVudHNbX2tleV07XG4gICAgfVxuXG4gICAgaWYgKGV2ZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihldmVudE5hbWVzUmVxdWlyZWQpO1xuICAgIH1cbiAgICBpZiAoYmluZGluZy5tb2RlICE9PSBfYXVyZWxpYUJpbmRpbmcuYmluZGluZ01vZGUudHdvV2F5KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3Iobm90QXBwbGljYWJsZU1lc3NhZ2UpO1xuICAgIH1cblxuICAgIHZhciB0YXJnZXRPYnNlcnZlciA9IGJpbmRpbmcub2JzZXJ2ZXJMb2NhdG9yLmdldE9ic2VydmVyKGJpbmRpbmcudGFyZ2V0LCBiaW5kaW5nLnRhcmdldFByb3BlcnR5KTtcbiAgICBpZiAoIXRhcmdldE9ic2VydmVyLmhhbmRsZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihub3RBcHBsaWNhYmxlTWVzc2FnZSk7XG4gICAgfVxuICAgIGJpbmRpbmcudGFyZ2V0T2JzZXJ2ZXIgPSB0YXJnZXRPYnNlcnZlcjtcblxuICAgIHRhcmdldE9ic2VydmVyLm9yaWdpbmFsSGFuZGxlciA9IGJpbmRpbmcudGFyZ2V0T2JzZXJ2ZXIuaGFuZGxlcjtcblxuICAgIHZhciBoYW5kbGVyID0gdGhpcy5ldmVudE1hbmFnZXIuY3JlYXRlRWxlbWVudEhhbmRsZXIoZXZlbnRzKTtcbiAgICB0YXJnZXRPYnNlcnZlci5oYW5kbGVyID0gaGFuZGxlcjtcbiAgfTtcblxuICBVcGRhdGVUcmlnZ2VyQmluZGluZ0JlaGF2aW9yLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiB1bmJpbmQoYmluZGluZywgc291cmNlKSB7XG4gICAgYmluZGluZy50YXJnZXRPYnNlcnZlci5oYW5kbGVyID0gYmluZGluZy50YXJnZXRPYnNlcnZlci5vcmlnaW5hbEhhbmRsZXI7XG4gICAgYmluZGluZy50YXJnZXRPYnNlcnZlci5vcmlnaW5hbEhhbmRsZXIgPSBudWxsO1xuICB9O1xuXG4gIHJldHVybiBVcGRhdGVUcmlnZ2VyQmluZGluZ0JlaGF2aW9yO1xufSgpLCBfY2xhc3MuaW5qZWN0ID0gW19hdXJlbGlhQmluZGluZy5FdmVudE1hbmFnZXJdLCBfdGVtcCk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy91cGRhdGUtdHJpZ2dlci1iaW5kaW5nLWJlaGF2aW9yLmpzXG4vLyBtb2R1bGUgaWQgPSA0M1xuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLldpdGggPSB1bmRlZmluZWQ7XG5cbnZhciBfZGVjLCBfZGVjMiwgX2NsYXNzO1xuXG52YXIgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uID0gcmVxdWlyZSgnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbicpO1xuXG52YXIgX2F1cmVsaWFUZW1wbGF0aW5nID0gcmVxdWlyZSgnYXVyZWxpYS10ZW1wbGF0aW5nJyk7XG5cbnZhciBfYXVyZWxpYUJpbmRpbmcgPSByZXF1aXJlKCdhdXJlbGlhLWJpbmRpbmcnKTtcblxuXG5cbnZhciBXaXRoID0gZXhwb3J0cy5XaXRoID0gKF9kZWMgPSAoMCwgX2F1cmVsaWFUZW1wbGF0aW5nLmN1c3RvbUF0dHJpYnV0ZSkoJ3dpdGgnKSwgX2RlYzIgPSAoMCwgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uLmluamVjdCkoX2F1cmVsaWFUZW1wbGF0aW5nLkJvdW5kVmlld0ZhY3RvcnksIF9hdXJlbGlhVGVtcGxhdGluZy5WaWV3U2xvdCksIF9kZWMoX2NsYXNzID0gKDAsIF9hdXJlbGlhVGVtcGxhdGluZy50ZW1wbGF0ZUNvbnRyb2xsZXIpKF9jbGFzcyA9IF9kZWMyKF9jbGFzcyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gV2l0aCh2aWV3RmFjdG9yeSwgdmlld1Nsb3QpIHtcbiAgICBcblxuICAgIHRoaXMudmlld0ZhY3RvcnkgPSB2aWV3RmFjdG9yeTtcbiAgICB0aGlzLnZpZXdTbG90ID0gdmlld1Nsb3Q7XG4gICAgdGhpcy5wYXJlbnRPdmVycmlkZUNvbnRleHQgPSBudWxsO1xuICAgIHRoaXMudmlldyA9IG51bGw7XG4gIH1cblxuICBXaXRoLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KSB7XG4gICAgdGhpcy5wYXJlbnRPdmVycmlkZUNvbnRleHQgPSBvdmVycmlkZUNvbnRleHQ7XG4gICAgdGhpcy52YWx1ZUNoYW5nZWQodGhpcy52YWx1ZSk7XG4gIH07XG5cbiAgV2l0aC5wcm90b3R5cGUudmFsdWVDaGFuZ2VkID0gZnVuY3Rpb24gdmFsdWVDaGFuZ2VkKG5ld1ZhbHVlKSB7XG4gICAgdmFyIG92ZXJyaWRlQ29udGV4dCA9ICgwLCBfYXVyZWxpYUJpbmRpbmcuY3JlYXRlT3ZlcnJpZGVDb250ZXh0KShuZXdWYWx1ZSwgdGhpcy5wYXJlbnRPdmVycmlkZUNvbnRleHQpO1xuICAgIGlmICghdGhpcy52aWV3KSB7XG4gICAgICB0aGlzLnZpZXcgPSB0aGlzLnZpZXdGYWN0b3J5LmNyZWF0ZSgpO1xuICAgICAgdGhpcy52aWV3LmJpbmQobmV3VmFsdWUsIG92ZXJyaWRlQ29udGV4dCk7XG4gICAgICB0aGlzLnZpZXdTbG90LmFkZCh0aGlzLnZpZXcpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnZpZXcuYmluZChuZXdWYWx1ZSwgb3ZlcnJpZGVDb250ZXh0KTtcbiAgICB9XG4gIH07XG5cbiAgV2l0aC5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gdW5iaW5kKCkge1xuICAgIHRoaXMucGFyZW50T3ZlcnJpZGVDb250ZXh0ID0gbnVsbDtcblxuICAgIGlmICh0aGlzLnZpZXcpIHtcbiAgICAgIHRoaXMudmlldy51bmJpbmQoKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIFdpdGg7XG59KCkpIHx8IF9jbGFzcykgfHwgX2NsYXNzKSB8fCBfY2xhc3MpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzL2Rpc3QvY29tbW9uanMvd2l0aC5qc1xuLy8gbW9kdWxlIGlkID0gNDRcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5Sb3V0ZUhyZWYgPSB1bmRlZmluZWQ7XG5cbnZhciBfZGVjLCBfZGVjMiwgX2RlYzMsIF9kZWM0LCBfZGVjNSwgX2NsYXNzO1xuXG52YXIgX2F1cmVsaWFUZW1wbGF0aW5nID0gcmVxdWlyZSgnYXVyZWxpYS10ZW1wbGF0aW5nJyk7XG5cbnZhciBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24gPSByZXF1aXJlKCdhdXJlbGlhLWRlcGVuZGVuY3ktaW5qZWN0aW9uJyk7XG5cbnZhciBfYXVyZWxpYVJvdXRlciA9IHJlcXVpcmUoJ2F1cmVsaWEtcm91dGVyJyk7XG5cbnZhciBfYXVyZWxpYVBhbCA9IHJlcXVpcmUoJ2F1cmVsaWEtcGFsJyk7XG5cbnZhciBfYXVyZWxpYUxvZ2dpbmcgPSByZXF1aXJlKCdhdXJlbGlhLWxvZ2dpbmcnKTtcblxudmFyIExvZ01hbmFnZXIgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChfYXVyZWxpYUxvZ2dpbmcpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgeyByZXR1cm4gb2JqOyB9IGVsc2UgeyB2YXIgbmV3T2JqID0ge307IGlmIChvYmogIT0gbnVsbCkgeyBmb3IgKHZhciBrZXkgaW4gb2JqKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSBuZXdPYmpba2V5XSA9IG9ialtrZXldOyB9IH0gbmV3T2JqLmRlZmF1bHQgPSBvYmo7IHJldHVybiBuZXdPYmo7IH0gfVxuXG5cblxudmFyIGxvZ2dlciA9IExvZ01hbmFnZXIuZ2V0TG9nZ2VyKCdyb3V0ZS1ocmVmJyk7XG5cbnZhciBSb3V0ZUhyZWYgPSBleHBvcnRzLlJvdXRlSHJlZiA9IChfZGVjID0gKDAsIF9hdXJlbGlhVGVtcGxhdGluZy5jdXN0b21BdHRyaWJ1dGUpKCdyb3V0ZS1ocmVmJyksIF9kZWMyID0gKDAsIF9hdXJlbGlhVGVtcGxhdGluZy5iaW5kYWJsZSkoeyBuYW1lOiAncm91dGUnLCBjaGFuZ2VIYW5kbGVyOiAncHJvY2Vzc0NoYW5nZScgfSksIF9kZWMzID0gKDAsIF9hdXJlbGlhVGVtcGxhdGluZy5iaW5kYWJsZSkoeyBuYW1lOiAncGFyYW1zJywgY2hhbmdlSGFuZGxlcjogJ3Byb2Nlc3NDaGFuZ2UnIH0pLCBfZGVjNCA9ICgwLCBfYXVyZWxpYVRlbXBsYXRpbmcuYmluZGFibGUpKHsgbmFtZTogJ2F0dHJpYnV0ZScsIGRlZmF1bHRWYWx1ZTogJ2hyZWYnIH0pLCBfZGVjNSA9ICgwLCBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24uaW5qZWN0KShfYXVyZWxpYVJvdXRlci5Sb3V0ZXIsIF9hdXJlbGlhUGFsLkRPTS5FbGVtZW50KSwgX2RlYyhfY2xhc3MgPSBfZGVjMihfY2xhc3MgPSBfZGVjMyhfY2xhc3MgPSBfZGVjNChfY2xhc3MgPSBfZGVjNShfY2xhc3MgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFJvdXRlSHJlZihyb3V0ZXIsIGVsZW1lbnQpIHtcbiAgICBcblxuICAgIHRoaXMucm91dGVyID0gcm91dGVyO1xuICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XG4gIH1cblxuICBSb3V0ZUhyZWYucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiBiaW5kKCkge1xuICAgIHRoaXMuaXNBY3RpdmUgPSB0cnVlO1xuICAgIHRoaXMucHJvY2Vzc0NoYW5nZSgpO1xuICB9O1xuXG4gIFJvdXRlSHJlZi5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gdW5iaW5kKCkge1xuICAgIHRoaXMuaXNBY3RpdmUgPSBmYWxzZTtcbiAgfTtcblxuICBSb3V0ZUhyZWYucHJvdG90eXBlLmF0dHJpYnV0ZUNoYW5nZWQgPSBmdW5jdGlvbiBhdHRyaWJ1dGVDaGFuZ2VkKHZhbHVlLCBwcmV2aW91cykge1xuICAgIGlmIChwcmV2aW91cykge1xuICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZShwcmV2aW91cyk7XG4gICAgfVxuXG4gICAgdGhpcy5wcm9jZXNzQ2hhbmdlKCk7XG4gIH07XG5cbiAgUm91dGVIcmVmLnByb3RvdHlwZS5wcm9jZXNzQ2hhbmdlID0gZnVuY3Rpb24gcHJvY2Vzc0NoYW5nZSgpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgcmV0dXJuIHRoaXMucm91dGVyLmVuc3VyZUNvbmZpZ3VyZWQoKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICghX3RoaXMuaXNBY3RpdmUpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIHZhciBocmVmID0gX3RoaXMucm91dGVyLmdlbmVyYXRlKF90aGlzLnJvdXRlLCBfdGhpcy5wYXJhbXMpO1xuICAgICAgX3RoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoX3RoaXMuYXR0cmlidXRlLCBocmVmKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChyZWFzb24pIHtcbiAgICAgIGxvZ2dlci5lcnJvcihyZWFzb24pO1xuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiBSb3V0ZUhyZWY7XG59KCkpIHx8IF9jbGFzcykgfHwgX2NsYXNzKSB8fCBfY2xhc3MpIHx8IF9jbGFzcykgfHwgX2NsYXNzKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJvdXRlci9kaXN0L2NvbW1vbmpzL3JvdXRlLWhyZWYuanNcbi8vIG1vZHVsZSBpZCA9IDQ1XG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuUm91dGVyVmlldyA9IHVuZGVmaW5lZDtcblxudmFyIF9kZWMsIF9kZWMyLCBfY2xhc3MsIF9kZXNjLCBfdmFsdWUsIF9jbGFzczIsIF9kZXNjcmlwdG9yLCBfZGVzY3JpcHRvcjIsIF9kZXNjcmlwdG9yMywgX2Rlc2NyaXB0b3I0O1xuXG52YXIgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uID0gcmVxdWlyZSgnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbicpO1xuXG52YXIgX2F1cmVsaWFUZW1wbGF0aW5nID0gcmVxdWlyZSgnYXVyZWxpYS10ZW1wbGF0aW5nJyk7XG5cbnZhciBfYXVyZWxpYVJvdXRlciA9IHJlcXVpcmUoJ2F1cmVsaWEtcm91dGVyJyk7XG5cbnZhciBfYXVyZWxpYU1ldGFkYXRhID0gcmVxdWlyZSgnYXVyZWxpYS1tZXRhZGF0YScpO1xuXG52YXIgX2F1cmVsaWFQYWwgPSByZXF1aXJlKCdhdXJlbGlhLXBhbCcpO1xuXG5mdW5jdGlvbiBfaW5pdERlZmluZVByb3AodGFyZ2V0LCBwcm9wZXJ0eSwgZGVzY3JpcHRvciwgY29udGV4dCkge1xuICBpZiAoIWRlc2NyaXB0b3IpIHJldHVybjtcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgcHJvcGVydHksIHtcbiAgICBlbnVtZXJhYmxlOiBkZXNjcmlwdG9yLmVudW1lcmFibGUsXG4gICAgY29uZmlndXJhYmxlOiBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSxcbiAgICB3cml0YWJsZTogZGVzY3JpcHRvci53cml0YWJsZSxcbiAgICB2YWx1ZTogZGVzY3JpcHRvci5pbml0aWFsaXplciA/IGRlc2NyaXB0b3IuaW5pdGlhbGl6ZXIuY2FsbChjb250ZXh0KSA6IHZvaWQgMFxuICB9KTtcbn1cblxuZnVuY3Rpb24gX2FwcGx5RGVjb3JhdGVkRGVzY3JpcHRvcih0YXJnZXQsIHByb3BlcnR5LCBkZWNvcmF0b3JzLCBkZXNjcmlwdG9yLCBjb250ZXh0KSB7XG4gIHZhciBkZXNjID0ge307XG4gIE9iamVjdFsna2UnICsgJ3lzJ10oZGVzY3JpcHRvcikuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgZGVzY1trZXldID0gZGVzY3JpcHRvcltrZXldO1xuICB9KTtcbiAgZGVzYy5lbnVtZXJhYmxlID0gISFkZXNjLmVudW1lcmFibGU7XG4gIGRlc2MuY29uZmlndXJhYmxlID0gISFkZXNjLmNvbmZpZ3VyYWJsZTtcblxuICBpZiAoJ3ZhbHVlJyBpbiBkZXNjIHx8IGRlc2MuaW5pdGlhbGl6ZXIpIHtcbiAgICBkZXNjLndyaXRhYmxlID0gdHJ1ZTtcbiAgfVxuXG4gIGRlc2MgPSBkZWNvcmF0b3JzLnNsaWNlKCkucmV2ZXJzZSgpLnJlZHVjZShmdW5jdGlvbiAoZGVzYywgZGVjb3JhdG9yKSB7XG4gICAgcmV0dXJuIGRlY29yYXRvcih0YXJnZXQsIHByb3BlcnR5LCBkZXNjKSB8fCBkZXNjO1xuICB9LCBkZXNjKTtcblxuICBpZiAoY29udGV4dCAmJiBkZXNjLmluaXRpYWxpemVyICE9PSB2b2lkIDApIHtcbiAgICBkZXNjLnZhbHVlID0gZGVzYy5pbml0aWFsaXplciA/IGRlc2MuaW5pdGlhbGl6ZXIuY2FsbChjb250ZXh0KSA6IHZvaWQgMDtcbiAgICBkZXNjLmluaXRpYWxpemVyID0gdW5kZWZpbmVkO1xuICB9XG5cbiAgaWYgKGRlc2MuaW5pdGlhbGl6ZXIgPT09IHZvaWQgMCkge1xuICAgIE9iamVjdFsnZGVmaW5lJyArICdQcm9wZXJ0eSddKHRhcmdldCwgcHJvcGVydHksIGRlc2MpO1xuICAgIGRlc2MgPSBudWxsO1xuICB9XG5cbiAgcmV0dXJuIGRlc2M7XG59XG5cbmZ1bmN0aW9uIF9pbml0aWFsaXplcldhcm5pbmdIZWxwZXIoZGVzY3JpcHRvciwgY29udGV4dCkge1xuICB0aHJvdyBuZXcgRXJyb3IoJ0RlY29yYXRpbmcgY2xhc3MgcHJvcGVydHkgZmFpbGVkLiBQbGVhc2UgZW5zdXJlIHRoYXQgdHJhbnNmb3JtLWNsYXNzLXByb3BlcnRpZXMgaXMgZW5hYmxlZC4nKTtcbn1cblxuXG5cbnZhciBTd2FwU3RyYXRlZ2llcyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gU3dhcFN0cmF0ZWdpZXMoKSB7XG4gICAgXG4gIH1cblxuICBTd2FwU3RyYXRlZ2llcy5wcm90b3R5cGUuYmVmb3JlID0gZnVuY3Rpb24gYmVmb3JlKHZpZXdTbG90LCBwcmV2aW91c1ZpZXcsIGNhbGxiYWNrKSB7XG4gICAgdmFyIHByb21pc2UgPSBQcm9taXNlLnJlc29sdmUoY2FsbGJhY2soKSk7XG5cbiAgICBpZiAocHJldmlvdXNWaWV3ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBwcm9taXNlLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdmlld1Nsb3QucmVtb3ZlKHByZXZpb3VzVmlldywgdHJ1ZSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gcHJvbWlzZTtcbiAgfTtcblxuICBTd2FwU3RyYXRlZ2llcy5wcm90b3R5cGUud2l0aCA9IGZ1bmN0aW9uIF93aXRoKHZpZXdTbG90LCBwcmV2aW91c1ZpZXcsIGNhbGxiYWNrKSB7XG4gICAgdmFyIHByb21pc2UgPSBQcm9taXNlLnJlc29sdmUoY2FsbGJhY2soKSk7XG5cbiAgICBpZiAocHJldmlvdXNWaWV3ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChbdmlld1Nsb3QucmVtb3ZlKHByZXZpb3VzVmlldywgdHJ1ZSksIHByb21pc2VdKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcHJvbWlzZTtcbiAgfTtcblxuICBTd2FwU3RyYXRlZ2llcy5wcm90b3R5cGUuYWZ0ZXIgPSBmdW5jdGlvbiBhZnRlcih2aWV3U2xvdCwgcHJldmlvdXNWaWV3LCBjYWxsYmFjaykge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodmlld1Nsb3QucmVtb3ZlQWxsKHRydWUpKS50aGVuKGNhbGxiYWNrKTtcbiAgfTtcblxuICByZXR1cm4gU3dhcFN0cmF0ZWdpZXM7XG59KCk7XG5cbnZhciBzd2FwU3RyYXRlZ2llcyA9IG5ldyBTd2FwU3RyYXRlZ2llcygpO1xuXG52YXIgUm91dGVyVmlldyA9IGV4cG9ydHMuUm91dGVyVmlldyA9IChfZGVjID0gKDAsIF9hdXJlbGlhVGVtcGxhdGluZy5jdXN0b21FbGVtZW50KSgncm91dGVyLXZpZXcnKSwgX2RlYzIgPSAoMCwgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uLmluamVjdCkoX2F1cmVsaWFQYWwuRE9NLkVsZW1lbnQsIF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbi5Db250YWluZXIsIF9hdXJlbGlhVGVtcGxhdGluZy5WaWV3U2xvdCwgX2F1cmVsaWFSb3V0ZXIuUm91dGVyLCBfYXVyZWxpYVRlbXBsYXRpbmcuVmlld0xvY2F0b3IsIF9hdXJlbGlhVGVtcGxhdGluZy5Db21wb3NpdGlvblRyYW5zYWN0aW9uLCBfYXVyZWxpYVRlbXBsYXRpbmcuQ29tcG9zaXRpb25FbmdpbmUpLCBfZGVjKF9jbGFzcyA9ICgwLCBfYXVyZWxpYVRlbXBsYXRpbmcubm9WaWV3KShfY2xhc3MgPSBfZGVjMihfY2xhc3MgPSAoX2NsYXNzMiA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gUm91dGVyVmlldyhlbGVtZW50LCBjb250YWluZXIsIHZpZXdTbG90LCByb3V0ZXIsIHZpZXdMb2NhdG9yLCBjb21wb3NpdGlvblRyYW5zYWN0aW9uLCBjb21wb3NpdGlvbkVuZ2luZSkge1xuICAgIFxuXG4gICAgX2luaXREZWZpbmVQcm9wKHRoaXMsICdzd2FwT3JkZXInLCBfZGVzY3JpcHRvciwgdGhpcyk7XG5cbiAgICBfaW5pdERlZmluZVByb3AodGhpcywgJ2xheW91dFZpZXcnLCBfZGVzY3JpcHRvcjIsIHRoaXMpO1xuXG4gICAgX2luaXREZWZpbmVQcm9wKHRoaXMsICdsYXlvdXRWaWV3TW9kZWwnLCBfZGVzY3JpcHRvcjMsIHRoaXMpO1xuXG4gICAgX2luaXREZWZpbmVQcm9wKHRoaXMsICdsYXlvdXRNb2RlbCcsIF9kZXNjcmlwdG9yNCwgdGhpcyk7XG5cbiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xuICAgIHRoaXMudmlld1Nsb3QgPSB2aWV3U2xvdDtcbiAgICB0aGlzLnJvdXRlciA9IHJvdXRlcjtcbiAgICB0aGlzLnZpZXdMb2NhdG9yID0gdmlld0xvY2F0b3I7XG4gICAgdGhpcy5jb21wb3NpdGlvblRyYW5zYWN0aW9uID0gY29tcG9zaXRpb25UcmFuc2FjdGlvbjtcbiAgICB0aGlzLmNvbXBvc2l0aW9uRW5naW5lID0gY29tcG9zaXRpb25FbmdpbmU7XG4gICAgdGhpcy5yb3V0ZXIucmVnaXN0ZXJWaWV3UG9ydCh0aGlzLCB0aGlzLmVsZW1lbnQuZ2V0QXR0cmlidXRlKCduYW1lJykpO1xuXG4gICAgaWYgKCEoJ2luaXRpYWxDb21wb3NpdGlvbicgaW4gY29tcG9zaXRpb25UcmFuc2FjdGlvbikpIHtcbiAgICAgIGNvbXBvc2l0aW9uVHJhbnNhY3Rpb24uaW5pdGlhbENvbXBvc2l0aW9uID0gdHJ1ZTtcbiAgICAgIHRoaXMuY29tcG9zaXRpb25UcmFuc2FjdGlvbk5vdGlmaWVyID0gY29tcG9zaXRpb25UcmFuc2FjdGlvbi5lbmxpc3QoKTtcbiAgICB9XG4gIH1cblxuICBSb3V0ZXJWaWV3LnByb3RvdHlwZS5jcmVhdGVkID0gZnVuY3Rpb24gY3JlYXRlZChvd25pbmdWaWV3KSB7XG4gICAgdGhpcy5vd25pbmdWaWV3ID0gb3duaW5nVmlldztcbiAgfTtcblxuICBSb3V0ZXJWaWV3LnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KSB7XG4gICAgdGhpcy5jb250YWluZXIudmlld01vZGVsID0gYmluZGluZ0NvbnRleHQ7XG4gICAgdGhpcy5vdmVycmlkZUNvbnRleHQgPSBvdmVycmlkZUNvbnRleHQ7XG4gIH07XG5cbiAgUm91dGVyVmlldy5wcm90b3R5cGUucHJvY2VzcyA9IGZ1bmN0aW9uIHByb2Nlc3Modmlld1BvcnRJbnN0cnVjdGlvbiwgd2FpdFRvU3dhcCkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICB2YXIgY29tcG9uZW50ID0gdmlld1BvcnRJbnN0cnVjdGlvbi5jb21wb25lbnQ7XG4gICAgdmFyIGNoaWxkQ29udGFpbmVyID0gY29tcG9uZW50LmNoaWxkQ29udGFpbmVyO1xuICAgIHZhciB2aWV3TW9kZWwgPSBjb21wb25lbnQudmlld01vZGVsO1xuICAgIHZhciB2aWV3TW9kZWxSZXNvdXJjZSA9IGNvbXBvbmVudC52aWV3TW9kZWxSZXNvdXJjZTtcbiAgICB2YXIgbWV0YWRhdGEgPSB2aWV3TW9kZWxSZXNvdXJjZS5tZXRhZGF0YTtcbiAgICB2YXIgY29uZmlnID0gY29tcG9uZW50LnJvdXRlci5jdXJyZW50SW5zdHJ1Y3Rpb24uY29uZmlnO1xuICAgIHZhciB2aWV3UG9ydCA9IGNvbmZpZy52aWV3UG9ydHMgPyBjb25maWcudmlld1BvcnRzW3ZpZXdQb3J0SW5zdHJ1Y3Rpb24ubmFtZV0gOiB7fTtcblxuICAgIHZhciBsYXlvdXRJbnN0cnVjdGlvbiA9IHtcbiAgICAgIHZpZXdNb2RlbDogdmlld1BvcnQubGF5b3V0Vmlld01vZGVsIHx8IGNvbmZpZy5sYXlvdXRWaWV3TW9kZWwgfHwgdGhpcy5sYXlvdXRWaWV3TW9kZWwsXG4gICAgICB2aWV3OiB2aWV3UG9ydC5sYXlvdXRWaWV3IHx8IGNvbmZpZy5sYXlvdXRWaWV3IHx8IHRoaXMubGF5b3V0VmlldyxcbiAgICAgIG1vZGVsOiB2aWV3UG9ydC5sYXlvdXRNb2RlbCB8fCBjb25maWcubGF5b3V0TW9kZWwgfHwgdGhpcy5sYXlvdXRNb2RlbCxcbiAgICAgIHJvdXRlcjogdmlld1BvcnRJbnN0cnVjdGlvbi5jb21wb25lbnQucm91dGVyLFxuICAgICAgY2hpbGRDb250YWluZXI6IGNoaWxkQ29udGFpbmVyLFxuICAgICAgdmlld1Nsb3Q6IHRoaXMudmlld1Nsb3RcbiAgICB9O1xuXG4gICAgdmFyIHZpZXdTdHJhdGVneSA9IHRoaXMudmlld0xvY2F0b3IuZ2V0Vmlld1N0cmF0ZWd5KGNvbXBvbmVudC52aWV3IHx8IHZpZXdNb2RlbCk7XG4gICAgaWYgKHZpZXdTdHJhdGVneSAmJiBjb21wb25lbnQudmlldykge1xuICAgICAgdmlld1N0cmF0ZWd5Lm1ha2VSZWxhdGl2ZVRvKF9hdXJlbGlhTWV0YWRhdGEuT3JpZ2luLmdldChjb21wb25lbnQucm91dGVyLmNvbnRhaW5lci52aWV3TW9kZWwuY29uc3RydWN0b3IpLm1vZHVsZUlkKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbWV0YWRhdGEubG9hZChjaGlsZENvbnRhaW5lciwgdmlld01vZGVsUmVzb3VyY2UudmFsdWUsIG51bGwsIHZpZXdTdHJhdGVneSwgdHJ1ZSkudGhlbihmdW5jdGlvbiAodmlld0ZhY3RvcnkpIHtcbiAgICAgIGlmICghX3RoaXMuY29tcG9zaXRpb25UcmFuc2FjdGlvbk5vdGlmaWVyKSB7XG4gICAgICAgIF90aGlzLmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbiA9IF90aGlzLmNvbXBvc2l0aW9uVHJhbnNhY3Rpb24udHJ5Q2FwdHVyZSgpO1xuICAgICAgfVxuXG4gICAgICBpZiAobGF5b3V0SW5zdHJ1Y3Rpb24udmlld01vZGVsIHx8IGxheW91dEluc3RydWN0aW9uLnZpZXcpIHtcbiAgICAgICAgdmlld1BvcnRJbnN0cnVjdGlvbi5sYXlvdXRJbnN0cnVjdGlvbiA9IGxheW91dEluc3RydWN0aW9uO1xuICAgICAgfVxuXG4gICAgICB2aWV3UG9ydEluc3RydWN0aW9uLmNvbnRyb2xsZXIgPSBtZXRhZGF0YS5jcmVhdGUoY2hpbGRDb250YWluZXIsIF9hdXJlbGlhVGVtcGxhdGluZy5CZWhhdmlvckluc3RydWN0aW9uLmR5bmFtaWMoX3RoaXMuZWxlbWVudCwgdmlld01vZGVsLCB2aWV3RmFjdG9yeSkpO1xuXG4gICAgICBpZiAod2FpdFRvU3dhcCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIF90aGlzLnN3YXAodmlld1BvcnRJbnN0cnVjdGlvbik7XG4gICAgfSk7XG4gIH07XG5cbiAgUm91dGVyVmlldy5wcm90b3R5cGUuc3dhcCA9IGZ1bmN0aW9uIHN3YXAodmlld1BvcnRJbnN0cnVjdGlvbikge1xuICAgIHZhciBfdGhpczIgPSB0aGlzO1xuXG4gICAgdmFyIHdvcmsgPSBmdW5jdGlvbiB3b3JrKCkge1xuICAgICAgdmFyIHByZXZpb3VzVmlldyA9IF90aGlzMi52aWV3O1xuICAgICAgdmFyIHN3YXBTdHJhdGVneSA9IHZvaWQgMDtcbiAgICAgIHZhciB2aWV3U2xvdCA9IF90aGlzMi52aWV3U2xvdDtcbiAgICAgIHZhciBsYXlvdXRJbnN0cnVjdGlvbiA9IHZpZXdQb3J0SW5zdHJ1Y3Rpb24ubGF5b3V0SW5zdHJ1Y3Rpb247XG5cbiAgICAgIHN3YXBTdHJhdGVneSA9IF90aGlzMi5zd2FwT3JkZXIgaW4gc3dhcFN0cmF0ZWdpZXMgPyBzd2FwU3RyYXRlZ2llc1tfdGhpczIuc3dhcE9yZGVyXSA6IHN3YXBTdHJhdGVnaWVzLmFmdGVyO1xuXG4gICAgICBzd2FwU3RyYXRlZ3kodmlld1Nsb3QsIHByZXZpb3VzVmlldywgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgd2FpdEZvclZpZXcgPSB2b2lkIDA7XG5cbiAgICAgICAgaWYgKGxheW91dEluc3RydWN0aW9uKSB7XG4gICAgICAgICAgaWYgKCFsYXlvdXRJbnN0cnVjdGlvbi52aWV3TW9kZWwpIHtcbiAgICAgICAgICAgIGxheW91dEluc3RydWN0aW9uLnZpZXdNb2RlbCA9IHt9O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHdhaXRGb3JWaWV3ID0gX3RoaXMyLmNvbXBvc2l0aW9uRW5naW5lLmNyZWF0ZUNvbnRyb2xsZXIobGF5b3V0SW5zdHJ1Y3Rpb24pLnRoZW4oZnVuY3Rpb24gKGxheW91dCkge1xuICAgICAgICAgICAgX2F1cmVsaWFUZW1wbGF0aW5nLlNoYWRvd0RPTS5kaXN0cmlidXRlVmlldyh2aWV3UG9ydEluc3RydWN0aW9uLmNvbnRyb2xsZXIudmlldywgbGF5b3V0LnNsb3RzIHx8IGxheW91dC52aWV3LnNsb3RzKTtcbiAgICAgICAgICAgIHJldHVybiBsYXlvdXQudmlldyB8fCBsYXlvdXQ7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgd2FpdEZvclZpZXcgPSBQcm9taXNlLnJlc29sdmUodmlld1BvcnRJbnN0cnVjdGlvbi5jb250cm9sbGVyLnZpZXcpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHdhaXRGb3JWaWV3LnRoZW4oZnVuY3Rpb24gKG5ld1ZpZXcpIHtcbiAgICAgICAgICBfdGhpczIudmlldyA9IG5ld1ZpZXc7XG4gICAgICAgICAgcmV0dXJuIHZpZXdTbG90LmFkZChuZXdWaWV3KTtcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgX3RoaXMyLl9ub3RpZnkoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmlld1BvcnRJbnN0cnVjdGlvbi5jb250cm9sbGVyLmF1dG9tYXRlKHRoaXMub3ZlcnJpZGVDb250ZXh0LCB0aGlzLm93bmluZ1ZpZXcpO1xuXG4gICAgaWYgKHRoaXMuY29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4ud2FpdEZvckNvbXBvc2l0aW9uQ29tcGxldGUoKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX3RoaXMyLmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbiA9IG51bGw7XG4gICAgICAgIHJldHVybiB3b3JrKCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gd29yaygpO1xuICB9O1xuXG4gIFJvdXRlclZpZXcucHJvdG90eXBlLl9ub3RpZnkgPSBmdW5jdGlvbiBfbm90aWZ5KCkge1xuICAgIGlmICh0aGlzLmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllcikge1xuICAgICAgdGhpcy5jb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXIuZG9uZSgpO1xuICAgICAgdGhpcy5jb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXIgPSBudWxsO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gUm91dGVyVmlldztcbn0oKSwgKF9kZXNjcmlwdG9yID0gX2FwcGx5RGVjb3JhdGVkRGVzY3JpcHRvcihfY2xhc3MyLnByb3RvdHlwZSwgJ3N3YXBPcmRlcicsIFtfYXVyZWxpYVRlbXBsYXRpbmcuYmluZGFibGVdLCB7XG4gIGVudW1lcmFibGU6IHRydWUsXG4gIGluaXRpYWxpemVyOiBudWxsXG59KSwgX2Rlc2NyaXB0b3IyID0gX2FwcGx5RGVjb3JhdGVkRGVzY3JpcHRvcihfY2xhc3MyLnByb3RvdHlwZSwgJ2xheW91dFZpZXcnLCBbX2F1cmVsaWFUZW1wbGF0aW5nLmJpbmRhYmxlXSwge1xuICBlbnVtZXJhYmxlOiB0cnVlLFxuICBpbml0aWFsaXplcjogbnVsbFxufSksIF9kZXNjcmlwdG9yMyA9IF9hcHBseURlY29yYXRlZERlc2NyaXB0b3IoX2NsYXNzMi5wcm90b3R5cGUsICdsYXlvdXRWaWV3TW9kZWwnLCBbX2F1cmVsaWFUZW1wbGF0aW5nLmJpbmRhYmxlXSwge1xuICBlbnVtZXJhYmxlOiB0cnVlLFxuICBpbml0aWFsaXplcjogbnVsbFxufSksIF9kZXNjcmlwdG9yNCA9IF9hcHBseURlY29yYXRlZERlc2NyaXB0b3IoX2NsYXNzMi5wcm90b3R5cGUsICdsYXlvdXRNb2RlbCcsIFtfYXVyZWxpYVRlbXBsYXRpbmcuYmluZGFibGVdLCB7XG4gIGVudW1lcmFibGU6IHRydWUsXG4gIGluaXRpYWxpemVyOiBudWxsXG59KSksIF9jbGFzczIpKSB8fCBfY2xhc3MpIHx8IF9jbGFzcykgfHwgX2NsYXNzKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJvdXRlci9kaXN0L2NvbW1vbmpzL3JvdXRlci12aWV3LmpzXG4vLyBtb2R1bGUgaWQgPSA0NlxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLkJyb3dzZXJIaXN0b3J5ID0gZXhwb3J0cy5EZWZhdWx0TGlua0hhbmRsZXIgPSBleHBvcnRzLkxpbmtIYW5kbGVyID0gdW5kZWZpbmVkO1xuXG52YXIgX2NsYXNzLCBfdGVtcDtcblxuZXhwb3J0cy5jb25maWd1cmUgPSBjb25maWd1cmU7XG5cbnZhciBfYXVyZWxpYVBhbCA9IHJlcXVpcmUoJ2F1cmVsaWEtcGFsJyk7XG5cbnZhciBfYXVyZWxpYUhpc3RvcnkgPSByZXF1aXJlKCdhdXJlbGlhLWhpc3RvcnknKTtcblxuZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoIXNlbGYpIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKFwidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkXCIpOyB9IHJldHVybiBjYWxsICYmICh0eXBlb2YgY2FsbCA9PT0gXCJvYmplY3RcIiB8fCB0eXBlb2YgY2FsbCA9PT0gXCJmdW5jdGlvblwiKSA/IGNhbGwgOiBzZWxmOyB9XG5cbmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09IFwiZnVuY3Rpb25cIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90IFwiICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfVxuXG5cblxudmFyIExpbmtIYW5kbGVyID0gZXhwb3J0cy5MaW5rSGFuZGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gTGlua0hhbmRsZXIoKSB7XG4gICAgXG4gIH1cblxuICBMaW5rSGFuZGxlci5wcm90b3R5cGUuYWN0aXZhdGUgPSBmdW5jdGlvbiBhY3RpdmF0ZShoaXN0b3J5KSB7fTtcblxuICBMaW5rSGFuZGxlci5wcm90b3R5cGUuZGVhY3RpdmF0ZSA9IGZ1bmN0aW9uIGRlYWN0aXZhdGUoKSB7fTtcblxuICByZXR1cm4gTGlua0hhbmRsZXI7XG59KCk7XG5cbnZhciBEZWZhdWx0TGlua0hhbmRsZXIgPSBleHBvcnRzLkRlZmF1bHRMaW5rSGFuZGxlciA9IGZ1bmN0aW9uIChfTGlua0hhbmRsZXIpIHtcbiAgX2luaGVyaXRzKERlZmF1bHRMaW5rSGFuZGxlciwgX0xpbmtIYW5kbGVyKTtcblxuICBmdW5jdGlvbiBEZWZhdWx0TGlua0hhbmRsZXIoKSB7XG4gICAgXG5cbiAgICB2YXIgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfTGlua0hhbmRsZXIuY2FsbCh0aGlzKSk7XG5cbiAgICBfdGhpcy5oYW5kbGVyID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciBfRGVmYXVsdExpbmtIYW5kbGVyJGcgPSBEZWZhdWx0TGlua0hhbmRsZXIuZ2V0RXZlbnRJbmZvKGUpO1xuXG4gICAgICB2YXIgc2hvdWxkSGFuZGxlRXZlbnQgPSBfRGVmYXVsdExpbmtIYW5kbGVyJGcuc2hvdWxkSGFuZGxlRXZlbnQ7XG4gICAgICB2YXIgaHJlZiA9IF9EZWZhdWx0TGlua0hhbmRsZXIkZy5ocmVmO1xuXG5cbiAgICAgIGlmIChzaG91bGRIYW5kbGVFdmVudCkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIF90aGlzLmhpc3RvcnkubmF2aWdhdGUoaHJlZik7XG4gICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gX3RoaXM7XG4gIH1cblxuICBEZWZhdWx0TGlua0hhbmRsZXIucHJvdG90eXBlLmFjdGl2YXRlID0gZnVuY3Rpb24gYWN0aXZhdGUoaGlzdG9yeSkge1xuICAgIGlmIChoaXN0b3J5Ll9oYXNQdXNoU3RhdGUpIHtcbiAgICAgIHRoaXMuaGlzdG9yeSA9IGhpc3Rvcnk7XG4gICAgICBfYXVyZWxpYVBhbC5ET00uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmhhbmRsZXIsIHRydWUpO1xuICAgIH1cbiAgfTtcblxuICBEZWZhdWx0TGlua0hhbmRsZXIucHJvdG90eXBlLmRlYWN0aXZhdGUgPSBmdW5jdGlvbiBkZWFjdGl2YXRlKCkge1xuICAgIF9hdXJlbGlhUGFsLkRPTS5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuaGFuZGxlcik7XG4gIH07XG5cbiAgRGVmYXVsdExpbmtIYW5kbGVyLmdldEV2ZW50SW5mbyA9IGZ1bmN0aW9uIGdldEV2ZW50SW5mbyhldmVudCkge1xuICAgIHZhciBpbmZvID0ge1xuICAgICAgc2hvdWxkSGFuZGxlRXZlbnQ6IGZhbHNlLFxuICAgICAgaHJlZjogbnVsbCxcbiAgICAgIGFuY2hvcjogbnVsbFxuICAgIH07XG5cbiAgICB2YXIgdGFyZ2V0ID0gRGVmYXVsdExpbmtIYW5kbGVyLmZpbmRDbG9zZXN0QW5jaG9yKGV2ZW50LnRhcmdldCk7XG4gICAgaWYgKCF0YXJnZXQgfHwgIURlZmF1bHRMaW5rSGFuZGxlci50YXJnZXRJc1RoaXNXaW5kb3codGFyZ2V0KSkge1xuICAgICAgcmV0dXJuIGluZm87XG4gICAgfVxuXG4gICAgaWYgKGV2ZW50LmFsdEtleSB8fCBldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkgfHwgZXZlbnQuc2hpZnRLZXkpIHtcbiAgICAgIHJldHVybiBpbmZvO1xuICAgIH1cblxuICAgIHZhciBocmVmID0gdGFyZ2V0LmdldEF0dHJpYnV0ZSgnaHJlZicpO1xuICAgIGluZm8uYW5jaG9yID0gdGFyZ2V0O1xuICAgIGluZm8uaHJlZiA9IGhyZWY7XG5cbiAgICB2YXIgbGVmdEJ1dHRvbkNsaWNrZWQgPSBldmVudC53aGljaCA9PT0gMTtcbiAgICB2YXIgaXNSZWxhdGl2ZSA9IGhyZWYgJiYgIShocmVmLmNoYXJBdCgwKSA9PT0gJyMnIHx8IC9eW2Etel0rOi9pLnRlc3QoaHJlZikpO1xuXG4gICAgaW5mby5zaG91bGRIYW5kbGVFdmVudCA9IGxlZnRCdXR0b25DbGlja2VkICYmIGlzUmVsYXRpdmU7XG4gICAgcmV0dXJuIGluZm87XG4gIH07XG5cbiAgRGVmYXVsdExpbmtIYW5kbGVyLmZpbmRDbG9zZXN0QW5jaG9yID0gZnVuY3Rpb24gZmluZENsb3Nlc3RBbmNob3IoZWwpIHtcbiAgICB3aGlsZSAoZWwpIHtcbiAgICAgIGlmIChlbC50YWdOYW1lID09PSAnQScpIHtcbiAgICAgICAgcmV0dXJuIGVsO1xuICAgICAgfVxuXG4gICAgICBlbCA9IGVsLnBhcmVudE5vZGU7XG4gICAgfVxuICB9O1xuXG4gIERlZmF1bHRMaW5rSGFuZGxlci50YXJnZXRJc1RoaXNXaW5kb3cgPSBmdW5jdGlvbiB0YXJnZXRJc1RoaXNXaW5kb3codGFyZ2V0KSB7XG4gICAgdmFyIHRhcmdldFdpbmRvdyA9IHRhcmdldC5nZXRBdHRyaWJ1dGUoJ3RhcmdldCcpO1xuICAgIHZhciB3aW4gPSBfYXVyZWxpYVBhbC5QTEFURk9STS5nbG9iYWw7XG5cbiAgICByZXR1cm4gIXRhcmdldFdpbmRvdyB8fCB0YXJnZXRXaW5kb3cgPT09IHdpbi5uYW1lIHx8IHRhcmdldFdpbmRvdyA9PT0gJ19zZWxmJyB8fCB0YXJnZXRXaW5kb3cgPT09ICd0b3AnICYmIHdpbiA9PT0gd2luLnRvcDtcbiAgfTtcblxuICByZXR1cm4gRGVmYXVsdExpbmtIYW5kbGVyO1xufShMaW5rSGFuZGxlcik7XG5cbmZ1bmN0aW9uIGNvbmZpZ3VyZShjb25maWcpIHtcbiAgY29uZmlnLnNpbmdsZXRvbihfYXVyZWxpYUhpc3RvcnkuSGlzdG9yeSwgQnJvd3Nlckhpc3RvcnkpO1xuICBjb25maWcudHJhbnNpZW50KExpbmtIYW5kbGVyLCBEZWZhdWx0TGlua0hhbmRsZXIpO1xufVxuXG52YXIgQnJvd3Nlckhpc3RvcnkgPSBleHBvcnRzLkJyb3dzZXJIaXN0b3J5ID0gKF90ZW1wID0gX2NsYXNzID0gZnVuY3Rpb24gKF9IaXN0b3J5KSB7XG4gIF9pbmhlcml0cyhCcm93c2VySGlzdG9yeSwgX0hpc3RvcnkpO1xuXG4gIGZ1bmN0aW9uIEJyb3dzZXJIaXN0b3J5KGxpbmtIYW5kbGVyKSB7XG4gICAgXG5cbiAgICB2YXIgX3RoaXMyID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX0hpc3RvcnkuY2FsbCh0aGlzKSk7XG5cbiAgICBfdGhpczIuX2lzQWN0aXZlID0gZmFsc2U7XG4gICAgX3RoaXMyLl9jaGVja1VybENhbGxiYWNrID0gX3RoaXMyLl9jaGVja1VybC5iaW5kKF90aGlzMik7XG5cbiAgICBfdGhpczIubG9jYXRpb24gPSBfYXVyZWxpYVBhbC5QTEFURk9STS5sb2NhdGlvbjtcbiAgICBfdGhpczIuaGlzdG9yeSA9IF9hdXJlbGlhUGFsLlBMQVRGT1JNLmhpc3Rvcnk7XG4gICAgX3RoaXMyLmxpbmtIYW5kbGVyID0gbGlua0hhbmRsZXI7XG4gICAgcmV0dXJuIF90aGlzMjtcbiAgfVxuXG4gIEJyb3dzZXJIaXN0b3J5LnByb3RvdHlwZS5hY3RpdmF0ZSA9IGZ1bmN0aW9uIGFjdGl2YXRlKG9wdGlvbnMpIHtcbiAgICBpZiAodGhpcy5faXNBY3RpdmUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSGlzdG9yeSBoYXMgYWxyZWFkeSBiZWVuIGFjdGl2YXRlZC4nKTtcbiAgICB9XG5cbiAgICB2YXIgd2FudHNQdXNoU3RhdGUgPSAhIW9wdGlvbnMucHVzaFN0YXRlO1xuXG4gICAgdGhpcy5faXNBY3RpdmUgPSB0cnVlO1xuICAgIHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIHsgcm9vdDogJy8nIH0sIHRoaXMub3B0aW9ucywgb3B0aW9ucyk7XG5cbiAgICB0aGlzLnJvb3QgPSAoJy8nICsgdGhpcy5vcHRpb25zLnJvb3QgKyAnLycpLnJlcGxhY2Uocm9vdFN0cmlwcGVyLCAnLycpO1xuXG4gICAgdGhpcy5fd2FudHNIYXNoQ2hhbmdlID0gdGhpcy5vcHRpb25zLmhhc2hDaGFuZ2UgIT09IGZhbHNlO1xuICAgIHRoaXMuX2hhc1B1c2hTdGF0ZSA9ICEhKHRoaXMub3B0aW9ucy5wdXNoU3RhdGUgJiYgdGhpcy5oaXN0b3J5ICYmIHRoaXMuaGlzdG9yeS5wdXNoU3RhdGUpO1xuXG4gICAgdmFyIGV2ZW50TmFtZSA9IHZvaWQgMDtcbiAgICBpZiAodGhpcy5faGFzUHVzaFN0YXRlKSB7XG4gICAgICBldmVudE5hbWUgPSAncG9wc3RhdGUnO1xuICAgIH0gZWxzZSBpZiAodGhpcy5fd2FudHNIYXNoQ2hhbmdlKSB7XG4gICAgICBldmVudE5hbWUgPSAnaGFzaGNoYW5nZSc7XG4gICAgfVxuXG4gICAgX2F1cmVsaWFQYWwuUExBVEZPUk0uYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHRoaXMuX2NoZWNrVXJsQ2FsbGJhY2spO1xuXG4gICAgaWYgKHRoaXMuX3dhbnRzSGFzaENoYW5nZSAmJiB3YW50c1B1c2hTdGF0ZSkge1xuICAgICAgdmFyIGxvYyA9IHRoaXMubG9jYXRpb247XG4gICAgICB2YXIgYXRSb290ID0gbG9jLnBhdGhuYW1lLnJlcGxhY2UoL1teXFwvXSQvLCAnJCYvJykgPT09IHRoaXMucm9vdDtcblxuICAgICAgaWYgKCF0aGlzLl9oYXNQdXNoU3RhdGUgJiYgIWF0Um9vdCkge1xuICAgICAgICB0aGlzLmZyYWdtZW50ID0gdGhpcy5fZ2V0RnJhZ21lbnQobnVsbCwgdHJ1ZSk7XG4gICAgICAgIHRoaXMubG9jYXRpb24ucmVwbGFjZSh0aGlzLnJvb3QgKyB0aGlzLmxvY2F0aW9uLnNlYXJjaCArICcjJyArIHRoaXMuZnJhZ21lbnQpO1xuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLl9oYXNQdXNoU3RhdGUgJiYgYXRSb290ICYmIGxvYy5oYXNoKSB7XG4gICAgICAgICAgdGhpcy5mcmFnbWVudCA9IHRoaXMuX2dldEhhc2goKS5yZXBsYWNlKHJvdXRlU3RyaXBwZXIsICcnKTtcbiAgICAgICAgICB0aGlzLmhpc3RvcnkucmVwbGFjZVN0YXRlKHt9LCBfYXVyZWxpYVBhbC5ET00udGl0bGUsIHRoaXMucm9vdCArIHRoaXMuZnJhZ21lbnQgKyBsb2Muc2VhcmNoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmICghdGhpcy5mcmFnbWVudCkge1xuICAgICAgdGhpcy5mcmFnbWVudCA9IHRoaXMuX2dldEZyYWdtZW50KCk7XG4gICAgfVxuXG4gICAgdGhpcy5saW5rSGFuZGxlci5hY3RpdmF0ZSh0aGlzKTtcblxuICAgIGlmICghdGhpcy5vcHRpb25zLnNpbGVudCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2xvYWRVcmwoKTtcbiAgICB9XG4gIH07XG5cbiAgQnJvd3Nlckhpc3RvcnkucHJvdG90eXBlLmRlYWN0aXZhdGUgPSBmdW5jdGlvbiBkZWFjdGl2YXRlKCkge1xuICAgIF9hdXJlbGlhUGFsLlBMQVRGT1JNLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3BvcHN0YXRlJywgdGhpcy5fY2hlY2tVcmxDYWxsYmFjayk7XG4gICAgX2F1cmVsaWFQYWwuUExBVEZPUk0ucmVtb3ZlRXZlbnRMaXN0ZW5lcignaGFzaGNoYW5nZScsIHRoaXMuX2NoZWNrVXJsQ2FsbGJhY2spO1xuICAgIHRoaXMuX2lzQWN0aXZlID0gZmFsc2U7XG4gICAgdGhpcy5saW5rSGFuZGxlci5kZWFjdGl2YXRlKCk7XG4gIH07XG5cbiAgQnJvd3Nlckhpc3RvcnkucHJvdG90eXBlLmdldEFic29sdXRlUm9vdCA9IGZ1bmN0aW9uIGdldEFic29sdXRlUm9vdCgpIHtcbiAgICB2YXIgb3JpZ2luID0gY3JlYXRlT3JpZ2luKHRoaXMubG9jYXRpb24ucHJvdG9jb2wsIHRoaXMubG9jYXRpb24uaG9zdG5hbWUsIHRoaXMubG9jYXRpb24ucG9ydCk7XG4gICAgcmV0dXJuICcnICsgb3JpZ2luICsgdGhpcy5yb290O1xuICB9O1xuXG4gIEJyb3dzZXJIaXN0b3J5LnByb3RvdHlwZS5uYXZpZ2F0ZSA9IGZ1bmN0aW9uIG5hdmlnYXRlKGZyYWdtZW50KSB7XG4gICAgdmFyIF9yZWYgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDEgfHwgYXJndW1lbnRzWzFdID09PSB1bmRlZmluZWQgPyB7fSA6IGFyZ3VtZW50c1sxXTtcblxuICAgIHZhciBfcmVmJHRyaWdnZXIgPSBfcmVmLnRyaWdnZXI7XG4gICAgdmFyIHRyaWdnZXIgPSBfcmVmJHRyaWdnZXIgPT09IHVuZGVmaW5lZCA/IHRydWUgOiBfcmVmJHRyaWdnZXI7XG4gICAgdmFyIF9yZWYkcmVwbGFjZSA9IF9yZWYucmVwbGFjZTtcbiAgICB2YXIgcmVwbGFjZSA9IF9yZWYkcmVwbGFjZSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBfcmVmJHJlcGxhY2U7XG5cbiAgICBpZiAoZnJhZ21lbnQgJiYgYWJzb2x1dGVVcmwudGVzdChmcmFnbWVudCkpIHtcbiAgICAgIHRoaXMubG9jYXRpb24uaHJlZiA9IGZyYWdtZW50O1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLl9pc0FjdGl2ZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGZyYWdtZW50ID0gdGhpcy5fZ2V0RnJhZ21lbnQoZnJhZ21lbnQgfHwgJycpO1xuXG4gICAgaWYgKHRoaXMuZnJhZ21lbnQgPT09IGZyYWdtZW50ICYmICFyZXBsYWNlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdGhpcy5mcmFnbWVudCA9IGZyYWdtZW50O1xuXG4gICAgdmFyIHVybCA9IHRoaXMucm9vdCArIGZyYWdtZW50O1xuXG4gICAgaWYgKGZyYWdtZW50ID09PSAnJyAmJiB1cmwgIT09ICcvJykge1xuICAgICAgdXJsID0gdXJsLnNsaWNlKDAsIC0xKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5faGFzUHVzaFN0YXRlKSB7XG4gICAgICB1cmwgPSB1cmwucmVwbGFjZSgnLy8nLCAnLycpO1xuICAgICAgdGhpcy5oaXN0b3J5W3JlcGxhY2UgPyAncmVwbGFjZVN0YXRlJyA6ICdwdXNoU3RhdGUnXSh7fSwgX2F1cmVsaWFQYWwuRE9NLnRpdGxlLCB1cmwpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5fd2FudHNIYXNoQ2hhbmdlKSB7XG4gICAgICB1cGRhdGVIYXNoKHRoaXMubG9jYXRpb24sIGZyYWdtZW50LCByZXBsYWNlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMubG9jYXRpb24uYXNzaWduKHVybCk7XG4gICAgfVxuXG4gICAgaWYgKHRyaWdnZXIpIHtcbiAgICAgIHJldHVybiB0aGlzLl9sb2FkVXJsKGZyYWdtZW50KTtcbiAgICB9XG4gIH07XG5cbiAgQnJvd3Nlckhpc3RvcnkucHJvdG90eXBlLm5hdmlnYXRlQmFjayA9IGZ1bmN0aW9uIG5hdmlnYXRlQmFjaygpIHtcbiAgICB0aGlzLmhpc3RvcnkuYmFjaygpO1xuICB9O1xuXG4gIEJyb3dzZXJIaXN0b3J5LnByb3RvdHlwZS5zZXRUaXRsZSA9IGZ1bmN0aW9uIHNldFRpdGxlKHRpdGxlKSB7XG4gICAgX2F1cmVsaWFQYWwuRE9NLnRpdGxlID0gdGl0bGU7XG4gIH07XG5cbiAgQnJvd3Nlckhpc3RvcnkucHJvdG90eXBlLl9nZXRIYXNoID0gZnVuY3Rpb24gX2dldEhhc2goKSB7XG4gICAgcmV0dXJuIHRoaXMubG9jYXRpb24uaGFzaC5zdWJzdHIoMSk7XG4gIH07XG5cbiAgQnJvd3Nlckhpc3RvcnkucHJvdG90eXBlLl9nZXRGcmFnbWVudCA9IGZ1bmN0aW9uIF9nZXRGcmFnbWVudChmcmFnbWVudCwgZm9yY2VQdXNoU3RhdGUpIHtcbiAgICB2YXIgcm9vdCA9IHZvaWQgMDtcblxuICAgIGlmICghZnJhZ21lbnQpIHtcbiAgICAgIGlmICh0aGlzLl9oYXNQdXNoU3RhdGUgfHwgIXRoaXMuX3dhbnRzSGFzaENoYW5nZSB8fCBmb3JjZVB1c2hTdGF0ZSkge1xuICAgICAgICBmcmFnbWVudCA9IHRoaXMubG9jYXRpb24ucGF0aG5hbWUgKyB0aGlzLmxvY2F0aW9uLnNlYXJjaDtcbiAgICAgICAgcm9vdCA9IHRoaXMucm9vdC5yZXBsYWNlKHRyYWlsaW5nU2xhc2gsICcnKTtcbiAgICAgICAgaWYgKCFmcmFnbWVudC5pbmRleE9mKHJvb3QpKSB7XG4gICAgICAgICAgZnJhZ21lbnQgPSBmcmFnbWVudC5zdWJzdHIocm9vdC5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmcmFnbWVudCA9IHRoaXMuX2dldEhhc2goKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gJy8nICsgZnJhZ21lbnQucmVwbGFjZShyb3V0ZVN0cmlwcGVyLCAnJyk7XG4gIH07XG5cbiAgQnJvd3Nlckhpc3RvcnkucHJvdG90eXBlLl9jaGVja1VybCA9IGZ1bmN0aW9uIF9jaGVja1VybCgpIHtcbiAgICB2YXIgY3VycmVudCA9IHRoaXMuX2dldEZyYWdtZW50KCk7XG4gICAgaWYgKGN1cnJlbnQgIT09IHRoaXMuZnJhZ21lbnQpIHtcbiAgICAgIHRoaXMuX2xvYWRVcmwoKTtcbiAgICB9XG4gIH07XG5cbiAgQnJvd3Nlckhpc3RvcnkucHJvdG90eXBlLl9sb2FkVXJsID0gZnVuY3Rpb24gX2xvYWRVcmwoZnJhZ21lbnRPdmVycmlkZSkge1xuICAgIHZhciBmcmFnbWVudCA9IHRoaXMuZnJhZ21lbnQgPSB0aGlzLl9nZXRGcmFnbWVudChmcmFnbWVudE92ZXJyaWRlKTtcblxuICAgIHJldHVybiB0aGlzLm9wdGlvbnMucm91dGVIYW5kbGVyID8gdGhpcy5vcHRpb25zLnJvdXRlSGFuZGxlcihmcmFnbWVudCkgOiBmYWxzZTtcbiAgfTtcblxuICByZXR1cm4gQnJvd3Nlckhpc3Rvcnk7XG59KF9hdXJlbGlhSGlzdG9yeS5IaXN0b3J5KSwgX2NsYXNzLmluamVjdCA9IFtMaW5rSGFuZGxlcl0sIF90ZW1wKTtcblxudmFyIHJvdXRlU3RyaXBwZXIgPSAvXiM/XFwvKnxcXHMrJC9nO1xuXG52YXIgcm9vdFN0cmlwcGVyID0gL15cXC8rfFxcLyskL2c7XG5cbnZhciB0cmFpbGluZ1NsYXNoID0gL1xcLyQvO1xuXG52YXIgYWJzb2x1dGVVcmwgPSAvXihbYS16XVthLXowLTkrXFwtLl0qOik/XFwvXFwvL2k7XG5cbmZ1bmN0aW9uIHVwZGF0ZUhhc2gobG9jYXRpb24sIGZyYWdtZW50LCByZXBsYWNlKSB7XG4gIGlmIChyZXBsYWNlKSB7XG4gICAgdmFyIF9ocmVmID0gbG9jYXRpb24uaHJlZi5yZXBsYWNlKC8oamF2YXNjcmlwdDp8IykuKiQvLCAnJyk7XG4gICAgbG9jYXRpb24ucmVwbGFjZShfaHJlZiArICcjJyArIGZyYWdtZW50KTtcbiAgfSBlbHNlIHtcbiAgICBsb2NhdGlvbi5oYXNoID0gJyMnICsgZnJhZ21lbnQ7XG4gIH1cbn1cblxuZnVuY3Rpb24gY3JlYXRlT3JpZ2luKHByb3RvY29sLCBob3N0bmFtZSwgcG9ydCkge1xuICByZXR1cm4gcHJvdG9jb2wgKyAnLy8nICsgaG9zdG5hbWUgKyAocG9ydCA/ICc6JyArIHBvcnQgOiAnJyk7XG59XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtaGlzdG9yeS1icm93c2VyL2Rpc3QvY29tbW9uanMvYXVyZWxpYS1oaXN0b3J5LWJyb3dzZXIuanNcbi8vIG1vZHVsZSBpZCA9IDQ4XG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuQ29uc29sZUFwcGVuZGVyID0gdW5kZWZpbmVkO1xuXG52YXIgX2F1cmVsaWFMb2dnaW5nID0gcmVxdWlyZSgnYXVyZWxpYS1sb2dnaW5nJyk7XG5cblxuXG52YXIgQ29uc29sZUFwcGVuZGVyID0gZXhwb3J0cy5Db25zb2xlQXBwZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIENvbnNvbGVBcHBlbmRlcigpIHtcbiAgICBcbiAgfVxuXG4gIENvbnNvbGVBcHBlbmRlci5wcm90b3R5cGUuZGVidWcgPSBmdW5jdGlvbiBkZWJ1Zyhsb2dnZXIpIHtcbiAgICB2YXIgX2NvbnNvbGU7XG5cbiAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgcmVzdCA9IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICAgIHJlc3RbX2tleSAtIDFdID0gYXJndW1lbnRzW19rZXldO1xuICAgIH1cblxuICAgIChfY29uc29sZSA9IGNvbnNvbGUpLmRlYnVnLmFwcGx5KF9jb25zb2xlLCBbJ0RFQlVHIFsnICsgbG9nZ2VyLmlkICsgJ10nXS5jb25jYXQocmVzdCkpO1xuICB9O1xuXG4gIENvbnNvbGVBcHBlbmRlci5wcm90b3R5cGUuaW5mbyA9IGZ1bmN0aW9uIGluZm8obG9nZ2VyKSB7XG4gICAgdmFyIF9jb25zb2xlMjtcblxuICAgIGZvciAodmFyIF9sZW4yID0gYXJndW1lbnRzLmxlbmd0aCwgcmVzdCA9IEFycmF5KF9sZW4yID4gMSA/IF9sZW4yIC0gMSA6IDApLCBfa2V5MiA9IDE7IF9rZXkyIDwgX2xlbjI7IF9rZXkyKyspIHtcbiAgICAgIHJlc3RbX2tleTIgLSAxXSA9IGFyZ3VtZW50c1tfa2V5Ml07XG4gICAgfVxuXG4gICAgKF9jb25zb2xlMiA9IGNvbnNvbGUpLmluZm8uYXBwbHkoX2NvbnNvbGUyLCBbJ0lORk8gWycgKyBsb2dnZXIuaWQgKyAnXSddLmNvbmNhdChyZXN0KSk7XG4gIH07XG5cbiAgQ29uc29sZUFwcGVuZGVyLnByb3RvdHlwZS53YXJuID0gZnVuY3Rpb24gd2Fybihsb2dnZXIpIHtcbiAgICB2YXIgX2NvbnNvbGUzO1xuXG4gICAgZm9yICh2YXIgX2xlbjMgPSBhcmd1bWVudHMubGVuZ3RoLCByZXN0ID0gQXJyYXkoX2xlbjMgPiAxID8gX2xlbjMgLSAxIDogMCksIF9rZXkzID0gMTsgX2tleTMgPCBfbGVuMzsgX2tleTMrKykge1xuICAgICAgcmVzdFtfa2V5MyAtIDFdID0gYXJndW1lbnRzW19rZXkzXTtcbiAgICB9XG5cbiAgICAoX2NvbnNvbGUzID0gY29uc29sZSkud2Fybi5hcHBseShfY29uc29sZTMsIFsnV0FSTiBbJyArIGxvZ2dlci5pZCArICddJ10uY29uY2F0KHJlc3QpKTtcbiAgfTtcblxuICBDb25zb2xlQXBwZW5kZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gZXJyb3IobG9nZ2VyKSB7XG4gICAgdmFyIF9jb25zb2xlNDtcblxuICAgIGZvciAodmFyIF9sZW40ID0gYXJndW1lbnRzLmxlbmd0aCwgcmVzdCA9IEFycmF5KF9sZW40ID4gMSA/IF9sZW40IC0gMSA6IDApLCBfa2V5NCA9IDE7IF9rZXk0IDwgX2xlbjQ7IF9rZXk0KyspIHtcbiAgICAgIHJlc3RbX2tleTQgLSAxXSA9IGFyZ3VtZW50c1tfa2V5NF07XG4gICAgfVxuXG4gICAgKF9jb25zb2xlNCA9IGNvbnNvbGUpLmVycm9yLmFwcGx5KF9jb25zb2xlNCwgWydFUlJPUiBbJyArIGxvZ2dlci5pZCArICddJ10uY29uY2F0KHJlc3QpKTtcbiAgfTtcblxuICByZXR1cm4gQ29uc29sZUFwcGVuZGVyO1xufSgpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLWxvZ2dpbmctY29uc29sZS9kaXN0L2NvbW1vbmpzL2F1cmVsaWEtbG9nZ2luZy1jb25zb2xlLmpzXG4vLyBtb2R1bGUgaWQgPSA0OVxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLlRlbXBsYXRpbmdCaW5kaW5nTGFuZ3VhZ2UgPSBleHBvcnRzLlN5bnRheEludGVycHJldGVyID0gZXhwb3J0cy5DaGlsZEludGVycG9sYXRpb25CaW5kaW5nID0gZXhwb3J0cy5JbnRlcnBvbGF0aW9uQmluZGluZyA9IGV4cG9ydHMuSW50ZXJwb2xhdGlvbkJpbmRpbmdFeHByZXNzaW9uID0gZXhwb3J0cy5BdHRyaWJ1dGVNYXAgPSB1bmRlZmluZWQ7XG5cbnZhciBfY2xhc3MsIF90ZW1wLCBfZGVjLCBfY2xhc3MyLCBfY2xhc3MzLCBfdGVtcDIsIF9jbGFzczQsIF90ZW1wMztcblxuZXhwb3J0cy5jb25maWd1cmUgPSBjb25maWd1cmU7XG5cbnZhciBfYXVyZWxpYUxvZ2dpbmcgPSByZXF1aXJlKCdhdXJlbGlhLWxvZ2dpbmcnKTtcblxudmFyIExvZ01hbmFnZXIgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChfYXVyZWxpYUxvZ2dpbmcpO1xuXG52YXIgX2F1cmVsaWFCaW5kaW5nID0gcmVxdWlyZSgnYXVyZWxpYS1iaW5kaW5nJyk7XG5cbnZhciBfYXVyZWxpYVRlbXBsYXRpbmcgPSByZXF1aXJlKCdhdXJlbGlhLXRlbXBsYXRpbmcnKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7IGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsgcmV0dXJuIG9iajsgfSBlbHNlIHsgdmFyIG5ld09iaiA9IHt9OyBpZiAob2JqICE9IG51bGwpIHsgZm9yICh2YXIga2V5IGluIG9iaikgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsgfSB9IG5ld09iai5kZWZhdWx0ID0gb2JqOyByZXR1cm4gbmV3T2JqOyB9IH1cblxuZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoIXNlbGYpIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKFwidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkXCIpOyB9IHJldHVybiBjYWxsICYmICh0eXBlb2YgY2FsbCA9PT0gXCJvYmplY3RcIiB8fCB0eXBlb2YgY2FsbCA9PT0gXCJmdW5jdGlvblwiKSA/IGNhbGwgOiBzZWxmOyB9XG5cbmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09IFwiZnVuY3Rpb25cIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90IFwiICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfVxuXG5cblxudmFyIEF0dHJpYnV0ZU1hcCA9IGV4cG9ydHMuQXR0cmlidXRlTWFwID0gKF90ZW1wID0gX2NsYXNzID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBBdHRyaWJ1dGVNYXAoc3ZnKSB7XG4gICAgXG5cbiAgICB0aGlzLmVsZW1lbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICB0aGlzLmFsbEVsZW1lbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblxuICAgIHRoaXMuc3ZnID0gc3ZnO1xuXG4gICAgdGhpcy5yZWdpc3RlclVuaXZlcnNhbCgnYWNjZXNza2V5JywgJ2FjY2Vzc0tleScpO1xuICAgIHRoaXMucmVnaXN0ZXJVbml2ZXJzYWwoJ2NvbnRlbnRlZGl0YWJsZScsICdjb250ZW50RWRpdGFibGUnKTtcbiAgICB0aGlzLnJlZ2lzdGVyVW5pdmVyc2FsKCd0YWJpbmRleCcsICd0YWJJbmRleCcpO1xuICAgIHRoaXMucmVnaXN0ZXJVbml2ZXJzYWwoJ3RleHRjb250ZW50JywgJ3RleHRDb250ZW50Jyk7XG4gICAgdGhpcy5yZWdpc3RlclVuaXZlcnNhbCgnaW5uZXJodG1sJywgJ2lubmVySFRNTCcpO1xuICAgIHRoaXMucmVnaXN0ZXJVbml2ZXJzYWwoJ3Njcm9sbHRvcCcsICdzY3JvbGxUb3AnKTtcbiAgICB0aGlzLnJlZ2lzdGVyVW5pdmVyc2FsKCdzY3JvbGxsZWZ0JywgJ3Njcm9sbExlZnQnKTtcbiAgICB0aGlzLnJlZ2lzdGVyVW5pdmVyc2FsKCdyZWFkb25seScsICdyZWFkT25seScpO1xuXG4gICAgdGhpcy5yZWdpc3RlcignbGFiZWwnLCAnZm9yJywgJ2h0bWxGb3InKTtcblxuICAgIHRoaXMucmVnaXN0ZXIoJ2lucHV0JywgJ21heGxlbmd0aCcsICdtYXhMZW5ndGgnKTtcbiAgICB0aGlzLnJlZ2lzdGVyKCdpbnB1dCcsICdtaW5sZW5ndGgnLCAnbWluTGVuZ3RoJyk7XG4gICAgdGhpcy5yZWdpc3RlcignaW5wdXQnLCAnZm9ybWFjdGlvbicsICdmb3JtQWN0aW9uJyk7XG4gICAgdGhpcy5yZWdpc3RlcignaW5wdXQnLCAnZm9ybWVuY3R5cGUnLCAnZm9ybUVuY1R5cGUnKTtcbiAgICB0aGlzLnJlZ2lzdGVyKCdpbnB1dCcsICdmb3JtbWV0aG9kJywgJ2Zvcm1NZXRob2QnKTtcbiAgICB0aGlzLnJlZ2lzdGVyKCdpbnB1dCcsICdmb3Jtbm92YWxpZGF0ZScsICdmb3JtTm9WYWxpZGF0ZScpO1xuICAgIHRoaXMucmVnaXN0ZXIoJ2lucHV0JywgJ2Zvcm10YXJnZXQnLCAnZm9ybVRhcmdldCcpO1xuXG4gICAgdGhpcy5yZWdpc3RlcigndGV4dGFyZWEnLCAnbWF4bGVuZ3RoJywgJ21heExlbmd0aCcpO1xuXG4gICAgdGhpcy5yZWdpc3RlcigndGQnLCAncm93c3BhbicsICdyb3dTcGFuJyk7XG4gICAgdGhpcy5yZWdpc3RlcigndGQnLCAnY29sc3BhbicsICdjb2xTcGFuJyk7XG4gICAgdGhpcy5yZWdpc3RlcigndGgnLCAncm93c3BhbicsICdyb3dTcGFuJyk7XG4gICAgdGhpcy5yZWdpc3RlcigndGgnLCAnY29sc3BhbicsICdjb2xTcGFuJyk7XG4gIH1cblxuICBBdHRyaWJ1dGVNYXAucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gcmVnaXN0ZXIoZWxlbWVudE5hbWUsIGF0dHJpYnV0ZU5hbWUsIHByb3BlcnR5TmFtZSkge1xuICAgIGVsZW1lbnROYW1lID0gZWxlbWVudE5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICBhdHRyaWJ1dGVOYW1lID0gYXR0cmlidXRlTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50c1tlbGVtZW50TmFtZV0gPSB0aGlzLmVsZW1lbnRzW2VsZW1lbnROYW1lXSB8fCBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgIGVsZW1lbnRbYXR0cmlidXRlTmFtZV0gPSBwcm9wZXJ0eU5hbWU7XG4gIH07XG5cbiAgQXR0cmlidXRlTWFwLnByb3RvdHlwZS5yZWdpc3RlclVuaXZlcnNhbCA9IGZ1bmN0aW9uIHJlZ2lzdGVyVW5pdmVyc2FsKGF0dHJpYnV0ZU5hbWUsIHByb3BlcnR5TmFtZSkge1xuICAgIGF0dHJpYnV0ZU5hbWUgPSBhdHRyaWJ1dGVOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgdGhpcy5hbGxFbGVtZW50c1thdHRyaWJ1dGVOYW1lXSA9IHByb3BlcnR5TmFtZTtcbiAgfTtcblxuICBBdHRyaWJ1dGVNYXAucHJvdG90eXBlLm1hcCA9IGZ1bmN0aW9uIG1hcChlbGVtZW50TmFtZSwgYXR0cmlidXRlTmFtZSkge1xuICAgIGlmICh0aGlzLnN2Zy5pc1N0YW5kYXJkU3ZnQXR0cmlidXRlKGVsZW1lbnROYW1lLCBhdHRyaWJ1dGVOYW1lKSkge1xuICAgICAgcmV0dXJuIGF0dHJpYnV0ZU5hbWU7XG4gICAgfVxuICAgIGVsZW1lbnROYW1lID0gZWxlbWVudE5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICBhdHRyaWJ1dGVOYW1lID0gYXR0cmlidXRlTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50c1tlbGVtZW50TmFtZV07XG4gICAgaWYgKGVsZW1lbnQgIT09IHVuZGVmaW5lZCAmJiBhdHRyaWJ1dGVOYW1lIGluIGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBlbGVtZW50W2F0dHJpYnV0ZU5hbWVdO1xuICAgIH1cbiAgICBpZiAoYXR0cmlidXRlTmFtZSBpbiB0aGlzLmFsbEVsZW1lbnRzKSB7XG4gICAgICByZXR1cm4gdGhpcy5hbGxFbGVtZW50c1thdHRyaWJ1dGVOYW1lXTtcbiAgICB9XG5cbiAgICBpZiAoLyheZGF0YS0pfCheYXJpYS0pfDovLnRlc3QoYXR0cmlidXRlTmFtZSkpIHtcbiAgICAgIHJldHVybiBhdHRyaWJ1dGVOYW1lO1xuICAgIH1cbiAgICByZXR1cm4gKDAsIF9hdXJlbGlhQmluZGluZy5jYW1lbENhc2UpKGF0dHJpYnV0ZU5hbWUpO1xuICB9O1xuXG4gIHJldHVybiBBdHRyaWJ1dGVNYXA7XG59KCksIF9jbGFzcy5pbmplY3QgPSBbX2F1cmVsaWFCaW5kaW5nLlNWR0FuYWx5emVyXSwgX3RlbXApO1xuXG52YXIgSW50ZXJwb2xhdGlvbkJpbmRpbmdFeHByZXNzaW9uID0gZXhwb3J0cy5JbnRlcnBvbGF0aW9uQmluZGluZ0V4cHJlc3Npb24gPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEludGVycG9sYXRpb25CaW5kaW5nRXhwcmVzc2lvbihvYnNlcnZlckxvY2F0b3IsIHRhcmdldFByb3BlcnR5LCBwYXJ0cywgbW9kZSwgbG9va3VwRnVuY3Rpb25zLCBhdHRyaWJ1dGUpIHtcbiAgICBcblxuICAgIHRoaXMub2JzZXJ2ZXJMb2NhdG9yID0gb2JzZXJ2ZXJMb2NhdG9yO1xuICAgIHRoaXMudGFyZ2V0UHJvcGVydHkgPSB0YXJnZXRQcm9wZXJ0eTtcbiAgICB0aGlzLnBhcnRzID0gcGFydHM7XG4gICAgdGhpcy5tb2RlID0gbW9kZTtcbiAgICB0aGlzLmxvb2t1cEZ1bmN0aW9ucyA9IGxvb2t1cEZ1bmN0aW9ucztcbiAgICB0aGlzLmF0dHJpYnV0ZSA9IHRoaXMuYXR0clRvUmVtb3ZlID0gYXR0cmlidXRlO1xuICAgIHRoaXMuZGlzY3JldGUgPSBmYWxzZTtcbiAgfVxuXG4gIEludGVycG9sYXRpb25CaW5kaW5nRXhwcmVzc2lvbi5wcm90b3R5cGUuY3JlYXRlQmluZGluZyA9IGZ1bmN0aW9uIGNyZWF0ZUJpbmRpbmcodGFyZ2V0KSB7XG4gICAgaWYgKHRoaXMucGFydHMubGVuZ3RoID09PSAzKSB7XG4gICAgICByZXR1cm4gbmV3IENoaWxkSW50ZXJwb2xhdGlvbkJpbmRpbmcodGFyZ2V0LCB0aGlzLm9ic2VydmVyTG9jYXRvciwgdGhpcy5wYXJ0c1sxXSwgdGhpcy5tb2RlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucywgdGhpcy50YXJnZXRQcm9wZXJ0eSwgdGhpcy5wYXJ0c1swXSwgdGhpcy5wYXJ0c1syXSk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgSW50ZXJwb2xhdGlvbkJpbmRpbmcodGhpcy5vYnNlcnZlckxvY2F0b3IsIHRoaXMucGFydHMsIHRhcmdldCwgdGhpcy50YXJnZXRQcm9wZXJ0eSwgdGhpcy5tb2RlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgcmV0dXJuIEludGVycG9sYXRpb25CaW5kaW5nRXhwcmVzc2lvbjtcbn0oKTtcblxuZnVuY3Rpb24gdmFsaWRhdGVUYXJnZXQodGFyZ2V0LCBwcm9wZXJ0eU5hbWUpIHtcbiAgaWYgKHByb3BlcnR5TmFtZSA9PT0gJ3N0eWxlJykge1xuICAgIExvZ01hbmFnZXIuZ2V0TG9nZ2VyKCd0ZW1wbGF0aW5nLWJpbmRpbmcnKS5pbmZvKCdJbnRlcm5ldCBFeHBsb3JlciBkb2VzIG5vdCBzdXBwb3J0IGludGVycG9sYXRpb24gaW4gXCJzdHlsZVwiIGF0dHJpYnV0ZXMuICBVc2UgdGhlIHN0eWxlIGF0dHJpYnV0ZVxcJ3MgYWxpYXMsIFwiY3NzXCIgaW5zdGVhZC4nKTtcbiAgfSBlbHNlIGlmICh0YXJnZXQucGFyZW50RWxlbWVudCAmJiB0YXJnZXQucGFyZW50RWxlbWVudC5ub2RlTmFtZSA9PT0gJ1RFWFRBUkVBJyAmJiBwcm9wZXJ0eU5hbWUgPT09ICd0ZXh0Q29udGVudCcpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludGVycG9sYXRpb24gYmluZGluZyBjYW5ub3QgYmUgdXNlZCBpbiB0aGUgY29udGVudCBvZiBhIHRleHRhcmVhIGVsZW1lbnQuICBVc2UgPHRleHRhcmVhIHZhbHVlLmJpbmQ9XCJleHByZXNzaW9uXCI+PC90ZXh0YXJlYT4gaW5zdGVhZC4nKTtcbiAgfVxufVxuXG52YXIgSW50ZXJwb2xhdGlvbkJpbmRpbmcgPSBleHBvcnRzLkludGVycG9sYXRpb25CaW5kaW5nID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBJbnRlcnBvbGF0aW9uQmluZGluZyhvYnNlcnZlckxvY2F0b3IsIHBhcnRzLCB0YXJnZXQsIHRhcmdldFByb3BlcnR5LCBtb2RlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICBcblxuICAgIHZhbGlkYXRlVGFyZ2V0KHRhcmdldCwgdGFyZ2V0UHJvcGVydHkpO1xuICAgIHRoaXMub2JzZXJ2ZXJMb2NhdG9yID0gb2JzZXJ2ZXJMb2NhdG9yO1xuICAgIHRoaXMucGFydHMgPSBwYXJ0cztcbiAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcbiAgICB0aGlzLnRhcmdldFByb3BlcnR5ID0gdGFyZ2V0UHJvcGVydHk7XG4gICAgdGhpcy50YXJnZXRBY2Nlc3NvciA9IG9ic2VydmVyTG9jYXRvci5nZXRBY2Nlc3Nvcih0YXJnZXQsIHRhcmdldFByb3BlcnR5KTtcbiAgICB0aGlzLm1vZGUgPSBtb2RlO1xuICAgIHRoaXMubG9va3VwRnVuY3Rpb25zID0gbG9va3VwRnVuY3Rpb25zO1xuICB9XG5cbiAgSW50ZXJwb2xhdGlvbkJpbmRpbmcucHJvdG90eXBlLmludGVycG9sYXRlID0gZnVuY3Rpb24gaW50ZXJwb2xhdGUoKSB7XG4gICAgaWYgKHRoaXMuaXNCb3VuZCkge1xuICAgICAgdmFyIHZhbHVlID0gJyc7XG4gICAgICB2YXIgcGFydHMgPSB0aGlzLnBhcnRzO1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gcGFydHMubGVuZ3RoOyBpIDwgaWk7IGkrKykge1xuICAgICAgICB2YWx1ZSArPSBpICUgMiA9PT0gMCA/IHBhcnRzW2ldIDogdGhpc1snY2hpbGRCaW5kaW5nJyArIGldLnZhbHVlO1xuICAgICAgfVxuICAgICAgdGhpcy50YXJnZXRBY2Nlc3Nvci5zZXRWYWx1ZSh2YWx1ZSwgdGhpcy50YXJnZXQsIHRoaXMudGFyZ2V0UHJvcGVydHkpO1xuICAgIH1cbiAgfTtcblxuICBJbnRlcnBvbGF0aW9uQmluZGluZy5wcm90b3R5cGUudXBkYXRlT25lVGltZUJpbmRpbmdzID0gZnVuY3Rpb24gdXBkYXRlT25lVGltZUJpbmRpbmdzKCkge1xuICAgIGZvciAodmFyIGkgPSAxLCBpaSA9IHRoaXMucGFydHMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikge1xuICAgICAgdmFyIGNoaWxkID0gdGhpc1snY2hpbGRCaW5kaW5nJyArIGldO1xuICAgICAgaWYgKGNoaWxkLm1vZGUgPT09IF9hdXJlbGlhQmluZGluZy5iaW5kaW5nTW9kZS5vbmVUaW1lKSB7XG4gICAgICAgIGNoaWxkLmNhbGwoKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgSW50ZXJwb2xhdGlvbkJpbmRpbmcucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiBiaW5kKHNvdXJjZSkge1xuICAgIGlmICh0aGlzLmlzQm91bmQpIHtcbiAgICAgIGlmICh0aGlzLnNvdXJjZSA9PT0gc291cmNlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMudW5iaW5kKCk7XG4gICAgfVxuICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuXG4gICAgdmFyIHBhcnRzID0gdGhpcy5wYXJ0cztcbiAgICBmb3IgKHZhciBpID0gMSwgaWkgPSBwYXJ0cy5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7XG4gICAgICB2YXIgYmluZGluZyA9IG5ldyBDaGlsZEludGVycG9sYXRpb25CaW5kaW5nKHRoaXMsIHRoaXMub2JzZXJ2ZXJMb2NhdG9yLCBwYXJ0c1tpXSwgdGhpcy5tb2RlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgICBiaW5kaW5nLmJpbmQoc291cmNlKTtcbiAgICAgIHRoaXNbJ2NoaWxkQmluZGluZycgKyBpXSA9IGJpbmRpbmc7XG4gICAgfVxuXG4gICAgdGhpcy5pc0JvdW5kID0gdHJ1ZTtcbiAgICB0aGlzLmludGVycG9sYXRlKCk7XG4gIH07XG5cbiAgSW50ZXJwb2xhdGlvbkJpbmRpbmcucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uIHVuYmluZCgpIHtcbiAgICBpZiAoIXRoaXMuaXNCb3VuZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmlzQm91bmQgPSBmYWxzZTtcbiAgICB0aGlzLnNvdXJjZSA9IG51bGw7XG4gICAgdmFyIHBhcnRzID0gdGhpcy5wYXJ0cztcbiAgICBmb3IgKHZhciBpID0gMSwgaWkgPSBwYXJ0cy5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7XG4gICAgICB2YXIgbmFtZSA9ICdjaGlsZEJpbmRpbmcnICsgaTtcbiAgICAgIHRoaXNbbmFtZV0udW5iaW5kKCk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBJbnRlcnBvbGF0aW9uQmluZGluZztcbn0oKTtcblxudmFyIENoaWxkSW50ZXJwb2xhdGlvbkJpbmRpbmcgPSBleHBvcnRzLkNoaWxkSW50ZXJwb2xhdGlvbkJpbmRpbmcgPSAoX2RlYyA9ICgwLCBfYXVyZWxpYUJpbmRpbmcuY29ubmVjdGFibGUpKCksIF9kZWMoX2NsYXNzMiA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQ2hpbGRJbnRlcnBvbGF0aW9uQmluZGluZyh0YXJnZXQsIG9ic2VydmVyTG9jYXRvciwgc291cmNlRXhwcmVzc2lvbiwgbW9kZSwgbG9va3VwRnVuY3Rpb25zLCB0YXJnZXRQcm9wZXJ0eSwgbGVmdCwgcmlnaHQpIHtcbiAgICBcblxuICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBJbnRlcnBvbGF0aW9uQmluZGluZykge1xuICAgICAgdGhpcy5wYXJlbnQgPSB0YXJnZXQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhbGlkYXRlVGFyZ2V0KHRhcmdldCwgdGFyZ2V0UHJvcGVydHkpO1xuICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7XG4gICAgICB0aGlzLnRhcmdldFByb3BlcnR5ID0gdGFyZ2V0UHJvcGVydHk7XG4gICAgICB0aGlzLnRhcmdldEFjY2Vzc29yID0gb2JzZXJ2ZXJMb2NhdG9yLmdldEFjY2Vzc29yKHRhcmdldCwgdGFyZ2V0UHJvcGVydHkpO1xuICAgIH1cbiAgICB0aGlzLm9ic2VydmVyTG9jYXRvciA9IG9ic2VydmVyTG9jYXRvcjtcbiAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24gPSBzb3VyY2VFeHByZXNzaW9uO1xuICAgIHRoaXMubW9kZSA9IG1vZGU7XG4gICAgdGhpcy5sb29rdXBGdW5jdGlvbnMgPSBsb29rdXBGdW5jdGlvbnM7XG4gICAgdGhpcy5sZWZ0ID0gbGVmdDtcbiAgICB0aGlzLnJpZ2h0ID0gcmlnaHQ7XG4gIH1cblxuICBDaGlsZEludGVycG9sYXRpb25CaW5kaW5nLnByb3RvdHlwZS51cGRhdGVUYXJnZXQgPSBmdW5jdGlvbiB1cGRhdGVUYXJnZXQodmFsdWUpIHtcbiAgICB2YWx1ZSA9IHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgPyAnJyA6IHZhbHVlLnRvU3RyaW5nKCk7XG4gICAgaWYgKHZhbHVlICE9PSB0aGlzLnZhbHVlKSB7XG4gICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgICBpZiAodGhpcy5wYXJlbnQpIHtcbiAgICAgICAgdGhpcy5wYXJlbnQuaW50ZXJwb2xhdGUoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMudGFyZ2V0QWNjZXNzb3Iuc2V0VmFsdWUodGhpcy5sZWZ0ICsgdmFsdWUgKyB0aGlzLnJpZ2h0LCB0aGlzLnRhcmdldCwgdGhpcy50YXJnZXRQcm9wZXJ0eSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIENoaWxkSW50ZXJwb2xhdGlvbkJpbmRpbmcucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiBjYWxsKCkge1xuICAgIGlmICghdGhpcy5pc0JvdW5kKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5yYXdWYWx1ZSA9IHRoaXMuc291cmNlRXhwcmVzc2lvbi5ldmFsdWF0ZSh0aGlzLnNvdXJjZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICAgIHRoaXMudXBkYXRlVGFyZ2V0KHRoaXMucmF3VmFsdWUpO1xuXG4gICAgaWYgKHRoaXMubW9kZSAhPT0gX2F1cmVsaWFCaW5kaW5nLmJpbmRpbmdNb2RlLm9uZVRpbWUpIHtcbiAgICAgIHRoaXMuX3ZlcnNpb24rKztcbiAgICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi5jb25uZWN0KHRoaXMsIHRoaXMuc291cmNlKTtcbiAgICAgIGlmICh0aGlzLnJhd1ZhbHVlIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgdGhpcy5vYnNlcnZlQXJyYXkodGhpcy5yYXdWYWx1ZSk7XG4gICAgICB9XG4gICAgICB0aGlzLnVub2JzZXJ2ZShmYWxzZSk7XG4gICAgfVxuICB9O1xuXG4gIENoaWxkSW50ZXJwb2xhdGlvbkJpbmRpbmcucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiBiaW5kKHNvdXJjZSkge1xuICAgIGlmICh0aGlzLmlzQm91bmQpIHtcbiAgICAgIGlmICh0aGlzLnNvdXJjZSA9PT0gc291cmNlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMudW5iaW5kKCk7XG4gICAgfVxuICAgIHRoaXMuaXNCb3VuZCA9IHRydWU7XG4gICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cbiAgICB2YXIgc291cmNlRXhwcmVzc2lvbiA9IHRoaXMuc291cmNlRXhwcmVzc2lvbjtcbiAgICBpZiAoc291cmNlRXhwcmVzc2lvbi5iaW5kKSB7XG4gICAgICBzb3VyY2VFeHByZXNzaW9uLmJpbmQodGhpcywgc291cmNlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgfVxuXG4gICAgdGhpcy5yYXdWYWx1ZSA9IHNvdXJjZUV4cHJlc3Npb24uZXZhbHVhdGUoc291cmNlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgdGhpcy51cGRhdGVUYXJnZXQodGhpcy5yYXdWYWx1ZSk7XG5cbiAgICBpZiAodGhpcy5tb2RlID09PSBfYXVyZWxpYUJpbmRpbmcuYmluZGluZ01vZGUub25lV2F5KSB7XG4gICAgICAoMCwgX2F1cmVsaWFCaW5kaW5nLmVucXVldWVCaW5kaW5nQ29ubmVjdCkodGhpcyk7XG4gICAgfVxuICB9O1xuXG4gIENoaWxkSW50ZXJwb2xhdGlvbkJpbmRpbmcucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uIHVuYmluZCgpIHtcbiAgICBpZiAoIXRoaXMuaXNCb3VuZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmlzQm91bmQgPSBmYWxzZTtcbiAgICB2YXIgc291cmNlRXhwcmVzc2lvbiA9IHRoaXMuc291cmNlRXhwcmVzc2lvbjtcbiAgICBpZiAoc291cmNlRXhwcmVzc2lvbi51bmJpbmQpIHtcbiAgICAgIHNvdXJjZUV4cHJlc3Npb24udW5iaW5kKHRoaXMsIHRoaXMuc291cmNlKTtcbiAgICB9XG4gICAgdGhpcy5zb3VyY2UgPSBudWxsO1xuICAgIHRoaXMudmFsdWUgPSBudWxsO1xuICAgIHRoaXMucmF3VmFsdWUgPSBudWxsO1xuICAgIHRoaXMudW5vYnNlcnZlKHRydWUpO1xuICB9O1xuXG4gIENoaWxkSW50ZXJwb2xhdGlvbkJpbmRpbmcucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KGV2YWx1YXRlKSB7XG4gICAgaWYgKCF0aGlzLmlzQm91bmQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGV2YWx1YXRlKSB7XG4gICAgICB0aGlzLnJhd1ZhbHVlID0gdGhpcy5zb3VyY2VFeHByZXNzaW9uLmV2YWx1YXRlKHRoaXMuc291cmNlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgICB0aGlzLnVwZGF0ZVRhcmdldCh0aGlzLnJhd1ZhbHVlKTtcbiAgICB9XG4gICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uLmNvbm5lY3QodGhpcywgdGhpcy5zb3VyY2UpO1xuICAgIGlmICh0aGlzLnJhd1ZhbHVlIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIHRoaXMub2JzZXJ2ZUFycmF5KHRoaXMucmF3VmFsdWUpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gQ2hpbGRJbnRlcnBvbGF0aW9uQmluZGluZztcbn0oKSkgfHwgX2NsYXNzMik7XG52YXIgU3ludGF4SW50ZXJwcmV0ZXIgPSBleHBvcnRzLlN5bnRheEludGVycHJldGVyID0gKF90ZW1wMiA9IF9jbGFzczMgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFN5bnRheEludGVycHJldGVyKHBhcnNlciwgb2JzZXJ2ZXJMb2NhdG9yLCBldmVudE1hbmFnZXIsIGF0dHJpYnV0ZU1hcCkge1xuICAgIFxuXG4gICAgdGhpcy5wYXJzZXIgPSBwYXJzZXI7XG4gICAgdGhpcy5vYnNlcnZlckxvY2F0b3IgPSBvYnNlcnZlckxvY2F0b3I7XG4gICAgdGhpcy5ldmVudE1hbmFnZXIgPSBldmVudE1hbmFnZXI7XG4gICAgdGhpcy5hdHRyaWJ1dGVNYXAgPSBhdHRyaWJ1dGVNYXA7XG4gIH1cblxuICBTeW50YXhJbnRlcnByZXRlci5wcm90b3R5cGUuaW50ZXJwcmV0ID0gZnVuY3Rpb24gaW50ZXJwcmV0KHJlc291cmNlcywgZWxlbWVudCwgaW5mbywgZXhpc3RpbmdJbnN0cnVjdGlvbiwgY29udGV4dCkge1xuICAgIGlmIChpbmZvLmNvbW1hbmQgaW4gdGhpcykge1xuICAgICAgcmV0dXJuIHRoaXNbaW5mby5jb21tYW5kXShyZXNvdXJjZXMsIGVsZW1lbnQsIGluZm8sIGV4aXN0aW5nSW5zdHJ1Y3Rpb24sIGNvbnRleHQpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmhhbmRsZVVua25vd25Db21tYW5kKHJlc291cmNlcywgZWxlbWVudCwgaW5mbywgZXhpc3RpbmdJbnN0cnVjdGlvbiwgY29udGV4dCk7XG4gIH07XG5cbiAgU3ludGF4SW50ZXJwcmV0ZXIucHJvdG90eXBlLmhhbmRsZVVua25vd25Db21tYW5kID0gZnVuY3Rpb24gaGFuZGxlVW5rbm93bkNvbW1hbmQocmVzb3VyY2VzLCBlbGVtZW50LCBpbmZvLCBleGlzdGluZ0luc3RydWN0aW9uLCBjb250ZXh0KSB7XG4gICAgTG9nTWFuYWdlci5nZXRMb2dnZXIoJ3RlbXBsYXRpbmctYmluZGluZycpLndhcm4oJ1Vua25vd24gYmluZGluZyBjb21tYW5kLicsIGluZm8pO1xuICAgIHJldHVybiBleGlzdGluZ0luc3RydWN0aW9uO1xuICB9O1xuXG4gIFN5bnRheEludGVycHJldGVyLnByb3RvdHlwZS5kZXRlcm1pbmVEZWZhdWx0QmluZGluZ01vZGUgPSBmdW5jdGlvbiBkZXRlcm1pbmVEZWZhdWx0QmluZGluZ01vZGUoZWxlbWVudCwgYXR0ck5hbWUsIGNvbnRleHQpIHtcbiAgICB2YXIgdGFnTmFtZSA9IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgaWYgKHRhZ05hbWUgPT09ICdpbnB1dCcgJiYgKGF0dHJOYW1lID09PSAndmFsdWUnIHx8IGF0dHJOYW1lID09PSAnZmlsZXMnKSAmJiBlbGVtZW50LnR5cGUgIT09ICdjaGVja2JveCcgJiYgZWxlbWVudC50eXBlICE9PSAncmFkaW8nIHx8IHRhZ05hbWUgPT09ICdpbnB1dCcgJiYgYXR0ck5hbWUgPT09ICdjaGVja2VkJyAmJiAoZWxlbWVudC50eXBlID09PSAnY2hlY2tib3gnIHx8IGVsZW1lbnQudHlwZSA9PT0gJ3JhZGlvJykgfHwgKHRhZ05hbWUgPT09ICd0ZXh0YXJlYScgfHwgdGFnTmFtZSA9PT0gJ3NlbGVjdCcpICYmIGF0dHJOYW1lID09PSAndmFsdWUnIHx8IChhdHRyTmFtZSA9PT0gJ3RleHRjb250ZW50JyB8fCBhdHRyTmFtZSA9PT0gJ2lubmVyaHRtbCcpICYmIGVsZW1lbnQuY29udGVudEVkaXRhYmxlID09PSAndHJ1ZScgfHwgYXR0ck5hbWUgPT09ICdzY3JvbGx0b3AnIHx8IGF0dHJOYW1lID09PSAnc2Nyb2xsbGVmdCcpIHtcbiAgICAgIHJldHVybiBfYXVyZWxpYUJpbmRpbmcuYmluZGluZ01vZGUudHdvV2F5O1xuICAgIH1cblxuICAgIGlmIChjb250ZXh0ICYmIGF0dHJOYW1lIGluIGNvbnRleHQuYXR0cmlidXRlcyAmJiBjb250ZXh0LmF0dHJpYnV0ZXNbYXR0ck5hbWVdICYmIGNvbnRleHQuYXR0cmlidXRlc1thdHRyTmFtZV0uZGVmYXVsdEJpbmRpbmdNb2RlID49IF9hdXJlbGlhQmluZGluZy5iaW5kaW5nTW9kZS5vbmVUaW1lKSB7XG4gICAgICByZXR1cm4gY29udGV4dC5hdHRyaWJ1dGVzW2F0dHJOYW1lXS5kZWZhdWx0QmluZGluZ01vZGU7XG4gICAgfVxuXG4gICAgcmV0dXJuIF9hdXJlbGlhQmluZGluZy5iaW5kaW5nTW9kZS5vbmVXYXk7XG4gIH07XG5cbiAgU3ludGF4SW50ZXJwcmV0ZXIucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiBiaW5kKHJlc291cmNlcywgZWxlbWVudCwgaW5mbywgZXhpc3RpbmdJbnN0cnVjdGlvbiwgY29udGV4dCkge1xuICAgIHZhciBpbnN0cnVjdGlvbiA9IGV4aXN0aW5nSW5zdHJ1Y3Rpb24gfHwgX2F1cmVsaWFUZW1wbGF0aW5nLkJlaGF2aW9ySW5zdHJ1Y3Rpb24uYXR0cmlidXRlKGluZm8uYXR0ck5hbWUpO1xuXG4gICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlc1tpbmZvLmF0dHJOYW1lXSA9IG5ldyBfYXVyZWxpYUJpbmRpbmcuQmluZGluZ0V4cHJlc3Npb24odGhpcy5vYnNlcnZlckxvY2F0b3IsIHRoaXMuYXR0cmlidXRlTWFwLm1hcChlbGVtZW50LnRhZ05hbWUsIGluZm8uYXR0ck5hbWUpLCB0aGlzLnBhcnNlci5wYXJzZShpbmZvLmF0dHJWYWx1ZSksIGluZm8uZGVmYXVsdEJpbmRpbmdNb2RlIHx8IHRoaXMuZGV0ZXJtaW5lRGVmYXVsdEJpbmRpbmdNb2RlKGVsZW1lbnQsIGluZm8uYXR0ck5hbWUsIGNvbnRleHQpLCByZXNvdXJjZXMubG9va3VwRnVuY3Rpb25zKTtcblxuICAgIHJldHVybiBpbnN0cnVjdGlvbjtcbiAgfTtcblxuICBTeW50YXhJbnRlcnByZXRlci5wcm90b3R5cGUudHJpZ2dlciA9IGZ1bmN0aW9uIHRyaWdnZXIocmVzb3VyY2VzLCBlbGVtZW50LCBpbmZvKSB7XG4gICAgcmV0dXJuIG5ldyBfYXVyZWxpYUJpbmRpbmcuTGlzdGVuZXJFeHByZXNzaW9uKHRoaXMuZXZlbnRNYW5hZ2VyLCBpbmZvLmF0dHJOYW1lLCB0aGlzLnBhcnNlci5wYXJzZShpbmZvLmF0dHJWYWx1ZSksIGZhbHNlLCB0cnVlLCByZXNvdXJjZXMubG9va3VwRnVuY3Rpb25zKTtcbiAgfTtcblxuICBTeW50YXhJbnRlcnByZXRlci5wcm90b3R5cGUuZGVsZWdhdGUgPSBmdW5jdGlvbiBkZWxlZ2F0ZShyZXNvdXJjZXMsIGVsZW1lbnQsIGluZm8pIHtcbiAgICByZXR1cm4gbmV3IF9hdXJlbGlhQmluZGluZy5MaXN0ZW5lckV4cHJlc3Npb24odGhpcy5ldmVudE1hbmFnZXIsIGluZm8uYXR0ck5hbWUsIHRoaXMucGFyc2VyLnBhcnNlKGluZm8uYXR0clZhbHVlKSwgdHJ1ZSwgdHJ1ZSwgcmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgU3ludGF4SW50ZXJwcmV0ZXIucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiBjYWxsKHJlc291cmNlcywgZWxlbWVudCwgaW5mbywgZXhpc3RpbmdJbnN0cnVjdGlvbikge1xuICAgIHZhciBpbnN0cnVjdGlvbiA9IGV4aXN0aW5nSW5zdHJ1Y3Rpb24gfHwgX2F1cmVsaWFUZW1wbGF0aW5nLkJlaGF2aW9ySW5zdHJ1Y3Rpb24uYXR0cmlidXRlKGluZm8uYXR0ck5hbWUpO1xuXG4gICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlc1tpbmZvLmF0dHJOYW1lXSA9IG5ldyBfYXVyZWxpYUJpbmRpbmcuQ2FsbEV4cHJlc3Npb24odGhpcy5vYnNlcnZlckxvY2F0b3IsIGluZm8uYXR0ck5hbWUsIHRoaXMucGFyc2VyLnBhcnNlKGluZm8uYXR0clZhbHVlKSwgcmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucyk7XG5cbiAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XG4gIH07XG5cbiAgU3ludGF4SW50ZXJwcmV0ZXIucHJvdG90eXBlLm9wdGlvbnMgPSBmdW5jdGlvbiBvcHRpb25zKHJlc291cmNlcywgZWxlbWVudCwgaW5mbywgZXhpc3RpbmdJbnN0cnVjdGlvbiwgY29udGV4dCkge1xuICAgIHZhciBpbnN0cnVjdGlvbiA9IGV4aXN0aW5nSW5zdHJ1Y3Rpb24gfHwgX2F1cmVsaWFUZW1wbGF0aW5nLkJlaGF2aW9ySW5zdHJ1Y3Rpb24uYXR0cmlidXRlKGluZm8uYXR0ck5hbWUpO1xuICAgIHZhciBhdHRyVmFsdWUgPSBpbmZvLmF0dHJWYWx1ZTtcbiAgICB2YXIgbGFuZ3VhZ2UgPSB0aGlzLmxhbmd1YWdlO1xuICAgIHZhciBuYW1lID0gbnVsbDtcbiAgICB2YXIgdGFyZ2V0ID0gJyc7XG4gICAgdmFyIGN1cnJlbnQgPSB2b2lkIDA7XG4gICAgdmFyIGkgPSB2b2lkIDA7XG4gICAgdmFyIGlpID0gdm9pZCAwO1xuICAgIHZhciBpblN0cmluZyA9IGZhbHNlO1xuICAgIHZhciBpbkVzY2FwZSA9IGZhbHNlO1xuXG4gICAgZm9yIChpID0gMCwgaWkgPSBhdHRyVmFsdWUubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgY3VycmVudCA9IGF0dHJWYWx1ZVtpXTtcblxuICAgICAgaWYgKGN1cnJlbnQgPT09ICc7JyAmJiAhaW5TdHJpbmcpIHtcbiAgICAgICAgaW5mbyA9IGxhbmd1YWdlLmluc3BlY3RBdHRyaWJ1dGUocmVzb3VyY2VzLCAnPycsIG5hbWUsIHRhcmdldC50cmltKCkpO1xuICAgICAgICBsYW5ndWFnZS5jcmVhdGVBdHRyaWJ1dGVJbnN0cnVjdGlvbihyZXNvdXJjZXMsIGVsZW1lbnQsIGluZm8sIGluc3RydWN0aW9uLCBjb250ZXh0KTtcblxuICAgICAgICBpZiAoIWluc3RydWN0aW9uLmF0dHJpYnV0ZXNbaW5mby5hdHRyTmFtZV0pIHtcbiAgICAgICAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW2luZm8uYXR0ck5hbWVdID0gaW5mby5hdHRyVmFsdWU7XG4gICAgICAgIH1cblxuICAgICAgICB0YXJnZXQgPSAnJztcbiAgICAgICAgbmFtZSA9IG51bGw7XG4gICAgICB9IGVsc2UgaWYgKGN1cnJlbnQgPT09ICc6JyAmJiBuYW1lID09PSBudWxsKSB7XG4gICAgICAgIG5hbWUgPSB0YXJnZXQudHJpbSgpO1xuICAgICAgICB0YXJnZXQgPSAnJztcbiAgICAgIH0gZWxzZSBpZiAoY3VycmVudCA9PT0gJ1xcXFwnKSB7XG4gICAgICAgIHRhcmdldCArPSBjdXJyZW50O1xuICAgICAgICBpbkVzY2FwZSA9IHRydWU7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGFyZ2V0ICs9IGN1cnJlbnQ7XG5cbiAgICAgICAgaWYgKG5hbWUgIT09IG51bGwgJiYgaW5Fc2NhcGUgPT09IGZhbHNlICYmIGN1cnJlbnQgPT09ICdcXCcnKSB7XG4gICAgICAgICAgaW5TdHJpbmcgPSAhaW5TdHJpbmc7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaW5Fc2NhcGUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAobmFtZSAhPT0gbnVsbCkge1xuICAgICAgaW5mbyA9IGxhbmd1YWdlLmluc3BlY3RBdHRyaWJ1dGUocmVzb3VyY2VzLCAnPycsIG5hbWUsIHRhcmdldC50cmltKCkpO1xuICAgICAgbGFuZ3VhZ2UuY3JlYXRlQXR0cmlidXRlSW5zdHJ1Y3Rpb24ocmVzb3VyY2VzLCBlbGVtZW50LCBpbmZvLCBpbnN0cnVjdGlvbiwgY29udGV4dCk7XG5cbiAgICAgIGlmICghaW5zdHJ1Y3Rpb24uYXR0cmlidXRlc1tpbmZvLmF0dHJOYW1lXSkge1xuICAgICAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW2luZm8uYXR0ck5hbWVdID0gaW5mby5hdHRyVmFsdWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGluc3RydWN0aW9uO1xuICB9O1xuXG4gIFN5bnRheEludGVycHJldGVyLnByb3RvdHlwZVsnZm9yJ10gPSBmdW5jdGlvbiBfZm9yKHJlc291cmNlcywgZWxlbWVudCwgaW5mbywgZXhpc3RpbmdJbnN0cnVjdGlvbikge1xuICAgIHZhciBwYXJ0cyA9IHZvaWQgMDtcbiAgICB2YXIga2V5VmFsdWUgPSB2b2lkIDA7XG4gICAgdmFyIGluc3RydWN0aW9uID0gdm9pZCAwO1xuICAgIHZhciBhdHRyVmFsdWUgPSB2b2lkIDA7XG4gICAgdmFyIGlzRGVzdHJ1Y3R1cmluZyA9IHZvaWQgMDtcblxuICAgIGF0dHJWYWx1ZSA9IGluZm8uYXR0clZhbHVlO1xuICAgIGlzRGVzdHJ1Y3R1cmluZyA9IGF0dHJWYWx1ZS5tYXRjaCgvXiAqW1tdLitbXFxdXS8pO1xuICAgIHBhcnRzID0gaXNEZXN0cnVjdHVyaW5nID8gYXR0clZhbHVlLnNwbGl0KCdvZiAnKSA6IGF0dHJWYWx1ZS5zcGxpdCgnIG9mICcpO1xuXG4gICAgaWYgKHBhcnRzLmxlbmd0aCAhPT0gMikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbmNvcnJlY3Qgc3ludGF4IGZvciBcImZvclwiLiBUaGUgZm9ybSBpczogXCIkbG9jYWwgb2YgJGl0ZW1zXCIgb3IgXCJbJGtleSwgJHZhbHVlXSBvZiAkaXRlbXNcIi4nKTtcbiAgICB9XG5cbiAgICBpbnN0cnVjdGlvbiA9IGV4aXN0aW5nSW5zdHJ1Y3Rpb24gfHwgX2F1cmVsaWFUZW1wbGF0aW5nLkJlaGF2aW9ySW5zdHJ1Y3Rpb24uYXR0cmlidXRlKGluZm8uYXR0ck5hbWUpO1xuXG4gICAgaWYgKGlzRGVzdHJ1Y3R1cmluZykge1xuICAgICAga2V5VmFsdWUgPSBwYXJ0c1swXS5yZXBsYWNlKC9bW1xcXV0vZywgJycpLnJlcGxhY2UoLywvZywgJyAnKS5yZXBsYWNlKC9cXHMrL2csICcgJykudHJpbSgpLnNwbGl0KCcgJyk7XG4gICAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzLmtleSA9IGtleVZhbHVlWzBdO1xuICAgICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlcy52YWx1ZSA9IGtleVZhbHVlWzFdO1xuICAgIH0gZWxzZSB7XG4gICAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzLmxvY2FsID0gcGFydHNbMF07XG4gICAgfVxuXG4gICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlcy5pdGVtcyA9IG5ldyBfYXVyZWxpYUJpbmRpbmcuQmluZGluZ0V4cHJlc3Npb24odGhpcy5vYnNlcnZlckxvY2F0b3IsICdpdGVtcycsIHRoaXMucGFyc2VyLnBhcnNlKHBhcnRzWzFdKSwgX2F1cmVsaWFCaW5kaW5nLmJpbmRpbmdNb2RlLm9uZVdheSwgcmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucyk7XG5cbiAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XG4gIH07XG5cbiAgU3ludGF4SW50ZXJwcmV0ZXIucHJvdG90eXBlWyd0d28td2F5J10gPSBmdW5jdGlvbiB0d29XYXkocmVzb3VyY2VzLCBlbGVtZW50LCBpbmZvLCBleGlzdGluZ0luc3RydWN0aW9uKSB7XG4gICAgdmFyIGluc3RydWN0aW9uID0gZXhpc3RpbmdJbnN0cnVjdGlvbiB8fCBfYXVyZWxpYVRlbXBsYXRpbmcuQmVoYXZpb3JJbnN0cnVjdGlvbi5hdHRyaWJ1dGUoaW5mby5hdHRyTmFtZSk7XG5cbiAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW2luZm8uYXR0ck5hbWVdID0gbmV3IF9hdXJlbGlhQmluZGluZy5CaW5kaW5nRXhwcmVzc2lvbih0aGlzLm9ic2VydmVyTG9jYXRvciwgdGhpcy5hdHRyaWJ1dGVNYXAubWFwKGVsZW1lbnQudGFnTmFtZSwgaW5mby5hdHRyTmFtZSksIHRoaXMucGFyc2VyLnBhcnNlKGluZm8uYXR0clZhbHVlKSwgX2F1cmVsaWFCaW5kaW5nLmJpbmRpbmdNb2RlLnR3b1dheSwgcmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucyk7XG5cbiAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XG4gIH07XG5cbiAgU3ludGF4SW50ZXJwcmV0ZXIucHJvdG90eXBlWydvbmUtd2F5J10gPSBmdW5jdGlvbiBvbmVXYXkocmVzb3VyY2VzLCBlbGVtZW50LCBpbmZvLCBleGlzdGluZ0luc3RydWN0aW9uKSB7XG4gICAgdmFyIGluc3RydWN0aW9uID0gZXhpc3RpbmdJbnN0cnVjdGlvbiB8fCBfYXVyZWxpYVRlbXBsYXRpbmcuQmVoYXZpb3JJbnN0cnVjdGlvbi5hdHRyaWJ1dGUoaW5mby5hdHRyTmFtZSk7XG5cbiAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW2luZm8uYXR0ck5hbWVdID0gbmV3IF9hdXJlbGlhQmluZGluZy5CaW5kaW5nRXhwcmVzc2lvbih0aGlzLm9ic2VydmVyTG9jYXRvciwgdGhpcy5hdHRyaWJ1dGVNYXAubWFwKGVsZW1lbnQudGFnTmFtZSwgaW5mby5hdHRyTmFtZSksIHRoaXMucGFyc2VyLnBhcnNlKGluZm8uYXR0clZhbHVlKSwgX2F1cmVsaWFCaW5kaW5nLmJpbmRpbmdNb2RlLm9uZVdheSwgcmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucyk7XG5cbiAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XG4gIH07XG5cbiAgU3ludGF4SW50ZXJwcmV0ZXIucHJvdG90eXBlWydvbmUtdGltZSddID0gZnVuY3Rpb24gb25lVGltZShyZXNvdXJjZXMsIGVsZW1lbnQsIGluZm8sIGV4aXN0aW5nSW5zdHJ1Y3Rpb24pIHtcbiAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBleGlzdGluZ0luc3RydWN0aW9uIHx8IF9hdXJlbGlhVGVtcGxhdGluZy5CZWhhdmlvckluc3RydWN0aW9uLmF0dHJpYnV0ZShpbmZvLmF0dHJOYW1lKTtcblxuICAgIGluc3RydWN0aW9uLmF0dHJpYnV0ZXNbaW5mby5hdHRyTmFtZV0gPSBuZXcgX2F1cmVsaWFCaW5kaW5nLkJpbmRpbmdFeHByZXNzaW9uKHRoaXMub2JzZXJ2ZXJMb2NhdG9yLCB0aGlzLmF0dHJpYnV0ZU1hcC5tYXAoZWxlbWVudC50YWdOYW1lLCBpbmZvLmF0dHJOYW1lKSwgdGhpcy5wYXJzZXIucGFyc2UoaW5mby5hdHRyVmFsdWUpLCBfYXVyZWxpYUJpbmRpbmcuYmluZGluZ01vZGUub25lVGltZSwgcmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucyk7XG5cbiAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XG4gIH07XG5cbiAgcmV0dXJuIFN5bnRheEludGVycHJldGVyO1xufSgpLCBfY2xhc3MzLmluamVjdCA9IFtfYXVyZWxpYUJpbmRpbmcuUGFyc2VyLCBfYXVyZWxpYUJpbmRpbmcuT2JzZXJ2ZXJMb2NhdG9yLCBfYXVyZWxpYUJpbmRpbmcuRXZlbnRNYW5hZ2VyLCBBdHRyaWJ1dGVNYXBdLCBfdGVtcDIpO1xuXG52YXIgaW5mbyA9IHt9O1xuXG52YXIgVGVtcGxhdGluZ0JpbmRpbmdMYW5ndWFnZSA9IGV4cG9ydHMuVGVtcGxhdGluZ0JpbmRpbmdMYW5ndWFnZSA9IChfdGVtcDMgPSBfY2xhc3M0ID0gZnVuY3Rpb24gKF9CaW5kaW5nTGFuZ3VhZ2UpIHtcbiAgX2luaGVyaXRzKFRlbXBsYXRpbmdCaW5kaW5nTGFuZ3VhZ2UsIF9CaW5kaW5nTGFuZ3VhZ2UpO1xuXG4gIGZ1bmN0aW9uIFRlbXBsYXRpbmdCaW5kaW5nTGFuZ3VhZ2UocGFyc2VyLCBvYnNlcnZlckxvY2F0b3IsIHN5bnRheEludGVycHJldGVyLCBhdHRyaWJ1dGVNYXApIHtcbiAgICBcblxuICAgIHZhciBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9CaW5kaW5nTGFuZ3VhZ2UuY2FsbCh0aGlzKSk7XG5cbiAgICBfdGhpcy5wYXJzZXIgPSBwYXJzZXI7XG4gICAgX3RoaXMub2JzZXJ2ZXJMb2NhdG9yID0gb2JzZXJ2ZXJMb2NhdG9yO1xuICAgIF90aGlzLnN5bnRheEludGVycHJldGVyID0gc3ludGF4SW50ZXJwcmV0ZXI7XG4gICAgX3RoaXMuZW1wdHlTdHJpbmdFeHByZXNzaW9uID0gX3RoaXMucGFyc2VyLnBhcnNlKCdcXCdcXCcnKTtcbiAgICBzeW50YXhJbnRlcnByZXRlci5sYW5ndWFnZSA9IF90aGlzO1xuICAgIF90aGlzLmF0dHJpYnV0ZU1hcCA9IGF0dHJpYnV0ZU1hcDtcbiAgICByZXR1cm4gX3RoaXM7XG4gIH1cblxuICBUZW1wbGF0aW5nQmluZGluZ0xhbmd1YWdlLnByb3RvdHlwZS5pbnNwZWN0QXR0cmlidXRlID0gZnVuY3Rpb24gaW5zcGVjdEF0dHJpYnV0ZShyZXNvdXJjZXMsIGVsZW1lbnROYW1lLCBhdHRyTmFtZSwgYXR0clZhbHVlKSB7XG4gICAgdmFyIHBhcnRzID0gYXR0ck5hbWUuc3BsaXQoJy4nKTtcblxuICAgIGluZm8uZGVmYXVsdEJpbmRpbmdNb2RlID0gbnVsbDtcblxuICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHtcbiAgICAgIGluZm8uYXR0ck5hbWUgPSBwYXJ0c1swXS50cmltKCk7XG4gICAgICBpbmZvLmF0dHJWYWx1ZSA9IGF0dHJWYWx1ZTtcbiAgICAgIGluZm8uY29tbWFuZCA9IHBhcnRzWzFdLnRyaW0oKTtcblxuICAgICAgaWYgKGluZm8uY29tbWFuZCA9PT0gJ3JlZicpIHtcbiAgICAgICAgaW5mby5leHByZXNzaW9uID0gbmV3IF9hdXJlbGlhQmluZGluZy5OYW1lRXhwcmVzc2lvbih0aGlzLnBhcnNlci5wYXJzZShhdHRyVmFsdWUpLCBpbmZvLmF0dHJOYW1lLCByZXNvdXJjZXMubG9va3VwRnVuY3Rpb25zKTtcbiAgICAgICAgaW5mby5jb21tYW5kID0gbnVsbDtcbiAgICAgICAgaW5mby5hdHRyTmFtZSA9ICdyZWYnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaW5mby5leHByZXNzaW9uID0gbnVsbDtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGF0dHJOYW1lID09PSAncmVmJykge1xuICAgICAgaW5mby5hdHRyTmFtZSA9IGF0dHJOYW1lO1xuICAgICAgaW5mby5hdHRyVmFsdWUgPSBhdHRyVmFsdWU7XG4gICAgICBpbmZvLmNvbW1hbmQgPSBudWxsO1xuICAgICAgaW5mby5leHByZXNzaW9uID0gbmV3IF9hdXJlbGlhQmluZGluZy5OYW1lRXhwcmVzc2lvbih0aGlzLnBhcnNlci5wYXJzZShhdHRyVmFsdWUpLCAnZWxlbWVudCcsIHJlc291cmNlcy5sb29rdXBGdW5jdGlvbnMpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpbmZvLmF0dHJOYW1lID0gYXR0ck5hbWU7XG4gICAgICBpbmZvLmF0dHJWYWx1ZSA9IGF0dHJWYWx1ZTtcbiAgICAgIGluZm8uY29tbWFuZCA9IG51bGw7XG4gICAgICB2YXIgaW50ZXJwb2xhdGlvblBhcnRzID0gdGhpcy5wYXJzZUludGVycG9sYXRpb24ocmVzb3VyY2VzLCBhdHRyVmFsdWUpO1xuICAgICAgaWYgKGludGVycG9sYXRpb25QYXJ0cyA9PT0gbnVsbCkge1xuICAgICAgICBpbmZvLmV4cHJlc3Npb24gPSBudWxsO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaW5mby5leHByZXNzaW9uID0gbmV3IEludGVycG9sYXRpb25CaW5kaW5nRXhwcmVzc2lvbih0aGlzLm9ic2VydmVyTG9jYXRvciwgdGhpcy5hdHRyaWJ1dGVNYXAubWFwKGVsZW1lbnROYW1lLCBhdHRyTmFtZSksIGludGVycG9sYXRpb25QYXJ0cywgX2F1cmVsaWFCaW5kaW5nLmJpbmRpbmdNb2RlLm9uZVdheSwgcmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucywgYXR0ck5hbWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBpbmZvO1xuICB9O1xuXG4gIFRlbXBsYXRpbmdCaW5kaW5nTGFuZ3VhZ2UucHJvdG90eXBlLmNyZWF0ZUF0dHJpYnV0ZUluc3RydWN0aW9uID0gZnVuY3Rpb24gY3JlYXRlQXR0cmlidXRlSW5zdHJ1Y3Rpb24ocmVzb3VyY2VzLCBlbGVtZW50LCB0aGVJbmZvLCBleGlzdGluZ0luc3RydWN0aW9uLCBjb250ZXh0KSB7XG4gICAgdmFyIGluc3RydWN0aW9uID0gdm9pZCAwO1xuXG4gICAgaWYgKHRoZUluZm8uZXhwcmVzc2lvbikge1xuICAgICAgaWYgKHRoZUluZm8uYXR0ck5hbWUgPT09ICdyZWYnKSB7XG4gICAgICAgIHJldHVybiB0aGVJbmZvLmV4cHJlc3Npb247XG4gICAgICB9XG5cbiAgICAgIGluc3RydWN0aW9uID0gZXhpc3RpbmdJbnN0cnVjdGlvbiB8fCBfYXVyZWxpYVRlbXBsYXRpbmcuQmVoYXZpb3JJbnN0cnVjdGlvbi5hdHRyaWJ1dGUodGhlSW5mby5hdHRyTmFtZSk7XG4gICAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW3RoZUluZm8uYXR0ck5hbWVdID0gdGhlSW5mby5leHByZXNzaW9uO1xuICAgIH0gZWxzZSBpZiAodGhlSW5mby5jb21tYW5kKSB7XG4gICAgICBpbnN0cnVjdGlvbiA9IHRoaXMuc3ludGF4SW50ZXJwcmV0ZXIuaW50ZXJwcmV0KHJlc291cmNlcywgZWxlbWVudCwgdGhlSW5mbywgZXhpc3RpbmdJbnN0cnVjdGlvbiwgY29udGV4dCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGluc3RydWN0aW9uO1xuICB9O1xuXG4gIFRlbXBsYXRpbmdCaW5kaW5nTGFuZ3VhZ2UucHJvdG90eXBlLmluc3BlY3RUZXh0Q29udGVudCA9IGZ1bmN0aW9uIGluc3BlY3RUZXh0Q29udGVudChyZXNvdXJjZXMsIHZhbHVlKSB7XG4gICAgdmFyIHBhcnRzID0gdGhpcy5wYXJzZUludGVycG9sYXRpb24ocmVzb3VyY2VzLCB2YWx1ZSk7XG4gICAgaWYgKHBhcnRzID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBJbnRlcnBvbGF0aW9uQmluZGluZ0V4cHJlc3Npb24odGhpcy5vYnNlcnZlckxvY2F0b3IsICd0ZXh0Q29udGVudCcsIHBhcnRzLCBfYXVyZWxpYUJpbmRpbmcuYmluZGluZ01vZGUub25lV2F5LCByZXNvdXJjZXMubG9va3VwRnVuY3Rpb25zLCAndGV4dENvbnRlbnQnKTtcbiAgfTtcblxuICBUZW1wbGF0aW5nQmluZGluZ0xhbmd1YWdlLnByb3RvdHlwZS5wYXJzZUludGVycG9sYXRpb24gPSBmdW5jdGlvbiBwYXJzZUludGVycG9sYXRpb24ocmVzb3VyY2VzLCB2YWx1ZSkge1xuICAgIHZhciBpID0gdmFsdWUuaW5kZXhPZignJHsnLCAwKTtcbiAgICB2YXIgaWkgPSB2YWx1ZS5sZW5ndGg7XG4gICAgdmFyIGNoYXIgPSB2b2lkIDA7XG4gICAgdmFyIHBvcyA9IDA7XG4gICAgdmFyIG9wZW4gPSAwO1xuICAgIHZhciBxdW90ZSA9IG51bGw7XG4gICAgdmFyIGludGVycG9sYXRpb25TdGFydCA9IHZvaWQgMDtcbiAgICB2YXIgcGFydHMgPSB2b2lkIDA7XG4gICAgdmFyIHBhcnRJbmRleCA9IDA7XG5cbiAgICB3aGlsZSAoaSA+PSAwICYmIGkgPCBpaSAtIDIpIHtcbiAgICAgIG9wZW4gPSAxO1xuICAgICAgaW50ZXJwb2xhdGlvblN0YXJ0ID0gaTtcbiAgICAgIGkgKz0gMjtcblxuICAgICAgZG8ge1xuICAgICAgICBjaGFyID0gdmFsdWVbaV07XG4gICAgICAgIGkrKztcblxuICAgICAgICBpZiAoY2hhciA9PT0gXCInXCIgfHwgY2hhciA9PT0gJ1wiJykge1xuICAgICAgICAgIGlmIChxdW90ZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgcXVvdGUgPSBjaGFyO1xuICAgICAgICAgIH0gZWxzZSBpZiAocXVvdGUgPT09IGNoYXIpIHtcbiAgICAgICAgICAgIHF1b3RlID0gbnVsbDtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY2hhciA9PT0gJ1xcXFwnKSB7XG4gICAgICAgICAgaSsrO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHF1b3RlICE9PSBudWxsKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY2hhciA9PT0gJ3snKSB7XG4gICAgICAgICAgb3BlbisrO1xuICAgICAgICB9IGVsc2UgaWYgKGNoYXIgPT09ICd9Jykge1xuICAgICAgICAgIG9wZW4tLTtcbiAgICAgICAgfVxuICAgICAgfSB3aGlsZSAob3BlbiA+IDAgJiYgaSA8IGlpKTtcblxuICAgICAgaWYgKG9wZW4gPT09IDApIHtcbiAgICAgICAgcGFydHMgPSBwYXJ0cyB8fCBbXTtcbiAgICAgICAgaWYgKHZhbHVlW2ludGVycG9sYXRpb25TdGFydCAtIDFdID09PSAnXFxcXCcgJiYgdmFsdWVbaW50ZXJwb2xhdGlvblN0YXJ0IC0gMl0gIT09ICdcXFxcJykge1xuICAgICAgICAgIHBhcnRzW3BhcnRJbmRleF0gPSB2YWx1ZS5zdWJzdHJpbmcocG9zLCBpbnRlcnBvbGF0aW9uU3RhcnQgLSAxKSArIHZhbHVlLnN1YnN0cmluZyhpbnRlcnBvbGF0aW9uU3RhcnQsIGkpO1xuICAgICAgICAgIHBhcnRJbmRleCsrO1xuICAgICAgICAgIHBhcnRzW3BhcnRJbmRleF0gPSB0aGlzLmVtcHR5U3RyaW5nRXhwcmVzc2lvbjtcbiAgICAgICAgICBwYXJ0SW5kZXgrKztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBwYXJ0c1twYXJ0SW5kZXhdID0gdmFsdWUuc3Vic3RyaW5nKHBvcywgaW50ZXJwb2xhdGlvblN0YXJ0KTtcbiAgICAgICAgICBwYXJ0SW5kZXgrKztcbiAgICAgICAgICBwYXJ0c1twYXJ0SW5kZXhdID0gdGhpcy5wYXJzZXIucGFyc2UodmFsdWUuc3Vic3RyaW5nKGludGVycG9sYXRpb25TdGFydCArIDIsIGkgLSAxKSk7XG4gICAgICAgICAgcGFydEluZGV4Kys7XG4gICAgICAgIH1cbiAgICAgICAgcG9zID0gaTtcbiAgICAgICAgaSA9IHZhbHVlLmluZGV4T2YoJyR7JywgaSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAocGFydEluZGV4ID09PSAwKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBwYXJ0c1twYXJ0SW5kZXhdID0gdmFsdWUuc3Vic3RyKHBvcyk7XG4gICAgcmV0dXJuIHBhcnRzO1xuICB9O1xuXG4gIHJldHVybiBUZW1wbGF0aW5nQmluZGluZ0xhbmd1YWdlO1xufShfYXVyZWxpYVRlbXBsYXRpbmcuQmluZGluZ0xhbmd1YWdlKSwgX2NsYXNzNC5pbmplY3QgPSBbX2F1cmVsaWFCaW5kaW5nLlBhcnNlciwgX2F1cmVsaWFCaW5kaW5nLk9ic2VydmVyTG9jYXRvciwgU3ludGF4SW50ZXJwcmV0ZXIsIEF0dHJpYnV0ZU1hcF0sIF90ZW1wMyk7XG5mdW5jdGlvbiBjb25maWd1cmUoY29uZmlnKSB7XG4gIGNvbmZpZy5jb250YWluZXIucmVnaXN0ZXJTaW5nbGV0b24oX2F1cmVsaWFUZW1wbGF0aW5nLkJpbmRpbmdMYW5ndWFnZSwgVGVtcGxhdGluZ0JpbmRpbmdMYW5ndWFnZSk7XG4gIGNvbmZpZy5jb250YWluZXIucmVnaXN0ZXJBbGlhcyhfYXVyZWxpYVRlbXBsYXRpbmcuQmluZGluZ0xhbmd1YWdlLCBUZW1wbGF0aW5nQmluZGluZ0xhbmd1YWdlKTtcbn1cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS10ZW1wbGF0aW5nLWJpbmRpbmcvZGlzdC9jb21tb25qcy9hdXJlbGlhLXRlbXBsYXRpbmctYmluZGluZy5qc1xuLy8gbW9kdWxlIGlkID0gNTBcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy52aWV3c1JlcXVpcmVMaWZlY3ljbGUgPSBleHBvcnRzLnVud3JhcEV4cHJlc3Npb24gPSBleHBvcnRzLnVwZGF0ZU9uZVRpbWVCaW5kaW5nID0gZXhwb3J0cy5pc09uZVRpbWUgPSBleHBvcnRzLmdldEl0ZW1zU291cmNlRXhwcmVzc2lvbiA9IGV4cG9ydHMudXBkYXRlT3ZlcnJpZGVDb250ZXh0ID0gZXhwb3J0cy5jcmVhdGVGdWxsT3ZlcnJpZGVDb250ZXh0ID0gZXhwb3J0cy5OdW1iZXJSZXBlYXRTdHJhdGVneSA9IGV4cG9ydHMuU2V0UmVwZWF0U3RyYXRlZ3kgPSBleHBvcnRzLk1hcFJlcGVhdFN0cmF0ZWd5ID0gZXhwb3J0cy5BcnJheVJlcGVhdFN0cmF0ZWd5ID0gZXhwb3J0cy5OdWxsUmVwZWF0U3RyYXRlZ3kgPSBleHBvcnRzLlJlcGVhdFN0cmF0ZWd5TG9jYXRvciA9IGV4cG9ydHMuQWJzdHJhY3RSZXBlYXRlciA9IGV4cG9ydHMuVXBkYXRlVHJpZ2dlckJpbmRpbmdCZWhhdmlvciA9IGV4cG9ydHMuQmluZGluZ1NpZ25hbGVyID0gZXhwb3J0cy5TaWduYWxCaW5kaW5nQmVoYXZpb3IgPSBleHBvcnRzLkRlYm91bmNlQmluZGluZ0JlaGF2aW9yID0gZXhwb3J0cy5UaHJvdHRsZUJpbmRpbmdCZWhhdmlvciA9IGV4cG9ydHMuVHdvV2F5QmluZGluZ0JlaGF2aW9yID0gZXhwb3J0cy5PbmVXYXlCaW5kaW5nQmVoYXZpb3IgPSBleHBvcnRzLk9uZVRpbWVCaW5kaW5nQmVoYXZpb3IgPSBleHBvcnRzLmNvbmZpZ3VyZSA9IGV4cG9ydHMuRm9jdXMgPSBleHBvcnRzLlJlcGxhY2VhYmxlID0gZXhwb3J0cy5TYW5pdGl6ZUhUTUxWYWx1ZUNvbnZlcnRlciA9IGV4cG9ydHMuSFRNTFNhbml0aXplciA9IGV4cG9ydHMuSGlkZSA9IGV4cG9ydHMuU2hvdyA9IGV4cG9ydHMuUmVwZWF0ID0gZXhwb3J0cy5XaXRoID0gZXhwb3J0cy5JZiA9IGV4cG9ydHMuQ29tcG9zZSA9IHVuZGVmaW5lZDtcblxudmFyIF9jb21wb3NlID0gcmVxdWlyZSgnLi9jb21wb3NlJyk7XG5cbnZhciBfaWYgPSByZXF1aXJlKCcuL2lmJyk7XG5cbnZhciBfd2l0aCA9IHJlcXVpcmUoJy4vd2l0aCcpO1xuXG52YXIgX3JlcGVhdCA9IHJlcXVpcmUoJy4vcmVwZWF0Jyk7XG5cbnZhciBfc2hvdyA9IHJlcXVpcmUoJy4vc2hvdycpO1xuXG52YXIgX2hpZGUgPSByZXF1aXJlKCcuL2hpZGUnKTtcblxudmFyIF9zYW5pdGl6ZUh0bWwgPSByZXF1aXJlKCcuL3Nhbml0aXplLWh0bWwnKTtcblxudmFyIF9yZXBsYWNlYWJsZSA9IHJlcXVpcmUoJy4vcmVwbGFjZWFibGUnKTtcblxudmFyIF9mb2N1cyA9IHJlcXVpcmUoJy4vZm9jdXMnKTtcblxudmFyIF9hdXJlbGlhVGVtcGxhdGluZyA9IHJlcXVpcmUoJ2F1cmVsaWEtdGVtcGxhdGluZycpO1xuXG52YXIgX2Nzc1Jlc291cmNlID0gcmVxdWlyZSgnLi9jc3MtcmVzb3VyY2UnKTtcblxudmFyIF9odG1sU2FuaXRpemVyID0gcmVxdWlyZSgnLi9odG1sLXNhbml0aXplcicpO1xuXG52YXIgX2JpbmRpbmdNb2RlQmVoYXZpb3JzID0gcmVxdWlyZSgnLi9iaW5kaW5nLW1vZGUtYmVoYXZpb3JzJyk7XG5cbnZhciBfdGhyb3R0bGVCaW5kaW5nQmVoYXZpb3IgPSByZXF1aXJlKCcuL3Rocm90dGxlLWJpbmRpbmctYmVoYXZpb3InKTtcblxudmFyIF9kZWJvdW5jZUJpbmRpbmdCZWhhdmlvciA9IHJlcXVpcmUoJy4vZGVib3VuY2UtYmluZGluZy1iZWhhdmlvcicpO1xuXG52YXIgX3NpZ25hbEJpbmRpbmdCZWhhdmlvciA9IHJlcXVpcmUoJy4vc2lnbmFsLWJpbmRpbmctYmVoYXZpb3InKTtcblxudmFyIF9iaW5kaW5nU2lnbmFsZXIgPSByZXF1aXJlKCcuL2JpbmRpbmctc2lnbmFsZXInKTtcblxudmFyIF91cGRhdGVUcmlnZ2VyQmluZGluZ0JlaGF2aW9yID0gcmVxdWlyZSgnLi91cGRhdGUtdHJpZ2dlci1iaW5kaW5nLWJlaGF2aW9yJyk7XG5cbnZhciBfYWJzdHJhY3RSZXBlYXRlciA9IHJlcXVpcmUoJy4vYWJzdHJhY3QtcmVwZWF0ZXInKTtcblxudmFyIF9yZXBlYXRTdHJhdGVneUxvY2F0b3IgPSByZXF1aXJlKCcuL3JlcGVhdC1zdHJhdGVneS1sb2NhdG9yJyk7XG5cbnZhciBfaHRtbFJlc291cmNlUGx1Z2luID0gcmVxdWlyZSgnLi9odG1sLXJlc291cmNlLXBsdWdpbicpO1xuXG52YXIgX251bGxSZXBlYXRTdHJhdGVneSA9IHJlcXVpcmUoJy4vbnVsbC1yZXBlYXQtc3RyYXRlZ3knKTtcblxudmFyIF9hcnJheVJlcGVhdFN0cmF0ZWd5ID0gcmVxdWlyZSgnLi9hcnJheS1yZXBlYXQtc3RyYXRlZ3knKTtcblxudmFyIF9tYXBSZXBlYXRTdHJhdGVneSA9IHJlcXVpcmUoJy4vbWFwLXJlcGVhdC1zdHJhdGVneScpO1xuXG52YXIgX3NldFJlcGVhdFN0cmF0ZWd5ID0gcmVxdWlyZSgnLi9zZXQtcmVwZWF0LXN0cmF0ZWd5Jyk7XG5cbnZhciBfbnVtYmVyUmVwZWF0U3RyYXRlZ3kgPSByZXF1aXJlKCcuL251bWJlci1yZXBlYXQtc3RyYXRlZ3knKTtcblxudmFyIF9yZXBlYXRVdGlsaXRpZXMgPSByZXF1aXJlKCcuL3JlcGVhdC11dGlsaXRpZXMnKTtcblxudmFyIF9hbmFseXplVmlld0ZhY3RvcnkgPSByZXF1aXJlKCcuL2FuYWx5emUtdmlldy1mYWN0b3J5Jyk7XG5cbnZhciBfYXVyZWxpYUhpZGVTdHlsZSA9IHJlcXVpcmUoJy4vYXVyZWxpYS1oaWRlLXN0eWxlJyk7XG5cbmZ1bmN0aW9uIGNvbmZpZ3VyZShjb25maWcpIHtcbiAgKDAsIF9hdXJlbGlhSGlkZVN0eWxlLmluamVjdEF1cmVsaWFIaWRlU3R5bGVBdEhlYWQpKCk7XG5cbiAgY29uZmlnLmdsb2JhbFJlc291cmNlcygnLi9jb21wb3NlJywgJy4vaWYnLCAnLi93aXRoJywgJy4vcmVwZWF0JywgJy4vc2hvdycsICcuL2hpZGUnLCAnLi9yZXBsYWNlYWJsZScsICcuL3Nhbml0aXplLWh0bWwnLCAnLi9mb2N1cycsICcuL2JpbmRpbmctbW9kZS1iZWhhdmlvcnMnLCAnLi90aHJvdHRsZS1iaW5kaW5nLWJlaGF2aW9yJywgJy4vZGVib3VuY2UtYmluZGluZy1iZWhhdmlvcicsICcuL3NpZ25hbC1iaW5kaW5nLWJlaGF2aW9yJywgJy4vdXBkYXRlLXRyaWdnZXItYmluZGluZy1iZWhhdmlvcicpO1xuXG4gICgwLCBfaHRtbFJlc291cmNlUGx1Z2luLmNvbmZpZ3VyZSkoY29uZmlnKTtcblxuICB2YXIgdmlld0VuZ2luZSA9IGNvbmZpZy5jb250YWluZXIuZ2V0KF9hdXJlbGlhVGVtcGxhdGluZy5WaWV3RW5naW5lKTtcbiAgdmlld0VuZ2luZS5hZGRSZXNvdXJjZVBsdWdpbignLmNzcycsIHtcbiAgICAnZmV0Y2gnOiBmdW5jdGlvbiBmZXRjaChhZGRyZXNzKSB7XG4gICAgICB2YXIgX3JlZjtcblxuICAgICAgcmV0dXJuIF9yZWYgPSB7fSwgX3JlZlthZGRyZXNzXSA9ICgwLCBfY3NzUmVzb3VyY2UuX2NyZWF0ZUNTU1Jlc291cmNlKShhZGRyZXNzKSwgX3JlZjtcbiAgICB9XG4gIH0pO1xufVxuXG5leHBvcnRzLkNvbXBvc2UgPSBfY29tcG9zZS5Db21wb3NlO1xuZXhwb3J0cy5JZiA9IF9pZi5JZjtcbmV4cG9ydHMuV2l0aCA9IF93aXRoLldpdGg7XG5leHBvcnRzLlJlcGVhdCA9IF9yZXBlYXQuUmVwZWF0O1xuZXhwb3J0cy5TaG93ID0gX3Nob3cuU2hvdztcbmV4cG9ydHMuSGlkZSA9IF9oaWRlLkhpZGU7XG5leHBvcnRzLkhUTUxTYW5pdGl6ZXIgPSBfaHRtbFNhbml0aXplci5IVE1MU2FuaXRpemVyO1xuZXhwb3J0cy5TYW5pdGl6ZUhUTUxWYWx1ZUNvbnZlcnRlciA9IF9zYW5pdGl6ZUh0bWwuU2FuaXRpemVIVE1MVmFsdWVDb252ZXJ0ZXI7XG5leHBvcnRzLlJlcGxhY2VhYmxlID0gX3JlcGxhY2VhYmxlLlJlcGxhY2VhYmxlO1xuZXhwb3J0cy5Gb2N1cyA9IF9mb2N1cy5Gb2N1cztcbmV4cG9ydHMuY29uZmlndXJlID0gY29uZmlndXJlO1xuZXhwb3J0cy5PbmVUaW1lQmluZGluZ0JlaGF2aW9yID0gX2JpbmRpbmdNb2RlQmVoYXZpb3JzLk9uZVRpbWVCaW5kaW5nQmVoYXZpb3I7XG5leHBvcnRzLk9uZVdheUJpbmRpbmdCZWhhdmlvciA9IF9iaW5kaW5nTW9kZUJlaGF2aW9ycy5PbmVXYXlCaW5kaW5nQmVoYXZpb3I7XG5leHBvcnRzLlR3b1dheUJpbmRpbmdCZWhhdmlvciA9IF9iaW5kaW5nTW9kZUJlaGF2aW9ycy5Ud29XYXlCaW5kaW5nQmVoYXZpb3I7XG5leHBvcnRzLlRocm90dGxlQmluZGluZ0JlaGF2aW9yID0gX3Rocm90dGxlQmluZGluZ0JlaGF2aW9yLlRocm90dGxlQmluZGluZ0JlaGF2aW9yO1xuZXhwb3J0cy5EZWJvdW5jZUJpbmRpbmdCZWhhdmlvciA9IF9kZWJvdW5jZUJpbmRpbmdCZWhhdmlvci5EZWJvdW5jZUJpbmRpbmdCZWhhdmlvcjtcbmV4cG9ydHMuU2lnbmFsQmluZGluZ0JlaGF2aW9yID0gX3NpZ25hbEJpbmRpbmdCZWhhdmlvci5TaWduYWxCaW5kaW5nQmVoYXZpb3I7XG5leHBvcnRzLkJpbmRpbmdTaWduYWxlciA9IF9iaW5kaW5nU2lnbmFsZXIuQmluZGluZ1NpZ25hbGVyO1xuZXhwb3J0cy5VcGRhdGVUcmlnZ2VyQmluZGluZ0JlaGF2aW9yID0gX3VwZGF0ZVRyaWdnZXJCaW5kaW5nQmVoYXZpb3IuVXBkYXRlVHJpZ2dlckJpbmRpbmdCZWhhdmlvcjtcbmV4cG9ydHMuQWJzdHJhY3RSZXBlYXRlciA9IF9hYnN0cmFjdFJlcGVhdGVyLkFic3RyYWN0UmVwZWF0ZXI7XG5leHBvcnRzLlJlcGVhdFN0cmF0ZWd5TG9jYXRvciA9IF9yZXBlYXRTdHJhdGVneUxvY2F0b3IuUmVwZWF0U3RyYXRlZ3lMb2NhdG9yO1xuZXhwb3J0cy5OdWxsUmVwZWF0U3RyYXRlZ3kgPSBfbnVsbFJlcGVhdFN0cmF0ZWd5Lk51bGxSZXBlYXRTdHJhdGVneTtcbmV4cG9ydHMuQXJyYXlSZXBlYXRTdHJhdGVneSA9IF9hcnJheVJlcGVhdFN0cmF0ZWd5LkFycmF5UmVwZWF0U3RyYXRlZ3k7XG5leHBvcnRzLk1hcFJlcGVhdFN0cmF0ZWd5ID0gX21hcFJlcGVhdFN0cmF0ZWd5Lk1hcFJlcGVhdFN0cmF0ZWd5O1xuZXhwb3J0cy5TZXRSZXBlYXRTdHJhdGVneSA9IF9zZXRSZXBlYXRTdHJhdGVneS5TZXRSZXBlYXRTdHJhdGVneTtcbmV4cG9ydHMuTnVtYmVyUmVwZWF0U3RyYXRlZ3kgPSBfbnVtYmVyUmVwZWF0U3RyYXRlZ3kuTnVtYmVyUmVwZWF0U3RyYXRlZ3k7XG5leHBvcnRzLmNyZWF0ZUZ1bGxPdmVycmlkZUNvbnRleHQgPSBfcmVwZWF0VXRpbGl0aWVzLmNyZWF0ZUZ1bGxPdmVycmlkZUNvbnRleHQ7XG5leHBvcnRzLnVwZGF0ZU92ZXJyaWRlQ29udGV4dCA9IF9yZXBlYXRVdGlsaXRpZXMudXBkYXRlT3ZlcnJpZGVDb250ZXh0O1xuZXhwb3J0cy5nZXRJdGVtc1NvdXJjZUV4cHJlc3Npb24gPSBfcmVwZWF0VXRpbGl0aWVzLmdldEl0ZW1zU291cmNlRXhwcmVzc2lvbjtcbmV4cG9ydHMuaXNPbmVUaW1lID0gX3JlcGVhdFV0aWxpdGllcy5pc09uZVRpbWU7XG5leHBvcnRzLnVwZGF0ZU9uZVRpbWVCaW5kaW5nID0gX3JlcGVhdFV0aWxpdGllcy51cGRhdGVPbmVUaW1lQmluZGluZztcbmV4cG9ydHMudW53cmFwRXhwcmVzc2lvbiA9IF9yZXBlYXRVdGlsaXRpZXMudW53cmFwRXhwcmVzc2lvbjtcbmV4cG9ydHMudmlld3NSZXF1aXJlTGlmZWN5Y2xlID0gX2FuYWx5emVWaWV3RmFjdG9yeS52aWV3c1JlcXVpcmVMaWZlY3ljbGU7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9hdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzLmpzXG4vLyBtb2R1bGUgaWQgPSA1MVxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLmNvbmZpZ3VyZSA9IGV4cG9ydHMuUm91dGVIcmVmID0gZXhwb3J0cy5Sb3V0ZXJWaWV3ID0gZXhwb3J0cy5UZW1wbGF0aW5nUm91dGVMb2FkZXIgPSB1bmRlZmluZWQ7XG5cbnZhciBfYXVyZWxpYVJvdXRlciA9IHJlcXVpcmUoJ2F1cmVsaWEtcm91dGVyJyk7XG5cbnZhciBfcm91dGVMb2FkZXIgPSByZXF1aXJlKCcuL3JvdXRlLWxvYWRlcicpO1xuXG52YXIgX3JvdXRlclZpZXcgPSByZXF1aXJlKCcuL3JvdXRlci12aWV3Jyk7XG5cbnZhciBfcm91dGVIcmVmID0gcmVxdWlyZSgnLi9yb3V0ZS1ocmVmJyk7XG5cbmZ1bmN0aW9uIGNvbmZpZ3VyZShjb25maWcpIHtcbiAgY29uZmlnLnNpbmdsZXRvbihfYXVyZWxpYVJvdXRlci5Sb3V0ZUxvYWRlciwgX3JvdXRlTG9hZGVyLlRlbXBsYXRpbmdSb3V0ZUxvYWRlcikuc2luZ2xldG9uKF9hdXJlbGlhUm91dGVyLlJvdXRlciwgX2F1cmVsaWFSb3V0ZXIuQXBwUm91dGVyKS5nbG9iYWxSZXNvdXJjZXMoJy4vcm91dGVyLXZpZXcnLCAnLi9yb3V0ZS1ocmVmJyk7XG5cbiAgY29uZmlnLmNvbnRhaW5lci5yZWdpc3RlckFsaWFzKF9hdXJlbGlhUm91dGVyLlJvdXRlciwgX2F1cmVsaWFSb3V0ZXIuQXBwUm91dGVyKTtcbn1cblxuZXhwb3J0cy5UZW1wbGF0aW5nUm91dGVMb2FkZXIgPSBfcm91dGVMb2FkZXIuVGVtcGxhdGluZ1JvdXRlTG9hZGVyO1xuZXhwb3J0cy5Sb3V0ZXJWaWV3ID0gX3JvdXRlclZpZXcuUm91dGVyVmlldztcbmV4cG9ydHMuUm91dGVIcmVmID0gX3JvdXRlSHJlZi5Sb3V0ZUhyZWY7XG5leHBvcnRzLmNvbmZpZ3VyZSA9IGNvbmZpZ3VyZTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJvdXRlci9kaXN0L2NvbW1vbmpzL2F1cmVsaWEtdGVtcGxhdGluZy1yb3V0ZXIuanNcbi8vIG1vZHVsZSBpZCA9IDUyXG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuUG9wdXAgPSB1bmRlZmluZWQ7XG5cbnZhciBfZGVjLCBfY2xhc3M7XG5cbnZhciBfYXV0aFV0aWxpdGllcyA9IHJlcXVpcmUoJy4vYXV0aC11dGlsaXRpZXMnKTtcblxudmFyIF9iYXNlQ29uZmlnID0gcmVxdWlyZSgnLi9iYXNlLWNvbmZpZycpO1xuXG52YXIgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uID0gcmVxdWlyZSgnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbicpO1xuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7IH0gfVxuXG52YXIgUG9wdXAgPSBleHBvcnRzLlBvcHVwID0gKF9kZWMgPSAoMCwgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uLmluamVjdCkoX2Jhc2VDb25maWcuQmFzZUNvbmZpZyksIF9kZWMoX2NsYXNzID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBQb3B1cChjb25maWcpIHtcbiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUG9wdXApO1xuXG4gICAgdGhpcy5jb25maWcgPSBjb25maWcuY3VycmVudDtcbiAgICB0aGlzLnBvcHVwV2luZG93ID0gbnVsbDtcbiAgICB0aGlzLnBvbGxpbmcgPSBudWxsO1xuICAgIHRoaXMudXJsID0gJyc7XG4gIH1cblxuICBQb3B1cC5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uIG9wZW4odXJsLCB3aW5kb3dOYW1lLCBvcHRpb25zLCByZWRpcmVjdFVyaSkge1xuICAgIHRoaXMudXJsID0gdXJsO1xuICAgIHZhciBvcHRpb25zU3RyaW5nID0gdGhpcy5zdHJpbmdpZnlPcHRpb25zKHRoaXMucHJlcGFyZU9wdGlvbnMob3B0aW9ucyB8fCB7fSkpO1xuICAgIHRoaXMucG9wdXBXaW5kb3cgPSB3aW5kb3cub3Blbih1cmwsIHdpbmRvd05hbWUsIG9wdGlvbnNTdHJpbmcpO1xuICAgIGlmICh0aGlzLnBvcHVwV2luZG93ICYmIHRoaXMucG9wdXBXaW5kb3cuZm9jdXMpIHtcbiAgICAgIHRoaXMucG9wdXBXaW5kb3cuZm9jdXMoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBQb3B1cC5wcm90b3R5cGUuZXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uIGV2ZW50TGlzdGVuZXIocmVkaXJlY3RVcmkpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIHByb21pc2UgPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICBzZWxmLnBvcHVwV2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRzdGFydCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBpZiAoZXZlbnQudXJsLmluZGV4T2YocmVkaXJlY3RVcmkpICE9PSAwKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHBhcnNlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICAgICAgcGFyc2VyLmhyZWYgPSBldmVudC51cmw7XG5cbiAgICAgICAgaWYgKHBhcnNlci5zZWFyY2ggfHwgcGFyc2VyLmhhc2gpIHtcbiAgICAgICAgICB2YXIgcXVlcnlQYXJhbXMgPSBwYXJzZXIuc2VhcmNoLnN1YnN0cmluZygxKS5yZXBsYWNlKC9cXC8kLywgJycpO1xuICAgICAgICAgIHZhciBoYXNoUGFyYW1zID0gcGFyc2VyLmhhc2guc3Vic3RyaW5nKDEpLnJlcGxhY2UoL1xcLyQvLCAnJyk7XG4gICAgICAgICAgdmFyIGhhc2ggPSAoMCwgX2F1dGhVdGlsaXRpZXMucGFyc2VRdWVyeVN0cmluZykoaGFzaFBhcmFtcyk7XG4gICAgICAgICAgdmFyIHFzID0gKDAsIF9hdXRoVXRpbGl0aWVzLnBhcnNlUXVlcnlTdHJpbmcpKHF1ZXJ5UGFyYW1zKTtcblxuICAgICAgICAgICgwLCBfYXV0aFV0aWxpdGllcy5leHRlbmQpKHFzLCBoYXNoKTtcblxuICAgICAgICAgIGlmIChxcy5lcnJvcikge1xuICAgICAgICAgICAgcmVqZWN0KHtcbiAgICAgICAgICAgICAgZXJyb3I6IHFzLmVycm9yXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzb2x2ZShxcyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgc2VsZi5wb3B1cFdpbmRvdy5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgcG9wdXBXaW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZXhpdCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVqZWN0KHtcbiAgICAgICAgICBkYXRhOiAnUHJvdmlkZXIgUG9wdXAgd2FzIGNsb3NlZCdcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgcG9wdXBXaW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZGVycm9yJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBkZWZlcnJlZC5yZWplY3Qoe1xuICAgICAgICAgIGRhdGE6ICdBdXRob3JpemF0aW9uIEZhaWxlZCdcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICByZXR1cm4gcHJvbWlzZTtcbiAgfTtcblxuICBQb3B1cC5wcm90b3R5cGUucG9sbFBvcHVwID0gZnVuY3Rpb24gcG9sbFBvcHVwKCkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIHByb21pc2UgPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICBfdGhpcy5wb2xsaW5nID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHZhciBkb2N1bWVudE9yaWdpbiA9IGRvY3VtZW50LmxvY2F0aW9uLmhvc3Q7XG4gICAgICAgICAgdmFyIHBvcHVwV2luZG93T3JpZ2luID0gc2VsZi5wb3B1cFdpbmRvdy5sb2NhdGlvbi5ob3N0O1xuXG4gICAgICAgICAgaWYgKHBvcHVwV2luZG93T3JpZ2luID09PSBkb2N1bWVudE9yaWdpbiAmJiAoc2VsZi5wb3B1cFdpbmRvdy5sb2NhdGlvbi5zZWFyY2ggfHwgc2VsZi5wb3B1cFdpbmRvdy5sb2NhdGlvbi5oYXNoKSkge1xuICAgICAgICAgICAgdmFyIHF1ZXJ5UGFyYW1zID0gc2VsZi5wb3B1cFdpbmRvdy5sb2NhdGlvbi5zZWFyY2guc3Vic3RyaW5nKDEpLnJlcGxhY2UoL1xcLyQvLCAnJyk7XG4gICAgICAgICAgICB2YXIgaGFzaFBhcmFtcyA9IHNlbGYucG9wdXBXaW5kb3cubG9jYXRpb24uaGFzaC5zdWJzdHJpbmcoMSkucmVwbGFjZSgvW1xcLyRdLywgJycpO1xuICAgICAgICAgICAgdmFyIGhhc2ggPSAoMCwgX2F1dGhVdGlsaXRpZXMucGFyc2VRdWVyeVN0cmluZykoaGFzaFBhcmFtcyk7XG4gICAgICAgICAgICB2YXIgcXMgPSAoMCwgX2F1dGhVdGlsaXRpZXMucGFyc2VRdWVyeVN0cmluZykocXVlcnlQYXJhbXMpO1xuXG4gICAgICAgICAgICAoMCwgX2F1dGhVdGlsaXRpZXMuZXh0ZW5kKShxcywgaGFzaCk7XG5cbiAgICAgICAgICAgIGlmIChxcy5lcnJvcikge1xuICAgICAgICAgICAgICByZWplY3Qoe1xuICAgICAgICAgICAgICAgIGVycm9yOiBxcy5lcnJvclxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJlc29sdmUocXMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzZWxmLnBvcHVwV2luZG93LmNsb3NlKCk7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKHNlbGYucG9sbGluZyk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge31cblxuICAgICAgICBpZiAoIXNlbGYucG9wdXBXaW5kb3cpIHtcbiAgICAgICAgICBjbGVhckludGVydmFsKHNlbGYucG9sbGluZyk7XG4gICAgICAgICAgcmVqZWN0KHtcbiAgICAgICAgICAgIGRhdGE6ICdQcm92aWRlciBQb3B1cCBCbG9ja2VkJ1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKHNlbGYucG9wdXBXaW5kb3cuY2xvc2VkKSB7XG4gICAgICAgICAgY2xlYXJJbnRlcnZhbChzZWxmLnBvbGxpbmcpO1xuICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICBkYXRhOiAnUHJvYmxlbSBwb2xsIHBvcHVwJ1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9LCAzNSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHByb21pc2U7XG4gIH07XG5cbiAgUG9wdXAucHJvdG90eXBlLnByZXBhcmVPcHRpb25zID0gZnVuY3Rpb24gcHJlcGFyZU9wdGlvbnMob3B0aW9ucykge1xuICAgIHZhciB3aWR0aCA9IG9wdGlvbnMud2lkdGggfHwgNTAwO1xuICAgIHZhciBoZWlnaHQgPSBvcHRpb25zLmhlaWdodCB8fCA1MDA7XG4gICAgcmV0dXJuICgwLCBfYXV0aFV0aWxpdGllcy5leHRlbmQpKHtcbiAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgbGVmdDogd2luZG93LnNjcmVlblggKyAod2luZG93Lm91dGVyV2lkdGggLSB3aWR0aCkgLyAyLFxuICAgICAgdG9wOiB3aW5kb3cuc2NyZWVuWSArICh3aW5kb3cub3V0ZXJIZWlnaHQgLSBoZWlnaHQpIC8gMi41XG4gICAgfSwgb3B0aW9ucyk7XG4gIH07XG5cbiAgUG9wdXAucHJvdG90eXBlLnN0cmluZ2lmeU9wdGlvbnMgPSBmdW5jdGlvbiBzdHJpbmdpZnlPcHRpb25zKG9wdGlvbnMpIHtcbiAgICB2YXIgcGFydHMgPSBbXTtcbiAgICAoMCwgX2F1dGhVdGlsaXRpZXMuZm9yRWFjaCkob3B0aW9ucywgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcbiAgICAgIHBhcnRzLnB1c2goa2V5ICsgJz0nICsgdmFsdWUpO1xuICAgIH0pO1xuICAgIHJldHVybiBwYXJ0cy5qb2luKCcsJyk7XG4gIH07XG5cbiAgcmV0dXJuIFBvcHVwO1xufSgpKSB8fCBfY2xhc3MpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLWF1dGgvZGlzdC9jb21tb25qcy9wb3B1cC5qc1xuLy8gbW9kdWxlIGlkID0gNTVcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuXG5cblxudmFyIEFic3RyYWN0UmVwZWF0ZXIgPSBleHBvcnRzLkFic3RyYWN0UmVwZWF0ZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEFic3RyYWN0UmVwZWF0ZXIob3B0aW9ucykge1xuICAgIFxuXG4gICAgT2JqZWN0LmFzc2lnbih0aGlzLCB7XG4gICAgICBsb2NhbDogJ2l0ZW1zJyxcbiAgICAgIHZpZXdzUmVxdWlyZUxpZmVjeWNsZTogdHJ1ZVxuICAgIH0sIG9wdGlvbnMpO1xuICB9XG5cbiAgQWJzdHJhY3RSZXBlYXRlci5wcm90b3R5cGUudmlld0NvdW50ID0gZnVuY3Rpb24gdmlld0NvdW50KCkge1xuICAgIHRocm93IG5ldyBFcnJvcignc3ViY2xhc3MgbXVzdCBpbXBsZW1lbnQgYHZpZXdDb3VudGAnKTtcbiAgfTtcblxuICBBYnN0cmFjdFJlcGVhdGVyLnByb3RvdHlwZS52aWV3cyA9IGZ1bmN0aW9uIHZpZXdzKCkge1xuICAgIHRocm93IG5ldyBFcnJvcignc3ViY2xhc3MgbXVzdCBpbXBsZW1lbnQgYHZpZXdzYCcpO1xuICB9O1xuXG4gIEFic3RyYWN0UmVwZWF0ZXIucHJvdG90eXBlLnZpZXcgPSBmdW5jdGlvbiB2aWV3KGluZGV4KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdzdWJjbGFzcyBtdXN0IGltcGxlbWVudCBgdmlld2AnKTtcbiAgfTtcblxuICBBYnN0cmFjdFJlcGVhdGVyLnByb3RvdHlwZS5tYXRjaGVyID0gZnVuY3Rpb24gbWF0Y2hlcigpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3N1YmNsYXNzIG11c3QgaW1wbGVtZW50IGBtYXRjaGVyYCcpO1xuICB9O1xuXG4gIEFic3RyYWN0UmVwZWF0ZXIucHJvdG90eXBlLmFkZFZpZXcgPSBmdW5jdGlvbiBhZGRWaWV3KGJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3N1YmNsYXNzIG11c3QgaW1wbGVtZW50IGBhZGRWaWV3YCcpO1xuICB9O1xuXG4gIEFic3RyYWN0UmVwZWF0ZXIucHJvdG90eXBlLmluc2VydFZpZXcgPSBmdW5jdGlvbiBpbnNlcnRWaWV3KGluZGV4LCBiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdzdWJjbGFzcyBtdXN0IGltcGxlbWVudCBgaW5zZXJ0Vmlld2AnKTtcbiAgfTtcblxuICBBYnN0cmFjdFJlcGVhdGVyLnByb3RvdHlwZS5tb3ZlVmlldyA9IGZ1bmN0aW9uIG1vdmVWaWV3KHNvdXJjZUluZGV4LCB0YXJnZXRJbmRleCkge1xuICAgIHRocm93IG5ldyBFcnJvcignc3ViY2xhc3MgbXVzdCBpbXBsZW1lbnQgYG1vdmVWaWV3YCcpO1xuICB9O1xuXG4gIEFic3RyYWN0UmVwZWF0ZXIucHJvdG90eXBlLnJlbW92ZUFsbFZpZXdzID0gZnVuY3Rpb24gcmVtb3ZlQWxsVmlld3MocmV0dXJuVG9DYWNoZSwgc2tpcEFuaW1hdGlvbikge1xuICAgIHRocm93IG5ldyBFcnJvcignc3ViY2xhc3MgbXVzdCBpbXBsZW1lbnQgYHJlbW92ZUFsbFZpZXdzYCcpO1xuICB9O1xuXG4gIEFic3RyYWN0UmVwZWF0ZXIucHJvdG90eXBlLnJlbW92ZVZpZXdzID0gZnVuY3Rpb24gcmVtb3ZlVmlld3Modmlld3NUb1JlbW92ZSwgcmV0dXJuVG9DYWNoZSwgc2tpcEFuaW1hdGlvbikge1xuICAgIHRocm93IG5ldyBFcnJvcignc3ViY2xhc3MgbXVzdCBpbXBsZW1lbnQgYHJlbW92ZVZpZXdgJyk7XG4gIH07XG5cbiAgQWJzdHJhY3RSZXBlYXRlci5wcm90b3R5cGUucmVtb3ZlVmlldyA9IGZ1bmN0aW9uIHJlbW92ZVZpZXcoaW5kZXgsIHJldHVyblRvQ2FjaGUsIHNraXBBbmltYXRpb24pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3N1YmNsYXNzIG11c3QgaW1wbGVtZW50IGByZW1vdmVWaWV3YCcpO1xuICB9O1xuXG4gIEFic3RyYWN0UmVwZWF0ZXIucHJvdG90eXBlLnVwZGF0ZUJpbmRpbmdzID0gZnVuY3Rpb24gdXBkYXRlQmluZGluZ3Modmlldykge1xuICAgIHRocm93IG5ldyBFcnJvcignc3ViY2xhc3MgbXVzdCBpbXBsZW1lbnQgYHVwZGF0ZUJpbmRpbmdzYCcpO1xuICB9O1xuXG4gIHJldHVybiBBYnN0cmFjdFJlcGVhdGVyO1xufSgpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzL2Rpc3QvY29tbW9uanMvYWJzdHJhY3QtcmVwZWF0ZXIuanNcbi8vIG1vZHVsZSBpZCA9IDU2XG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMudmlld3NSZXF1aXJlTGlmZWN5Y2xlID0gdmlld3NSZXF1aXJlTGlmZWN5Y2xlO1xudmFyIGxpZmVjeWNsZU9wdGlvbmFsQmVoYXZpb3JzID0gZXhwb3J0cy5saWZlY3ljbGVPcHRpb25hbEJlaGF2aW9ycyA9IFsnZm9jdXMnLCAnaWYnLCAncmVwZWF0JywgJ3Nob3cnLCAnd2l0aCddO1xuXG5mdW5jdGlvbiBiZWhhdmlvclJlcXVpcmVzTGlmZWN5Y2xlKGluc3RydWN0aW9uKSB7XG4gIHZhciB0ID0gaW5zdHJ1Y3Rpb24udHlwZTtcbiAgdmFyIG5hbWUgPSB0LmVsZW1lbnROYW1lICE9PSBudWxsID8gdC5lbGVtZW50TmFtZSA6IHQuYXR0cmlidXRlTmFtZTtcbiAgcmV0dXJuIGxpZmVjeWNsZU9wdGlvbmFsQmVoYXZpb3JzLmluZGV4T2YobmFtZSkgPT09IC0xICYmICh0LmhhbmRsZXNBdHRhY2hlZCB8fCB0LmhhbmRsZXNCaW5kIHx8IHQuaGFuZGxlc0NyZWF0ZWQgfHwgdC5oYW5kbGVzRGV0YWNoZWQgfHwgdC5oYW5kbGVzVW5iaW5kKSB8fCB0LnZpZXdGYWN0b3J5ICYmIHZpZXdzUmVxdWlyZUxpZmVjeWNsZSh0LnZpZXdGYWN0b3J5KSB8fCBpbnN0cnVjdGlvbi52aWV3RmFjdG9yeSAmJiB2aWV3c1JlcXVpcmVMaWZlY3ljbGUoaW5zdHJ1Y3Rpb24udmlld0ZhY3RvcnkpO1xufVxuXG5mdW5jdGlvbiB0YXJnZXRSZXF1aXJlc0xpZmVjeWNsZShpbnN0cnVjdGlvbikge1xuICB2YXIgYmVoYXZpb3JzID0gaW5zdHJ1Y3Rpb24uYmVoYXZpb3JJbnN0cnVjdGlvbnM7XG4gIGlmIChiZWhhdmlvcnMpIHtcbiAgICB2YXIgaSA9IGJlaGF2aW9ycy5sZW5ndGg7XG4gICAgd2hpbGUgKGktLSkge1xuICAgICAgaWYgKGJlaGF2aW9yUmVxdWlyZXNMaWZlY3ljbGUoYmVoYXZpb3JzW2ldKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gaW5zdHJ1Y3Rpb24udmlld0ZhY3RvcnkgJiYgdmlld3NSZXF1aXJlTGlmZWN5Y2xlKGluc3RydWN0aW9uLnZpZXdGYWN0b3J5KTtcbn1cblxuZnVuY3Rpb24gdmlld3NSZXF1aXJlTGlmZWN5Y2xlKHZpZXdGYWN0b3J5KSB7XG4gIGlmICgnX3ZpZXdzUmVxdWlyZUxpZmVjeWNsZScgaW4gdmlld0ZhY3RvcnkpIHtcbiAgICByZXR1cm4gdmlld0ZhY3RvcnkuX3ZpZXdzUmVxdWlyZUxpZmVjeWNsZTtcbiAgfVxuXG4gIHZpZXdGYWN0b3J5Ll92aWV3c1JlcXVpcmVMaWZlY3ljbGUgPSBmYWxzZTtcblxuICBpZiAodmlld0ZhY3Rvcnkudmlld0ZhY3RvcnkpIHtcbiAgICB2aWV3RmFjdG9yeS5fdmlld3NSZXF1aXJlTGlmZWN5Y2xlID0gdmlld3NSZXF1aXJlTGlmZWN5Y2xlKHZpZXdGYWN0b3J5LnZpZXdGYWN0b3J5KTtcbiAgICByZXR1cm4gdmlld0ZhY3RvcnkuX3ZpZXdzUmVxdWlyZUxpZmVjeWNsZTtcbiAgfVxuXG4gIGlmICh2aWV3RmFjdG9yeS50ZW1wbGF0ZS5xdWVyeVNlbGVjdG9yKCcuYXUtYW5pbWF0ZScpKSB7XG4gICAgdmlld0ZhY3RvcnkuX3ZpZXdzUmVxdWlyZUxpZmVjeWNsZSA9IHRydWU7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBmb3IgKHZhciBpZCBpbiB2aWV3RmFjdG9yeS5pbnN0cnVjdGlvbnMpIHtcbiAgICBpZiAodGFyZ2V0UmVxdWlyZXNMaWZlY3ljbGUodmlld0ZhY3RvcnkuaW5zdHJ1Y3Rpb25zW2lkXSkpIHtcbiAgICAgIHZpZXdGYWN0b3J5Ll92aWV3c1JlcXVpcmVMaWZlY3ljbGUgPSB0cnVlO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgdmlld0ZhY3RvcnkuX3ZpZXdzUmVxdWlyZUxpZmVjeWNsZSA9IGZhbHNlO1xuICByZXR1cm4gZmFsc2U7XG59XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9hbmFseXplLXZpZXctZmFjdG9yeS5qc1xuLy8gbW9kdWxlIGlkID0gNTdcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5BcnJheVJlcGVhdFN0cmF0ZWd5ID0gdW5kZWZpbmVkO1xuXG52YXIgX3JlcGVhdFV0aWxpdGllcyA9IHJlcXVpcmUoJy4vcmVwZWF0LXV0aWxpdGllcycpO1xuXG52YXIgX2F1cmVsaWFCaW5kaW5nID0gcmVxdWlyZSgnYXVyZWxpYS1iaW5kaW5nJyk7XG5cblxuXG52YXIgQXJyYXlSZXBlYXRTdHJhdGVneSA9IGV4cG9ydHMuQXJyYXlSZXBlYXRTdHJhdGVneSA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQXJyYXlSZXBlYXRTdHJhdGVneSgpIHtcbiAgICBcbiAgfVxuXG4gIEFycmF5UmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLmdldENvbGxlY3Rpb25PYnNlcnZlciA9IGZ1bmN0aW9uIGdldENvbGxlY3Rpb25PYnNlcnZlcihvYnNlcnZlckxvY2F0b3IsIGl0ZW1zKSB7XG4gICAgcmV0dXJuIG9ic2VydmVyTG9jYXRvci5nZXRBcnJheU9ic2VydmVyKGl0ZW1zKTtcbiAgfTtcblxuICBBcnJheVJlcGVhdFN0cmF0ZWd5LnByb3RvdHlwZS5pbnN0YW5jZUNoYW5nZWQgPSBmdW5jdGlvbiBpbnN0YW5jZUNoYW5nZWQocmVwZWF0LCBpdGVtcykge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICB2YXIgaXRlbXNMZW5ndGggPSBpdGVtcy5sZW5ndGg7XG5cbiAgICBpZiAoIWl0ZW1zIHx8IGl0ZW1zTGVuZ3RoID09PSAwKSB7XG4gICAgICByZXBlYXQucmVtb3ZlQWxsVmlld3ModHJ1ZSwgIXJlcGVhdC52aWV3c1JlcXVpcmVMaWZlY3ljbGUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBjaGlsZHJlbiA9IHJlcGVhdC52aWV3cygpO1xuICAgIHZhciB2aWV3c0xlbmd0aCA9IGNoaWxkcmVuLmxlbmd0aDtcblxuICAgIGlmICh2aWV3c0xlbmd0aCA9PT0gMCkge1xuICAgICAgdGhpcy5fc3RhbmRhcmRQcm9jZXNzSW5zdGFuY2VDaGFuZ2VkKHJlcGVhdCwgaXRlbXMpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChyZXBlYXQudmlld3NSZXF1aXJlTGlmZWN5Y2xlKSB7XG4gICAgICAoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY2hpbGRyZW5TbmFwc2hvdCA9IGNoaWxkcmVuLnNsaWNlKDApO1xuICAgICAgICB2YXIgaXRlbU5hbWVJbkJpbmRpbmdDb250ZXh0ID0gcmVwZWF0LmxvY2FsO1xuICAgICAgICB2YXIgbWF0Y2hlciA9IHJlcGVhdC5tYXRjaGVyKCk7XG5cbiAgICAgICAgdmFyIGl0ZW1zUHJldmlvdXNseUluVmlld3MgPSBbXTtcbiAgICAgICAgdmFyIHZpZXdzVG9SZW1vdmUgPSBbXTtcblxuICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgdmlld3NMZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgICB2YXIgdmlldyA9IGNoaWxkcmVuU25hcHNob3RbaW5kZXhdO1xuICAgICAgICAgIHZhciBvbGRJdGVtID0gdmlldy5iaW5kaW5nQ29udGV4dFtpdGVtTmFtZUluQmluZGluZ0NvbnRleHRdO1xuXG4gICAgICAgICAgaWYgKCgwLCBfcmVwZWF0VXRpbGl0aWVzLmluZGV4T2YpKGl0ZW1zLCBvbGRJdGVtLCBtYXRjaGVyKSA9PT0gLTEpIHtcbiAgICAgICAgICAgIHZpZXdzVG9SZW1vdmUucHVzaCh2aWV3KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaXRlbXNQcmV2aW91c2x5SW5WaWV3cy5wdXNoKG9sZEl0ZW0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciB1cGRhdGVWaWV3cyA9IHZvaWQgMDtcbiAgICAgICAgdmFyIHJlbW92ZVByb21pc2UgPSB2b2lkIDA7XG5cbiAgICAgICAgaWYgKGl0ZW1zUHJldmlvdXNseUluVmlld3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHJlbW92ZVByb21pc2UgPSByZXBlYXQucmVtb3ZlVmlld3Modmlld3NUb1JlbW92ZSwgdHJ1ZSwgIXJlcGVhdC52aWV3c1JlcXVpcmVMaWZlY3ljbGUpO1xuICAgICAgICAgIHVwZGF0ZVZpZXdzID0gZnVuY3Rpb24gdXBkYXRlVmlld3MoKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBfaW5kZXggPSAwOyBfaW5kZXggPCBpdGVtc0xlbmd0aDsgX2luZGV4KyspIHtcbiAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBpdGVtc1tfaW5kZXhdO1xuICAgICAgICAgICAgICB2YXIgaW5kZXhPZlZpZXcgPSAoMCwgX3JlcGVhdFV0aWxpdGllcy5pbmRleE9mKShpdGVtc1ByZXZpb3VzbHlJblZpZXdzLCBpdGVtLCBtYXRjaGVyLCBfaW5kZXgpO1xuICAgICAgICAgICAgICB2YXIgX3ZpZXcgPSB2b2lkIDA7XG5cbiAgICAgICAgICAgICAgaWYgKGluZGV4T2ZWaWV3ID09PSAtMSkge1xuICAgICAgICAgICAgICAgIHZhciBvdmVycmlkZUNvbnRleHQgPSAoMCwgX3JlcGVhdFV0aWxpdGllcy5jcmVhdGVGdWxsT3ZlcnJpZGVDb250ZXh0KShyZXBlYXQsIGl0ZW1zW19pbmRleF0sIF9pbmRleCwgaXRlbXNMZW5ndGgpO1xuICAgICAgICAgICAgICAgIHJlcGVhdC5pbnNlcnRWaWV3KF9pbmRleCwgb3ZlcnJpZGVDb250ZXh0LmJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpO1xuXG4gICAgICAgICAgICAgICAgaXRlbXNQcmV2aW91c2x5SW5WaWV3cy5zcGxpY2UoX2luZGV4LCAwLCB1bmRlZmluZWQpO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKGluZGV4T2ZWaWV3ID09PSBfaW5kZXgpIHtcbiAgICAgICAgICAgICAgICBfdmlldyA9IGNoaWxkcmVuW2luZGV4T2ZWaWV3XTtcbiAgICAgICAgICAgICAgICBpdGVtc1ByZXZpb3VzbHlJblZpZXdzW2luZGV4T2ZWaWV3XSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBfdmlldyA9IGNoaWxkcmVuW2luZGV4T2ZWaWV3XTtcbiAgICAgICAgICAgICAgICByZXBlYXQubW92ZVZpZXcoaW5kZXhPZlZpZXcsIF9pbmRleCk7XG4gICAgICAgICAgICAgICAgaXRlbXNQcmV2aW91c2x5SW5WaWV3cy5zcGxpY2UoaW5kZXhPZlZpZXcsIDEpO1xuICAgICAgICAgICAgICAgIGl0ZW1zUHJldmlvdXNseUluVmlld3Muc3BsaWNlKF9pbmRleCwgMCwgdW5kZWZpbmVkKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmIChfdmlldykge1xuICAgICAgICAgICAgICAgICgwLCBfcmVwZWF0VXRpbGl0aWVzLnVwZGF0ZU92ZXJyaWRlQ29udGV4dCkoX3ZpZXcub3ZlcnJpZGVDb250ZXh0LCBfaW5kZXgsIGl0ZW1zTGVuZ3RoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBfdGhpcy5faW5QbGFjZVByb2Nlc3NJdGVtcyhyZXBlYXQsIGl0ZW1zKTtcbiAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlbW92ZVByb21pc2UgPSByZXBlYXQucmVtb3ZlQWxsVmlld3ModHJ1ZSwgIXJlcGVhdC52aWV3c1JlcXVpcmVMaWZlY3ljbGUpO1xuICAgICAgICAgIHVwZGF0ZVZpZXdzID0gZnVuY3Rpb24gdXBkYXRlVmlld3MoKSB7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuX3N0YW5kYXJkUHJvY2Vzc0luc3RhbmNlQ2hhbmdlZChyZXBlYXQsIGl0ZW1zKTtcbiAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHJlbW92ZVByb21pc2UgaW5zdGFuY2VvZiBQcm9taXNlKSB7XG4gICAgICAgICAgcmVtb3ZlUHJvbWlzZS50aGVuKHVwZGF0ZVZpZXdzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB1cGRhdGVWaWV3cygpO1xuICAgICAgICB9XG4gICAgICB9KSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9pblBsYWNlUHJvY2Vzc0l0ZW1zKHJlcGVhdCwgaXRlbXMpO1xuICAgIH1cbiAgfTtcblxuICBBcnJheVJlcGVhdFN0cmF0ZWd5LnByb3RvdHlwZS5fc3RhbmRhcmRQcm9jZXNzSW5zdGFuY2VDaGFuZ2VkID0gZnVuY3Rpb24gX3N0YW5kYXJkUHJvY2Vzc0luc3RhbmNlQ2hhbmdlZChyZXBlYXQsIGl0ZW1zKSB7XG4gICAgZm9yICh2YXIgaSA9IDAsIGlpID0gaXRlbXMubGVuZ3RoOyBpIDwgaWk7IGkrKykge1xuICAgICAgdmFyIG92ZXJyaWRlQ29udGV4dCA9ICgwLCBfcmVwZWF0VXRpbGl0aWVzLmNyZWF0ZUZ1bGxPdmVycmlkZUNvbnRleHQpKHJlcGVhdCwgaXRlbXNbaV0sIGksIGlpKTtcbiAgICAgIHJlcGVhdC5hZGRWaWV3KG92ZXJyaWRlQ29udGV4dC5iaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KTtcbiAgICB9XG4gIH07XG5cbiAgQXJyYXlSZXBlYXRTdHJhdGVneS5wcm90b3R5cGUuX2luUGxhY2VQcm9jZXNzSXRlbXMgPSBmdW5jdGlvbiBfaW5QbGFjZVByb2Nlc3NJdGVtcyhyZXBlYXQsIGl0ZW1zKSB7XG4gICAgdmFyIGl0ZW1zTGVuZ3RoID0gaXRlbXMubGVuZ3RoO1xuICAgIHZhciB2aWV3c0xlbmd0aCA9IHJlcGVhdC52aWV3Q291bnQoKTtcblxuICAgIHdoaWxlICh2aWV3c0xlbmd0aCA+IGl0ZW1zTGVuZ3RoKSB7XG4gICAgICB2aWV3c0xlbmd0aC0tO1xuICAgICAgcmVwZWF0LnJlbW92ZVZpZXcodmlld3NMZW5ndGgsIHRydWUsICFyZXBlYXQudmlld3NSZXF1aXJlTGlmZWN5Y2xlKTtcbiAgICB9XG5cbiAgICB2YXIgbG9jYWwgPSByZXBlYXQubG9jYWw7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZpZXdzTGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciB2aWV3ID0gcmVwZWF0LnZpZXcoaSk7XG4gICAgICB2YXIgbGFzdCA9IGkgPT09IGl0ZW1zTGVuZ3RoIC0gMTtcbiAgICAgIHZhciBtaWRkbGUgPSBpICE9PSAwICYmICFsYXN0O1xuXG4gICAgICBpZiAodmlldy5iaW5kaW5nQ29udGV4dFtsb2NhbF0gPT09IGl0ZW1zW2ldICYmIHZpZXcub3ZlcnJpZGVDb250ZXh0LiRtaWRkbGUgPT09IG1pZGRsZSAmJiB2aWV3Lm92ZXJyaWRlQ29udGV4dC4kbGFzdCA9PT0gbGFzdCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgdmlldy5iaW5kaW5nQ29udGV4dFtsb2NhbF0gPSBpdGVtc1tpXTtcbiAgICAgIHZpZXcub3ZlcnJpZGVDb250ZXh0LiRtaWRkbGUgPSBtaWRkbGU7XG4gICAgICB2aWV3Lm92ZXJyaWRlQ29udGV4dC4kbGFzdCA9IGxhc3Q7XG4gICAgICByZXBlYXQudXBkYXRlQmluZGluZ3Modmlldyk7XG4gICAgfVxuXG4gICAgZm9yICh2YXIgX2kgPSB2aWV3c0xlbmd0aDsgX2kgPCBpdGVtc0xlbmd0aDsgX2krKykge1xuICAgICAgdmFyIG92ZXJyaWRlQ29udGV4dCA9ICgwLCBfcmVwZWF0VXRpbGl0aWVzLmNyZWF0ZUZ1bGxPdmVycmlkZUNvbnRleHQpKHJlcGVhdCwgaXRlbXNbX2ldLCBfaSwgaXRlbXNMZW5ndGgpO1xuICAgICAgcmVwZWF0LmFkZFZpZXcob3ZlcnJpZGVDb250ZXh0LmJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpO1xuICAgIH1cbiAgfTtcblxuICBBcnJheVJlcGVhdFN0cmF0ZWd5LnByb3RvdHlwZS5pbnN0YW5jZU11dGF0ZWQgPSBmdW5jdGlvbiBpbnN0YW5jZU11dGF0ZWQocmVwZWF0LCBhcnJheSwgc3BsaWNlcykge1xuICAgIHZhciBfdGhpczIgPSB0aGlzO1xuXG4gICAgaWYgKHJlcGVhdC5fX3F1ZXVlZFNwbGljZXMpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHNwbGljZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgICB2YXIgX3NwbGljZXMkaSA9IHNwbGljZXNbaV07XG4gICAgICAgIHZhciBpbmRleCA9IF9zcGxpY2VzJGkuaW5kZXg7XG4gICAgICAgIHZhciByZW1vdmVkID0gX3NwbGljZXMkaS5yZW1vdmVkO1xuICAgICAgICB2YXIgYWRkZWRDb3VudCA9IF9zcGxpY2VzJGkuYWRkZWRDb3VudDtcblxuICAgICAgICAoMCwgX2F1cmVsaWFCaW5kaW5nLm1lcmdlU3BsaWNlKShyZXBlYXQuX19xdWV1ZWRTcGxpY2VzLCBpbmRleCwgcmVtb3ZlZCwgYWRkZWRDb3VudCk7XG4gICAgICB9XG5cbiAgICAgIHJlcGVhdC5fX2FycmF5ID0gYXJyYXkuc2xpY2UoMCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIG1heWJlUHJvbWlzZSA9IHRoaXMuX3J1blNwbGljZXMocmVwZWF0LCBhcnJheS5zbGljZSgwKSwgc3BsaWNlcyk7XG4gICAgaWYgKG1heWJlUHJvbWlzZSBpbnN0YW5jZW9mIFByb21pc2UpIHtcbiAgICAgIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBxdWV1ZWRTcGxpY2VzID0gcmVwZWF0Ll9fcXVldWVkU3BsaWNlcyA9IFtdO1xuXG4gICAgICAgIHZhciBydW5RdWV1ZWRTcGxpY2VzID0gZnVuY3Rpb24gcnVuUXVldWVkU3BsaWNlcygpIHtcbiAgICAgICAgICBpZiAoIXF1ZXVlZFNwbGljZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXBlYXQuX19xdWV1ZWRTcGxpY2VzID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgcmVwZWF0Ll9fYXJyYXkgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIG5leHRQcm9taXNlID0gX3RoaXMyLl9ydW5TcGxpY2VzKHJlcGVhdCwgcmVwZWF0Ll9fYXJyYXksIHF1ZXVlZFNwbGljZXMpIHx8IFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICAgIHF1ZXVlZFNwbGljZXMgPSByZXBlYXQuX19xdWV1ZWRTcGxpY2VzID0gW107XG4gICAgICAgICAgbmV4dFByb21pc2UudGhlbihydW5RdWV1ZWRTcGxpY2VzKTtcbiAgICAgICAgfTtcblxuICAgICAgICBtYXliZVByb21pc2UudGhlbihydW5RdWV1ZWRTcGxpY2VzKTtcbiAgICAgIH0pKCk7XG4gICAgfVxuICB9O1xuXG4gIEFycmF5UmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLl9ydW5TcGxpY2VzID0gZnVuY3Rpb24gX3J1blNwbGljZXMocmVwZWF0LCBhcnJheSwgc3BsaWNlcykge1xuICAgIHZhciBfdGhpczMgPSB0aGlzO1xuXG4gICAgdmFyIHJlbW92ZURlbHRhID0gMDtcbiAgICB2YXIgcm1Qcm9taXNlcyA9IFtdO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIGlpID0gc3BsaWNlcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICB2YXIgc3BsaWNlID0gc3BsaWNlc1tpXTtcbiAgICAgIHZhciByZW1vdmVkID0gc3BsaWNlLnJlbW92ZWQ7XG5cbiAgICAgIGZvciAodmFyIGogPSAwLCBqaiA9IHJlbW92ZWQubGVuZ3RoOyBqIDwgamo7ICsraikge1xuICAgICAgICB2YXIgdmlld09yUHJvbWlzZSA9IHJlcGVhdC5yZW1vdmVWaWV3KHNwbGljZS5pbmRleCArIHJlbW92ZURlbHRhICsgcm1Qcm9taXNlcy5sZW5ndGgsIHRydWUpO1xuICAgICAgICBpZiAodmlld09yUHJvbWlzZSBpbnN0YW5jZW9mIFByb21pc2UpIHtcbiAgICAgICAgICBybVByb21pc2VzLnB1c2godmlld09yUHJvbWlzZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJlbW92ZURlbHRhIC09IHNwbGljZS5hZGRlZENvdW50O1xuICAgIH1cblxuICAgIGlmIChybVByb21pc2VzLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChybVByb21pc2VzKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNwbGljZUluZGV4TG93ID0gX3RoaXMzLl9oYW5kbGVBZGRlZFNwbGljZXMocmVwZWF0LCBhcnJheSwgc3BsaWNlcyk7XG4gICAgICAgICgwLCBfcmVwZWF0VXRpbGl0aWVzLnVwZGF0ZU92ZXJyaWRlQ29udGV4dHMpKHJlcGVhdC52aWV3cygpLCBzcGxpY2VJbmRleExvdyk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB2YXIgc3BsaWNlSW5kZXhMb3cgPSB0aGlzLl9oYW5kbGVBZGRlZFNwbGljZXMocmVwZWF0LCBhcnJheSwgc3BsaWNlcyk7XG4gICAgKDAsIF9yZXBlYXRVdGlsaXRpZXMudXBkYXRlT3ZlcnJpZGVDb250ZXh0cykocmVwZWF0LnZpZXdzKCksIHNwbGljZUluZGV4TG93KTtcblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH07XG5cbiAgQXJyYXlSZXBlYXRTdHJhdGVneS5wcm90b3R5cGUuX2hhbmRsZUFkZGVkU3BsaWNlcyA9IGZ1bmN0aW9uIF9oYW5kbGVBZGRlZFNwbGljZXMocmVwZWF0LCBhcnJheSwgc3BsaWNlcykge1xuICAgIHZhciBzcGxpY2VJbmRleCA9IHZvaWQgMDtcbiAgICB2YXIgc3BsaWNlSW5kZXhMb3cgPSB2b2lkIDA7XG4gICAgdmFyIGFycmF5TGVuZ3RoID0gYXJyYXkubGVuZ3RoO1xuICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHNwbGljZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgdmFyIHNwbGljZSA9IHNwbGljZXNbaV07XG4gICAgICB2YXIgYWRkSW5kZXggPSBzcGxpY2VJbmRleCA9IHNwbGljZS5pbmRleDtcbiAgICAgIHZhciBlbmQgPSBzcGxpY2UuaW5kZXggKyBzcGxpY2UuYWRkZWRDb3VudDtcblxuICAgICAgaWYgKHR5cGVvZiBzcGxpY2VJbmRleExvdyA9PT0gJ3VuZGVmaW5lZCcgfHwgc3BsaWNlSW5kZXhMb3cgPT09IG51bGwgfHwgc3BsaWNlSW5kZXhMb3cgPiBzcGxpY2UuaW5kZXgpIHtcbiAgICAgICAgc3BsaWNlSW5kZXhMb3cgPSBzcGxpY2VJbmRleDtcbiAgICAgIH1cblxuICAgICAgZm9yICg7IGFkZEluZGV4IDwgZW5kOyArK2FkZEluZGV4KSB7XG4gICAgICAgIHZhciBvdmVycmlkZUNvbnRleHQgPSAoMCwgX3JlcGVhdFV0aWxpdGllcy5jcmVhdGVGdWxsT3ZlcnJpZGVDb250ZXh0KShyZXBlYXQsIGFycmF5W2FkZEluZGV4XSwgYWRkSW5kZXgsIGFycmF5TGVuZ3RoKTtcbiAgICAgICAgcmVwZWF0Lmluc2VydFZpZXcoYWRkSW5kZXgsIG92ZXJyaWRlQ29udGV4dC5iaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gc3BsaWNlSW5kZXhMb3c7XG4gIH07XG5cbiAgcmV0dXJuIEFycmF5UmVwZWF0U3RyYXRlZ3k7XG59KCk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9hcnJheS1yZXBlYXQtc3RyYXRlZ3kuanNcbi8vIG1vZHVsZSBpZCA9IDU4XG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuQmluZGluZ1NpZ25hbGVyID0gdW5kZWZpbmVkO1xuXG52YXIgX2F1cmVsaWFCaW5kaW5nID0gcmVxdWlyZSgnYXVyZWxpYS1iaW5kaW5nJyk7XG5cblxuXG52YXIgQmluZGluZ1NpZ25hbGVyID0gZXhwb3J0cy5CaW5kaW5nU2lnbmFsZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEJpbmRpbmdTaWduYWxlcigpIHtcbiAgICBcblxuICAgIHRoaXMuc2lnbmFscyA9IHt9O1xuICB9XG5cbiAgQmluZGluZ1NpZ25hbGVyLnByb3RvdHlwZS5zaWduYWwgPSBmdW5jdGlvbiBzaWduYWwobmFtZSkge1xuICAgIHZhciBiaW5kaW5ncyA9IHRoaXMuc2lnbmFsc1tuYW1lXTtcbiAgICBpZiAoIWJpbmRpbmdzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBpID0gYmluZGluZ3MubGVuZ3RoO1xuICAgIHdoaWxlIChpLS0pIHtcbiAgICAgIGJpbmRpbmdzW2ldLmNhbGwoX2F1cmVsaWFCaW5kaW5nLnNvdXJjZUNvbnRleHQpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gQmluZGluZ1NpZ25hbGVyO1xufSgpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzL2Rpc3QvY29tbW9uanMvYmluZGluZy1zaWduYWxlci5qc1xuLy8gbW9kdWxlIGlkID0gNTlcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuXG5cblxudmFyIFNDUklQVF9SRUdFWCA9IC88c2NyaXB0XFxiW148XSooPzooPyE8XFwvc2NyaXB0Pik8W148XSopKjxcXC9zY3JpcHQ+L2dpO1xuXG52YXIgSFRNTFNhbml0aXplciA9IGV4cG9ydHMuSFRNTFNhbml0aXplciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gSFRNTFNhbml0aXplcigpIHtcbiAgICBcbiAgfVxuXG4gIEhUTUxTYW5pdGl6ZXIucHJvdG90eXBlLnNhbml0aXplID0gZnVuY3Rpb24gc2FuaXRpemUoaW5wdXQpIHtcbiAgICByZXR1cm4gaW5wdXQucmVwbGFjZShTQ1JJUFRfUkVHRVgsICcnKTtcbiAgfTtcblxuICByZXR1cm4gSFRNTFNhbml0aXplcjtcbn0oKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L2NvbW1vbmpzL2h0bWwtc2FuaXRpemVyLmpzXG4vLyBtb2R1bGUgaWQgPSA2MFxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLk1hcFJlcGVhdFN0cmF0ZWd5ID0gdW5kZWZpbmVkO1xuXG52YXIgX3JlcGVhdFV0aWxpdGllcyA9IHJlcXVpcmUoJy4vcmVwZWF0LXV0aWxpdGllcycpO1xuXG5cblxudmFyIE1hcFJlcGVhdFN0cmF0ZWd5ID0gZXhwb3J0cy5NYXBSZXBlYXRTdHJhdGVneSA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gTWFwUmVwZWF0U3RyYXRlZ3koKSB7XG4gICAgXG4gIH1cblxuICBNYXBSZXBlYXRTdHJhdGVneS5wcm90b3R5cGUuZ2V0Q29sbGVjdGlvbk9ic2VydmVyID0gZnVuY3Rpb24gZ2V0Q29sbGVjdGlvbk9ic2VydmVyKG9ic2VydmVyTG9jYXRvciwgaXRlbXMpIHtcbiAgICByZXR1cm4gb2JzZXJ2ZXJMb2NhdG9yLmdldE1hcE9ic2VydmVyKGl0ZW1zKTtcbiAgfTtcblxuICBNYXBSZXBlYXRTdHJhdGVneS5wcm90b3R5cGUuaW5zdGFuY2VDaGFuZ2VkID0gZnVuY3Rpb24gaW5zdGFuY2VDaGFuZ2VkKHJlcGVhdCwgaXRlbXMpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgdmFyIHJlbW92ZVByb21pc2UgPSByZXBlYXQucmVtb3ZlQWxsVmlld3ModHJ1ZSwgIXJlcGVhdC52aWV3c1JlcXVpcmVMaWZlY3ljbGUpO1xuICAgIGlmIChyZW1vdmVQcm9taXNlIGluc3RhbmNlb2YgUHJvbWlzZSkge1xuICAgICAgcmVtb3ZlUHJvbWlzZS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzLl9zdGFuZGFyZFByb2Nlc3NJdGVtcyhyZXBlYXQsIGl0ZW1zKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLl9zdGFuZGFyZFByb2Nlc3NJdGVtcyhyZXBlYXQsIGl0ZW1zKTtcbiAgfTtcblxuICBNYXBSZXBlYXRTdHJhdGVneS5wcm90b3R5cGUuX3N0YW5kYXJkUHJvY2Vzc0l0ZW1zID0gZnVuY3Rpb24gX3N0YW5kYXJkUHJvY2Vzc0l0ZW1zKHJlcGVhdCwgaXRlbXMpIHtcbiAgICB2YXIgaW5kZXggPSAwO1xuICAgIHZhciBvdmVycmlkZUNvbnRleHQgPSB2b2lkIDA7XG5cbiAgICBpdGVtcy5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XG4gICAgICBvdmVycmlkZUNvbnRleHQgPSAoMCwgX3JlcGVhdFV0aWxpdGllcy5jcmVhdGVGdWxsT3ZlcnJpZGVDb250ZXh0KShyZXBlYXQsIHZhbHVlLCBpbmRleCwgaXRlbXMuc2l6ZSwga2V5KTtcbiAgICAgIHJlcGVhdC5hZGRWaWV3KG92ZXJyaWRlQ29udGV4dC5iaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KTtcbiAgICAgICsraW5kZXg7XG4gICAgfSk7XG4gIH07XG5cbiAgTWFwUmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLmluc3RhbmNlTXV0YXRlZCA9IGZ1bmN0aW9uIGluc3RhbmNlTXV0YXRlZChyZXBlYXQsIG1hcCwgcmVjb3Jkcykge1xuICAgIHZhciBrZXkgPSB2b2lkIDA7XG4gICAgdmFyIGkgPSB2b2lkIDA7XG4gICAgdmFyIGlpID0gdm9pZCAwO1xuICAgIHZhciBvdmVycmlkZUNvbnRleHQgPSB2b2lkIDA7XG4gICAgdmFyIHJlbW92ZUluZGV4ID0gdm9pZCAwO1xuICAgIHZhciByZWNvcmQgPSB2b2lkIDA7XG4gICAgdmFyIHJtUHJvbWlzZXMgPSBbXTtcbiAgICB2YXIgdmlld09yUHJvbWlzZSA9IHZvaWQgMDtcblxuICAgIGZvciAoaSA9IDAsIGlpID0gcmVjb3Jkcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICByZWNvcmQgPSByZWNvcmRzW2ldO1xuICAgICAga2V5ID0gcmVjb3JkLmtleTtcbiAgICAgIHN3aXRjaCAocmVjb3JkLnR5cGUpIHtcbiAgICAgICAgY2FzZSAndXBkYXRlJzpcbiAgICAgICAgICByZW1vdmVJbmRleCA9IHRoaXMuX2dldFZpZXdJbmRleEJ5S2V5KHJlcGVhdCwga2V5KTtcbiAgICAgICAgICB2aWV3T3JQcm9taXNlID0gcmVwZWF0LnJlbW92ZVZpZXcocmVtb3ZlSW5kZXgsIHRydWUsICFyZXBlYXQudmlld3NSZXF1aXJlTGlmZWN5Y2xlKTtcbiAgICAgICAgICBpZiAodmlld09yUHJvbWlzZSBpbnN0YW5jZW9mIFByb21pc2UpIHtcbiAgICAgICAgICAgIHJtUHJvbWlzZXMucHVzaCh2aWV3T3JQcm9taXNlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgb3ZlcnJpZGVDb250ZXh0ID0gKDAsIF9yZXBlYXRVdGlsaXRpZXMuY3JlYXRlRnVsbE92ZXJyaWRlQ29udGV4dCkocmVwZWF0LCBtYXAuZ2V0KGtleSksIHJlbW92ZUluZGV4LCBtYXAuc2l6ZSwga2V5KTtcbiAgICAgICAgICByZXBlYXQuaW5zZXJ0VmlldyhyZW1vdmVJbmRleCwgb3ZlcnJpZGVDb250ZXh0LmJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdhZGQnOlxuICAgICAgICAgIG92ZXJyaWRlQ29udGV4dCA9ICgwLCBfcmVwZWF0VXRpbGl0aWVzLmNyZWF0ZUZ1bGxPdmVycmlkZUNvbnRleHQpKHJlcGVhdCwgbWFwLmdldChrZXkpLCBtYXAuc2l6ZSAtIDEsIG1hcC5zaXplLCBrZXkpO1xuICAgICAgICAgIHJlcGVhdC5pbnNlcnRWaWV3KG1hcC5zaXplIC0gMSwgb3ZlcnJpZGVDb250ZXh0LmJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdkZWxldGUnOlxuICAgICAgICAgIGlmIChyZWNvcmQub2xkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZW1vdmVJbmRleCA9IHRoaXMuX2dldFZpZXdJbmRleEJ5S2V5KHJlcGVhdCwga2V5KTtcbiAgICAgICAgICB2aWV3T3JQcm9taXNlID0gcmVwZWF0LnJlbW92ZVZpZXcocmVtb3ZlSW5kZXgsIHRydWUsICFyZXBlYXQudmlld3NSZXF1aXJlTGlmZWN5Y2xlKTtcbiAgICAgICAgICBpZiAodmlld09yUHJvbWlzZSBpbnN0YW5jZW9mIFByb21pc2UpIHtcbiAgICAgICAgICAgIHJtUHJvbWlzZXMucHVzaCh2aWV3T3JQcm9taXNlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2NsZWFyJzpcbiAgICAgICAgICByZXBlYXQucmVtb3ZlQWxsVmlld3ModHJ1ZSwgIXJlcGVhdC52aWV3c1JlcXVpcmVMaWZlY3ljbGUpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChybVByb21pc2VzLmxlbmd0aCA+IDApIHtcbiAgICAgIFByb21pc2UuYWxsKHJtUHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAoMCwgX3JlcGVhdFV0aWxpdGllcy51cGRhdGVPdmVycmlkZUNvbnRleHRzKShyZXBlYXQudmlld3MoKSwgMCk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgKDAsIF9yZXBlYXRVdGlsaXRpZXMudXBkYXRlT3ZlcnJpZGVDb250ZXh0cykocmVwZWF0LnZpZXdzKCksIDApO1xuICAgIH1cbiAgfTtcblxuICBNYXBSZXBlYXRTdHJhdGVneS5wcm90b3R5cGUuX2dldFZpZXdJbmRleEJ5S2V5ID0gZnVuY3Rpb24gX2dldFZpZXdJbmRleEJ5S2V5KHJlcGVhdCwga2V5KSB7XG4gICAgdmFyIGkgPSB2b2lkIDA7XG4gICAgdmFyIGlpID0gdm9pZCAwO1xuICAgIHZhciBjaGlsZCA9IHZvaWQgMDtcblxuICAgIGZvciAoaSA9IDAsIGlpID0gcmVwZWF0LnZpZXdDb3VudCgpOyBpIDwgaWk7ICsraSkge1xuICAgICAgY2hpbGQgPSByZXBlYXQudmlldyhpKTtcbiAgICAgIGlmIChjaGlsZC5iaW5kaW5nQ29udGV4dFtyZXBlYXQua2V5XSA9PT0ga2V5KSB7XG4gICAgICAgIHJldHVybiBpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH07XG5cbiAgcmV0dXJuIE1hcFJlcGVhdFN0cmF0ZWd5O1xufSgpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzL2Rpc3QvY29tbW9uanMvbWFwLXJlcGVhdC1zdHJhdGVneS5qc1xuLy8gbW9kdWxlIGlkID0gNjFcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5cblxuXG52YXIgTnVsbFJlcGVhdFN0cmF0ZWd5ID0gZXhwb3J0cy5OdWxsUmVwZWF0U3RyYXRlZ3kgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIE51bGxSZXBlYXRTdHJhdGVneSgpIHtcbiAgICBcbiAgfVxuXG4gIE51bGxSZXBlYXRTdHJhdGVneS5wcm90b3R5cGUuaW5zdGFuY2VDaGFuZ2VkID0gZnVuY3Rpb24gaW5zdGFuY2VDaGFuZ2VkKHJlcGVhdCwgaXRlbXMpIHtcbiAgICByZXBlYXQucmVtb3ZlQWxsVmlld3ModHJ1ZSk7XG4gIH07XG5cbiAgTnVsbFJlcGVhdFN0cmF0ZWd5LnByb3RvdHlwZS5nZXRDb2xsZWN0aW9uT2JzZXJ2ZXIgPSBmdW5jdGlvbiBnZXRDb2xsZWN0aW9uT2JzZXJ2ZXIob2JzZXJ2ZXJMb2NhdG9yLCBpdGVtcykge307XG5cbiAgcmV0dXJuIE51bGxSZXBlYXRTdHJhdGVneTtcbn0oKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L2NvbW1vbmpzL251bGwtcmVwZWF0LXN0cmF0ZWd5LmpzXG4vLyBtb2R1bGUgaWQgPSA2MlxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLk51bWJlclJlcGVhdFN0cmF0ZWd5ID0gdW5kZWZpbmVkO1xuXG52YXIgX3JlcGVhdFV0aWxpdGllcyA9IHJlcXVpcmUoJy4vcmVwZWF0LXV0aWxpdGllcycpO1xuXG5cblxudmFyIE51bWJlclJlcGVhdFN0cmF0ZWd5ID0gZXhwb3J0cy5OdW1iZXJSZXBlYXRTdHJhdGVneSA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gTnVtYmVyUmVwZWF0U3RyYXRlZ3koKSB7XG4gICAgXG4gIH1cblxuICBOdW1iZXJSZXBlYXRTdHJhdGVneS5wcm90b3R5cGUuZ2V0Q29sbGVjdGlvbk9ic2VydmVyID0gZnVuY3Rpb24gZ2V0Q29sbGVjdGlvbk9ic2VydmVyKCkge1xuICAgIHJldHVybiBudWxsO1xuICB9O1xuXG4gIE51bWJlclJlcGVhdFN0cmF0ZWd5LnByb3RvdHlwZS5pbnN0YW5jZUNoYW5nZWQgPSBmdW5jdGlvbiBpbnN0YW5jZUNoYW5nZWQocmVwZWF0LCB2YWx1ZSkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICB2YXIgcmVtb3ZlUHJvbWlzZSA9IHJlcGVhdC5yZW1vdmVBbGxWaWV3cyh0cnVlLCAhcmVwZWF0LnZpZXdzUmVxdWlyZUxpZmVjeWNsZSk7XG4gICAgaWYgKHJlbW92ZVByb21pc2UgaW5zdGFuY2VvZiBQcm9taXNlKSB7XG4gICAgICByZW1vdmVQcm9taXNlLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMuX3N0YW5kYXJkUHJvY2Vzc0l0ZW1zKHJlcGVhdCwgdmFsdWUpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuX3N0YW5kYXJkUHJvY2Vzc0l0ZW1zKHJlcGVhdCwgdmFsdWUpO1xuICB9O1xuXG4gIE51bWJlclJlcGVhdFN0cmF0ZWd5LnByb3RvdHlwZS5fc3RhbmRhcmRQcm9jZXNzSXRlbXMgPSBmdW5jdGlvbiBfc3RhbmRhcmRQcm9jZXNzSXRlbXMocmVwZWF0LCB2YWx1ZSkge1xuICAgIHZhciBjaGlsZHJlbkxlbmd0aCA9IHJlcGVhdC52aWV3Q291bnQoKTtcbiAgICB2YXIgaSA9IHZvaWQgMDtcbiAgICB2YXIgaWkgPSB2b2lkIDA7XG4gICAgdmFyIG92ZXJyaWRlQ29udGV4dCA9IHZvaWQgMDtcbiAgICB2YXIgdmlld3NUb1JlbW92ZSA9IHZvaWQgMDtcblxuICAgIHZhbHVlID0gTWF0aC5mbG9vcih2YWx1ZSk7XG4gICAgdmlld3NUb1JlbW92ZSA9IGNoaWxkcmVuTGVuZ3RoIC0gdmFsdWU7XG5cbiAgICBpZiAodmlld3NUb1JlbW92ZSA+IDApIHtcbiAgICAgIGlmICh2aWV3c1RvUmVtb3ZlID4gY2hpbGRyZW5MZW5ndGgpIHtcbiAgICAgICAgdmlld3NUb1JlbW92ZSA9IGNoaWxkcmVuTGVuZ3RoO1xuICAgICAgfVxuXG4gICAgICBmb3IgKGkgPSAwLCBpaSA9IHZpZXdzVG9SZW1vdmU7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgIHJlcGVhdC5yZW1vdmVWaWV3KGNoaWxkcmVuTGVuZ3RoIC0gKGkgKyAxKSwgdHJ1ZSwgIXJlcGVhdC52aWV3c1JlcXVpcmVMaWZlY3ljbGUpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZm9yIChpID0gY2hpbGRyZW5MZW5ndGgsIGlpID0gdmFsdWU7IGkgPCBpaTsgKytpKSB7XG4gICAgICBvdmVycmlkZUNvbnRleHQgPSAoMCwgX3JlcGVhdFV0aWxpdGllcy5jcmVhdGVGdWxsT3ZlcnJpZGVDb250ZXh0KShyZXBlYXQsIGksIGksIGlpKTtcbiAgICAgIHJlcGVhdC5hZGRWaWV3KG92ZXJyaWRlQ29udGV4dC5iaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KTtcbiAgICB9XG5cbiAgICAoMCwgX3JlcGVhdFV0aWxpdGllcy51cGRhdGVPdmVycmlkZUNvbnRleHRzKShyZXBlYXQudmlld3MoKSwgMCk7XG4gIH07XG5cbiAgcmV0dXJuIE51bWJlclJlcGVhdFN0cmF0ZWd5O1xufSgpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzL2Rpc3QvY29tbW9uanMvbnVtYmVyLXJlcGVhdC1zdHJhdGVneS5qc1xuLy8gbW9kdWxlIGlkID0gNjNcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5SZXBlYXRTdHJhdGVneUxvY2F0b3IgPSB1bmRlZmluZWQ7XG5cbnZhciBfbnVsbFJlcGVhdFN0cmF0ZWd5ID0gcmVxdWlyZSgnLi9udWxsLXJlcGVhdC1zdHJhdGVneScpO1xuXG52YXIgX2FycmF5UmVwZWF0U3RyYXRlZ3kgPSByZXF1aXJlKCcuL2FycmF5LXJlcGVhdC1zdHJhdGVneScpO1xuXG52YXIgX21hcFJlcGVhdFN0cmF0ZWd5ID0gcmVxdWlyZSgnLi9tYXAtcmVwZWF0LXN0cmF0ZWd5Jyk7XG5cbnZhciBfc2V0UmVwZWF0U3RyYXRlZ3kgPSByZXF1aXJlKCcuL3NldC1yZXBlYXQtc3RyYXRlZ3knKTtcblxudmFyIF9udW1iZXJSZXBlYXRTdHJhdGVneSA9IHJlcXVpcmUoJy4vbnVtYmVyLXJlcGVhdC1zdHJhdGVneScpO1xuXG5cblxudmFyIFJlcGVhdFN0cmF0ZWd5TG9jYXRvciA9IGV4cG9ydHMuUmVwZWF0U3RyYXRlZ3lMb2NhdG9yID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBSZXBlYXRTdHJhdGVneUxvY2F0b3IoKSB7XG4gICAgXG5cbiAgICB0aGlzLm1hdGNoZXJzID0gW107XG4gICAgdGhpcy5zdHJhdGVnaWVzID0gW107XG5cbiAgICB0aGlzLmFkZFN0cmF0ZWd5KGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgcmV0dXJuIGl0ZW1zID09PSBudWxsIHx8IGl0ZW1zID09PSB1bmRlZmluZWQ7XG4gICAgfSwgbmV3IF9udWxsUmVwZWF0U3RyYXRlZ3kuTnVsbFJlcGVhdFN0cmF0ZWd5KCkpO1xuICAgIHRoaXMuYWRkU3RyYXRlZ3koZnVuY3Rpb24gKGl0ZW1zKSB7XG4gICAgICByZXR1cm4gaXRlbXMgaW5zdGFuY2VvZiBBcnJheTtcbiAgICB9LCBuZXcgX2FycmF5UmVwZWF0U3RyYXRlZ3kuQXJyYXlSZXBlYXRTdHJhdGVneSgpKTtcbiAgICB0aGlzLmFkZFN0cmF0ZWd5KGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgcmV0dXJuIGl0ZW1zIGluc3RhbmNlb2YgTWFwO1xuICAgIH0sIG5ldyBfbWFwUmVwZWF0U3RyYXRlZ3kuTWFwUmVwZWF0U3RyYXRlZ3koKSk7XG4gICAgdGhpcy5hZGRTdHJhdGVneShmdW5jdGlvbiAoaXRlbXMpIHtcbiAgICAgIHJldHVybiBpdGVtcyBpbnN0YW5jZW9mIFNldDtcbiAgICB9LCBuZXcgX3NldFJlcGVhdFN0cmF0ZWd5LlNldFJlcGVhdFN0cmF0ZWd5KCkpO1xuICAgIHRoaXMuYWRkU3RyYXRlZ3koZnVuY3Rpb24gKGl0ZW1zKSB7XG4gICAgICByZXR1cm4gdHlwZW9mIGl0ZW1zID09PSAnbnVtYmVyJztcbiAgICB9LCBuZXcgX251bWJlclJlcGVhdFN0cmF0ZWd5Lk51bWJlclJlcGVhdFN0cmF0ZWd5KCkpO1xuICB9XG5cbiAgUmVwZWF0U3RyYXRlZ3lMb2NhdG9yLnByb3RvdHlwZS5hZGRTdHJhdGVneSA9IGZ1bmN0aW9uIGFkZFN0cmF0ZWd5KG1hdGNoZXIsIHN0cmF0ZWd5KSB7XG4gICAgdGhpcy5tYXRjaGVycy5wdXNoKG1hdGNoZXIpO1xuICAgIHRoaXMuc3RyYXRlZ2llcy5wdXNoKHN0cmF0ZWd5KTtcbiAgfTtcblxuICBSZXBlYXRTdHJhdGVneUxvY2F0b3IucHJvdG90eXBlLmdldFN0cmF0ZWd5ID0gZnVuY3Rpb24gZ2V0U3RyYXRlZ3koaXRlbXMpIHtcbiAgICB2YXIgbWF0Y2hlcnMgPSB0aGlzLm1hdGNoZXJzO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIGlpID0gbWF0Y2hlcnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgaWYgKG1hdGNoZXJzW2ldKGl0ZW1zKSkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdHJhdGVnaWVzW2ldO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9O1xuXG4gIHJldHVybiBSZXBlYXRTdHJhdGVneUxvY2F0b3I7XG59KCk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9yZXBlYXQtc3RyYXRlZ3ktbG9jYXRvci5qc1xuLy8gbW9kdWxlIGlkID0gNjRcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5TZXRSZXBlYXRTdHJhdGVneSA9IHVuZGVmaW5lZDtcblxudmFyIF9yZXBlYXRVdGlsaXRpZXMgPSByZXF1aXJlKCcuL3JlcGVhdC11dGlsaXRpZXMnKTtcblxuXG5cbnZhciBTZXRSZXBlYXRTdHJhdGVneSA9IGV4cG9ydHMuU2V0UmVwZWF0U3RyYXRlZ3kgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFNldFJlcGVhdFN0cmF0ZWd5KCkge1xuICAgIFxuICB9XG5cbiAgU2V0UmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLmdldENvbGxlY3Rpb25PYnNlcnZlciA9IGZ1bmN0aW9uIGdldENvbGxlY3Rpb25PYnNlcnZlcihvYnNlcnZlckxvY2F0b3IsIGl0ZW1zKSB7XG4gICAgcmV0dXJuIG9ic2VydmVyTG9jYXRvci5nZXRTZXRPYnNlcnZlcihpdGVtcyk7XG4gIH07XG5cbiAgU2V0UmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLmluc3RhbmNlQ2hhbmdlZCA9IGZ1bmN0aW9uIGluc3RhbmNlQ2hhbmdlZChyZXBlYXQsIGl0ZW1zKSB7XG4gICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgIHZhciByZW1vdmVQcm9taXNlID0gcmVwZWF0LnJlbW92ZUFsbFZpZXdzKHRydWUsICFyZXBlYXQudmlld3NSZXF1aXJlTGlmZWN5Y2xlKTtcbiAgICBpZiAocmVtb3ZlUHJvbWlzZSBpbnN0YW5jZW9mIFByb21pc2UpIHtcbiAgICAgIHJlbW92ZVByb21pc2UudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpcy5fc3RhbmRhcmRQcm9jZXNzSXRlbXMocmVwZWF0LCBpdGVtcyk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5fc3RhbmRhcmRQcm9jZXNzSXRlbXMocmVwZWF0LCBpdGVtcyk7XG4gIH07XG5cbiAgU2V0UmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLl9zdGFuZGFyZFByb2Nlc3NJdGVtcyA9IGZ1bmN0aW9uIF9zdGFuZGFyZFByb2Nlc3NJdGVtcyhyZXBlYXQsIGl0ZW1zKSB7XG4gICAgdmFyIGluZGV4ID0gMDtcbiAgICB2YXIgb3ZlcnJpZGVDb250ZXh0ID0gdm9pZCAwO1xuXG4gICAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIG92ZXJyaWRlQ29udGV4dCA9ICgwLCBfcmVwZWF0VXRpbGl0aWVzLmNyZWF0ZUZ1bGxPdmVycmlkZUNvbnRleHQpKHJlcGVhdCwgdmFsdWUsIGluZGV4LCBpdGVtcy5zaXplKTtcbiAgICAgIHJlcGVhdC5hZGRWaWV3KG92ZXJyaWRlQ29udGV4dC5iaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KTtcbiAgICAgICsraW5kZXg7XG4gICAgfSk7XG4gIH07XG5cbiAgU2V0UmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLmluc3RhbmNlTXV0YXRlZCA9IGZ1bmN0aW9uIGluc3RhbmNlTXV0YXRlZChyZXBlYXQsIHNldCwgcmVjb3Jkcykge1xuICAgIHZhciB2YWx1ZSA9IHZvaWQgMDtcbiAgICB2YXIgaSA9IHZvaWQgMDtcbiAgICB2YXIgaWkgPSB2b2lkIDA7XG4gICAgdmFyIG92ZXJyaWRlQ29udGV4dCA9IHZvaWQgMDtcbiAgICB2YXIgcmVtb3ZlSW5kZXggPSB2b2lkIDA7XG4gICAgdmFyIHJlY29yZCA9IHZvaWQgMDtcbiAgICB2YXIgcm1Qcm9taXNlcyA9IFtdO1xuICAgIHZhciB2aWV3T3JQcm9taXNlID0gdm9pZCAwO1xuXG4gICAgZm9yIChpID0gMCwgaWkgPSByZWNvcmRzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgIHJlY29yZCA9IHJlY29yZHNbaV07XG4gICAgICB2YWx1ZSA9IHJlY29yZC52YWx1ZTtcbiAgICAgIHN3aXRjaCAocmVjb3JkLnR5cGUpIHtcbiAgICAgICAgY2FzZSAnYWRkJzpcbiAgICAgICAgICBvdmVycmlkZUNvbnRleHQgPSAoMCwgX3JlcGVhdFV0aWxpdGllcy5jcmVhdGVGdWxsT3ZlcnJpZGVDb250ZXh0KShyZXBlYXQsIHZhbHVlLCBzZXQuc2l6ZSAtIDEsIHNldC5zaXplKTtcbiAgICAgICAgICByZXBlYXQuaW5zZXJ0VmlldyhzZXQuc2l6ZSAtIDEsIG92ZXJyaWRlQ29udGV4dC5iaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnZGVsZXRlJzpcbiAgICAgICAgICByZW1vdmVJbmRleCA9IHRoaXMuX2dldFZpZXdJbmRleEJ5VmFsdWUocmVwZWF0LCB2YWx1ZSk7XG4gICAgICAgICAgdmlld09yUHJvbWlzZSA9IHJlcGVhdC5yZW1vdmVWaWV3KHJlbW92ZUluZGV4LCB0cnVlLCAhcmVwZWF0LnZpZXdzUmVxdWlyZUxpZmVjeWNsZSk7XG4gICAgICAgICAgaWYgKHZpZXdPclByb21pc2UgaW5zdGFuY2VvZiBQcm9taXNlKSB7XG4gICAgICAgICAgICBybVByb21pc2VzLnB1c2godmlld09yUHJvbWlzZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdjbGVhcic6XG4gICAgICAgICAgcmVwZWF0LnJlbW92ZUFsbFZpZXdzKHRydWUsICFyZXBlYXQudmlld3NSZXF1aXJlTGlmZWN5Y2xlKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAocm1Qcm9taXNlcy5sZW5ndGggPiAwKSB7XG4gICAgICBQcm9taXNlLmFsbChybVByb21pc2VzKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgKDAsIF9yZXBlYXRVdGlsaXRpZXMudXBkYXRlT3ZlcnJpZGVDb250ZXh0cykocmVwZWF0LnZpZXdzKCksIDApO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICgwLCBfcmVwZWF0VXRpbGl0aWVzLnVwZGF0ZU92ZXJyaWRlQ29udGV4dHMpKHJlcGVhdC52aWV3cygpLCAwKTtcbiAgICB9XG4gIH07XG5cbiAgU2V0UmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLl9nZXRWaWV3SW5kZXhCeVZhbHVlID0gZnVuY3Rpb24gX2dldFZpZXdJbmRleEJ5VmFsdWUocmVwZWF0LCB2YWx1ZSkge1xuICAgIHZhciBpID0gdm9pZCAwO1xuICAgIHZhciBpaSA9IHZvaWQgMDtcbiAgICB2YXIgY2hpbGQgPSB2b2lkIDA7XG5cbiAgICBmb3IgKGkgPSAwLCBpaSA9IHJlcGVhdC52aWV3Q291bnQoKTsgaSA8IGlpOyArK2kpIHtcbiAgICAgIGNoaWxkID0gcmVwZWF0LnZpZXcoaSk7XG4gICAgICBpZiAoY2hpbGQuYmluZGluZ0NvbnRleHRbcmVwZWF0LmxvY2FsXSA9PT0gdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIGk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfTtcblxuICByZXR1cm4gU2V0UmVwZWF0U3RyYXRlZ3k7XG59KCk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9jb21tb25qcy9zZXQtcmVwZWF0LXN0cmF0ZWd5LmpzXG4vLyBtb2R1bGUgaWQgPSA2NVxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLkZldGNoQ29uZmlnID0gdW5kZWZpbmVkO1xuXG52YXIgX2RlYywgX2NsYXNzO1xuXG52YXIgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uID0gcmVxdWlyZSgnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbicpO1xuXG52YXIgX2F1cmVsaWFGZXRjaENsaWVudCA9IHJlcXVpcmUoJ2F1cmVsaWEtZmV0Y2gtY2xpZW50Jyk7XG5cbnZhciBfYXV0aGVudGljYXRpb24gPSByZXF1aXJlKCcuL2F1dGhlbnRpY2F0aW9uJyk7XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbnZhciBGZXRjaENvbmZpZyA9IGV4cG9ydHMuRmV0Y2hDb25maWcgPSAoX2RlYyA9ICgwLCBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24uaW5qZWN0KShfYXVyZWxpYUZldGNoQ2xpZW50Lkh0dHBDbGllbnQsIF9hdXRoZW50aWNhdGlvbi5BdXRoZW50aWNhdGlvbiksIF9kZWMoX2NsYXNzID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBGZXRjaENvbmZpZyhodHRwQ2xpZW50LCBhdXRoU2VydmljZSkge1xuICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBGZXRjaENvbmZpZyk7XG5cbiAgICB0aGlzLmh0dHBDbGllbnQgPSBodHRwQ2xpZW50O1xuICAgIHRoaXMuYXV0aCA9IGF1dGhTZXJ2aWNlO1xuICB9XG5cbiAgRmV0Y2hDb25maWcucHJvdG90eXBlLmNvbmZpZ3VyZSA9IGZ1bmN0aW9uIGNvbmZpZ3VyZSgpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgdGhpcy5odHRwQ2xpZW50LmNvbmZpZ3VyZShmdW5jdGlvbiAoaHR0cENvbmZpZykge1xuICAgICAgaHR0cENvbmZpZy53aXRoRGVmYXVsdHMoe1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICB9XG4gICAgICB9KS53aXRoSW50ZXJjZXB0b3IoX3RoaXMuYXV0aC50b2tlbkludGVyY2VwdG9yKTtcbiAgICB9KTtcbiAgfTtcblxuICByZXR1cm4gRmV0Y2hDb25maWc7XG59KCkpIHx8IF9jbGFzcyk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtYXV0aC9kaXN0L2NvbW1vbmpzL2F1dGgtZmV0Y2gtY29uZmlnLmpzXG4vLyBtb2R1bGUgaWQgPSA3MFxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLkF1dGhTZXJ2aWNlID0gdW5kZWZpbmVkO1xuXG52YXIgX3R5cGVvZiA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSBcInN5bWJvbFwiID8gZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfSA6IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgPyBcInN5bWJvbFwiIDogdHlwZW9mIG9iajsgfTtcblxudmFyIF9kZWMsIF9jbGFzcztcblxudmFyIF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbiA9IHJlcXVpcmUoJ2F1cmVsaWEtZGVwZW5kZW5jeS1pbmplY3Rpb24nKTtcblxudmFyIF9hdXJlbGlhRmV0Y2hDbGllbnQgPSByZXF1aXJlKCdhdXJlbGlhLWZldGNoLWNsaWVudCcpO1xuXG52YXIgX2F1cmVsaWFFdmVudEFnZ3JlZ2F0b3IgPSByZXF1aXJlKCdhdXJlbGlhLWV2ZW50LWFnZ3JlZ2F0b3InKTtcblxudmFyIF9hdXRoZW50aWNhdGlvbiA9IHJlcXVpcmUoJy4vYXV0aGVudGljYXRpb24nKTtcblxudmFyIF9iYXNlQ29uZmlnID0gcmVxdWlyZSgnLi9iYXNlLWNvbmZpZycpO1xuXG52YXIgX29BdXRoID0gcmVxdWlyZSgnLi9vQXV0aDEnKTtcblxudmFyIF9vQXV0aDIgPSByZXF1aXJlKCcuL29BdXRoMicpO1xuXG52YXIgX2F1dGhVdGlsaXRpZXMgPSByZXF1aXJlKCcuL2F1dGgtdXRpbGl0aWVzJyk7XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbnZhciBBdXRoU2VydmljZSA9IGV4cG9ydHMuQXV0aFNlcnZpY2UgPSAoX2RlYyA9ICgwLCBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24uaW5qZWN0KShfYXVyZWxpYUZldGNoQ2xpZW50Lkh0dHBDbGllbnQsIF9hdXRoZW50aWNhdGlvbi5BdXRoZW50aWNhdGlvbiwgX29BdXRoLk9BdXRoMSwgX29BdXRoMi5PQXV0aDIsIF9iYXNlQ29uZmlnLkJhc2VDb25maWcsIF9hdXJlbGlhRXZlbnRBZ2dyZWdhdG9yLkV2ZW50QWdncmVnYXRvciksIF9kZWMoX2NsYXNzID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBBdXRoU2VydmljZShodHRwLCBhdXRoLCBvQXV0aDEsIG9BdXRoMiwgY29uZmlnLCBldmVudEFnZ3JlZ2F0b3IpIHtcbiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQXV0aFNlcnZpY2UpO1xuXG4gICAgdGhpcy5odHRwID0gaHR0cDtcbiAgICB0aGlzLmF1dGggPSBhdXRoO1xuICAgIHRoaXMub0F1dGgxID0gb0F1dGgxO1xuICAgIHRoaXMub0F1dGgyID0gb0F1dGgyO1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnLmN1cnJlbnQ7XG4gICAgdGhpcy50b2tlbkludGVyY2VwdG9yID0gYXV0aC50b2tlbkludGVyY2VwdG9yO1xuICAgIHRoaXMuZXZlbnRBZ2dyZWdhdG9yID0gZXZlbnRBZ2dyZWdhdG9yO1xuICB9XG5cbiAgQXV0aFNlcnZpY2UucHJvdG90eXBlLmdldE1lID0gZnVuY3Rpb24gZ2V0TWUoKSB7XG4gICAgdmFyIHByb2ZpbGVVcmwgPSB0aGlzLmF1dGguZ2V0UHJvZmlsZVVybCgpO1xuICAgIHJldHVybiB0aGlzLmh0dHAuZmV0Y2gocHJvZmlsZVVybCkudGhlbihfYXV0aFV0aWxpdGllcy5zdGF0dXMpO1xuICB9O1xuXG4gIEF1dGhTZXJ2aWNlLnByb3RvdHlwZS5pc0F1dGhlbnRpY2F0ZWQgPSBmdW5jdGlvbiBpc0F1dGhlbnRpY2F0ZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuYXV0aC5pc0F1dGhlbnRpY2F0ZWQoKTtcbiAgfTtcblxuICBBdXRoU2VydmljZS5wcm90b3R5cGUuZ2V0VG9rZW5QYXlsb2FkID0gZnVuY3Rpb24gZ2V0VG9rZW5QYXlsb2FkKCkge1xuICAgIHJldHVybiB0aGlzLmF1dGguZ2V0UGF5bG9hZCgpO1xuICB9O1xuXG4gIEF1dGhTZXJ2aWNlLnByb3RvdHlwZS5zaWdudXAgPSBmdW5jdGlvbiBzaWdudXAoZGlzcGxheU5hbWUsIGVtYWlsLCBwYXNzd29yZCkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICB2YXIgc2lnbnVwVXJsID0gdGhpcy5hdXRoLmdldFNpZ251cFVybCgpO1xuICAgIHZhciBjb250ZW50ID0gdm9pZCAwO1xuICAgIGlmIChfdHlwZW9mKGFyZ3VtZW50c1swXSkgPT09ICdvYmplY3QnKSB7XG4gICAgICBjb250ZW50ID0gYXJndW1lbnRzWzBdO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb250ZW50ID0ge1xuICAgICAgICAnZGlzcGxheU5hbWUnOiBkaXNwbGF5TmFtZSxcbiAgICAgICAgJ2VtYWlsJzogZW1haWwsXG4gICAgICAgICdwYXNzd29yZCc6IHBhc3N3b3JkXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmh0dHAuZmV0Y2goc2lnbnVwVXJsLCB7XG4gICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgIGJvZHk6ICgwLCBfYXVyZWxpYUZldGNoQ2xpZW50Lmpzb24pKGNvbnRlbnQpXG4gICAgfSkudGhlbihfYXV0aFV0aWxpdGllcy5zdGF0dXMpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBpZiAoX3RoaXMuY29uZmlnLmxvZ2luT25TaWdudXApIHtcbiAgICAgICAgX3RoaXMuYXV0aC5zZXRUb2tlbihyZXNwb25zZSk7XG4gICAgICB9IGVsc2UgaWYgKF90aGlzLmNvbmZpZy5zaWdudXBSZWRpcmVjdCkge1xuICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IF90aGlzLmNvbmZpZy5zaWdudXBSZWRpcmVjdDtcbiAgICAgIH1cbiAgICAgIF90aGlzLmV2ZW50QWdncmVnYXRvci5wdWJsaXNoKCdhdXRoOnNpZ251cCcsIHJlc3BvbnNlKTtcbiAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9KTtcbiAgfTtcblxuICBBdXRoU2VydmljZS5wcm90b3R5cGUubG9naW4gPSBmdW5jdGlvbiBsb2dpbihlbWFpbCwgcGFzc3dvcmQpIHtcbiAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgIHZhciBsb2dpblVybCA9IHRoaXMuYXV0aC5nZXRMb2dpblVybCgpO1xuICAgIHZhciBjb250ZW50ID0gdm9pZCAwO1xuICAgIGlmICh0eXBlb2YgYXJndW1lbnRzWzFdICE9PSAnc3RyaW5nJykge1xuICAgICAgY29udGVudCA9IGFyZ3VtZW50c1swXTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29udGVudCA9IHtcbiAgICAgICAgJ2VtYWlsJzogZW1haWwsXG4gICAgICAgICdwYXNzd29yZCc6IHBhc3N3b3JkXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmh0dHAuZmV0Y2gobG9naW5VcmwsIHtcbiAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgaGVhZGVyczogdHlwZW9mIGNvbnRlbnQgPT09ICdzdHJpbmcnID8geyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcgfSA6IHt9LFxuICAgICAgYm9keTogdHlwZW9mIGNvbnRlbnQgPT09ICdzdHJpbmcnID8gY29udGVudCA6ICgwLCBfYXVyZWxpYUZldGNoQ2xpZW50Lmpzb24pKGNvbnRlbnQpXG4gICAgfSkudGhlbihfYXV0aFV0aWxpdGllcy5zdGF0dXMpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBfdGhpczIuYXV0aC5zZXRUb2tlbihyZXNwb25zZSk7XG4gICAgICBfdGhpczIuZXZlbnRBZ2dyZWdhdG9yLnB1Ymxpc2goJ2F1dGg6bG9naW4nLCByZXNwb25zZSk7XG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSk7XG4gIH07XG5cbiAgQXV0aFNlcnZpY2UucHJvdG90eXBlLmxvZ291dCA9IGZ1bmN0aW9uIGxvZ291dChyZWRpcmVjdFVyaSkge1xuICAgIHRoaXMuZXZlbnRBZ2dyZWdhdG9yLnB1Ymxpc2goJ2F1dGg6bG9nb3V0Jyk7XG4gICAgcmV0dXJuIHRoaXMuYXV0aC5sb2dvdXQocmVkaXJlY3RVcmkpO1xuICB9O1xuXG4gIEF1dGhTZXJ2aWNlLnByb3RvdHlwZS5hdXRoZW50aWNhdGUgPSBmdW5jdGlvbiBhdXRoZW50aWNhdGUobmFtZSwgcmVkaXJlY3QsIHVzZXJEYXRhKSB7XG4gICAgdmFyIF90aGlzMyA9IHRoaXM7XG5cbiAgICB2YXIgcHJvdmlkZXIgPSB0aGlzLm9BdXRoMjtcbiAgICBpZiAodGhpcy5jb25maWcucHJvdmlkZXJzW25hbWVdLnR5cGUgPT09ICcxLjAnKSB7XG4gICAgICBwcm92aWRlciA9IHRoaXMub0F1dGgxO1xuICAgIH1cblxuICAgIHJldHVybiBwcm92aWRlci5vcGVuKHRoaXMuY29uZmlnLnByb3ZpZGVyc1tuYW1lXSwgdXNlckRhdGEgfHwge30pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBfdGhpczMuYXV0aC5zZXRUb2tlbihyZXNwb25zZSwgcmVkaXJlY3QpO1xuICAgICAgX3RoaXMzLmV2ZW50QWdncmVnYXRvci5wdWJsaXNoKCdhdXRoOmF1dGhlbnRpY2F0ZScsIHJlc3BvbnNlKTtcbiAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9KTtcbiAgfTtcblxuICBBdXRoU2VydmljZS5wcm90b3R5cGUudW5saW5rID0gZnVuY3Rpb24gdW5saW5rKHByb3ZpZGVyKSB7XG4gICAgdmFyIF90aGlzNCA9IHRoaXM7XG5cbiAgICB2YXIgdW5saW5rVXJsID0gdGhpcy5jb25maWcuYmFzZVVybCA/ICgwLCBfYXV0aFV0aWxpdGllcy5qb2luVXJsKSh0aGlzLmNvbmZpZy5iYXNlVXJsLCB0aGlzLmNvbmZpZy51bmxpbmtVcmwpIDogdGhpcy5jb25maWcudW5saW5rVXJsO1xuXG4gICAgaWYgKHRoaXMuY29uZmlnLnVubGlua01ldGhvZCA9PT0gJ2dldCcpIHtcbiAgICAgIHJldHVybiB0aGlzLmh0dHAuZmV0Y2godW5saW5rVXJsICsgcHJvdmlkZXIpLnRoZW4oX2F1dGhVdGlsaXRpZXMuc3RhdHVzKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICBfdGhpczQuZXZlbnRBZ2dyZWdhdG9yLnB1Ymxpc2goJ2F1dGg6dW5saW5rJywgcmVzcG9uc2UpO1xuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuY29uZmlnLnVubGlua01ldGhvZCA9PT0gJ3Bvc3QnKSB7XG4gICAgICByZXR1cm4gdGhpcy5odHRwLmZldGNoKHVubGlua1VybCwge1xuICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgYm9keTogKDAsIF9hdXJlbGlhRmV0Y2hDbGllbnQuanNvbikocHJvdmlkZXIpXG4gICAgICB9KS50aGVuKF9hdXRoVXRpbGl0aWVzLnN0YXR1cykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgX3RoaXM0LmV2ZW50QWdncmVnYXRvci5wdWJsaXNoKCdhdXRoOnVubGluaycsIHJlc3BvbnNlKTtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBBdXRoU2VydmljZTtcbn0oKSkgfHwgX2NsYXNzKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS1hdXRoL2Rpc3QvY29tbW9uanMvYXV0aC1zZXJ2aWNlLmpzXG4vLyBtb2R1bGUgaWQgPSA3MVxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLkF1dGhvcml6ZVN0ZXAgPSB1bmRlZmluZWQ7XG5cbnZhciBfZGVjLCBfY2xhc3M7XG5cbnZhciBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24gPSByZXF1aXJlKCdhdXJlbGlhLWRlcGVuZGVuY3ktaW5qZWN0aW9uJyk7XG5cbnZhciBfYXVyZWxpYVJvdXRlciA9IHJlcXVpcmUoJ2F1cmVsaWEtcm91dGVyJyk7XG5cbnZhciBfYXV0aGVudGljYXRpb24gPSByZXF1aXJlKCcuL2F1dGhlbnRpY2F0aW9uJyk7XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbnZhciBBdXRob3JpemVTdGVwID0gZXhwb3J0cy5BdXRob3JpemVTdGVwID0gKF9kZWMgPSAoMCwgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uLmluamVjdCkoX2F1dGhlbnRpY2F0aW9uLkF1dGhlbnRpY2F0aW9uKSwgX2RlYyhfY2xhc3MgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEF1dGhvcml6ZVN0ZXAoYXV0aCkge1xuICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBBdXRob3JpemVTdGVwKTtcblxuICAgIHRoaXMuYXV0aCA9IGF1dGg7XG4gIH1cblxuICBBdXRob3JpemVTdGVwLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiBydW4ocm91dGluZ0NvbnRleHQsIG5leHQpIHtcbiAgICB2YXIgaXNMb2dnZWRJbiA9IHRoaXMuYXV0aC5pc0F1dGhlbnRpY2F0ZWQoKTtcbiAgICB2YXIgbG9naW5Sb3V0ZSA9IHRoaXMuYXV0aC5nZXRMb2dpblJvdXRlKCk7XG5cbiAgICBpZiAocm91dGluZ0NvbnRleHQuZ2V0QWxsSW5zdHJ1Y3Rpb25zKCkuc29tZShmdW5jdGlvbiAoaSkge1xuICAgICAgcmV0dXJuIGkuY29uZmlnLmF1dGg7XG4gICAgfSkpIHtcbiAgICAgIGlmICghaXNMb2dnZWRJbikge1xuICAgICAgICB0aGlzLmF1dGguc2V0SW5pdGlhbFVybCh3aW5kb3cubG9jYXRpb24uaHJlZik7XG4gICAgICAgIHJldHVybiBuZXh0LmNhbmNlbChuZXcgX2F1cmVsaWFSb3V0ZXIuUmVkaXJlY3QobG9naW5Sb3V0ZSkpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoaXNMb2dnZWRJbiAmJiByb3V0aW5nQ29udGV4dC5nZXRBbGxJbnN0cnVjdGlvbnMoKS5zb21lKGZ1bmN0aW9uIChpKSB7XG4gICAgICByZXR1cm4gaS5mcmFnbWVudCA9PT0gbG9naW5Sb3V0ZTtcbiAgICB9KSkge1xuICAgICAgdmFyIGxvZ2luUmVkaXJlY3QgPSB0aGlzLmF1dGguZ2V0TG9naW5SZWRpcmVjdCgpO1xuICAgICAgcmV0dXJuIG5leHQuY2FuY2VsKG5ldyBfYXVyZWxpYVJvdXRlci5SZWRpcmVjdChsb2dpblJlZGlyZWN0KSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5leHQoKTtcbiAgfTtcblxuICByZXR1cm4gQXV0aG9yaXplU3RlcDtcbn0oKSkgfHwgX2NsYXNzKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS1hdXRoL2Rpc3QvY29tbW9uanMvYXV0aG9yaXplLXN0ZXAuanNcbi8vIG1vZHVsZSBpZCA9IDcyXG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuT0F1dGgxID0gdW5kZWZpbmVkO1xuXG52YXIgX2RlYywgX2NsYXNzO1xuXG52YXIgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uID0gcmVxdWlyZSgnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbicpO1xuXG52YXIgX2F1dGhVdGlsaXRpZXMgPSByZXF1aXJlKCcuL2F1dGgtdXRpbGl0aWVzJyk7XG5cbnZhciBfc3RvcmFnZSA9IHJlcXVpcmUoJy4vc3RvcmFnZScpO1xuXG52YXIgX3BvcHVwID0gcmVxdWlyZSgnLi9wb3B1cCcpO1xuXG52YXIgX2Jhc2VDb25maWcgPSByZXF1aXJlKCcuL2Jhc2UtY29uZmlnJyk7XG5cbnZhciBfYXVyZWxpYUZldGNoQ2xpZW50ID0gcmVxdWlyZSgnYXVyZWxpYS1mZXRjaC1jbGllbnQnKTtcblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxudmFyIE9BdXRoMSA9IGV4cG9ydHMuT0F1dGgxID0gKF9kZWMgPSAoMCwgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uLmluamVjdCkoX3N0b3JhZ2UuU3RvcmFnZSwgX3BvcHVwLlBvcHVwLCBfYXVyZWxpYUZldGNoQ2xpZW50Lkh0dHBDbGllbnQsIF9iYXNlQ29uZmlnLkJhc2VDb25maWcpLCBfZGVjKF9jbGFzcyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gT0F1dGgxKHN0b3JhZ2UsIHBvcHVwLCBodHRwLCBjb25maWcpIHtcbiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgT0F1dGgxKTtcblxuICAgIHRoaXMuc3RvcmFnZSA9IHN0b3JhZ2U7XG4gICAgdGhpcy5jb25maWcgPSBjb25maWcuY3VycmVudDtcbiAgICB0aGlzLnBvcHVwID0gcG9wdXA7XG4gICAgdGhpcy5odHRwID0gaHR0cDtcbiAgICB0aGlzLmRlZmF1bHRzID0ge1xuICAgICAgdXJsOiBudWxsLFxuICAgICAgbmFtZTogbnVsbCxcbiAgICAgIHBvcHVwT3B0aW9uczogbnVsbCxcbiAgICAgIHJlZGlyZWN0VXJpOiBudWxsLFxuICAgICAgYXV0aG9yaXphdGlvbkVuZHBvaW50OiBudWxsXG4gICAgfTtcbiAgfVxuXG4gIE9BdXRoMS5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uIG9wZW4ob3B0aW9ucywgdXNlckRhdGEpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgdmFyIGN1cnJlbnQgPSAoMCwgX2F1dGhVdGlsaXRpZXMuZXh0ZW5kKSh7fSwgdGhpcy5kZWZhdWx0cywgb3B0aW9ucyk7XG4gICAgdmFyIHNlcnZlclVybCA9IHRoaXMuY29uZmlnLmJhc2VVcmwgPyAoMCwgX2F1dGhVdGlsaXRpZXMuam9pblVybCkodGhpcy5jb25maWcuYmFzZVVybCwgY3VycmVudC51cmwpIDogY3VycmVudC51cmw7XG5cbiAgICBpZiAodGhpcy5jb25maWcucGxhdGZvcm0gIT09ICdtb2JpbGUnKSB7XG4gICAgICB0aGlzLnBvcHVwID0gdGhpcy5wb3B1cC5vcGVuKCcnLCBjdXJyZW50Lm5hbWUsIGN1cnJlbnQucG9wdXBPcHRpb25zLCBjdXJyZW50LnJlZGlyZWN0VXJpKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5mZXRjaChzZXJ2ZXJVcmwsIHtcbiAgICAgIG1ldGhvZDogJ3Bvc3QnXG4gICAgfSkudGhlbihfYXV0aFV0aWxpdGllcy5zdGF0dXMpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBpZiAoX3RoaXMuY29uZmlnLnBsYXRmb3JtID09PSAnbW9iaWxlJykge1xuICAgICAgICBfdGhpcy5wb3B1cCA9IF90aGlzLnBvcHVwLm9wZW4oW2N1cnJlbnQuYXV0aG9yaXphdGlvbkVuZHBvaW50LCBfdGhpcy5idWlsZFF1ZXJ5U3RyaW5nKHJlc3BvbnNlKV0uam9pbignPycpLCBjdXJyZW50Lm5hbWUsIGN1cnJlbnQucG9wdXBPcHRpb25zLCBjdXJyZW50LnJlZGlyZWN0VXJpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF90aGlzLnBvcHVwLnBvcHVwV2luZG93LmxvY2F0aW9uID0gW2N1cnJlbnQuYXV0aG9yaXphdGlvbkVuZHBvaW50LCBfdGhpcy5idWlsZFF1ZXJ5U3RyaW5nKHJlc3BvbnNlKV0uam9pbignPycpO1xuICAgICAgfVxuXG4gICAgICB2YXIgcG9wdXBMaXN0ZW5lciA9IF90aGlzLmNvbmZpZy5wbGF0Zm9ybSA9PT0gJ21vYmlsZScgPyBfdGhpcy5wb3B1cC5ldmVudExpc3RlbmVyKGN1cnJlbnQucmVkaXJlY3RVcmkpIDogX3RoaXMucG9wdXAucG9sbFBvcHVwKCk7XG4gICAgICByZXR1cm4gcG9wdXBMaXN0ZW5lci50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzLmV4Y2hhbmdlRm9yVG9rZW4ocmVzdWx0LCB1c2VyRGF0YSwgY3VycmVudCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcblxuICBPQXV0aDEucHJvdG90eXBlLmV4Y2hhbmdlRm9yVG9rZW4gPSBmdW5jdGlvbiBleGNoYW5nZUZvclRva2VuKG9hdXRoRGF0YSwgdXNlckRhdGEsIGN1cnJlbnQpIHtcbiAgICB2YXIgZGF0YSA9ICgwLCBfYXV0aFV0aWxpdGllcy5leHRlbmQpKHt9LCB1c2VyRGF0YSwgb2F1dGhEYXRhKTtcbiAgICB2YXIgZXhjaGFuZ2VGb3JUb2tlblVybCA9IHRoaXMuY29uZmlnLmJhc2VVcmwgPyAoMCwgX2F1dGhVdGlsaXRpZXMuam9pblVybCkodGhpcy5jb25maWcuYmFzZVVybCwgY3VycmVudC51cmwpIDogY3VycmVudC51cmw7XG4gICAgdmFyIGNyZWRlbnRpYWxzID0gdGhpcy5jb25maWcud2l0aENyZWRlbnRpYWxzID8gJ2luY2x1ZGUnIDogJ3NhbWUtb3JpZ2luJztcblxuICAgIHJldHVybiB0aGlzLmh0dHAuZmV0Y2goZXhjaGFuZ2VGb3JUb2tlblVybCwge1xuICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICBib2R5OiAoMCwgX2F1cmVsaWFGZXRjaENsaWVudC5qc29uKShkYXRhKSxcbiAgICAgIGNyZWRlbnRpYWxzOiBjcmVkZW50aWFsc1xuICAgIH0pLnRoZW4oX2F1dGhVdGlsaXRpZXMuc3RhdHVzKTtcbiAgfTtcblxuICBPQXV0aDEucHJvdG90eXBlLmJ1aWxkUXVlcnlTdHJpbmcgPSBmdW5jdGlvbiBidWlsZFF1ZXJ5U3RyaW5nKG9iaikge1xuICAgIHZhciBzdHIgPSBbXTtcbiAgICAoMCwgX2F1dGhVdGlsaXRpZXMuZm9yRWFjaCkob2JqLCBmdW5jdGlvbiAodmFsdWUsIGtleSkge1xuICAgICAgcmV0dXJuIHN0ci5wdXNoKGVuY29kZVVSSUNvbXBvbmVudChrZXkpICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHN0ci5qb2luKCcmJyk7XG4gIH07XG5cbiAgcmV0dXJuIE9BdXRoMTtcbn0oKSkgfHwgX2NsYXNzKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS1hdXRoL2Rpc3QvY29tbW9uanMvb0F1dGgxLmpzXG4vLyBtb2R1bGUgaWQgPSA3M1xuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLk9BdXRoMiA9IHVuZGVmaW5lZDtcblxudmFyIF9kZWMsIF9jbGFzcztcblxudmFyIF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbiA9IHJlcXVpcmUoJ2F1cmVsaWEtZGVwZW5kZW5jeS1pbmplY3Rpb24nKTtcblxudmFyIF9hdXRoVXRpbGl0aWVzID0gcmVxdWlyZSgnLi9hdXRoLXV0aWxpdGllcycpO1xuXG52YXIgX3N0b3JhZ2UgPSByZXF1aXJlKCcuL3N0b3JhZ2UnKTtcblxudmFyIF9wb3B1cCA9IHJlcXVpcmUoJy4vcG9wdXAnKTtcblxudmFyIF9iYXNlQ29uZmlnID0gcmVxdWlyZSgnLi9iYXNlLWNvbmZpZycpO1xuXG52YXIgX2F1dGhlbnRpY2F0aW9uID0gcmVxdWlyZSgnLi9hdXRoZW50aWNhdGlvbicpO1xuXG52YXIgX2F1cmVsaWFGZXRjaENsaWVudCA9IHJlcXVpcmUoJ2F1cmVsaWEtZmV0Y2gtY2xpZW50Jyk7XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbnZhciBPQXV0aDIgPSBleHBvcnRzLk9BdXRoMiA9IChfZGVjID0gKDAsIF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbi5pbmplY3QpKF9zdG9yYWdlLlN0b3JhZ2UsIF9wb3B1cC5Qb3B1cCwgX2F1cmVsaWFGZXRjaENsaWVudC5IdHRwQ2xpZW50LCBfYmFzZUNvbmZpZy5CYXNlQ29uZmlnLCBfYXV0aGVudGljYXRpb24uQXV0aGVudGljYXRpb24pLCBfZGVjKF9jbGFzcyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gT0F1dGgyKHN0b3JhZ2UsIHBvcHVwLCBodHRwLCBjb25maWcsIGF1dGgpIHtcbiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgT0F1dGgyKTtcblxuICAgIHRoaXMuc3RvcmFnZSA9IHN0b3JhZ2U7XG4gICAgdGhpcy5jb25maWcgPSBjb25maWcuY3VycmVudDtcbiAgICB0aGlzLnBvcHVwID0gcG9wdXA7XG4gICAgdGhpcy5odHRwID0gaHR0cDtcbiAgICB0aGlzLmF1dGggPSBhdXRoO1xuICAgIHRoaXMuZGVmYXVsdHMgPSB7XG4gICAgICB1cmw6IG51bGwsXG4gICAgICBuYW1lOiBudWxsLFxuICAgICAgc3RhdGU6IG51bGwsXG4gICAgICBzY29wZTogbnVsbCxcbiAgICAgIHNjb3BlRGVsaW1pdGVyOiBudWxsLFxuICAgICAgcmVkaXJlY3RVcmk6IG51bGwsXG4gICAgICBwb3B1cE9wdGlvbnM6IG51bGwsXG4gICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6IG51bGwsXG4gICAgICByZXNwb25zZVBhcmFtczogbnVsbCxcbiAgICAgIHJlcXVpcmVkVXJsUGFyYW1zOiBudWxsLFxuICAgICAgb3B0aW9uYWxVcmxQYXJhbXM6IG51bGwsXG4gICAgICBkZWZhdWx0VXJsUGFyYW1zOiBbJ3Jlc3BvbnNlX3R5cGUnLCAnY2xpZW50X2lkJywgJ3JlZGlyZWN0X3VyaSddLFxuICAgICAgcmVzcG9uc2VUeXBlOiAnY29kZSdcbiAgICB9O1xuICB9XG5cbiAgT0F1dGgyLnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24gb3BlbihvcHRpb25zLCB1c2VyRGF0YSkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICB2YXIgY3VycmVudCA9ICgwLCBfYXV0aFV0aWxpdGllcy5leHRlbmQpKHt9LCB0aGlzLmRlZmF1bHRzLCBvcHRpb25zKTtcblxuICAgIHZhciBzdGF0ZU5hbWUgPSBjdXJyZW50Lm5hbWUgKyAnX3N0YXRlJztcblxuICAgIGlmICgoMCwgX2F1dGhVdGlsaXRpZXMuaXNGdW5jdGlvbikoY3VycmVudC5zdGF0ZSkpIHtcbiAgICAgIHRoaXMuc3RvcmFnZS5zZXQoc3RhdGVOYW1lLCBjdXJyZW50LnN0YXRlKCkpO1xuICAgIH0gZWxzZSBpZiAoKDAsIF9hdXRoVXRpbGl0aWVzLmlzU3RyaW5nKShjdXJyZW50LnN0YXRlKSkge1xuICAgICAgdGhpcy5zdG9yYWdlLnNldChzdGF0ZU5hbWUsIGN1cnJlbnQuc3RhdGUpO1xuICAgIH1cblxuICAgIHZhciBub25jZU5hbWUgPSBjdXJyZW50Lm5hbWUgKyAnX25vbmNlJztcblxuICAgIGlmICgoMCwgX2F1dGhVdGlsaXRpZXMuaXNGdW5jdGlvbikoY3VycmVudC5ub25jZSkpIHtcbiAgICAgIHRoaXMuc3RvcmFnZS5zZXQobm9uY2VOYW1lLCBjdXJyZW50Lm5vbmNlKCkpO1xuICAgIH0gZWxzZSBpZiAoKDAsIF9hdXRoVXRpbGl0aWVzLmlzU3RyaW5nKShjdXJyZW50Lm5vbmNlKSkge1xuICAgICAgdGhpcy5zdG9yYWdlLnNldChub25jZU5hbWUsIGN1cnJlbnQubm9uY2UpO1xuICAgIH1cblxuICAgIHZhciB1cmwgPSBjdXJyZW50LmF1dGhvcml6YXRpb25FbmRwb2ludCArICc/JyArIHRoaXMuYnVpbGRRdWVyeVN0cmluZyhjdXJyZW50KTtcblxuICAgIHZhciBvcGVuUG9wdXAgPSB2b2lkIDA7XG4gICAgaWYgKHRoaXMuY29uZmlnLnBsYXRmb3JtID09PSAnbW9iaWxlJykge1xuICAgICAgb3BlblBvcHVwID0gdGhpcy5wb3B1cC5vcGVuKHVybCwgY3VycmVudC5uYW1lLCBjdXJyZW50LnBvcHVwT3B0aW9ucywgY3VycmVudC5yZWRpcmVjdFVyaSkuZXZlbnRMaXN0ZW5lcihjdXJyZW50LnJlZGlyZWN0VXJpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgb3BlblBvcHVwID0gdGhpcy5wb3B1cC5vcGVuKHVybCwgY3VycmVudC5uYW1lLCBjdXJyZW50LnBvcHVwT3B0aW9ucywgY3VycmVudC5yZWRpcmVjdFVyaSkucG9sbFBvcHVwKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG9wZW5Qb3B1cC50aGVuKGZ1bmN0aW9uIChvYXV0aERhdGEpIHtcbiAgICAgIGlmIChvYXV0aERhdGEuc3RhdGUgJiYgb2F1dGhEYXRhLnN0YXRlICE9PSBfdGhpcy5zdG9yYWdlLmdldChzdGF0ZU5hbWUpKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgnT0F1dGggMi4wIHN0YXRlIHBhcmFtZXRlciBtaXNtYXRjaC4nKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGN1cnJlbnQucmVzcG9uc2VUeXBlLnRvVXBwZXJDYXNlKCkuaW5jbHVkZXMoJ1RPS0VOJykpIHtcbiAgICAgICAgaWYgKCFfdGhpcy52ZXJpZnlJZFRva2VuKG9hdXRoRGF0YSwgY3VycmVudC5uYW1lKSkge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgnT0F1dGggMi4wIE5vbmNlIHBhcmFtZXRlciBtaXNtYXRjaC4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBvYXV0aERhdGE7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBfdGhpcy5leGNoYW5nZUZvclRva2VuKG9hdXRoRGF0YSwgdXNlckRhdGEsIGN1cnJlbnQpO1xuICAgIH0pO1xuICB9O1xuXG4gIE9BdXRoMi5wcm90b3R5cGUudmVyaWZ5SWRUb2tlbiA9IGZ1bmN0aW9uIHZlcmlmeUlkVG9rZW4ob2F1dGhEYXRhLCBwcm92aWRlck5hbWUpIHtcbiAgICB2YXIgaWRUb2tlbiA9IG9hdXRoRGF0YSAmJiBvYXV0aERhdGFbdGhpcy5jb25maWcucmVzcG9uc2VJZFRva2VuUHJvcF07XG4gICAgaWYgKCFpZFRva2VuKSByZXR1cm4gdHJ1ZTtcbiAgICB2YXIgaWRUb2tlbk9iamVjdCA9IHRoaXMuYXV0aC5kZWNvbXBvc2VUb2tlbihpZFRva2VuKTtcbiAgICBpZiAoIWlkVG9rZW5PYmplY3QpIHJldHVybiB0cnVlO1xuICAgIHZhciBub25jZUZyb21Ub2tlbiA9IGlkVG9rZW5PYmplY3Qubm9uY2U7XG4gICAgaWYgKCFub25jZUZyb21Ub2tlbikgcmV0dXJuIHRydWU7XG4gICAgdmFyIG5vbmNlSW5TdG9yYWdlID0gdGhpcy5zdG9yYWdlLmdldChwcm92aWRlck5hbWUgKyAnX25vbmNlJyk7XG4gICAgaWYgKG5vbmNlRnJvbVRva2VuICE9PSBub25jZUluU3RvcmFnZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfTtcblxuICBPQXV0aDIucHJvdG90eXBlLmV4Y2hhbmdlRm9yVG9rZW4gPSBmdW5jdGlvbiBleGNoYW5nZUZvclRva2VuKG9hdXRoRGF0YSwgdXNlckRhdGEsIGN1cnJlbnQpIHtcbiAgICB2YXIgZGF0YSA9ICgwLCBfYXV0aFV0aWxpdGllcy5leHRlbmQpKHt9LCB1c2VyRGF0YSwge1xuICAgICAgY29kZTogb2F1dGhEYXRhLmNvZGUsXG4gICAgICBjbGllbnRJZDogY3VycmVudC5jbGllbnRJZCxcbiAgICAgIHJlZGlyZWN0VXJpOiBjdXJyZW50LnJlZGlyZWN0VXJpXG4gICAgfSk7XG5cbiAgICBpZiAob2F1dGhEYXRhLnN0YXRlKSB7XG4gICAgICBkYXRhLnN0YXRlID0gb2F1dGhEYXRhLnN0YXRlO1xuICAgIH1cblxuICAgICgwLCBfYXV0aFV0aWxpdGllcy5mb3JFYWNoKShjdXJyZW50LnJlc3BvbnNlUGFyYW1zLCBmdW5jdGlvbiAocGFyYW0pIHtcbiAgICAgIHJldHVybiBkYXRhW3BhcmFtXSA9IG9hdXRoRGF0YVtwYXJhbV07XG4gICAgfSk7XG5cbiAgICB2YXIgZXhjaGFuZ2VGb3JUb2tlblVybCA9IHRoaXMuY29uZmlnLmJhc2VVcmwgPyAoMCwgX2F1dGhVdGlsaXRpZXMuam9pblVybCkodGhpcy5jb25maWcuYmFzZVVybCwgY3VycmVudC51cmwpIDogY3VycmVudC51cmw7XG4gICAgdmFyIGNyZWRlbnRpYWxzID0gdGhpcy5jb25maWcud2l0aENyZWRlbnRpYWxzID8gJ2luY2x1ZGUnIDogJ3NhbWUtb3JpZ2luJztcblxuICAgIHJldHVybiB0aGlzLmh0dHAuZmV0Y2goZXhjaGFuZ2VGb3JUb2tlblVybCwge1xuICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICBib2R5OiAoMCwgX2F1cmVsaWFGZXRjaENsaWVudC5qc29uKShkYXRhKSxcbiAgICAgIGNyZWRlbnRpYWxzOiBjcmVkZW50aWFsc1xuICAgIH0pLnRoZW4oX2F1dGhVdGlsaXRpZXMuc3RhdHVzKTtcbiAgfTtcblxuICBPQXV0aDIucHJvdG90eXBlLmJ1aWxkUXVlcnlTdHJpbmcgPSBmdW5jdGlvbiBidWlsZFF1ZXJ5U3RyaW5nKGN1cnJlbnQpIHtcbiAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgIHZhciBrZXlWYWx1ZVBhaXJzID0gW107XG4gICAgdmFyIHVybFBhcmFtcyA9IFsnZGVmYXVsdFVybFBhcmFtcycsICdyZXF1aXJlZFVybFBhcmFtcycsICdvcHRpb25hbFVybFBhcmFtcyddO1xuXG4gICAgKDAsIF9hdXRoVXRpbGl0aWVzLmZvckVhY2gpKHVybFBhcmFtcywgZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgKDAsIF9hdXRoVXRpbGl0aWVzLmZvckVhY2gpKGN1cnJlbnRbcGFyYW1zXSwgZnVuY3Rpb24gKHBhcmFtTmFtZSkge1xuICAgICAgICB2YXIgY2FtZWxpemVkTmFtZSA9ICgwLCBfYXV0aFV0aWxpdGllcy5jYW1lbENhc2UpKHBhcmFtTmFtZSk7XG4gICAgICAgIHZhciBwYXJhbVZhbHVlID0gKDAsIF9hdXRoVXRpbGl0aWVzLmlzRnVuY3Rpb24pKGN1cnJlbnRbcGFyYW1OYW1lXSkgPyBjdXJyZW50W3BhcmFtTmFtZV0oKSA6IGN1cnJlbnRbY2FtZWxpemVkTmFtZV07XG5cbiAgICAgICAgaWYgKHBhcmFtTmFtZSA9PT0gJ3N0YXRlJykge1xuICAgICAgICAgIHZhciBzdGF0ZU5hbWUgPSBjdXJyZW50Lm5hbWUgKyAnX3N0YXRlJztcbiAgICAgICAgICBwYXJhbVZhbHVlID0gZW5jb2RlVVJJQ29tcG9uZW50KF90aGlzMi5zdG9yYWdlLmdldChzdGF0ZU5hbWUpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwYXJhbU5hbWUgPT09ICdub25jZScpIHtcbiAgICAgICAgICB2YXIgbm9uY2VOYW1lID0gY3VycmVudC5uYW1lICsgJ19ub25jZSc7XG4gICAgICAgICAgcGFyYW1WYWx1ZSA9IGVuY29kZVVSSUNvbXBvbmVudChfdGhpczIuc3RvcmFnZS5nZXQobm9uY2VOYW1lKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocGFyYW1OYW1lID09PSAnc2NvcGUnICYmIEFycmF5LmlzQXJyYXkocGFyYW1WYWx1ZSkpIHtcbiAgICAgICAgICBwYXJhbVZhbHVlID0gcGFyYW1WYWx1ZS5qb2luKGN1cnJlbnQuc2NvcGVEZWxpbWl0ZXIpO1xuXG4gICAgICAgICAgaWYgKGN1cnJlbnQuc2NvcGVQcmVmaXgpIHtcbiAgICAgICAgICAgIHBhcmFtVmFsdWUgPSBbY3VycmVudC5zY29wZVByZWZpeCwgcGFyYW1WYWx1ZV0uam9pbihjdXJyZW50LnNjb3BlRGVsaW1pdGVyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBrZXlWYWx1ZVBhaXJzLnB1c2goW3BhcmFtTmFtZSwgcGFyYW1WYWx1ZV0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4ga2V5VmFsdWVQYWlycy5tYXAoZnVuY3Rpb24gKHBhaXIpIHtcbiAgICAgIHJldHVybiBwYWlyLmpvaW4oJz0nKTtcbiAgICB9KS5qb2luKCcmJyk7XG4gIH07XG5cbiAgcmV0dXJuIE9BdXRoMjtcbn0oKSkgfHwgX2NsYXNzKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS1hdXRoL2Rpc3QvY29tbW9uanMvb0F1dGgyLmpzXG4vLyBtb2R1bGUgaWQgPSA3NFxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLl9jcmVhdGVDU1NSZXNvdXJjZSA9IF9jcmVhdGVDU1NSZXNvdXJjZTtcblxudmFyIF9hdXJlbGlhVGVtcGxhdGluZyA9IHJlcXVpcmUoJ2F1cmVsaWEtdGVtcGxhdGluZycpO1xuXG52YXIgX2F1cmVsaWFMb2FkZXIgPSByZXF1aXJlKCdhdXJlbGlhLWxvYWRlcicpO1xuXG52YXIgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uID0gcmVxdWlyZSgnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbicpO1xuXG52YXIgX2F1cmVsaWFQYXRoID0gcmVxdWlyZSgnYXVyZWxpYS1wYXRoJyk7XG5cbnZhciBfYXVyZWxpYVBhbCA9IHJlcXVpcmUoJ2F1cmVsaWEtcGFsJyk7XG5cbmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKCFzZWxmKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcihcInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZFwiKTsgfSByZXR1cm4gY2FsbCAmJiAodHlwZW9mIGNhbGwgPT09IFwib2JqZWN0XCIgfHwgdHlwZW9mIGNhbGwgPT09IFwiZnVuY3Rpb25cIikgPyBjYWxsIDogc2VsZjsgfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSBcImZ1bmN0aW9uXCIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCBcIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH1cblxuXG5cbnZhciBjc3NVcmxNYXRjaGVyID0gL3VybFxcKCg/IVsnXCJdZGF0YSkoW14pXSspXFwpL2dpO1xuXG5mdW5jdGlvbiBmaXh1cENTU1VybHMoYWRkcmVzcywgY3NzKSB7XG4gIGlmICh0eXBlb2YgY3NzICE9PSAnc3RyaW5nJykge1xuICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIGxvYWRpbmcgcmVxdWlyZWQgQ1NTIGZpbGU6ICcgKyBhZGRyZXNzKTtcbiAgfVxuICByZXR1cm4gY3NzLnJlcGxhY2UoY3NzVXJsTWF0Y2hlciwgZnVuY3Rpb24gKG1hdGNoLCBwMSkge1xuICAgIHZhciBxdW90ZSA9IHAxLmNoYXJBdCgwKTtcbiAgICBpZiAocXVvdGUgPT09ICdcXCcnIHx8IHF1b3RlID09PSAnXCInKSB7XG4gICAgICBwMSA9IHAxLnN1YnN0cigxLCBwMS5sZW5ndGggLSAyKTtcbiAgICB9XG4gICAgcmV0dXJuICd1cmwoXFwnJyArICgwLCBfYXVyZWxpYVBhdGgucmVsYXRpdmVUb0ZpbGUpKHAxLCBhZGRyZXNzKSArICdcXCcpJztcbiAgfSk7XG59XG5cbnZhciBDU1NSZXNvdXJjZSA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQ1NTUmVzb3VyY2UoYWRkcmVzcykge1xuICAgIFxuXG4gICAgdGhpcy5hZGRyZXNzID0gYWRkcmVzcztcbiAgICB0aGlzLl9nbG9iYWwgPSBudWxsO1xuICAgIHRoaXMuX3Njb3BlZCA9IG51bGw7XG4gIH1cblxuICBDU1NSZXNvdXJjZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIGluaXRpYWxpemUoY29udGFpbmVyLCB0YXJnZXQpIHtcbiAgICB0aGlzLl9nbG9iYWwgPSBuZXcgdGFyZ2V0KCdnbG9iYWwnKTtcbiAgICB0aGlzLl9zY29wZWQgPSBuZXcgdGFyZ2V0KCdzY29wZWQnKTtcbiAgfTtcblxuICBDU1NSZXNvdXJjZS5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiByZWdpc3RlcihyZWdpc3RyeSwgbmFtZSkge1xuICAgIHJlZ2lzdHJ5LnJlZ2lzdGVyVmlld0VuZ2luZUhvb2tzKG5hbWUgPT09ICdzY29wZWQnID8gdGhpcy5fc2NvcGVkIDogdGhpcy5fZ2xvYmFsKTtcbiAgfTtcblxuICBDU1NSZXNvdXJjZS5wcm90b3R5cGUubG9hZCA9IGZ1bmN0aW9uIGxvYWQoY29udGFpbmVyKSB7XG4gICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgIHJldHVybiBjb250YWluZXIuZ2V0KF9hdXJlbGlhTG9hZGVyLkxvYWRlcikubG9hZFRleHQodGhpcy5hZGRyZXNzKS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9KS50aGVuKGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgICB0ZXh0ID0gZml4dXBDU1NVcmxzKF90aGlzLmFkZHJlc3MsIHRleHQpO1xuICAgICAgX3RoaXMuX2dsb2JhbC5jc3MgPSB0ZXh0O1xuICAgICAgX3RoaXMuX3Njb3BlZC5jc3MgPSB0ZXh0O1xuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiBDU1NSZXNvdXJjZTtcbn0oKTtcblxudmFyIENTU1ZpZXdFbmdpbmVIb29rcyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQ1NTVmlld0VuZ2luZUhvb2tzKG1vZGUpIHtcbiAgICBcblxuICAgIHRoaXMubW9kZSA9IG1vZGU7XG4gICAgdGhpcy5jc3MgPSBudWxsO1xuICAgIHRoaXMuX2FscmVhZHlHbG9iYWxseUluamVjdGVkID0gZmFsc2U7XG4gIH1cblxuICBDU1NWaWV3RW5naW5lSG9va3MucHJvdG90eXBlLmJlZm9yZUNvbXBpbGUgPSBmdW5jdGlvbiBiZWZvcmVDb21waWxlKGNvbnRlbnQsIHJlc291cmNlcywgaW5zdHJ1Y3Rpb24pIHtcbiAgICBpZiAodGhpcy5tb2RlID09PSAnc2NvcGVkJykge1xuICAgICAgaWYgKGluc3RydWN0aW9uLnRhcmdldFNoYWRvd0RPTSkge1xuICAgICAgICBfYXVyZWxpYVBhbC5ET00uaW5qZWN0U3R5bGVzKHRoaXMuY3NzLCBjb250ZW50LCB0cnVlKTtcbiAgICAgIH0gZWxzZSBpZiAoX2F1cmVsaWFQYWwuRkVBVFVSRS5zY29wZWRDU1MpIHtcbiAgICAgICAgdmFyIHN0eWxlTm9kZSA9IF9hdXJlbGlhUGFsLkRPTS5pbmplY3RTdHlsZXModGhpcy5jc3MsIGNvbnRlbnQsIHRydWUpO1xuICAgICAgICBzdHlsZU5vZGUuc2V0QXR0cmlidXRlKCdzY29wZWQnLCAnc2NvcGVkJyk7XG4gICAgICB9IGVsc2UgaWYgKCF0aGlzLl9hbHJlYWR5R2xvYmFsbHlJbmplY3RlZCkge1xuICAgICAgICBfYXVyZWxpYVBhbC5ET00uaW5qZWN0U3R5bGVzKHRoaXMuY3NzKTtcbiAgICAgICAgdGhpcy5fYWxyZWFkeUdsb2JhbGx5SW5qZWN0ZWQgPSB0cnVlO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoIXRoaXMuX2FscmVhZHlHbG9iYWxseUluamVjdGVkKSB7XG4gICAgICBfYXVyZWxpYVBhbC5ET00uaW5qZWN0U3R5bGVzKHRoaXMuY3NzKTtcbiAgICAgIHRoaXMuX2FscmVhZHlHbG9iYWxseUluamVjdGVkID0gdHJ1ZTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIENTU1ZpZXdFbmdpbmVIb29rcztcbn0oKTtcblxuZnVuY3Rpb24gX2NyZWF0ZUNTU1Jlc291cmNlKGFkZHJlc3MpIHtcbiAgdmFyIF9kZWMsIF9jbGFzcztcblxuICB2YXIgVmlld0NTUyA9IChfZGVjID0gKDAsIF9hdXJlbGlhVGVtcGxhdGluZy5yZXNvdXJjZSkobmV3IENTU1Jlc291cmNlKGFkZHJlc3MpKSwgX2RlYyhfY2xhc3MgPSBmdW5jdGlvbiAoX0NTU1ZpZXdFbmdpbmVIb29rcykge1xuICAgIF9pbmhlcml0cyhWaWV3Q1NTLCBfQ1NTVmlld0VuZ2luZUhvb2tzKTtcblxuICAgIGZ1bmN0aW9uIFZpZXdDU1MoKSB7XG4gICAgICBcblxuICAgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9DU1NWaWV3RW5naW5lSG9va3MuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFZpZXdDU1M7XG4gIH0oQ1NTVmlld0VuZ2luZUhvb2tzKSkgfHwgX2NsYXNzKTtcblxuICByZXR1cm4gVmlld0NTUztcbn1cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L2NvbW1vbmpzL2Nzcy1yZXNvdXJjZS5qc1xuLy8gbW9kdWxlIGlkID0gNzVcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5fY3JlYXRlRHluYW1pY0VsZW1lbnQgPSBfY3JlYXRlRHluYW1pY0VsZW1lbnQ7XG5cbnZhciBfYXVyZWxpYVRlbXBsYXRpbmcgPSByZXF1aXJlKCdhdXJlbGlhLXRlbXBsYXRpbmcnKTtcblxuXG5cbmZ1bmN0aW9uIF9jcmVhdGVEeW5hbWljRWxlbWVudChuYW1lLCB2aWV3VXJsLCBiaW5kYWJsZU5hbWVzKSB7XG4gIHZhciBfZGVjLCBfZGVjMiwgX2NsYXNzO1xuXG4gIHZhciBEeW5hbWljRWxlbWVudCA9IChfZGVjID0gKDAsIF9hdXJlbGlhVGVtcGxhdGluZy5jdXN0b21FbGVtZW50KShuYW1lKSwgX2RlYzIgPSAoMCwgX2F1cmVsaWFUZW1wbGF0aW5nLnVzZVZpZXcpKHZpZXdVcmwpLCBfZGVjKF9jbGFzcyA9IF9kZWMyKF9jbGFzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBEeW5hbWljRWxlbWVudCgpIHtcbiAgICAgIFxuICAgIH1cblxuICAgIER5bmFtaWNFbGVtZW50LnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZChiaW5kaW5nQ29udGV4dCkge1xuICAgICAgdGhpcy4kcGFyZW50ID0gYmluZGluZ0NvbnRleHQ7XG4gICAgfTtcblxuICAgIHJldHVybiBEeW5hbWljRWxlbWVudDtcbiAgfSgpKSB8fCBfY2xhc3MpIHx8IF9jbGFzcyk7XG5cbiAgZm9yICh2YXIgaSA9IDAsIGlpID0gYmluZGFibGVOYW1lcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgKDAsIF9hdXJlbGlhVGVtcGxhdGluZy5iaW5kYWJsZSkoYmluZGFibGVOYW1lc1tpXSkoRHluYW1pY0VsZW1lbnQpO1xuICB9XG4gIHJldHVybiBEeW5hbWljRWxlbWVudDtcbn1cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L2NvbW1vbmpzL2R5bmFtaWMtZWxlbWVudC5qc1xuLy8gbW9kdWxlIGlkID0gNzZcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5nZXRFbGVtZW50TmFtZSA9IGdldEVsZW1lbnROYW1lO1xuZXhwb3J0cy5jb25maWd1cmUgPSBjb25maWd1cmU7XG5cbnZhciBfYXVyZWxpYVRlbXBsYXRpbmcgPSByZXF1aXJlKCdhdXJlbGlhLXRlbXBsYXRpbmcnKTtcblxudmFyIF9keW5hbWljRWxlbWVudCA9IHJlcXVpcmUoJy4vZHluYW1pYy1lbGVtZW50Jyk7XG5cbmZ1bmN0aW9uIGdldEVsZW1lbnROYW1lKGFkZHJlc3MpIHtcbiAgcmV0dXJuICgvKFteXFwvXlxcP10rKVxcLmh0bWwvaS5leGVjKGFkZHJlc3MpWzFdLnRvTG93ZXJDYXNlKClcbiAgKTtcbn1cblxuZnVuY3Rpb24gY29uZmlndXJlKGNvbmZpZykge1xuICB2YXIgdmlld0VuZ2luZSA9IGNvbmZpZy5jb250YWluZXIuZ2V0KF9hdXJlbGlhVGVtcGxhdGluZy5WaWV3RW5naW5lKTtcbiAgdmFyIGxvYWRlciA9IGNvbmZpZy5hdXJlbGlhLmxvYWRlcjtcblxuICB2aWV3RW5naW5lLmFkZFJlc291cmNlUGx1Z2luKCcuaHRtbCcsIHtcbiAgICAnZmV0Y2gnOiBmdW5jdGlvbiBmZXRjaChhZGRyZXNzKSB7XG4gICAgICByZXR1cm4gbG9hZGVyLmxvYWRUZW1wbGF0ZShhZGRyZXNzKS50aGVuKGZ1bmN0aW9uIChyZWdpc3RyeUVudHJ5KSB7XG4gICAgICAgIHZhciBfcmVmO1xuXG4gICAgICAgIHZhciBiaW5kYWJsZSA9IHJlZ2lzdHJ5RW50cnkudGVtcGxhdGUuZ2V0QXR0cmlidXRlKCdiaW5kYWJsZScpO1xuICAgICAgICB2YXIgZWxlbWVudE5hbWUgPSBnZXRFbGVtZW50TmFtZShhZGRyZXNzKTtcblxuICAgICAgICBpZiAoYmluZGFibGUpIHtcbiAgICAgICAgICBiaW5kYWJsZSA9IGJpbmRhYmxlLnNwbGl0KCcsJykubWFwKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICByZXR1cm4geC50cmltKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmVnaXN0cnlFbnRyeS50ZW1wbGF0ZS5yZW1vdmVBdHRyaWJ1dGUoJ2JpbmRhYmxlJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYmluZGFibGUgPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBfcmVmID0ge30sIF9yZWZbZWxlbWVudE5hbWVdID0gKDAsIF9keW5hbWljRWxlbWVudC5fY3JlYXRlRHluYW1pY0VsZW1lbnQpKGVsZW1lbnROYW1lLCBhZGRyZXNzLCBiaW5kYWJsZSksIF9yZWY7XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xufVxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzL2Rpc3QvY29tbW9uanMvaHRtbC1yZXNvdXJjZS1wbHVnaW4uanNcbi8vIG1vZHVsZSBpZCA9IDc3XG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuVGVtcGxhdGluZ1JvdXRlTG9hZGVyID0gdW5kZWZpbmVkO1xuXG52YXIgX2RlYywgX2NsYXNzO1xuXG52YXIgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uID0gcmVxdWlyZSgnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbicpO1xuXG52YXIgX2F1cmVsaWFUZW1wbGF0aW5nID0gcmVxdWlyZSgnYXVyZWxpYS10ZW1wbGF0aW5nJyk7XG5cbnZhciBfYXVyZWxpYVJvdXRlciA9IHJlcXVpcmUoJ2F1cmVsaWEtcm91dGVyJyk7XG5cbnZhciBfYXVyZWxpYVBhdGggPSByZXF1aXJlKCdhdXJlbGlhLXBhdGgnKTtcblxudmFyIF9hdXJlbGlhTWV0YWRhdGEgPSByZXF1aXJlKCdhdXJlbGlhLW1ldGFkYXRhJyk7XG5cblxuXG5mdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmICghc2VsZikgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoXCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWRcIik7IH0gcmV0dXJuIGNhbGwgJiYgKHR5cGVvZiBjYWxsID09PSBcIm9iamVjdFwiIHx8IHR5cGVvZiBjYWxsID09PSBcImZ1bmN0aW9uXCIpID8gY2FsbCA6IHNlbGY7IH1cblxuZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gXCJmdW5jdGlvblwiICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgXCIgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9XG5cbnZhciBUZW1wbGF0aW5nUm91dGVMb2FkZXIgPSBleHBvcnRzLlRlbXBsYXRpbmdSb3V0ZUxvYWRlciA9IChfZGVjID0gKDAsIF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbi5pbmplY3QpKF9hdXJlbGlhVGVtcGxhdGluZy5Db21wb3NpdGlvbkVuZ2luZSksIF9kZWMoX2NsYXNzID0gZnVuY3Rpb24gKF9Sb3V0ZUxvYWRlcikge1xuICBfaW5oZXJpdHMoVGVtcGxhdGluZ1JvdXRlTG9hZGVyLCBfUm91dGVMb2FkZXIpO1xuXG4gIGZ1bmN0aW9uIFRlbXBsYXRpbmdSb3V0ZUxvYWRlcihjb21wb3NpdGlvbkVuZ2luZSkge1xuICAgIFxuXG4gICAgdmFyIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX1JvdXRlTG9hZGVyLmNhbGwodGhpcykpO1xuXG4gICAgX3RoaXMuY29tcG9zaXRpb25FbmdpbmUgPSBjb21wb3NpdGlvbkVuZ2luZTtcbiAgICByZXR1cm4gX3RoaXM7XG4gIH1cblxuICBUZW1wbGF0aW5nUm91dGVMb2FkZXIucHJvdG90eXBlLmxvYWRSb3V0ZSA9IGZ1bmN0aW9uIGxvYWRSb3V0ZShyb3V0ZXIsIGNvbmZpZykge1xuICAgIHZhciBjaGlsZENvbnRhaW5lciA9IHJvdXRlci5jb250YWluZXIuY3JlYXRlQ2hpbGQoKTtcbiAgICB2YXIgaW5zdHJ1Y3Rpb24gPSB7XG4gICAgICB2aWV3TW9kZWw6ICgwLCBfYXVyZWxpYVBhdGgucmVsYXRpdmVUb0ZpbGUpKGNvbmZpZy5tb2R1bGVJZCwgX2F1cmVsaWFNZXRhZGF0YS5PcmlnaW4uZ2V0KHJvdXRlci5jb250YWluZXIudmlld01vZGVsLmNvbnN0cnVjdG9yKS5tb2R1bGVJZCksXG4gICAgICBjaGlsZENvbnRhaW5lcjogY2hpbGRDb250YWluZXIsXG4gICAgICB2aWV3OiBjb25maWcudmlldyB8fCBjb25maWcudmlld1N0cmF0ZWd5LFxuICAgICAgcm91dGVyOiByb3V0ZXJcbiAgICB9O1xuXG4gICAgY2hpbGRDb250YWluZXIuZ2V0Q2hpbGRSb3V0ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgY2hpbGRSb3V0ZXIgPSB2b2lkIDA7XG5cbiAgICAgIGNoaWxkQ29udGFpbmVyLnJlZ2lzdGVySGFuZGxlcihfYXVyZWxpYVJvdXRlci5Sb3V0ZXIsIGZ1bmN0aW9uIChjKSB7XG4gICAgICAgIHJldHVybiBjaGlsZFJvdXRlciB8fCAoY2hpbGRSb3V0ZXIgPSByb3V0ZXIuY3JlYXRlQ2hpbGQoY2hpbGRDb250YWluZXIpKTtcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gY2hpbGRDb250YWluZXIuZ2V0KF9hdXJlbGlhUm91dGVyLlJvdXRlcik7XG4gICAgfTtcblxuICAgIHJldHVybiB0aGlzLmNvbXBvc2l0aW9uRW5naW5lLmVuc3VyZVZpZXdNb2RlbChpbnN0cnVjdGlvbik7XG4gIH07XG5cbiAgcmV0dXJuIFRlbXBsYXRpbmdSb3V0ZUxvYWRlcjtcbn0oX2F1cmVsaWFSb3V0ZXIuUm91dGVMb2FkZXIpKSB8fCBfY2xhc3MpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLXRlbXBsYXRpbmctcm91dGVyL2Rpc3QvY29tbW9uanMvcm91dGUtbG9hZGVyLmpzXG4vLyBtb2R1bGUgaWQgPSA3OFxuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ25uQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQzNsSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDdHFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUNwUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDN0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQzlNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQ3p2REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUM1TUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDNUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDakxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQ3hHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQzFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDMVBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUM1SUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ3ZMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDcEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDOWlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQzFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQzdMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQzFkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUNoREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUN4QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQ3hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQ3RNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDN0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDakZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDN0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUN0SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUNsVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDdENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDakNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDN0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDL0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDckVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQ3JEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDcERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDckVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQ3pQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUNwVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUN6REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDM25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQ2xIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQ3hKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQy9EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQ3REQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUNyUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUM5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUNuSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQ2pFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDN0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDdkdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQ3RDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDdkpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUM5Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDdEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDakxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQ3BIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQzlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQzFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzsiLCJzb3VyY2VSb290IjoiIn0=